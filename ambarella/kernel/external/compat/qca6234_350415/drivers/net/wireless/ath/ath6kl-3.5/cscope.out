cscope 15 $HOME/boss_sdk/kmod/atheros/ar6003/ar6004_3_5_0_374/compat-wireless/drivers/net/wireless/ath/ath6kl-3.5 -q 0000010770 0001664137
	@ap.c

17 
	~"c‹e.h
"

18 
	~"debug.h
"

19 
	~"hif-›s.h
"

21 
ölöe
 
≠_kì∑live_adju°
 
	$__≠_kì∑live_adju°_txrx_time
(

22 
©h6kl_°a
 *
c⁄n
, 
u16
 
œ°_txrx_time
, 
now
)

24 
u32
 
diff_ms
;

25 
≠_kì∑live_adju°
 
adju°_ªsu…
 = 
AP_KA_ADJ_ERROR
;

27 i‡(
c⁄n
->
œ°_txrx_time_tgt
) {

28 i‡(
œ°_txrx_time
 >
c⁄n
->
œ°_txrx_time_tgt
)

29 
diff_ms
 = (
œ°_txrx_time
 -

30 
c⁄n
->
œ°_txrx_time_tgt
) << 10;

32 
diff_ms
 = (0xffff -

33 (
c⁄n
->
œ°_txrx_time_tgt
 - 
œ°_txrx_time
))

37 
c⁄n
->
œ°_txrx_time_tgt
 = 
œ°_txrx_time
;

38 
c⁄n
->
œ°_txrx_time
 +
	`m£cs_to_jiffõs
(
diff_ms
);

40 i‡(
c⁄n
->
œ°_txrx_time
 > 
now
)

41 
c⁄n
->
œ°_txrx_time
 = 
now
;

43 
adju°_ªsu…
 = 
AP_KA_ADJ_ADJUST
;

46 
c⁄n
->
œ°_txrx_time_tgt
 = 
œ°_txrx_time
;

47 
c⁄n
->
œ°_txrx_time
 = 
now
;

49 
adju°_ªsu…
 = 
AP_KA_ADJ_BASESET
;

52  
adju°_ªsu…
;

53 
	}
}

55 
	$_≠_kì∑live_upd©e_check_txrx_time
(
©h6kl_vif
 *
vif
,

56 
©h6kl_°a
 *
c⁄n
,

57 
u16
 
œ°_txrx_time
)

59 
≠_kì∑live_öfo
 *
≠_kì∑live
 = 
vif
->
≠_kì∑live_˘x
;

60 
now
 = 
jiffõs
;

61 
≠_kì∑live_adju°
 
adju°_ªsu…
;

62 
a˘i⁄
 = 
AP_KA_ACTION_NONE
;

64 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

65 
adju°_ªsu…
 = 
	`__≠_kì∑live_adju°_txrx_time
(
c⁄n
,

66 
œ°_txrx_time
,

67 
now
);

68 i‡(
adju°_ªsu…
 =
AP_KA_ADJ_ADJUST
) {

69 i‡((
now
 - 
c⁄n
->
œ°_txrx_time
) >=

70 
	`m£cs_to_jiffõs
(
≠_kì∑live
->
≠_ka_öãrvÆ
))

71 
a˘i⁄
 = 
AP_KA_ACTION_POLL
;

73 i‡((
now
 - 
c⁄n
->
œ°_txrx_time
) >=

74 
	`m£cs_to_jiffõs
(
≠_kì∑live
->
≠_ka_ªmove_time
))

75 
a˘i⁄
 = 
AP_KA_ACTION_REMOVE
;

77 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

79 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

81 
c⁄n
->
aid
,

82 
c⁄n
->
œ°_txrx_time_tgt
,

83 
c⁄n
->
œ°_txrx_time
,

84 
now
,

85 (
a˘i⁄
 =
AP_KA_ACTION_NONE
) ? "NONE" :

86 ((
a˘i⁄
 =
AP_KA_ACTION_POLL
) ? "POLL" : "REMOVE"));

88  
a˘i⁄
;

89 
	}
}

91 
	$≠_kì∑live_¥ñﬂd_txrx_time
(
©h6kl_vif
 *
vif
)

93 
©h6kl
 *
¨
 = 
vif
->ar;

94 
ªt
 = 0;

97 i‡(
vif
->
°a_li°_ödex
)

98 
ªt
 = 
	`©h6kl_wmi_gë_°©s_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
);

100  
ªt
;

101 
	}
}

103 
	$≠_kì∑live_upd©e_check_txrx_time
(
©h6kl_vif
 *
vif
)

105 
	#_KICKOUT_CAUSE
 (
WLAN_REASON_DISASSOC_DUE_TO_INACTIVITY
)

	)

106 
©h6kl
 *
¨
 = 
vif
->ar;

107 
wmi_≠_mode_°©
 *
≠_°©s
 = &
vif
->ap_stats;

108 
wmi_≥r_°a_°©
 *
≥r_°a_°©
;

109 
©h6kl_°a
 *
c⁄n
;

110 
i
, 
a˘i⁄
;

112 i‡(
	`ã°_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
)) {

113 
	`©h6kl_öfo
("somebody still queryÇowánd ignore it.\n");

114  -
EBUSY
;

118 
i
 = 0; i < 
AP_MAX_NUM_STA
; i++) {

119 
≥r_°a_°©
 = &
≠_°©s
->
°a
[
i
];

120 i‡(
≥r_°a_°©
->
aid
) {

121 
c⁄n
 = 
	`©h6kl_föd_°a_by_aid
(
vif
, 
≥r_°a_°©
->
aid
);

122 i‡(
c⁄n
) {

123 
a˘i⁄
 = 
	`_≠_kì∑live_upd©e_check_txrx_time
(

124 
vif
,

125 
c⁄n
,

126 
≥r_°a_°©
->
œ°_txrx_time
);

128 i‡(
a˘i⁄
 =
AP_KA_ACTION_POLL
) {

129 
	`©h6kl_wmi_≠_pﬁl_°a
(
¨
->
wmi
,

130 
vif
->
fw_vif_idx
,

131 
c⁄n
->
aid
);

132 } i‡(
a˘i⁄
 =
AP_KA_ACTION_REMOVE
) {

133 
	`©h6kl_wmi_≠_£t_mlme
(
¨
->
wmi
,

134 
vif
->
fw_vif_idx
,

135 
WMI_AP_DEAUTH
,

136 
c⁄n
->
mac
,

137 
_KICKOUT_CAUSE
);

140 
	`©h6kl_îr
("can't findÅhis AID %d\n",

141 
≥r_°a_°©
->
aid
);

146 #unde‡
_KICKOUT_CAUSE


147 
	}
}

149 
	$≠_kì∑live_°¨t
(
¨g
)

151 
≠_kì∑live_öfo
 *
≠_kì∑live
 =

152 (
≠_kì∑live_öfo
 *Ë
¨g
;

153 
©h6kl_vif
 *
vif
 = 
≠_kì∑live
->vif;

154 
ªt
;

156 
	`BUG_ON
(!
vif
);

158 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

160 
vif
->
fw_vif_idx
,

161 
vif
->
°a_li°_ödex
,

162 (
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
) ?

165 i‡((
vif
->
nw_ty≥
 =
AP_NETWORK
) &&

166 
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)) {

167 i‡(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
) {

168 
ªt
 = 
	`≠_kì∑live_¥ñﬂd_txrx_time
(
vif
);

169 i‡(
ªt
)

170 
	`©h6kl_îr
("preloadÜast_txrx_time fail\n");

173 
ªt
 = 
	`≠_kì∑live_upd©e_check_txrx_time
(
vif
);

174 i‡(
ªt
)

175 
	`©h6kl_îr
("updatecheckÜast_txrx_time fail\n");

178 i‡((
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_START
) &&

179 (
≠_kì∑live
->
≠_ka_öãrvÆ
)) {

180 i‡(
≠_kì∑live
->
Êags
 &

181 
ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
) {

182 
	`mod_timî
(&
≠_kì∑live
->
≠_ka_timî
,

183 
jiffõs
 +

184 
	`m£cs_to_jiffõs
(

185 
ATH6KL_AP_KA_PRELOAD_LEADTIME
));

187 
≠_kì∑live
->
Êags
 &=

188 ~
ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
;

190 
	`mod_timî
(&
≠_kì∑live
->
≠_ka_timî
,

191 
jiffõs
 +

192 
	`m£cs_to_jiffõs
(

193 
≠_kì∑live
->
≠_ka_öãrvÆ
) -

194 
	`m£cs_to_jiffõs
(

195 
ATH6KL_AP_KA_PRELOAD_LEADTIME
));

197 
≠_kì∑live
->
Êags
 |=

198 
ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
;

204 
	}
}

206 
≠_kì∑live_öfo
 *
	$©h6kl_≠_kì∑live_öô
(
©h6kl_vif
 *
vif
,

207 
≠_kì∑live_mode
 
mode
)

209 
≠_kì∑live_öfo
 *
≠_kì∑live
;

211 
≠_kì∑live
 = 
	`kzÆloc
((
≠_kì∑live_öfo
), 
GFP_KERNEL
);

212 i‡(!
≠_kì∑live
) {

213 
	`©h6kl_îr
("failedÅoálloc memory foráp_keepalive\n");

214  
NULL
;

217 
≠_kì∑live
->
vif
 = vif;

218 
≠_kì∑live
->
≠_ka_öãrvÆ
 = 0;

219 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
 = 0;

220 i‡((
mode
 =
AP_KA_MODE_ENABLE
) ||

221 (
mode
 =
AP_KA_MODE_CONFIG_BYSUPP
)) {

222 
≠_kì∑live
->
Êags
 |
ATH6KL_AP_KA_FLAGS_ENABLED
;

223 
≠_kì∑live
->
≠_ka_öãrvÆ
 = 
ATH6KL_AP_KA_INTERVAL_DEFAULT
;

224 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
 = 
ATH6KL_AP_KA_RECLAIM_CYCLE
;

226 i‡(
mode
 =
AP_KA_MODE_CONFIG_BYSUPP
)

227 
≠_kì∑live
->
Êags
 |=

228 
ATH6KL_AP_KA_FLAGS_CONFIG_BY_SUPP
;

229 } i‡(
mode
 =
AP_KA_MODE_BYSUPP
)

230 
≠_kì∑live
->
Êags
 |
ATH6KL_AP_KA_FLAGS_BY_SUPP
;

232 
≠_kì∑live
->
≠_ka_ªmove_time
 =áp_kì∑live->
≠_ka_öãrvÆ
 *

233 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
;

236 
	`öô_timî
(&
≠_kì∑live
->
≠_ka_timî
);

237 
≠_kì∑live
->
≠_ka_timî
.
fun˘i⁄
 = 
≠_kì∑live_°¨t
;

238 
≠_kì∑live
->
≠_ka_timî
.
d©a
 = ()áp_keepalive;

240 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

242 
vif
->
fw_vif_idx
,

243 
≠_kì∑live
->
≠_ka_öãrvÆ
,

244 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
,

245 (
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_ENABLED
) ?

246 ((
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_CONFIG_BY_SUPP
) ?

248 ((
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_BY_SUPP
) ?

251  
≠_kì∑live
;

252 
	}
}

254 
	$©h6kl_≠_kì∑live_deöô
(
©h6kl_vif
 *
vif
)

256 
≠_kì∑live_öfo
 *
≠_kì∑live
 = 
vif
->
≠_kì∑live_˘x
;

258 i‡(
≠_kì∑live
) {

259 i‡(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_START
)

260 
	`dñ_timî
(&
≠_kì∑live
->
≠_ka_timî
);

262 
	`k‰ì
(
≠_kì∑live
);

265 
vif
->
≠_kì∑live_˘x
 = 
NULL
;

267 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

269 
vif
->
fw_vif_idx
);

272 
	}
}

274 
	$©h6kl_≠_kì∑live_°¨t
(
©h6kl_vif
 *
vif
)

276 
≠_kì∑live_öfo
 *
≠_kì∑live
 = 
vif
->
≠_kì∑live_˘x
;

278 
	`BUG_ON
(!
≠_kì∑live
);

279 
	`BUG_ON
(
vif
->
nw_ty≥
 !
AP_NETWORK
);

281 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

283 
vif
->
fw_vif_idx
,

284 
≠_kì∑live
->
Êags
);

286 i‡(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_ENABLED
) {

287 
	`mod_timî
(&
≠_kì∑live
->
≠_ka_timî
,

288 
jiffõs
 +

289 
	`m£cs_to_jiffõs
(
≠_kì∑live
->
≠_ka_öãrvÆ
) -

290 
	`m£cs_to_jiffõs
(
ATH6KL_AP_KA_PRELOAD_LEADTIME
));

291 
≠_kì∑live
->
Êags
 |(
ATH6KL_AP_KA_FLAGS_START
 |

292 
ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
);

293 
	`©h6kl_wmi_£t_öa˘_cmd
(
vif
->
¨
->
wmi
,

294 
DISALBE_AP_INACTIVE_TIMEMER
);

298 
	}
}

300 
	$©h6kl_≠_kì∑live_°›
(
©h6kl_vif
 *
vif
)

302 
≠_kì∑live_öfo
 *
≠_kì∑live
 = 
vif
->
≠_kì∑live_˘x
;

304 i‡(!
≠_kì∑live
)

307 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

309 
vif
->
fw_vif_idx
,

310 
≠_kì∑live
->
Êags
);

312 i‡(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_START
) {

313 
	`dñ_timî
(&
≠_kì∑live
->
≠_ka_timî
);

314 
≠_kì∑live
->
Êags
 &~(
ATH6KL_AP_KA_FLAGS_START
 |

315 
ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
);

319 
	}
}

321 
	$©h6kl_≠_kì∑live_c⁄fig
(
©h6kl_vif
 *
vif
,

322 
u32
 
≠_ka_öãrvÆ
,

323 
u32
 
≠_ka_ª˛aim_cy˛e
)

325 
≠_kì∑live_öfo
 *
≠_kì∑live
 = 
vif
->
≠_kì∑live_˘x
;

326 
ª°¨t
 = 0;

328 i‡(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_BY_SUPP
) {

329 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

332 } i‡(!(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_ENABLED
)) {

334 } i‡(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_CONFIG_BY_SUPP
) {

335 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

340 i‡((
≠_ka_öãrvÆ
 != 0) &&

341 (
≠_ka_öãrvÆ
 < 
ATH6KL_AP_KA_INTERVAL_MIN
))

342 
≠_ka_öãrvÆ
 = 
ATH6KL_AP_KA_INTERVAL_MIN
;

344 i‡(
≠_ka_ª˛aim_cy˛e
 == 0)

345 
≠_ka_ª˛aim_cy˛e
 = 1;

347 i‡(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_START
) {

348 
	`dñ_timî
(&
≠_kì∑live
->
≠_ka_timî
);

349 
≠_kì∑live
->
Êags
 &~(
ATH6KL_AP_KA_FLAGS_START
 |

350 
ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
);

351 
ª°¨t
 = 1;

354 i‡(
≠_ka_öãrvÆ
 == 0) {

355 
≠_kì∑live
->
≠_ka_öãrvÆ
 = 0;

356 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
 = 0;

357 
≠_kì∑live
->
Êags
 &~
ATH6KL_AP_KA_FLAGS_ENABLED
;

359 i‡(
≠_ka_öãrvÆ
 * 
≠_ka_ª˛aim_cy˛e
 <

360 
ATH6KL_AP_KA_RECLAIM_TIME_MAX
) {

361 
≠_kì∑live
->
≠_ka_öãrvÆ
 =áp_ka_interval;

362 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
 =áp_ka_reclaim_cycle;

364 
≠_kì∑live
->
≠_ka_öãrvÆ
 =

365 
ATH6KL_AP_KA_INTERVAL_DEFAULT
;

366 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
 =

367 
ATH6KL_AP_KA_RECLAIM_CYCLE
;

370 
≠_kì∑live
->
≠_ka_ªmove_time
 =

371 
≠_kì∑live
->
≠_ka_öãrvÆ
 *

372 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
;

373 
≠_kì∑live
->
Êags
 |
ATH6KL_AP_KA_FLAGS_ENABLED
;

375 i‡(
ª°¨t
) {

376 
	`mod_timî
(&
≠_kì∑live
->
≠_ka_timî
,

377 
jiffõs
 +

378 
	`m£cs_to_jiffõs
(

379 
≠_kì∑live
->
≠_ka_öãrvÆ
) -

380 
	`m£cs_to_jiffõs
(

381 
ATH6KL_AP_KA_PRELOAD_LEADTIME
 * 1000));

383 
≠_kì∑live
->
Êags
 |=

384 (
ATH6KL_AP_KA_FLAGS_START
 |

385 
ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
);

389 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

391 
vif
->
fw_vif_idx
,

392 
≠_kì∑live
->
≠_ka_öãrvÆ
,

393 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
,

394 (
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_ENABLED
) ?

396 
ª°¨t
);

400 
	}
}

402 
	$©h6kl_≠_kì∑live_c⁄fig_by_suµ
(
©h6kl_vif
 *
vif
,

403 
u16
 
öa˘ive_time
)

405 
≠_kì∑live_öfo
 *
≠_kì∑live
 = 
vif
->
≠_kì∑live_˘x
;

406 
u32
 
≠_ka_öãrvÆ
;

407 
u32
 
timeout
 = 
öa˘ive_time
 * 1000;

409 i‡(!(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_ENABLED
) ||

410 !(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_CONFIG_BY_SUPP
))

413 i‡(
timeout
 == 0) {

414 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

420 i‡(
timeout
 < (
ATH6KL_AP_KA_INTERVAL_MIN
 * 1))

421 
timeout
 = (
ATH6KL_AP_KA_INTERVAL_MIN
 * 1);

422 i‡(
timeout
 > 
ATH6KL_AP_KA_RECLAIM_TIME_MAX
)

423 
timeout
 = 
ATH6KL_AP_KA_RECLAIM_TIME_MAX
;

425 i‡(
timeout
 < (
ATH6KL_AP_KA_INTERVAL_DEFAULT
 *

426 
ATH6KL_AP_KA_RECLAIM_CYCLE
)) {

427 i‡(
timeout
 <
ATH6KL_AP_KA_INTERVAL_DEFAULT
)

428 
≠_ka_öãrvÆ
 = 
ATH6KL_AP_KA_INTERVAL_MIN
;

430 
≠_ka_öãrvÆ
 = 
ATH6KL_AP_KA_INTERVAL_DEFAULT
;

432 
≠_ka_öãrvÆ
 = 
ATH6KL_AP_KA_INTERVAL_DEFAULT
;

435 
≠_kì∑live
->
≠_ka_öãrvÆ
 =áp_ka_interval;

436 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
 = 
timeout
 / 
≠_ka_öãrvÆ
;

437 
≠_kì∑live
->
≠_ka_ªmove_time
 =

438 
≠_ka_öãrvÆ
 * 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
;

440 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

442 
vif
->
fw_vif_idx
,

443 
öa˘ive_time
,

444 
≠_kì∑live
->
≠_ka_öãrvÆ
,

445 
≠_kì∑live
->
≠_ka_ª˛aim_cy˛e
);

448 
	}
}

451 
u32
 
	$≠_kì∑live_gë_öa˘ive_time
(
©h6kl_vif
 *
vif
,

452 
©h6kl_°a
 *
c⁄n
)

454 
wmi_≠_mode_°©
 *
≠_°©s
 = &
vif
->ap_stats;

455 
u32
 
öa˘_time
 = 0;

456 
i
;

458 
i
 = 0; i < 
AP_MAX_NUM_STA
; i++) {

459 
wmi_≥r_°a_°©
 *
≥r_°a_°©
 = &
≠_°©s
->
°a
[
i
];

461 i‡(
≥r_°a_°©
->
aid
 =
c⁄n
->aid) {

462 
now
 = 
jiffõs
;

464 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

465 
	`__≠_kì∑live_adju°_txrx_time
(
c⁄n
,

466 
≥r_°a_°©
->
œ°_txrx_time
,

467 
now
);

470 
öa˘_time
 = 
	`jiffõs_to_m£cs
(
now
 -

471 
c⁄n
->
œ°_txrx_time
);

472 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

474 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

476 
c⁄n
->
œ°_txrx_time_tgt
,

477 
c⁄n
->
œ°_txrx_time
,

478 
now
);

482  
öa˘_time
;

483 
	}
}

485 
u32
 
	$©h6kl_≠_kì∑live_gë_öa˘ive_time
(
©h6kl_vif
 *
vif
, 
u8
 *
mac
)

487 
©h6kl_°a
 *
c⁄n
;

488 
u32
 
öa˘_time
;

490 
c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, 
mac
);

492 i‡(
c⁄n
)

493 
öa˘_time
 = 
	`≠_kì∑live_gë_öa˘ive_time
(
vif
, 
c⁄n
);

495 
öa˘_time
 = 0;

497 
	`©h6kl_îr
("can't find %02x:%02x:%02x:%02x:%02x:%02x vif %d\n",

498 
mac
[0], mac[1], mac[2], mac[3], mac[4], mac[5],

499 
vif
->
fw_vif_idx
);

502 
	`©h6kl_dbg
(
ATH6KL_DBG_KEEPALIVE
,

504 (
c⁄n
 ? (c⁄n->
aid
) : 0),

505 
öa˘_time
);

507  
öa˘_time
;

508 
	}
}

510 
boﬁ
 
	$©h6kl_≠_kì∑live_by_suµ
(
©h6kl_vif
 *
vif
)

512 
≠_kì∑live_öfo
 *
≠_kì∑live
 = 
vif
->
≠_kì∑live_˘x
;

514 i‡(!
≠_kì∑live
)

515  
Ál£
;

517 i‡(
≠_kì∑live
->
Êags
 & 
ATH6KL_AP_KA_FLAGS_BY_SUPP
)

518  
åue
;

520  
Ál£
;

521 
	}
}

523 
≠_a˛_öfo
 *
	$©h6kl_≠_a˛_öô
(
©h6kl_vif
 *
vif
)

525 
≠_a˛_öfo
 *
≠_a˛
;

527 
≠_a˛
 = 
	`kzÆloc
((
≠_a˛_öfo
), 
GFP_KERNEL
);

528 i‡(!
≠_a˛
) {

529 
	`©h6kl_îr
("failedÅoálloc memory foráp_acl\n");

530  
NULL
;

533 
≠_a˛
->
vif
 = vif;

536 
≠_a˛
->
a˛_mode
 = 
AP_ACL_MODE_DISABLE
;

538 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

540 
vif
->
fw_vif_idx
);

542  
≠_a˛
;

543 
	}
}

545 
	$©h6kl_≠_a˛_deöô
(
©h6kl_vif
 *
vif
)

547 
≠_a˛_öfo
 *
≠_a˛
 = 
vif
->
≠_a˛_˘x
;

549 i‡(
≠_a˛
 !
NULL
) {

550 i‡(
≠_a˛
->
œ°_a˛_c⁄fig
 !
NULL
)

551 
	`k‰ì
(
≠_a˛
->
œ°_a˛_c⁄fig
);

552 
	`k‰ì
(
≠_a˛
);

555 
vif
->
≠_a˛_˘x
 = 
NULL
;

557 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

559 
vif
->
fw_vif_idx
);

562 
	}
}

564 
	$©h6kl_≠_a˛_°¨t
(
©h6kl_vif
 *
vif
)

566 
≠_a˛_öfo
 *
≠_a˛
 = 
vif
->
≠_a˛_˘x
;

568 i‡(
≠_a˛
) {

569 i‡(
≠_a˛
->
œ°_a˛_c⁄fig
 !
NULL
)

570 
	`k‰ì
(
≠_a˛
->
œ°_a˛_c⁄fig
);

572 
≠_a˛
->
œ°_a˛_c⁄fig
 = 
NULL
;

575 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

577 
vif
->
fw_vif_idx
);

580 
	}
}

582 
	$©h6kl_≠_a˛_°›
(
©h6kl_vif
 *
vif
)

584 
≠_a˛_öfo
 *
≠_a˛
 = 
vif
->
≠_a˛_˘x
;

586 i‡(
≠_a˛
) {

587 
	`©h6kl_≠_a˛_c⁄fig_mac_li°_ª£t
(
vif
);

588 
	`©h6kl_≠_a˛_c⁄fig_pﬁicy
(
vif
, 
AP_ACL_MODE_DISABLE
);

590 i‡(
≠_a˛
->
œ°_a˛_c⁄fig
 !
NULL
)

591 
	`k‰ì
(
≠_a˛
->
œ°_a˛_c⁄fig
);

593 
≠_a˛
->
œ°_a˛_c⁄fig
 = 
NULL
;

596 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

598 
vif
->
fw_vif_idx
);

601 
	}
}

603 
	$©h6kl_≠_a˛_c⁄fig_pﬁicy
(
©h6kl_vif
 *
vif
,

604 
≠_a˛_mode
 
mode
)

606 
≠_a˛_öfo
 *
≠_a˛
 = 
vif
->
≠_a˛_˘x
;

607 
≠_a˛_íåy
 *ap_acl_entry;

608 
u8
 
i
, 
pﬁicy
;

610 i‡(
≠_a˛
 =
NULL
)

613 
mode
) {

614 
AP_ACL_MODE_DISABLE
:

615 
pﬁicy
 = 
AP_ACL_DISABLE
;

617 
AP_ACL_MODE_ALLOW
:

618 
pﬁicy
 = 
AP_ACL_ALLOW_MAC
;

620 
AP_ACL_MODE_DENY
:

621 
pﬁicy
 = 
AP_ACL_DENY_MAC
;

624 
	`BUG_ON
(1);

627 
≠_a˛
->
a˛_mode
 = 
mode
;

628 
	`©h6kl_wmi_≠_a˛_pﬁicy
(
vif
->
¨
->
wmi
, vif->
fw_vif_idx
, 
pﬁicy
);

630 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

632 
vif
->
fw_vif_idx
,

633 (
≠_a˛
->
a˛_mode
 ?

634 (
≠_a˛
->
a˛_mode
 =
AP_ACL_MODE_ALLOW
 ?

638 i‡(
≠_a˛
->
a˛_mode
 !
AP_ACL_MODE_DISABLE
) {

639 
i
 = 0; i < 
ATH6KL_AP_ACL_MAX_NUM
; i++) {

640 
≠_a˛_íåy
 = &
≠_a˛
->
a˛_li°
[
i
];

642 i‡(
≠_a˛_íåy
->
Êags
 & 
ATH6KL_AP_ACL_FLAGS_USED
) {

643 
	`©h6kl_wmi_≠_a˛_mac_li°
(
vif
->
¨
->
wmi
,

644 
vif
->
fw_vif_idx
,

645 
i
,

646 
≠_a˛_íåy
->
mac_addr
,

647 
ADD_MAC_ADDR
);

648 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

651 
≠_a˛_íåy
->
mac_addr
[0],

652 
≠_a˛_íåy
->
mac_addr
[1],

653 
≠_a˛_íåy
->
mac_addr
[2],

654 
≠_a˛_íåy
->
mac_addr
[3],

655 
≠_a˛_íåy
->
mac_addr
[4],

656 
≠_a˛_íåy
->
mac_addr
[5]);

662 
	}
}

664 
	$©h6kl_≠_a˛_c⁄fig_mac_li°
(
©h6kl_vif
 *
vif
,

665 
u8
 *
mac_addr
, 
boﬁ
 
ªmoved
)

667 
≠_a˛_öfo
 *
≠_a˛
 = 
vif
->
≠_a˛_˘x
;

668 
≠_a˛_íåy
 *ap_acl_entry;

669 
i
, 
¶Ÿ_idx
, 
fú°_nŸ_u£d
 = 0xff;

670 
u8
 
a˘i⁄
;

672 i‡(
≠_a˛
 =
NULL
)

675 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

677 
mac_addr
[0], mac_addr[1], mac_addr[2],

678 
mac_addr
[3], mac_addr[4], mac_addr[5]);

680 
i
 = 0; i < 
ATH6KL_AP_ACL_MAX_NUM
; i++) {

681 
≠_a˛_íåy
 = &
≠_a˛
->
a˛_li°
[
i
];

682 i‡(
≠_a˛_íåy
->
Êags
 & 
ATH6KL_AP_ACL_FLAGS_USED
) {

683 i‡(
	`memcmp
(
≠_a˛_íåy
->
mac_addr
,

684 
mac_addr
,

685 
ETH_ALEN
) == 0) {

686 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

688 
i
);

691 } i‡(
fú°_nŸ_u£d
 == 0xff)

692 
fú°_nŸ_u£d
 = 
i
;

695 i‡(
ªmoved
) {

696 
a˘i⁄
 = 
DEL_MAC_ADDR
;

697 
¶Ÿ_idx
 = 
i
;

699 i‡(
i
 =
ATH6KL_AP_ACL_MAX_NUM
) {

700 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

706 
≠_a˛_íåy
 = &
≠_a˛
->
a˛_li°
[
¶Ÿ_idx
];

707 
≠_a˛_íåy
->
Êags
 &~
ATH6KL_AP_ACL_FLAGS_USED
;

709 
a˘i⁄
 = 
ADD_MAC_ADDR
;

710 
¶Ÿ_idx
 = 
fú°_nŸ_u£d
;

712 i‡(
i
 !
ATH6KL_AP_ACL_MAX_NUM
)

715 i‡(
fú°_nŸ_u£d
 == 0xff) {

716 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

722 
≠_a˛_íåy
 = &
≠_a˛
->
a˛_li°
[
¶Ÿ_idx
];

723 
≠_a˛_íåy
->
Êags
 |
ATH6KL_AP_ACL_FLAGS_USED
;

724 
	`mem˝y
(
≠_a˛_íåy
->
mac_addr
, mac_addr, 
ETH_ALEN
);

727 i‡(
≠_a˛
->
a˛_mode
 !
AP_ACL_MODE_DISABLE
) {

728 
	`©h6kl_wmi_≠_a˛_mac_li°
(
vif
->
¨
->
wmi
,

729 
vif
->
fw_vif_idx
,

730 
¶Ÿ_idx
,

731 
≠_a˛_íåy
->
mac_addr
,

732 
a˘i⁄
);

735 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
,

737 ((
ªmoved
) ? "DEL" : "ADD"),

738 
mac_addr
[0], mac_addr[1], mac_addr[2],

739 
mac_addr
[3], mac_addr[4], mac_addr[5],

740 
¶Ÿ_idx
);

743 
	}
}

745 
	$©h6kl_≠_a˛_c⁄fig_mac_li°_ª£t
(
©h6kl_vif
 *
vif
)

747 
≠_a˛_öfo
 *
≠_a˛
 = 
vif
->
≠_a˛_˘x
;

748 
≠_a˛_íåy
 *ap_acl_entry;

749 
i
;

751 i‡(
≠_a˛
 =
NULL
)

754 
	`©h6kl_dbg
(
ATH6KL_DBG_ACL
, "ap_aclÑeset\n");

756 
i
 = 0; i < 
ATH6KL_AP_ACL_MAX_NUM
; i++) {

757 
≠_a˛_íåy
 = &
≠_a˛
->
a˛_li°
[
i
];

758 i‡(
≠_a˛_íåy
->
Êags
 & 
ATH6KL_AP_ACL_FLAGS_USED
)

759 
	`©h6kl_≠_a˛_c⁄fig_mac_li°
(
vif
,

760 
≠_a˛_íåy
->
mac_addr
,

761 
åue
);

765 
	}
}

767 
	$©h6kl_≠_a˛_dump
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
)

769 
i
, 
Àn
 = 0;

771 i‡(!
buf
)

774 
i
 = 0; i < 
¨
->
vif_max
; i++) {

775 
©h6kl_vif
 *
vif
;

777 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

778 i‡((
vif
) &&

779 (
vif
->
nw_ty≥
 =
AP_NETWORK
)) {

780 
≠_a˛_öfo
 *
≠_a˛
;

782 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

784 
vif
->
fw_vif_idx
);

786 
≠_a˛
 = 
vif
->
≠_a˛_˘x
;

787 i‡(!
≠_a˛
)

790 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "mode %d\n",

791 
≠_a˛
->
a˛_mode
);

793 
i
 = 0; i < 
ATH6KL_AP_ACL_MAX_NUM
; i++) {

794 
≠_a˛_íåy
 *ap_acl_entry;

796 
≠_a˛_íåy
 = &
≠_a˛
->
a˛_li°
[
i
];

798 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

801 
i
,

802 
≠_a˛_íåy
->
Êags
,

803 
≠_a˛_íåy
->
mac_addr
[0],

804 
≠_a˛_íåy
->
mac_addr
[1],

805 
≠_a˛_íåy
->
mac_addr
[2],

806 
≠_a˛_íåy
->
mac_addr
[3],

807 
≠_a˛_íåy
->
mac_addr
[4],

808 
≠_a˛_íåy
->
mac_addr
[5]);

813  
Àn
;

814 
	}
}

816 
ölöe
 
	$_≠_amdc_assoc_ªq_‰ì
(
≠_admc_öfo
 *
≠_admc
,

817 
≠_admc_assoc_ªq
 *
admc_assoc_ªq
)

819 i‡(
admc_assoc_ªq
) {

823 
	`k‰ì
(
admc_assoc_ªq
);

833 
	}
}

835 
	$_≠_amdc_assoc_ªq_timeout
(
¨g
)

837 
≠_admc_assoc_ªq
 *
admc_assoc_ªq
;

838 
≠_admc_öfo
 *
≠_admc
;

840 
admc_assoc_ªq
 = (
≠_admc_assoc_ªq
 *)
¨g
;

841 
≠_admc
 = 
admc_assoc_ªq
->ap_admc;

843 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

845 
admc_assoc_ªq
,

846 
admc_assoc_ªq
->
‰ame_Àn
,

847 
≠_admc
->
assoc_ªq_˙t
);

849 
admc_assoc_ªq
->
a˘i⁄
 = 
AP_ADMC_ACT_TIMEOUT
;

850 
	`li°_dñ
(&
admc_assoc_ªq
->
li°
);

851 
≠_admc
->
assoc_ªq_˙t
--;

853 
	`_≠_amdc_assoc_ªq_‰ì
(
≠_admc
, 
admc_assoc_ªq
);

856 
	}
}

858 
ölöe
 
	$_≠_amdc_assoc_ªq_add
(
≠_admc_öfo
 *
≠_admc
,

859 
u8
 *
‰m
,

860 
u16
 
Àn
)

862 
õì80211_mgmt
 *
assocReq
;

863 
≠_admc_assoc_ªq
 *
admc_assoc_ªq
;

865 i‡(
Àn
 > 
ATH6KL_AP_ADMC_ASSOC_REQ_MAX_LEN
) {

867 
	`©h6kl_îr
("Not support soÜargeássoc_req frame\n");

871 
admc_assoc_ªq
 = 
	`kzÆloc
((
≠_admc_assoc_ªq
), 
GFP_KERNEL
);

872 i‡(!
admc_assoc_ªq
) {

873 
	`©h6kl_îr
("failedÅoálloc memory forádmc_assoc_req\n");

877 i‡(
≠_admc
->
assoc_ªq_˙t
)

878 
	`©h6kl_öfo
("Lastássoc_reqÇot yet finish!");

881 
admc_assoc_ªq
->
≠_admc
 =áp_admc;

882 
admc_assoc_ªq
->
‰ame_Àn
 = 
Àn
;

883 
	`mem˝y
(
admc_assoc_ªq
->
øw_‰ame
, 
‰m
, 
Àn
);

884 
assocReq
 = (
õì80211_mgmt
 *)(
admc_assoc_ªq
->
øw_‰ame
);

885 
admc_assoc_ªq
->
°a_mac
 = 
assocReq
->
ß
;

886 
admc_assoc_ªq
->
a˘i⁄
 = 
AP_ADMC_ACT_ACCPET
;

893 
	`öô_timî
(&
admc_assoc_ªq
->
ª˛aim_timî
);

894 
admc_assoc_ªq
->
ª˛aim_timî
.
fun˘i⁄
 = 
_≠_amdc_assoc_ªq_timeout
;

895 
admc_assoc_ªq
->
ª˛aim_timî
.
d©a
 = ()ádmc_assoc_req;

896 
	`mod_timî
(&
admc_assoc_ªq
->
ª˛aim_timî
,

897 
jiffõs
 + 
	`m£cs_to_jiffõs
(
≠_admc
->
assoc_ªq_timeout
));

899 
	`•ö_lock_bh
(&
≠_admc
->
assoc_ªq_lock
);

900 
	`li°_add_èû
(&
admc_assoc_ªq
->
li°
, &
≠_admc
->
assoc_ªq_li°
);

901 
≠_admc
->
assoc_ªq_˙t
++;

902 
	`•ö_u∆ock_bh
(&
≠_admc
->
assoc_ªq_lock
);

904 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

906 
Àn
,

907 
≠_admc
->
assoc_ªq_˙t
);

910 
	}
}

912 
ölöe
 
≠_admc_assoc_ªq
 *
	$_≠_amdc_assoc_ªq_£¨ch
(

913 
≠_admc_öfo
 *
≠_admc
,

914 
u8
 *
°a_mac
)

916 
≠_admc_assoc_ªq
 *
admc_assoc_ªq
, *
tmp
;

922 
admc_assoc_ªq
 = 
NULL
;

923 i‡(!
	`li°_em±y
(&
≠_admc
->
assoc_ªq_li°
)) {

924 
	`li°_f‹_óch_íåy_ß„
(
admc_assoc_ªq
,

925 
tmp
,

926 &
≠_admc
->
assoc_ªq_li°
,

927 
li°
) {

928 i‡(
	`memcmp
(
admc_assoc_ªq
->
°a_mac
,

929 
°a_mac
,

930 
ETH_ALEN
) == 0)

935 i‡(
admc_assoc_ªq
) {

936 
	`•ö_lock_bh
(&
≠_admc
->
assoc_ªq_lock
);

937 
	`dñ_timî
(&
admc_assoc_ªq
->
ª˛aim_timî
);

938 
	`li°_dñ
(&
admc_assoc_ªq
->
li°
);

939 
≠_admc
->
assoc_ªq_˙t
--;

940 
	`•ö_u∆ock_bh
(&
≠_admc
->
assoc_ªq_lock
);

943  
admc_assoc_ªq
;

944 
	}
}

946 
ölöe
 
	$_≠_amdc_assoc_ªq_Êush
(
≠_admc_öfo
 *
≠_admc
)

948 
≠_admc_assoc_ªq
 *
admc_assoc_ªq
, *
tmp
;

949 
‰ìd
 = 0;

951 
	`•ö_lock_bh
(&
≠_admc
->
assoc_ªq_lock
);

952 
	`li°_f‹_óch_íåy_ß„
(
admc_assoc_ªq
,

953 
tmp
,

954 &
≠_admc
->
assoc_ªq_li°
,

955 
li°
) {

956 
admc_assoc_ªq
->
a˘i⁄
 = 
AP_ADMC_ACT_FLUSH
;

957 
	`dñ_timî
(&
admc_assoc_ªq
->
ª˛aim_timî
);

958 
	`li°_dñ
(&
admc_assoc_ªq
->
li°
);

959 
≠_admc
->
assoc_ªq_˙t
--;

961 
	`_≠_amdc_assoc_ªq_‰ì
(
≠_admc
, 
admc_assoc_ªq
);

962 
‰ìd
++;

964 
	`•ö_u∆ock_bh
(&
≠_admc
->
assoc_ªq_lock
);

966 
	`WARN_ON
(
≠_admc
->
assoc_ªq_˙t
);

968 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

970 
‰ìd
);

973 
	}
}

975 
boﬁ
 
	$_≠_amdc_check
(
≠_admc_öfo
 *
≠_admc
,

976 
u8
 *
‰m
,

977 
u8
 
ªq_ty≥
,

978 
u8
 **
°a_mac
,

979 
u8
 *
ªas⁄_code
)

981 
õì80211_mgmt
 *
assocReq
 = (õì80211_mgmà*)
‰m
;

982 
boﬁ
 
ac˚±
 = 
åue
;

984 *
ªas⁄_code
 = 
WLAN_STATUS_SUCCESS
;

986 i‡(
≠_admc
->
admc_mode
 =
AP_ADMC_MODE_ACCEPT_ALWAYS
) {

988 *
°a_mac
 = 
assocReq
->
ß
;

990 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

992 
assocReq
->
ß
[0],ássocReq->sa[1],ássocReq->sa[2],

993 
assocReq
->
ß
[3],ássocReq->sa[4],ássocReq->sa[5]);

998  
ac˚±
;

999 
	}
}

1001 
≠_admc_öfo
 *
	$©h6kl_≠_admc_öô
(
©h6kl_vif
 *
vif
,

1002 
≠_admc_mode
 
mode
)

1004 
≠_admc_öfo
 *
≠_admc
;

1006 
≠_admc
 = 
	`kzÆloc
((
≠_admc_öfo
), 
GFP_KERNEL
);

1007 i‡(!
≠_admc
) {

1008 
	`©h6kl_îr
("failedÅoálloc memory foráp_admc\n");

1009  
NULL
;

1012 
≠_admc
->
vif
 = vif;

1013 
≠_admc
->
admc_mode
 = 
mode
;

1014 
≠_admc
->
assoc_ªq_timeout
 = 
ATH6KL_AP_ADMC_ASSOC_REQ_TIMEOUT
;

1015 
	`•ö_lock_öô
(&
≠_admc
->
assoc_ªq_lock
);

1016 
	`INIT_LIST_HEAD
(&
≠_admc
->
assoc_ªq_li°
);

1018 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

1020 
vif
->
fw_vif_idx
,

1021 
≠_admc
->
admc_mode
,

1022 
≠_admc
->
assoc_ªq_timeout
);

1024  
≠_admc
;

1025 
	}
}

1027 
	$©h6kl_≠_admc_deöô
(
©h6kl_vif
 *
vif
)

1029 
≠_admc_öfo
 *
≠_admc
 = 
vif
->
≠_admc_˘x
;

1031 i‡(
≠_admc
 !
NULL
) {

1032 
	`_≠_amdc_assoc_ªq_Êush
(
≠_admc
);

1033 
	`k‰ì
(
≠_admc
);

1036 
vif
->
≠_admc_˘x
 = 
NULL
;

1038 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

1040 
vif
->
fw_vif_idx
);

1043 
	}
}

1045 
	$©h6kl_≠_admc_°¨t
(
©h6kl_vif
 *
vif
)

1047 
≠_admc_öfo
 *
≠_admc
 = 
vif
->
≠_admc_˘x
;

1048 
boﬁ
 
íabÀd
 = 
Ál£
;

1049 
ªt
;

1051 i‡(!
≠_admc
)

1052  -
ENOENT
;

1054 i‡(
≠_admc
->
admc_mode
 !
AP_ADMC_MODE_DISABLE
)

1055 
íabÀd
 = 
åue
;

1057 
ªt
 = 
	`©h6kl_wmi_£t_assoc_ªq_ªœy_cmd
(
vif
->
¨
->
wmi
,

1058 
vif
->
fw_vif_idx
,

1059 
íabÀd
);

1061 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

1063 (
íabÀd
 ? "enable" : "disable"),

1064 
vif
->
fw_vif_idx
,

1065 
ªt
);

1067  
ªt
;

1068 
	}
}

1070 
	$©h6kl_≠_admc_°›
(
©h6kl_vif
 *
vif
)

1072 
≠_admc_öfo
 *
≠_admc
 = 
vif
->
≠_admc_˘x
;

1073 
ªt
;

1075 i‡(!
≠_admc
)

1076  -
ENOENT
;

1078 
	`_≠_amdc_assoc_ªq_Êush
(
≠_admc
);

1080 
ªt
 = 
	`©h6kl_wmi_£t_assoc_ªq_ªœy_cmd
(
vif
->
¨
->
wmi
,

1081 
vif
->
fw_vif_idx
,

1082 
Ál£
);

1083 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

1085 
vif
->
fw_vif_idx
,

1086 
ªt
);

1088  
ªt
;

1089 
	}
}

1091 
	$©h6kl_≠_admc_assoc_ªq
(
©h6kl_vif
 *
vif
,

1092 
u8
 *
assocReq
,

1093 
u16
 
assocReq_Àn
,

1094 
u8
 
ªq_ty≥
,

1095 
u8
 
fw_°©us
)

1097 
≠_admc_öfo
 *
≠_admc
 = 
vif
->
≠_admc_˘x
;

1098 
u8
 
ªas⁄_code
, *
°a_mac
 = 
NULL
;

1099 
boﬁ
 
ac˚±
;

1101 
	`BUG_ON
(!
≠_admc
);

1102 
	`BUG_ON
(
≠_admc
->
admc_mode
 =
AP_ADMC_MODE_DISABLE
);

1104 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

1105 
ac˚±
 = 
	`_≠_amdc_check
(
≠_admc
,

1106 
assocReq
,

1107 
ªq_ty≥
,

1108 &
°a_mac
,

1109 &
ªas⁄_code
);

1110 i‡(
	`©h6kl_wmi_£nd_assoc_ª•_cmd
(
vif
->
¨
->
wmi
,

1111 
vif
->
fw_vif_idx
,

1112 
ac˚±
,

1113 
ªas⁄_code
,

1114 
fw_°©us
,

1115 
°a_mac
,

1116 
ªq_ty≥
))

1117 
	`©h6kl_îr
("ap_admcássoResp fail (vif%d)\n",

1118 
vif
->
fw_vif_idx
);

1121 i‡((
fw_°©us
 =
WLAN_STATUS_SUCCESS
) &&

1122 
ac˚±
)

1123 
	`_≠_amdc_assoc_ªq_add
(
≠_admc
,

1124 
assocReq
,

1125 
assocReq_Àn
);

1127 
	`_≠_amdc_assoc_ªq_‰ì
(
≠_admc
, 
NULL
);

1129 
	`WARN_ON
(1);

1132 
	}
}

1134 
	$©h6kl_≠_admc_assoc_ªq_„tch
(
©h6kl_vif
 *
vif
,

1135 
wmi_c⁄√˘_evít
 *
ev
,

1136 
u8
 **
assocReq
,

1137 
u16
 *
assocReq_Àn
)

1139 
≠_admc_öfo
 *
≠_admc
 = 
vif
->
≠_admc_˘x
;

1140 
≠_admc_assoc_ªq
 *
admc_assoc_ªq
 = 
NULL
;

1141 
u8
 *
°a_mac
 = 
ev
->
u
.
≠_°a
.
mac_addr
;

1143 
	`BUG_ON
(!
≠_admc
);

1145 *
assocReq
 = 
NULL
;

1146 *
assocReq_Àn
 = 0;

1148 i‡(
≠_admc
->
admc_mode
 =
AP_ADMC_MODE_DISABLE
) {

1149 *
assocReq
 = 
ev
->
assoc_öfo
 +Év->
bóc⁄_õ_Àn
;

1150 *
assocReq_Àn
 = 
ev
->
assoc_ªq_Àn
;

1155 
admc_assoc_ªq
 = 
	`_≠_amdc_assoc_ªq_£¨ch
(
≠_admc
, 
°a_mac
);

1156 i‡(
admc_assoc_ªq
) {

1157 *
assocReq
 = 
admc_assoc_ªq
->
øw_‰ame
;

1158 *
assocReq_Àn
 = 
admc_assoc_ªq
->
‰ame_Àn
;

1160 
	`©h6kl_îr
("Noásoc_req found!");

1162 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

1164 *
assocReq
,

1165 
admc_assoc_ªq
,

1166 *
assocReq_Àn
);

1169 
	}
}

1171 
	$©h6kl_≠_admc_assoc_ªq_ªÀa£
(
©h6kl_vif
 *
vif
,

1172 
u8
 *
assocReq
)

1174 
≠_admc_öfo
 *
≠_admc
 = 
vif
->
≠_admc_˘x
;

1175 
≠_admc_assoc_ªq
 *
admc_assoc_ªq
;

1177 
	`BUG_ON
(!
≠_admc
);

1179 i‡(
≠_admc
->
admc_mode
 =
AP_ADMC_MODE_DISABLE
)

1182 
admc_assoc_ªq
 = 
	`c⁄èöî_of
(
assocReq
,

1183 
≠_admc_assoc_ªq
,

1184 
øw_‰ame
[0]);

1186 
	`©h6kl_dbg
(
ATH6KL_DBG_ADMC
,

1188 
assocReq
,

1189 
admc_assoc_ªq
);

1191 
	`_≠_amdc_assoc_ªq_‰ì
(
≠_admc
, 
admc_assoc_ªq
);

1194 
	}
}

1196 
	$©h6kl_≠_admc_dump
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
)

1198 
i
, 
Àn
 = 0;

1200 i‡(!
buf
)

1203 
i
 = 0; i < 
¨
->
vif_max
; i++) {

1204 
©h6kl_vif
 *
vif
;

1206 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

1207 i‡((
vif
) &&

1208 (
vif
->
nw_ty≥
 =
AP_NETWORK
)) {

1209 
≠_admc_öfo
 *
≠_admc
;

1211 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1213 
vif
->
fw_vif_idx
);

1215 
≠_admc
 = 
vif
->
≠_admc_˘x
;

1216 i‡(!
≠_admc
)

1219 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1221 
≠_admc
->
admc_mode
,

1222 
≠_admc
->
assoc_ªq_timeout
,

1223 
≠_admc
->
assoc_ªq_˙t
);

1227  
Àn
;

1228 
	}
}

1230 
	$©h6kl_≠_rc_öô
(
©h6kl_vif
 *
vif
)

1232 
≠_rc_öfo
 *
≠_rc
 = &
vif
->
≠_rc_öfo_˘x
;

1234 
≠_rc
->
mode
 = 
AP_RC_MODE_DISABLE
;

1235 
≠_rc
->
ch™
 = 0;

1236 
≠_rc
->
ch™_fixed
 = 0;

1238 
	`©h6kl_dbg
(
ATH6KL_DBG_AP_RC
,

1240 
≠_rc
->
mode
);

1243 
	}
}

1245 
u16
 
	$©h6kl_≠_rc_gë
(
©h6kl_vif
 *
vif
, 
u16
 
ch™_c⁄fig
)

1247 
≠_rc_öfo
 *
≠_rc
 = &
vif
->
≠_rc_öfo_˘x
;

1248 
≠_rc_mode
 
rc_mode
 = 
≠_rc
->
mode
;

1249 
u16
 
ch™_rc
 = 
ch™_c⁄fig
;

1256 i‡((
vif
->
√xt_ch™_ty≥
 =
ATH6KL_CHAN_TYPE_NONE
) &&

1257 (
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_P2P_GO
)) {

1258 
©h6kl_rc_ªp‹t
 
rc_ªp‹t
;

1259 
ªt
 = -1;

1261 
	`mem£t
(&
rc_ªp‹t
, 0, (
©h6kl_rc_ªp‹t
));

1262 i‡(
rc_mode
 !
AP_RC_MODE_DISABLE
)

1263 
ªt
 = 
	`©h6kl_p2p_rc_gë
(
vif
->
¨
, &
rc_ªp‹t
);

1265 i‡(
ªt
 == 0) {

1266 i‡(
rc_mode
 =
AP_RC_MODE_DISABLE
)

1267 
ch™_rc
 = 0;

1268 i‡(
rc_mode
 =
AP_RC_MODE_FIXED
)

1269 
ch™_rc
 = 
≠_rc
->
ch™_fixed
;

1270 i‡(
rc_mode
 =
AP_RC_MODE_2GALL
)

1271 
ch™_rc
 = 
rc_ªp‹t
.
rc_2g
;

1272 i‡(
rc_mode
 =
AP_RC_MODE_2GPOP
)

1273 
ch™_rc
 = 
rc_ªp‹t
.
rc_p2p_so
;

1274 i‡(
rc_mode
 =
AP_RC_MODE_5GALL
)

1275 
ch™_rc
 = 
rc_ªp‹t
.
rc_5g
;

1276 i‡(
rc_mode
 =
AP_RC_MODE_OVERALL
)

1277 
ch™_rc
 = 
rc_ªp‹t
.
rc_Æl
;

1278 i‡(
rc_mode
 =
AP_RC_MODE_2GNOLTE
)

1279 
ch™_rc
 = 
rc_ªp‹t
.
rc_2g_nﬁã
;

1280 i‡(
rc_mode
 =
AP_RC_MODE_5GNODFS
)

1281 
ch™_rc
 = 
rc_ªp‹t
.
rc_5g_nodfs
;

1282 i‡(
rc_mode
 =
AP_RC_MODE_OVERALLNOLTE
)

1283 
ch™_rc
 = 
rc_ªp‹t
.
rc_Æl_nﬁã
;

1284 i‡(
rc_mode
 =
AP_RC_MODE_OVERALLNODFS
)

1285 
ch™_rc
 = 
rc_ªp‹t
.
rc_Æl_nodfs
;

1286 i‡(
rc_mode
 =
AP_RC_MODE_OVERALLNOLTEDFS
)

1287 
ch™_rc
 = 
rc_ªp‹t
.
rc_Æl_nﬁãdfs
;

1289 
≠_rc
->
ch™
 = 
ch™_rc
;

1295 
ch™_rc
 = 
ch™_c⁄fig
;

1296 
≠_rc
->
ch™
 = 0;

1299 
ch™_rc
 = 
ch™_c⁄fig
;

1301 
	`©h6kl_dbg
(
ATH6KL_DBG_AP_RC
,

1303 
≠_rc
->
mode
,

1304 
≠_rc
->
ch™
,

1305 
≠_rc
->
ch™_fixed
,

1306 
ch™_c⁄fig
,

1307 
ch™_rc
);

1309  
ch™_rc
;

1310 
	}
}

1312 
s8
 
	$_≠_rc_buûd_sˇn_ch™
(
©h6kl
 *
¨
, 
u16
 *
ch™_li°
)

1314 
wùhy
 *wùhy = 
¨
->wiphy;

1315 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

1316 
õì80211_ch™√l
 *
ch™
;

1317 
s8
 
ch™_num
 = 0;

1318 
i
;

1321 
sb™d
 = 
wùhy
->
b™ds
[
NL80211_BAND_2GHZ
];

1322 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

1323 
ch™
 = &
sb™d
->
ch™√ls
[
i
];

1324 i‡(!(
ch™
->
Êags
 & 
IEEE80211_CHAN_DISABLED
))

1325 
ch™_li°
[
ch™_num
++] = 
ch™
->
˚¡î_‰eq
;

1328 
sb™d
 = 
wùhy
->
b™ds
[
NL80211_BAND_5GHZ
];

1329 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

1330 
ch™
 = &
sb™d
->
ch™√ls
[
i
];

1331 i‡(!(
ch™
->
Êags
 & 
IEEE80211_CHAN_DISABLED
))

1332 
ch™_li°
[
ch™_num
++] = 
ch™
->
˚¡î_‰eq
;

1335  
ch™_num
;

1336 
	}
}

1338 
	$©h6kl_≠_rc_upd©e
(
©h6kl_vif
 *
vif
)

1340 
	#_AP_RC_SCAN_TIMEOUT
 (2 * 
HZ
)

	)

1341 
©h6kl
 *
¨
 = 
vif
->ar;

1342 
©h6kl_vif
 *
vif_tmp
;

1343 
≠_rc_öfo
 *
≠_rc
 = &
vif
->
≠_rc_öfo_˘x
;

1344 
boﬁ
 
sˇn_⁄_goög
 = 
Ál£
;

1345 
i
, 
ªt
;

1347 i‡((
≠_rc
->
mode
 =
AP_RC_MODE_DISABLE
) ||

1348 (
≠_rc
->
mode
 =
AP_RC_MODE_FIXED
))

1351 i‡(
	`ã°_bô
(
DISABLE_SCAN
, &
¨
->
Êag
)) {

1352 
	`©h6kl_îr
("ap_rc scan is disabledÅemporarily\n");

1356 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

1357 
	`©h6kl_îr
("busy, couldn't getáccess\n");

1361 
	`©h6kl_dbg
(
ATH6KL_DBG_AP_RC
,

1368 
i
 = 0; i < 
¨
->
vif_max
; i++) {

1369 
vif_tmp
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

1370 i‡(
vif_tmp
 && 
	`ã°_bô
(
SCANNING
, &vif_tmp->
Êags
))

1371 
sˇn_⁄_goög
 = 
åue
;

1374 i‡(
sˇn_⁄_goög
 =
Ál£
) {

1375 
u16
 *
ch™√ls
;

1376 
s8
 
num_ch™
 = 0;

1377 
boﬁ
 
À·
;

1379 
ch™√ls
 = 
	`kzÆloc
(
WMI_MAX_CHANNELS
 * (
u16
), 
GFP_KERNEL
);

1380 i‡(
ch™√ls
) {

1381 
	`£t_bô
(
SCANNING
, &
vif
->
Êags
);

1383 i‡(!
vif
->
u§_bss_fûãr
) {

1384 
	`˛ór_bô
(
CLEAR_BSSFILTER_ON_BEACON
,

1385 &
vif
->
Êags
);

1386 
	`©h6kl_wmi_bssfûãr_cmd
(
¨
->
wmi
,

1387 
vif
->
fw_vif_idx
,

1388 
ALL_BSS_FILTER
,

1392 
num_ch™
 = 
	`_≠_rc_buûd_sˇn_ch™
(
¨
, 
ch™√ls
);

1393 
ªt
 = 
	`©h6kl_wmi_°¨tsˇn_cmd
(
¨
->
wmi
,

1394 
vif
->
fw_vif_idx
,

1395 
WMI_LONG_SCAN
,

1396 
åue
, 
Ál£
, 0, 0,

1397 
num_ch™
,

1398 
ch™√ls
);

1399 i‡(
ªt
)

1400 
	`©h6kl_îr
("wmi_startscan_cmd failed\n");

1402 
	`£t_bô
(
SCANNING_WAIT
, &
vif
->
Êags
);

1404 
	`©h6kl_p2p_rc_sˇn_°¨t
(
vif
, 
åue
);

1405 #ifde‡
USB_AUTO_SUSPEND


1406 
	`©h6kl_hif_auto_pm_dißbÀ
(
¨
);

1410 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(

1411 
¨
->
evít_wq
,

1412 !
	`ã°_bô
(
SCANNING_WAIT
, &
vif
->
Êags
),

1413 
_AP_RC_SCAN_TIMEOUT
);

1415 i‡(
À·
 == 0) {

1416 
	`˛ór_bô
(
SCANNING_WAIT
, &
vif
->
Êags
);

1417 
	`©h6kl_wmi_ab‹t_sˇn_cmd
(
¨
->
wmi
,

1418 
vif
->
fw_vif_idx
);

1419 
	`©h6kl_îr
("ap_rc scanÅimeout\n");

1422 i‡(
	`sig«l_≥ndög
(
cuºít
)) {

1423 
	`˛ór_bô
(
SCANNING_WAIT
, &
vif
->
Êags
);

1424 
	`©h6kl_îr
("ap_rcÅgtÇotÑespond\n");

1429 
	`˛ór_bô
(
SCANNING
, &
vif
->
Êags
);

1431 
	`k‰ì
(
ch™√ls
);

1433 
	`©h6kl_îr
("ap_rcálloc channel_list memory fail!\n");

1436 
	`up
(&
¨
->
£m
);

1438 
	`©h6kl_dbg
(
ATH6KL_DBG_AP_RC
,

1440 (
sˇn_⁄_goög
 ? "without" : "with"));

1443 #unde‡
_AP_RC_SCAN_TIMEOUT


1444 
	}
}

1446 
	$©h6kl_≠_rc_c⁄fig
(
©h6kl_vif
 *
vif
, 
mode_‹_‰eq
)

1448 
≠_rc_öfo
 *
≠_rc
 = &
vif
->
≠_rc_öfo_˘x
;

1450 i‡(
mode_‹_‰eq
 >
AP_RC_MODE_DISABLE
) {

1451 i‡(
mode_‹_‰eq
 <
AP_RC_MODE_MAX
) {

1452 
≠_rc
->
mode
 = 
mode_‹_‰eq
;

1453 
≠_rc
->
ch™
 = 0;

1454 
≠_rc
->
ch™_fixed
 = 0;

1456 
õì80211_ch™√l
 *
ch™
;

1458 
ch™
 = 
	`õì80211_gë_ch™√l
(
vif
->
¨
->
wùhy
,

1459 
mode_‹_‰eq
);

1460 i‡((
ch™
) &&

1461 !(
ch™
->
Êags
 & 
IEEE80211_CHAN_DISABLED
)) {

1462 
≠_rc
->
mode
 = 
AP_RC_MODE_FIXED
;

1463 
≠_rc
->
ch™
 = 0;

1464 
≠_rc
->
ch™_fixed
 = 
mode_‹_‰eq
;

1466 
	`©h6kl_îr
("setáp_rc set fixed freq %d fail\n",

1467 
mode_‹_‰eq
);

1469  -
EINVAL
;

1473 
	`©h6kl_dbg
(
ATH6KL_DBG_AP_RC
,

1475 
≠_rc
->
mode
,

1476 
≠_rc
->
ch™_fixed
);

1480 
	`©h6kl_îr
("setáp_rcÉrror! mode_or_freq %d\n",

1481 
mode_‹_‰eq
);

1483  -
EINVAL
;

1484 
	}
}

1486 
	$©h6kl_≠_ht_upd©e_õs
(
©h6kl_vif
 *
vif
)

1488 
ªt
 = 0;

1490 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
)

1494 i‡(
vif
->
√xt_ch™
 > 4000) {

1495 
u8
 
›mode
 = 
HT_INFO_OPMODE_PROT_PURE
;

1497 i‡(
vif
->
°a_no_ht_num
 > 0)

1498 
›mode
 = 
HT_INFO_OPMODE_PROT_MIXED
;

1502 
ªt
 = 
	`©h6kl_wmi_£t_ht_›_cmd
(
vif
->
¨
->
wmi
,

1503 
vif
->
fw_vif_idx
,

1505 
›mode
);

1508  
ªt
;

1509 
	}
}

1511 
ölöe
 
boﬁ
 
	$_≠_is_11b_øã
(
u8
 
øã
)

1513 
u8
 
øãs
[] = { 2, 4, 11, 22 };

1514 
u8
 
i
;

1516 
i
 = 0; i < 
	`ARRAY_SIZE
(
øãs
); i++)

1517 i‡(
øã
 =
øãs
[
i
])

1518  
åue
;

1520  
Ál£
;

1521 
	}
}

1523 
	$©h6kl_≠_bóc⁄_öfo
(
©h6kl_vif
 *
vif
, 
u8
 *
bóc⁄
, u8 
bóc⁄_Àn
)

1525 
u8
 *
põ
, *
≥õ
;

1526 
u8
 *
øãs_õ
 = 
NULL
;

1527 
u8
 *
ext_øãs_õ
 = 
NULL
;

1528 
õì80211_ht_ˇp
 *
ht_ˇp_õ
 = 
NULL
;

1529 
õì80211_ht_›î
 *
ht_›î_õ
 = 
NULL
;

1535 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
)

1539 
põ
 = 
bóc⁄
 + 8 + 2 + 2;

1540 
≥õ
 = 
bóc⁄
 + 
bóc⁄_Àn
;

1542 
põ
 < 
≥õ
) {

1543 *
põ
) {

1544 
WLAN_EID_SUPP_RATES
:

1545 i‡(
põ
[1])

1546 
øãs_õ
 = 
põ
;

1548 
WLAN_EID_EXT_SUPP_RATES
:

1549 i‡(
põ
[1])

1550 
ext_øãs_õ
 = 
põ
;

1552 
WLAN_EID_HT_CAPABILITY
:

1553 i‡(
põ
[1] >(
õì80211_ht_ˇp
))

1554 
ht_ˇp_õ
 =

1555 (
õì80211_ht_ˇp
 *)(
põ
 + 2);

1557 
WLAN_EID_HT_OPER
:

1558 i‡(
põ
[1] >(
õì80211_ht_›î
))

1559 
ht_›î_õ
 =

1560 (
õì80211_ht_›î
 *)(
põ
 + 2);

1563 
põ
 +=Öie[1] + 2;

1566 i‡(
ht_ˇp_õ
 && 
ht_›î_õ
) {

1567 
u16
 
ˇp_öfo
 = 
	`À16_to_˝u
(
ht_ˇp_õ
->cap_info);

1568 
u8
 
£c⁄d_ch™
 = (
ht_›î_õ
->
ht_∑øm
 &

1569 
IEEE80211_HT_PARAM_CHA_SEC_OFFSET
);

1570 
boﬁ
 
ext_ch™
 = 
Ál£
;

1572 
vif
->
ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_HT20
;

1574 i‡(
£c⁄d_ch™
 &&

1575 (
ˇp_öfo
 & 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
)) {

1576 
ext_ch™
 = 
åue
;

1577 i‡(
£c⁄d_ch™
 =
IEEE80211_HT_PARAM_CHA_SEC_ABOVE
)

1578 
vif
->
ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_HT40PLUS
;

1580 
vif
->
ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_HT40MINUS
;

1583 i‡(
vif
->
bss_ch
 > 5000) {

1584 i‡(
ext_ch™
)

1585 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_11NA_HT40
;

1587 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_11NA_HT20
;

1589 i‡(
ext_ch™
)

1590 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_11NG_HT40
;

1592 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_11NG_HT20
;

1595 
vif
->
ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_NONE
;

1597 i‡(
vif
->
bss_ch
 > 5000)

1598 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_11A
;

1600 
u8
 
i
, 
øã
;

1601 
boﬁ
 
b_øãs
, 
g_øãs
;

1603 
b_øãs
 = 
g_øãs
 = 
Ál£
;

1604 i‡(
øãs_õ
) {

1605 
i
 = 0; i < 
øãs_õ
[1]; i++) {

1606 
øã
 = 
øãs_õ
[2 + 
i
] & 0x7f;

1607 i‡(
	`_≠_is_11b_øã
(
øã
))

1608 
b_øãs
 = 
åue
;

1610 
g_øãs
 = 
åue
;

1613 i‡(
ext_øãs_õ
) {

1614 
i
 = 0; i < 
ext_øãs_õ
[1]; i++) {

1615 
øã
 = 
ext_øãs_õ
[2 + 
i
] & 0x7f;

1616 i‡(
	`_≠_is_11b_øã
(
øã
))

1617 
b_øãs
 = 
åue
;

1619 
g_øãs
 = 
åue
;

1623 i‡(
g_øãs
)

1624 i‡(
b_øãs
)

1625 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_11G
;

1627 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_11GONLY
;

1629 i‡(
b_øãs
)

1630 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_11B
;

1632 
	`©h6kl_îr
("Unknown APÖhymode\n");

1637 
	}
}

1639 
	$©h6kl_≠_ch_swôch
(
©h6kl_vif
 *
vif
)

1641 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
)

1644 #ifde‡
CE_SUPPORT


1646 
u32
 
‰eq
;

1647 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
;

1648 
‰eq
 = (
u32
)
	`À16_to_˝u
(
vif
->
bss_ch
);

1650 i‡(
vif
->
ch™_ty≥
 =
ATH6KL_CHAN_TYPE_NONE
)

1651 
ch™√l_ty≥
 = 
NL80211_CHAN_NO_HT
;

1652 i‡(
vif
->
ch™_ty≥
 =
ATH6KL_CHAN_TYPE_HT20
)

1653 
ch™√l_ty≥
 = 
NL80211_CHAN_HT20
;

1654 i‡(
vif
->
ch™_ty≥
 =
ATH6KL_CHAN_TYPE_HT40MINUS
)

1655 
ch™√l_ty≥
 = 
NL80211_CHAN_HT40MINUS
;

1656 i‡(
vif
->
ch™_ty≥
 =
ATH6KL_CHAN_TYPE_HT40PLUS
)

1657 
ch™√l_ty≥
 = 
NL80211_CHAN_HT40PLUS
;

1658 
	`cfg80211_cß_d⁄e_öfo
(
vif
->
ndev
, 
‰eq
, 
ch™√l_ty≥
, 1, 
GFP_ATOMIC
);

1669 #ifde‡
NL80211_CMD_OPER_CH_SWITCH_NOTIFY


1674 i‡((
vif
->
√xt_ch™
 !vif->
bss_ch
) ||

1675 (
vif
->
√xt_ch™_ty≥
 !vif->
ch™_ty≥
)) {

1676 i‡(
	`©h6kl_mod_debug_quúks
(
vif
->
¨
,

1677 
ATH6KL_MODULE_ENABLE_P2P_CHANMODE
)) {

1678 
∆80211_ch™√l_ty≥
 
ty≥
 = 
NL80211_CHAN_NO_HT
;

1679 #ifde‡
CFG80211_NEW_CHAN_DEFINITION


1680 
õì80211_ch™√l
 *
ch™
;

1681 
cfg80211_ch™_def
 
ch™def
;

1684 
	`©h6kl_öfo
("AP Channel switch from %d/%dÅo %d/%d\n",

1685 
vif
->
√xt_ch™
, vif->
√xt_ch™_ty≥
,

1686 
vif
->
bss_ch
, vif->
ch™_ty≥
);

1688 i‡(
vif
->
ch™_ty≥
 =
ATH6KL_CHAN_TYPE_NONE
)

1689 
ty≥
 = 
NL80211_CHAN_NO_HT
;

1690 i‡(
vif
->
ch™_ty≥
 =
ATH6KL_CHAN_TYPE_HT40PLUS
)

1691 
ty≥
 = 
NL80211_CHAN_HT40PLUS
;

1692 i‡(
vif
->
ch™_ty≥
 =
ATH6KL_CHAN_TYPE_HT40MINUS
)

1693 
ty≥
 = 
NL80211_CHAN_HT40MINUS
;

1694 i‡(
vif
->
ch™_ty≥
 =
ATH6KL_CHAN_TYPE_HT20
)

1695 
ty≥
 = 
NL80211_CHAN_HT20
;

1697 
	`WARN_ON
(1);

1703 #ifde‡
CFG80211_NEW_CHAN_DEFINITION


1704 
ch™
 = 
	`õì80211_gë_ch™√l
(
vif
->
¨
->
wùhy
,

1705 
vif
->
bss_ch
);

1706 i‡(
ch™
 =
NULL
) {

1707 
	`WARN_ON
(1);

1711 
	`cfg80211_ch™def_¸óã
(&
ch™def
, 
ch™
, 
ty≥
);

1712 
	`cfg80211_ch_swôch_nŸify
(
vif
->
ndev
,

1713 &
ch™def
);

1715 
	`cfg80211_ch_swôch_nŸify
(
vif
->
ndev
,

1716 
vif
->
bss_ch
,

1717 
ty≥
);

1723 
	}
}

	@ap.h

17 #i‚de‡
AP_H


18 
	#AP_H


	)

21 
	#ATH6KL_AP_KA_INTERVAL_DEFAULT
 (15 * 1000Ë

	)

22 
	#ATH6KL_AP_KA_INTERVAL_MIN
 (5 * 1000Ë

	)

23 
	#ATH6KL_AP_KA_RECLAIM_CYCLE
 (4Ë

	)

24 
	#ATH6KL_AP_KA_RECLAIM_TIME_MAX
 ((15 * 60Ë* 1000)

	)

27 
	#ATH6KL_AP_KA_RECLAIM_CYCLE_SCC
 (16Ë

	)

28 
	#ATH6KL_AP_KA_RECLAIM_CYCLE_MCC
 (19Ë

	)

31 
	#ATH6KL_AP_KA_PRELOAD_LEADTIME
 (2 * 1000)

	)

34 
	#ATH6KL_AP_KA_FLAGS_ENABLED
 
	`BIT
(0)

	)

35 
	#ATH6KL_AP_KA_FLAGS_BY_SUPP
 
	`BIT
(1Ë

	)

36 
	#ATH6KL_AP_KA_FLAGS_START
 
	`BIT
(2)

	)

37 
	#ATH6KL_AP_KA_FLAGS_PRELOAD_STAT
 
	`BIT
(3Ë

	)

38 
	#ATH6KL_AP_KA_FLAGS_CONFIG_BY_SUPP
 
	`BIT
(4)

	)

41 
	#AP_KA_ACTION_NONE
 (0)

	)

42 
	#AP_KA_ACTION_POLL
 (1)

	)

43 
	#AP_KA_ACTION_REMOVE
 (2)

	)

46 
	e≠_kì∑live_mode
 {

48 
	mAP_KA_MODE_DISABLE
 = 0,

51 
	mAP_KA_MODE_ENABLE
,

54 
	mAP_KA_MODE_BYSUPP
,

57 
	mAP_KA_MODE_CONFIG_BYSUPP
,

60 
	e≠_kì∑live_adju°
 {

61 
	mAP_KA_ADJ_ERROR
 = -1,

62 
	mAP_KA_ADJ_BASESET
 = 0,

63 
	mAP_KA_ADJ_ADJUST
,

66 
	s≠_kì∑live_öfo
 {

67 
©h6kl_vif
 *
	mvif
;

68 
u32
 
	mÊags
;

70 
timî_li°
 
	m≠_ka_timî
;

72 
u32
 
	m≠_ka_öãrvÆ
;

75 
u32
 
	m≠_ka_ª˛aim_cy˛e
;

78 
u32
 
	m≠_ka_ªmove_time
;

82 
	#ATH6KL_AP_ACL_MAX_NUM
 (10Ë

	)

84 
	#ATH6KL_AP_ACL_FLAGS_USED
 (1 << 0)

	)

87 
	e≠_a˛_mode
 {

88 
	mAP_ACL_MODE_DISABLE
 = 0,

89 
	mAP_ACL_MODE_ALLOW
,

90 
	mAP_ACL_MODE_DENY
,

93 
	s≠_a˛_íåy
 {

94 
u32
 
	mÊags
;

95 
u8
 
	mmac_addr
[
ETH_ALEN
];

98 
	s≠_a˛_öfo
 {

99 
©h6kl_vif
 *
	mvif
;

101 
≠_a˛_mode
 
	ma˛_mode
;

102 
≠_a˛_íåy
 
	ma˛_li°
[
ATH6KL_AP_ACL_MAX_NUM
];

108 
u8
 *
	mœ°_a˛_c⁄fig
;

112 
	#ATH6KL_AP_ADMC_ASSOC_REQ_MAX_LEN
 (1200)

	)

113 
	#ATH6KL_AP_ADMC_ASSOC_REQ_TIMEOUT
 (500Ë

	)

115 
	e≠_admc_mode
 {

116 
	mAP_ADMC_MODE_DISABLE
 = 0,

117 
	mAP_ADMC_MODE_ACCEPT_ALWAYS
 = 1,

120 
	e≠_admc_a˘i⁄
 {

121 
	mAP_ADMC_ACT_ACCPET
 = 0,

122 
	mAP_ADMC_ACT_TIMEOUT
 = 1,

123 
	mAP_ADMC_ACT_FLUSH
 = 2,

126 
	s≠_admc_assoc_ªq
 {

127 
li°_hód
 
	mli°
;

129 
≠_admc_öfo
 *
	m≠_admc
;

130 
timî_li°
 
	mª˛aim_timî
;

131 
u8
 
	møw_‰ame
[
ATH6KL_AP_ADMC_ASSOC_REQ_MAX_LEN
];

132 
u16
 
	m‰ame_Àn
;

133 
u8
 *
	m°a_mac
;

134 
≠_admc_a˘i⁄
 
	ma˘i⁄
;

137 
	s≠_admc_öfo
 {

138 
©h6kl_vif
 *
	mvif
;

140 
≠_admc_mode
 
	madmc_mode
;

141 
•ölock_t
 
	massoc_ªq_lock
;

142 
li°_hód
 
	massoc_ªq_li°
;

143 
	massoc_ªq_timeout
;

145 
u32
 
	massoc_ªq_˙t
;

153 
	#WLAN_EID_HT_OPER
 (61)

	)

155 
	sõì80211_ht_›î
 {

156 
u8
 
	m¥im¨y_ch™
;

157 
u8
 
	mht_∑øm
;

158 
__À16
 
	m›î©i⁄_mode
;

159 
__À16
 
	m°bc_∑øm
;

160 
u8
 
	mbasic_£t
[16];

161 } 
	g__∑cked
;

164 
	e≠_rc_mode
 {

165 
	mAP_RC_MODE_DISABLE
 = 0,

166 
	mAP_RC_MODE_FIXED
 = 1,

167 
	mAP_RC_MODE_2GALL
 = 2,

168 
	mAP_RC_MODE_2GPOP
 = 3,

169 
	mAP_RC_MODE_5GALL
 = 4,

170 
	mAP_RC_MODE_OVERALL
 = 5,

171 
	mAP_RC_MODE_2GNOLTE
 = 6,

172 
	mAP_RC_MODE_5GNODFS
 = 7,

173 
	mAP_RC_MODE_OVERALLNOLTE
 = 8,

174 
	mAP_RC_MODE_OVERALLNODFS
 = 9,

175 
	mAP_RC_MODE_OVERALLNOLTEDFS
 = 10,

178 
	mAP_RC_MODE_MAX
 = 
AP_RC_MODE_OVERALLNOLTEDFS
,

181 
	s≠_rc_öfo
 {

182 
≠_rc_mode
 
	mmode
;

183 
u16
 
	mch™
;

184 
u16
 
	mch™_fixed
;

187 
≠_kì∑live_öfo
 *
©h6kl_≠_kì∑live_öô
(
©h6kl_vif
 *
vif
,

188 
≠_kì∑live_mode
 
mode
);

189 
©h6kl_≠_kì∑live_deöô
(
©h6kl_vif
 *
vif
);

190 
©h6kl_≠_kì∑live_°¨t
(
©h6kl_vif
 *
vif
);

191 
©h6kl_≠_kì∑live_°›
(
©h6kl_vif
 *
vif
);

192 
©h6kl_≠_kì∑live_c⁄fig
(
©h6kl_vif
 *
vif
,

193 
u32
 
≠_ka_öãrvÆ
,

194 
u32
 
≠_ka_ª˛aim_cy˛e
);

195 
©h6kl_≠_kì∑live_c⁄fig_by_suµ
(
©h6kl_vif
 *
vif
,

196 
u16
 
öa˘ive_time
);

197 
u32
 
©h6kl_≠_kì∑live_gë_öa˘ive_time
(
©h6kl_vif
 *
vif
, 
u8
 *
mac
);

198 
boﬁ
 
©h6kl_≠_kì∑live_by_suµ
(
©h6kl_vif
 *
vif
);

199 
≠_a˛_öfo
 *
©h6kl_≠_a˛_öô
(
©h6kl_vif
 *
vif
);

200 
©h6kl_≠_a˛_deöô
(
©h6kl_vif
 *
vif
);

201 
©h6kl_≠_a˛_°¨t
(
©h6kl_vif
 *
vif
);

202 
©h6kl_≠_a˛_°›
(
©h6kl_vif
 *
vif
);

203 
©h6kl_≠_a˛_c⁄fig_pﬁicy
(
©h6kl_vif
 *
vif
,

204 
≠_a˛_mode
 
mode
);

205 
©h6kl_≠_a˛_c⁄fig_mac_li°
(
©h6kl_vif
 *
vif
,

206 
u8
 *
mac_addr
, 
boﬁ
 
ªmoved
);

207 
©h6kl_≠_a˛_c⁄fig_mac_li°_ª£t
(
©h6kl_vif
 *
vif
);

208 
©h6kl_≠_a˛_dump
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
);

209 
≠_admc_öfo
 *
©h6kl_≠_admc_öô
(
©h6kl_vif
 *
vif
,

210 
≠_admc_mode
 
mode
);

211 
©h6kl_≠_admc_deöô
(
©h6kl_vif
 *
vif
);

212 
©h6kl_≠_admc_°¨t
(
©h6kl_vif
 *
vif
);

213 
©h6kl_≠_admc_°›
(
©h6kl_vif
 *
vif
);

214 
©h6kl_≠_admc_assoc_ªq
(
©h6kl_vif
 *
vif
,

215 
u8
 *
assocReq
,

216 
u16
 
assocReq_Àn
,

217 
u8
 
ªq_ty≥
,

218 
u8
 
fw_°©us
);

219 
©h6kl_≠_admc_assoc_ªq_„tch
(
©h6kl_vif
 *
vif
,

220 
wmi_c⁄√˘_evít
 *
ev
,

221 
u8
 **
assocReq
,

222 
u16
 *
assocReq_Àn
);

223 
©h6kl_≠_admc_assoc_ªq_ªÀa£
(
©h6kl_vif
 *
vif
,

224 
u8
 *
assocReq
);

225 
©h6kl_≠_admc_dump
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
);

226 
©h6kl_≠_rc_öô
(
©h6kl_vif
 *
vif
);

227 
u16
 
©h6kl_≠_rc_gë
(
©h6kl_vif
 *
vif
, u16 
ch™_c⁄fig
);

228 
©h6kl_≠_rc_upd©e
(
©h6kl_vif
 *
vif
);

229 
©h6kl_≠_rc_c⁄fig
(
©h6kl_vif
 *
vif
, 
mode_‹_‰eq
);

230 
©h6kl_≠_ht_upd©e_õs
(
©h6kl_vif
 *
vif
);

231 
©h6kl_≠_bóc⁄_öfo
(
©h6kl_vif
 *
vif
, 
u8
 *
bóc⁄
, u8 
bóc⁄_Àn
);

232 
©h6kl_≠_ch_swôch
(
©h6kl_vif
 *
vif
);

	@ath6kl_sdio.mod.c

1 
	~<löux/moduÀ.h
>

2 
	~<löux/vîmagic.h
>

3 
	~<löux/compûî.h
>

5 
MODULE_INFO
(
vîmagic
, 
VERMAGIC_STRING
);

7 
moduÀ
 
__this_moduÀ


8 
__©åibuã__
((
£˘i⁄
(".gnu.linkonce.this_module"))) = {

9 .
«me
 = 
KBUILD_MODNAME
,

10 .
	göô
 = 
öô_moduÀ
,

11 #ifde‡
CONFIG_MODULE_UNLOAD


12 .
	gexô
 = 
˛ónup_moduÀ
,

14 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

17 c⁄° 
modvîsi⁄_öfo
 
	g____vîsi⁄s
[]

18 
__u£d


19 
__©åibuã__
((
£˘i⁄
("__versions"))) = {

194 c⁄° 
	g__moduÀ_dïíds
[]

195 
__u£d


196 
__©åibuã__
((
£˘i⁄
(".modinfo"))) =

199 
MODULE_ALIAS
("sdio:c*v0271d0300*");

200 
MODULE_ALIAS
("sdio:c*v0271d0301*");

201 
MODULE_ALIAS
("sdio:c*v0271d0400*");

202 
MODULE_ALIAS
("sdio:c*v0271d0401*");

203 
MODULE_ALIAS
("sdio:c*v0271d0402*");

204 
MODULE_ALIAS
("sdio:c*v0271d0D00*");

205 
MODULE_ALIAS
("sdio:c*v0271d0D01*");

207 
MODULE_INFO
(
§cvîsi⁄
, "F4F34C2578AEBB37C3B5237");

	@ath6kl_usb.mod.c

1 
	~<löux/moduÀ.h
>

2 
	~<löux/vîmagic.h
>

3 
	~<löux/compûî.h
>

5 
MODULE_INFO
(
vîmagic
, 
VERMAGIC_STRING
);

7 
moduÀ
 
__this_moduÀ


8 
__©åibuã__
((
£˘i⁄
(".gnu.linkonce.this_module"))) = {

9 .
«me
 = 
KBUILD_MODNAME
,

10 .
	göô
 = 
öô_moduÀ
,

11 #ifde‡
CONFIG_MODULE_UNLOAD


12 .
	gexô
 = 
˛ónup_moduÀ
,

14 .
	g¨ch
 = 
MODULE_ARCH_INIT
,

17 c⁄° 
modvîsi⁄_öfo
 
	g____vîsi⁄s
[]

18 
__u£d


19 
__©åibuã__
((
£˘i⁄
("__versions"))) = {

182 c⁄° 
	g__moduÀ_dïíds
[]

183 
__u£d


184 
__©åibuã__
((
£˘i⁄
(".modinfo"))) =

187 
MODULE_ALIAS
("usb:v0CF3p9375d*dc*dsc*dp*ic*isc*ip*");

188 
MODULE_ALIAS
("usb:v0CF3p9374d*dc*dsc*dp*ic*isc*ip*");

189 
MODULE_ALIAS
("usb:v0CF3p9372d*dc*dsc*dp*ic*isc*ip*");

191 
MODULE_INFO
(
§cvîsi⁄
, "05E87B34E8EA791F53DB270");

	@ath_netlink.c

16 
	~"löux/if.h
"

17 
	~"löux/sockë.h
"

18 
	~"löux/√éök.h
"

19 
	~<√t/sock.h
>

21 
	~<löux/öô.h
>

22 
	~<löux/skbuff.h
>

23 
	~<löux/√tdevi˚.h
>

24 
	~<löux/ˇche.h
>

25 
	~<löux/¥oc_fs.h
>

26 
	~<löux/moduÀ.h
>

27 
	~"©h_√éök.h
"

28 
	~"πèpi.h
"

29 
	~"c‹e.h
"

30 
	~"debug.h
"

31 
	#MAX_PAYLOAD
 1024

	)

33 
sock
 *
	g©h_∆_sock
;

34 
u32
 
	ggpid
;

36 
	$©h_√éök_£nd
(*
evít_d©a
, 
u32
 
evít_d©Æí
)

38 
sk_buff
 *
skb
 = 
NULL
;

39 
∆msghdr
 *
∆h
;

41 
skb
 = 
	`∆msg_√w
(
	`NLMSG_SPACE
(
evít_d©Æí
), 
GFP_ATOMIC
);

42 i‡(!
skb
) {

43 
	`©h6kl_îr
("%s: Nÿmem‹y,\n", 
__func__
);

47 
∆h
 = 
	`∆msg_put
(
skb
, 
gpid
, 0, 0 , 
	`NLMSG_SPACE
(
evít_d©Æí
), 0);

48 i‡(!
∆h
) {

49 
	`©h6kl_îr
("%s:Çlmsg_put(ËÁûed\n", 
__func__
);

53 
	`mem˝y
(
	`NLMSG_DATA
(
∆h
), 
evít_d©a
, 
evít_d©Æí
);

55 #ifde‡
ATH6KL_SUPPORT_NETLINK_KERNEL3_7


56 
	`NETLINK_CB
(
skb
).
p‹tid
 = 0;

58 
	`NETLINK_CB
(
skb
).
pid
 = 0;

60 
	`NETLINK_CB
(
skb
).
d°_group
 = 0;

61 
	`√éök_uniˇ°
(
©h_∆_sock
, 
skb
, 
gpid
, 
MSG_DONTWAIT
);

62 
	}
}

66 
	$©h_√éök_ª∂y
(
pid
, 
£q
, *
∑ylﬂd
)

69 
	}
}

72 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


73 
	$©h_√éök_ª˚ive
(
sk_buff
 *
__skb
, 
Àn
)

75 
	$©h_√éök_ª˚ive
(
sk_buff
 *
__skb
)

78 
sk_buff
 *
skb
 = 
NULL
;

79 
∆msghdr
 *
∆h
 = 
NULL
;

80 
u_öt8_t
 *
d©a
 = 
NULL
;

81 
u_öt32_t
 
uid
, 
pid
, 
£q
;

83 
skb
 = 
	`skb_gë
(
__skb
);

84 i‡(
skb
) {

86 
∆h
 = (
∆msghdr
 *)
skb
->
d©a
;

87 
pid
 = 
	`NETLINK_CREDS
(
skb
)->pid;

88 
pid
 = 
∆h
->
∆msg_pid
;

89 
uid
 = 
	`NETLINK_CREDS
(
skb
)->uid;

90 
£q
 = 
∆h
->
∆msg_£q
;

91 
d©a
 = 
	`NLMSG_DATA
(
∆h
);

93 
gpid
 = 
pid
;

94 
	`©h_√éök_ª∂y
(
pid
, 
£q
, 
d©a
);

95 
	`πtm_issue_ªque°
(
d©a
, 
	`∆msg_Àn
(
∆h
));

96 
	`k‰ì_skb
(
skb
);

99 
	}
}

101 
	$©h_√éök_öô
()

103 #ifde‡
ATH6KL_SUPPORT_NETLINK_KERNEL3_7


104 
√éök_kî√l_cfg
 
√éök_cfg
;

106 i‡(
©h_∆_sock
 =
NULL
) {

107 
√éök_cfg
.
groups
 = 1;

108 
√éök_cfg
.
öput
 = 
©h_√éök_ª˚ive
;

109 
√éök_cfg
.
cb_muãx
 = 
NULL
;

110 
√éök_cfg
.
böd
 = 
NULL
;

111 
√éök_cfg
.
Êags
 = 0;

113 
©h_∆_sock
 = (
sock
 *)
	`√éök_kî√l_¸óã
(

114 &
öô_√t
, 
NETLINK_ATH_EVENT
,

115 &
√éök_cfg
);

116 i‡(
©h_∆_sock
 =
NULL
) {

117 
	`©h6kl_îr
("%†NëLök Cª©êFaûed\n", 
__func__
);

118  -
ENODEV
;

121 #ñi‡
	`deföed
(
ATH6KL_SUPPORT_NETLINK_KERNEL3_6
)

122 
√éök_kî√l_cfg
 
√éök_cfg
;

124 i‡(
©h_∆_sock
 =
NULL
) {

125 
√éök_cfg
.
groups
 = 1;

126 
√éök_cfg
.
öput
 = 
©h_√éök_ª˚ive
;

127 
√éök_cfg
.
cb_muãx
 = 
NULL
;

128 
√éök_cfg
.
böd
 = 
NULL
;

130 
©h_∆_sock
 = (
sock
 *)
	`√éök_kî√l_¸óã
(

131 &
öô_√t
, 
NETLINK_ATH_EVENT
,

132 
THIS_MODULE
,

133 &
√éök_cfg
);

134 i‡(
©h_∆_sock
 =
NULL
) {

135 
	`©h6kl_îr
("%†NëLök Cª©êFaûed\n", 
__func__
);

136  -
ENODEV
;

140 i‡(
©h_∆_sock
 =
NULL
) {

141 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


142 
©h_∆_sock
 = (
sock
 *)
	`√éök_kî√l_¸óã
(

143 
NETLINK_ATH_EVENT
,

144 1, &
©h_√éök_ª˚ive
, 
NULL
,

145 
THIS_MODULE
);

147 
©h_∆_sock
 = (
sock
 *)
	`√éök_kî√l_¸óã
(

148 &
öô_√t
, 
NETLINK_ATH_EVENT
,

149 1, &
©h_√éök_ª˚ive
, 
NULL
,

150 
THIS_MODULE
);

152 i‡(
©h_∆_sock
 =
NULL
) {

153 
	`©h6kl_îr
("%†NëLök Cª©êFaûed\n", 
__func__
);

154  -
ENODEV
;

160 
	}
}

162 
	$©h_√éök_‰ì
()

164 i‡(
©h_∆_sock
) {

165 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


166 
	`sock_ªÀa£
(
©h_∆_sock
->
sk_sockë
);

168 
	`√éök_kî√l_ªÀa£
(
©h_∆_sock
);

170 
©h_∆_sock
 = 
NULL
;

174 
	}
}

	@ath_netlink.h

17 #i‚de‡
_ATH_NETLINK_H_


18 
	#_ATH_NETLINK_H_


	)

19 
	~"löux/if.h
"

20 
	~"löux/sockë.h
"

21 
	~"löux/√éök.h
"

22 
	#NETLINK_ATH_EVENT
 (
NETLINK_GENERIC
 + 4)

	)

24 
	#MAC_ADDR_LEN
 6

	)

26 
©h_√éök_öô
();

27 
©h_√éök_dñëe
();

28 
©h_√éök_£nd
(*
evít_d©a
, 
u32
 
evít_d©Æí
);

29 
©h_√éök_‰ì
();

	@bmi.c

17 
	~"c‹e.h
"

18 
	~"hif-›s.h
"

19 
	~"èrgë.h
"

20 
	~"debug.h
"

22 
	$©h6kl_bmi_d⁄e
(
©h6kl
 *
¨
)

24 
ªt
;

25 
u32
 
cid
 = 
BMI_DONE
;

26 
u32
 
ídünBuf32
;

28 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

29 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
, "bmi done skipped\n");

33 
¨
->
bmi
.
d⁄e_£¡
 = 
åue
;

34 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

36 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
, (
u8
 *)&
ídünBuf32
, (endianBuf32));

37 i‡(
ªt
) {

38 
	`©h6kl_îr
("U«bÀÅÿ£nd bmòd⁄e: %d\n", 
ªt
);

39  
ªt
;

43 
	}
}

45 
	$©h6kl_bmi_gë_èrgë_öfo
(
©h6kl
 *
¨
,

46 
©h6kl_bmi_èrgë_öfo
 *
èrg_öfo
)

48 
ªt
;

49 
u32
 
cid
 = 
BMI_GET_TARGET_INFO
;

50 
u32
 
ídünBuf32
;

52 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

53 
	`©h6kl_îr
("bmòd⁄ê£¡áÃódy, cmd %d dißŒowed\n", 
cid
);

54  -
EACCES
;

56 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

57 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
, (
u8
 *)&
ídünBuf32
, (endianBuf32));

58 i‡(
ªt
) {

59 
	`©h6kl_îr
("U«bÀÅÿ£nd gëÅ¨gë info: %d\n", 
ªt
);

60  
ªt
;

63 i‡(
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_USB
) {

64 
ªt
 = 
	`©h6kl_hif_bmi_ªad
(
¨
, (
u8
 *)
èrg_öfo
,

65 (*
èrg_öfo
));

67 
ªt
 = 
	`©h6kl_hif_bmi_ªad
(
¨
, (
u8
 *)&
èrg_öfo
->
vîsi⁄
,

68 (
èrg_öfo
->
vîsi⁄
));

71 i‡(
ªt
) {

72 
	`©h6kl_îr
("U«bÀÅÿªcvÅ¨gë info: %d\n", 
ªt
);

73  
ªt
;

76 i‡(
	`À32_to_˝u
(
èrg_öfo
->
vîsi⁄
Ë=
TARGET_VERSION_SENTINAL
) {

78 
ªt
 = 
	`©h6kl_hif_bmi_ªad
(
¨
,

79 (
u8
 *)&
èrg_öfo
->
byã_cou¡
,

80 (
èrg_öfo
->
byã_cou¡
));

81 i‡(
ªt
) {

82 
	`©h6kl_îr
("unableÅoÑeadÅarget info byte count: %d\n",

83 
ªt
);

84  
ªt
;

91 i‡(
	`À32_to_˝u
(
èrg_öfo
->
byã_cou¡
) != (*targ_info)) {

92 
	`WARN_ON
(1);

93  -
EINVAL
;

97 
ªt
 = 
	`©h6kl_hif_bmi_ªad
(
¨
,

98 ((
u8
 *)
èrg_öfo
) +

99 (
èrg_öfo
->
byã_cou¡
),

100 (*
èrg_öfo
) -

101 (
èrg_öfo
->
byã_cou¡
));

103 i‡(
ªt
) {

104 
	`©h6kl_îr
("UnableÅoÑeadÅarget info (%d bytes): %d\n",

105 
	`À32_to_˝u
(
èrg_öfo
->
byã_cou¡
), 
ªt
);

106  
ªt
;

110 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
, "target info (ver: 0x%xÅype: 0x%x)\n",

111 
	`À32_to_˝u
(
èrg_öfo
->
vîsi⁄
),Üe32_to_˝u—¨g_öfo->
ty≥
));

114 
	}
}

116 
	$©h6kl_bmi_ªad
(
©h6kl
 *
¨
, 
u32
 
addr
, 
u8
 *
buf
, u32 
Àn
)

118 
u32
 
cid
 = 
BMI_READ_MEMORY
;

119 
ªt
;

120 
u32
 
off£t
;

121 
u32
 
Àn_ªmaö
, 
rx_Àn
;

122 
u16
 
size
;

123 
u32
 
ídünBuf32
;

125 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

126 
	`©h6kl_îr
("bmòd⁄ê£¡áÃódy, cmd %d dißŒowed\n", 
cid
);

127  -
EACCES
;

130 
size
 = 
¨
->
bmi
.
max_d©a_size
 + (
cid
Ë+ (
addr
Ë+ (
Àn
);

131 i‡(
size
 > 
¨
->
bmi
.
max_cmd_size
) {

132 
	`WARN_ON
(1);

133  -
EINVAL
;

135 
	`mem£t
(
¨
->
bmi
.
cmd_buf
, 0, 
size
);

137 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
,

139 
addr
, 
Àn
);

141 
Àn_ªmaö
 = 
Àn
;

143 
Àn_ªmaö
) {

144 
rx_Àn
 = (
Àn_ªmaö
 < 
¨
->
bmi
.
max_d©a_size
) ?

145 
Àn_ªmaö
 : 
¨
->
bmi
.
max_d©a_size
;

146 
off£t
 = 0;

147 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

148 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
,

149 (
ídünBuf32
));

150 
off£t
 +(
cid
);

151 
ídünBuf32
 = 
	`˝u_to_À32
(
addr
);

152 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
,

153 (
ídünBuf32
));

154 
off£t
 +(
addr
);

155 
ídünBuf32
 = 
	`˝u_to_À32
(
rx_Àn
);

156 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
,

157 (
ídünBuf32
));

158 
off£t
 +(
Àn
);

160 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
,ár->
bmi
.
cmd_buf
, 
off£t
);

161 i‡(
ªt
) {

162 
	`©h6kl_îr
("UnableÅo writeÅoÅhe device: %d\n",

163 
ªt
);

164  
ªt
;

166 
ªt
 = 
	`©h6kl_hif_bmi_ªad
(
¨
,ár->
bmi
.
cmd_buf
, 
rx_Àn
);

167 i‡(
ªt
) {

168 
	`©h6kl_îr
("UnableÅoÑead fromÅhe device: %d\n",

169 
ªt
);

170  
ªt
;

172 
	`mem˝y
(&
buf
[
Àn
 - 
Àn_ªmaö
], 
¨
->
bmi
.
cmd_buf
, 
rx_Àn
);

173 
Àn_ªmaö
 -
rx_Àn
; 
addr
 +=Ñx_len;

176 #ifde‡
__BIG_ENDIAN


177 i‡(
Àn
 == 4) {

178 
u32
 
buf_tmp
;

180 
	`mem˝y
(&
buf_tmp
, 
buf
, (
u32
));

181 
buf_tmp
 = 
	`À32_to_˝u
(buf_tmp);

182 
	`mem˝y
(
buf
, &
buf_tmp
, (
u32
));

187 
	}
}

189 
	$©h6kl_bmi_wrôe
(
©h6kl
 *
¨
, 
u32
 
addr
, 
u8
 *
buf
, u32 
Àn
)

191 
u32
 
cid
 = 
BMI_WRITE_MEMORY
;

192 
ªt
;

193 
u32
 
off£t
;

194 
u32
 
Àn_ªmaö
, 
tx_Àn
;

195 c⁄° 
u32
 
hódî
 = (
cid
Ë+ (
addr
Ë+ (
Àn
);

196 
u8
 
Æig√d_buf
[400];

197 
u8
 *
§c
;

198 
u32
 
ídünBuf32
;

200 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

201 
	`©h6kl_îr
("bmòd⁄ê£¡áÃódy, cmd %d dißŒowed\n", 
cid
);

202  -
EACCES
;

205 i‡((
¨
->
bmi
.
max_d©a_size
 + 
hódî
Ë>ár->bmi.
max_cmd_size
) {

206 
	`WARN_ON
(1);

207  -
EINVAL
;

210 i‡(
	`WARN_ON
(
¨
->
bmi
.
max_d©a_size
 > (
Æig√d_buf
)))

211  -
E2BIG
;

213 
	`mem£t
(
¨
->
bmi
.
cmd_buf
, 0,ár->bmi.
max_d©a_size
 + 
hódî
);

215 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
,

216 "bmòwrôêmem‹y:áddr: 0x%x,Üí: %d\n", 
addr
, 
Àn
);

218 
Àn_ªmaö
 = 
Àn
;

219 
Àn_ªmaö
) {

220 
§c
 = &
buf
[
Àn
 - 
Àn_ªmaö
];

222 i‡(
Àn_ªmaö
 < (
¨
->
bmi
.
max_d©a_size
 - 
hódî
)) {

223 i‡(
Àn_ªmaö
 & 3) {

225 
Àn_ªmaö
 =Üen_remain +

226 (4 - (
Àn_ªmaö
 & 3));

227 
	`mem˝y
(
Æig√d_buf
, 
§c
, 
Àn_ªmaö
);

228 
§c
 = 
Æig√d_buf
;

230 
tx_Àn
 = 
Àn_ªmaö
;

232 
tx_Àn
 = (
¨
->
bmi
.
max_d©a_size
 - 
hódî
);

235 
off£t
 = 0;

236 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

237 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
,

238 (
ídünBuf32
));

239 
off£t
 +(
cid
);

240 
ídünBuf32
 = 
	`˝u_to_À32
(
addr
);

241 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
,

242 (
ídünBuf32
));

243 
off£t
 +(
addr
);

244 
ídünBuf32
 = 
	`˝u_to_À32
(
tx_Àn
);

245 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
,

246 (
ídünBuf32
));

247 
off£t
 +(
tx_Àn
);

248 i‡(
Àn
 == 4) {

249 
ídünBuf32
 = 
	`˝u_to_À32
(*((
u32
 *)
§c
));

250 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
,

251 (
ídünBuf32
));

253 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), 
§c
, 
tx_Àn
);

255 
off£t
 +
tx_Àn
;

257 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
,ár->
bmi
.
cmd_buf
, 
off£t
);

258 i‡(
ªt
) {

259 
	`©h6kl_îr
("UnableÅo writeÅoÅhe device: %d\n",

260 
ªt
);

261  
ªt
;

263 
Àn_ªmaö
 -
tx_Àn
; 
addr
 +=Åx_len;

267 
	}
}

269 
	$©h6kl_bmi_execuã
(
©h6kl
 *
¨
, 
u32
 
addr
, u32 *
∑øm
)

271 
u32
 
cid
 = 
BMI_EXECUTE
;

272 
ªt
;

273 
u32
 
off£t
;

274 
u16
 
size
;

275 
u32
 
ídünBuf32
;

277 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

278 
	`©h6kl_îr
("bmòd⁄ê£¡áÃódy, cmd %d dißŒowed\n", 
cid
);

279  -
EACCES
;

282 
size
 = (
cid
Ë+ (
addr
Ë+ (
∑øm
);

283 i‡(
size
 > 
¨
->
bmi
.
max_cmd_size
) {

284 
	`WARN_ON
(1);

285  -
EINVAL
;

287 
	`mem£t
(
¨
->
bmi
.
cmd_buf
, 0, 
size
);

289 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
, "bmiÉxecute:áddr: 0x%x,Öaram: %d)\n",

290 
addr
, *
∑øm
);

292 
off£t
 = 0;

293 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

294 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

295 
off£t
 +(
cid
);

296 
ídünBuf32
 = 
	`˝u_to_À32
(
addr
);

297 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

298 
off£t
 +(
addr
);

299 
ídünBuf32
 = 
	`˝u_to_À32
(*
∑øm
);

300 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

301 
off£t
 +(*
∑øm
);

303 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
,ár->
bmi
.
cmd_buf
, 
off£t
);

304 i‡(
ªt
) {

305 
	`©h6kl_îr
("U«bÀÅÿwrôêtÿthêdevi˚: %d\n", 
ªt
);

306  
ªt
;

309 
ªt
 = 
	`©h6kl_hif_bmi_ªad
(
¨
,ár->
bmi
.
cmd_buf
, (*
∑øm
));

310 i‡(
ªt
) {

311 
	`©h6kl_îr
("U«bÀÅÿªad fromÅhêdevi˚: %d\n", 
ªt
);

312  
ªt
;

315 
	`mem˝y
(
∑øm
, 
¨
->
bmi
.
cmd_buf
, (*param));

317 #ifde‡
__BIG_ENDIAN


319 
u32
 
buf_tmp
;

321 
	`mem˝y
(&
buf_tmp
, 
∑øm
, (
u32
));

322 
buf_tmp
 = 
	`À32_to_˝u
(buf_tmp);

323 
	`mem˝y
(
∑øm
, &
buf_tmp
, (
u32
));

328 
	}
}

330 
	$©h6kl_bmi_£t_≠p_°¨t
(
©h6kl
 *
¨
, 
u32
 
addr
)

332 
u32
 
cid
 = 
BMI_SET_APP_START
;

333 
ªt
;

334 
u32
 
off£t
;

335 
u16
 
size
;

336 
u32
 
ídünBuf32
;

338 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

339 
	`©h6kl_îr
("bmòd⁄ê£¡áÃódy, cmd %d dißŒowed\n", 
cid
);

340  -
EACCES
;

343 
size
 = (
cid
Ë+ (
addr
);

344 i‡(
size
 > 
¨
->
bmi
.
max_cmd_size
) {

345 
	`WARN_ON
(1);

346  -
EINVAL
;

348 
	`mem£t
(
¨
->
bmi
.
cmd_buf
, 0, 
size
);

350 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
, "bmò£à≠∞°¨t:áddr: 0x%x\n", 
addr
);

352 
off£t
 = 0;

353 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

354 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

355 
off£t
 +(
cid
);

356 
ídünBuf32
 = 
	`˝u_to_À32
(
addr
);

357 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

358 
off£t
 +(
addr
);

360 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
,ár->
bmi
.
cmd_buf
, 
off£t
);

361 i‡(
ªt
) {

362 
	`©h6kl_îr
("U«bÀÅÿwrôêtÿthêdevi˚: %d\n", 
ªt
);

363  
ªt
;

367 
	}
}

369 
	$©h6kl_bmi_ªg_ªad
(
©h6kl
 *
¨
, 
u32
 
addr
, u32 *
∑øm
)

371 
u32
 
cid
 = 
BMI_READ_SOC_REGISTER
;

372 
ªt
;

373 
u32
 
off£t
;

374 
u16
 
size
;

375 
u32
 
ídünBuf32
;

377 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

378 
	`©h6kl_îr
("bmòd⁄ê£¡áÃódy, cmd %d dißŒowed\n", 
cid
);

379  -
EACCES
;

382 
size
 = (
cid
Ë+ (
addr
);

383 i‡(
size
 > 
¨
->
bmi
.
max_cmd_size
) {

384 
	`WARN_ON
(1);

385  -
EINVAL
;

387 
	`mem£t
(
¨
->
bmi
.
cmd_buf
, 0, 
size
);

389 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
, "bmòªad SOCÑeg:áddr: 0x%x\n", 
addr
);

391 
off£t
 = 0;

392 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

393 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

394 
off£t
 +(
cid
);

395 
ídünBuf32
 = 
	`˝u_to_À32
(
addr
);

396 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

397 
off£t
 +(
addr
);

399 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
,ár->
bmi
.
cmd_buf
, 
off£t
);

400 i‡(
ªt
) {

401 
	`©h6kl_îr
("U«bÀÅÿwrôêtÿthêdevi˚: %d\n", 
ªt
);

402  
ªt
;

405 
ªt
 = 
	`©h6kl_hif_bmi_ªad
(
¨
,ár->
bmi
.
cmd_buf
, (*
∑øm
));

406 i‡(
ªt
) {

407 
	`©h6kl_îr
("U«bÀÅÿªad fromÅhêdevi˚: %d\n", 
ªt
);

408  
ªt
;

410 
	`mem˝y
(
∑øm
, 
¨
->
bmi
.
cmd_buf
, (*param));

412 #ifde‡
__BIG_ENDIAN


414 
u32
 
buf_tmp
;

416 
	`mem˝y
(&
buf_tmp
, 
∑øm
, (
u32
));

417 
buf_tmp
 = 
	`À32_to_˝u
(buf_tmp);

418 
	`mem˝y
(
∑øm
, &
buf_tmp
, (
u32
));

423 
	}
}

425 
	$©h6kl_bmi_ªg_wrôe
(
©h6kl
 *
¨
, 
u32
 
addr
, u32 
∑øm
)

427 
u32
 
cid
 = 
BMI_WRITE_SOC_REGISTER
;

428 
ªt
;

429 
u32
 
off£t
;

430 
u16
 
size
;

431 
u32
 
ídünBuf32
;

433 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

434 
	`©h6kl_îr
("bmòd⁄ê£¡áÃódy, cmd %d dißŒowed\n", 
cid
);

435  -
EACCES
;

438 
size
 = (
cid
Ë+ (
addr
Ë+ (
∑øm
);

439 i‡(
size
 > 
¨
->
bmi
.
max_cmd_size
) {

440 
	`WARN_ON
(1);

441  -
EINVAL
;

443 
	`mem£t
(
¨
->
bmi
.
cmd_buf
, 0, 
size
);

445 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
,

447 
addr
, 
∑øm
);

449 
off£t
 = 0;

450 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

451 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

452 
off£t
 +(
cid
);

453 
ídünBuf32
 = 
	`˝u_to_À32
(
addr
);

454 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

455 
off£t
 +(
addr
);

456 
ídünBuf32
 = 
	`˝u_to_À32
(
∑øm
);

457 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

458 
off£t
 +(
∑øm
);

460 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
,ár->
bmi
.
cmd_buf
, 
off£t
);

461 i‡(
ªt
) {

462 
	`©h6kl_îr
("U«bÀÅÿwrôêtÿthêdevi˚: %d\n", 
ªt
);

463  
ªt
;

467 
	}
}

469 
	$©h6kl_bmi_lz_d©a
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
u32
 
Àn
)

471 
u32
 
cid
 = 
BMI_LZ_DATA
;

472 
ªt
;

473 
u32
 
off£t
;

474 
u32
 
Àn_ªmaö
, 
tx_Àn
;

475 c⁄° 
u32
 
hódî
 = (
cid
Ë+ (
Àn
);

476 
u16
 
size
;

477 
u32
 
ídünBuf32
;

479 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

480 
	`©h6kl_îr
("bmòd⁄ê£¡áÃódy, cmd %d dißŒowed\n", 
cid
);

481  -
EACCES
;

484 
size
 = 
¨
->
bmi
.
max_d©a_size
 + 
hódî
;

485 i‡(
size
 > 
¨
->
bmi
.
max_cmd_size
) {

486 
	`WARN_ON
(1);

487  -
EINVAL
;

489 
	`mem£t
(
¨
->
bmi
.
cmd_buf
, 0, 
size
);

491 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
, "bmi send LZ data:Üen: %d)\n",

492 
Àn
);

494 
Àn_ªmaö
 = 
Àn
;

495 
Àn_ªmaö
) {

496 
tx_Àn
 = (
Àn_ªmaö
 < (
¨
->
bmi
.
max_d©a_size
 - 
hódî
)) ?

497 
Àn_ªmaö
 : (
¨
->
bmi
.
max_d©a_size
 - 
hódî
);

499 
off£t
 = 0;

500 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

501 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
,

502 (
ídünBuf32
));

503 
off£t
 +(
cid
);

504 
ídünBuf32
 = 
	`˝u_to_À32
(
tx_Àn
);

505 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
,

506 (
ídünBuf32
));

507 
off£t
 +(
tx_Àn
);

508 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
buf
[
Àn
 - 
Àn_ªmaö
],

509 
tx_Àn
);

510 
off£t
 +
tx_Àn
;

512 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
,ár->
bmi
.
cmd_buf
, 
off£t
);

513 i‡(
ªt
) {

514 
	`©h6kl_îr
("UnableÅo writeÅoÅhe device: %d\n",

515 
ªt
);

516  
ªt
;

519 
Àn_ªmaö
 -
tx_Àn
;

523 
	}
}

525 
	$©h6kl_bmi_lz_°ªam_°¨t
(
©h6kl
 *
¨
, 
u32
 
addr
)

527 
u32
 
cid
 = 
BMI_LZ_STREAM_START
;

528 
ªt
;

529 
u32
 
off£t
;

530 
u16
 
size
;

531 
u32
 
ídünBuf32
;

533 i‡(
¨
->
bmi
.
d⁄e_£¡
) {

534 
	`©h6kl_îr
("bmòd⁄ê£¡áÃódy, cmd %d dißŒowed\n", 
cid
);

535  -
EACCES
;

538 
size
 = (
cid
Ë+ (
addr
);

539 i‡(
size
 > 
¨
->
bmi
.
max_cmd_size
) {

540 
	`WARN_ON
(1);

541  -
EINVAL
;

543 
	`mem£t
(
¨
->
bmi
.
cmd_buf
, 0, 
size
);

545 
	`©h6kl_dbg
(
ATH6KL_DBG_BMI
,

547 
addr
);

549 
off£t
 = 0;

550 
ídünBuf32
 = 
	`˝u_to_À32
(
cid
);

551 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

552 
off£t
 +(
cid
);

553 
ídünBuf32
 = 
	`˝u_to_À32
(
addr
);

554 
	`mem˝y
(&(
¨
->
bmi
.
cmd_buf
[
off£t
]), &
ídünBuf32
, (endianBuf32));

555 
off£t
 +(
addr
);

557 
ªt
 = 
	`©h6kl_hif_bmi_wrôe
(
¨
,ár->
bmi
.
cmd_buf
, 
off£t
);

558 i‡(
ªt
) {

559 
	`©h6kl_îr
("UnableÅo start LZ streamÅoÅhe device: %d\n",

560 
ªt
);

561  
ªt
;

565 
	}
}

567 
	$©h6kl_bmi_Á°_dow∆ﬂd
(
©h6kl
 *
¨
, 
u32
 
addr
, 
u8
 *
buf
, u32 
Àn
)

569 
ªt
;

570 
u32
 
œ°_w‹d
 = 0;

571 
u32
 
œ°_w‹d_off£t
 = 
Àn
 & ~0x3;

572 
u32
 
u«lig√d_byãs
 = 
Àn
 & 0x3;

574 
ªt
 = 
	`©h6kl_bmi_lz_°ªam_°¨t
(
¨
, 
addr
);

575 i‡(
ªt
)

576  
ªt
;

578 i‡(
u«lig√d_byãs
) {

580 
	`mem˝y
(&
œ°_w‹d
, &
buf
[
œ°_w‹d_off£t
], 
u«lig√d_byãs
);

583 
ªt
 = 
	`©h6kl_bmi_lz_d©a
(
¨
, 
buf
, 
œ°_w‹d_off£t
);

584 i‡(
ªt
)

585  
ªt
;

587 i‡(
u«lig√d_byãs
)

588 
ªt
 = 
	`©h6kl_bmi_lz_d©a
(
¨
, (
u8
 *)&
œ°_w‹d
, 4);

590 i‡(!
ªt
) {

593 
ªt
 = 
	`©h6kl_bmi_lz_°ªam_°¨t
(
¨
, 0x00);

595  
ªt
;

596 
	}
}

598 
	$©h6kl_bmi_ª£t
(
©h6kl
 *
¨
)

600 
¨
->
bmi
.
d⁄e_£¡
 = 
Ál£
;

601 
	}
}

603 
	$©h6kl_bmi_öô
(
©h6kl
 *
¨
)

605 i‡(
	`WARN_ON
(
¨
->
bmi
.
max_d©a_size
 == 0))

606  -
EINVAL
;

609 
¨
->
bmi
.
max_cmd_size
 =ár->bmi.
max_d©a_size
 + ((
u32
) * 3);

611 
¨
->
bmi
.
cmd_buf
 = 
	`kzÆloc
◊r->bmi.
max_cmd_size
, 
GFP_ATOMIC
);

612 i‡(!
¨
->
bmi
.
cmd_buf
)

613  -
ENOMEM
;

616 
	}
}

618 
	$©h6kl_bmi_˛ónup
(
©h6kl
 *
¨
)

620 
	`k‰ì
(
¨
->
bmi
.
cmd_buf
);

621 
¨
->
bmi
.
cmd_buf
 = 
NULL
;

622 
	}
}

	@bmi.h

17 #i‚de‡
BMI_H


18 
	#BMI_H


	)

49 
	#BMI_NO_COMMAND
 0

	)

51 
	#BMI_DONE
 1

	)

59 
	#BMI_READ_MEMORY
 2

	)

70 
	#BMI_WRITE_MEMORY
 3

	)

81 
	#BMI_EXECUTE
 4

	)

92 
	#BMI_SET_APP_START
 5

	)

101 
	#BMI_READ_SOC_REGISTER
 6

	)

111 
	#BMI_WRITE_SOC_REGISTER
 7

	)

122 
	#BMI_GET_TARGET_ID
 8

	)

123 
	#BMI_GET_TARGET_INFO
 8

	)

135 
	#TARGET_VERSION_SENTINAL
 0xffffffff

	)

136 
	#TARGET_TYPE_AR6003
 3

	)

137 
	#TARGET_TYPE_AR6004
 5

	)

138 
	#TARGET_TYPE_AR6006
 6

	)

146 
	#TARGET_VIF_MAX
 (4)

	)

153 
	#TARGET_SUBTYPE_DUAL
 
	`BIT
(0)

	)

154 
	#TARGET_SUBTYPE_2SS
 
	`BIT
(1)

	)

155 
	#TARGET_SUBTYPE_HT40
 
	`BIT
(2)

	)

157 
	#TARGET_SUBTYPE_HT20_1SS_SING_BAND
 (0)

	)

158 
	#TARGET_SUBTYPE_HT40_1SS_SING_BAND
 (
TARGET_SUBTYPE_HT40
)

	)

159 
	#TARGET_SUBTYPE_HT20_1SS_DUAL_BAND
 (
TARGET_SUBTYPE_DUAL
)

	)

160 
	#TARGET_SUBTYPE_HT40_1SS_DUAL_BAND
 (
TARGET_SUBTYPE_HT40
 | \

161 
TARGET_SUBTYPE_DUAL
)

	)

162 
	#TARGET_SUBTYPE_HT20_2SS_SING_BAND
 (
TARGET_SUBTYPE_2SS
)

	)

163 
	#TARGET_SUBTYPE_HT40_2SS_SING_BAND
 (
TARGET_SUBTYPE_HT40
 | \

164 
TARGET_SUBTYPE_2SS
)

	)

165 
	#TARGET_SUBTYPE_HT20_2SS_DUAL_BAND
 (
TARGET_SUBTYPE_DUAL
 | \

166 
TARGET_SUBTYPE_2SS
)

	)

167 
	#TARGET_SUBTYPE_HT40_2SS_DUAL_BAND
 (
TARGET_SUBTYPE_HT40
 | \

168 
TARGET_SUBTYPE_DUAL
 | \

169 
TARGET_SUBTYPE_2SS
)

	)

171 
	#BMI_ROMPATCH_INSTALL
 9

	)

185 
	#BMI_ROMPATCH_UNINSTALL
 10

	)

196 
	#BMI_ROMPATCH_ACTIVATE
 11

	)

207 
	#BMI_ROMPATCH_DEACTIVATE
 12

	)

219 
	#BMI_LZ_STREAM_START
 13

	)

233 
	#BMI_LZ_DATA
 14

	)

249 
	#BMI_COMMUNICATION_TIMEOUT
 1000

	)

251 
	g©h6kl
;

252 
	s©h6kl_bmi_èrgë_öfo
 {

253 
__À32
 
	mbyã_cou¡
;

254 
__À32
 
	mvîsi⁄
;

255 
__À32
 
	mty≥
;

256 } 
	g__∑cked
;

258 
©h6kl_bmi_öô
(
©h6kl
 *
¨
);

259 
©h6kl_bmi_˛ónup
(
©h6kl
 *
¨
);

260 
©h6kl_bmi_ª£t
(
©h6kl
 *
¨
);

262 
©h6kl_bmi_d⁄e
(
©h6kl
 *
¨
);

263 
©h6kl_bmi_gë_èrgë_öfo
(
©h6kl
 *
¨
,

264 
©h6kl_bmi_èrgë_öfo
 *
èrg_öfo
);

265 
©h6kl_bmi_ªad
(
©h6kl
 *
¨
, 
u32
 
addr
, 
u8
 *
buf
, u32 
Àn
);

266 
©h6kl_bmi_wrôe
(
©h6kl
 *
¨
, 
u32
 
addr
, 
u8
 *
buf
, u32 
Àn
);

267 
©h6kl_bmi_execuã
(
©h6kl
 *
¨
,

268 
u32
 
addr
, u32 *
∑øm
);

269 
©h6kl_bmi_£t_≠p_°¨t
(
©h6kl
 *
¨
,

270 
u32
 
addr
);

271 
©h6kl_bmi_ªg_ªad
(
©h6kl
 *
¨
, 
u32
 
addr
, u32 *
∑øm
);

272 
©h6kl_bmi_ªg_wrôe
(
©h6kl
 *
¨
, 
u32
 
addr
, u32 
∑øm
);

273 
©h6kl_bmi_lz_d©a
(
©h6kl
 *
¨
,

274 
u8
 *
buf
, 
u32
 
Àn
);

275 
©h6kl_bmi_lz_°ªam_°¨t
(
©h6kl
 *
¨
,

276 
u32
 
addr
);

277 
©h6kl_bmi_Á°_dow∆ﬂd
(
©h6kl
 *
¨
,

278 
u32
 
addr
, 
u8
 *
buf
, u32 
Àn
);

	@cfg80211.c

17 
	~<löux/moduÀ∑øm.h
>

18 #i‚de‡
CE_OLD_KERNEL_SUPPORT_2_6_23


19 
	~<löux/gpio.h
>

21 
	~<löux/öãºu±.h
>

22 
	~<löux/time.h
>

23 
	~<löux/öëdevi˚.h
>

24 
	~"c‹e.h
"

25 
	~"cfg80211.h
"

26 
	~"debug.h
"

27 
	~"hif-›s.h
"

28 
	~"ã°mode.h
"

29 
	~"cfg80211_btc€x.h
"

30 #ifde‡
ATH6KL_DIAGNOSTIC


31 
	~"dügno£.h
"

33 
	~"pm.h
"

34 
	~"πtm.h
"

36 
	gdebug_quúks
 = 
ATH6KL_MODULE_DEF_DEBUG_QUIRKS
;

39 
moduÀ_∑øm
(
debug_quúks
, 
uöt
, 0644);

41 
	#RATETAB_ENT
(
_øã
, 
_øãid
, 
_Êags
Ë{ \

	)

42 .
	gbôøã
 = (
_øã
), \

43 .
	gÊags
 = (
_Êags
), \

44 .
	ghw_vÆue
 = (
_øãid
), \

47 
	#CHAN2G
(
_ch™√l
, 
_‰eq
, 
_Êags
Ë{ \

	)

48 .
	gb™d
 = 
IEEE80211_BAND_2GHZ
, \

49 .
	ghw_vÆue
 = (
_ch™√l
), \

50 .
	g˚¡î_‰eq
 = (
_‰eq
), \

51 .
	gÊags
 = (
_Êags
), \

52 .
	gmax_™ã¬a_gaö
 = 0, \

53 .
	gmax_powî
 = 30, \

56 
	#CHAN5G
(
_ch™√l
, 
_Êags
Ë{ \

	)

57 .
	gb™d
 = 
IEEE80211_BAND_5GHZ
, \

58 .
	ghw_vÆue
 = (
_ch™√l
), \

59 .
	g˚¡î_‰eq
 = 5000 + (5 * (
_ch™√l
)), \

60 .
	gÊags
 = (
_Êags
), \

61 .
	gmax_™ã¬a_gaö
 = 0, \

62 .
	gmax_powî
 = 30, \

65 
õì80211_øã
 
	g©h6kl_øãs
[] = {

66 
RATETAB_ENT
(10, 0x1, 0),

67 
RATETAB_ENT
(20, 0x2, 0),

68 
RATETAB_ENT
(55, 0x4, 0),

69 
RATETAB_ENT
(110, 0x8, 0),

70 
RATETAB_ENT
(60, 0x10, 0),

71 
RATETAB_ENT
(90, 0x20, 0),

72 
RATETAB_ENT
(120, 0x40, 0),

73 
RATETAB_ENT
(180, 0x80, 0),

74 
RATETAB_ENT
(240, 0x100, 0),

75 
RATETAB_ENT
(360, 0x200, 0),

76 
RATETAB_ENT
(480, 0x400, 0),

77 
RATETAB_ENT
(540, 0x800, 0),

80 
	#©h6kl_a_øãs
 (
©h6kl_øãs
 + 4)

	)

81 
	#©h6kl_a_øãs_size
 8

	)

82 
	#©h6kl_g_øãs
 (
©h6kl_øãs
 + 0)

	)

83 
	#©h6kl_g_øãs_size
 12

	)

84 
	#©h6kl_b_øãs_size
 4

	)

87 c⁄° 
u8
 
	gup_to_ac
[] = {

88 
WMM_AC_BE
,

89 
WMM_AC_BK
,

90 
WMM_AC_BK
,

91 
WMM_AC_BE
,

92 
WMM_AC_VI
,

93 
WMM_AC_VI
,

94 
WMM_AC_VO
,

95 
WMM_AC_VO
,

98 
õì80211_ch™√l
 
	g©h6kl_2ghz_ch™√ls
[] = {

99 
CHAN2G
(1, 2412, 0),

100 
CHAN2G
(2, 2417, 0),

101 
CHAN2G
(3, 2422, 0),

102 
CHAN2G
(4, 2427, 0),

103 
CHAN2G
(5, 2432, 0),

104 
CHAN2G
(6, 2437, 0),

105 
CHAN2G
(7, 2442, 0),

106 
CHAN2G
(8, 2447, 0),

107 
CHAN2G
(9, 2452, 0),

108 
CHAN2G
(10, 2457, 0),

109 
CHAN2G
(11, 2462, 0),

110 
CHAN2G
(12, 2467, 0),

111 
CHAN2G
(13, 2472, 0),

112 
CHAN2G
(14, 2484, 0),

115 
õì80211_ch™√l
 
	g©h6kl_5ghz_a_ch™√ls
[] = {

116 
CHAN5G
(34, 0), CHAN5G(36, 0),

117 
CHAN5G
(38, 0), CHAN5G(40, 0),

118 
CHAN5G
(42, 0), CHAN5G(44, 0),

119 
CHAN5G
(46, 0), CHAN5G(48, 0),

120 
CHAN5G
(52, 0), CHAN5G(56, 0),

121 
CHAN5G
(60, 0), CHAN5G(64, 0),

122 
CHAN5G
(100, 0), CHAN5G(104, 0),

123 
CHAN5G
(108, 0), CHAN5G(112, 0),

124 
CHAN5G
(116, 0), CHAN5G(120, 0),

125 
CHAN5G
(124, 0), CHAN5G(128, 0),

126 
CHAN5G
(132, 0), CHAN5G(136, 0),

127 
CHAN5G
(140, 0), CHAN5G(144, 0),

128 
CHAN5G
(149, 0), CHAN5G(153, 0),

129 
CHAN5G
(157, 0), CHAN5G(161, 0),

130 
CHAN5G
(165, 0),

133 
õì80211_suµ‹ãd_b™d
 
	g©h6kl_b™d_2ghz
 = {

134 .
n_ch™√ls
 = 
ARRAY_SIZE
(
©h6kl_2ghz_ch™√ls
),

135 .
	gch™√ls
 = 
©h6kl_2ghz_ch™√ls
,

136 .
	gn_bôøãs
 = 
©h6kl_g_øãs_size
,

137 .
	gbôøãs
 = 
©h6kl_g_øãs
,

138 .
	ght_ˇp
 = {

139 .
ht_suµ‹ãd
 = 
åue
,

140 .
	gˇp
 = 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 |

141 
IEEE80211_HT_CAP_SGI_20
 |

142 
IEEE80211_HT_CAP_SGI_40
 |

143 
IEEE80211_HT_CAP_TX_STBC
 |

145 
IEEE80211_HT_CAP_SM_PS
,

146 .
	gampdu_Á˘‹
 = 
IEEE80211_HT_MAX_AMPDU_64K
,

147 .
	gampdu_dísôy
 = 
IEEE80211_HT_MPDU_DENSITY_8
,

148 .
	gmcs
 = {

149 .
rx_mask
 = { 0xff, 0xff, 0, 0, 0, 0, 0, 0, 0, 0},

154 
õì80211_suµ‹ãd_b™d
 
	g©h6kl_b™d_5ghz
 = {

155 .
n_ch™√ls
 = 
ARRAY_SIZE
(
©h6kl_5ghz_a_ch™√ls
),

156 .
	gch™√ls
 = 
©h6kl_5ghz_a_ch™√ls
,

157 .
	gn_bôøãs
 = 
©h6kl_a_øãs_size
,

158 .
	gbôøãs
 = 
©h6kl_a_øãs
,

159 .
	ght_ˇp
 = {

160 .
ht_suµ‹ãd
 = 
åue
,

161 .
	gˇp
 = 
IEEE80211_HT_CAP_SUP_WIDTH_20_40
 |

162 
IEEE80211_HT_CAP_SGI_20
 |

163 
IEEE80211_HT_CAP_SGI_40
 |

164 
IEEE80211_HT_CAP_TX_STBC
 |

166 
IEEE80211_HT_CAP_SM_PS
,

167 .
	gampdu_Á˘‹
 = 
IEEE80211_HT_MAX_AMPDU_64K
,

168 .
	gampdu_dísôy
 = 
IEEE80211_HT_MPDU_DENSITY_8
,

169 .
	gmcs
 = {

170 .
rx_mask
 = { 0xff, 0xff, 0, 0, 0, 0, 0, 0, 0, 0},

176 c⁄° 
õì80211_iÁ˚_limô
 
	g©h6kl_limôs_°a_≠
[] = {

178 .
max
 = 1,

179 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
),

182 .
	gmax
 = 1,

183 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_AP
),

187 
õì80211_iÁ˚_combö©i⁄


188 
	g©h6kl_iÁ˚_combö©i⁄s_°a_≠
[] = {

190 .
num_dif„ª¡_ch™√ls
 = 1,

191 .
	gmax_öãrÁ˚s
 = 2,

192 .
	glimôs
 = 
©h6kl_limôs_°a_≠
,

193 .
	gn_limôs
 = 
ARRAY_SIZE
(
©h6kl_limôs_°a_≠
),

198 c⁄° 
õì80211_iÁ˚_limô
 
	g©h6kl_limôs_p2p_c⁄cuºít2
[] = {

200 .
max
 = 2,

201 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
),

204 .
	gmax
 = 1,

205 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

206 
BIT
(
NL80211_IFTYPE_P2P_GO
),

210 
õì80211_iÁ˚_combö©i⁄


211 
	g©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít2
[] = {

213 .
num_dif„ª¡_ch™√ls
 = 1,

214 .
	gmax_öãrÁ˚s
 = 2,

215 .
	glimôs
 = 
©h6kl_limôs_p2p_c⁄cuºít2
,

216 .
	gn_limôs
 = 
ARRAY_SIZE
(
©h6kl_limôs_p2p_c⁄cuºít2
),

221 c⁄° 
õì80211_iÁ˚_limô
 
	g©h6kl_limôs_p2p_c⁄cuºít3
[] = {

223 .
max
 = 3,

224 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
),

227 .
	gmax
 = 1,

228 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

229 
BIT
(
NL80211_IFTYPE_P2P_GO
),

233 
õì80211_iÁ˚_combö©i⁄


234 
	g©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít3
[] = {

236 .
num_dif„ª¡_ch™√ls
 = 1,

237 .
	gmax_öãrÁ˚s
 = 3,

238 .
	glimôs
 = 
©h6kl_limôs_p2p_c⁄cuºít3
,

239 .
	gn_limôs
 = 
ARRAY_SIZE
(
©h6kl_limôs_p2p_c⁄cuºít3
),

244 c⁄° 
õì80211_iÁ˚_limô
 
	g©h6kl_limôs_p2p_c⁄cuºít4
[] = {

246 .
max
 = 4,

247 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
),

250 .
	gmax
 = 2,

251 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

252 
BIT
(
NL80211_IFTYPE_P2P_GO
),

256 
õì80211_iÁ˚_combö©i⁄


257 
	g©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít4
[] = {

259 .
num_dif„ª¡_ch™√ls
 = 1,

260 .
	gmax_öãrÁ˚s
 = 4,

261 .
	glimôs
 = 
©h6kl_limôs_p2p_c⁄cuºít4
,

262 .
	gn_limôs
 = 
ARRAY_SIZE
(
©h6kl_limôs_p2p_c⁄cuºít4
),

267 c⁄° 
õì80211_iÁ˚_limô
 
	g©h6kl_limôs_p2p_c⁄cuºít4_1
[] = {

269 .
max
 = 3,

270 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_STATION
),

273 .
	gmax
 = 1,

274 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_AP
),

277 .
	gmax
 = 1,

278 .
	gty≥s
 = 
BIT
(
NL80211_IFTYPE_P2P_CLIENT
) |

279 
BIT
(
NL80211_IFTYPE_P2P_GO
),

283 
õì80211_iÁ˚_combö©i⁄


284 
	g©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít4_1
[] = {

286 .
num_dif„ª¡_ch™√ls
 = 1,

287 .
	gmax_öãrÁ˚s
 = 4,

288 .
	glimôs
 = 
©h6kl_limôs_p2p_c⁄cuºít4_1
,

289 .
	gn_limôs
 = 
ARRAY_SIZE
(
©h6kl_limôs_p2p_c⁄cuºít4_1
),

293 
	#CCKM_KRK_CIPHER_SUITE
 0x004096f‡

	)

295 #ifde‡
PMF_SUPPORT


296 
	#WLAN_AKM_SUITE_8021X_SHA256
 0x000FAC05

	)

297 
	#WLAN_AKM_SUITE_PSK_SHA256
 0x000FAC06

	)

299 
©h6kl_£t_akm_suôes
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

300 
cfg80211_c⁄√˘_∑øms
 *
sme
);

301 
©h6kl_£t_r¢_ˇp
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

302 c⁄° 
u8
 *
õs
, 
õs_Àn
);

305 
©h6kl_ópﬁ_sh¥Ÿe˘_timî_h™dÀr
(
±r
);

307 
	$©h6kl_£t_w∑_vîsi⁄
(
©h6kl_vif
 *
vif
,

308 
∆80211_w∑_vîsi⁄s
 
w∑_vîsi⁄
)

310 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: %u\n", 
__func__
, 
w∑_vîsi⁄
);

312 i‡(!
w∑_vîsi⁄
) {

313 
vif
->
auth_mode
 = 
NONE_AUTH
;

314 } i‡(
w∑_vîsi⁄
 & 
NL80211_WPA_VERSION_2
) {

315 
vif
->
auth_mode
 = 
WPA2_AUTH
;

316 } i‡(
w∑_vîsi⁄
 & 
NL80211_WPA_VERSION_1
) {

317 
vif
->
auth_mode
 = 
WPA_AUTH
;

319 
	`©h6kl_îr
("%s: %uÇŸ suµ‹ãd\n", 
__func__
, 
w∑_vîsi⁄
);

320  -
ENOTSUPP
;

324 
	}
}

326 
	$©h6kl_£t_auth_ty≥
(
©h6kl_vif
 *
vif
,

327 
∆80211_auth_ty≥
 
auth_ty≥
)

329 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: 0x%x\n", 
__func__
, 
auth_ty≥
);

331 
auth_ty≥
) {

332 
NL80211_AUTHTYPE_OPEN_SYSTEM
:

333 
vif
->
dŸ11_auth_mode
 = 
OPEN_AUTH
;

335 
NL80211_AUTHTYPE_SHARED_KEY
:

336 
vif
->
dŸ11_auth_mode
 = 
SHARED_AUTH
;

338 
NL80211_AUTHTYPE_NETWORK_EAP
:

339 
vif
->
dŸ11_auth_mode
 = 
LEAP_AUTH
;

342 
NL80211_AUTHTYPE_AUTOMATIC
:

343 
vif
->
dŸ11_auth_mode
 = 
OPEN_AUTH
 | 
SHARED_AUTH
;

347 
	`©h6kl_îr
("%s: 0x%xÇŸ sµ‹ãd\n", 
__func__
, 
auth_ty≥
);

348  -
ENOTSUPP
;

352 
	}
}

354 
	$©h6kl_£t_cùhî
(
©h6kl_vif
 *
vif
, 
u32
 
cùhî
, 
boﬁ
 
uˇ°
)

356 
u8
 *
¨_cùhî
 = 
uˇ°
 ? &
vif
->
¥wi£_¸y±o
 : &vif->
gΩ_¸y±o
;

357 
u8
 *
¨_cùhî_Àn
 = 
uˇ°
 ? &
vif
->
¥wi£_¸y±o_Àn
 :

358 &
vif
->
gΩ_¸y±o_Àn
;

360 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: cipher 0x%x, ucast %u\n",

361 
__func__
, 
cùhî
, 
uˇ°
);

363 
cùhî
) {

366 *
¨_cùhî
 = 
NONE_CRYPT
;

367 *
¨_cùhî_Àn
 = 0;

369 
WLAN_CIPHER_SUITE_WEP40
:

370 *
¨_cùhî
 = 
WEP_CRYPT
;

371 *
¨_cùhî_Àn
 = 5;

373 
WLAN_CIPHER_SUITE_WEP104
:

374 *
¨_cùhî
 = 
WEP_CRYPT
;

375 *
¨_cùhî_Àn
 = 13;

377 
WLAN_CIPHER_SUITE_TKIP
:

378 *
¨_cùhî
 = 
TKIP_CRYPT
;

379 *
¨_cùhî_Àn
 = 0;

381 
WLAN_CIPHER_SUITE_CCMP
:

382 *
¨_cùhî
 = 
AES_CRYPT
;

383 *
¨_cùhî_Àn
 = 0;

385 
WLAN_CIPHER_SUITE_SMS4
:

386 *
¨_cùhî
 = 
WAPI_CRYPT
;

387 *
¨_cùhî_Àn
 = 0;

390 
	`©h6kl_îr
("cùhî 0x%xÇŸ suµ‹ãd\n", 
cùhî
);

391  -
ENOTSUPP
;

395 
	}
}

397 
	$©h6kl_£t_key_mgmt
(
©h6kl_vif
 *
vif
, 
u32
 
key_mgmt
)

399 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: 0x%x\n", 
__func__
, 
key_mgmt
);

401 i‡(
key_mgmt
 =
WLAN_AKM_SUITE_PSK
) {

402 i‡(
vif
->
auth_mode
 =
WPA_AUTH
)

403 
vif
->
auth_mode
 = 
WPA_PSK_AUTH
;

404 i‡(
vif
->
auth_mode
 =
WPA2_AUTH
)

405 
vif
->
auth_mode
 = 
WPA2_PSK_AUTH
;

406 } i‡(
key_mgmt
 == 0x00409600) {

407 i‡(
vif
->
auth_mode
 =
WPA_AUTH
)

408 
vif
->
auth_mode
 = 
WPA_AUTH_CCKM
;

409 i‡(
vif
->
auth_mode
 =
WPA2_AUTH
)

410 
vif
->
auth_mode
 = 
WPA2_AUTH_CCKM
;

411 #ifde‡
PMF_SUPPORT


412 } i‡(
key_mgmt
 =
WLAN_AKM_SUITE_PSK_SHA256
) {

413 
vif
->
auth_mode
 = 
WPA2_PSK_SHA256_AUTH
;

414 } i‡((
key_mgmt
 !
WLAN_AKM_SUITE_8021X
) &&

415 (
key_mgmt
 !
WLAN_AKM_SUITE_8021X_SHA256
)) {

417 } i‡(
key_mgmt
 !
WLAN_AKM_SUITE_8021X
) {

419 
vif
->
auth_mode
 = 
NONE_AUTH
;

421 
	}
}

423 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


424 
	$©h6kl_ö°Æl_ktk_±k
(
©h6kl_vif
 *
vif
)

426 
©h6kl
 *
¨
 = 
vif
->ar;

427 
©h6kl_key
 *
±k
 = 
NULL
;

428 
wmi_sync_Êag
 
sync_Êag
 = 
SYNC_BOTH_WMIFLAG
;

429 
°©us
;

430 
buff
[32];

432 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s\n", 
__func__
);

434 
	`mem£t
(
buff
, 0, 32);

435 
	`mem˝y
(
buff
, 
¨
->
ktk_∑s•hø£
, 16);

438 
±k
 = &
vif
->
keys
[0];

439 
	`mem£t
(
±k
, 0, (
©h6kl_key
));

441 
±k
->
key_Àn
 = 16;

442 
	`mem˝y
(
±k
->
key
, 
¨
->
ktk_∑s•hø£
,Ötk->
key_Àn
);

443 
±k
->
£q_Àn
 = 6;

444 
	`mem£t
(
±k
->
£q
, 0,Ötk->
£q_Àn
);

446 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_WMI_SYC
))

447 
sync_Êag
 = 
NO_SYNC_WMIFLAG
;

449 
°©us
 = 
	`©h6kl_wmi_addkey_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 0,

450 
KTK_CRYPT
, 
GROUP_USAGE
 | 
TX_USAGE
,

451 
±k
->
key_Àn
,

452 
±k
->
£q
,

453 
±k
->
£q_Àn
,

454 
±k
->
key
,

455 
KEY_OP_INIT_VAL
,

456 
NULL
,

457 
sync_Êag
);

459 i‡(
°©us
)

460 
	`©h6kl_îr
("%s: sëÖtkáàödex 0 faûed\n", 
__func__
);

461 
	}
}

464 
boﬁ
 
	$__©h6kl_cfg80211_ªady
(
©h6kl
 *
¨
)

466 i‡(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
)) {

467 
	`©h6kl_îr
("wmi isÇotÑeady\n");

468  
Ál£
;

471  
åue
;

472 
	}
}

474 
boﬁ
 
	$©h6kl_cfg80211_ªady
(
©h6kl_vif
 *
vif
)

476 i‡(!
	`__©h6kl_cfg80211_ªady
(
vif
->
¨
))

477  
Ál£
;

479 #i‡
	`deföed
(
USB_AUTO_SUSPEND
)

480 i‡((
vif
->
¨
->
°©e
 =
ATH6KL_STATE_WOW
) ||

481 (
vif
->
¨
->
°©e
 =
ATH6KL_STATE_DEEPSLEEP
) ||

482 (
vif
->
¨
->
°©e
 =
ATH6KL_STATE_PRE_SUSPEND
)) {

483 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

486 i‡(!
	`ã°_bô
(
WLAN_ENABLED
, &
vif
->
Êags
))

487  
Ál£
;

490 i‡(!
	`ã°_bô
(
WLAN_ENABLED
, &
vif
->
Êags
))

491  
Ál£
;

494  
åue
;

495 
	}
}

497 
boﬁ
 
	$©h6kl_is_w∑_õ
(c⁄° 
u8
 *
pos
)

499  
pos
[0] =
WLAN_EID_VENDOR_SPECIFIC
 &&Öos[1] >= 4 &&

500 
pos
[2] == 0x00 &&Öos[3] == 0x50 &&

501 
pos
[4] == 0xf2 &&Öos[5] == 0x01;

502 
	}
}

504 
boﬁ
 
	$©h6kl_is_r¢_õ
(c⁄° 
u8
 *
pos
)

506  
pos
[0] =
WLAN_EID_RSN
;

507 
	}
}

509 
boﬁ
 
	$©h6kl_is_wps_õ
(c⁄° 
u8
 *
pos
)

511  (
pos
[0] =
WLAN_EID_VENDOR_SPECIFIC
 &&

512 
pos
[1] >= 4 &&

513 
pos
[2] == 0x00 &&Öos[3] == 0x50 &&Öos[4] == 0xf2 &&

514 
pos
[5] == 0x04);

515 
	}
}

517 
boﬁ
 
	$©h6kl_is_wmm_õ
(c⁄° 
u8
 *
pos
)

519  (
pos
[0] =
WLAN_EID_VENDOR_SPECIFIC
 &&

520 
pos
[1] >= 4 &&

521 
pos
[2] == 0x00 &&Öos[3] == 0x50 &&Öos[4] == 0xf2 &&

522 
pos
[5] == 0x02);

523 
	}
}

525 
	$©h6kl_£t_assoc_ªq_õs
(
©h6kl_vif
 *
vif
, c⁄° 
u8
 *
õs
,

526 
size_t
 
õs_Àn
)

528 
©h6kl
 *
¨
 = 
vif
->ar;

529 c⁄° 
u8
 *
pos
;

530 
u8
 *
buf
 = 
NULL
;

531 
size_t
 
Àn
 = 0;

532 
ªt
;

538 
vif
->
c⁄√˘_˘æ_Êags
 &~
CONNECT_WPS_FLAG
;

543 i‡(
õs
 && 
õs_Àn
) {

544 
buf
 = 
	`kmÆloc
(
õs_Àn
, 
GFP_KERNEL
);

545 i‡(
buf
 =
NULL
)

546  -
ENOMEM
;

547 
pos
 = 
õs
;

549 
pos
 + 1 < 
õs
 + 
õs_Àn
) {

550 i‡(
pos
 + 2 +Öos[1] > 
õs
 + 
õs_Àn
)

552 i‡(!(
	`©h6kl_is_w∑_õ
(
pos
) ||

553 
	`©h6kl_is_r¢_õ
(
pos
))) {

554 i‡((
	`©h6kl_is_p2p_õ
(
pos
) ||

555 
	`©h6kl_is_wfd_õ
(
pos
)) &&

556 !
	`©h6kl_p2p_õ_≠≥nd
(
vif
,

557 
P2P_IE_IN_ASSOC_REQ
))

558 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

561 
	`mem˝y
(
buf
 + 
Àn
, 
pos
, 2 +Öos[1]);

562 
Àn
 +2 + 
pos
[1];

566 i‡(
	`©h6kl_is_wps_õ
(
pos
))

567 
vif
->
c⁄√˘_˘æ_Êags
 |
CONNECT_WPS_FLAG
;

569 
pos
 += 2 +Öos[1];

573 
ªt
 = 
	`©h6kl_wmi_£t_≠põ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

574 
WMI_FRAME_ASSOC_REQ
, 
buf
, 
Àn
);

575 
	`k‰ì
(
buf
);

576  
ªt
;

577 
	}
}

579 
	$©h6kl_∆i·y≥_to_drv_i·y≥
(
∆80211_i·y≥
 
ty≥
, 
u8
 *
nw_ty≥
)

581 
ty≥
) {

582 
NL80211_IFTYPE_STATION
:

583 *
nw_ty≥
 = 
INFRA_NETWORK
;

585 
NL80211_IFTYPE_ADHOC
:

586 *
nw_ty≥
 = 
ADHOC_NETWORK
;

588 
NL80211_IFTYPE_AP
:

589 *
nw_ty≥
 = 
AP_NETWORK
;

591 
NL80211_IFTYPE_P2P_CLIENT
:

592 *
nw_ty≥
 = 
INFRA_NETWORK
;

594 
NL80211_IFTYPE_P2P_GO
:

595 *
nw_ty≥
 = 
AP_NETWORK
;

598 
	`©h6kl_îr
("övÆid i¡îÁ˚Åy≥ %u\n", 
ty≥
);

599  -
ENOTSUPP
;

603 
	}
}

605 
boﬁ
 
	$©h6kl_is_vÆid_i·y≥
(
©h6kl
 *
¨
, 
∆80211_i·y≥
 
ty≥
,

606 
u8
 *
if_idx
, u8 *
nw_ty≥
)

608 
i
;

610 i‡(
	`©h6kl_∆i·y≥_to_drv_i·y≥
(
ty≥
, 
nw_ty≥
))

611  
Ál£
;

613 i‡(
¨
->
ibss_if_a˘ive
 || ((
ty≥
 =
NL80211_IFTYPE_ADHOC
) &&

614 
¨
->
num_vif
))

615  
Ál£
;

620 i‡(
¨
->
p2p_c⁄cuºít
 &&ár->
p2p_dediˇã
) {

621 i‡((
¨
->
p2p_c⁄cuºít_≠
) &&

622 (
ty≥
 =
NL80211_IFTYPE_AP
)) {

623 
i
 = 0; i < 
¨
->
max_n‹m_iÁ˚
; i++) {

624 i‡((
¨
->
avaû_idx_m≠
 >> 
i
Ë& 
	`BIT
(0)) {

625 *
if_idx
 = 
i
;

626  
åue
;

629  
Ál£
;

632 i‡(
ty≥
 =
NL80211_IFTYPE_STATION
 ||

633 
ty≥
 =
NL80211_IFTYPE_AP
 ||

634 
ty≥
 =
NL80211_IFTYPE_ADHOC
) {

635 
i
 = (
¨
->
vif_max
 - 1); i > 0; i--) {

636 i‡((
¨
->
avaû_idx_m≠
 >> 
i
Ë& 
	`BIT
(0)) {

637 *
if_idx
 = 
i
;

638  
åue
;

643 i‡(
ty≥
 =
NL80211_IFTYPE_P2P_CLIENT
 ||

644 
ty≥
 =
NL80211_IFTYPE_P2P_GO
) {

645 
i
 = (
¨
->
vif_max
 - 1); i >

646 (
¨
->
max_n‹m_iÁ˚
 - 1); 
i
--) {

647 i‡((
¨
->
avaû_idx_m≠
 >> 
i
Ë& 
	`BIT
(0)) {

648 *
if_idx
 = 
i
;

649  
åue
;

655 i‡(
ty≥
 =
NL80211_IFTYPE_STATION
 ||

656 
ty≥
 =
NL80211_IFTYPE_AP
 ||Åy≥ =
NL80211_IFTYPE_ADHOC
) {

657 
i
 = 0; i < 
¨
->
vif_max
; i++) {

658 i‡((
¨
->
avaû_idx_m≠
 >> 
i
Ë& 
	`BIT
(0)) {

659 *
if_idx
 = 
i
;

660  
åue
;

665 i‡(
ty≥
 =
NL80211_IFTYPE_P2P_CLIENT
 ||

666 
ty≥
 =
NL80211_IFTYPE_P2P_GO
) {

667 
i
 = 
¨
->
max_n‹m_iÁ˚
; i <ár->
vif_max
; i++) {

668 i‡((
¨
->
avaû_idx_m≠
 >> 
i
Ë& 
	`BIT
(0)) {

669 *
if_idx
 = 
i
;

670  
åue
;

676  
Ál£
;

677 
	}
}

682 
	$©h6kl_judge_rﬂm_∑ømëî
(

683 
©h6kl_vif
 *
vif
,

684 
boﬁ
 
ˇŒ_⁄_disc⁄√˘
)

686 
©h6kl
 *
¨
 = 
vif
->ar;

687 
u8
 
c⁄√˘ed_cou¡
 = 0;

688 
boﬁ
 
Ãssi_sˇn_íabÀ
 = 
åue
;

689 
©h6kl_vif
 *
vif_ãmp
;

691 i‡(
¨
->
rﬂm_mode
 =
ATH6KL_MODULEROAM_DISABLE
 ||

692 
¨
->
rﬂm_mode
 =
ATH6KL_MODULEROAM_DISABLE_LRSSI_SCAN
) {

693 
Ãssi_sˇn_íabÀ
 = 
Ál£
;

694 
DONE
;

695 } i‡(
¨
->
rﬂm_mode
 =
ATH6KL_MODULEROAM_NO_LRSSI_SCAN_AT_MULTI
) {

697 
Ãssi_sˇn_íabÀ
 = 
åue
;

698 
	`li°_f‹_óch_íåy
(
vif_ãmp
, &
¨
->
vif_li°
, 
li°
) {

699 i‡(
vif
->
fw_vif_idx
 =
vif_ãmp
->fw_vif_idx)

701 i‡(
	`ã°_bô
(
CONNECTED
, &
vif_ãmp
->
Êags
))

702 
c⁄√˘ed_cou¡
++;

704 i‡(
ˇŒ_⁄_disc⁄√˘
) {

705 i‡((
c⁄√˘ed_cou¡
 == 1) &&

706 (
vif_ãmp
->
wdev
.
i·y≥
 ==

707 
NL80211_IFTYPE_STATION
)) {

708 
Ãssi_sˇn_íabÀ
 = 
åue
;

710 
Ãssi_sˇn_íabÀ
 = 
Ál£
;

712 } i‡(
c⁄√˘ed_cou¡
) {

713 
Ãssi_sˇn_íabÀ
 = 
Ál£
;

714 
DONE
;

718 
Ãssi_sˇn_íabÀ
 = 
åue
;

722 i‡(!
ˇŒ_⁄_disc⁄√˘
 &&

723 
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_STATION
)

724 
Ãssi_sˇn_íabÀ
 = 
Ál£
;

726 
DONE
:

727 i‡(
Ãssi_sˇn_íabÀ
) {

728 
	`©h6kl_wmi_£t_rﬂm_˘æ_cmd
(
¨
->
wmi
,

730 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_sˇn_≥riod
,

731 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_sˇn_thªshﬁd
,

732 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_rﬂm_thªshﬁd
,

733 
¨
->
low_rssi_rﬂm_∑øms
.
rﬂm_rssi_Êo‹
);

735 
	`©h6kl_wmi_£t_rﬂm_˘æ_cmd
(
¨
->
wmi
,

739 
	}
}

741 
	$swôch_tid_rx_timeout
(

742 
©h6kl_vif
 *
vif
,

743 
boﬁ
 
mcc
)

745 
u8
 
i
, 
j
 = 0;

746 
aggr_c⁄n_öfo
 *
aggr_c⁄n
;

747 
rxtid
 *rxtid;

749 
i
 = 0; i < 
AP_MAX_NUM_STA
; i++) {

750 
aggr_c⁄n
 = 
vif
->
°a_li°
[
i
].
aggr_c⁄n_˙txt
;

751 
j
 = 0; j < 
NUM_OF_TIDS
; j++) {

752 
rxtid
 = 
	`AGGR_GET_RXTID
(
aggr_c⁄n
, 
j
);

753 
	`•ö_lock_bh
(&
rxtid
->
lock
);

754 
up_to_ac
[
j
]) {

755 
WMM_AC_BK
:

756 
WMM_AC_BE
:

757 
WMM_AC_VI
:

758 i‡(
mcc
)

759 
aggr_c⁄n
->
tid_timeout_£âög
[
j
] =

760 
MCC_AGGR_RX_TIMEOUT
;

762 
aggr_c⁄n
->
tid_timeout_£âög
[
j
] =

763 
AGGR_RX_TIMEOUT
;

765 
WMM_AC_VO
:

766 i‡(
mcc
)

767 
aggr_c⁄n
->
tid_timeout_£âög
[
j
] =

768 
MCC_AGGR_RX_TIMEOUT_VO
;

770 
aggr_c⁄n
->
tid_timeout_£âög
[
j
] =

771 
AGGR_RX_TIMEOUT_VO
;

774 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

777 
	}
}

779 #ifde‡
USB_AUTO_SUSPEND


780 
	$©h6kl_check_aut›m_⁄off
(
©h6kl
 *
¨
)

782 
©h6kl_vif
 *
vif_ãmp
;

789 
vif_˙t
 = 0;

790 
aut›m_tu∫_⁄
 = 1;

791 
	`li°_f‹_óch_íåy
(
vif_ãmp
, &
¨
->
vif_li°
, 
li°
) {

792 
vif_˙t
++;

793 i‡(
	`ã°_bô
(
CONNECTED
, &
vif_ãmp
->
Êags
)) {

794 i‡(
vif_˙t
 > 1) {

795 
aut›m_tu∫_⁄
 = 0;

798 i‡(
vif_ãmp
->
nw_ty≥
 =
AP_NETWORK
) {

799 
aut›m_tu∫_⁄
 = 0;

804 i‡(
aut›m_tu∫_⁄
)

805 
	`©h6kl_hif_auto_pm_tu∫⁄
(
¨
);

807 
	`©h6kl_hif_auto_pm_tu∫off
(
¨
);

808 
	}
}

814 
	$©h6kl_swôch_∑ømëî_ba£d_⁄_c⁄√˘i⁄
(

815 
©h6kl_vif
 *
vif
,

816 
boﬁ
 
ˇŒ_⁄_disc⁄√˘
)

818 
©h6kl
 *
¨
 = 
vif
->ar;

819 
u8
 
c⁄√˘ed_cou¡
 = 0;

820 
©h6kl_vif
 *
vif_ãmp
;

821 
boﬁ
 
mcc
 = 
Ál£
;

822 
u16
 
¥e_vifch
 = 0;

824 
	`li°_f‹_óch_íåy
(
vif_ãmp
, &
¨
->
vif_li°
, 
li°
) {

825 i‡(
	`ã°_bô
(
CONNECTED
, &
vif_ãmp
->
Êags
)) {

826 
c⁄√˘ed_cou¡
++;

827 i‡(
¥e_vifch
 == 0) {

828 
¥e_vifch
 = 
vif_ãmp
->
bss_ch
;

829 } i‡(
vif_ãmp
->
bss_ch
 != 0 &&

830 
¥e_vifch
 !
vif_ãmp
->
bss_ch
) {

831 
mcc
 = 
åue
;

836 i‡(
c⁄√˘ed_cou¡
) {

837 
	`li°_f‹_óch_íåy
(
vif_ãmp
, &
¨
->
vif_li°
, 
li°
) {

838 i‡(
	`ã°_bô
(
CONNECTED
, &
vif_ãmp
->
Êags
)) {

839 i‡(
ˇŒ_⁄_disc⁄√˘
 &&

840 
vif
->
fw_vif_idx
 =
vif_ãmp
->fw_vif_idx)

842 
	`swôch_tid_rx_timeout
(
vif_ãmp
, 
mcc
);

853 i‡((
ˇŒ_⁄_disc⁄√˘
) &&

854 
	`ã°_bô
(
EAPOL_HANDSHAKE_PROTECT
, &
¨
->
Êag
)) {

855 i‡((
c⁄√˘ed_cou¡
 == 0) ||

856 (
¨
->
ópﬁ_sh¥Ÿe˘_vif
 =(1 << 
vif
->
fw_vif_idx
))) {

857 
	`˛ór_bô
(
EAPOL_HANDSHAKE_PROTECT
, &
¨
->
Êag
);

858 
	`dñ_timî
(&
¨
->
ópﬁ_sh¥Ÿe˘_timî
);

869 i‡(
c⁄√˘ed_cou¡
) {

870 
	`li°_f‹_óch_íåy
(
vif_ãmp
, &
¨
->
vif_li°
, 
li°
) {

871 
vif_ãmp
->
sc_∑øms
.
∑s_chdwñl_time
 =

872 
ATH6KL_SCAN_PAS_DEWELL_TIME
;

875 
	`li°_f‹_óch_íåy
(
vif_ãmp
, &
¨
->
vif_li°
, 
li°
) {

876 
	`mem˝y
(&
vif
->
sc_∑øms
,

877 &
vif
->
sc_∑øms_deÁu…
,

878 (
wmi_sˇn_∑øms_cmd
));

882 i‡(
mcc
)

883 
	`£t_bô
(
MCC_ENABLED
, &
¨
->
Êag
);

885 
	`˛ór_bô
(
MCC_ENABLED
, &
¨
->
Êag
);

887 i‡(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_ENABLE_FLOWCTRL
) {

888 i‡(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_DISABLE_SKIP_FLOWCTRL
) {

889 
	`˛ór_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
);

891 i‡(
	`ã°_bô
(
MCC_ENABLED
, &
¨
->
Êag
))

892 
	`˛ór_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
);

894 
	`£t_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
);

897 
	`˛ór_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
);

900 i‡(
mcc
) {

901 
	`li°_f‹_óch_íåy
(
vif_ãmp
, &
¨
->
vif_li°
, 
li°
) {

902 i‡(
	`ã°_bô
(
CONNECTED
, &
vif_ãmp
->
Êags
)) {

903 i‡(
ˇŒ_⁄_disc⁄√˘
 &&

904 
vif
->
fw_vif_idx
 =
vif_ãmp
->fw_vif_idx)

906 i‡(
vif_ãmp
->
nw_ty≥
 =
AP_NETWORK
) {

907 
	`©h6kl_≠_kì∑live_c⁄fig
(
vif_ãmp
,

908 
ATH6KL_AP_KA_INTERVAL_DEFAULT
,

909 
ATH6KL_AP_KA_RECLAIM_CYCLE_MCC
);

914 
	`li°_f‹_óch_íåy
(
vif_ãmp
, &
¨
->
vif_li°
, 
li°
) {

915 i‡(
	`ã°_bô
(
CONNECTED
, &
vif_ãmp
->
Êags
)) {

916 i‡(
ˇŒ_⁄_disc⁄√˘
 &&

917 
vif
->
fw_vif_idx
 =
vif_ãmp
->fw_vif_idx)

919 i‡(
vif_ãmp
->
nw_ty≥
 =
AP_NETWORK
) {

920 
	`©h6kl_≠_kì∑live_c⁄fig
(
vif_ãmp
,

921 
ATH6KL_AP_KA_INTERVAL_DEFAULT
,

922 
ATH6KL_AP_KA_RECLAIM_CYCLE_SCC
);

929 
	`©h6kl_p2p_ªc⁄fig_ps
(
¨
, 
mcc
, 
ˇŒ_⁄_disc⁄√˘
);

931 #ifde‡
USB_AUTO_SUSPEND


932 
	`©h6kl_check_aut›m_⁄off
(
¨
);

934 
	}
}

936 
ölöe
 
	$_ch™ge_p2p_sˇn_∂™
(
©h6kl_vif
 *
vif
)

938 
	#_MAX_STAY_TIME
 (200Ë

	)

939 
©h6kl
 *
¨
 = 
vif
->ar;

940 
©h6kl_vif
 *
tmp
;

941 
boﬁ
 
ch™ge_sˇn_∂™
 = 
åue
;

942 
i
;

950 
	`li°_f‹_óch_íåy
(
tmp
, &
¨
->
vif_li°
, 
li°
) {

951 i‡((
tmp
 !
vif
) &&

952 
	`ã°_bô
(
CONNECTED
, &
tmp
->
Êags
) &&

953 (
tmp
->
bss_ch
 !
vif
->
ch_höt
)) {

954 
ch™ge_sˇn_∂™
 = 
Ál£
;

959 i‡(
ch™ge_sˇn_∂™
) {

960 
vif
->
sˇn_∂™
.
ty≥
 = 
ATH6KL_SCAN_PLAN_HOST_ORDER
;

961 
vif
->
sˇn_∂™
.
numCh™
 = 
_MAX_STAY_TIME
 /

962 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
;

964 
i
 = 0; i < 
vif
->
sˇn_∂™
.
numCh™
; i++)

965 
vif
->
sˇn_∂™
.
ch™Li°
[
i
] = vif->
ch_höt
;

969 #unde‡
_MAX_STAY_TIME


970 
	}
}

972 
	$©h6kl_ch™ge_sˇn_∂™
(
©h6kl_vif
 *
vif
, 
boﬁ
 
ª£t
)

974 
©h6kl
 *
¨
 = 
vif
->ar;

977 
vif
->
sˇn_∂™
.
ty≥
 = 
ATH6KL_SCAN_PLAN_IN_ORDER
;

978 
vif
->
sˇn_∂™
.
numCh™
 = 0;

980 i‡(!
ª£t
) {

985 i‡(!(
¨
->
wùhy
->
Êags
 & 
WIPHY_FLAG_SUPPORTS_FW_ROAM
))

986 
d⁄e
;

988 i‡(
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_STATION
) {

990 
vif
->
sˇn_∂™
.
ty≥
 = 
ATH6KL_SCAN_PLAN_REVERSE_ORDER
;

991 } i‡((
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_P2P_CLIENT
) &&

992 (
vif
->
ssid_Àn
)) {

993 
cfg80211_bss
 *
bss
;

1001 
bss
 = 
	`©h6kl_bss_gë
(
vif
->
¨
,

1002 
NULL
,

1003 
NULL
,

1004 
vif
->
ssid
,

1005 
vif
->
ssid_Àn
,

1006 
WLAN_CAPABILITY_ESS
,

1007 
WLAN_CAPABILITY_ESS
);

1009 i‡(
bss
 && bss->
ch™√l
) {

1010 #ifde‡
CFG80211_SAFE_BSS_INFO_ACCESS


1011 
	`rcu_ªad_lock
();

1013 
vif
->
ch_höt
 = 
bss
->
ch™√l
->
˚¡î_‰eq
;

1014 
	`mem˝y
(
vif
->
ªq_bssid
, 
bss
->
bssid
, 
ETH_ALEN
);

1015 #ifde‡
CFG80211_SAFE_BSS_INFO_ACCESS


1016 
	`rcu_ªad_u∆ock
();

1020 i‡(
bss
)

1021 
	`©h6kl_bss_put
(
vif
->
¨
, 
bss
);

1024 
	`_ch™ge_p2p_sˇn_∂™
(
vif
);

1028 
d⁄e
:

1029 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1031 
vif
->
fw_vif_idx
,

1032 
ª£t
,

1033 
vif
->
sˇn_∂™
.
ty≥
,

1034 
vif
->
sˇn_∂™
.
numCh™
);

1037 
	`©h6kl_wmi_£t_sˇn_ch™_∂™
(
¨
->
wmi
,

1038 
vif
->
fw_vif_idx
,

1039 
vif
->
sˇn_∂™
.
ty≥
,

1040 
vif
->
sˇn_∂™
.
numCh™
,

1041 
vif
->
sˇn_∂™
.
ch™Li°
);

1044 
	}
}

1046 
	$©h6kl_cfg80211_c⁄√˘
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

1047 
cfg80211_c⁄√˘_∑øms
 *
sme
)

1049 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

1050 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

1051 
°©us
, 
À·
;

1053 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

1054  -
EIO
;

1056 i‡(
	`ã°_bô
(
DESTROY_IN_PROGRESS
, &
¨
->
Êag
)) {

1057 
	`©h6kl_îr
("destroy inÖrogress\n");

1058  -
EBUSY
;

1061 i‡(
	`ã°_bô
(
SKIP_SCAN
, &
¨
->
Êag
) &&

1062 ((
sme
->
ch™√l
 && sme->ch™√l->
˚¡î_‰eq
 == 0) ||

1063 (
sme
->
bssid
 && 
	`is_zîo_ëhî_addr
(sme->bssid)))) {

1064 
	`©h6kl_îr
("SkipScan: channel or bssid invalid\n");

1065  -
EINVAL
;

1068 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

1069 
	`©h6kl_îr
("busy, couldn't getáccess\n");

1070  -
ERESTARTSYS
;

1073 
vif
->
sme_°©e
 = 
SME_CONNECTING
;

1075 i‡(
¨
->
tx_≥ndög
[
	`©h6kl_wmi_gë_c⁄åﬁ_ï
◊r->
wmi
)]) {

1079 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

1080 
¨
->
tx_≥ndög
[
	`©h6kl_wmi_gë_c⁄åﬁ_ï
◊r->
wmi
)] == 0,

1081 
WMI_TIMEOUT
);

1082 i‡(
À·
 == 0) {

1083 
	`©h6kl_w¨n
("clear wmi ctrl dataÅimeout connect\n");

1084 
	`up
(&
¨
->
£m
);

1085  -
ETIMEDOUT
;

1086 } i‡(
	`sig«l_≥ndög
(
cuºít
)) {

1087 
	`©h6kl_îr
("cmd queue drainÅimeout\n");

1088 
	`up
(&
¨
->
£m
);

1089  -
EINTR
;

1094 
vif
->
sc_∑øms
.
bg_≥riod
 = 0xFFFF;

1095 
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1096 
vif
->
sc_∑øms
.
fg_°¨t_≥riod
,

1097 
vif
->
sc_∑øms
.
fg_íd_≥riod
,

1098 
vif
->
sc_∑øms
.
bg_≥riod
,

1099 
vif
->
sc_∑øms
.
möa˘_chdwñl_time
,

1100 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
,

1101 
vif
->
sc_∑øms
.
∑s_chdwñl_time
,

1102 
vif
->
sc_∑øms
.
sh‹t_sˇn_øtio
,

1103 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
,

1104 
vif
->
sc_∑øms
.
max_dfsch_a˘_time
,

1105 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
);

1107 
	`©h6kl_judge_rﬂm_∑ømëî
(
vif
, 
Ál£
);

1109 i‡(
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_STATION
)

1110 
	`©h6kl_wmi_£t_gªí_tx_∑øms
(
¨
->
wmi
, &¨->
gªí_tx_∑øms
);

1112 i‡(
	`©h6kl_wmi_£t_øã_˘æ_cmd
(
¨
->
wmi
,

1113 
vif
->
fw_vif_idx
, 
RATECTRL_MODE_PERONLY
))

1114 
	`©h6kl_îr
("setÑate_ctrl failed\n");

1116 i‡(
sme
->
õ
 && (sme->
õ_Àn
 > 0)) {

1117 
°©us
 = 
	`©h6kl_£t_assoc_ªq_õs
(
vif
, 
sme
->
õ
, sme->
õ_Àn
);

1118 i‡(
°©us
) {

1119 
	`up
(&
¨
->
£m
);

1120  
°©us
;

1123 
vif
->
c⁄√˘_˘æ_Êags
 &~
CONNECT_WPS_FLAG
;

1125 #ifde‡
PMF_SUPPORT


1127 i‡(
	`©h6kl_£t_akm_suôes
(
wùhy
, 
dev
, 
sme
)) {

1128 
	`up
(&
¨
->
£m
);

1129  -
EIO
;

1133 i‡(
	`©h6kl_£t_r¢_ˇp
(
wùhy
, 
dev
, 
sme
->
õ
, sme->
õ_Àn
)) {

1134 
	`up
(&
¨
->
£m
);

1135  -
EIO
;

1139 
vif
->
c⁄√˘_˘æ_Êags
 |
CONNECT_IGNORE_WPAx_GROUP_CIPHER
;

1141 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) &&

1142 
vif
->
ssid_Àn
 =
sme
->ssid_len &&

1143 !
	`memcmp
(
vif
->
ssid
, 
sme
->ssid, vif->
ssid_Àn
)) {

1144 
vif
->
ªc⁄√˘_Êag
 = 
åue
;

1145 
°©us
 = 
	`©h6kl_wmi_ªc⁄√˘_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1146 
vif
->
ªq_bssid
,

1147 
vif
->
ch_höt
);

1149 
	`up
(&
¨
->
£m
);

1150 i‡(
°©us
) {

1151 
	`©h6kl_îr
("wmi_reconnect_cmd failed\n");

1152  -
EIO
;

1155 } i‡(
vif
->
ssid_Àn
 =
sme
->ssid_len &&

1156 !
	`memcmp
(
vif
->
ssid
, 
sme
->ssid, vif->
ssid_Àn
)) {

1157 
	`©h6kl_disc⁄√˘
(
vif
);

1160 
	`mem£t
(
vif
->
ssid
, 0, (vif->ssid));

1161 
vif
->
ssid_Àn
 = 
sme
->ssid_len;

1162 
	`mem˝y
(
vif
->
ssid
, 
sme
->ssid, sme->
ssid_Àn
);

1164 i‡(
sme
->
ch™√l
)

1165 
vif
->
ch_höt
 = 
sme
->
ch™√l
->
˚¡î_‰eq
;

1167 
	`mem£t
(
vif
->
ªq_bssid
, 0, (vif->req_bssid));

1168 i‡(
sme
->
bssid
 && !
	`is_brﬂdˇ°_ëhî_addr
(sme->bssid))

1169 
	`mem˝y
(
vif
->
ªq_bssid
, 
sme
->
bssid
, (vif->req_bssid));

1171 
	`©h6kl_£t_w∑_vîsi⁄
(
vif
, 
sme
->
¸y±o
.
w∑_vîsi⁄s
);

1173 
°©us
 = 
	`©h6kl_£t_auth_ty≥
(
vif
, 
sme
->
auth_ty≥
);

1174 i‡(
°©us
) {

1175 
	`up
(&
¨
->
£m
);

1176  
°©us
;

1179 i‡(
sme
->
¸y±o
.
n_cùhîs_∑úwi£
)

1180 
	`©h6kl_£t_cùhî
(
vif
, 
sme
->
¸y±o
.
cùhîs_∑úwi£
[0], 
åue
);

1182 
	`©h6kl_£t_cùhî
(
vif
, 0, 
åue
);

1184 
	`©h6kl_£t_cùhî
(
vif
, 
sme
->
¸y±o
.
cùhî_group
, 
Ál£
);

1186 i‡(
sme
->
¸y±o
.
n_akm_suôes
)

1187 
	`©h6kl_£t_key_mgmt
(
vif
, 
sme
->
¸y±o
.
akm_suôes
[0]);

1189 i‡((
sme
->
key_Àn
) &&

1190 (
vif
->
auth_mode
 =
NONE_AUTH
) &&

1191 (
vif
->
¥wi£_¸y±o
 =
WEP_CRYPT
)) {

1192 
©h6kl_key
 *
key
 = 
NULL
;

1194 i‡(
sme
->
key_idx
 > 
WMI_MAX_KEY_INDEX
) {

1195 
	`©h6kl_îr
("key index %d out of bounds\n",

1196 
sme
->
key_idx
);

1197 
	`up
(&
¨
->
£m
);

1198  -
ENOENT
;

1201 
key
 = &
vif
->
keys
[
sme
->
key_idx
];

1202 
key
->
key_Àn
 = 
sme
->key_len;

1203 
	`mem˝y
(
key
->key, 
sme
->key, key->
key_Àn
);

1204 
key
->
cùhî
 = 
vif
->
¥wi£_¸y±o
;

1205 
vif
->
def_txkey_ödex
 = 
sme
->
key_idx
;

1207 
	`©h6kl_wmi_addkey_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
sme
->
key_idx
,

1208 
vif
->
¥wi£_¸y±o
,

1209 
GROUP_USAGE
 | 
TX_USAGE
,

1210 
key
->
key_Àn
,

1211 
NULL
, 0,

1212 
key
->key, 
KEY_OP_INIT_VAL
, 
NULL
,

1213 
NO_SYNC_WMIFLAG
);

1216 i‡(!
vif
->
u§_bss_fûãr
) {

1217 
	`˛ór_bô
(
CLEAR_BSSFILTER_ON_BEACON
, &
vif
->
Êags
);

1218 i‡(
	`©h6kl_wmi_bssfûãr_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1219 
ALL_BSS_FILTER
, 0) != 0) {

1220 
	`©h6kl_îr
("couldn't set bss filtering\n");

1221 
	`up
(&
¨
->
£m
);

1222  -
EIO
;

1226 
vif
->
nw_ty≥
 = vif->
√xt_mode
;

1228 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1232 
__func__
,

1233 
vif
->
auth_mode
, vif->
dŸ11_auth_mode
, vif->
¥wi£_¸y±o
,

1234 
vif
->
¥wi£_¸y±o_Àn
, vif->
gΩ_¸y±o
,

1235 
vif
->
gΩ_¸y±o_Àn
, vif->
ch_höt
);

1237 
vif
->
ªc⁄√˘_Êag
 = 0;

1244 
	`©h6kl_wmi_dis˘imeout_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 0);

1246 
	`©h6kl_ch™ge_sˇn_∂™
(
vif
, 
Ál£
);

1248 
°©us
 = 
	`©h6kl_wmi_c⁄√˘_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, vif->
nw_ty≥
,

1249 
vif
->
dŸ11_auth_mode
, vif->
auth_mode
,

1250 
vif
->
¥wi£_¸y±o
,

1251 
vif
->
¥wi£_¸y±o_Àn
,

1252 
vif
->
gΩ_¸y±o
, vif->
gΩ_¸y±o_Àn
,

1253 
vif
->
ssid_Àn
, vif->
ssid
,

1254 
vif
->
ªq_bssid
, vif->
ch_höt
,

1255 
vif
->
c⁄√˘_˘æ_Êags
);

1257 
	`up
(&
¨
->
£m
);

1259 i‡(
°©us
 =-
EINVAL
) {

1260 
	`mem£t
(
vif
->
ssid
, 0, (vif->ssid));

1261 
vif
->
ssid_Àn
 = 0;

1262 
	`©h6kl_îr
("invalidÑequest\n");

1263  -
ENOENT
;

1264 } i‡(
°©us
) {

1265 
	`©h6kl_îr
("ath6kl_wmi_connect_cmd failed\n");

1266  -
EIO
;

1269 i‡((!(
vif
->
c⁄√˘_˘æ_Êags
 & 
CONNECT_DO_WPA_OFFLOAD
)) &&

1270 ((
vif
->
auth_mode
 =
WPA_PSK_AUTH
)

1271 || (
vif
->
auth_mode
 =
WPA2_PSK_AUTH
))) {

1272 
	`mod_timî
(&
vif
->
disc⁄√˘_timî
,

1273 
jiffõs
 + 
	`m£cs_to_jiffõs
(
DISCON_TIMER_INTVAL
));

1276 
vif
->
c⁄√˘_˘æ_Êags
 &~
CONNECT_DO_WPA_OFFLOAD
;

1277 
	`£t_bô
(
CONNECT_PEND
, &
vif
->
Êags
);

1280 
	}
}

1282 
cfg80211_bss
 *
	$©h6kl_add_bss_if_√eded
(
©h6kl_vif
 *
vif
,

1283 
√tw‹k_ty≥
 
nw_ty≥
,

1284 c⁄° 
u8
 *
bssid
,

1285 
õì80211_ch™√l
 *
ch™
,

1286 c⁄° 
u8
 *
bóc⁄_õ
, 
size_t
 
bóc⁄_õ_Àn
)

1288 
©h6kl
 *
¨
 = 
vif
->ar;

1289 
cfg80211_bss
 *
bss
;

1290 
u16
 
ˇp_mask
, 
ˇp_vÆ
;

1291 
u8
 *
õ
;

1293 i‡(
nw_ty≥
 & 
ADHOC_NETWORK
) {

1294 
ˇp_mask
 = 
WLAN_CAPABILITY_IBSS
;

1295 
ˇp_vÆ
 = 
WLAN_CAPABILITY_IBSS
;

1297 
ˇp_mask
 = 
WLAN_CAPABILITY_ESS
;

1298 
ˇp_vÆ
 = 
WLAN_CAPABILITY_ESS
;

1301 
bss
 = 
	`©h6kl_bss_gë
(
¨
, 
ch™
, 
bssid
,

1302 
vif
->
ssid
, vif->
ssid_Àn
,

1303 
ˇp_mask
, 
ˇp_vÆ
);

1304 i‡(
bss
 =
NULL
) {

1313 
õ
 = 
	`kmÆloc
(2 + 
vif
->
ssid_Àn
 + 
bóc⁄_õ_Àn
, 
GFP_KERNEL
);

1314 i‡(
õ
 =
NULL
)

1315  
NULL
;

1316 
õ
[0] = 
WLAN_EID_SSID
;

1317 
õ
[1] = 
vif
->
ssid_Àn
;

1318 
	`mem˝y
(
õ
 + 2, 
vif
->
ssid
, vif->
ssid_Àn
);

1319 
	`mem˝y
(
õ
 + 2 + 
vif
->
ssid_Àn
, 
bóc⁄_õ
, 
bóc⁄_õ_Àn
);

1320 
bss
 = 
	`cfg80211_öf‹m_bss
(
¨
->
wùhy
, 
ch™
,

1321 
bssid
, 0, 
ˇp_vÆ
, 100,

1322 
õ
, 2 + 
vif
->
ssid_Àn
 + 
bóc⁄_õ_Àn
,

1323 0, 
GFP_KERNEL
);

1324 i‡(
bss
)

1325 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "added bss %pMÅo "

1326 "cfg80211\n", 
bssid
);

1327 
	`k‰ì
(
õ
);

1329 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "cfg80211álready hasá bss\n");

1331  
bss
;

1332 
	}
}

1334 
boﬁ
 
	$©h6kl_rﬂmed_ödiˇã
(
©h6kl_vif
 *
vif
,

1335 
u8
 *
bssid
, 
boﬁ
 
ª£t_hk_¥Ÿ
)

1337 
©h6kl
 *
¨
 = 
vif
->ar;

1338 i‡((
vif
->
sme_°©e
 =
SME_CONNECTED
) &&

1339 (
¨
->
wùhy
->
Êags
 & 
WIPHY_FLAG_SUPPORTS_FW_ROAM
) &&

1340 ((!
	`ã°_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
)) ||

1341 (
ª£t_hk_¥Ÿ
 =
åue
))) {

1343 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: %pMÑoam, vif->flags 0x%lu,"

1345 
__func__
, 
bssid
, 
vif
->
Êags
, 
ª£t_hk_¥Ÿ
);

1346  
åue
;

1348 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: %pMÇŸrﬂm\n", 
__func__
, 
bssid
);

1349  
Ál£
;

1350 
	}
}

1352 
boﬁ
 
	$©h6kl_h™dshake_¥Ÿe˘
(
©h6kl_vif
 *
vif
, 
u8
 *
bssid
)

1354 
boﬁ
 
ª£t_h™dshake_¥o
 = 
Ál£
;

1356 i‡((
vif
->
auth_mode
 > 
NONE_AUTH
) &&

1357 (
vif
->
¥wi£_¸y±o
 > 
WEP_CRYPT
) &&

1358 (
vif
->
nw_ty≥
 =
INFRA_NETWORK
)) {

1360 i‡((
	`memcmp
(
bssid
, 
vif
->bssid, 
ETH_ALEN
) != 0) ||

1361 (!
	`ã°_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
))) {

1362 
	`•ö_lock_bh
(&
vif
->
if_lock
);

1363 
	`£t_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
);

1364 i‡(
vif
->
≥nd_skb
)

1365 
	`©h6kl_Êush_≥nd_skb
(
vif
);

1366 
	`£t_bô
(
FIRST_EAPOL_PENDSENT
, &
vif
->
Êags
);

1367 
	`mod_timî
(&
vif
->
sh¥Ÿe˘_timî
,

1368 
jiffõs
 + 
ATH6KL_HANDSHAKE_PROC_TIMEOUT
);

1369 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

1370 
ª£t_h™dshake_¥o
 = 
åue
;

1372 
ª£t_h™dshake_¥o
 = 
Ál£
;

1376 
	`•ö_lock_bh
(&
vif
->
if_lock
);

1377 
	`˛ór_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
);

1378 i‡(
vif
->
≥nd_skb
)

1379 
	`©h6kl_Êush_≥nd_skb
(
vif
);

1380 
	`dñ_timî
(&
vif
->
sh¥Ÿe˘_timî
);

1381 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

1382 
ª£t_h™dshake_¥o
 = 
Ál£
;

1385  
ª£t_h™dshake_¥o
;

1386 
	}
}

1388 
	$©h6kl_cfg80211_c⁄√˘_ªsu…
(
©h6kl_vif
 *
vif
,

1389 c⁄° 
u8
 *
bssid
,

1390 c⁄° 
u8
 *
ªq_õ
,

1391 
size_t
 
ªq_õ_Àn
,

1392 c⁄° 
u8
 *
ª•_õ
,

1393 
size_t
 
ª•_õ_Àn
,

1394 
u16
 
°©us
,

1395 
gÂ_t
 
gÂ
)

1397 
boﬁ
 
√ed_≥ndög
;

1399 i‡(
°©us
 !
WLAN_STATUS_SUCCESS
)

1400 
	`©h6kl_ch™ge_sˇn_∂™
(
vif
, 
åue
);

1402 
√ed_≥ndög
 = 
	`©h6kl_p2p_≥ndög_c⁄√˘_evít
(
vif
,

1403 
bssid
,

1404 
ªq_õ
,

1405 
ªq_õ_Àn
,

1406 
ª•_õ
,

1407 
ª•_õ_Àn
,

1408 
°©us
,

1409 
gÂ
);

1410 i‡(!
√ed_≥ndög
)

1411 
	`cfg80211_c⁄√˘_ªsu…
(
vif
->
ndev
,

1412 
bssid
,

1413 
ªq_õ
,

1414 
ªq_õ_Àn
,

1415 
ª•_õ
,

1416 
ª•_õ_Àn
,

1417 
°©us
,

1418 
gÂ
);

1421 
	}
}

1423 
	$©h6kl_cfg80211_disc⁄√˘ed
(
©h6kl_vif
 *
vif
,

1424 
u16
 
ªas⁄
,

1425 
u8
 *
õ
,

1426 
size_t
 
õ_Àn
,

1427 
gÂ_t
 
gÂ
)

1429 
	`©h6kl_ch™ge_sˇn_∂™
(
vif
, 
åue
);

1431 
	`©h6kl_p2p_≥ndög_disc⁄√˘_evít
(
vif
, 
ªas⁄
, 
õ
, 
õ_Àn
, 
gÂ
);

1432 
	`cfg80211_disc⁄√˘ed
(
vif
->
ndev
,

1433 
ªas⁄
,

1434 
õ
,

1435 
õ_Àn
,

1436 
gÂ
);

1439 
	}
}

1441 
	$©h6kl_cfg80211_c⁄√˘_evít
(
©h6kl_vif
 *
vif
, 
u16
 
ch™√l
,

1442 
u8
 *
bssid
, 
u16
 
li°í_ötvl
,

1443 
u16
 
bóc⁄_ötvl
,

1444 
√tw‹k_ty≥
 
nw_ty≥
,

1445 
u8
 
bóc⁄_õ_Àn
, u8 
assoc_ªq_Àn
,

1446 
u8
 
assoc_ª•_Àn
, u8 *
assoc_öfo
)

1448 
õì80211_ch™√l
 *
ch™
;

1449 
©h6kl
 *
¨
 = 
vif
->ar;

1450 
cfg80211_bss
 *
bss
;

1451 
boﬁ
 
ª£t_hk_¥Ÿ
 = 
Ál£
;

1454 
u8
 
assoc_ªq_õ_off£t
 = (
u16
) + (u16);

1457 
u8
 
assoc_ª•_õ_off£t
 = (
u16
) + (u16) + (u16);

1459 
u8
 *
assoc_ªq_õ
 = 
assoc_öfo
 + 
bóc⁄_õ_Àn
 + 
assoc_ªq_õ_off£t
;

1460 
u8
 *
assoc_ª•_õ
 = 
assoc_öfo
 + 
bóc⁄_õ_Àn
 + 
assoc_ªq_Àn
 +

1461 
assoc_ª•_õ_off£t
;

1463 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: bssid %pM\n", 
__func__
, 
bssid
);

1465 
assoc_ªq_Àn
 -
assoc_ªq_õ_off£t
;

1466 
assoc_ª•_Àn
 -
assoc_ª•_õ_off£t
;

1472 
vif
->
assoc_bss_bóc⁄_öt
 = 
bóc⁄_ötvl
;

1473 
	`˛ór_bô
(
DTIM_PERIOD_AVAIL
, &
vif
->
Êags
);

1475 i‡(
nw_ty≥
 & 
ADHOC_NETWORK
) {

1476 i‡(
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_ADHOC
) {

1477 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1478 "%s:áth6kÇŸ i¿ibs†mode\n", 
__func__
);

1481 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


1482 i‡(
¨
->
ktk_a˘ive
)

1483 
	`©h6kl_ö°Æl_ktk_±k
(
vif
);

1487 i‡(
nw_ty≥
 & 
INFRA_NETWORK
) {

1488 i‡(
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_STATION
 &&

1489 
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_P2P_CLIENT
) {

1490 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1491 "%s:áth6kÇŸ i¿°©i⁄ mode\n", 
__func__
);

1496 
ch™
 = 
	`õì80211_gë_ch™√l
(
¨
->
wùhy
, (Ë
ch™√l
);

1498 i‡(
ch™
 =
NULL
) {

1499 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1501 
__func__
);

1505 
bss
 = 
	`©h6kl_add_bss_if_√eded
(
vif
, 
nw_ty≥
, 
bssid
, 
ch™
,

1506 
assoc_öfo
, 
bóc⁄_õ_Àn
);

1507 i‡(!
bss
) {

1508 
	`©h6kl_îr
("couldÇotádd cfg80211 bssÉntry\n");

1512 i‡(
nw_ty≥
 & 
ADHOC_NETWORK
) {

1513 #ifde‡
ATH6KL_DIAGNOSTIC


1514 
	`wifi_düg_mac_fsm_evít
(
vif
,

1515 (
wifi_düg_mac_fsm_t
)
WIFI_DIAG_MAC_FSM_CONNECTED
,

1516 
vif
->
düg
.
c⁄√˘_£q_num
);

1518 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "ad-hoc %s selected\n",

1519 
nw_ty≥
 & 
ADHOC_CREATOR
 ? "creator" : "joiner");

1520 
	`cfg80211_ibss_joöed
(
vif
->
ndev
, 
bssid
, 
GFP_KERNEL
);

1521 
	`©h6kl_bss_put
(
vif
->
¨
, 
bss
);

1525 i‡(
nw_ty≥
 & 
INFRA_NETWORK
)

1526 
vif
->
phymode
 = ((
u16
)
nw_ty≥
 >> 8) & 0xff;

1528 
ª£t_hk_¥Ÿ
 = 
	`©h6kl_h™dshake_¥Ÿe˘
(
vif
, 
bssid
);

1530 i‡(
vif
->
sme_°©e
 =
SME_CONNECTING
) {

1532 
vif
->
sme_°©e
 = 
SME_CONNECTED
;

1533 #ifde‡
ATH6KL_DIAGNOSTIC


1534 
	`wifi_düg_mac_fsm_evít
(
vif
,

1535 (
wifi_düg_mac_fsm_t
)
WIFI_DIAG_MAC_FSM_CONNECTED
,

1536 
vif
->
düg
.
c⁄√˘_£q_num
);

1538 
	`©h6kl_bss_put
(
vif
->
¨
, 
bss
);

1539 
	`©h6kl_cfg80211_c⁄√˘_ªsu…
(
vif
, 
bssid
,

1540 
assoc_ªq_õ
, 
assoc_ªq_Àn
,

1541 
assoc_ª•_õ
, 
assoc_ª•_Àn
,

1542 
WLAN_STATUS_SUCCESS
, 
GFP_KERNEL
);

1543 } i‡(
	`©h6kl_rﬂmed_ödiˇã
(
vif
, 
bssid
, 
ª£t_hk_¥Ÿ
Ë=
åue
) {

1544 
	`cfg80211_rﬂmed_bss
(
vif
->
ndev
, 
bss
, 
assoc_ªq_õ
, 
assoc_ªq_Àn
,

1545 
assoc_ª•_õ
, 
assoc_ª•_Àn
, 
GFP_KERNEL
);

1547 
	}
}

1549 
	$©h6kl_cfg80211_disc⁄√˘
(
wùhy
 *wiphy,

1550 
√t_devi˚
 *
dev
, 
u16
 
ªas⁄_code
)

1552 
©h6kl
 *
¨
 = (©h6k»*)
	`©h6kl_¥iv
(
dev
);

1553 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

1554 
ªt
;

1556 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
 | 
ATH6KL_DBG_EXT_INFO1
, "%s:Ñeason=%u\n",

1557 
__func__
, 
ªas⁄_code
);

1559 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

1560  -
EIO
;

1562 i‡(
	`ã°_bô
(
DESTROY_IN_PROGRESS
, &
¨
->
Êag
)) {

1563 
	`©h6kl_îr
("busy, destroy inÖrogress\n");

1564  -
EBUSY
;

1567 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

1568 
	`©h6kl_îr
("busy, couldn't getáccess\n");

1569  -
ERESTARTSYS
;

1571 
vif
->
ªc⁄√˘_Êag
 = 0;

1572 
ªt
 = 
	`©h6kl_disc⁄√˘
(
vif
);

1573 
	`mem£t
(
vif
->
ssid
, 0, (vif->ssid));

1574 
vif
->
ssid_Àn
 = 0;

1576 i‡(!
	`ã°_bô
(
SKIP_SCAN
, &
¨
->
Êag
))

1577 
	`mem£t
(
vif
->
ªq_bssid
, 0, (vif->req_bssid));

1579 
	`up
(&
¨
->
£m
);

1581 
vif
->
sme_°©e
 = 
SME_DISCONNECTED
;

1587 i‡((!
ªt
) &&

1588 (
vif
->
nw_ty≥
 =
INFRA_NETWORK
) &&

1589 (
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))) {

1590 i‡(
	`ã°_bô
(
DISCONNECT_PEND
, &
vif
->
Êags
)) {

1597 
	`£t_bô
(
DISCONNECT_PEND
, &
vif
->
Êags
);

1598 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

1599 !
	`ã°_bô
(
DISCONNECT_PEND
,

1600 &
vif
->
Êags
),

1601 (
HZ
/2));

1603 i‡(
	`sig«l_≥ndög
(
cuºít
)) {

1604 
	`©h6kl_îr
("wait DISCONNECTÅimeout!\n");

1605  -
EINTR
;

1610 
	}
}

1612 
	$©h6kl_cfg80211_disc⁄√˘_evít
(
©h6kl_vif
 *
vif
, 
u8
 
ªas⁄
,

1613 
u8
 *
bssid
, u8 
assoc_ª•_Àn
,

1614 
u8
 *
assoc_öfo
, 
u16
 
¥Ÿo_ªas⁄
)

1616 
©h6kl
 *
¨
 = 
vif
->ar;

1618 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
 | 
ATH6KL_DBG_EXT_INFO1
,

1620 
__func__
, 
ªas⁄
, 
¥Ÿo_ªas⁄
);

1622 i‡(
vif
->
sˇn_ªq
) {

1623 
	`dñ_timî
(&
vif
->
vifsˇn_timî
);

1624 
	`©h6kl_wmi_ab‹t_sˇn_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
);

1625 
	`cfg80211_sˇn_d⁄e
(
vif
->
sˇn_ªq
, 
åue
);

1626 
vif
->
sˇn_ªq
 = 
NULL
;

1627 
	`˛ór_bô
(
SCANNING
, &
vif
->
Êags
);

1628 #i‡
	`deföed
(
USB_AUTO_SUSPEND
)

1635 i‡(
	`ã°_™d_˛ór_bô
(
SCANNING
, &
¨
->
usb_aut›m_sˇn
)) {

1636 i‡(
	`©h6kl_hif_auto_pm_gë_ußge_˙t
(
¨
) == 0) {

1637 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1638 "%s: w¨¬ögÖm_ußge_˙à=0\n", 
__func__
);

1640 
	`©h6kl_hif_auto_pm_íabÀ
(
¨
);

1647 i‡(
vif
->
nw_ty≥
 & 
ADHOC_NETWORK
) {

1648 i‡(
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_ADHOC
) {

1649 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1650 "%s:áth6kÇŸ i¿ibs†mode\n", 
__func__
);

1655 i‡(
vif
->
nw_ty≥
 & 
INFRA_NETWORK
) {

1656 i‡(
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_STATION
 &&

1657 
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_P2P_CLIENT
) {

1658 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1659 "%s:áth6kÇŸ i¿°©i⁄ mode\n", 
__func__
);

1664 i‡(
vif
->
≥nd_skb
)

1665 
	`©h6kl_Êush_≥nd_skb
(
vif
);

1676 i‡(
ªas⁄
 !
DISCONNECT_CMD
) {

1677 
	`©h6kl_wmi_disc⁄√˘_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
);

1681 
	`˛ór_bô
(
CONNECT_PEND
, &
vif
->
Êags
);

1683 i‡(
vif
->
sme_°©e
 =
SME_CONNECTING
) {

1684 
	`©h6kl_cfg80211_c⁄√˘_ªsu…
(
vif
,

1685 
bssid
, 
NULL
, 0,

1686 
NULL
, 0,

1687 
WLAN_STATUS_UNSPECIFIED_FAILURE
,

1688 
GFP_KERNEL
);

1689 } i‡(
vif
->
sme_°©e
 =
SME_CONNECTED
) {

1690 
	`©h6kl_cfg80211_disc⁄√˘ed
(
vif
, 
¥Ÿo_ªas⁄
,

1691 
NULL
, 0, 
GFP_KERNEL
);

1693 #ifde‡
ATH6KL_DIAGNOSTIC


1694 
	`wifi_düg_mac_fsm_evít
(
vif
,

1695 (
wifi_düg_mac_fsm_t
)
WIFI_DIAG_MAC_FSM_DISCONNECTED
,

1696 
vif
->
düg
.
disc⁄√˘_£q_num
);

1699 
vif
->
sme_°©e
 = 
SME_DISCONNECTED
;

1701 i‡(
ªas⁄
 =
DISCONNECT_CMD
) {

1702 i‡(
	`ã°_bô
(
DISCONNECT_PEND
, &
vif
->
Êags
) &&

1703 (
vif
->
nw_ty≥
 =
INFRA_NETWORK
)) {

1704 
	`˛ór_bô
(
DISCONNECT_PEND
, &
vif
->
Êags
);

1705 
	`wake_up
(&
¨
->
evít_wq
);

1708 
	}
}

1710 
	$©h6kl_cfg80211_ch™ge_bss
(
wùhy
 *wiphy,

1711 
√t_devi˚
 *
ndev
, 
bss_∑ømëîs
 *
∑øms
)

1713 
©h6kl
 *
¨
 = (©h6k»*)
	`©h6kl_¥iv
(
ndev
);

1714 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

1716 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

1717  -
EIO
;

1719 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

1720 
	`©h6kl_îr
("busy, couldn't getáccess\n");

1721  -
ERESTARTSYS
;

1724 i‡(
∑øms
->
≠_isﬁ©e
 >= 0)

1725 
vif
->
öåa_bss
 = !
∑øms
->
≠_isﬁ©e
;

1729 
	`up
(&
¨
->
£m
);

1732 
	}
}

1734 
	$©h6kl_sˇn_timî_h™dÀr
(
±r
)

1736 
©h6kl_vif
 *
vif
 = (©h6kl_vi‡*)
±r
;

1737 
©h6kl
 *
¨
 = 
vif
->ar;

1739 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%†sˇ¿timî hô\n", 
__func__
);

1740 i‡(
vif
->
sˇn_ªq
) {

1741 
	`©h6kl_wmi_ab‹t_sˇn_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
);

1742 
	`cfg80211_sˇn_d⁄e
(
vif
->
sˇn_ªq
, 
åue
);

1743 
vif
->
sˇn_ªq
 = 
NULL
;

1744 
	`˛ór_bô
(
SCANNING
, &
vif
->
Êags
);

1745 #i‡
	`deföed
(
USB_AUTO_SUSPEND
)

1752 i‡(
	`ã°_™d_˛ór_bô
(
SCANNING
, &
¨
->
usb_aut›m_sˇn
)) {

1753 i‡(
	`©h6kl_hif_auto_pm_gë_ußge_˙t
(
¨
) == 0) {

1754 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1755 "%s: w¨¬ögÖm_ußge_˙à=0\n", 
__func__
);

1757 
	`©h6kl_hif_auto_pm_íabÀ
(
¨
);

1763 
	}
}

1766 
	$©h6kl_sˇn_timeout_ˇl
(
©h6kl
 *
¨
)

1768 
©h6kl_vif
 *
vif
;

1769 
u16
 
c⁄√˘ed_cou¡
 = 0;

1771 i‡(!(
¨
->
wùhy
->
Êags
 & 
WIPHY_FLAG_SUPPORTS_FW_ROAM
))

1772  
ATH6KL_SCAN_TIMEOUT_WITHOUT_ROAM
;

1774 i‡(
©h6kl_sˇn_timeout
 &&

1775 (
©h6kl_sˇn_timeout
 < 
ATH6KL_SCAN_TIMEOUT_SHORT
))

1776  
ATH6KL_SCAN_TIMEOUT_SHORT
;

1778 
	`li°_f‹_óch_íåy
(
vif
, &
¨
->
vif_li°
, 
li°
) {

1779 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)) {

1780 
c⁄√˘ed_cou¡
++;

1781 i‡(
c⁄√˘ed_cou¡
 > 1)

1782  
ATH6KL_SCAN_TIMEOUT_LONG
;

1786  
ATH6KL_SCAN_TIMEOUT_SHORT
;

1787 
	}
}

1789 
	$©h6kl_£t_¥obe_ªq_õs
(
©h6kl_vif
 *
vif
, c⁄° 
u8
 *
õs
,

1790 
size_t
 
õs_Àn
)

1792 
©h6kl
 *
¨
 = 
vif
->ar;

1793 c⁄° 
u8
 *
pos
;

1794 
u8
 *
buf
 = 
NULL
;

1795 
size_t
 
Àn
 = 0;

1796 
ªt
;

1801 i‡(
õs
 && 
õs_Àn
) {

1802 
buf
 = 
	`kmÆloc
(
õs_Àn
, 
GFP_KERNEL
);

1803 i‡(
buf
 =
NULL
)

1804  -
ENOMEM
;

1805 
pos
 = 
õs
;

1807 
pos
 + 1 < 
õs
 + 
õs_Àn
) {

1808 i‡(
pos
 + 2 +Öos[1] > 
õs
 + 
õs_Àn
)

1810 i‡((
	`©h6kl_is_p2p_õ
(
pos
) ||

1811 
	`©h6kl_is_wfd_õ
(
pos
)) &&

1812 !
	`©h6kl_p2p_õ_≠≥nd
(
vif
,

1813 
P2P_IE_IN_PROBE_REQ
))

1814 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

1817 
	`mem˝y
(
buf
 + 
Àn
, 
pos
, 2 +Öos[1]);

1818 
Àn
 +2 + 
pos
[1];

1820 
pos
 += 2 +Öos[1];

1824 
ªt
 = 
	`©h6kl_wmi_£t_≠põ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1825 
WMI_FRAME_PROBE_REQ
, 
buf
, 
Àn
);

1826 
	`k‰ì
(
buf
);

1828  
ªt
;

1829 
	}
}

1831 
boﬁ
 
	$_©h6kl_sˇnb™d_ign‹e_ch
(
©h6kl_vif
 *
vif
, 
u16
 
‰eq
)

1833 
i
;

1835 
i
 = 0; i < 64; i++) {

1836 i‡(
‰eq
 =
vif
->
sˇnb™d_ign‹e_ch™
[
i
])

1837  
åue
;

1838 i‡(
vif
->
sˇnb™d_ign‹e_ch™
[
i
] == 0)

1839  
Ál£
;

1842  
Ál£
;

1843 
	}
}

1845 
s8
 
	$©h6kl_sˇnb™d
(
©h6kl_vif
 *
vif
,

1846 
u16
 *
ch™√ls
,

1847 
s8
 
n_ch™√ls
,

1848 
cfg80211_sˇn_ªque°
 *
ªque°
)

1850 
i
;

1851 
u8
 
skù_ch™_num
 = 0;

1852 
u8
 
num_ch™
 = 
n_ch™√ls
;

1854 
vif
->
sˇnb™d_ty≥
) {

1855 
SCANBAND_TYPE_CHAN_ONLY
:

1856 
ch™√ls
[0] = 
vif
->
sˇnb™d_ch™
;

1857 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1859 
ch™√ls
[0]);

1860 
num_ch™
 = 1;

1862 
SCANBAND_TYPE_5G
:

1863 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1865 
i
 = 0; i < 
n_ch™√ls
; i++) {

1866 i‡(
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
 <= 2484) {

1867 
skù_ch™_num
++;

1870 
ch™√ls
[
i
 - 
skù_ch™_num
] =

1871 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
;

1872 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1873 "%d ", 
ch™√ls
[
i
 - 
skù_ch™_num
]);

1875 
num_ch™
 -
skù_ch™_num
;

1877 
SCANBAND_TYPE_2G
:

1878 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1880 
i
 = 0; i < 
n_ch™√ls
; i++) {

1881 i‡(
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
 > 2484) {

1882 
skù_ch™_num
++;

1885 
ch™√ls
[
i
 - 
skù_ch™_num
] =

1886 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
;

1887 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1888 "%d ", 
ch™√ls
[
i
 - 
skù_ch™_num
]);

1890 
num_ch™
 -
skù_ch™_num
;

1892 
SCANBAND_TYPE_P2PCHAN
:

1893 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1895 
i
 = 0; i < 
n_ch™√ls
; i++) {

1896 i‡(!
	`©h6kl_ªg_is_p2p_ch™√l
(
vif
->
¨
,

1897 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
)) {

1898 
skù_ch™_num
++;

1901 
ch™√ls
[
i
 - 
skù_ch™_num
] =

1902 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
;

1903 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1904 "%d ", 
ch™√ls
[
i
 - 
skù_ch™_num
]);

1906 
num_ch™
 -
skù_ch™_num
;

1908 
SCANBAND_TYPE_2_P2PCHAN
:

1909 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1911 
i
 = 0; i < 
n_ch™√ls
; i++) {

1912 i‡(!
	`©h6kl_ªg_is_p2p_ch™√l
(
vif
->
¨
,

1913 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
)) {

1914 
skù_ch™_num
++;

1917 
ch™√ls
[
i
 - 
skù_ch™_num
] =

1918 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
;

1919 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1920 "%d ", 
ch™√ls
[
i
 - 
skù_ch™_num
]);

1922 
num_ch™
 -
skù_ch™_num
;

1924 i‡(
num_ch™
 <(
WMI_MAX_CHANNELS
 >> 1)) {

1925 
	`mem˝y
(&
ch™√ls
[
num_ch™
],

1926 &
ch™√ls
[0],

1927 
num_ch™
 * (
u16
));

1928 
num_ch™
 *= 2;

1931 
SCANBAND_TYPE_IGNORE_DFS
:

1932 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1934 
i
 = 0; i < 
n_ch™√ls
; i++) {

1935 i‡(
	`©h6kl_ªg_is_dfs_ch™√l
(
vif
->
¨
,

1936 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
)) {

1937 
skù_ch™_num
++;

1940 
ch™√ls
[
i
 - 
skù_ch™_num
] =

1941 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
;

1942 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1943 "%d ", 
ch™√ls
[
i
 - 
skù_ch™_num
]);

1945 
num_ch™
 -
skù_ch™_num
;

1947 
SCANBAND_TYPE_IGNORE_CH
:

1948 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1950 
i
 = 0; i < 
n_ch™√ls
; i++) {

1951 i‡(
	`_©h6kl_sˇnb™d_ign‹e_ch
(
vif
,

1952 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
)) {

1953 
skù_ch™_num
++;

1956 
ch™√ls
[
i
 - 
skù_ch™_num
] =

1957 
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
;

1958 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1959 "%d ", 
ch™√ls
[
i
 - 
skù_ch™_num
]);

1961 
num_ch™
 -
skù_ch™_num
;

1964 
i
 = 0; i < 
n_ch™√ls
; i++)

1965 
ch™√ls
[
i
] = 
ªque°
->ch™√ls[i]->
˚¡î_‰eq
;

1969  
num_ch™
;

1970 
	}
}

1972 
	$_©h6kl_cfg80211_sˇn
(
wùhy
 *wùhy, 
√t_devi˚
 *
ndev
,

1973 
cfg80211_sˇn_ªque°
 *
ªque°
)

1975 
©h6kl
 *
¨
 = (©h6k»*)
	`©h6kl_¥iv
(
ndev
);

1976 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

1977 
s8
 
n_ch™√ls
 = 0;

1978 
u16
 *
ch™√ls
 = 
NULL
;

1979 
ªt
 = 0;

1980 
u32
 
f‹˚_fg_sˇn
 = 0;

1981 
boﬁ
 
sche_sˇn_åig
, 
À·
;

1983 i‡(
	`ã°_bô
(
DISABLE_SCAN
, &
¨
->
Êag
)) {

1984 
	`©h6kl_îr
("scan is disabledÅemporarily\n");

1985  -
EIO
;

1988 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

1989  -
EIO
;

1991 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

1992 
	`©h6kl_îr
("busy, couldn't getáccess\n");

1993  -
ERESTARTSYS
;

1996 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s\n", 
__func__
);

2002 i‡(
	`ã°_bô
(
ROC_CANCEL_PEND
, &
vif
->
Êags
)) {

2003 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

2005 
vif
->
œ°_ˇn˚l_roc_id
);

2007 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

2008 !
	`ã°_bô
(
ROC_ONGOING
, &
vif
->
Êags
),

2009 
WMI_TIMEOUT
);

2010 i‡(
	`sig«l_≥ndög
(
cuºít
)) {

2011 
	`©h6kl_îr
("RoC :Åarget didÇotÑespond\n");

2012 
	`up
(&
¨
->
£m
);

2013  -
EINTR
;

2018 i‡(
	`ã°_bô
(
ROC_ONGOING
, &
vif
->
Êags
)) {

2019 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

2021 
vif
->
œ°_roc_id
);

2023 
	`£t_bô
(
ROC_CANCEL_PEND
, &
vif
->
Êags
);

2024 i‡(
	`©h6kl_wmi_ˇn˚l_ªmaö_⁄_ch∆_cmd
(
¨
->
wmi
,

2025 
vif
->
fw_vif_idx
) != 0) {

2026 
	`©h6kl_îr
("RoC : cancel ROC failed\n");

2027 
	`˛ór_bô
(
ROC_CANCEL_PEND
, &
vif
->
Êags
);

2028 
	`up
(&
¨
->
£m
);

2029  -
EIO
;

2032 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

2033 !
	`ã°_bô
(
ROC_ONGOING
, &
vif
->
Êags
),

2034 
WMI_TIMEOUT
);

2036 i‡(
À·
 == 0) {

2037 
	`©h6kl_îr
("RoC : wait cancel RoCÅimeout\n");

2038 
	`˛ór_bô
(
ROC_CANCEL_PEND
, &
vif
->
Êags
);

2039 
	`˛ór_bô
(
ROC_ONGOING
, &
vif
->
Êags
);

2040 
	`up
(&
¨
->
£m
);

2041  -
EINTR
;

2044 i‡(
	`sig«l_≥ndög
(
cuºít
)) {

2045 
	`©h6kl_îr
("RoC :Åarget didÇotÑespond\n");

2046 
	`up
(&
¨
->
£m
);

2047  -
EINTR
;

2051 
sche_sˇn_åig
 = 
	`©h6kl_sched_sˇn_åiggî
(
vif
);

2053 i‡(!
vif
->
u§_bss_fûãr
) {

2054 
	`˛ór_bô
(
CLEAR_BSSFILTER_ON_BEACON
, &
vif
->
Êags
);

2062 
ªt
 = 
	`©h6kl_wmi_bssfûãr_cmd
(

2063 
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
ALL_BSS_FILTER
 , 0);

2066 i‡(
ªt
) {

2067 
	`©h6kl_îr
("couldn't set bss filtering\n");

2068 
	`up
(&
¨
->
£m
);

2069  
ªt
;

2073 i‡((
ªque°
->
n_ssids
 &&Ñeque°->
ssids
[0].
ssid_Àn
) &&

2074 (!
sche_sˇn_åig
)) {

2075 
u8
 
i
;

2077 i‡(
ªque°
->
n_ssids
 > (
MAX_PROBED_SSID_INDEX
 - 1))

2078 
ªque°
->
n_ssids
 = 
MAX_PROBED_SSID_INDEX
 - 1;

2080 
i
 = 0; i < 
ªque°
->
n_ssids
; i++)

2081 
	`©h6kl_wmi_¥obedssid_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2082 
i
 + 1, 
SPECIFIC_SSID_FLAG
,

2083 
ªque°
->
ssids
[
i
].
ssid_Àn
,

2084 
ªque°
->
ssids
[
i
].
ssid
);

2085 } i‡(
¨
->
p2p
)

2086 
	`©h6kl_wmi_¥obedssid_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2087 
MAX_PROBED_SSID_INDEX
, 
ANY_SSID_FLAG
,

2089 
NULL
);

2091 i‡((
ªque°
->
õ
) &&

2092 (!
sche_sˇn_åig
)) {

2093 
ªt
 = 
	`©h6kl_£t_¥obe_ªq_õs
(
vif
,

2094 
ªque°
->
õ
,

2095 
ªque°
->
õ_Àn
);

2096 i‡(
ªt
) {

2097 
	`©h6kl_îr
("failedÅo set Probe Requestáppie for "

2099 
	`up
(&
¨
->
£m
);

2100  
ªt
;

2109 i‡((
ªque°
->
n_ch™√ls
 > 0 &&

2110 
ªque°
->
n_ch™√ls
 <
WMI_MAX_CHANNELS
) &&

2111 (!
sche_sˇn_åig
)) {

2113 
n_ch™√ls
 = 
ªque°
->n_channels;

2115 
ch™√ls
 = 
	`kzÆloc
(
n_ch™√ls
 * (
u16
Ë* 2, 
GFP_KERNEL
);

2116 i‡(
ch™√ls
 =
NULL
) {

2117 
	`©h6kl_w¨n
("failedÅo set scan channels, "

2119 
n_ch™√ls
 = 0;

2122 i‡(
n_ch™√ls
) {

2124 
n_ch™√ls
 = 
	`©h6kl_sˇnb™d
(
vif
,

2125 
ch™√ls
,

2126 
n_ch™√ls
,

2127 
ªque°
);

2131 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))

2132 
f‹˚_fg_sˇn
 = 1;

2134 i‡(
	`ã°_™d_£t_bô
(
SCANNING
, &
vif
->
Êags
)) {

2135 
	`k‰ì
(
ch™√ls
);

2136 
	`up
(&
¨
->
£m
);

2137  -
EBUSY
;

2140 i‡(
	`ã°_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
) ||

2141 
	`ã°_bô
(
EAPOL_HANDSHAKE_PROTECT
, &
¨
->
Êag
)) {

2142 
	`©h6kl_öfo
("EAPOL %s_handshake_protectÑeject scan\n",

2143 (
	`ã°_bô
(
EAPOL_HANDSHAKE_PROTECT
, &
¨
->
Êag
) ?

2145 
	`˛ór_bô
(
SCANNING
, &
vif
->
Êags
);

2146 
	`k‰ì
(
ch™√ls
);

2147 
	`up
(&
¨
->
£m
);

2148  -
EBUSY
;

2151 
ªt
 = 
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2152 
vif
->
sc_∑øms
.
fg_°¨t_≥riod
,

2153 
vif
->
sc_∑øms
.
fg_íd_≥riod
,

2154 
vif
->
sc_∑øms
.
bg_≥riod
,

2155 
vif
->
sc_∑øms
.
möa˘_chdwñl_time
,

2156 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
,

2157 
vif
->
sc_∑øms
.
∑s_chdwñl_time
,

2158 
vif
->
sc_∑øms
.
sh‹t_sˇn_øtio
,

2159 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
,

2160 
vif
->
sc_∑øms
.
max_dfsch_a˘_time
,

2161 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
);

2163 i‡(
ªt
) {

2164 
	`©h6kl_îr
("ath6kl_cfg80211_scan: set scanÖarameter failed\n");

2165 
	`˛ór_bô
(
SCANNING
, &
vif
->
Êags
);

2166 
	`k‰ì
(
ch™√ls
);

2167 
	`up
(&
¨
->
£m
);

2168  
ªt
;

2171 
ªt
 = 
	`©h6kl_wmi_°¨tsˇn_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
WMI_LONG_SCAN
,

2172 
f‹˚_fg_sˇn
, 
Ál£
, 0,

2173 
ATH6KL_FG_SCAN_INTERVAL
,

2174 
n_ch™√ls
, 
ch™√ls
);

2175 i‡(
ªt
) {

2176 
	`©h6kl_îr
("wmi_startscan_cmd failed\n");

2177 
	`˛ór_bô
(
SCANNING
, &
vif
->
Êags
);

2179 
vif
->
sˇn_ªq
 = 
ªque°
;

2180 
	`mod_timî
(&
vif
->
vifsˇn_timî
,

2181 
jiffõs
 + 
	`©h6kl_sˇn_timeout_ˇl
(
¨
));

2182 #ifde‡
USB_AUTO_SUSPEND


2183 
	`£t_bô
(
SCANNING
, &
¨
->
usb_aut›m_sˇn
);

2184 
	`©h6kl_hif_auto_pm_dißbÀ
(
¨
);

2188 
	`k‰ì
(
ch™√ls
);

2190 
	`©h6kl_bss_po°_¥oc_bss_sˇn_°¨t
(
vif
);

2191 
	`©h6kl_p2p_rc_sˇn_°¨t
(
vif
, 
Ál£
);

2193 
	`up
(&
¨
->
£m
);

2197  
ªt
;

2198 
	}
}

2200 #ifde‡
CFG80211_NETDEV_REPLACED_BY_WDEV


2201 
	$©h6kl_cfg80211_sˇn
(
wùhy
 *wiphy,

2202 
cfg80211_sˇn_ªque°
 *
ªque°
)

2204 
	`BUG_ON
(!
ªque°
->
wdev
);

2205 
	`BUG_ON
(!
ªque°
->
wdev
->
√tdev
);

2207  
	`_©h6kl_cfg80211_sˇn
(
wùhy
,

2208 
ªque°
->
wdev
->
√tdev
,

2209 
ªque°
);

2210 
	}
}

2212 
	$©h6kl_cfg80211_sˇn
(
wùhy
 *wùhy, 
√t_devi˚
 *
ndev
,

2213 
cfg80211_sˇn_ªque°
 *
ªque°
)

2215  
	`_©h6kl_cfg80211_sˇn
(
wùhy
, 
ndev
, 
ªque°
);

2216 
	}
}

2219 
	$©h6kl_cfg80211_sˇn_com∂ëe_evít
(
©h6kl_vif
 *
vif
, 
boﬁ
 
ab‹ãd
)

2221 
©h6kl
 *
¨
 = 
vif
->ar;

2222 
i
;

2224 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: sètus%s\n", 
__func__
,

2225 
ab‹ãd
 ? "áborted" : "");

2226 #i‡
	`deföed
(
USB_AUTO_SUSPEND
)

2233 i‡(
	`ã°_™d_˛ór_bô
(
SCANNING
, &
¨
->
usb_aut›m_sˇn
)) {

2234 i‡(
	`©h6kl_hif_auto_pm_gë_ußge_˙t
(
¨
) == 0) {

2235 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

2236 "%s: w¨¬ögÖm_ußge_˙à=0\n", 
__func__
);

2238 
	`©h6kl_hif_auto_pm_íabÀ
(
¨
);

2243 
	`dñ_timî
(&
vif
->
vifsˇn_timî
);

2245 i‡(
	`ã°_bô
(
SCANNING_WAIT
, &
vif
->
Êags
)) {

2246 
	`˛ór_bô
(
SCANNING_WAIT
, &
vif
->
Êags
);

2247 
	`wake_up
(&
¨
->
evít_wq
);

2250 i‡(!
vif
->
sˇn_ªq
)

2253 i‡(
ab‹ãd
)

2254 
out
;

2256 i‡(
vif
->
sˇn_ªq
->
n_ssids
 && vif->sˇn_ªq->
ssids
[0].
ssid_Àn
) {

2257 
i
 = 0; i < 
vif
->
sˇn_ªq
->
n_ssids
; i++) {

2258 
	`©h6kl_wmi_¥obedssid_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2259 
i
 + 1, 
DISABLE_SSID_FLAG
,

2260 0, 
NULL
);

2262 } i‡(
¨
->
p2p
)

2263 
	`©h6kl_wmi_¥obedssid_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2264 
MAX_PROBED_SSID_INDEX
,

2265 
DISABLE_SSID_FLAG
,

2266 0, 
NULL
);

2268 
out
:

2269 
	`cfg80211_sˇn_d⁄e
(
vif
->
sˇn_ªq
, 
ab‹ãd
);

2270 
vif
->
sˇn_ªq
 = 
NULL
;

2271 
	`˛ór_bô
(
SCANNING
, &
vif
->
Êags
);

2272 
	}
}

2274 #ifde‡
PMF_SUPPORT


2275 
	$©h6kl_cfg80211_add_mgmt_key
(
wùhy
 *wiphy,

2276 
√t_devi˚
 *
ndev
,

2277 
u8
 
key_ödex
, 
boﬁ
 
∑úwi£
,

2278 c⁄° 
u8
 *
mac_addr
,

2279 
key_∑øms
 *
∑øms
)

2281 
©h6kl
 *
¨
 = (©h6k»*)
	`©h6kl_¥iv
(
ndev
);

2282 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

2283 
©h6kl_key
 *
key
 = 
NULL
;

2284 
wmi_sync_Êag
 
sync_Êag
 = 
NO_SYNC_WMIFLAG
;

2285 
ªt
;

2287 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

2288  -
EIO
;

2290 i‡(!
∑øms
)

2291  -
EINVAL
;

2293 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2294 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2295  -
ERESTARTSYS
;

2298 i‡(
key_ödex
 < 
WMI_MIN_IGTK_INDEX
 || key_ödex > 
WMI_MAX_IGTK_INDEX
) {

2299 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

2300 "%s: key index %d ouào‡bounds\n", 
__func__
,

2301 
key_ödex
);

2302 
	`up
(&
¨
->
£m
);

2303  -
ENOENT
;

2306 
key
 = &
vif
->
keys
[
key_ödex
];

2307 
	`mem£t
(
key
, 0, (
©h6kl_key
));

2309 i‡(
∑øms
) {

2310 
£q_Àn
 = 
∑øms
->seq_len;

2311 i‡(
∑øms
->
key_Àn
 > 
WMI_IGTK_KEY_LEN
 ||

2312 
£q_Àn
 > (
key
->
£q
)) {

2313 
	`up
(&
¨
->
£m
);

2314  -
EINVAL
;

2317 
key
->
key_Àn
 = 
∑øms
->key_len;

2318 
	`mem˝y
(
key
->key, 
∑øms
->key, key->
key_Àn
);

2319 
key
->
£q_Àn
 = seq_len;

2320 
	`mem˝y
(
key
->
£q
, 
∑øms
->£q, key->
£q_Àn
);

2321 
key
->
cùhî
 = 
∑øms
->cipher;

2324 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
 && !
∑úwi£
 && 
∑øms
) {

2329 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_WMI_SYC
))

2330 
sync_Êag
 = 
NO_SYNC_WMIFLAG
;

2332 
ªt
 = 
	`©h6kl_wmi_addkey_igtk_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
key_ödex
,

2333 
key
->
key_Àn
, key->
£q
,

2334 
key
->key, 
sync_Êag
);

2336 
	`up
(&
¨
->
£m
);

2337  
ªt
;

2338 
	}
}

2341 
	$©h6kl_cfg80211_add_key
(
wùhy
 *wiphy,

2342 
√t_devi˚
 *
ndev
,

2343 
u8
 
key_ödex
, 
boﬁ
 
∑úwi£
,

2344 c⁄° 
u8
 *
mac_addr
,

2345 
key_∑øms
 *
∑øms
)

2347 
©h6kl
 *
¨
 = (©h6k»*)
	`©h6kl_¥iv
(
ndev
);

2348 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

2349 
©h6kl_key
 *
key
 = 
NULL
;

2350 
wmi_sync_Êag
 
sync_Êag
 = 
SYNC_BOTH_WMIFLAG
;

2351 
u8
 
key_ußge
;

2352 
u8
 
key_ty≥
;

2353 
ªt
;

2355 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

2356  -
EIO
;

2358 i‡(!
∑øms
)

2359  -
EINVAL
;

2361 #ifde‡
PMF_SUPPORT


2362 i‡(
∑øms
->
cùhî
 =
WLAN_CIPHER_SUITE_AES_CMAC
)

2363  
	`©h6kl_cfg80211_add_mgmt_key
(
wùhy
, 
ndev
, 
key_ödex
,

2364 
∑úwi£
, 
mac_addr
, 
∑øms
);

2367 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2368 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2369  -
ERESTARTSYS
;

2372 i‡(
∑øms
->
cùhî
 =
CCKM_KRK_CIPHER_SUITE
) {

2373 i‡(
∑øms
->
key_Àn
 !
WMI_KRK_LEN
) {

2374 
	`up
(&
¨
->
£m
);

2375  -
EINVAL
;

2378 
ªt
 = 
	`©h6kl_wmi_add_krk_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2379 
∑øms
->
key
);

2380 
	`up
(&
¨
->
£m
);

2381  
ªt
;

2384 i‡(
key_ödex
 > 
WMI_MAX_KEY_INDEX
) {

2385 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

2386 "%s: key index %d ouào‡bounds\n", 
__func__
,

2387 
key_ödex
);

2388 
	`up
(&
¨
->
£m
);

2389  -
ENOENT
;

2392 
key
 = &
vif
->
keys
[
key_ödex
];

2393 
	`mem£t
(
key
, 0, (
©h6kl_key
));

2395 i‡(
∑úwi£
)

2396 
key_ußge
 = 
PAIRWISE_USAGE
;

2398 
key_ußge
 = 
GROUP_USAGE
;

2400 i‡(
∑øms
) {

2401 
£q_Àn
 = 
∑øms
->seq_len;

2402 i‡(
∑øms
->
cùhî
 =
WLAN_CIPHER_SUITE_SMS4
 &&

2403 
£q_Àn
 > 
ATH6KL_KEY_SEQ_LEN
) {

2405 
£q_Àn
 = 
ATH6KL_KEY_SEQ_LEN
;

2407 i‡(
∑øms
->
key_Àn
 > 
WLAN_MAX_KEY_LEN
 ||

2408 
£q_Àn
 > (
key
->
£q
)) {

2409 
	`up
(&
¨
->
£m
);

2410  -
EINVAL
;

2413 
key
->
key_Àn
 = 
∑øms
->key_len;

2414 
	`mem˝y
(
key
->key, 
∑øms
->key, key->
key_Àn
);

2415 
key
->
£q_Àn
 = seq_len;

2416 
	`mem˝y
(
key
->
£q
, 
∑øms
->£q, key->
£q_Àn
);

2417 
key
->
cùhî
 = 
∑øms
->cipher;

2420 
key
->
cùhî
) {

2421 
WLAN_CIPHER_SUITE_WEP40
:

2422 
WLAN_CIPHER_SUITE_WEP104
:

2423 
key_ty≥
 = 
WEP_CRYPT
;

2426 
WLAN_CIPHER_SUITE_TKIP
:

2427 
key_ty≥
 = 
TKIP_CRYPT
;

2430 
WLAN_CIPHER_SUITE_CCMP
:

2431 
key_ty≥
 = 
AES_CRYPT
;

2433 
WLAN_CIPHER_SUITE_SMS4
:

2434 
key_ty≥
 = 
WAPI_CRYPT
;

2438 
	`up
(&
¨
->
£m
);

2439  -
ENOTSUPP
;

2442 i‡(((
vif
->
auth_mode
 =
WPA_PSK_AUTH
)

2443 || (
vif
->
auth_mode
 =
WPA2_PSK_AUTH
))

2444 && (
key_ußge
 & 
GROUP_USAGE
))

2445 
	`dñ_timî
(&
vif
->
disc⁄√˘_timî
);

2447 i‡(
key_ußge
 & 
GROUP_USAGE
) {

2448 i‡(
vif
->
≥nd_skb
) {

2449 
	`©h6kl_îr
("eapolÖrotect shall be offálready\n");

2450 
	`©h6kl_Êush_≥nd_skb
(
vif
);

2453 
	`•ö_lock_bh
(&
vif
->
if_lock
);

2454 
	`˛ór_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
);

2455 
	`dñ_timî
(&
vif
->
sh¥Ÿe˘_timî
);

2456 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

2459 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

2461 
__func__
, 
key_ödex
, 
key
->
key_Àn
, 
key_ty≥
,

2462 
key_ußge
, 
key
->
£q_Àn
);

2464 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
 && !
∑úwi£
 &&

2465 (
key_ty≥
 =
TKIP_CRYPT
 || key_ty≥ =
AES_CRYPT
Ë&& 
∑øms
) {

2466 
vif
->
≠_mode_bkey
.
vÆid
 = 
åue
;

2467 
vif
->
≠_mode_bkey
.
key_ödex
 = key_index;

2468 
vif
->
≠_mode_bkey
.
key_ty≥
 = key_type;

2469 
vif
->
≠_mode_bkey
.
key_Àn
 = 
key
->key_len;

2470 
	`mem˝y
(
vif
->
≠_mode_bkey
.
key
, key->key, key->
key_Àn
);

2471 i‡(!
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)) {

2472 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "Delay initial group "

2479 
	`up
(&
¨
->
£m
);

2484 i‡(
vif
->
√xt_mode
 =
AP_NETWORK
 && 
key_ty≥
 =
WEP_CRYPT
 &&

2485 !
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)) {

2491 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "Delay WEP key configuration "

2493 
vif
->
wï_key_li°
[
key_ödex
].
key_Àn
 = 
key
->key_len;

2494 
	`mem˝y
(
vif
->
wï_key_li°
[
key_ödex
].
key
, key->key,

2495 
key
->
key_Àn
);

2496 
	`up
(&
¨
->
£m
);

2500 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_WMI_SYC
))

2501 
sync_Êag
 = 
NO_SYNC_WMIFLAG
;

2503 
ªt
 = 
	`©h6kl_wmi_addkey_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
key_ödex
,

2504 
key_ty≥
, 
key_ußge
, 
key
->
key_Àn
,

2505 
key
->
£q
, key->
£q_Àn
, key->key,

2506 
KEY_OP_INIT_VAL
,

2507 (
u8
 *Ë
mac_addr
, 
sync_Êag
);

2509 
	`up
(&
¨
->
£m
);

2511  
ªt
;

2512 
	}
}

2514 
	$©h6kl_cfg80211_dñ_key
(
wùhy
 *wùhy, 
√t_devi˚
 *
ndev
,

2515 
u8
 
key_ödex
, 
boﬁ
 
∑úwi£
,

2516 c⁄° 
u8
 *
mac_addr
)

2518 
©h6kl
 *
¨
 = (©h6k»*)
	`©h6kl_¥iv
(
ndev
);

2519 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

2520 
ªt
;

2522 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: index %d\n", 
__func__
, 
key_ödex
);

2524 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

2525  -
EIO
;

2527 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2528 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2529  -
ERESTARTSYS
;

2532 i‡(
key_ödex
 > 
WMI_MAX_KEY_INDEX
) {

2533 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

2534 "%s: key index %d ouào‡bounds\n", 
__func__
,

2535 
key_ödex
);

2536 
	`up
(&
¨
->
£m
);

2537  -
ENOENT
;

2540 i‡(!
vif
->
keys
[
key_ödex
].
key_Àn
) {

2541 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

2542 "%s: index %d i†em±y\n", 
__func__
, 
key_ödex
);

2543 
	`up
(&
¨
->
£m
);

2547 
vif
->
keys
[
key_ödex
].
key_Àn
 = 0;

2549 
ªt
 = 
	`©h6kl_wmi_dñëekey_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
key_ödex
);

2551 
	`up
(&
¨
->
£m
);

2553  
ªt
;

2554 
	}
}

2556 
©h6kl_cfg80211_gë_key
(
wùhy
 *wùhy, 
√t_devi˚
 *
ndev
,

2557 
u8
 
key_ödex
, 
boﬁ
 
∑úwi£
,

2558 c⁄° 
u8
 *
mac_addr
, *
cookõ
,

2559 (*
ˇŒback
Ë(*
cookõ
,

2560 
key_∑øms
 *))

2562 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

2563 
©h6kl_key
 *
key
 = 
NULL
;

2564 
key_∑øms
 
∑øms
;

2566 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: index %d\n", 
__func__
, 
key_ödex
);

2568 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

2569  -
EIO
;

2571 i‡(
	`down_öãºu±ibÀ
(&
vif
->
¨
->
£m
)) {

2572 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2573  -
ERESTARTSYS
;

2576 i‡(
key_ödex
 > 
WMI_MAX_KEY_INDEX
) {

2577 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

2578 "%s: key index %d ouào‡bounds\n", 
__func__
,

2579 
key_ödex
);

2580 
	`up
(&
vif
->
¨
->
£m
);

2581  -
ENOENT
;

2584 
key
 = &
vif
->
keys
[
key_ödex
];

2585 
	`mem£t
(&
∑øms
, 0, (params));

2586 
∑øms
.
cùhî
 = 
key
->cipher;

2587 
∑øms
.
key_Àn
 = 
key
->key_len;

2588 
∑øms
.
£q_Àn
 = 
key
->seq_len;

2589 
∑øms
.
£q
 = 
key
->seq;

2590 
∑øms
.
key
 = key->key;

2592 
	`ˇŒback
(
cookõ
, &
∑øms
);

2594 
	`up
(&
vif
->
¨
->
£m
);

2596  
key
->
key_Àn
 ? 0 : -
ENOENT
;

2597 
	}
}

2599 
	$©h6kl_cfg80211_£t_deÁu…_key
(
wùhy
 *wiphy,

2600 
√t_devi˚
 *
ndev
,

2601 
u8
 
key_ödex
, 
boﬁ
 
uniˇ°
,

2602 
boﬁ
 
mu…iˇ°
)

2604 
©h6kl
 *
¨
 = (©h6k»*)
	`©h6kl_¥iv
(
ndev
);

2605 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

2606 
©h6kl_key
 *
key
 = 
NULL
;

2607 
u8
 
key_ußge
;

2608 
¸y±o_ty≥
 
key_ty≥
 = 
NONE_CRYPT
;

2609 
wmi_sync_Êag
 
sync_Êag
 = 
SYNC_BOTH_WMIFLAG
;

2610 
ªt
;

2612 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: index %d\n", 
__func__
, 
key_ödex
);

2614 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

2615  -
EIO
;

2617 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2618 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2619  -
ERESTARTSYS
;

2622 i‡(
key_ödex
 > 
WMI_MAX_KEY_INDEX
) {

2623 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

2625 
__func__
, 
key_ödex
);

2626 
	`up
(&
¨
->
£m
);

2627  -
ENOENT
;

2630 i‡(!
vif
->
keys
[
key_ödex
].
key_Àn
) {

2631 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: invalid key index %d\n",

2632 
__func__
, 
key_ödex
);

2633 
	`up
(&
¨
->
£m
);

2634  -
EINVAL
;

2637 
vif
->
def_txkey_ödex
 = 
key_ödex
;

2638 
key
 = &
vif
->
keys
[vif->
def_txkey_ödex
];

2639 
key_ußge
 = 
GROUP_USAGE
;

2640 i‡(
vif
->
¥wi£_¸y±o
 =
WEP_CRYPT
)

2641 
key_ußge
 |
TX_USAGE
;

2642 i‡(
uniˇ°
)

2643 
key_ty≥
 = 
vif
->
¥wi£_¸y±o
;

2644 i‡(
mu…iˇ°
)

2645 
key_ty≥
 = 
vif
->
gΩ_¸y±o
;

2647 i‡(
vif
->
√xt_mode
 ==

2648 
AP_NETWORK
 && !
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)) {

2649 
	`up
(&
¨
->
£m
);

2653 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_WMI_SYC
))

2654 
sync_Êag
 = 
NO_SYNC_WMIFLAG
;

2656 
ªt
 = 
	`©h6kl_wmi_addkey_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2657 
vif
->
def_txkey_ödex
,

2658 
key_ty≥
, 
key_ußge
,

2659 
key
->
key_Àn
, key->
£q
, key->
£q_Àn
,

2660 
key
->key,

2661 
KEY_OP_INIT_VAL
, 
NULL
,

2662 
sync_Êag
);

2664 
	`up
(&
¨
->
£m
);

2666  
ªt
;

2667 
	}
}

2669 
	$©h6kl_cfg80211_tkù_mi˚º_evít
(
©h6kl_vif
 *
vif
, 
u8
 
keyid
,

2670 
boﬁ
 
ismˇ°
)

2672 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

2673 "%s: keyid %d, ismˇ° %d\n", 
__func__
, 
keyid
, 
ismˇ°
);

2675 
	`cfg80211_mich´l_mic_Áûuª
(
vif
->
ndev
, vif->
bssid
,

2676 (
ismˇ°
 ? 
NL80211_KEYTYPE_GROUP
 :

2677 
NL80211_KEYTYPE_PAIRWISE
), 
keyid
, 
NULL
,

2678 
GFP_KERNEL
);

2679 
	}
}

2681 
	$©h6kl_cfg80211_£t_wùhy_∑øms
(
wùhy
 *wùhy, 
u32
 
ch™ged
)

2683 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

2684 
©h6kl_vif
 *
vif
;

2685 
ªt
;

2687 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: ch™ged 0x%x\n", 
__func__
,

2688 
ch™ged
);

2690 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

2691 i‡(!
vif
)

2692  -
EIO
;

2694 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

2695  -
EIO
;

2697 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2698 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2699  -
ERESTARTSYS
;

2702 i‡(
ch™ged
 & 
WIPHY_PARAM_RTS_THRESHOLD
) {

2703 
ªt
 = 
	`©h6kl_wmi_£t_πs_cmd
(
¨
->
wmi
, 0, 
wùhy
->
πs_thªshﬁd
);

2704 i‡(
ªt
 != 0) {

2705 
	`©h6kl_îr
("ath6kl_wmi_set_rts_cmd failed\n");

2706 
	`up
(&
¨
->
£m
);

2707  -
EIO
;

2711 
	`up
(&
¨
->
£m
);

2714 
	}
}

2720 
	$_©h6kl_cfg80211_£t_txpowî
(
wùhy
 *wiphy,

2721 
√t_devi˚
 *
ndev
,

2722 
∆80211_tx_powî_£âög
 
ty≥
,

2723 
mbm
)

2725 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

2726 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

2727 
u8
 
©h6kl_dbm
;

2728 
dbm
 = 
	`MBM_TO_DBM
(
mbm
);

2730 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s:Åy≥ 0x%x, dbm %d\n", 
__func__
,

2731 
ty≥
, 
dbm
);

2733 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

2734  -
EIO
;

2736 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2737 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2738  -
ERESTARTSYS
;

2741 
ty≥
) {

2742 
NL80211_TX_POWER_AUTOMATIC
:

2743 
	`up
(&
¨
->
£m
);

2745 
NL80211_TX_POWER_LIMITED
:

2746 
¨
->
tx_pwr
 = 
©h6kl_dbm
 = 
dbm
;

2749 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s:Åype 0x%xÇot supported\n",

2750 
__func__
, 
ty≥
);

2751 
	`up
(&
¨
->
£m
);

2752  -
EOPNOTSUPP
;

2755 
	`©h6kl_wmi_£t_tx_pwr_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
©h6kl_dbm
);

2757 
	`up
(&
¨
->
£m
);

2760 
	}
}

2762 
	$_©h6kl_cfg80211_gë_txpowî
(
wùhy
 *wiphy,

2763 
√t_devi˚
 *
ndev
,

2764 *
dbm
)

2766 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

2767 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

2769 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

2770  -
EIO
;

2772 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2773 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2774  -
ERESTARTSYS
;

2777 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)) {

2778 
¨
->
tx_pwr
 = 0;

2780 i‡(
	`©h6kl_wmi_gë_tx_pwr_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
) != 0) {

2781 
	`©h6kl_îr
("ath6kl_wmi_get_tx_pwr_cmd failed\n");

2782 
	`up
(&
¨
->
£m
);

2783  -
EIO
;

2786 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,ár->
tx_pwr
 != 0,

2787 5 * 
HZ
);

2789 i‡(
	`sig«l_≥ndög
(
cuºít
)) {

2790 
	`©h6kl_îr
("target didÇotÑespond\n");

2791 
	`up
(&
¨
->
£m
);

2792  -
EINTR
;

2796 *
dbm
 = 
¨
->
tx_pwr
;

2798 
	`up
(&
¨
->
£m
);

2801 
	}
}

2803 #ifde‡
CFG80211_TX_POWER_PER_WDEV


2804 
	$©h6kl_cfg80211_£t_txpowî
(
wùhy
 *wiphy,

2805 
wúñess_dev
 *
wdev
,

2806 
∆80211_tx_powî_£âög
 
ty≥
,

2807 
mbm
)

2809 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

2810 
√t_devi˚
 *
ndev
;

2812 i‡(
wdev
 =
NULL
) {

2813 
©h6kl_vif
 *
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

2815 i‡(!
vif
)

2816  -
EIO
;

2817 
ndev
 = 
vif
->ndev;

2819 
ndev
 = 
wdev
->
√tdev
;

2821  
	`_©h6kl_cfg80211_£t_txpowî
(
wùhy
, 
ndev
, 
ty≥
, 
mbm
);

2822 
	}
}

2824 
	$©h6kl_cfg80211_gë_txpowî
(
wùhy
 *wiphy,

2825 
wúñess_dev
 *
wdev
,

2826 *
dbm
)

2828 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

2829 
√t_devi˚
 *
ndev
;

2831 i‡(
wdev
 =
NULL
) {

2832 
©h6kl_vif
 *
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

2834 i‡(!
vif
)

2835  -
EIO
;

2836 
ndev
 = 
vif
->ndev;

2838 
ndev
 = 
wdev
->
√tdev
;

2840  
	`_©h6kl_cfg80211_gë_txpowî
(
wùhy
, 
ndev
 , 
dbm
);

2841 
	}
}

2843 
	$©h6kl_cfg80211_£t_txpowî
(
wùhy
 *wiphy,

2844 
∆80211_tx_powî_£âög
 
ty≥
,

2845 
mbm
)

2847 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

2848 
©h6kl_vif
 *
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

2850 i‡(!
vif
)

2851  -
EIO
;

2853  
	`_©h6kl_cfg80211_£t_txpowî
(
wùhy
, 
vif
->
ndev
, 
ty≥
, 
mbm
);

2854 
	}
}

2856 
	$©h6kl_cfg80211_gë_txpowî
(
wùhy
 *wùhy, *
dbm
)

2858 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

2859 
©h6kl_vif
 *
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

2861 i‡(!
vif
)

2862  -
EIO
;

2864  
	`_©h6kl_cfg80211_gë_txpowî
(
wùhy
, 
vif
->
ndev
, 
dbm
);

2865 
	}
}

2868 
	$©h6kl_cfg80211_£t_powî_mgmt
(
wùhy
 *wiphy,

2869 
√t_devi˚
 *
dev
,

2870 
boﬁ
 
pmgmt
, 
timeout
)

2872 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

2873 
wmi_powî_mode_cmd
 
mode
;

2874 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

2876 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s:Ömgmt %d,Åimeout %d\n",

2877 
__func__
, 
pmgmt
, 
timeout
);

2879 i‡(
	`ã°_bô
(
PS_STICK
, &
vif
->
Êags
)) {

2880 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "PS modeálready stick (%d).\n",

2881 
vif
->
œ°_pwr_mode
);

2885 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

2886  -
EIO
;

2888 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2889 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2890  -
ERESTARTSYS
;

2893 i‡(
pmgmt
) {

2894 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s:Ñe¯powî\n", 
__func__
);

2895 
mode
.
pwr_mode
 = 
REC_POWER
;

2897 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: maxÖîf\n", 
__func__
);

2898 
mode
.
pwr_mode
 = 
MAX_PERF_POWER
;

2901 i‡(
	`©h6kl_wmi_powîmode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2902 
mode
.
pwr_mode
) != 0) {

2903 
	`©h6kl_îr
("wmi_powermode_cmd failed\n");

2904 
	`up
(&
¨
->
£m
);

2905  -
EIO
;

2908 
	`up
(&
¨
->
£m
);

2911 
	}
}

2913 
√t_devi˚
 *
	$_©h6kl_cfg80211_add_iÁ˚
(
wùhy
 *wiphy,

2914 *
«me
,

2915 
∆80211_i·y≥
 
ty≥
,

2916 
u32
 *
Êags
,

2917 
vif_∑øms
 *
∑øms
)

2919 
©h6kl
 *
¨
 = 
	`wùhy_¥iv
(
wùhy
);

2920 
√t_devi˚
 *
ndev
;

2921 
u8
 
if_idx
, 
nw_ty≥
;

2923 i‡(!
	`__©h6kl_cfg80211_ªady
(
¨
))

2924  
NULL
;

2926 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2927 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2928  
NULL
;

2931 i‡(
¨
->
num_vif
 =¨->
vif_max
) {

2932 
	`©h6kl_îr
("Reached maximumÇumber of supported vif\n");

2933 
	`up
(&
¨
->
£m
);

2934  
NULL
;

2937 i‡(!
	`©h6kl_is_vÆid_i·y≥
(
¨
, 
ty≥
, &
if_idx
, &
nw_ty≥
)) {

2938 
	`©h6kl_îr
("Notá supported interfaceÅype\n");

2939 
	`up
(&
¨
->
£m
);

2940  
NULL
;

2943 
ndev
 = 
	`©h6kl_öãrÁ˚_add
(
¨
, 
«me
, 
ty≥
, 
if_idx
, 
nw_ty≥
);

2944 i‡(!
ndev
) {

2945 
	`up
(&
¨
->
£m
);

2946  
NULL
;

2949 
¨
->
num_vif
++;

2951 
	`up
(&
¨
->
£m
);

2953  
ndev
;

2954 
	}
}

2956 
	$_©h6kl_cfg80211_dñ_iÁ˚
(
wùhy
 *wiphy,

2957 
√t_devi˚
 *
ndev
)

2959 
©h6kl
 *
¨
 = 
	`wùhy_¥iv
(
wùhy
);

2960 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

2962 i‡(!
	`__©h6kl_cfg80211_ªady
(
¨
))

2963  -
EIO
;

2965 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

2966 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2967  -
ERESTARTSYS
;

2971 
	`˛ór_bô
(
CLEAR_BSSFILTER_ON_BEACON
, &
vif
->
Êags
);

2972 
	`©h6kl_wmi_bssfûãr_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2973 
NONE_BSS_FILTER
, 0);

2975 
	`©h6kl_judge_rﬂm_∑ømëî
(
vif
, 
åue
);

2976 
	`©h6kl_swôch_∑ømëî_ba£d_⁄_c⁄√˘i⁄
(
vif
, 
åue
);

2978 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

2979 
	`li°_dñ
(&
vif
->
li°
);

2980 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

2982 
	`©h6kl_˛ónup_vif
(
vif
, 
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
));

2984 
	`©h6kl_deöô_if_d©a
(
vif
);

2986 
	`up
(&
¨
->
£m
);

2989 
	}
}

2991 #ifde‡
CFG80211_NETDEV_REPLACED_BY_WDEV


2992 
wúñess_dev
 *
	$©h6kl_cfg80211_add_iÁ˚
(
wùhy
 *wiphy,

2993 c⁄° *
«me
,

2994 
∆80211_i·y≥
 
ty≥
,

2995 
u32
 *
Êags
,

2996 
vif_∑øms
 *
∑øms
)

2998 
√t_devi˚
 *
dev
;

3000 
dev
 = 
	`_©h6kl_cfg80211_add_iÁ˚
(
wùhy
,

3001 (*)
«me
,

3002 
ty≥
,

3003 
Êags
,

3004 
∑øms
);

3006 i‡(
dev
)

3007  
dev
->
õì80211_±r
;

3009  
	`ERR_PTR
(-
EINVAL
);

3010 
	}
}

3012 
	$©h6kl_cfg80211_dñ_iÁ˚
(
wùhy
 *wiphy,

3013 
wúñess_dev
 *
wdev
)

3015 
	`BUG_ON
(!
wdev
->
√tdev
);

3017  
	`_©h6kl_cfg80211_dñ_iÁ˚
(
wùhy
, 
wdev
->
√tdev
);

3018 
	}
}

3020 
√t_devi˚
 *
	$©h6kl_cfg80211_add_iÁ˚
(
wùhy
 *wiphy,

3021 *
«me
,

3022 
∆80211_i·y≥
 
ty≥
,

3023 
u32
 *
Êags
,

3024 
vif_∑øms
 *
∑øms
)

3026 
√t_devi˚
 *
dev
;

3028 
dev
 = 
	`_©h6kl_cfg80211_add_iÁ˚
(
wùhy
,

3029 
«me
,

3030 
ty≥
,

3031 
Êags
,

3032 
∑øms
);

3034 i‡(
dev
)

3035  
dev
;

3037  
	`ERR_PTR
(-
EINVAL
);

3038 
	}
}

3040 
	$©h6kl_cfg80211_dñ_iÁ˚
(
wùhy
 *wiphy,

3041 
√t_devi˚
 *
ndev
)

3043  
	`_©h6kl_cfg80211_dñ_iÁ˚
(
wùhy
, 
ndev
);

3044 
	}
}

3047 
	$©h6kl_cfg80211_ch™ge_iÁ˚
(
wùhy
 *wiphy,

3048 
√t_devi˚
 *
ndev
,

3049 
∆80211_i·y≥
 
ty≥
, 
u32
 *
Êags
,

3050 
vif_∑øms
 *
∑øms
)

3052 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
ndev
);

3054 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s:Åy≥ %u\n", 
__func__
, 
ty≥
);

3056 i‡(
	`down_öãºu±ibÀ
(&
vif
->
¨
->
£m
)) {

3057 
	`©h6kl_îr
("busy, couldn't getáccess\n");

3058  -
ERESTARTSYS
;

3061 
ty≥
) {

3062 
NL80211_IFTYPE_STATION
:

3063 
vif
->
√xt_mode
 = 
INFRA_NETWORK
;

3065 
NL80211_IFTYPE_ADHOC
:

3066 
vif
->
√xt_mode
 = 
ADHOC_NETWORK
;

3068 
NL80211_IFTYPE_AP
:

3069 
vif
->
√xt_mode
 = 
AP_NETWORK
;

3071 
NL80211_IFTYPE_P2P_CLIENT
:

3072 
vif
->
√xt_mode
 = 
INFRA_NETWORK
;

3074 
NL80211_IFTYPE_P2P_GO
:

3075 
vif
->
√xt_mode
 = 
AP_NETWORK
;

3078 
	`©h6kl_îr
("övÆid i¡îÁ˚Åy≥ %u\n", 
ty≥
);

3079 
	`up
(&
vif
->
¨
->
£m
);

3080  -
EOPNOTSUPP
;

3083 
vif
->
wdev
.
i·y≥
 = 
ty≥
;

3085 
	`up
(&
vif
->
¨
->
£m
);

3088 
	}
}

3090 
	$©h6kl_cfg80211_joö_ibss
(
wùhy
 *wiphy,

3091 
√t_devi˚
 *
dev
,

3092 
cfg80211_ibss_∑øms
 *
ibss_∑øm
)

3094 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

3095 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

3096 
õì80211_ch™√l
 *
ch™
;

3097 
°©us
;

3099 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

3100  -
EIO
;

3102 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

3103 
	`©h6kl_îr
("busy, couldn't getáccess\n");

3104  -
ERESTARTSYS
;

3107 
vif
->
ssid_Àn
 = 
ibss_∑øm
->ssid_len;

3108 
	`mem˝y
(
vif
->
ssid
, 
ibss_∑øm
->ssid, vif->
ssid_Àn
);

3110 #ifde‡
CFG80211_NEW_CHAN_DEFINITION


3111 
ch™
 = 
ibss_∑øm
->
ch™def
.chan;

3113 
ch™
 = 
ibss_∑øm
->
ch™√l
;

3116 i‡(
ch™
)

3117 
vif
->
ch_höt
 = 
ch™
->
˚¡î_‰eq
;

3119 i‡(
ibss_∑øm
->
ch™√l_fixed
) {

3126 
	`up
(&
¨
->
£m
);

3127  -
EOPNOTSUPP
;

3130 
vif
->
sc_∑øms
.
bg_≥riod
 = 0xFFFF;

3131 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


3132 
vif
->
sc_∑øms
.
möa˘_chdwñl_time
 = 0;

3133 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
 = 105;

3135 
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

3136 
vif
->
sc_∑øms
.
fg_°¨t_≥riod
,

3137 
vif
->
sc_∑øms
.
fg_íd_≥riod
,

3138 
vif
->
sc_∑øms
.
bg_≥riod
,

3139 
vif
->
sc_∑øms
.
möa˘_chdwñl_time
,

3140 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
,

3141 
vif
->
sc_∑øms
.
∑s_chdwñl_time
,

3142 
vif
->
sc_∑øms
.
sh‹t_sˇn_øtio
,

3143 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
,

3144 
vif
->
sc_∑øms
.
max_dfsch_a˘_time
,

3145 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
);

3147 
	`mem£t
(
vif
->
ªq_bssid
, 0, (vif->req_bssid));

3148 i‡(
ibss_∑øm
->
bssid
 && !
	`is_brﬂdˇ°_ëhî_addr
(ibss_param->bssid))

3149 
	`mem˝y
(
vif
->
ªq_bssid
, 
ibss_∑øm
->
bssid
,

3150 (
vif
->
ªq_bssid
));

3152 
	`©h6kl_£t_w∑_vîsi⁄
(
vif
, 0);

3154 
°©us
 = 
	`©h6kl_£t_auth_ty≥
(
vif
, 
NL80211_AUTHTYPE_OPEN_SYSTEM
);

3155 i‡(
°©us
) {

3156 
	`up
(&
¨
->
£m
);

3157  
°©us
;

3160 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


3161 i‡(!
¨
->
ktk_a˘ive
) {

3163 i‡(
ibss_∑øm
->
¥ivacy
) {

3164 
	`©h6kl_£t_cùhî
(
vif
, 
WLAN_CIPHER_SUITE_WEP40
, 
åue
);

3165 
	`©h6kl_£t_cùhî
(
vif
, 
WLAN_CIPHER_SUITE_WEP40
, 
Ál£
);

3167 
	`©h6kl_£t_cùhî
(
vif
, 0, 
åue
);

3168 
	`©h6kl_£t_cùhî
(
vif
, 0, 
Ál£
);

3170 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


3172 
	`©h6kl_£t_cùhî
(
vif
, 
WLAN_CIPHER_SUITE_CCMP
, 
åue
);

3173 
	`©h6kl_£t_cùhî
(
vif
, 
WLAN_CIPHER_SUITE_CCMP
, 
Ál£
);

3177 
vif
->
nw_ty≥
 = vif->
√xt_mode
;

3179 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

3183 
__func__
,

3184 
vif
->
auth_mode
, vif->
dŸ11_auth_mode
, vif->
¥wi£_¸y±o
,

3185 
vif
->
¥wi£_¸y±o_Àn
, vif->
gΩ_¸y±o
,

3186 
vif
->
gΩ_¸y±o_Àn
, vif->
ch_höt
);

3188 
°©us
 = 
	`©h6kl_wmi_c⁄√˘_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, vif->
nw_ty≥
,

3189 
vif
->
dŸ11_auth_mode
, vif->
auth_mode
,

3190 
vif
->
¥wi£_¸y±o
,

3191 
vif
->
¥wi£_¸y±o_Àn
,

3192 
vif
->
gΩ_¸y±o
, vif->
gΩ_¸y±o_Àn
,

3193 
vif
->
ssid_Àn
, vif->
ssid
,

3194 
vif
->
ªq_bssid
, vif->
ch_höt
,

3195 
vif
->
c⁄√˘_˘æ_Êags
);

3196 
	`£t_bô
(
CONNECT_PEND
, &
vif
->
Êags
);

3198 
	`up
(&
¨
->
£m
);

3201 
	}
}

3203 
	$©h6kl_cfg80211_Àave_ibss
(
wùhy
 *wiphy,

3204 
√t_devi˚
 *
dev
)

3206 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

3208 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

3209  -
EIO
;

3211 i‡(
	`down_öãºu±ibÀ
(&
vif
->
¨
->
£m
)) {

3212 
	`©h6kl_îr
("busy, couldn't getáccess\n");

3213  -
ERESTARTSYS
;

3216 
	`©h6kl_disc⁄√˘
(
vif
);

3217 
	`mem£t
(
vif
->
ssid
, 0, (vif->ssid));

3218 
vif
->
ssid_Àn
 = 0;

3220 
	`up
(&
vif
->
¨
->
£m
);

3223 
	}
}

3225 c⁄° 
u32
 
	gcùhî_suôes
[] = {

3226 
WLAN_CIPHER_SUITE_WEP40
,

3227 
WLAN_CIPHER_SUITE_WEP104
,

3228 
WLAN_CIPHER_SUITE_TKIP
,

3229 
WLAN_CIPHER_SUITE_CCMP
,

3230 
CCKM_KRK_CIPHER_SUITE
,

3231 
WLAN_CIPHER_SUITE_SMS4
,

3232 #ifde‡
PMF_SUPPORT


3233 
WLAN_CIPHER_SUITE_AES_CMAC
,

3237 
boﬁ
 
	$is_øã_Àgacy
(
s32
 
øã
)

3239 c⁄° 
s32
 
Àgacy
[] = { 1000, 2000, 5500, 11000,

3243 
u8
 
i
;

3245 
i
 = 0; i < 
	`ARRAY_SIZE
(
Àgacy
); i++)

3246 i‡(
øã
 =
Àgacy
[
i
])

3247  
åue
;

3249  
Ál£
;

3250 
	}
}

3252 
boﬁ
 
	$is_øã_ht20
(
s32
 
øã
, 
u8
 *
mcs
, 
boﬁ
 *
sgi
)

3254 c⁄° 
s32
 
ht20
[] = { 6500, 13000, 19500, 26000, 39000,

3257 
u8
 
i
;

3259 
i
 = 0; i < 
	`ARRAY_SIZE
(
ht20
); i++) {

3260 i‡(
øã
 =
ht20
[
i
]) {

3261 i‡(
i
 =
	`ARRAY_SIZE
(
ht20
) - 1)

3263 *
sgi
 = 
åue
;

3265 *
sgi
 = 
Ál£
;

3267 *
mcs
 = 
i
;

3268  
åue
;

3271  
Ál£
;

3272 
	}
}

3274 
boﬁ
 
	$is_øã_ht40
(
s32
 
øã
, 
u8
 *
mcs
, 
boﬁ
 *
sgi
)

3276 c⁄° 
s32
 
ht40
[] = { 13500, 27000, 40500, 54000,

3280 
u8
 
i
;

3282 
i
 = 0; i < 
	`ARRAY_SIZE
(
ht40
); i++) {

3283 i‡(
øã
 =
ht40
[
i
]) {

3284 i‡(
i
 =
	`ARRAY_SIZE
(
ht40
) - 1)

3286 *
sgi
 = 
åue
;

3288 *
sgi
 = 
Ál£
;

3290 *
mcs
 = 
i
;

3291  
åue
;

3295  
Ál£
;

3296 
	}
}

3298 
	$__gë_øã_öfo
(
øã_öfo
 *
txøã
, 
s32
 
øã
, 
s8
 
øã_idx
)

3300 
s8
 
øã_id
 = 
øã_idx
 & 0x7f;

3302 
txøã
->
Êags
 = 0;

3303 i‡(
øã_id
 <= 11) {

3304 
txøã
->
Àgacy
 = 
øã
 / 100;

3305 } i‡(
øã_id
 <= 43) {

3306 
txøã
->
Êags
 |
RATE_INFO_FLAGS_MCS
;

3307 i‡(
øã_idx
 >> 7)

3308 
txøã
->
Êags
 |
RATE_INFO_FLAGS_SHORT_GI
;

3310 i‡(
øã_id
 <= 27)

3311 
txøã
->
mcs
 = 
øã_id
 - 12;

3313 
txøã
->
mcs
 = 
øã_id
 - 28;

3314 
txøã
->
Êags
 |
RATE_INFO_FLAGS_40_MHZ_WIDTH
;

3317 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

3319 
øã
, 
øã_idx
);

3325 
	}
}

3327 
	$_gë_°a_öfo
(
©h6kl_vif
 *
vif
,

3328 
°©i⁄_öfo
 *
söfo
)

3330 
èrgë_°©s
 *
°©s
 = &
vif
->target_stats;

3331 
s32
 
øã
;

3332 
s8
 
øãid
;

3333 
u8
 
mcs
;

3334 
boﬁ
 
sgi
;

3338 i‡(
°©s
->
rx_byã
) {

3339 
söfo
->
rx_byãs
 = 
°©s
->
rx_byã
;

3340 
söfo
->
fûÀd
 |
STATION_INFO_RX_BYTES
;

3341 
söfo
->
rx_∑ckës
 = 
°©s
->
rx_pkt
;

3342 
söfo
->
fûÀd
 |
STATION_INFO_RX_PACKETS
;

3345 i‡(
°©s
->
tx_byã
) {

3346 
söfo
->
tx_byãs
 = 
°©s
->
tx_byã
;

3347 
söfo
->
fûÀd
 |
STATION_INFO_TX_BYTES
;

3348 
söfo
->
tx_∑ckës
 = 
°©s
->
tx_pkt
;

3349 
söfo
->
fûÀd
 |
STATION_INFO_TX_PACKETS
;

3352 
söfo
->
sig«l
 = 
°©s
->
cs_rssi
;

3353 
söfo
->
fûÀd
 |
STATION_INFO_SIGNAL
;

3355 
øã
 = 
°©s
->
tx_uˇ°_øã
;

3357 i‡(
vif
->
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6004
) {

3358 
øãid
 = 
°©s
->
tx_øã_ödex
;

3359 i‡(
	`__gë_øã_öfo
(&
söfo
->
txøã
, 
øã
, 
øãid
))

3360 
	`©h6kl_debug_w¨
(
vif
->
¨
, 
ATH6KL_WAR_INVALID_RATE
);

3362 
söfo
->
fûÀd
 |
STATION_INFO_TX_BITRATE
;

3364 
söfo
->
txøã
.
Êags
 = 0;

3365 i‡(
	`is_øã_Àgacy
(
øã
)) {

3366 
söfo
->
txøã
.
Àgacy
 = 
øã
 / 100;

3367 
söfo
->
fûÀd
 |
STATION_INFO_TX_BITRATE
;

3368 } i‡(
	`is_øã_ht20
(
øã
, &
mcs
, &
sgi
)) {

3369 i‡(
sgi
) {

3370 
söfo
->
txøã
.
Êags
 |
RATE_INFO_FLAGS_SHORT_GI
;

3371 
söfo
->
txøã
.
mcs
 = mcs - 1;

3373 
söfo
->
txøã
.
mcs
 = mcs;

3375 
söfo
->
txøã
.
Êags
 |
RATE_INFO_FLAGS_MCS
;

3376 
söfo
->
fûÀd
 |
STATION_INFO_TX_BITRATE
;

3377 } i‡(
	`is_øã_ht40
(
øã
, &
mcs
, &
sgi
)) {

3378 i‡(
sgi
) {

3379 
söfo
->
txøã
.
Êags
 |
RATE_INFO_FLAGS_SHORT_GI
;

3380 
söfo
->
txøã
.
mcs
 = mcs - 1;

3382 
söfo
->
txøã
.
mcs
 = mcs;

3384 
söfo
->
txøã
.
Êags
 |
RATE_INFO_FLAGS_40_MHZ_WIDTH
;

3385 
söfo
->
txøã
.
Êags
 |
RATE_INFO_FLAGS_MCS
;

3386 
söfo
->
fûÀd
 |
STATION_INFO_TX_BITRATE
;

3388 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

3389 "övÆidÑ©ê‰om sèts: %d\n", 
øã
);

3390 
	`©h6kl_debug_w¨
(
vif
->
¨
, 
ATH6KL_WAR_INVALID_RATE
);

3394 i‡((
vif
->
nw_ty≥
 =
INFRA_NETWORK
) &&

3395 
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) &&

3396 
	`ã°_bô
(
DTIM_PERIOD_AVAIL
, &
vif
->
Êags
) &&

3397 
vif
->
nw_ty≥
 =
INFRA_NETWORK
) {

3398 
söfo
->
fûÀd
 |
STATION_INFO_BSS_PARAM
;

3399 
söfo
->
bss_∑øm
.
Êags
 = 0;

3400 
söfo
->
bss_∑øm
.
dtim_≥riod
 = 
vif
->
assoc_bss_dtim_≥riod
;

3401 
söfo
->
bss_∑øm
.
bóc⁄_öãrvÆ
 = 
vif
->
assoc_bss_bóc⁄_öt
;

3405 
	}
}

3407 
	$_gë_≠_°a_öfo
(
©h6kl_vif
 *
vif
,

3408 
wmi_≥r_°a_°©
 *
°a
,

3409 
u8
 *
mac_addr
,

3410 
°©i⁄_öfo
 *
söfo
)

3412 
s32
 
øã
;

3413 
s8
 
øãid
;

3415 i‡(
	`©h6kl_≠_kì∑live_by_suµ
(
vif
))

3416 
söfo
->
öa˘ive_time
 =

3417 
	`©h6kl_≠_kì∑live_gë_öa˘ive_time
(
vif
, 
mac_addr
);

3423 
söfo
->
öa˘ive_time
 = 1 * 1000;

3425 
söfo
->
fûÀd
 |
STATION_INFO_INACTIVE_TIME
;

3427 
söfo
->
rx_byãs
 = 
°a
->rx_bytes;

3428 
söfo
->
fûÀd
 |
STATION_INFO_RX_BYTES
;

3429 
söfo
->
rx_∑ckës
 = 
°a
->
rx_pkts
;

3430 
söfo
->
fûÀd
 |
STATION_INFO_RX_PACKETS
;

3432 
söfo
->
tx_byãs
 = 
°a
->tx_bytes;

3433 
söfo
->
fûÀd
 |
STATION_INFO_TX_BYTES
;

3434 
söfo
->
tx_∑ckës
 = 
°a
->
tx_pkts
;

3435 
söfo
->
fûÀd
 |
STATION_INFO_TX_PACKETS
;

3437 i‡(
vif
->
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6004
) {

3438 
øã
 = 
	`©h6kl_wmi_gë_øã_¨6004
(
°a
->
tx_uˇ°_øã
);

3439 
øãid
 = 
°a
->
tx_uˇ°_øã
;

3440 i‡(
	`__gë_øã_öfo
(&
söfo
->
txøã
, 
øã
, 
øãid
))

3441 
	`©h6kl_debug_w¨
(
vif
->
¨
, 
ATH6KL_WAR_INVALID_RATE
);

3443 
söfo
->
fûÀd
 |
STATION_INFO_TX_BITRATE
;

3447 
	}
}

3449 
	$©h6kl_gë_°©i⁄
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

3450 
u8
 *
mac
, 
°©i⁄_öfo
 *
söfo
)

3452 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

3453 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

3454 
©h6kl_°a
 *
c⁄n
 = 
NULL
;

3455 
À·
;

3457 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

3458  -
EIO
;

3460 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

3461 
c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, 
mac
);

3462 i‡(
c⁄n
 =
NULL
) {

3463 
	`©h6kl_îr
("Can't find %02x%02x%02x%02x%02x%02x\n",

3464 
mac
[0], mac[1], mac[2],

3465 
mac
[3], mac[4], mac[5]);

3467  -
EINVAL
;

3470 i‡(
	`memcmp
(
mac
, 
vif
->
bssid
, 
ETH_ALEN
) != 0)

3471  -
ENOENT
;

3474 #ifde‡
USB_AUTO_SUSPEND


3476 i‡(
¨
->
°©e
 =
ATH6KL_STATE_WOW
) {

3477 
timevÆ
 
cur_time
;

3478 
diff_time
;

3480 
	`do_gëtimeofday
(&
cur_time
);

3481 i‡(
cur_time
.
tv_£c
 >
vif
->
èrgë_°©s
.
upd©e_time
.tv_sec) {

3482 
diff_time
 = 
cur_time
.
tv_£c


3483 - 
vif
->
èrgë_°©s
.
upd©e_time
.
tv_£c
;

3485 i‡(
diff_time
 <= 60)

3486 
skù_fw_°©s
;

3491 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
))

3492  -
EBUSY
;

3494 
	`£t_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
);

3496 i‡(
	`©h6kl_wmi_gë_°©s_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
)) {

3497 
	`up
(&
¨
->
£m
);

3498  -
EIO
;

3501 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

3502 !
	`ã°_bô
(
STATS_UPDATE_PEND
,

3503 &
vif
->
Êags
),

3504 
WMI_TIMEOUT
);

3506 
	`˛ór_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
);

3507 
	`up
(&
¨
->
£m
);

3509 i‡(
À·
 == 0)

3510  -
ETIMEDOUT
;

3511 i‡(
À·
 < 0)

3512  
À·
;

3514 #ifde‡
USB_AUTO_SUSPEND


3515 
skù_fw_°©s
:

3518 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

3519 
wmi_≠_mode_°©
 *
≠
 = &
vif
->
≠_°©s
;

3520 
wmi_≥r_°a_°©
 *
°a
 = 
NULL
;

3522 
À·
 = 0;Üe· < 
AP_MAX_NUM_STA
;Üeft++) {

3523 i‡(
c⁄n
->
aid
 =
≠
->
°a
[
À·
].aid) {

3524 
°a
 = &
≠
->°a[
À·
];

3529 i‡(!
°a
)

3530  -
EINVAL
;

3532 
	`_gë_≠_°a_öfo
(
vif
, 
°a
, 
mac
, 
söfo
);

3537 
	`_gë_°a_öfo
(
vif
, 
söfo
);

3540 
	}
}

3542 
	$©h6kl_dump_°©i⁄
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

3543 
idx
, 
u8
 *
mac
, 
°©i⁄_öfo
 *
söfo
)

3545 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

3546 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

3547 
©h6kl_°a
 *
c⁄n
;

3548 
wmi_≠_mode_°©
 *
≠
;

3549 
wmi_≥r_°a_°©
 *
°a
;

3550 
À·
;

3551 
√xt
;

3553 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

3554  -
EIO
;

3556 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

3558 i‡((
vif
->
°a_li°_ödex
 == 0) ||

3559 (
idx
 >
AP_MAX_NUM_STA
))

3560  -
ENOENT
;

3563 i‡(
idx
 == 0)

3564 
vif
->
œ°_dump_≠_°©s_idx
 = 0;

3566 
upd©e_d⁄e
;

3568 i‡((
idx
 != 0) ||

3569 !
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))

3570  -
ENOENT
;

3573 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
))

3574  -
EBUSY
;

3576 
	`£t_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
);

3578 i‡(
	`©h6kl_wmi_gë_°©s_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
)) {

3579 
	`up
(&
¨
->
£m
);

3580  -
EIO
;

3583 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

3584 !
	`ã°_bô
(
STATS_UPDATE_PEND
,

3585 &
vif
->
Êags
),

3586 
WMI_TIMEOUT
);

3588 
	`˛ór_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
);

3589 
	`up
(&
¨
->
£m
);

3591 i‡(
À·
 == 0)

3592  -
ETIMEDOUT
;

3593 i‡(
À·
 < 0)

3594  
À·
;

3596 
upd©e_d⁄e
:

3597 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

3598 i‡(
vif
->
œ°_dump_≠_°©s_idx
 >
AP_MAX_NUM_STA
)

3599  -
ENOENT
;

3602 
≠
 = &
vif
->
≠_°©s
;

3603 
√xt
 = 
vif
->
œ°_dump_≠_°©s_idx
;

3604 
√xt
 < 
AP_MAX_NUM_STA
;

3605 
√xt
++) {

3606 
°a
 = &(
≠
->°a[
√xt
]);

3607 i‡(
°a
->
aid
) {

3608 
c⁄n
 = 
	`©h6kl_föd_°a_by_aid
(
vif
, 
°a
->
aid
);

3609 i‡(
c⁄n
)

3615 i‡(
√xt
 =
AP_MAX_NUM_STA
)

3616  -
ENOENT
;

3619 
vif
->
œ°_dump_≠_°©s_idx
 = 
√xt
 + 1;

3621 
	`mem˝y
(
mac
, 
c⁄n
->mac, 
ETH_ALEN
);

3622 
	`_gë_≠_°a_öfo
(
vif
, 
°a
, 
c⁄n
->
mac
, 
söfo
);

3627 
	`mem˝y
(
mac
, 
vif
->
ndev
->
dev_addr
, 
ETH_ALEN
);

3628 
	`_gë_°a_öfo
(
vif
, 
söfo
);

3631 
	}
}

3633 
	$©h6kl_cfg80211_£t_bôøã_mask
(
wùhy
 *wiphy,

3634 
√t_devi˚
 *
dev
,

3635 c⁄° 
u8
 *
≥î
,

3636 c⁄° 
cfg80211_bôøã_mask
 *
mask
)

3638 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

3639 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

3640 
ªt
, 
dißbÀd
;

3642 
	`WARN_ON
(
≥î
);

3643 i‡((
≥î
) ||

3644 ((
mask
->
c⁄åﬁ
[
NL80211_BAND_2GHZ
].
Àgacy
 != 0xfff) &&

3645 (
mask
->
c⁄åﬁ
[
NL80211_BAND_2GHZ
].
Àgacy
 != 0xff0))) {

3647  -
ENOTSUPP
;

3650 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

3651  -
EIO
;

3653 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

3654 
	`©h6kl_îr
("busy, couldn't getáccess\n");

3655  -
ERESTARTSYS
;

3658 i‡(
mask
->
c⁄åﬁ
[
NL80211_BAND_2GHZ
].
Àgacy
 &

3659 ((1 << 
©h6kl_b_øãs_size
) - 1))

3660 
dißbÀd
 = 0;

3662 
dißbÀd
 = 1;

3664 
ªt
 = 
	`©h6kl_wmi_dißbÀ_11b_øãs_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

3665 
dißbÀd
);

3667 
	`up
(&
¨
->
£m
);

3669  
ªt
;

3670 
	}
}

3672 
	$©h6kl_£t_pmkß
(
wùhy
 *wùhy, 
√t_devi˚
 *
√tdev
,

3673 
cfg80211_pmkß
 *
pmkß
)

3675 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
√tdev
);

3676 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
√tdev
);

3677 
ªt
;

3679 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

3680  -
EIO
;

3682 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

3683 
	`©h6kl_îr
("busy, couldn't getáccess\n");

3684  -
ERESTARTSYS
;

3687 
ªt
 = 
	`©h6kl_wmi_£çmkid_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
pmkß
->
bssid
,

3688 
pmkß
->
pmkid
, 
åue
);

3690 
	`up
(&
¨
->
£m
);

3692  
ªt
;

3693 
	}
}

3695 
	$©h6kl_dñ_pmkß
(
wùhy
 *wùhy, 
√t_devi˚
 *
√tdev
,

3696 
cfg80211_pmkß
 *
pmkß
)

3698 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
√tdev
);

3699 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
√tdev
);

3700 
ªt
;

3702 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

3703  -
EIO
;

3705 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

3706 
	`©h6kl_îr
("busy, couldn't getáccess\n");

3707  -
ERESTARTSYS
;

3710 
ªt
 = 
	`©h6kl_wmi_£çmkid_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
pmkß
->
bssid
,

3711 
pmkß
->
pmkid
, 
Ál£
);

3713 
	`up
(&
¨
->
£m
);

3715  
ªt
;

3716 
	}
}

3718 
	$©h6kl_Êush_pmkß
(
wùhy
 *wùhy, 
√t_devi˚
 *
√tdev
)

3720 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
√tdev
);

3721 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
√tdev
);

3722 
ªt
;

3724 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

3725  -
EIO
;

3727 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

3728 
	`©h6kl_îr
("busy, couldn't getáccess\n");

3729  -
ERESTARTSYS
;

3732 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)) {

3733 
ªt
 = 
	`©h6kl_wmi_£çmkid_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

3734 
vif
->
bssid
, 
NULL
, 
Ál£
);

3735 
	`up
(&
¨
->
£m
);

3736  
ªt
;

3739 
	`up
(&
¨
->
£m
);

3742 
	}
}

3744 
	$©h6kl_wow_su•íd
(
©h6kl
 *
¨
, 
cfg80211_wowœn
 *
wow
)

3746 
©h6kl_vif
 *
vif
;

3747 
ªt
, 
À·
;

3748 #i‚de‡
CONFIG_ANDROID


3749 
pos
;

3750 
u32
 
fûãr
 = 0;

3751 
u16
 
i
;

3752 
u8
 
mask
[
WOW_MASK_SIZE
];

3754 
ö_devi˚
 *
ö_dev
;

3755 
ö_iÁddr
 *
iÁ
;

3756 
§c_ù
[4];

3759 i‡(
¨
->
°©e
 =
ATH6KL_STATE_WOW
)

3762 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

3763 i‡(!
vif
)

3764  -
EIO
;

3766 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

3767  -
EIO
;

3769 #i‡(!
	`deföed
(
CONFIG_ANDROID
Ë&& !deföed(
USB_AUTO_SUSPEND
))

3770 i‡(!
¨
->
gë_wow_∑âîn
) {

3772 
i
 = 0; i < 
WOW_MAX_FILTERS_PER_LIST
; i++)

3773 
	`©h6kl_wmi_dñ_wow_∑âîn_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

3774 
WOW_LIST_ID
, 
i
);

3776 
i
 = 0; i < 
wow
->
n_∑âîns
; i++) {

3777 i‡(
©h6kl_wow_ext
) {

3778 
ªt
 = 
	`©h6kl_wmi_add_wow_ext_∑âîn_cmd
(

3779 
¨
->
wmi
,

3780 
vif
->
fw_vif_idx
, 
WOW_LIST_ID
,

3781 
wow
->
∑âîns
[
i
].
∑âîn_Àn
,

3782 
i
,

3784 
wow
->
∑âîns
[
i
].
∑âîn
,

3785 
wow
->
∑âîns
[
i
].
mask
);

3787 
fûãr
 |
WOW_FILTER_OPTION_PATTERNS
;

3799 
	`mem£t
(&
mask
, 0, (mask));

3800 
pos
 = 0;

3801 
pos
 < 
wow
->
∑âîns
[
i
].
∑âîn_Àn
;

3802 
pos
++) {

3803 i‡(
wow
->
∑âîns
[
i
].
mask
[
pos
 / 8] &

3804 (0x1 << (
pos
 % 8)))

3805 
mask
[
pos
] = 0xFF;

3816 
ªt
 = 
	`©h6kl_wmi_add_wow_∑âîn_cmd
(
¨
->
wmi
,

3817 
vif
->
fw_vif_idx
, 
WOW_LIST_ID
,

3818 
wow
->
∑âîns
[
i
].
∑âîn_Àn
,

3820 
wow
->
∑âîns
[
i
].
∑âîn
, 
mask
);

3822 i‡(
ªt
)

3823  
ªt
;

3826 
fûãr
 |
WOW_FILTER_OPTION_PATTERNS
;

3828 i‡(
wow
) {

3829 i‡(
wow
->
disc⁄√˘
 || wow->
™y
)

3830 
fûãr
 |
WOW_FILTER_OPTION_NWK_DISASSOC
;

3832 i‡(
wow
->
magic_pkt
 || wow->
™y
)

3833 
fûãr
 |
WOW_FILTER_OPTION_MAGIC_PACKET
;

3835 i‡(
wow
->
gtk_ªkey_Áûuª
 || wow->
™y
) {

3836 
fûãr
 |(
WOW_FILTER_OPTION_EAP_REQ
 |

3837 
WOW_FILTER_OPTION_8021X_4WAYHS
 |

3838 
WOW_FILTER_OPTION_GTK_ERROR
 |

3839 
WOW_FILTER_OPTION_OFFLOAD_GTK
);

3842 i‡(
wow
->
óp_idítôy_ªq
 || wow->
™y
)

3843 
fûãr
 |
WOW_FILTER_OPTION_EAP_REQ
;

3845 i‡(
wow
->
four_way_h™dshake
 || wow->
™y
)

3846 
fûãr
 |
WOW_FILTER_OPTION_8021X_4WAYHS
;

3850 i‡(
vif
->
auth_mode
 =
WPA2_AUTH_CCKM
 || vif->auth_modê=
WPA2_PSK_AUTH


3851 || 
vif
->
auth_mode
 =
WPA_AUTH_CCKM
 || vif->auth_modê=
WPA_PSK_AUTH
){

3852 
fûãr
 |
WOW_FILTER_OPTION_OFFLOAD_GTK
;

3855 i‡(
vif
->
¨p_ofÊﬂd_ù_£t
 || (
wow
 && wow->
™y
))

3856 
fûãr
 |
WOW_FILTER_OPTION_OFFLOAD_ARP
;

3858 i‡(
fûãr
) {

3859 
ªt
 = 
	`©h6kl_wmi_£t_wow_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

3860 
ATH6KL_WOW_MODE_ENABLE
,

3861 
fûãr
,

3862 
WOW_HOST_REQ_DELAY
);

3863 i‡(
ªt
)

3864  
ªt
;

3869 
ö_dev
 = 
	`__ö_dev_gë_π∆
(
vif
->
ndev
);

3870 i‡(
ö_dev
) {

3871 
iÁ
 = 
ö_dev
->
iÁ_li°
;

3872 i‡(
iÁ
 && iÁ->
iÁ_loˇl
) {

3873 i‡(
vif
->
¨p_ofÊﬂd_ù_£t
 == 0 ||

3874 
vif
->
¨p_ofÊﬂd_ù
 !
iÁ
->
iÁ_loˇl
) {

3875 
	`mem˝y
(
§c_ù
, &
iÁ
->
iÁ_loˇl
, 4);

3876 
vif
->
¨p_ofÊﬂd_ù_£t
 = 0;

3877 i‡(!
	`©h6kl_wmi_£t_¨p_ofÊﬂd_ù_cmd
(
¨
->
wmi
,

3878 
§c_ù
)) {

3879 
vif
->
¨p_ofÊﬂd_ù_£t
 = 1;

3880 
vif
->
¨p_ofÊﬂd_ù
 = 
iÁ
->
iÁ_loˇl
;

3881 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
,

3883 
__func__
, 
§c_ù
[0], src_ip[1],

3884 
§c_ù
[2], src_ip[3]);

3890 
	`˛ór_bô
(
HOST_SLEEP_MODE_CMD_PROCESSED
, &
vif
->
Êags
);

3892 
ªt
 = 
	`©h6kl_wmi_£t_ho°_¶ìp_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

3893 
ATH6KL_HOST_MODE_ASLEEP
);

3895 i‡(
ªt
)

3896  
ªt
;

3898 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

3899 
	`ã°_bô
(
HOST_SLEEP_MODE_CMD_PROCESSED
, &
vif
->
Êags
),

3900 
WMI_TIMEOUT
);

3902 i‡(
À·
 == 0) {

3903 
	`©h6kl_w¨n
("timeout, didn't get host sleep cmd "

3905 
ªt
 = -
ETIMEDOUT
;

3906 } i‡(
À·
 < 0) {

3907 
	`©h6kl_w¨n
("error while waiting for host sleep cmd "

3908 "¥o˚s£dÉvíà%d\n", 
À·
);

3909 
ªt
 = 
À·
;

3912 i‡(
¨
->
tx_≥ndög
[¨->
˘æ_ï
]) {

3913 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

3914 
¨
->
tx_≥ndög
[¨->
˘æ_ï
] =0, 
WMI_TIMEOUT
);

3915 i‡(
À·
 == 0) {

3916 
	`©h6kl_w¨n
("clear wmi ctrl dataÅimeout\n");

3917 
ªt
 = -
ETIMEDOUT
;

3918 } i‡(
À·
 < 0) {

3919 
	`©h6kl_w¨n
("˛ó∏wmò˘æ d©®Áûed: %d\n", 
À·
);

3920 
ªt
 = 
À·
;

3924 #ifde‡
CONFIG_ANDROID


3925 i‡(
ªt
)

3926 
	`©h6kl_wmi_£t_ho°_¶ìp_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

3927 
ATH6KL_HOST_MODE_AWAKE
);

3929  
ªt
;

3930 
	}
}

3932 
	$©h6kl_wow_ªsume
(
©h6kl
 *
¨
)

3934 
©h6kl_vif
 *
vif
;

3935 
ªt
;

3937 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

3938 i‡(!
vif
)

3939  -
EIO
;

3941 
ªt
 = 
	`©h6kl_wmi_£t_ho°_¶ìp_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

3942 
ATH6KL_HOST_MODE_AWAKE
);

3943  
ªt
;

3944 
	}
}

3946 #ifde‡
CONFIG_ANDROID


3947 
úqªtu∫_t
 
	$©h6kl_wow_úq
(
úq
, *
dev_id
)

3949 
πtm_c⁄ãxt
 *
¥âm
 = 
NULL
;

3951 
¥âm
 = 
	`DEV_GETRTT_HDL
();

3953 i‡((
¥âm
Ë&& (¥âm->
πtdh˛kˇl_a˘ive
)) {

3954 
time•ec
 
ts
;

3956 
	`gën°imeofday
(&
ts
);

3957 
¥âm
->
πtd2h2_˛k
.
èbs_h2
[¥âm->
dh˛kˇl_ödex
].
£c
 =

3958 
ts
.
tv_£c
;

3959 
¥âm
->
πtd2h2_˛k
.
èbs_h2
[¥âm->
dh˛kˇl_ödex
].
n£c
 =

3960 
ts
.
tv_n£c
;

3961 
¥âm
->
dh˛kˇl_ödex
++;

3964  
IRQ_HANDLED
;

3965 
	}
}

3968 
boﬁ
 
	$©h6kl_cfg80211_√ed_su•íd
(
©h6kl
 *
¨
, 
u32
 *
su•íd_vif
)

3970 
©h6kl_vif
 *
vif
;

3971 
i
;

3973 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

3974 i‡(!
vif
)

3975  
Ál£
;

3977 i‡(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
)) {

3978 
	`©h6kl_îr
("deepsleep failedás wmi isÇotÑeady\n");

3979  
Ál£
;

3986 *
su•íd_vif
 = 0;

3987 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3988 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3989 i‡(
vif
) {

3990 #ifde‡
CE_SUPPORT


3991 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
)

3992 *
su•íd_vif
 |(1 << 
i
);

3994 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

3995 *
su•íd_vif
 = 0;

3996  
Ál£
;

3998 *
su•íd_vif
 |(1 << 
i
);

4003  
åue
;

4004 
	}
}

4006 
	$©h6kl_cfg80211_dìp¶ìp_su•íd
(
©h6kl
 *
¨
)

4008 
©h6kl_vif
 *
vif
;

4009 
i
, 
ªt
 = 0, 
À·
;

4010 
u32
 
√ed_su•íd_vif
 = 0;

4012 i‡(!
	`©h6kl_cfg80211_√ed_su•íd
(
¨
, &
√ed_su•íd_vif
))

4013  -
EOPNOTSUPP
;

4016 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
, "deep sleep suspend %x\n",

4017 
√ed_su•íd_vif
);

4019 #ifde‡
CONFIG_ANDROID


4020 i‡(
¨
->
wow_úq
) {

4021 i‡(
	`dißbÀ_úq_wake
(
¨
->
wow_úq
))

4022 
	`©h6kl_îr
("Couldn't disable hostwake IRQ wakeup mode\n");

4024 
	`‰ì_úq
(
¨
->
wow_úq
,ár);

4028 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4029 i‡(
√ed_su•íd_vif
 & (1 << 
i
)) {

4030 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4031 i‡(
vif
) {

4032 
	`˛ór_bô
(
WLAN_ENABLED
, &
vif
->
Êags
);

4033 
	`√tif_d‹m™t_⁄
(
vif
->
ndev
);

4034 
	`£t_bô
(
DORMANT
, &
vif
->
Êags
);

4039 #ifde‡
USB_AUTO_SUSPEND


4043 
	`©h6kl_cfg80211_°›_Æl
(
¨
);

4045 
	`•ö_lock_bh
(&
¨
->
°©e_lock
);

4046 
¨
->
°©e
 = 
ATH6KL_STATE_DEEPSLEEP
;

4047 
	`•ö_u∆ock_bh
(&
¨
->
°©e_lock
);

4049 
	`•ö_lock_bh
(&
¨
->
°©e_lock
);

4050 
¨
->
°©e
 = 
ATH6KL_STATE_DEEPSLEEP
;

4051 
	`•ö_u∆ock_bh
(&
¨
->
°©e_lock
);

4053 
	`©h6kl_cfg80211_°›_Æl
(
¨
);

4060 
	`©h6kl_tx_d©a_˛ónup
(
¨
);

4062 i‡(
¨
->
tx_≥ndög
[¨->
˘æ_ï
]) {

4063 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

4064 
¨
->
tx_≥ndög
[¨->
˘æ_ï
] =0, 
WMI_TIMEOUT
);

4065 i‡(
À·
 == 0) {

4066 
	`©h6kl_w¨n
("clear wmi ctrl dataÅimeoutÅxpend %d\n",

4067 
¨
->
tx_≥ndög
[¨->
˘æ_ï
]);

4068 
ªt
 = -
ETIMEDOUT
;

4069 } i‡(
À·
 < 0) {

4070 
	`©h6kl_w¨n
("clear wmi ctrl data failed:%dÅx_pend=%d\n",

4071 
À·
, 
¨
->
tx_≥ndög
[¨->
˘æ_ï
]);

4072 
ªt
 = 
À·
;

4076  
ªt
;

4077 
	}
}

4079 
	$©h6kl_cfg80211_su•íd
(
©h6kl
 *
¨
,

4080 
©h6kl_cfg_su•íd_mode
 
mode
,

4081 
cfg80211_wowœn
 *
wow
)

4083 
ªt
;

4084 
u32
 
√ed_su•íd_vif
 = 0;

4086 i‡(
	`©h6kl_cfg80211_√ed_su•íd
(
¨
, &
√ed_su•íd_vif
)

4087 && 
¨
->
gë_wow_∑âîn
 =
åue
)

4088 
mode
 = 
ATH6KL_CFG_SUSPEND_WOW
;

4090 
mode
) {

4091 
ATH6KL_CFG_SUSPEND_WOW
:

4093 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
, "wow mode suspend\n");

4096 
	`©h6kl_tx_d©a_˛ónup
(
¨
);

4097 #ifde‡
USB_AUTO_SUSPEND


4098 
¨
->
°©e
 = 
ATH6KL_STATE_PRE_SUSPEND
;

4100 
ªt
 = 
	`©h6kl_wow_su•íd
(
¨
, 
wow
);

4101 i‡(
ªt
) {

4102 
	`©h6kl_îr
("wow su•íd faûed: %d\n", 
ªt
);

4103 #ifde‡
USB_AUTO_SUSPEND


4104 
¨
->
°©e
 = 
ATH6KL_STATE_WOW
;

4106  
ªt
;

4108 
	`•ö_lock_bh
(&
¨
->
°©e_lock
);

4109 
¨
->
°©e
 = 
ATH6KL_STATE_WOW
;

4110 
	`•ö_u∆ock_bh
(&
¨
->
°©e_lock
);

4113 
ATH6KL_CFG_SUSPEND_DEEPSLEEP
:

4114 i‡(
¨
->
°©e
 =
ATH6KL_STATE_DEEPSLEEP
)

4117 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
, "deep sleep suspend\n");

4119 #ifde‡
USB_AUTO_SUSPEND


4120 
¨
->
°©e
 = 
ATH6KL_STATE_PRE_SUSPEND_DEEPSLEEP
;

4122 
ªt
 = 
	`©h6kl_cfg80211_dìp¶ìp_su•íd
(
¨
);

4123 i‡(
ªt
) {

4124 
	`©h6kl_îr
("dìp¶ì∞su•íd faûed: %d\n", 
ªt
);

4125  
ªt
;

4130 
ATH6KL_CFG_SUSPEND_CUTPOWER
:

4132 #ifde‡
CONFIG_ANDROID


4133 i‡(
¨
->
wow_úq
) {

4134 i‡(
	`dißbÀ_úq_wake
(
¨
->
wow_úq
))

4135 
	`©h6kl_îr
("Couldn't disable hostwake IRQ wakeup mode\n");

4137 
	`‰ì_úq
(
¨
->
wow_úq
,ár);

4141 
	`©h6kl_cfg80211_°›_Æl
(
¨
);

4143 i‡(
¨
->
°©e
 =
ATH6KL_STATE_OFF
) {

4144 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
,

4149 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
, "suspend cuttingÖower\n");

4151 
ªt
 = 
	`©h6kl_öô_hw_°›
(
¨
);

4152 i‡(
ªt
) {

4153 
	`©h6kl_w¨n
("failedÅo stop hw during suspend: %d\n",

4154 
ªt
);

4157 
¨
->
°©e
 = 
ATH6KL_STATE_CUTPOWER
;

4166 
	}
}

4168 
	$©h6kl_cfg80211_ªsume
(
©h6kl
 *
¨
)

4170 
i
, 
ªt
;

4171 
©h6kl_vif
 *
vif
;

4173 
¨
->
°©e
) {

4174 
ATH6KL_STATE_WOW
:

4175 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
, "wow modeÑesume\n");

4177 #ifde‡
CONFIG_HAS_WAKELOCK


4178 
	`wake_lock_timeout
(&
¨
->
wake_lock
, 3*
HZ
);

4185 
	`•ö_lock_bh
(&
¨
->
°©e_lock
);

4186 
¨
->
°©e
 = 
ATH6KL_STATE_ON
;

4187 
	`•ö_u∆ock_bh
(&
¨
->
°©e_lock
);

4189 
ªt
 = 
	`©h6kl_wow_ªsume
(
¨
);

4190 i‡(
ªt
) {

4191 
	`©h6kl_w¨n
("wow modêªsumêÁûed: %d\n", 
ªt
);

4192  
ªt
;

4195 #ifde‡
USB_AUTO_SUSPEND


4196 
	`•ö_lock_bh
(&
¨
->
usb_pm_lock
);

4197 
	`©h6kl_auto_pm_wakeup_ªsume
(
¨
);

4198 
	`•ö_u∆ock_bh
(&
¨
->
usb_pm_lock
);

4202 
ATH6KL_STATE_DEEPSLEEP
:

4203 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
, "deep sleepÑesume\n");

4205 
	`•ö_lock_bh
(&
¨
->
°©e_lock
);

4206 
¨
->
°©e
 = 
ATH6KL_STATE_ON
;

4207 
	`•ö_u∆ock_bh
(&
¨
->
°©e_lock
);

4208 #ifde‡
USB_AUTO_SUSPEND


4209 
	`•ö_lock_bh
(&
¨
->
usb_pm_lock
);

4210 
	`©h6kl_auto_pm_wakeup_ªsume
(
¨
);

4211 
	`•ö_u∆ock_bh
(&
¨
->
usb_pm_lock
);

4214 #ifde‡
CONFIG_ANDROID


4215 i‡(
¨
->
wow_úq
) {

4216 
ªt
;

4217 
ªt
 = 
	`ªque°_úq
(
¨
->
wow_úq
, 
©h6kl_wow_úq
,

4218 
IRQF_SHARED
 | 
IRQF_TRIGGER_RISING
,

4219 "¨6000" "sdiowakeup", 
¨
);

4220 i‡(!
ªt
) {

4221 
ªt
 = 
	`íabÀ_úq_wake
(
¨
->
wow_úq
);

4222 i‡(
ªt
 < 0) {

4223 
	`©h6kl_îr
("Couldn'tÉnable WoW IRQás wakeup interrupt");

4224  
ªt
;

4226 
	`©h6kl_öfo
("ath6kl: WoW IRQ %d\n",

4227 
¨
->
wow_úq
);

4231 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4232 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4233 i‡(
vif
) {

4234 i‡(
	`ã°_bô
(
DORMANT
, &
vif
->
Êags
)) {

4235 
	`£t_bô
(
WLAN_ENABLED
, &
vif
->
Êags
);

4236 
	`√tif_d‹m™t_off
(
vif
->
ndev
);

4237 
	`˛ór_bô
(
DORMANT
, &
vif
->
Êags
);

4241 i‡(
vif
->
œ°_pwr_mode
 !vif->
ßved_pwr_mode
) {

4242 i‡(
	`©h6kl_wmi_powîmode_cmd
(
¨
->
wmi
, 
i
,

4243 
vif
->
ßved_pwr_mode
) != 0) {

4244 
	`©h6kl_îr
("wmiÖowermode command failed duringÑesume\n");

4252 
ATH6KL_STATE_CUTPOWER
:

4253 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
, "resumeÑestoringÖower\n");

4255 #ifde‡
CONFIG_ANDROID


4256 i‡(
¨
->
wow_úq
) {

4257 
ªt
;

4258 
ªt
 = 
	`ªque°_úq
(
¨
->
wow_úq
, 
©h6kl_wow_úq
,

4259 
IRQF_SHARED
 | 
IRQF_TRIGGER_RISING
,

4260 "¨6000" "sdiowakeup", 
¨
);

4261 i‡(!
ªt
) {

4262 
ªt
 = 
	`íabÀ_úq_wake
(
¨
->
wow_úq
);

4263 i‡(
ªt
 < 0) {

4264 
	`©h6kl_îr
("Couldn'tÉnable WoW IRQás wakeup interrupt");

4265  
ªt
;

4267 
	`©h6kl_öfo
("ath6kl: WoW IRQ %d\n",

4268 
¨
->
wow_úq
);

4273 
ªt
 = 
	`©h6kl_öô_hw_°¨t
(
¨
);

4274 i‡(
ªt
) {

4275 
	`©h6kl_w¨n
("FaûedÅÿboŸ hw i¿ªsume: %d\n", 
ªt
);

4276  
ªt
;

4285 
	}
}

4287 #ifde‡
CONFIG_PM


4290 
	$__©h6kl_cfg80211_su•íd
(
wùhy
 *wiphy,

4291 
cfg80211_wowœn
 *
wow
)

4293 
©h6kl
 *
¨
 = 
	`wùhy_¥iv
(
wùhy
);

4295 #i‡
	`deföed
(
USB_AUTO_SUSPEND
)

4296 i‡(
	`BOOTSTRAP_IS_HSIC
(
¨
->
boŸ°øp_mode
))

4300  
	`©h6kl_hif_su•íd
(
¨
, 
wow
);

4301 
	}
}

4303 
	$__©h6kl_cfg80211_ªsume
(
wùhy
 *wiphy)

4305 
©h6kl
 *
¨
 = 
	`wùhy_¥iv
(
wùhy
);

4307 i‡(
	`BOOTSTRAP_IS_HSIC
(
¨
->
boŸ°øp_mode
))

4310  
	`©h6kl_hif_ªsume
(
¨
);

4311 
	}
}

4329 
	$©h6kl_check_wow_°©us
(
©h6kl
 *
¨
)

4331 i‡(
¨
->
°©e
 =
ATH6KL_STATE_WOW
)

4332 
	`©h6kl_cfg80211_ªsume
(
¨
);

4333 
	}
}

4337 
	$©h6kl_check_wow_°©us
(
©h6kl
 *
¨
)

4339 
	}
}

4342 #i‚de‡
CFG80211_NO_SET_CHAN_OPERATION


4343 
	$©h6kl_£t_ch™√l
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

4344 
õì80211_ch™√l
 *
ch™
,

4345 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
)

4347 
©h6kl_vif
 *
vif
;

4349 i‡(
dev
 =
NULL
)

4350  -
EBUSY
;

4352 
vif
 = 
	`√tdev_¥iv
(
dev
);

4354 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

4355  -
EIO
;

4357 i‡(
	`down_öãºu±ibÀ
(&
vif
->
¨
->
£m
)) {

4358 
	`©h6kl_îr
("busy, couldn't getáccess\n");

4359  -
ERESTARTSYS
;

4362 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: center_freq=%u hw_value=%u channel_type=%d\n",

4363 
__func__
, 
ch™
->
˚¡î_‰eq
, ch™->
hw_vÆue
, 
ch™√l_ty≥
);

4364 
vif
->
√xt_ch™
 = 
ch™
->
˚¡î_‰eq
;

4366 i‡(
	`©h6kl_mod_debug_quúks
(
vif
->
¨
,

4367 
ATH6KL_MODULE_ENABLE_P2P_CHANMODE
)) {

4368 i‡(
ch™√l_ty≥
 =
NL80211_CHAN_HT40PLUS
)

4369 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_HT40PLUS
;

4370 i‡(
ch™√l_ty≥
 =
NL80211_CHAN_HT40MINUS
)

4371 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_HT40MINUS
;

4372 i‡(
ch™√l_ty≥
 =
NL80211_CHAN_HT20
)

4373 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_HT20
;

4375 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_NONE
;

4377 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_NONE
;

4379 
	`up
(&
vif
->
¨
->
£m
);

4382 
	}
}

4385 
	$©h6kl_£t_≠_¥obe_ª•_õs
(
©h6kl_vif
 *
vif
,

4386 c⁄° 
u8
 *
õs
, 
size_t
 
õs_Àn
)

4388 
©h6kl
 *
¨
 = 
vif
->ar;

4389 c⁄° 
u8
 *
pos
;

4390 
u8
 *
buf
 = 
NULL
;

4391 
size_t
 
Àn
 = 0;

4392 
ªt
;

4399 i‡(
õs
 && 
õs_Àn
) {

4400 
buf
 = 
	`kmÆloc
(
õs_Àn
, 
GFP_KERNEL
);

4401 i‡(
buf
 =
NULL
)

4402  -
ENOMEM
;

4403 
pos
 = 
õs
;

4404 
pos
 + 1 < 
õs
 + 
õs_Àn
) {

4405 i‡(
pos
 + 2 +Öos[1] > 
õs
 + 
õs_Àn
)

4407 i‡((!
	`©h6kl_is_p2p_õ
(
pos
)) &&

4408 (!
	`©h6kl_is_wfd_õ
(
pos
))) {

4409 
	`mem˝y
(
buf
 + 
Àn
, 
pos
, 2 +Öos[1]);

4410 
Àn
 +2 + 
pos
[1];

4412 
pos
 += 2 +Öos[1];

4416 
ªt
 = 
	`©h6kl_wmi_£t_≠põ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

4417 
WMI_FRAME_PROBE_RESP
, 
buf
, 
Àn
);

4418 
	`k‰ì
(
buf
);

4419  
ªt
;

4420 
	}
}

4422 
	$©h6kl_£t_u≠sd
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

4423 c⁄° 
u8
 *
õs
, 
õs_Àn
)

4425 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

4426 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

4427 c⁄° 
u8
 *
pos
;

4428 
u≠sd
 = 0;

4429 
boﬁ
 
found
 = 
Ál£
;

4431 i‡(
õs
 && 
õs_Àn
) {

4432 
pos
 = 
õs
;

4434 
pos
 + 1 < 
õs
 + 
õs_Àn
) {

4435 i‡(
pos
 + 2 +Öos[1] > 
õs
 + 
õs_Àn
)

4438 i‡(
	`©h6kl_is_wmm_õ
(
pos
)) {

4439 
found
 = 
åue
;

4440 i‡(
pos
[8] & 0x80)

4441 
u≠sd
 = 1;

4445 
pos
 += 2 +Öos[1];

4449 i‡(!
found
)

4450 
	`˛ór_bô
(
WMM_ENABLED
, &
vif
->
Êags
);

4452  
	`©h6kl_wmi_≠_£t_≠sd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
u≠sd
);

4453 
	}
}

4455 #ifde‡
PMF_SUPPORT


4456 
	$©h6kl_£t_akm_suôes
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

4457 
cfg80211_c⁄√˘_∑øms
 *
sme
)

4459 c⁄° 
u8
 *
pos
, *
õs
 = 
sme
->
õ
;

4460 
õs_Àn
 = 
sme
->
õ_Àn
;

4461 
ªt
 = 0;

4463 i‡(
õs
 && 
õs_Àn
) {

4464 
pos
 = 
õs
;

4466 
pos
 + 1 < 
õs
 + 
õs_Àn
) {

4467 i‡(
pos
 + 2 +Öos[1] > 
õs
 + 
õs_Àn
)

4470 i‡(
	`©h6kl_is_r¢_õ
(
pos
)) {

4471 
off£t
, 
i
;

4482 i‡(
pos
[1] <= 18)

4486 
off£t
 = 1 + 1 + 2 + 4 + 2 + (
pos
[8] * 4);

4487 i‡(
pos
[
off£t
]) {

4488 
sme
->
¸y±o
.
n_akm_suôes
 = 
pos
[
off£t
];

4489 
sme
->
¸y±o
.
akm_suôes
[0]

4490 
pos
[
off£t
 + 2];

4491 
i
 = 1; i < 4; i++) {

4492 
sme
->
¸y±o
.
akm_suôes
[0]

4493 
sme
->
¸y±o
.
akm_suôes
[0]

4495 
sme
->
¸y±o
.
akm_suôes
[0]

4496 +
pos
[
off£t
 + 2 + 
i
];

4502 
pos
 += 2 +Öos[1];

4506  
ªt
;

4507 
	}
}

4510 
	$©h6kl_£t_r¢_ˇp
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

4511 c⁄° 
u8
 *
õs
, 
õs_Àn
)

4513 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

4514 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

4515 c⁄° 
u8
 *
pos
;

4516 
u16
 
r¢_ˇp
 = 
ATH6KL_RSN_CAP_NULLCONF
;

4517 
ªt
 = 0;

4519 i‡(
õs
 && 
õs_Àn
) {

4520 
pos
 = 
õs
;

4522 
pos
 + 1 < 
õs
 + 
õs_Àn
) {

4523 i‡(
pos
 + 2 +Öos[1] > 
õs
 + 
õs_Àn
)

4526 i‡(
	`©h6kl_is_r¢_õ
(
pos
)) {

4527 
off£t
;

4535 i‡(
pos
[1] <= 18)

4539 
off£t
 = 1 + 1 + 2 + 4 + 2 + (
pos
[8] * 4);

4540 
off£t
 +2 + (
pos
[offset] * 4);

4541 i‡(
off£t
 > (
pos
[1] + 2))

4544 
r¢_ˇp
 = (
pos
[
off£t
] |

4545 (
pos
[
off£t
 + 1] << 8));

4549 
pos
 += 2 +Öos[1];

4553 
vif
->
œ°_r¢_ˇp
 = 
ATH6KL_RSN_CAP_NULLCONF
;

4554 i‡(
r¢_ˇp
 !
ATH6KL_RSN_CAP_NULLCONF
) {

4555 
ªt
 = 
	`©h6kl_wmi_gë_r¢_ˇp
(
¨
->
wmi
, 
vif
->
fw_vif_idx
);

4556 i‡(!
ªt
)

4557 
ªt
 = 
	`©h6kl_wmi_£t_r¢_ˇp
(
¨
->
wmi
,

4558 
vif
->
fw_vif_idx
, 
r¢_ˇp
);

4561  
ªt
;

4562 
	}
}

4564 
u16
 
	$_©h6kl_≠_gë_ch™√l
(
©h6kl_vif
 *
vif
,

4565 
©h6kl_bóc⁄_∑ømëîs
 *
öfo
)

4567 
u16
 
ch™
 = 0;

4571 #ifde‡
CFG80211_NO_SET_CHAN_OPERATION


4578 i‡(
	`©h6kl_mod_debug_quúks
(
vif
->
¨
,

4579 
ATH6KL_MODULE_ENABLE_P2P_CHANMODE
)) {

4580 i‡(
öfo
->
ch™√l_ty≥
 =
NL80211_CHAN_HT40PLUS
)

4581 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_HT40PLUS
;

4582 i‡(
öfo
->
ch™√l_ty≥
 =
NL80211_CHAN_HT40MINUS
)

4583 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_HT40MINUS
;

4584 i‡(
öfo
->
ch™√l_ty≥
 =
NL80211_CHAN_HT20
)

4585 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_HT20
;

4587 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_NONE
;

4589 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_NONE
;

4591 
	`WARN_ON
(!
öfo
->
ch™√l
);

4592 i‡(
öfo
->
ch™√l
)

4593 
vif
->
√xt_ch™
 = 
öfo
->
ch™√l
->
˚¡î_‰eq
;

4595 
vif
->
√xt_ch™
 = 0;

4596 
vif
->
√xt_ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_NONE
;

4605 
ch™
 = 
vif
->
√xt_ch™
;

4606 i‡(
vif
->
√xt_ch™_ty≥
 !
ATH6KL_CHAN_TYPE_NONE
) {

4607 
wmi_c⁄√˘_≠_ch™√l_ty≥
 
ch™_ty≥
 =

4608 
AP_CHANNEL_TYPE_NONE
;

4610 i‡(
vif
->
√xt_ch™_ty≥
 =
ATH6KL_CHAN_TYPE_HT40PLUS
)

4611 
ch™_ty≥
 = 
AP_CHANNEL_TYPE_HT40PLUS
;

4612 i‡(
vif
->
√xt_ch™_ty≥
 =
ATH6KL_CHAN_TYPE_HT40MINUS
)

4613 
ch™_ty≥
 = 
AP_CHANNEL_TYPE_HT40MINUS
;

4614 i‡(
vif
->
√xt_ch™_ty≥
 =
ATH6KL_CHAN_TYPE_HT20
)

4615 
ch™_ty≥
 = 
AP_CHANNEL_TYPE_HT20
;

4617 
ch™
 |(
ch™_ty≥
 << 
WMI_CONNECT_AP_CHAN_SELECT_OFFSET
);

4621 
ch™
 = 
	`©h6kl_≠_rc_gë
(
vif
, chan);

4623  
ch™
;

4624 
	}
}

4626 #ifde‡
NL80211_CMD_SET_AP_MAC_ACL


4627 
	$_©h6kl_a˛_c⁄fig
(
©h6kl_vif
 *
vif
,

4628 c⁄° 
cfg80211_a˛_d©a
 *
a˛
)

4630 
≠_a˛_mode
 
mode
;

4631 
u8
 
mac_addr
[
ETH_ALEN
];

4632 
i
;

4635 
	`©h6kl_≠_a˛_c⁄fig_mac_li°_ª£t
(
vif
);

4638 
	`©h6kl_≠_a˛_c⁄fig_pﬁicy
(
vif
, 
AP_ACL_MODE_DISABLE
);

4641 i‡(
a˛
->
n_a˛_íåõs
 == 0)

4642 
mode
 = 
AP_ACL_MODE_DISABLE
;

4643 i‡(
a˛
->
a˛_pﬁicy
 =
NL80211_ACL_POLICY_ACCEPT_UNLESS_LISTED
)

4644 
mode
 = 
AP_ACL_MODE_ALLOW
;

4645 i‡(
a˛
->
a˛_pﬁicy
 =
NL80211_ACL_POLICY_DENY_UNLESS_LISTED
)

4646 
mode
 = 
AP_ACL_MODE_DENY
;

4648 
	`WARN_ON
(1);

4649 
mode
 = 
AP_ACL_MODE_DISABLE
;

4651 
	`©h6kl_≠_a˛_c⁄fig_pﬁicy
(
vif
, 
mode
);

4654 
i
 = 0; i < 
a˛
->
n_a˛_íåõs
; i++) {

4655 i‡(
i
 < 
AP_ACL_SIZE
) {

4656 
	`mem˝y
(
mac_addr
, 
a˛
->
mac_addrs
[
i
].
addr
, 
ETH_ALEN
);

4657 
	`©h6kl_≠_a˛_c⁄fig_mac_li°
(
vif
, 
mac_addr
, 
Ál£
);

4659 
	`©h6kl_îr
("Wr⁄g ACLÇumbî %d\n", 
a˛
->
n_a˛_íåõs
);

4665 
	}
}

4668 
	$©h6kl_≠_bóc⁄
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

4669 
©h6kl_bóc⁄_∑ømëîs
 *
öfo
, 
boﬁ
 
add
)

4671 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

4672 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

4673 
õì80211_mgmt
 *
mgmt
;

4674 
u8
 *
õs
;

4675 
õs_Àn
;

4676 
wmi_c⁄√˘_cmd
 
p
;

4677 
ªs
;

4678 
i
;

4679 
u16
 
ch™
;

4681 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s:ádd=%d\n", 
__func__
, 
add
);

4683 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

4684  -
EIO
;

4686 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

4687 
	`©h6kl_îr
("busy, couldn't getáccess\n");

4688  -
ERESTARTSYS
;

4691 i‡(
vif
->
√xt_mode
 !
AP_NETWORK
) {

4692 
	`up
(&
¨
->
£m
);

4693  -
EOPNOTSUPP
;

4696 i‡(
öfo
->
bóc⁄_õs
) {

4697 
u8
 *
bóc⁄_õs
 = (u8 *)
öfo
->beacon_ies;

4698 
size_t
 
bóc⁄_õs_Àn
 = 
öfo
->beacon_ies_len;

4700 
	`©h6kl_p2p_ps_u£r_≠p_õ
(
vif
->
p2p_ps_öfo_˘x
,

4701 
WMI_FRAME_BEACON
,

4702 &
bóc⁄_õs
,

4703 &
bóc⁄_õs_Àn
);

4705 
ªs
 = 
	`©h6kl_wmi_£t_≠põ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

4706 
WMI_FRAME_BEACON
,

4707 
bóc⁄_õs
,

4708 
bóc⁄_õs_Àn
);

4709 i‡(
ªs
) {

4710 
	`up
(&
¨
->
£m
);

4711  
ªs
;

4719 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: set DTIM from %dÅo 1.\n",

4720 
__func__
, 
öfo
->
dtim_≥riod
);

4721 
	`©h6kl_wmi_£t_dtim_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 1);

4723 i‡(
öfo
->
¥obîe•_õs
) {

4724 
ªs
 = 
	`©h6kl_£t_≠_¥obe_ª•_õs
(
vif
, 
öfo
->
¥obîe•_õs
,

4725 
öfo
->
¥obîe•_õs_Àn
);

4726 i‡(
ªs
) {

4727 
	`up
(&
¨
->
£m
);

4728  
ªs
;

4731 i‡(
öfo
->
asso¸e•_õs
) {

4732 
ªs
 = 
	`©h6kl_wmi_£t_≠põ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

4733 
WMI_FRAME_ASSOC_RESP
,

4734 
öfo
->
asso¸e•_õs
,

4735 
öfo
->
asso¸e•_õs_Àn
);

4736 i‡(
ªs
) {

4737 
	`up
(&
¨
->
£m
);

4738  
ªs
;

4742 i‡(!
add
) {

4743 
	`up
(&
¨
->
£m
);

4747 #ifde‡
NL80211_CMD_SET_AP_MAC_ACL


4749 i‡(
öfo
->
a˛
)

4750 
	`_©h6kl_a˛_c⁄fig
(
vif
, 
öfo
->
a˛
);

4754 i‡(
öfo
->
öa˘ivôy_timeout
)

4755 
	`©h6kl_≠_kì∑live_c⁄fig_by_suµ
(
vif
,

4756 
öfo
->
öa˘ivôy_timeout
);

4759 i‡(
	`©h6kl_£t_u≠sd
(
wùhy
, 
dev
, 
öfo
->
èû
, info->
èû_Àn
)) {

4760 
	`up
(&
¨
->
£m
);

4761  -
EIO
;

4765 i‡(
	`©h6kl_£t_r¢_ˇp
(
wùhy
, 
dev
, 
öfo
->
èû
, info->
èû_Àn
)) {

4766 
	`up
(&
¨
->
£m
);

4767  -
EIO
;

4771 i‡(
vif
 =
	`©h6kl_vif_fú°
(
¨
)) {

4772 i‡(
	`©h6kl_wmi_powîmode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

4773 
MAX_PERF_POWER
)) {

4774 
	`up
(&
¨
->
£m
);

4775  -
EIO
;

4779 
vif
->
≠_mode_bkey
.
vÆid
 = 
Ál£
;

4781 i‡(
öfo
->
bóc⁄_öãrvÆ
) {

4782 
ªs
 = 
	`©h6kl_wmi_£t_bóc⁄_öãrvÆ_cmd
(
¨
->
wmi
,

4783 
vif
->
fw_vif_idx
, 
öfo
->
bóc⁄_öãrvÆ
);

4784 i‡(
ªs
) {

4785 
	`up
(&
¨
->
£m
);

4786  
ªs
;

4790 i‡(
öfo
->
hód
 =
NULL
) {

4791 
	`up
(&
¨
->
£m
);

4792  -
EINVAL
;

4794 
mgmt
 = (
õì80211_mgmt
 *Ë
öfo
->
hód
;

4795 
õs
 = 
mgmt
->
u
.
bóc⁄
.
v¨übÀ
;

4796 i‡(
õs
 > 
öfo
->
hód
 + info->
hód_Àn
) {

4797 
	`up
(&
¨
->
£m
);

4798  -
EINVAL
;

4800 
õs_Àn
 = 
öfo
->
hód
 + info->
hód_Àn
 - 
õs
;

4802 i‡(
öfo
->
ssid
 =
NULL
) {

4803 
	`up
(&
¨
->
£m
);

4804  -
EINVAL
;

4806 
	`mem˝y
(
vif
->
ssid
, 
öfo
->ssid, info->
ssid_Àn
);

4807 
vif
->
ssid_Àn
 = 
öfo
->ssid_len;

4809 i‡(
öfo
->
hiddí_ssid
 =
NL80211_HIDDEN_SSID_ZERO_LEN
) {

4810 
	`up
(&
¨
->
£m
);

4811  -
ENOTSUPP
;

4812 } i‡(
öfo
->
hiddí_ssid
 =
NL80211_HIDDEN_SSID_ZERO_CONTENTS
) {

4813 
ªs
 = 
	`©h6kl_wmi_£t_hiddí_ssid_cmd
(

4814 
¨
->
wmi
, 
vif
->
fw_vif_idx
, 1);

4816 
ªs
 = 
	`©h6kl_wmi_£t_hiddí_ssid_cmd
(

4817 
¨
->
wmi
, 
vif
->
fw_vif_idx
, 0);

4819 i‡(
ªs
) {

4820 
	`up
(&
¨
->
£m
);

4821  
ªs
;

4824 
ªs
 = 
	`©h6kl_£t_auth_ty≥
(
vif
, 
öfo
->
auth_ty≥
);

4825 i‡(
ªs
) {

4826 
	`up
(&
¨
->
£m
);

4827  
ªs
;

4830 
	`mem£t
(&
p
, 0, (p));

4832 
i
 = 0; i < 
öfo
->
¸y±o
.
n_akm_suôes
; i++) {

4833 
öfo
->
¸y±o
.
akm_suôes
[
i
]) {

4834 
WLAN_AKM_SUITE_8021X
:

4835 i‡(
öfo
->
¸y±o
.
w∑_vîsi⁄s
 & 
NL80211_WPA_VERSION_1
)

4836 
p
.
auth_mode
 |
WPA_AUTH
;

4837 i‡(
öfo
->
¸y±o
.
w∑_vîsi⁄s
 & 
NL80211_WPA_VERSION_2
)

4838 
p
.
auth_mode
 |
WPA2_AUTH
;

4840 
WLAN_AKM_SUITE_PSK
:

4841 i‡(
öfo
->
¸y±o
.
w∑_vîsi⁄s
 & 
NL80211_WPA_VERSION_1
)

4842 
p
.
auth_mode
 |
WPA_PSK_AUTH
;

4843 i‡(
öfo
->
¸y±o
.
w∑_vîsi⁄s
 & 
NL80211_WPA_VERSION_2
)

4844 
p
.
auth_mode
 |
WPA2_PSK_AUTH
;

4848 i‡(
p
.
auth_mode
 == 0)

4849 
p
.
auth_mode
 = 
NONE_AUTH
;

4850 
vif
->
auth_mode
 = 
p
.auth_mode;

4852 
i
 = 0; i < 
öfo
->
¸y±o
.
n_cùhîs_∑úwi£
; i++) {

4853 
öfo
->
¸y±o
.
cùhîs_∑úwi£
[
i
]) {

4854 
WLAN_CIPHER_SUITE_WEP40
:

4855 
WLAN_CIPHER_SUITE_WEP104
:

4856 
p
.
¥wi£_¸y±o_ty≥
 |
WEP_CRYPT
;

4858 
WLAN_CIPHER_SUITE_TKIP
:

4859 
p
.
¥wi£_¸y±o_ty≥
 |
TKIP_CRYPT
;

4861 
WLAN_CIPHER_SUITE_CCMP
:

4862 
p
.
¥wi£_¸y±o_ty≥
 |
AES_CRYPT
;

4864 
WLAN_CIPHER_SUITE_SMS4
:

4865 
p
.
¥wi£_¸y±o_ty≥
 |
WAPI_CRYPT
;

4869 i‡(
p
.
¥wi£_¸y±o_ty≥
 == 0) {

4870 
p
.
¥wi£_¸y±o_ty≥
 = 
NONE_CRYPT
;

4871 
	`©h6kl_£t_cùhî
(
vif
, 0, 
åue
);

4872 } i‡(
öfo
->
¸y±o
.
n_cùhîs_∑úwi£
 == 1)

4873 
	`©h6kl_£t_cùhî
(
vif
, 
öfo
->
¸y±o
.
cùhîs_∑úwi£
[0], 
åue
);

4875 
öfo
->
¸y±o
.
cùhî_group
) {

4876 
WLAN_CIPHER_SUITE_WEP40
:

4877 
WLAN_CIPHER_SUITE_WEP104
:

4878 
p
.
gΩ_¸y±o_ty≥
 = 
WEP_CRYPT
;

4880 
WLAN_CIPHER_SUITE_TKIP
:

4881 
p
.
gΩ_¸y±o_ty≥
 = 
TKIP_CRYPT
;

4883 
WLAN_CIPHER_SUITE_CCMP
:

4884 
p
.
gΩ_¸y±o_ty≥
 = 
AES_CRYPT
;

4886 
WLAN_CIPHER_SUITE_SMS4
:

4887 
p
.
gΩ_¸y±o_ty≥
 = 
WAPI_CRYPT
;

4890 
p
.
gΩ_¸y±o_ty≥
 = 
NONE_CRYPT
;

4893 
	`©h6kl_£t_cùhî
(
vif
, 
öfo
->
¸y±o
.
cùhî_group
, 
Ál£
);

4895 
p
.
nw_ty≥
 = 
AP_NETWORK
;

4896 
vif
->
nw_ty≥
 = vif->
√xt_mode
;

4898 
p
.
ssid_Àn
 = 
vif
->ssid_len;

4899 
	`mem˝y
(
p
.
ssid
, 
vif
->ssid, vif->
ssid_Àn
);

4900 
p
.
dŸ11_auth_mode
 = 
vif
->dot11_auth_mode;

4902 
ch™
 = 
	`_©h6kl_≠_gë_ch™√l
(
vif
, 
öfo
);

4903 
p
.
ch
 = 
	`˝u_to_À16
(
ch™
);

4905 
ªs
 = 
	`©h6kl_wmi_≠_¥ofûe_commô
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, &
p
);

4906 i‡(
ªs
 < 0) {

4907 
	`up
(&
¨
->
£m
);

4908  
ªs
;

4911 
	`up
(&
¨
->
£m
);

4914 
	}
}

4916 #ifde‡
NL80211_CMD_START_STOP_AP


4917 
	$©h6kl_°¨t_≠
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

4918 
cfg80211_≠_£âögs
 *
£âögs
)

4920 
©h6kl_bóc⁄_∑ømëîs
 *
öfo
;

4921 
ªt
 = 0;

4923 
öfo
 = 
	`kzÆloc
((
©h6kl_bóc⁄_∑ømëîs
), 
GFP_ATOMIC
);

4924 i‡(
öfo
 =
NULL
)

4925  -
ENOMEM
;

4928 
öfo
->
bóc⁄_öãrvÆ
 = 
£âögs
->beacon_interval;

4929 
öfo
->
dtim_≥riod
 = 
£âögs
->dtim_period;

4930 
öfo
->
ssid
 = 
£âögs
->ssid;

4931 
öfo
->
ssid_Àn
 = 
£âögs
->ssid_len;

4932 
öfo
->
hiddí_ssid
 = 
£âögs
->hidden_ssid;

4933 
	`mem˝y
(&
öfo
->
¸y±o
,

4934 &
£âögs
->
¸y±o
,

4935 (
cfg80211_¸y±o_£âögs
));

4936 
öfo
->
¥ivacy
 = 
£âögs
->privacy;

4937 
öfo
->
auth_ty≥
 = 
£âögs
->auth_type;

4938 
öfo
->
öa˘ivôy_timeout
 = 
£âögs
->inactivity_timeout;

4939 #ifde‡
CFG80211_NO_SET_CHAN_OPERATION


4940 #ifde‡
CFG80211_NEW_CHAN_DEFINITION


4941 
öfo
->
ch™√l
 = 
£âögs
->
ch™def
.
ch™
;

4942 
öfo
->
ch™√l_ty≥
 = 
	`cfg80211_gë_ch™def_ty≥
(&
£âögs
->
ch™def
);

4944 
öfo
->
ch™√l
 = 
£âögs
->channel;

4945 
öfo
->
ch™√l_ty≥
 = 
£âögs
->channel_type;

4948 
öfo
->
p2p_˘wödow
 = 0;

4949 
öfo
->
p2p_›p_ps
 = 
Ál£
;

4950 #ifde‡
NL80211_CMD_SET_AP_MAC_ACL


4951 
öfo
->
a˛
 = 
£âögs
->acl;

4958 
öfo
->
ød¨_ªquúed
 = 
Ál£
;

4960 
öfo
->
hód
 = 
£âögs
->
bóc⁄
.head;

4961 
öfo
->
èû
 = 
£âögs
->
bóc⁄
.tail;

4962 
öfo
->
hód_Àn
 = 
£âögs
->
bóc⁄
.head_len;

4963 
öfo
->
èû_Àn
 = 
£âögs
->
bóc⁄
.tail_len;

4964 
öfo
->
bóc⁄_õs
 = 
£âögs
->
bóc⁄
.beacon_ies;

4965 
öfo
->
bóc⁄_õs_Àn
 = 
£âögs
->
bóc⁄
.beacon_ies_len;

4966 
öfo
->
¥obîe•_õs
 = 
£âögs
->
bóc⁄
.proberesp_ies;

4967 
öfo
->
¥obîe•_õs_Àn
 = 
£âögs
->
bóc⁄
.proberesp_ies_len;

4968 
öfo
->
asso¸e•_õs
 = 
£âögs
->
bóc⁄
.assocresp_ies;

4969 
öfo
->
asso¸e•_õs_Àn
 = 
£âögs
->
bóc⁄
.assocresp_ies_len;

4970 
öfo
->
¥obe_ª•
 = 
£âögs
->
bóc⁄
.probe_resp;

4971 
öfo
->
¥obe_ª•_Àn
 = 
£âögs
->
bóc⁄
.probe_resp_len;

4973 
ªt
 = 
	`©h6kl_≠_bóc⁄
(
wùhy
, 
dev
, 
öfo
, 
åue
);

4974 
	`k‰ì
(
öfo
);

4976  
ªt
;

4977 
	}
}

4979 
	$©h6kl_ch™ge_bóc⁄
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

4980 
cfg80211_bóc⁄_d©a
 *
£âögs
)

4982 
©h6kl_bóc⁄_∑ømëîs
 *
öfo
;

4983 
ªt
 = 0;

4985 
öfo
 = 
	`kzÆloc
((
©h6kl_bóc⁄_∑ømëîs
), 
GFP_ATOMIC
);

4986 i‡(
öfo
 =
NULL
)

4987  -
ENOMEM
;

4990 
öfo
->
hód
 = 
£âögs
->head;

4991 
öfo
->
èû
 = 
£âögs
->tail;

4992 
öfo
->
hód_Àn
 = 
£âögs
->head_len;

4993 
öfo
->
èû_Àn
 = 
£âögs
->tail_len;

4994 
öfo
->
bóc⁄_õs
 = 
£âögs
->beacon_ies;

4995 
öfo
->
bóc⁄_õs_Àn
 = 
£âögs
->beacon_ies_len;

4996 
öfo
->
¥obîe•_õs
 = 
£âögs
->proberesp_ies;

4997 
öfo
->
¥obîe•_õs_Àn
 = 
£âögs
->proberesp_ies_len;

4998 
öfo
->
asso¸e•_õs
 = 
£âögs
->assocresp_ies;

4999 
öfo
->
asso¸e•_õs_Àn
 = 
£âögs
->assocresp_ies_len;

5000 
öfo
->
¥obe_ª•
 = 
£âögs
->probe_resp;

5001 
öfo
->
¥obe_ª•_Àn
 = 
£âögs
->probe_resp_len;

5003 
ªt
 = 
	`©h6kl_≠_bóc⁄
(
wùhy
, 
dev
, 
öfo
, 
Ál£
);

5004 
	`k‰ì
(
öfo
);

5006  
ªt
;

5007 
	}
}

5009 
	$©h6kl_add_bóc⁄
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

5010 
bóc⁄_∑ømëîs
 *
£âögs
)

5012 
©h6kl_bóc⁄_∑ømëîs
 *
öfo
;

5013 
ªt
 = 0;

5015 
öfo
 = 
	`kzÆloc
((
©h6kl_bóc⁄_∑ømëîs
), 
GFP_ATOMIC
);

5016 i‡(
öfo
 =
NULL
)

5017  -
ENOMEM
;

5020 
öfo
->
bóc⁄_öãrvÆ
 = 
£âögs
->
öãrvÆ
;

5021 
öfo
->
dtim_≥riod
 = 
£âögs
->dtim_period;

5022 
öfo
->
ssid
 = 
£âögs
->ssid;

5023 
öfo
->
ssid_Àn
 = 
£âögs
->ssid_len;

5024 
öfo
->
hiddí_ssid
 = 
£âögs
->hidden_ssid;

5025 
	`mem˝y
(&
öfo
->
¸y±o
,

5026 &
£âögs
->
¸y±o
,

5027 (
cfg80211_¸y±o_£âögs
));

5028 
öfo
->
¥ivacy
 = 
£âögs
->privacy;

5029 
öfo
->
auth_ty≥
 = 
£âögs
->auth_type;

5031 
öfo
->
hód
 = 
£âögs
->head;

5032 
öfo
->
èû
 = 
£âögs
->tail;

5033 
öfo
->
hód_Àn
 = 
£âögs
->head_len;

5034 
öfo
->
èû_Àn
 = 
£âögs
->tail_len;

5035 
öfo
->
bóc⁄_õs
 = 
£âögs
->beacon_ies;

5036 
öfo
->
bóc⁄_õs_Àn
 = 
£âögs
->beacon_ies_len;

5037 
öfo
->
¥obîe•_õs
 = 
£âögs
->proberesp_ies;

5038 
öfo
->
¥obîe•_õs_Àn
 = 
£âögs
->proberesp_ies_len;

5039 
öfo
->
asso¸e•_õs
 = 
£âögs
->assocresp_ies;

5040 
öfo
->
asso¸e•_õs_Àn
 = 
£âögs
->assocresp_ies_len;

5041 
öfo
->
¥obe_ª•
 = 
£âögs
->probe_resp;

5042 
öfo
->
¥obe_ª•_Àn
 = 
£âögs
->probe_resp_len;

5044 
ªt
 = 
	`©h6kl_≠_bóc⁄
(
wùhy
, 
dev
, 
öfo
, 
åue
);

5045 
	`k‰ì
(
öfo
);

5047  
ªt
;

5048 
	}
}

5050 
	$©h6kl_£t_bóc⁄
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

5051 
bóc⁄_∑ømëîs
 *
£âögs
)

5053 
©h6kl_bóc⁄_∑ømëîs
 *
öfo
;

5054 
ªt
 = 0;

5056 
öfo
 = 
	`kzÆloc
((
©h6kl_bóc⁄_∑ømëîs
), 
GFP_ATOMIC
);

5057 i‡(
öfo
 =
NULL
)

5058  -
ENOMEM
;

5061 
öfo
->
hód
 = 
£âögs
->head;

5062 
öfo
->
èû
 = 
£âögs
->tail;

5063 
öfo
->
hód_Àn
 = 
£âögs
->head_len;

5064 
öfo
->
èû_Àn
 = 
£âögs
->tail_len;

5065 
öfo
->
bóc⁄_õs
 = 
£âögs
->beacon_ies;

5066 
öfo
->
bóc⁄_õs_Àn
 = 
£âögs
->beacon_ies_len;

5067 
öfo
->
¥obîe•_õs
 = 
£âögs
->proberesp_ies;

5068 
öfo
->
¥obîe•_õs_Àn
 = 
£âögs
->proberesp_ies_len;

5069 
öfo
->
asso¸e•_õs
 = 
£âögs
->assocresp_ies;

5070 
öfo
->
asso¸e•_õs_Àn
 = 
£âögs
->assocresp_ies_len;

5071 
öfo
->
¥obe_ª•
 = 
£âögs
->probe_resp;

5072 
öfo
->
¥obe_ª•_Àn
 = 
£âögs
->probe_resp_len;

5074 
ªt
 = 
	`©h6kl_≠_bóc⁄
(
wùhy
, 
dev
, 
öfo
, 
Ál£
);

5075 
	`k‰ì
(
öfo
);

5077  
ªt
;

5078 
	}
}

5080 
	$©h6kl_dñ_bóc⁄
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
)

5082 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

5083 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5085 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

5086  -
EIO
;

5088 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

5089 
	`©h6kl_îr
("busy, couldn't getáccess\n");

5090  -
ERESTARTSYS
;

5093 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
) {

5094 
	`up
(&
¨
->
£m
);

5095  -
EOPNOTSUPP
;

5097 i‡(!
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)) {

5098 
	`up
(&
¨
->
£m
);

5099  -
ENOTCONN
;

5103 i‡(
vif
->
œ°_r¢_ˇp
 !
ATH6KL_RSN_CAP_NULLCONF
)

5104 
	`©h6kl_wmi_£t_r¢_ˇp
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

5105 
vif
->
œ°_r¢_ˇp
);

5108 
	`©h6kl_≠_kì∑live_°›
(
vif
);

5111 
	`©h6kl_≠_a˛_°›
(
vif
);

5114 
	`©h6kl_≠_admc_°›
(
vif
);

5116 
	`©h6kl_wmi_disc⁄√˘_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
);

5117 
	`˛ór_bô
(
CONNECTED
, &
vif
->
Êags
);

5118 
	`©h6kl_judge_rﬂm_∑ømëî
(
vif
, 
åue
);

5119 
	`©h6kl_swôch_∑ømëî_ba£d_⁄_c⁄√˘i⁄
(
vif
, 
åue
);

5121 
	`up
(&
¨
->
£m
);

5124 
	}
}

5126 c⁄° 
u8
 
	gbˇ°_addr
[
ETH_ALEN
] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };

5128 
	$©h6kl_dñ_°©i⁄
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

5129 
u8
 *
mac
)

5131 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

5132 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5133 c⁄° 
u8
 *
addr
 = 
mac
 ? ma¯: 
bˇ°_addr
;

5134 
ªt
;

5135 
©h6kl_°a
 *
°a_c⁄n
 = 
NULL
;

5137 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

5138  -
EIO
;

5140 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

5141 
	`©h6kl_îr
("busy, couldn't getáccess\n");

5142  -
ERESTARTSYS
;

5145 i‡(!
	`is_brﬂdˇ°_ëhî_addr
(
addr
)) {

5146 
°a_c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, (
u8
 *)
addr
);

5147 i‡(
°a_c⁄n
 =
NULL
) {

5148 
	`up
(&
¨
->
£m
);

5149 
ªt
 = 0;

5150  
ªt
;

5154 
ªt
 = 
	`©h6kl_wmi_≠_£t_mlme
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
WMI_AP_DEAUTH
,

5155 
addr
, 
WLAN_REASON_PREV_AUTH_NOT_VALID
);

5157 
	`up
(&
¨
->
£m
);

5159  
ªt
;

5160 
	}
}

5162 
	$©h6kl_ch™ge_°©i⁄
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

5163 
u8
 *
mac
, 
°©i⁄_∑ømëîs
 *
∑øms
)

5165 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

5166 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5167 
ªt
 = 0;

5168 
©h6kl_°a
 *
°a_c⁄n
 = 
NULL
;

5170 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

5171  -
EIO
;

5173 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

5174 
	`©h6kl_îr
("busy, couldn't getáccess\n");

5175  -
ERESTARTSYS
;

5178 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
) {

5179 
	`up
(&
¨
->
£m
);

5180  -
EOPNOTSUPP
;

5184 i‡(!(
∑øms
->
°a_Êags_mask
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHORIZED
))) {

5185 
	`up
(&
¨
->
£m
);

5186  -
EOPNOTSUPP
;

5189 i‡(
∑øms
->
°a_Êags_£t
 & 
	`BIT
(
NL80211_STA_FLAG_AUTHORIZED
)) {

5190 
ªt
 = 
	`©h6kl_wmi_≠_£t_mlme
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

5191 
WMI_AP_MLME_AUTHORIZE
, 
mac
, 0);

5193 
	`up
(&
¨
->
£m
);

5195  
ªt
;

5198 i‡(!
	`is_brﬂdˇ°_ëhî_addr
(
mac
)) {

5199 
°a_c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, 
mac
);

5200 i‡(
°a_c⁄n
 =
NULL
) {

5201 
	`up
(&
¨
->
£m
);

5202  
ªt
;

5206 
ªt
 = 
	`©h6kl_wmi_≠_£t_mlme
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

5207 
WMI_AP_MLME_UNAUTHORIZE
, 
mac
, 0);

5209 
	`up
(&
¨
->
£m
);

5211  
ªt
;

5212 
	}
}

5214 
	$_©h6kl_ªmaö_⁄_ch™√l
(
wùhy
 *wiphy,

5215 
√t_devi˚
 *
dev
,

5216 
õì80211_ch™√l
 *
ch™
,

5217 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
,

5218 
duøti⁄
,

5219 
u64
 *
cookõ
)

5221 
	#MAX_ROC_PERIOD
 \

	)

5222 (
ATH6KL_ROC_MAX_PERIOD
 * 
HZ
 + HZ / ATH6KL_ROC_MAX_PERIOD)

5223 
	#MAX_SCAN_PERIOD
 (
ATH6KL_SCAN_FG_MAX_PERIOD
 * 
HZ
)

	)

5224 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

5225 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5226 
u32
 
id
;

5227 
ªt
;

5228 
À·
;

5230 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

5231  -
EIO
;

5233 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

5234 
	`©h6kl_îr
("busy, couldn't getáccess\n");

5235  -
ERESTARTSYS
;

5239 i‡(
vif
->
sˇn_ªq
) {

5240 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

5242 
vif
->
œ°_roc_id
);

5244 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

5245 !
vif
->
sˇn_ªq
,

5246 
MAX_SCAN_PERIOD
);

5248 i‡(
	`sig«l_≥ndög
(
cuºít
)) {

5249 
	`©h6kl_îr
("RoC :Üast scanÇot yet finish?\n");

5250 
	`up
(&
¨
->
£m
);

5251  -
EBUSY
;

5256 i‡(
	`ã°_bô
(
ROC_PEND
, &
vif
->
Êags
)) {

5257 
	`©h6kl_îr
("RoC : Receive duplicate ROC.\n");

5258 
	`up
(&
¨
->
£m
);

5259  -
EBUSY
;

5263 i‡(
	`ã°_bô
(
ROC_ONGOING
, &
vif
->
Êags
)) {

5264 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

5266 
vif
->
œ°_roc_id
,

5267 ((
	`ã°_bô
(
ROC_PEND
, &
vif
->
Êags
)) ? 1 : 0),

5268 ((
	`ã°_bô
(
ROC_ONGOING
, &
vif
->
Êags
)) ? 1 : 0));

5270 
	`£t_bô
(
ROC_WAIT_EVENT
, &
vif
->
Êags
);

5271 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

5272 !
	`ã°_bô
(
ROC_ONGOING
, &
vif
->
Êags
),

5273 
MAX_ROC_PERIOD
);

5275 i‡(
À·
 == 0) {

5276 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

5278 
	`˛ór_bô
(
ROC_WAIT_EVENT
, &
vif
->
Êags
);

5279 
	`˛ór_bô
(
ROC_ONGOING
, &
vif
->
Êags
);

5282 i‡(
	`sig«l_≥ndög
(
cuºít
)) {

5283 
	`©h6kl_îr
("RoC :Üast RoCÇot yet finish?\n");

5284 
	`up
(&
¨
->
£m
);

5285  -
EBUSY
;

5289 
	`•ö_lock_bh
(&
vif
->
if_lock
);

5290 
id
 = ++
vif
->
œ°_roc_id
;

5291 i‡(
id
 == 0) {

5293 
id
 = ++
vif
->
œ°_roc_id
;

5295 *
cookõ
 = 
id
;

5296 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

5299 
vif
->
œ°_roc_ch™√l
 = 
ch™
;

5300 
vif
->
œ°_roc_duøti⁄
 = 
duøti⁄
;

5302 
	`£t_bô
(
ROC_PEND
, &
vif
->
Êags
);

5303 
ªt
 = 
	`©h6kl_wmi_ªmaö_⁄_ch∆_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

5304 
ch™
->
˚¡î_‰eq
, 
duøti⁄
);

5305 
	`up
(&
¨
->
£m
);

5307  
ªt
;

5308 #unde‡
MAX_ROC_PERIOD


5309 #unde‡
MAX_SCAN_PERIOD


5310 
	}
}

5312 
	$_©h6kl_ˇn˚l_ªmaö_⁄_ch™√l
(
wùhy
 *wiphy,

5313 
√t_devi˚
 *
dev
,

5314 
u64
 
cookõ
)

5316 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

5317 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5318 
ªt
;

5319 
À·
;

5321 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

5322  -
EIO
;

5324 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

5325 
	`©h6kl_îr
("busy, couldn't getáccess\n");

5326  -
ERESTARTSYS
;

5333 i‡(
	`ã°_bô
(
ROC_PEND
, &
vif
->
Êags
)) {

5334 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

5336 
vif
->
œ°_roc_id
);

5338 
	`£t_bô
(
ROC_WAIT_EVENT
, &
vif
->
Êags
);

5339 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

5340 
	`ã°_bô
(
ROC_ONGOING
, &
vif
->
Êags
),

5341 
WMI_TIMEOUT
);

5348 i‡(
À·
 == 0) {

5349 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

5351 
cookõ
,

5352 
vif
->
œ°_roc_id
);

5353 
	`˛ór_bô
(
ROC_WAIT_EVENT
, &
vif
->
Êags
);

5354 
	`˛ór_bô
(
ROC_PEND
, &
vif
->
Êags
);

5355 
	`up
(&
¨
->
£m
);

5359 i‡(
	`sig«l_≥ndög
(
cuºít
)) {

5360 
	`©h6kl_îr
("RoC :Åarget didÇotÑespond\n");

5361 
	`up
(&
¨
->
£m
);

5362  -
EINTR
;

5366 
	`•ö_lock_bh
(&
vif
->
if_lock
);

5367 i‡(
cookõ
 !
vif
->
œ°_roc_id
) {

5368 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

5369 "RoC : C™˚l-RoC %Œx buàcuºíài†%x\n", 
cookõ
,

5370 
vif
->
œ°_roc_id
);

5372 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

5373 
	`up
(&
¨
->
£m
);

5374  -
ENOENT
;

5377 
vif
->
œ°_ˇn˚l_roc_id
 = 
cookõ
;

5378 
	`£t_bô
(
ROC_CANCEL_PEND
, &
vif
->
Êags
);

5379 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

5381 
ªt
 = 
	`©h6kl_wmi_ˇn˚l_ªmaö_⁄_ch∆_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
);

5383 
	`up
(&
¨
->
£m
);

5385  
ªt
;

5386 
	}
}

5388 
	$_©h6kl_mgmt_tx
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

5389 
õì80211_ch™√l
 *
ch™
, 
boﬁ
 
offch™
,

5390 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
,

5391 
boﬁ
 
ch™√l_ty≥_vÆid
, 
waô
,

5392 c⁄° 
u8
 *
buf
, 
size_t
 
Àn
, 
boﬁ
 
no_cck
,

5393 
boﬁ
 
d⁄t_waô_f‹_ack
, 
u64
 *
cookõ
)

5395 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

5396 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5397 
u32
 
id
;

5398 
u32
 
wmi_d©a_Êags
 = 0;

5399 c⁄° 
õì80211_mgmt
 *
mgmt
;

5400 
ªt
 = 0;

5402 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

5403  -
EIO
;

5405 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

5406 
	`©h6kl_îr
("busy, couldn't getáccess\n");

5407  -
ERESTARTSYS
;

5410 i‡((
¨
->
p2p
Ë&& !¨->
p2p_com∑t
 &&

5411 (
¨
->
p2p_c⁄cuºít
) &&

5412 (
vif
->
fw_vif_idx
 =(
¨
->
vif_max
 - 1)) &&

5413 !
	`ã°_bô
(
ROC_ONGOING
, &
vif
->
Êags
)) {

5415 i‡(
	`©h6kl_p2p_is_p2p_‰ame
(
¨
, 
buf
, 
Àn
)) {

5416 
	`©h6kl_îr
("RoC : RoC channel closed, ignoreáction frame\n");

5417 
	`up
(&
¨
->
£m
);

5418  -
EINVAL
;

5423 
id
 = 
vif
->
£nd_a˘i⁄_id
++;

5424 i‡(
id
 == 0) {

5429 
id
 = 
vif
->
£nd_a˘i⁄_id
++;

5432 *
cookõ
 = 
id
;

5435 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

5436 i‡(
	`©h6kl_mgmt_powîßve_≠
(
vif
,

5437 
id
,

5438 
ch™
->
˚¡î_‰eq
,

5439 
waô
,

5440 
buf
,

5441 
Àn
,

5442 
no_cck
,

5443 
d⁄t_waô_f‹_ack
,

5444 &
wmi_d©a_Êags
)) {

5445 
	`up
(&
¨
->
£m
);

5446  
ªt
;

5450 
mgmt
 = (c⁄° 
õì80211_mgmt
 *Ë
buf
;

5451 i‡(
buf
 + 
Àn
 >
mgmt
->
u
.
¥obe_ª•
.
v¨übÀ
 &&

5452 
vif
->
nw_ty≥
 =
AP_NETWORK
 && 
	`ã°_bô
(
CONNECTED
, &vif->
Êags
) &&

5453 
	`õì80211_is_¥obe_ª•
(
mgmt
->
‰ame_c⁄åﬁ
)) {

5458 
ªt
 = 
	`©h6kl_wmi_£nd_go_¥obe_ª•⁄£_cmd
(
¨
->
wmi
, 
vif
,

5459 
buf
, 
Àn
,

5460 
ch™
->
˚¡î_‰eq
);

5461 
	`up
(&
¨
->
£m
);

5462  
ªt
;

5465 
ªt
 = 
	`©h6kl_wmi_£nd_a˘i⁄_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
id
,

5466 
ch™
->
˚¡î_‰eq
, 
waô
,

5467 
buf
, 
Àn
);

5468 
	`up
(&
¨
->
£m
);

5469  
ªt
;

5470 
	}
}

5472 
	$_©h6kl_mgmt_‰ame_ªgi°î
(
wùhy
 *wiphy,

5473 
√t_devi˚
 *
dev
,

5474 
u16
 
‰ame_ty≥
, 
boﬁ
 
ªg
)

5476 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5478 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

5481 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s: frame_type=0x%xÑeg=%d\n",

5482 
__func__
, 
‰ame_ty≥
, 
ªg
);

5483 i‡(
‰ame_ty≥
 =
IEEE80211_STYPE_PROBE_REQ
) {

5489 
vif
->
¥obe_ªq_ªp‹t
 = 
ªg
;

5491 #ifde‡
CE_SUPPORT


5492 i‡(
‰ame_ty≥
 =
IEEE80211_STYPE_PROBE_RESP
)

5493 
vif
->
¥obe_ª•_ªp‹t
 = 
ªg
;

5495 
	}
}

5497 #ifde‡
CFG80211_NETDEV_REPLACED_BY_WDEV


5498 #ifde‡
CFG80211_REMOVE_ROC_CHAN_TYPE


5499 
	$©h6kl_ªmaö_⁄_ch™√l
(
wùhy
 *wiphy,

5500 
wúñess_dev
 *
wdev
,

5501 
õì80211_ch™√l
 *
ch™
,

5502 
duøti⁄
,

5503 
u64
 *
cookõ
)

5505 
	`BUG_ON
(!
wdev
->
√tdev
);

5507  
	`_©h6kl_ªmaö_⁄_ch™√l
(
wùhy
,

5508 
wdev
->
√tdev
,

5509 
ch™
,

5510 
NL80211_CHAN_NO_HT
,

5511 
duøti⁄
,

5512 
cookõ
);

5513 
	}
}

5515 
	$©h6kl_ªmaö_⁄_ch™√l
(
wùhy
 *wiphy,

5516 
wúñess_dev
 *
wdev
,

5517 
õì80211_ch™√l
 *
ch™
,

5518 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
,

5519 
duøti⁄
,

5520 
u64
 *
cookõ
)

5522 
	`BUG_ON
(!
wdev
->
√tdev
);

5524  
	`_©h6kl_ªmaö_⁄_ch™√l
(
wùhy
,

5525 
wdev
->
√tdev
,

5526 
ch™
,

5527 
ch™√l_ty≥
,

5528 
duøti⁄
,

5529 
cookõ
);

5530 
	}
}

5533 
	$©h6kl_ˇn˚l_ªmaö_⁄_ch™√l
(
wùhy
 *wiphy,

5534 
wúñess_dev
 *
wdev
,

5535 
u64
 
cookõ
)

5537 
	`BUG_ON
(!
wdev
->
√tdev
);

5539  
	`_©h6kl_ˇn˚l_ªmaö_⁄_ch™√l
(
wùhy
,

5540 
wdev
->
√tdev
,

5541 
cookõ
);

5542 
	}
}

5544 #ifde‡
CFG80211_REMOVE_ROC_CHAN_TYPE


5545 
	$©h6kl_mgmt_tx
(
wùhy
 *wùhy, 
wúñess_dev
 *
wdev
,

5546 
õì80211_ch™√l
 *
ch™
, 
boﬁ
 
offch™
,

5547 
waô
,

5548 c⁄° 
u8
 *
buf
, 
size_t
 
Àn
, 
boﬁ
 
no_cck
,

5549 
boﬁ
 
d⁄t_waô_f‹_ack
, 
u64
 *
cookõ
)

5551 
	`BUG_ON
(!
wdev
->
√tdev
);

5553  
	`_©h6kl_mgmt_tx
(
wùhy
,

5554 
wdev
->
√tdev
,

5555 
ch™
,

5556 
offch™
,

5557 
NL80211_CHAN_NO_HT
,

5558 
åue
,

5559 
waô
,

5560 
buf
,

5561 
Àn
,

5562 
no_cck
,

5563 
d⁄t_waô_f‹_ack
,

5564 
cookõ
);

5565 
	}
}

5567 
	$©h6kl_mgmt_tx
(
wùhy
 *wùhy, 
wúñess_dev
 *
wdev
,

5568 
õì80211_ch™√l
 *
ch™
, 
boﬁ
 
offch™
,

5569 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
,

5570 
boﬁ
 
ch™√l_ty≥_vÆid
, 
waô
,

5571 c⁄° 
u8
 *
buf
, 
size_t
 
Àn
, 
boﬁ
 
no_cck
,

5572 
boﬁ
 
d⁄t_waô_f‹_ack
, 
u64
 *
cookõ
)

5574 
	`BUG_ON
(!
wdev
->
√tdev
);

5576  
	`_©h6kl_mgmt_tx
(
wùhy
,

5577 
wdev
->
√tdev
,

5578 
ch™
,

5579 
offch™
,

5580 
ch™√l_ty≥
,

5581 
ch™√l_ty≥_vÆid
,

5582 
waô
,

5583 
buf
,

5584 
Àn
,

5585 
no_cck
,

5586 
d⁄t_waô_f‹_ack
,

5587 
cookõ
);

5588 
	}
}

5591 
	$©h6kl_mgmt_‰ame_ªgi°î
(
wùhy
 *wiphy,

5592 
wúñess_dev
 *
wdev
,

5593 
u16
 
‰ame_ty≥
, 
boﬁ
 
ªg
)

5595 
	`BUG_ON
(!
wdev
->
√tdev
);

5597  
	`_©h6kl_mgmt_‰ame_ªgi°î
(
wùhy
,

5598 
wdev
->
√tdev
,

5599 
‰ame_ty≥
,

5600 
ªg
);

5601 
	}
}

5603 
	$©h6kl_ªmaö_⁄_ch™√l
(
wùhy
 *wiphy,

5604 
√t_devi˚
 *
dev
,

5605 
õì80211_ch™√l
 *
ch™
,

5606 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
,

5607 
duøti⁄
,

5608 
u64
 *
cookõ
)

5610  
	`_©h6kl_ªmaö_⁄_ch™√l
(
wùhy
,

5611 
dev
,

5612 
ch™
,

5613 
ch™√l_ty≥
,

5614 
duøti⁄
,

5615 
cookõ
);

5616 
	}
}

5618 
	$©h6kl_ˇn˚l_ªmaö_⁄_ch™√l
(
wùhy
 *wiphy,

5619 
√t_devi˚
 *
dev
,

5620 
u64
 
cookõ
)

5622  
	`_©h6kl_ˇn˚l_ªmaö_⁄_ch™√l
(
wùhy
,

5623 
dev
,

5624 
cookõ
);

5625 
	}
}

5627 
	$©h6kl_mgmt_tx
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

5628 
õì80211_ch™√l
 *
ch™
, 
boﬁ
 
offch™
,

5629 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
,

5630 
boﬁ
 
ch™√l_ty≥_vÆid
, 
waô
,

5631 c⁄° 
u8
 *
buf
, 
size_t
 
Àn
, 
boﬁ
 
no_cck
,

5632 
boﬁ
 
d⁄t_waô_f‹_ack
, 
u64
 *
cookõ
)

5634  
	`_©h6kl_mgmt_tx
(
wùhy
,

5635 
dev
,

5636 
ch™
,

5637 
offch™
,

5638 
ch™√l_ty≥
,

5639 
ch™√l_ty≥_vÆid
,

5640 
waô
,

5641 
buf
,

5642 
Àn
,

5643 
no_cck
,

5644 
d⁄t_waô_f‹_ack
,

5645 
cookõ
);

5646 
	}
}

5648 
	$©h6kl_mgmt_‰ame_ªgi°î
(
wùhy
 *wiphy,

5649 
√t_devi˚
 *
dev
,

5650 
u16
 
‰ame_ty≥
, 
boﬁ
 
ªg
)

5652  
	`_©h6kl_mgmt_‰ame_ªgi°î
(
wùhy
,

5653 
dev
,

5654 
‰ame_ty≥
,

5655 
ªg
);

5656 
	}
}

5659 
	$©h6kl_£t_gtk_ªkey_ofÊﬂd
(
wùhy
 *wiphy,

5660 
√t_devi˚
 *
dev
, 
cfg80211_gtk_ªkey_d©a
 *
d©a
)

5662 
ªt
 = 0;

5663 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

5664 
wmi_gtk_ofÊﬂd_›
 
cmd
;

5665 
©h6kl_vif
 *
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

5667 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "+++\n");

5668 i‡(!
vif
)

5669  -
EIO
;

5671 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

5672  -
EIO
;

5674 i‡(!
d©a
)

5675  
ªt
;

5678 
	`mem£t
(&
cmd
, 0, (
wmi_gtk_ofÊﬂd_›
));

5680 
	`mem˝y
(
cmd
.
kek
, 
d©a
->kek, 
GTK_OFFLOAD_KEK_BYTES
);

5681 
	`mem˝y
(
cmd
.
kck
, 
d©a
->kck, 
GTK_OFFLOAD_KCK_BYTES
);

5682 
	`mem˝y
(
cmd
.
ª∂ay_cou¡î
, 
d©a
->
ª∂ay_˘r
, 
GTK_REPLAY_COUNTER_BYTES
);

5684 
ªt
 = 
	`©h6kl_wm_£t_gtk_ofÊﬂd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
cmd
.
kek
,

5685 
cmd
.
kck
, cmd.
ª∂ay_cou¡î
);

5687  
ªt
;

5688 
	}
}

5690 
	$©h6kl_≠_¥obe_˛õ¡
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

5691 c⁄° 
u8
 *
≥î
, 
u64
 *
cookõ
)

5693 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

5694 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5695 
©h6kl_°a
 *
c⁄n
;

5696 
ªt
;

5698 
	`BUG_ON
(
vif
->
nw_ty≥
 !
AP_NETWORK
);

5700 
c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, (
u8
 *)
≥î
);

5701 i‡(
c⁄n
)

5702 
ªt
 = 
	`©h6kl_wmi_≠_pﬁl_°a
(
¨
->
wmi
,

5703 
vif
->
fw_vif_idx
,

5704 
c⁄n
->
aid
);

5706 
ªt
 = -
EINTR
;

5708 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

5710 
≥î
[0],Öeer[1],Öeer[2],Öeer[3],Öeer[4],Öeer[5],

5711 
vif
->
fw_vif_idx
);

5714  
ªt
;

5715 
	}
}

5717 
boﬁ
 
	$©h6kl_sched_sˇn_åiggî
(
©h6kl_vif
 *
vif
)

5719 
©h6kl
 *
¨
 = 
vif
->ar;

5720 
i
;

5724 i‡(!
¨
->
sche_sˇn
)

5725  
Ál£
;

5727 
i
 = 0; i < 
¨
->
vif_max
; i++) {

5728 
©h6kl_vif
 *
vif_åig
;

5730 
vif_åig
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

5731 i‡((
vif_åig
) &&

5732 (
vif_åig
 !
vif
) &&

5733 (!
	`ã°_bô
(
CONNECTED
, &
vif_åig
->
Êags
)) &&

5734 (
vif_åig
->
sche_sˇn_öãrvÆ
)) {

5735 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
, "sche scanÅriggered\n");

5737  
åue
;

5741  
Ál£
;

5742 
	}
}

5744 
	$©h6kl_sched_sˇn_timî
(
±r
)

5746 
©h6kl_vif
 *
vif
 = (©h6kl_vi‡*)
±r
;

5750 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
, "report sche scan\n");

5752 
	`cfg80211_sched_sˇn_ªsu…s
(
vif
->
¨
->
wùhy
);

5754 
	`mod_timî
(&
vif
->
sche_sˇn_timî
,

5755 
jiffõs
 + 
	`m£cs_to_jiffõs
(
vif
->
sche_sˇn_öãrvÆ
));

5758 
	}
}

5760 
	$©h6kl_sched_sˇn_°¨t
(
wùhy
 *wiphy,

5761 
√t_devi˚
 *
dev
,

5762 
cfg80211_sched_sˇn_ªque°
 *
ªque°
)

5764 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5765 
ªt
 = 0;

5769 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

5771 
ªque°
->
öãrvÆ
,

5772 
ªque°
->
n_ssids
,

5773 
ªque°
->
n_ch™√ls
);

5775 i‡((
vif
->
¨
->
sche_sˇn
) &&

5776 (
vif
->
nw_ty≥
 =
INFRA_NETWORK
)) {

5777 
vif
->
sche_sˇn_öãrvÆ
 = 
ªque°
->
öãrvÆ
;

5779 
	`mod_timî
(&
vif
->
sche_sˇn_timî
,

5780 
jiffõs
 +

5781 
	`m£cs_to_jiffõs
(
vif
->
sche_sˇn_öãrvÆ
));

5783 
ªt
 = -
EOPNOTSUPP
;

5785  
ªt
;

5786 
	}
}

5788 
	$©h6kl_sched_sˇn_°›
(
wùhy
 *wiphy,

5789 
√t_devi˚
 *
dev
)

5791 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

5795 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
, "stop sche scan\n");

5797 i‡(
vif
->
sche_sˇn_öãrvÆ
) {

5798 
	`dñ_timî
(&
vif
->
sche_sˇn_timî
);

5799 
vif
->
sche_sˇn_öãrvÆ
 = 0;

5803 
	}
}

5805 
	$©h6kl_sched_sˇn_öô
(
©h6kl_vif
 *
vif
)

5807 
©h6kl
 *
¨
 = 
vif
->ar;

5811 i‡(
¨
->
sche_sˇn
) {

5812 
vif
->
sche_sˇn_öãrvÆ
 = 0;

5814 
	`öô_timî
(&
vif
->
sche_sˇn_timî
);

5815 
vif
->
sche_sˇn_timî
.
fun˘i⁄
 = 
©h6kl_sched_sˇn_timî
;

5816 
vif
->
sche_sˇn_timî
.
d©a
 = ()(vif);

5820 
	}
}

5822 
	$©h6kl_sched_sˇn_deöô
(
©h6kl_vif
 *
vif
)

5824 
©h6kl
 *
¨
 = 
vif
->ar;

5826 
	`©h6kl_sched_sˇn_°›
(
¨
->
wùhy
, 
vif
->
ndev
);

5829 
	}
}

5832 
	$©h6kl_£t_wow_mode
(
wùhy
 *wùhy, 
cfg80211_wowœn
 *
wow
)

5834 
©h6kl_vif
 *
vif
;

5835 
ªt
 = 0, 
pos
, 
i
;

5836 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

5837 
u32
 
fûãr
 = 0;

5838 
u8
 
mask
[
WOW_MASK_SIZE
];

5839 
u32
 
ho°_ªq_dñay
 = 
WOW_HOST_REQ_DELAY
;

5841 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "%s: +++\n", 
__func__
);

5843 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

5844 i‡(!
vif
) {

5845 
ªt
 = -
EIO
;

5846 
FAIL
;

5849 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
)) {

5850 
ªt
 = -
EIO
;

5851 
FAIL
;

5854 i‡(!
¨
->
gë_wow_∑âîn
 && 
	`WARN_ON
(!
wow
))

5855 
FAIL
;

5860 i‡(
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_SDIO
)

5861 
ho°_ªq_dñay
 = 2000;

5864 i‡(
	`BOOTSTRAP_IS_HSIC
(
¨
->
boŸ°øp_mode
))

5865 
ho°_ªq_dñay
 = 2000;

5868 i‡(!
¨
->
gë_wow_∑âîn
) {

5869 
i
 = 0; i < 
WOW_MAX_FILTERS_PER_LIST
; i++)

5870 
	`©h6kl_wmi_dñ_wow_∑âîn_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

5871 
WOW_LIST_ID
, 
i
);

5874 
i
 = 0; i < 
wow
->
n_∑âîns
; i++) {

5876 i‡(
©h6kl_wow_ext
) {

5877 
ªt
 = 
	`©h6kl_wmi_add_wow_ext_∑âîn_cmd
(

5878 
¨
->
wmi
,

5879 
vif
->
fw_vif_idx
, 
WOW_LIST_ID
,

5880 
wow
->
∑âîns
[
i
].
∑âîn_Àn
,

5881 
i
,

5883 
wow
->
∑âîns
[
i
].
∑âîn
,

5884 
wow
->
∑âîns
[
i
].
mask
);

5886 
fûãr
 |
WOW_FILTER_OPTION_PATTERNS
;

5898 
	`mem£t
(&
mask
, 0, (mask));

5899 
pos
 = 0;

5900 
pos
 < 
wow
->
∑âîns
[
i
].
∑âîn_Àn
;

5901 
pos
++) {

5902 i‡(
wow
->
∑âîns
[
i
].
mask
[
pos
 / 8] &

5903 (0x1 << (
pos
 % 8)))

5904 
mask
[
pos
] = 0xFF;

5915 
ªt
 = 
	`©h6kl_wmi_add_wow_∑âîn_cmd
(
¨
->
wmi
,

5916 
vif
->
fw_vif_idx
, 
WOW_LIST_ID
,

5917 
wow
->
∑âîns
[
i
].
∑âîn_Àn
,

5919 
wow
->
∑âîns
[
i
].
∑âîn
, 
mask
);

5921 i‡(
ªt
)

5922  
ªt
;

5925 
fûãr
 |
WOW_FILTER_OPTION_PATTERNS
;

5927 i‡(
wow
) {

5928 i‡(
wow
->
disc⁄√˘
 || wow->
™y
) {

5929 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "filter: WOW_FILTER_OPTION_NWK_DISASSOC\n");

5930 
fûãr
 |
WOW_FILTER_OPTION_NWK_DISASSOC
;

5933 i‡(
wow
->
magic_pkt
 || wow->
™y
) {

5934 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "filter: WOW_FILTER_OPTION_MAGIC_PACKET\n");

5935 
fûãr
 |
WOW_FILTER_OPTION_MAGIC_PACKET
;

5937 i‡(
wow
->
gtk_ªkey_Áûuª
 || wow->
™y
) {

5938 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
,

5940 
fûãr
 |(
WOW_FILTER_OPTION_EAP_REQ
 |

5941 
WOW_FILTER_OPTION_8021X_4WAYHS
 |

5942 
WOW_FILTER_OPTION_GTK_ERROR
 |

5943 
WOW_FILTER_OPTION_OFFLOAD_GTK
);

5945 i‡(
wow
->
óp_idítôy_ªq
 || wow->
™y
) {

5946 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "filter: WOW_FILTER_OPTION_EAP_REQ\n");

5947 
fûãr
 |
WOW_FILTER_OPTION_EAP_REQ
;

5951 i‡(
wow
->
four_way_h™dshake
 || wow->
™y
) {

5952 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "filter: WOW_FILTER_OPTION_8021X_4WAYHS\n");

5953 
fûãr
 |
WOW_FILTER_OPTION_8021X_4WAYHS
;

5958 i‡(
vif
->
auth_mode
 =
WPA2_AUTH_CCKM
 || vif->auth_modê=
WPA2_PSK_AUTH


5959 || 
vif
->
auth_mode
 =
WPA_AUTH_CCKM
 || vif->auth_modê=
WPA_PSK_AUTH
){

5960 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "filter: WOW_FILTER_OPTION_OFFLOAD_GTK\n");

5961 
fûãr
 |
WOW_FILTER_OPTION_OFFLOAD_GTK
;

5964 i‡(
vif
->
¨p_ofÊﬂd_ù_£t
 || 
wow
->
™y
) {

5965 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "filter: WOW_FILTER_OPTION_OFFLOAD_ARP\n");

5966 
fûãr
 |
WOW_FILTER_OPTION_OFFLOAD_ARP
;

5969 i‡(
fûãr
 || (
wow
 && wow->
n_∑âîns
)) {

5970 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "Së fûãr: 0x%x ", 
fûãr
);

5971 
ªt
 = 
	`©h6kl_wmi_£t_wow_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

5972 
ATH6KL_WOW_MODE_ENABLE
,

5973 
fûãr
,

5974 
ho°_ªq_dñay
);

5977 
	`£t_bô
(
WLAN_WOW_ENABLE
, &
vif
->
Êags
);

5980 
FAIL
:

5981 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "%s: ---Ñëu∫ %d\n", 
__func__
, 
ªt
);

5982  
ªt
;

5983 
	}
}

5985 
	$©h6kl_˛ór_wow_mode
(
wùhy
 *wiphy)

5987 
©h6kl_vif
 *
vif
;

5988 
©h6kl
 *
¨
 = 
	`wùhy_¥iv
(
wùhy
);

5989 
ªt
 = 0;

5991 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "%s: +++\n", 
__func__
);

5993 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

5994 i‡(!
vif
)

5995  -
EIO
;

5996 
ªt
 = 
	`©h6kl_wmi_£t_wow_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

5997 
ATH6KL_WOW_MODE_DISABLE
,

6001 
ªt
 = 
	`©h6kl_wmi_£t_ho°_¶ìp_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

6002 
ATH6KL_HOST_MODE_AWAKE
);

6004 
	`˛ór_bô
(
WLAN_WOW_ENABLE
, &
vif
->
Êags
);

6005 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "%s: ---\n", 
__func__
);

6008  
ªt
;

6009 
	}
}

6012 c⁄° 
õì80211_txrx_°y≥s


6013 
	g©h6kl_mgmt_°y≥s
[
NUM_NL80211_IFTYPES
] = {

6014 [
NL80211_IFTYPE_STATION
] = {

6015 .
tx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

6016 
BIT
(
IEEE80211_STYPE_PROBE_RESP
 >> 4),

6017 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

6018 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4)

6019 #ifde‡
CE_SUPPORT


6020 | 
BIT
(
IEEE80211_STYPE_PROBE_RESP
 >> 4)

6023 [
NL80211_IFTYPE_AP
] = {

6024 .
tx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

6025 
BIT
(
IEEE80211_STYPE_PROBE_RESP
 >> 4),

6026 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

6027 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4)

6028 #ifde‡
CE_SUPPORT


6029 | 
BIT
(
IEEE80211_STYPE_PROBE_RESP
 >> 4)

6032 [
NL80211_IFTYPE_P2P_CLIENT
] = {

6033 .
tx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

6034 
BIT
(
IEEE80211_STYPE_PROBE_RESP
 >> 4),

6035 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

6036 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4)

6037 #ifde‡
CE_SUPPORT


6038 | 
BIT
(
IEEE80211_STYPE_PROBE_RESP
 >> 4)

6041 [
NL80211_IFTYPE_P2P_GO
] = {

6042 .
tx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

6043 
BIT
(
IEEE80211_STYPE_PROBE_RESP
 >> 4),

6044 .
	grx
 = 
BIT
(
IEEE80211_STYPE_ACTION
 >> 4) |

6045 
BIT
(
IEEE80211_STYPE_PROBE_REQ
 >> 4)

6046 #ifde‡
CE_SUPPORT


6047 |
BIT
(
IEEE80211_STYPE_PROBE_RESP
 >> 4)

6052 #ifde‡
NL80211_CMD_SET_AP_MAC_ACL


6053 
	$©h6kl_cfg80211_≠_a˛
(
wùhy
 *wùhy, 
√t_devi˚
 *
dev
,

6054 c⁄° 
cfg80211_a˛_d©a
 *
∑øms
)

6056 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

6058 i‡(
∑øms
)

6059 
	`_©h6kl_a˛_c⁄fig
(
vif
, 
∑øms
);

6062 
	}
}

6066 
cfg80211_›s
 
	g©h6kl_cfg80211_›s
 = {

6067 .
add_vútuÆ_ötf
 = 
©h6kl_cfg80211_add_iÁ˚
,

6068 .
	gdñ_vútuÆ_ötf
 = 
©h6kl_cfg80211_dñ_iÁ˚
,

6069 .
	gch™ge_vútuÆ_ötf
 = 
©h6kl_cfg80211_ch™ge_iÁ˚
,

6070 .
	gch™ge_bss
 = 
©h6kl_cfg80211_ch™ge_bss
,

6071 .
	gsˇn
 = 
©h6kl_cfg80211_sˇn
,

6072 .
	gc⁄√˘
 = 
©h6kl_cfg80211_c⁄√˘
,

6073 .
	gdisc⁄√˘
 = 
©h6kl_cfg80211_disc⁄√˘
,

6074 .
	gadd_key
 = 
©h6kl_cfg80211_add_key
,

6075 .
	ggë_key
 = 
©h6kl_cfg80211_gë_key
,

6076 .
	gdñ_key
 = 
©h6kl_cfg80211_dñ_key
,

6077 .
	g£t_deÁu…_key
 = 
©h6kl_cfg80211_£t_deÁu…_key
,

6078 .
	g£t_wùhy_∑øms
 = 
©h6kl_cfg80211_£t_wùhy_∑øms
,

6079 .
	g£t_tx_powî
 = 
©h6kl_cfg80211_£t_txpowî
,

6080 .
	ggë_tx_powî
 = 
©h6kl_cfg80211_gë_txpowî
,

6081 .
	g£t_powî_mgmt
 = 
©h6kl_cfg80211_£t_powî_mgmt
,

6082 .
	gjoö_ibss
 = 
©h6kl_cfg80211_joö_ibss
,

6083 .
	gÀave_ibss
 = 
©h6kl_cfg80211_Àave_ibss
,

6084 .
	ggë_°©i⁄
 = 
©h6kl_gë_°©i⁄
,

6085 .
	gdump_°©i⁄
 = 
©h6kl_dump_°©i⁄
,

6086 .
	g£t_bôøã_mask
 = 
©h6kl_cfg80211_£t_bôøã_mask
,

6087 .
	g£t_pmkß
 = 
©h6kl_£t_pmkß
,

6088 .
	gdñ_pmkß
 = 
©h6kl_dñ_pmkß
,

6089 .
	gÊush_pmkß
 = 
©h6kl_Êush_pmkß
,

6090 
CFG80211_TESTMODE_CMD
(
©h6kl_tm_cmd
)

6091 #ifde‡
CONFIG_PM


6092 .
	gsu•íd
 = 
__©h6kl_cfg80211_su•íd
,

6093 .
	gªsume
 = 
__©h6kl_cfg80211_ªsume
,

6095 .
	g£t_wow_mode
 = 
©h6kl_£t_wow_mode
,

6096 .
	g˛r_wow_mode
 = 
©h6kl_˛ór_wow_mode
,

6099 .
	g£t_ªkey_d©a
 = 
©h6kl_£t_gtk_ªkey_ofÊﬂd
,

6100 #i‚de‡
CFG80211_NO_SET_CHAN_OPERATION


6101 .
	g£t_ch™√l
 = 
©h6kl_£t_ch™√l
,

6103 #ifde‡
NL80211_CMD_START_STOP_AP


6104 .
	g°¨t_≠
 = 
©h6kl_°¨t_≠
,

6105 .
	gch™ge_bóc⁄
 = 
©h6kl_ch™ge_bóc⁄
,

6106 .
	g°›_≠
 = 
©h6kl_dñ_bóc⁄
,

6108 .
	gadd_bóc⁄
 = 
©h6kl_add_bóc⁄
,

6109 .
	g£t_bóc⁄
 = 
©h6kl_£t_bóc⁄
,

6110 .
	gdñ_bóc⁄
 = 
©h6kl_dñ_bóc⁄
,

6112 .
	gdñ_°©i⁄
 = 
©h6kl_dñ_°©i⁄
,

6113 .
	gch™ge_°©i⁄
 = 
©h6kl_ch™ge_°©i⁄
,

6114 .
	gªmaö_⁄_ch™√l
 = 
©h6kl_ªmaö_⁄_ch™√l
,

6115 .
	gˇn˚l_ªmaö_⁄_ch™√l
 = 
©h6kl_ˇn˚l_ªmaö_⁄_ch™√l
,

6116 .
	gmgmt_tx
 = 
©h6kl_mgmt_tx
,

6117 .
	gmgmt_‰ame_ªgi°î
 = 
©h6kl_mgmt_‰ame_ªgi°î
,

6118 #ifde‡
NL80211_CMD_BTCOEX_QCA


6119 .
	gnŸify_btc€x
 = 
©h6kl_nŸify_btc€x
,

6123 
	$©h6kl_cfg80211_°›
(
©h6kl_vif
 *
vif
)

6125 
vif
->
ßved_pwr_mode
 = vif->
œ°_pwr_mode
;

6128 i‡(
	`©h6kl_wmi_powîmode_cmd
(
vif
->
¨
->
wmi
,

6129 
vif
->
fw_vif_idx
, 
REC_POWER
) != 0) {

6130 
	`©h6kl_îr
("wmiÖowermode command failed during suspend\n");

6133 
vif
->
sme_°©e
) {

6134 
SME_CONNECTING
:

6135 
	`©h6kl_cfg80211_c⁄√˘_ªsu…
(
vif
, vif->
bssid
, 
NULL
, 0,

6136 
NULL
, 0,

6137 
WLAN_STATUS_UNSPECIFIED_FAILURE
,

6138 
GFP_KERNEL
);

6140 
SME_CONNECTED
:

6147 
	`©h6kl_cfg80211_disc⁄√˘ed
(
vif
, 0, 
NULL
, 0, 
GFP_KERNEL
);

6151 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) ||

6152 
	`ã°_bô
(
CONNECT_PEND
, &
vif
->
Êags
))

6153 
	`©h6kl_wmi_disc⁄√˘_cmd
(
vif
->
¨
->
wmi
, vif->
fw_vif_idx
);

6155 
vif
->
sme_°©e
 = 
SME_DISCONNECTED
;

6156 
	`˛ór_bô
(
CONNECTED
, &
vif
->
Êags
);

6157 
	`˛ór_bô
(
CONNECT_PEND
, &
vif
->
Êags
);

6158 
	`˛ór_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
);

6159 
	`˛ór_bô
(
PS_STICK
, &
vif
->
Êags
);

6160 
	`dñ_timî
(&
vif
->
sh¥Ÿe˘_timî
);

6163 i‡(
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
vif
->
¨
->
wmi
, vif->
fw_vif_idx
,

6165 
	`¥ötk
(
KERN_WARNING
 "ath6kl: failedÅo disable scan "

6168 i‡(
	`ã°_bô
(
SCANNING
, &
vif
->
Êags
))

6169 
	`©h6kl_cfg80211_sˇn_com∂ëe_evít
(
vif
, 
åue
);

6172 
	}
}

6174 
	$©h6kl_cfg80211_°›_Æl
(
©h6kl
 *
¨
)

6176 
©h6kl_vif
 *
vif
, *
tmp_vif
;

6177 #ifde‡
CE_SUPPORT


6178 
	`li°_f‹_óch_íåy_ß„
(
vif
, 
tmp_vif
, &
¨
->
vif_li°
, 
li°
) {

6179 i‡(
¨
->
°©e
 =
ATH6KL_STATE_DEEPSLEEP
) {

6180 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
)

6181 
	`©h6kl_cfg80211_°›
(
vif
);

6185 
	`li°_f‹_óch_íåy_ß„
(
vif
, 
tmp_vif
, &
¨
->
vif_li°
, 
li°
)

6186 
	`©h6kl_cfg80211_°›
(
vif
);

6188 
	}
}

6190 
	$©h6kl_ch™ge_cfg80211_›s
(
cfg80211_›s
 *cfg80211_ops)

6193 i‡(
debug_quúks
 & 
ATH6KL_MODULE_KEEPALIVE_BY_SUPP
) {

6194 
	`WARN_ON
(
cfg80211_›s
->
¥obe_˛õ¡
);

6196 
cfg80211_›s
->
¥obe_˛õ¡
 = 
©h6kl_≠_¥obe_˛õ¡
;

6198 
	`©h6kl_öfo
("Offload AP Keep-aliveÅo supplicant/hostapd\n");

6202 i‡(
debug_quúks
 & 
ATH6KL_MODULE_ENABLE_SCHE_SCAN
) {

6203 
cfg80211_›s
->
sched_sˇn_°¨t
 = 
©h6kl_sched_sˇn_°¨t
;

6204 
cfg80211_›s
->
sched_sˇn_°›
 = 
©h6kl_sched_sˇn_°›
;

6207 #ifde‡
NL80211_CMD_SET_AP_MAC_ACL


6208 i‡(
debug_quúks
 & 
ATH6KL_MODULE_AP_ACL_BY_NL80211
) {

6209 
cfg80211_›s
->
£t_mac_a˛
 = 
©h6kl_cfg80211_≠_a˛
;

6211 
	`©h6kl_öfo
("Configurate AP-ACL from NL80211.\n");

6216 
	}
}

6218 
	$©h6kl_ª£t_cfg80211_›s
(
cfg80211_›s
 *cfg80211_ops)

6220 
cfg80211_›s
->
¥obe_˛õ¡
 = 
NULL
;

6222 
cfg80211_›s
->
sched_sˇn_°¨t
 = 
NULL
;

6223 
cfg80211_›s
->
sched_sˇn_°›
 = 
NULL
;

6226 
	}
}

6228 
	$_judge_p2p_‰amew‹k
(
©h6kl
 *
¨
, 
p2p_c⁄fig
)

6230 
¨
->
p2p
 = !!
p2p_c⁄fig
;

6232 
¨
->
p2p_c⁄cuºít
 =

6233 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_CONCURRENT_ENABLE_DEDICATE
) ||

6234 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_CONCURRENT_NO_DEDICATE
) ||

6235 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_CONCURRENT_MULTICHAN
) ||

6236 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_CONCURRENT_COMPAT
);

6238 
¨
->
p2p_dediˇã
 =

6239 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_CONCURRENT_ENABLE_DEDICATE
) ||

6240 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_CONCURRENT_COMPAT
);

6242 
¨
->
p2p_mu…ich™_c⁄cuºít
 =

6243 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_CONCURRENT_MULTICHAN
);

6245 
¨
->
p2p_com∑t
 =

6246 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_CONCURRENT_COMPAT
);

6248 
¨
->
p2p_c⁄cuºít_≠
 =

6249 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_CONCURRENT_AP
);

6251 
¨
->
p2p_ö_∑sv_ch™
 =

6252 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_P2P_IN_PASSIVE_CHAN
);

6254 
¨
->
p2p_wi£_sˇn
 =

6255 !!(
p2p_c⁄fig
 & 
ATH6KL_MODULEP2P_P2P_WISE_SCAN
);

6257 
	`WARN_ON
((!
¨
->
p2p_c⁄cuºít
Ë&& (¨->
p2p_mu…ich™_c⁄cuºít
));

6258 
	`WARN_ON
((
¨
->
p2p_c⁄cuºít_≠
) &&

6259 ((!
¨
->
p2p_c⁄cuºít
Ë|| (!¨->
p2p_dediˇã
)));

6260 
	`WARN_ON
((!
¨
->
p2p
Ë&& (¨->
p2p_wi£_sˇn
));

6262 i‡(
¨
->
p2p_c⁄cuºít
) {

6263 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_P2P_MAX_FW_VIF
))

6264 
¨
->
vif_max
 = 
TARGET_VIF_MAX
;

6266 i‡(
¨
->
p2p_dediˇã
)

6267 
¨
->
vif_max
 = 3;

6269 
¨
->
vif_max
 = 2;

6273 
¨
->
vif_max
 = 1;

6281 
	`WARN_ON
((
¨
->
p2p_c⁄cuºít_≠
Ë&& (¨->
vif_max
 >
TARGET_VIF_MAX
));

6282 
	`WARN_ON
((
¨
->
p2p_c⁄cuºít_≠
Ë&& (¨->
p2p_mu…ich™_c⁄cuºít
));

6284 
¨
->
max_n‹m_iÁ˚
 = 1;

6285 i‡(
¨
->
p2p_c⁄cuºít_≠
)

6286 
¨
->
max_n‹m_iÁ˚
++;

6288 
¨
->
p2p_‰ame_ªåy
 = 
Ál£
;

6290 i‡(
¨
->
p2p_com∑t
)

6291 
¨
->
p2p_‰ame_nŸ_ªp‹t
 = 
åue
;

6293 
¨
->
p2p_‰ame_nŸ_ªp‹t
 = 
Ál£
;

6295 
¨
->
p2p_w¨_bad_öãl_go
 = 
åue
;

6296 
¨
->
p2p_w¨_bad_brﬂdcom_go
 = 
åue
;

6297 
¨
->
p2p_w¨_p2p_˛õ¡_awake
 = 
åue
;

6299 
¨
->
p2p_õ_nŸ_≠≥nd
 = 
P2P_IE_IN_PROBE_REQ
;

6301 
	`©h6kl_öfo
("%dVAP/%d, P2P %s, concurrent %s %s,"

6304 
¨
->
vif_max
,

6305 
¨
->
max_n‹m_iÁ˚
,

6306 (
¨
->
p2p
 ? "enable" : "disable"),

6307 (
¨
->
p2p_c⁄cuºít
 ? "on" : "off"),

6308 (
¨
->
p2p_c⁄cuºít_≠
 ? "with softAP" : ""),

6309 (
¨
->
p2p_dediˇã
 ? "with" : "without"),

6310 (
¨
->
p2p_mu…ich™_c⁄cuºít
 ? "enable" : "disable"),

6311 (
¨
->
p2p_com∑t
 ? "enable (ignoreÖ2p_dedicate)" : "disable"),

6312 (
¨
->
p2p_õ_nŸ_≠≥nd
 ? ", sta-p2p-ieÑemoved" : ""),

6313 (
¨
->
p2p_ö_∑sv_ch™
 ? ",Ö2p_in_pasv_chanÉnable" : ""),

6314 (
¨
->
p2p_wi£_sˇn
 ? ",Ö2p_wise_scanÉnable" : ""));

6317 
	}
}

6319 
	$_judge_v≠_‰amew‹k
(
©h6kl
 *
¨
, 
v≠_c⁄fig
)

6321 
i
;

6322 
≠_num
 = 0, 
°a_num
 = 0;

6331 
i
 = 0; i < 
ATH6KL_VIF_MAX
; i++) {

6332 
¨
->
√xt_mode
[
i
] = (
v≠_c⁄fig
 >>

6333 (
i
 * 
ATH6KL_VAPMODE_OFFSET
)) &

6334 
ATH6KL_VAPMODE_MASK
;

6336 i‡(
¨
->
√xt_mode
[
i
] =
ATH6KL_VAPMODE_DISABLED
)

6339 i‡(
¨
->
√xt_mode
[
i
] =
ATH6KL_VAPMODE_STA
)

6340 
°a_num
++;

6341 i‡(
¨
->
√xt_mode
[
i
] =
ATH6KL_VAPMODE_AP
)

6342 
≠_num
++;

6346 
	`WARN_ON
((
°a_num
 > 1) ||

6347 (
≠_num
 > 2) ||

6348 (
°a_num
 + 
≠_num
 > 2));

6350 
¨
->
vif_max
 = 
i
;

6351 
¨
->
max_n‹m_iÁ˚
 = 
i
;

6353 
	`©h6kl_öfo
("%dVAP/%d, NO P2P, vapmode %d, %d, %d, %d\n",

6354 
¨
->
vif_max
,

6355 
¨
->
max_n‹m_iÁ˚
,

6356 
¨
->
√xt_mode
[0],ár->next_mode[1],

6357 
¨
->
√xt_mode
[2],ár->next_mode[3]);

6359 
	}
}

6361 
©h6kl
 *
	$©h6kl_c‹e_Æloc
(
devi˚
 *
dev
)

6363 
©h6kl
 *
¨
;

6364 
wùhy
 *wiphy;

6370 
	`©h6kl_ch™ge_cfg80211_›s
(&
©h6kl_cfg80211_›s
);

6373 
wùhy
 = 
	`wùhy_√w
(&
©h6kl_cfg80211_›s
, (
©h6kl
));

6375 i‡(!
wùhy
) {

6376 
	`©h6kl_îr
("couldn'tállocate wiphy device\n");

6377  
NULL
;

6380 
¨
 = 
	`wùhy_¥iv
(
wùhy
);

6381 
¨
->
mod_debug_quúks
 = 
debug_quúks
;

6383 
¨
->
wùhy
 = wiphy;

6384 
¨
->
dev
 = dev;

6386 
	`BUG_ON
((
©h6kl_p2p
 && 
©h6kl_v≠
));

6394 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_TESTMODE_ENABLE
))

6395 
ã°mode
 = 1;

6397 i‡(
ã°mode
 ||

6398 
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_ENABLE_EPPING
)) {

6399 
©h6kl_p2p
 = 0;

6400 
©h6kl_v≠
 = 0;

6401 
©h6kl_rﬂm_mode
 = 
ATH6KL_MODULEROAM_DISABLE
;

6404 i‡(
©h6kl_p2p
)

6405 
	`_judge_p2p_‰amew‹k
(
¨
, 
©h6kl_p2p
);

6406 i‡(
©h6kl_v≠
)

6407 
	`_judge_v≠_‰amew‹k
(
¨
, 
©h6kl_v≠
);

6409 
¨
->
vif_max
 = 1;

6410 
¨
->
max_n‹m_iÁ˚
 = 1;

6413 
	`•ö_lock_öô
(&
¨
->
lock
);

6414 
	`•ö_lock_öô
(&
¨
->
li°_lock
);

6415 
	`•ö_lock_öô
(&
¨
->
°©e_lock
);

6417 
	`öô_waôqueue_hód
(&
¨
->
evít_wq
);

6418 
	`£ma_öô
(&
¨
->
£m
, 1);

6419 
	`£ma_öô
(&
¨
->
wmi_evt_£m
, 1);

6421 
	`INIT_LIST_HEAD
(&
¨
->
amsdu_rx_buf„r_queue
);

6422 
	`INIT_LIST_HEAD
(&
¨
->
vif_li°
);

6424 
	`£tup_timî
(&
¨
->
ópﬁ_sh¥Ÿe˘_timî
,

6425 
©h6kl_ópﬁ_sh¥Ÿe˘_timî_h™dÀr
,

6426 (Ë
¨
);

6428 
	`˛ór_bô
(
WMI_ENABLED
, &
¨
->
Êag
);

6429 
	`˛ór_bô
(
SKIP_SCAN
, &
¨
->
Êag
);

6430 
	`˛ór_bô
(
DESTROY_IN_PROGRESS
, &
¨
->
Êag
);

6431 
	`˛ór_bô
(
EAPOL_HANDSHAKE_PROTECT
, &
¨
->
Êag
);

6433 
¨
->
li°í_ötvl_t
 = 
A_DEFAULT_LISTEN_INTERVAL
;

6434 
¨
->
li°í_ötvl_b
 = 0;

6435 
¨
->
tx_pwr
 = 0;

6437 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_sˇn_≥riod
 = 
WMI_ROAM_LRSSI_SCAN_PERIOD
;

6438 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_sˇn_thªshﬁd
 = \

6439 
WMI_ROAM_LRSSI_SCAN_THRESHOLD
;

6440 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_rﬂm_thªshﬁd
 = \

6441 
WMI_ROAM_LRSSI_ROAM_THRESHOLD
;

6442 
¨
->
low_rssi_rﬂm_∑øms
.
rﬂm_rssi_Êo‹
 = 
WMI_ROAM_LRSSI_ROAM_FLOOR
;

6444 
¨
->
°©e
 = 
ATH6KL_STATE_OFF
;

6446 i‡((
¨
->
p2p_c⁄cuºít
) &&

6447 (
¨
->
p2p_dediˇã
))

6448 
¨
->
sche_sˇn
 = 
	`©h6kl_mod_debug_quúks
(ar,

6449 
ATH6KL_MODULE_ENABLE_SCHE_SCAN
);

6451 #ifde‡
CONFIG_ANDROID


6452 i‡(
	`machöe_is_≠q8064_dma
(Ë|| 
	`machöe_is_≠q8064_buñÀr
())

6453 
©h6kl_rﬂm_mode
 = 
ATH6KL_MODULEROAM_DISABLE
;

6456 
¨
->
rﬂm_mode
 = 
©h6kl_rﬂm_mode
;

6458 i‡(
¨
->
sche_sˇn
 &&

6459 
¨
->
rﬂm_mode
 !
ATH6KL_MODULEROAM_DISABLE
) {

6460 
	`©h6kl_îr
("Roam shall beÉxclusive with schedule scan. Disabled\n");

6461 
¨
->
rﬂm_mode
 = 
ATH6KL_MODULEROAM_DISABLE
;

6464  
¨
;

6465 
	}
}

6467 
	$©h6kl_ªgi°î_õì80211_hw
(
©h6kl
 *
¨
)

6469 
wùhy
 *wùhy = 
¨
->wiphy;

6470 
ªt
;

6472 
wùhy
->
mgmt_°y≥s
 = 
©h6kl_mgmt_°y≥s
;

6474 
wùhy
->
max_ªmaö_⁄_ch™√l_duøti⁄
 = 
ATH6KL_ROC_MAX_PERIOD
 * 1000;

6477 
	`£t_wùhy_dev
(
wùhy
, 
¨
->
dev
);

6479 
wùhy
->
öãrÁ˚_modes
 = 
	`BIT
(
NL80211_IFTYPE_STATION
) |

6480 
	`BIT
(
NL80211_IFTYPE_ADHOC
) |

6481 
	`BIT
(
NL80211_IFTYPE_AP
);

6482 i‡(
¨
->
p2p
) {

6483 i‡(!
	`IS_STA_AP_ONLY
(
¨
))

6484 
wùhy
->
öãrÁ˚_modes
 |=

6485 
	`BIT
(
NL80211_IFTYPE_P2P_GO
) |

6486 
	`BIT
(
NL80211_IFTYPE_P2P_CLIENT
);

6489 i‡(
¨
->
p2p_c⁄cuºít
) {

6490 
õì80211_iÁ˚_combö©i⁄


6491 *
õì80211_iÁ˚_combö©i⁄
 = 
NULL
;

6493 
¨
->
vif_max
) {

6495 
õì80211_iÁ˚_combö©i⁄
 =

6496 
©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít4
;

6497 
wùhy
->
n_iÁ˚_combö©i⁄s
 = 
	`ARRAY_SIZE
(

6498 
©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít4
);

6501 
õì80211_iÁ˚_combö©i⁄
 =

6502 
©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít3
;

6503 
wùhy
->
n_iÁ˚_combö©i⁄s
 = 
	`ARRAY_SIZE
(

6504 
©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít3
);

6507 
õì80211_iÁ˚_combö©i⁄
 =

6508 
©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít2
;

6509 
wùhy
->
n_iÁ˚_combö©i⁄s
 = 
	`ARRAY_SIZE
(

6510 
©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít2
);

6513 
	`WARN_ON
(1);

6517 i‡(
¨
->
p2p_c⁄cuºít_≠
) {

6518 i‡(
	`IS_STA_AP_ONLY
(
¨
)) {

6519 
õì80211_iÁ˚_combö©i⁄
 =

6520 
©h6kl_iÁ˚_combö©i⁄s_°a_≠
;

6521 
wùhy
->
n_iÁ˚_combö©i⁄s
 = 
	`ARRAY_SIZE
(

6522 
©h6kl_iÁ˚_combö©i⁄s_°a_≠
);

6524 
õì80211_iÁ˚_combö©i⁄
 =

6525 
©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít4_1
;

6526 
wùhy
->
n_iÁ˚_combö©i⁄s
 = 
	`ARRAY_SIZE
(

6527 
©h6kl_iÁ˚_combö©i⁄s_p2p_c⁄cuºít4_1
);

6532 i‡(
¨
->
p2p_mu…ich™_c⁄cuºít
 &&

6533 
õì80211_iÁ˚_combö©i⁄
 !
NULL
) {

6534 
õì80211_iÁ˚_combö©i⁄
[0].
num_dif„ª¡_ch™√ls
 =

6535 
õì80211_iÁ˚_combö©i⁄
[0].
max_öãrÁ˚s
;

6538 
wùhy
->
iÁ˚_combö©i⁄s
 = 
õì80211_iÁ˚_combö©i⁄
;

6540 i‡(
¨
->
p2p_com∑t
) {

6541 
wùhy
->
n_iÁ˚_combö©i⁄s
 = 0;

6542 
wùhy
->
iÁ˚_combö©i⁄s
 = 
NULL
;

6547 i‡(!(
¨
->
èrgë_subty≥
 & 
TARGET_SUBTYPE_2SS
)) {

6548 
©h6kl_b™d_2ghz
.
ht_ˇp
.
mcs
.
rx_mask
[1] = 0;

6549 
©h6kl_b™d_5ghz
.
ht_ˇp
.
mcs
.
rx_mask
[1] = 0;

6551 
©h6kl_b™d_2ghz
.
ht_ˇp
.
ˇp
 &~
IEEE80211_HT_CAP_TX_STBC
;

6552 
©h6kl_b™d_5ghz
.
ht_ˇp
.
ˇp
 &~
IEEE80211_HT_CAP_TX_STBC
;

6556 i‡(!(
¨
->
èrgë_subty≥
 & 
TARGET_SUBTYPE_HT40
)) {

6557 
©h6kl_b™d_2ghz
.
ht_ˇp
.
ˇp
 &=

6558 ~
IEEE80211_HT_CAP_SUP_WIDTH_20_40
;

6559 
©h6kl_b™d_2ghz
.
ht_ˇp
.
ˇp
 &~
IEEE80211_HT_CAP_SGI_40
;

6560 
©h6kl_b™d_2ghz
.
ht_ˇp
.
ˇp
 &~
IEEE80211_HT_CAP_DSSSCCK40
;

6564 
wùhy
->
max_sˇn_ssids
 = 
MAX_PROBED_SSID_INDEX
;

6565 
wùhy
->
max_sˇn_õ_Àn
 = 
MAX_APP_IE_LEN
;

6566 i‡(
¨
->
sche_sˇn
) {

6567 
wùhy
->
Êags
 |
WIPHY_FLAG_SUPPORTS_SCHED_SCAN
;

6568 
wùhy
->
max_sched_sˇn_ssids
 = 
MAX_PROBED_SSID_INDEX
;

6569 
wùhy
->
max_sched_sˇn_õ_Àn
 = 
MAX_APP_IE_LEN
;

6572 
wùhy
->
b™ds
[
IEEE80211_BAND_2GHZ
] = &
©h6kl_b™d_2ghz
;

6573 i‡((!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_5G
)) &&

6574 (
¨
->
èrgë_subty≥
 & 
TARGET_SUBTYPE_DUAL
))

6575 
wùhy
->
b™ds
[
IEEE80211_BAND_5GHZ
] = &
©h6kl_b™d_5ghz
;

6577 
	`©h6kl_öfo
("Disable 5G support by %s!\n",

6578 (
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_5G
) ?

6581 
wùhy
->
sig«l_ty≥
 = 
CFG80211_SIGNAL_TYPE_MBM
;

6583 
wùhy
->
cùhî_suôes
 = cipher_suites;

6584 
wùhy
->
n_cùhî_suôes
 = 
	`ARRAY_SIZE
(
cùhî_suôes
);

6586 
wùhy
->
Êags
 |
WIPHY_FLAG_AP_UAPSD
;

6587 #ifde‡
CFG80211_WIPHY_FLAG_HAS_REMAIN_ON_CHANNEL


6588 i‡((
©h6kl_cfg80211_›s
.
ªmaö_⁄_ch™√l
) &&

6589 (
©h6kl_cfg80211_›s
.
ˇn˚l_ªmaö_⁄_ch™√l
))

6590 
wùhy
->
Êags
 |
WIPHY_FLAG_HAS_REMAIN_ON_CHANNEL
;

6593 i‡(
¨
->
rﬂm_mode
 !
ATH6KL_MODULEROAM_DISABLE
)

6594 
wùhy
->
Êags
 |
WIPHY_FLAG_SUPPORTS_FW_ROAM
;

6596 #ifde‡
NL80211_ATTR_AP_INACTIVITY_TIMEOUT


6597 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_KEEPALIVE_CONFIG_BY_SUPP
))

6598 
wùhy
->
„©uªs
 |
NL80211_FEATURE_INACTIVITY_TIMER
;

6601 #ifde‡
NL80211_WIPHY_FEATURE_SCAN_FLUSH


6607 
wùhy
->
„©uªs
 &~
NL80211_FEATURE_SCAN_FLUSH
;

6610 #ifde‡
CFG80211_TX_POWER_PER_WDEV


6611 
wùhy
->
„©uªs
 |
NL80211_FEATURE_VIF_TXPOWER
;

6615 
wùhy
->
wowœn
.
Êags
 = 
WIPHY_WOWLAN_ANY
 |

6616 
WIPHY_WOWLAN_MAGIC_PKT
 |

6617 
WIPHY_WOWLAN_DISCONNECT
 |

6618 
WIPHY_WOWLAN_SUPPORTS_GTK_REKEY
 |

6619 
WIPHY_WOWLAN_GTK_REKEY_FAILURE
 |

6620 
WIPHY_WOWLAN_EAP_IDENTITY_REQ
 |

6621 
WIPHY_WOWLAN_4WAY_HANDSHAKE
 |

6622 
WIPHY_WOWLAN_RFKILL_RELEASE
;

6624 
wùhy
->
wowœn
.
n_∑âîns
 =

6625 (
WOW_MAX_FILTER_LISTS
*
WOW_MAX_FILTERS_PER_LIST
);

6626 
wùhy
->
wowœn
.
∑âîn_mö_Àn
 = 
WOW_MIN_PATTERN_SIZE
;

6627 
wùhy
->
wowœn
.
∑âîn_max_Àn
 = 
WOW_MAX_PATTERN_SIZE
;

6628 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "wowáttr: flags: %x,Ç_patterns: %d, ",

6629 
wùhy
->
wowœn
.
Êags
,

6630 
wùhy
->
wowœn
.
n_∑âîns
);

6631 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "min_len: %d, max_len: %d\n",

6632 
wùhy
->
wowœn
.
∑âîn_mö_Àn
,

6633 
wùhy
->
wowœn
.
∑âîn_max_Àn
);

6635 #ifde‡
CONFIG_ANDROID


6636 #ifde‡
CONFIG_HAS_WAKELOCK


6637 
	`wake_lock_öô
(&
¨
->
wake_lock
, 
WAKE_LOCK_SUSPEND
, "ath6kl_suspend_wl");

6640 i‡(
¨
->
wow_úq
) {

6641 
ªt
;

6642 
ªt
 = 
	`ªque°_úq
(
¨
->
wow_úq
, 
©h6kl_wow_úq
,

6643 
IRQF_SHARED
 | 
IRQF_TRIGGER_RISING
,

6644 "¨6000" "sdiowakeup", 
¨
);

6645 i‡(!
ªt
) {

6646 
ªt
 = 
	`íabÀ_úq_wake
(
¨
->
wow_úq
);

6647 i‡(
ªt
 < 0) {

6648 
	`©h6kl_îr
("Couldn'tÉnable WoW IRQás wakeup interrupt");

6649  
ªt
;

6651 
	`¥ötk
("©h6kl: WoW IRQ %d\n", 
¨
->
wow_úq
);

6655 
	`©h6kl_£tup_™droid_ªsour˚
(
¨
);

6658 i‡(
	`ã°_bô
(
INTERNAL_REGDB
, &
¨
->
Êag
) ||

6659 
	`ã°_bô
(
CFG80211_REGDB
, &
¨
->
Êag
)) {

6660 #ifde‡
CFG80211_VOID_REG_NOTIFIER


6661 
wùhy
->
ªg_nŸifõr
 = 
©h6kl_ªg_nŸifõr2
;

6663 
wùhy
->
ªg_nŸifõr
 = 
©h6kl_ªg_nŸifõr
;

6665 
wùhy
->
Êags
 |
WIPHY_FLAG_CUSTOM_REGULATORY
;

6666 
wùhy
->
Êags
 |
WIPHY_FLAG_STRICT_REGULATORY
;

6667 
wùhy
->
Êags
 |
WIPHY_FLAG_DISABLE_BEACON_HINTS
;

6670 #ifde‡
NL80211_CMD_SET_AP_MAC_ACL


6671 i‡(
debug_quúks
 & 
ATH6KL_MODULE_AP_ACL_BY_NL80211
)

6672 
wùhy
->
max_a˛_mac_addrs
 = 
ATH6KL_AP_ACL_MAX_NUM
;

6675 
ªt
 = 
	`wùhy_ªgi°î
(
wùhy
);

6676 i‡(
ªt
 < 0) {

6677 
	`©h6kl_îr
("couldn'tÑegister wiphy device\n");

6678  
ªt
;

6682 
	}
}

6684 
	$©h6kl_öô_if_d©a
(
©h6kl_vif
 *
vif
)

6686 
i
;

6687 
©h6kl
 *
¨
 = 
vif
->ar;

6689 
vif
->
aggr_˙txt
 = 
	`aggr_öô
(vif);

6690 i‡(!
vif
->
aggr_˙txt
) {

6691 
	`©h6kl_îr
("failedÅo initializeággr\n");

6692  -
ENOMEM
;

6695 
i
 = 0; i < 
AP_MAX_NUM_STA
; i++) {

6696 
vif
->
°a_li°
[
i
].
aggr_c⁄n_˙txt
 = 
	`aggr_öô_c⁄n
(vif);

6697 i‡(!
vif
->
°a_li°
[
i
].
aggr_c⁄n_˙txt
) {

6698 
	`©h6kl_îr
("failedÅo initializeággr_node\n");

6699  -
ENOMEM
;

6702 #ifde‡
ACS_SUPPORT


6703 
vif
->
acs_˘x
 = 
	`©h6kl_acs_öô
(vif);

6704 i‡(!
vif
->
acs_˘x
) {

6705 
	`©h6kl_îr
("failedÅo initializeács");

6706  -
ENOMEM
;

6709 
vif
->
htc€x_˘x
 = 
	`©h6kl_htc€x_öô
(vif);

6710 i‡(!
vif
->
htc€x_˘x
) {

6711 
	`©h6kl_îr
("failedÅo initialize htcoex\n");

6712  -
ENOMEM
;

6715 #ifde‡
CONFIG_ANDROID


6717 i‡((
vif
->
fw_vif_idx
 == 0) &&

6718 (
vif
->
¨
->
èrgë_subty≥
 & 
TARGET_SUBTYPE_HT40
))

6719 
	`©h6kl_htc€x_c⁄fig
(
vif
, 
ATH6KL_HTCOEX_SCAN_PERIOD
, 0);

6722 
vif
->
bss_po°_¥oc_˘x
 = 
	`©h6kl_bss_po°_¥oc_öô
(vif);

6723 i‡(!
vif
->
bss_po°_¥oc_˘x
) {

6724 
	`©h6kl_îr
("failedÅo initialize bss_post_proc\n");

6725  -
ENOMEM
;

6729 
vif
->
p2p_ps_öfo_˘x
 = 
	`©h6kl_p2p_ps_öô
(vif);

6730 i‡(!
vif
->
p2p_ps_öfo_˘x
) {

6731 
	`©h6kl_îr
("failedÅo initializeÖ2p_ps\n");

6732  -
ENOMEM
;

6735 i‡(!
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

6736 i‡(
	`©h6kl_mod_debug_quúks
(
vif
->
¨
,

6737 
ATH6KL_MODULE_KEEPALIVE_BY_SUPP
)) {

6738 
vif
->
≠_kì∑live_˘x
 =

6739 
	`©h6kl_≠_kì∑live_öô
(
vif
,

6740 
AP_KA_MODE_BYSUPP
);

6741 } i‡(
	`©h6kl_mod_debug_quúks
(
vif
->
¨
,

6742 
ATH6KL_MODULE_KEEPALIVE_CONFIG_BY_SUPP
)) {

6743 
vif
->
≠_kì∑live_˘x
 =

6744 
	`©h6kl_≠_kì∑live_öô
(
vif
,

6745 
AP_KA_MODE_CONFIG_BYSUPP
);

6747 
vif
->
≠_kì∑live_˘x
 =

6748 
	`©h6kl_≠_kì∑live_öô
(
vif
,

6749 
AP_KA_MODE_ENABLE
);

6752 i‡(!
vif
->
≠_kì∑live_˘x
) {

6753 
	`©h6kl_îr
("failedÅo initializeáp_keepalive\n");

6754  -
ENOMEM
;

6758 
vif
->
≠_a˛_˘x
 = 
	`©h6kl_≠_a˛_öô
(vif);

6759 i‡(!
vif
->
≠_a˛_˘x
) {

6760 
	`©h6kl_îr
("failedÅo initializeáp_acl\n");

6761  -
ENOMEM
;

6764 #ifde‡
CONFIG_WLAN_QRF


6765 
vif
->
≠_admc_˘x
 = 
	`©h6kl_≠_admc_öô
(vif, 
AP_ADMC_MODE_DISABLE
);

6767 
vif
->
≠_admc_˘x
 = 
	`©h6kl_≠_admc_öô
(vif, 
AP_ADMC_MODE_ACCEPT_ALWAYS
);

6770 i‡(!
vif
->
≠_admc_˘x
) {

6771 
	`©h6kl_îr
("failedÅo initializeáp_admc\n");

6772  -
ENOMEM
;

6775 
	`©h6kl_≠_rc_öô
(
vif
);

6777 
	`£tup_timî
(&
vif
->
disc⁄√˘_timî
, 
disc⁄√˘_timî_h™dÀr
,

6778 (Ë
vif
->
ndev
);

6779 
	`£t_bô
(
WMM_ENABLED
, &
vif
->
Êags
);

6780 
	`•ö_lock_öô
(&
vif
->
if_lock
);

6782 
	`£tup_timî
(&
vif
->
vifsˇn_timî
, 
©h6kl_sˇn_timî_h™dÀr
,

6783 (Ë
vif
);

6785 
	`£tup_timî
(&
vif
->
sh¥Ÿe˘_timî
, 
©h6kl_sh¥Ÿe˘_timî_h™dÀr
,

6786 (Ë
vif
);

6787 
	`•ö_lock_öô
(&
vif
->
≥nd_skb_lock
);

6789 
vif
->
sˇn_ªq
 = 
NULL
;

6790 
vif
->
≥nd_skb
 = 
NULL
;

6792 
vif
->
sˇnb™d_ch™
 = 0;

6793 i‡(
¨
->
p2p_wi£_sˇn
 &&

6794 (
vif
->
fw_vif_idx
 != 0)) {

6796 
vif
->
sˇnb™d_ty≥
 = 
SCANBAND_TYPE_2_P2PCHAN
;

6798 
vif
->
sˇnb™d_ty≥
 = 
SCANBAND_TYPE_ALL
;

6800 
vif
->
ßved_pwr_mode
 =

6801 
vif
->
œ°_pwr_mode
 = 
REC_POWER
;

6804 
	}
}

6806 
	$©h6kl_deöô_if_d©a
(
©h6kl_vif
 *
vif
)

6808 
©h6kl
 *
¨
 = 
vif
->ar;

6809 
˘r
;

6811 #ifde‡
ATH6KL_DIAGNOSTIC


6812 
	`wifi_düg_timî_de°roy
(
vif
);

6815 
˘r
 = 0; cå < 
AP_MAX_NUM_STA
 ; ctr++) {

6816 i‡(
vif
->
°a_li°
[
˘r
].
psq_age_a˘ive
) {

6817 
	`dñ_timî_sync
(&
vif
->
°a_li°
[
˘r
].
psq_age_timî
);

6818 
vif
->
°a_li°
[
˘r
].
psq_age_a˘ive
 = 0;

6820 i‡(!
	`©h6kl_ps_queue_em±y
(&
vif
->
°a_li°
[
˘r
].
psq_d©a
))

6821 
	`©h6kl_ps_queue_purge
(&
vif
->
°a_li°
[
˘r
].
psq_d©a
);

6823 i‡(!
	`©h6kl_ps_queue_em±y
(&
vif
->
°a_li°
[
˘r
].
psq_mgmt
))

6824 
	`©h6kl_ps_queue_purge
(&
vif
->
°a_li°
[
˘r
].
psq_mgmt
);

6826 
	`aggr_moduÀ_de°roy_c⁄n
(
vif
->
°a_li°
[
˘r
].
aggr_c⁄n_˙txt
);

6829 
	`√tif_ˇºõr_off
(
vif
->
ndev
);

6830 
	`√tif_°›_queue
(
vif
->
ndev
);

6831 
	`©h6kl_tx_d©a_˛ónup_by_if
(
vif
);

6833 
	`aggr_moduÀ_de°roy
(
vif
->
aggr_˙txt
);

6835 #ifde‡
ACS_SUPPORT


6836 
	`©h6kl_acs_deöô
(
vif
);

6839 
	`©h6kl_htc€x_deöô
(
vif
);

6841 
	`©h6kl_bss_po°_¥oc_deöô
(
vif
);

6843 
	`©h6kl_p2p_ps_deöô
(
vif
);

6845 
	`©h6kl_≠_kì∑live_deöô
(
vif
);

6847 
	`©h6kl_≠_a˛_deöô
(
vif
);

6849 
	`©h6kl_≠_admc_deöô
(
vif
);

6851 
	`©h6kl_sched_sˇn_deöô
(
vif
);

6853 
¨
->
avaû_idx_m≠
 |
	`BIT
(
vif
->
fw_vif_idx
);

6855 i‡(
vif
->
nw_ty≥
 =
ADHOC_NETWORK
)

6856 
¨
->
ibss_if_a˘ive
 = 
Ál£
;

6858 
	`dñ_timî
(&
vif
->
vifsˇn_timî
);

6860 
	`uƒegi°î_√tdevi˚
(
vif
->
ndev
);

6862 
¨
->
num_vif
--;

6863 
	}
}

6865 
√t_devi˚
 *
	$©h6kl_öãrÁ˚_add
(
©h6kl
 *
¨
, *
«me
,

6866 
∆80211_i·y≥
 
ty≥
, 
u8
 
fw_vif_idx
,

6867 
u8
 
nw_ty≥
)

6869 
√t_devi˚
 *
ndev
;

6870 
©h6kl_vif
 *
vif
;

6871 
i
;

6872 #ifde‡
ATH6KL_HSIC_RECOVER


6873 
u8
 
zîo_mac
[
ETH_ALEN
] = { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

6876 
ndev
 = 
	`Æloc_√tdev
((*
vif
), 
«me
, 
ëhî_£tup
);

6877 i‡(!
ndev
)

6878  
NULL
;

6880 
vif
 = 
	`√tdev_¥iv
(
ndev
);

6881 
ndev
->
õì80211_±r
 = &
vif
->
wdev
;

6882 
vif
->
wdev
.
wùhy
 = 
¨
->wiphy;

6883 
vif
->
¨
 =ár;

6884 
vif
->
ndev
 =Çdev;

6885 
	`SET_NETDEV_DEV
(
ndev
, 
	`wùhy_dev
(
vif
->
wdev
.
wùhy
));

6886 
vif
->
wdev
.
√tdev
 = 
ndev
;

6887 
vif
->
wdev
.
i·y≥
 = 
ty≥
;

6888 
vif
->
fw_vif_idx
 = fw_vif_idx;

6889 
vif
->
nw_ty≥
 = vif->
√xt_mode
 =Çw_type;

6891 
	`mem˝y
(
ndev
->
dev_addr
, 
¨
->
mac_addr
, 
ETH_ALEN
);

6893 #ifde‡
ATH6KL_HSIC_RECOVER


6895 i‡(
	`memcmp
(
¨
->
mac_addr
, 
zîo_mac
, 
ETH_ALEN
) == 0 &&

6896 
ˇched_mac_vÆid
 =
åue
) {

6897 
	`mem˝y
(
ndev
->
dev_addr
, 
ˇched_mac
, 
ETH_ALEN
);

6901 i‡(
fw_vif_idx
 != 0)

6902 
ndev
->
dev_addr
[0] = (ndev->dev_addr[0] ^ (1 << 
fw_vif_idx
)) |

6905 
	`öô_√tdev
(
ndev
);

6907 
	`©h6kl_öô_c⁄åﬁ_öfo
(
vif
);

6911 i‡(!
	`©h6kl_mod_debug_quúks
(
vif
->
¨
, 
ATH6KL_MODULE_ENABLE_EPPING
)) {

6913 i‡(
	`©h6kl_öô_if_d©a
(
vif
))

6914 
îr
;

6917 i‡(
	`ªgi°î_√tdevi˚
(
ndev
))

6918 
îr
;

6920 
¨
->
avaû_idx_m≠
 &~
	`BIT
(
fw_vif_idx
);

6921 
vif
->
sme_°©e
 = 
SME_DISCONNECTED
;

6922 
	`£t_bô
(
WLAN_ENABLED
, &
vif
->
Êags
);

6923 
¨
->
wœn_pwr_°©e
 = 
WLAN_POWER_STATE_ON
;

6924 
	`£t_bô
(
NETDEV_REGISTERED
, &
vif
->
Êags
);

6926 i‡(
ty≥
 =
NL80211_IFTYPE_ADHOC
)

6927 
¨
->
ibss_if_a˘ive
 = 
åue
;

6929 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

6930 
	`li°_add_èû
(&
vif
->
li°
, &
¨
->
vif_li°
);

6931 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

6933 
	`©h6kl_p2p_utûs_öô_p‹t
(
vif
, 
ty≥
);

6935 
	`©h6kl_sched_sˇn_öô
(
vif
);

6937  
ndev
;

6939 
îr
:

6940 
i
 = 0; i < 
AP_MAX_NUM_STA
 ; i++)

6941 
	`aggr_moduÀ_de°roy_c⁄n
(
vif
->
°a_li°
[
i
].
aggr_c⁄n_˙txt
);

6942 
	`aggr_moduÀ_de°roy
(
vif
->
aggr_˙txt
);

6943 
	`©h6kl_htc€x_deöô
(
vif
);

6944 
	`©h6kl_bss_po°_¥oc_deöô
(
vif
);

6945 
	`©h6kl_p2p_ps_deöô
(
vif
);

6946 
	`©h6kl_≠_kì∑live_deöô
(
vif
);

6947 
	`©h6kl_≠_a˛_deöô
(
vif
);

6948 
	`©h6kl_≠_admc_deöô
(
vif
);

6949 
	`‰ì_√tdev
(
ndev
);

6950  
NULL
;

6951 
	}
}

6953 
	$©h6kl_deöô_õì80211_hw
(
©h6kl
 *
¨
)

6955 #ifde‡
CONFIG_ANDROID


6956 i‡(
¨
->
wow_úq
) {

6957 i‡(
	`dißbÀ_úq_wake
(
¨
->
wow_úq
))

6958 
	`©h6kl_îr
("Couldn't disable hostwake IRQ wakeup mode\n");

6960 
	`‰ì_úq
(
¨
->
wow_úq
,ár);

6961 
¨
->
wow_úq
 = 0;

6964 #ifde‡
CONFIG_HAS_WAKELOCK


6965 
	`wake_lock_de°roy
(&
¨
->
wake_lock
);

6968 
	`©h6kl_˛ónup_™droid_ªsour˚
(
¨
);

6970 
	`wùhy_uƒegi°î
(
¨
->
wùhy
);

6971 
	`wùhy_‰ì
(
¨
->
wùhy
);

6973 
	`©h6kl_ª£t_cfg80211_›s
(&
©h6kl_cfg80211_›s
);

6974 
	}
}

6976 
	$©h6kl_c‹e_öô_de„r
(
w‹k_°ru˘
 *
wk
)

6978 
	#MAX_RD_WAIT_CNT
 (20Ë

	)

6979 
©h6kl
 *
¨
;

6980 
vif_∑øms
 
∑øms
;

6981 
i
;

6983 
¨
 = 
	`c⁄èöî_of
(
wk
, 
©h6kl
,

6984 
öô_de„r_wk
);

6987 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
,

6988 
ATH6KL_MODULE_DISABLE_AUTO_ADD_INF
) &&

6989 (
¨
->
p2p_c⁄cuºít
) &&

6990 (
¨
->
p2p_dediˇã
)) {

6991 i‡(!
	`IS_STA_AP_ONLY
(
¨
)) {

6992 
	`©h6kl_öfo
("Create dedicatedÖ2p interface\n");

6994 
	`π∆_lock
();

6995 
∑øms
.
u£_4addr
 = 0;

6996 i‡(
	`©h6kl_cfg80211_add_iÁ˚
(
¨
->
wùhy
,

6997 
ATH6KL_DEVNAME_DEF_P2P
,

6998 
NL80211_IFTYPE_STATION
,

6999 
NULL
,

7000 &
∑øms
Ë=
NULL
) {

7001 
	`©h6kl_îr
("Create dedicatedÖ2p interface fail!\n");

7003 
	`π∆_u∆ock
();

7006 i‡(
¨
->
p2p_c⁄cuºít_≠
) {

7007 
	`©h6kl_öfo
("Create concurrentáp interface\n");

7009 
	`π∆_lock
();

7010 
∑øms
.
u£_4addr
 = 0;

7011 i‡(
	`©h6kl_cfg80211_add_iÁ˚
(
¨
->
wùhy
,

7012 
ATH6KL_DEVNAME_DEF_AP
,

7013 
NL80211_IFTYPE_AP
,

7014 
NULL
,

7015 &
∑øms
Ë=
NULL
) {

7016 
	`©h6kl_îr
("Create concurrentáp interface fail!\n");

7018 
	`π∆_u∆ock
();

7023 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
,

7024 
ATH6KL_MODULE_DISABLE_AUTO_ADD_INF
) &&

7025 (!
¨
->
p2p
)) {

7026 
i
 = 1; i < 
ATH6KL_VIF_MAX
; i++) {

7027 
	`π∆_lock
();

7028 
∑øms
.
u£_4addr
 = 0;

7029 i‡(
¨
->
√xt_mode
[
i
] =
ATH6KL_VAPMODE_STA
) {

7030 i‡(
	`©h6kl_cfg80211_add_iÁ˚
(

7031 
¨
->
wùhy
,

7032 
ATH6KL_DEVNAME_DEF_STA
,

7033 
NL80211_IFTYPE_STATION
,

7034 
NULL
,

7035 &
∑øms
Ë=
NULL
) {

7036 
	`©h6kl_îr
("Create sta interface fail!\n");

7038 } i‡(
¨
->
√xt_mode
[
i
] =
ATH6KL_VAPMODE_AP
) {

7039 i‡(
	`©h6kl_cfg80211_add_iÁ˚
(

7040 
¨
->
wùhy
,

7041 
ATH6KL_DEVNAME_DEF_AP
,

7042 
NL80211_IFTYPE_AP
,

7043 
NULL
,

7044 &
∑øms
Ë=
NULL
) {

7045 
	`©h6kl_îr
("Createáp interface fail!\n");

7048 
	`π∆_u∆ock
();

7053 
i
 = 0; i < 
MAX_RD_WAIT_CNT
; i++) {

7054 i‡(
	`©h6kl_ªg_is_öô_d⁄e
(
¨
)) {

7056 
	`scheduÀ_timeout_öãºu±ibÀ
(2);

7060 
	`scheduÀ_timeout_öãºu±ibÀ
(
	`m£cs_to_jiffõs
(100));

7063 
	`˛ór_bô
(
INIT_DEFER_PROGRESS
, &
¨
->
Êag
);

7064 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_WAIT_DEFER
))

7065 
	`wake_up
(&
¨
->
öô_de„r_waô_wq
);

7068 #unde‡
MAX_RD_WAIT_CNT


7069 
	}
}

7072 
	$©h6kl_sh¥Ÿe˘_timî_h™dÀr
(
±r
)

7074 
©h6kl_vif
 *
vif
 = (©h6kl_vi‡*)
±r
;

7075 
©h6kl
 *
¨
 = 
vif
->ar;

7076 
u8
 
bssid
[
ETH_ALEN
];

7078 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s\n", 
__func__
);

7079 
	`˛ór_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
);

7081 i‡(
vif
->
≥nd_skb
) {

7082 
	`©h6kl_îr
("%s, shÆ»nŸ havê≥nd skb\n", 
__func__
);

7083 
	`©h6kl_Êush_≥nd_skb
(
vif
);

7086 i‡(
¨
->
wùhy
->
Êags
 & 
WIPHY_FLAG_SUPPORTS_FW_ROAM
) {

7088 
	`mem£t
(
bssid
, 0, 
ETH_ALEN
);

7089 
bssid
[0] = 0xFF;

7090 
	`©h6kl_wmi_f‹˚_rﬂm_cmd
(
¨
->
wmi
, (c⁄° 
u8
 *)
bssid
);

7092 
	}
}

7094 
	$©h6kl_ópﬁ_sh¥Ÿe˘_timî_h™dÀr
(
±r
)

7096 
©h6kl
 *
¨
 = (©h6k»*)
±r
;

7098 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "%s\n", 
__func__
);

7099 
	`˛ór_bô
(
EAPOL_HANDSHAKE_PROTECT
, &
¨
->
Êag
);

7100 
¨
->
ópﬁ_sh¥Ÿe˘_vif
 = 0;

7103 
	}
}

7105 #i‡
deföed
(
CONFIG_ANDROID
Ë|| deföed(
USB_AUTO_SUSPEND
)

7106 
	$©h6kl_™droid_íabÀ_wow_deÁu…
(
©h6kl
 *
¨
)

7108 
mask
 = 0x3F;

7109 
mask_Àn
;

7110 
rv
 = 0, 
i
;

7111 
cfg80211_wowœn
 
wow
;

7113 i‡(
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
))

7116 
	`mem£t
(&
wow
, 0, (wow));

7119 
wow
.
™y
 = 
åue
;

7120 
wow
.
∑âîns
 = 
	`kˇŒoc
(
¨
->
vif_max
,

7121 (
wow
.
∑âîns
[0]), 
GFP_KERNEL
);

7122 i‡(!
wow
.
∑âîns
)

7123  -
ENOMEM
;

7125 
mask_Àn
 = 
	`DIV_ROUND_UP
(
ETH_ALEN
, 8);

7126 
i
 = 0; i < 
¨
->
vif_max
; i++) {

7128 
wow
.
∑âîns
[
i
].
mask
 = 
	`kmÆloc
(
mask_Àn
 + 
ETH_ALEN
, 
GFP_KERNEL
);

7129 i‡(!
wow
.
∑âîns
[
i
].
mask
) {

7130 
rv
 = -
ENOMEM
;

7131 
Áûed
;

7133 
wow
.
∑âîns
[
i
].
∑âîn
 = wow.∑âîns[i].
mask
 + 
mask_Àn
;

7134 
	`mem˝y
(
wow
.
∑âîns
[
i
].
mask
, &mask, 
mask_Àn
);

7135 
wow
.
∑âîns
[
i
].
∑âîn_Àn
 = 
ETH_ALEN
;

7136 
	`mem˝y
(
wow
.
∑âîns
[
i
].
∑âîn
, 
¨
->
mac_addr
, 
ETH_ALEN
);

7137 i‡(
i
 != 0)

7138 
wow
.
∑âîns
[
i
].
∑âîn
[0] =

7139 (
wow
.
∑âîns
[
i
].
∑âîn
[0] ^ (1 << i)) | 0x2;

7141 
wow
.
n_∑âîns
++;

7143 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
,

7145 
wow
.
∑âîns
[
i
].
∑âîn
[0], wow.patterns[i].pattern[1],

7146 
wow
.
∑âîns
[
i
].
∑âîn
[2], wow.patterns[i].pattern[3],

7147 
wow
.
∑âîns
[
i
].
∑âîn
[4], wow.patterns[i].pattern[5]);

7152 
rv
 = 
	`©h6kl_£t_wow_mode
(
¨
->
wùhy
, &
wow
);

7153 
Áûed
:

7154 
i
 = 0; i < 
¨
->
vif_max
; i++)

7155 
	`k‰ì
(
wow
.
∑âîns
[
i
].
mask
);

7157 
	`k‰ì
(
wow
.
∑âîns
);

7159  
rv
;

7160 
	}
}

7162 
boﬁ
 
	$©h6kl_™droid_√ed_wow_su•íd
(
©h6kl
 *
¨
)

7164 
©h6kl_vif
 *
vif
 = 
NULL
;

7165 
i
;

7166 
boﬁ
 
isC⁄√˘ed
 = 
Ál£
;

7168 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

7169 i‡(!
vif
)

7170  
Ál£
;

7172 i‡(!
	`ã°_bô
(
WLAN_WOW_ENABLE
, &
vif
->
Êags
))

7173  
Ál£
;

7175 #ifde‡
ATH6KL_SUPPORT_WIFI_DISC


7177 i‡(
¨
->
disc_a˘ive
)

7178  
åue
;

7185 
i
 = 0; i < 
¨
->
vif_max
; i++) {

7186 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

7187 i‡(
vif
) {

7189 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
)

7190  
Ál£
;

7191 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))

7192 
isC⁄√˘ed
 = 
åue
;

7196  
isC⁄√˘ed
;

7197 
	}
}

7200 #ifde‡
ATH6KL_SUPPORT_WLAN_HB


7201 
	$©h6kl_íabÀ_wow_hb
(
©h6kl
 *
¨
)

7203 
u32
 
fûãr
 = 0;

7204 
i
, 
ªt
;

7205 
©h6kl_vif
 *
vif
;

7207 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

7208 i‡(!
vif
)

7209  -
EIO
;

7211 i‡(!
	`©h6kl_cfg80211_ªady
(
vif
))

7212  -
EIO
;

7215 
i
 = 0; i < 
WOW_MAX_FILTERS_PER_LIST
; i++)

7216 
	`©h6kl_wmi_dñ_wow_∑âîn_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

7217 
WOW_LIST_ID
, 
i
);

7219 
fûãr
 |
WOW_FILTER_OPTION_MAGIC_PACKET
 |

7220 
WOW_FILTER_OPTION_NWK_DISASSOC
;

7223 i‡(
vif
->
auth_mode
 =
WPA2_AUTH_CCKM
 ||

7224 
vif
->
auth_mode
 =
WPA2_PSK_AUTH
 ||

7225 
vif
->
auth_mode
 =
WPA_AUTH_CCKM
 ||

7226 
vif
->
auth_mode
 =
WPA_PSK_AUTH
) {

7227 
fûãr
 |
WOW_FILTER_OPTION_OFFLOAD_GTK
;

7230 
ªt
 = 
	`©h6kl_wmi_£t_wow_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

7231 
ATH6KL_WOW_MODE_ENABLE
,

7232 
fûãr
,

7233 
WOW_HOST_REQ_DELAY
);

7235  
ªt
;

7236 
	}
}

	@cfg80211.h

17 #i‚de‡
ATH6KL_CFG80211_H


18 
	#ATH6KL_CFG80211_H


	)

20 
	e©h6kl_cfg_su•íd_mode
 {

21 
	mATH6KL_CFG_SUSPEND_DEEPSLEEP
,

22 
	mATH6KL_CFG_SUSPEND_CUTPOWER
,

23 
	mATH6KL_CFG_SUSPEND_WOW


26 
ã°mode
;

27 
©h6kl_p2p
;

28 
©h6kl_v≠
;

29 
©h6kl_wow_ext
;

30 
©h6kl_sˇn_timeout
;

31 
©h6kl_rﬂm_mode
;

33 #ifde‡
ATH6KL_HSIC_RECOVER


34 
u8
 
ˇched_mac
[
ETH_ALEN
];

35 
boﬁ
 
ˇched_mac_vÆid
;

38 
	s©h6kl_bóc⁄_∑ømëîs
 {

40 
	mbóc⁄_öãrvÆ
;

41 
	mdtim_≥riod
;

42 c⁄° 
u8
 *
	mssid
;

43 
size_t
 
	mssid_Àn
;

44 
∆80211_hiddí_ssid
 
	mhiddí_ssid
;

45 
cfg80211_¸y±o_£âögs
 
	m¸y±o
;

46 
boﬁ
 
	m¥ivacy
;

47 
∆80211_auth_ty≥
 
	mauth_ty≥
;

48 
	möa˘ivôy_timeout
;

49 
õì80211_ch™√l
 *
	mch™√l
;

50 
∆80211_ch™√l_ty≥
 
	mch™√l_ty≥
;

51 
u8
 
	mp2p_˘wödow
;

52 
boﬁ
 
	mp2p_›p_ps
;

53 c⁄° 
cfg80211_a˛_d©a
 *
	ma˛
;

54 
boﬁ
 
	mød¨_ªquúed
;

57 c⁄° 
u8
 *
	mhód
, *
	mèû
;

58 
	mhód_Àn
, 
	mèû_Àn
;

59 c⁄° 
u8
 *
	mbóc⁄_õs
;

60 
size_t
 
	mbóc⁄_õs_Àn
;

61 c⁄° 
u8
 *
	m¥obîe•_õs
;

62 
size_t
 
	m¥obîe•_õs_Àn
;

63 c⁄° 
u8
 *
	masso¸e•_õs
;

64 
size_t
 
	masso¸e•_õs_Àn
;

65 c⁄° 
u8
 *
	m¥obe_ª•
;

66 
	m¥obe_ª•_Àn
;

69 
√t_devi˚
 *
©h6kl_öãrÁ˚_add
(
©h6kl
 *
¨
, *
«me
,

70 
∆80211_i·y≥
 
ty≥
,

71 
u8
 
fw_vif_idx
, u8 
nw_ty≥
);

72 
©h6kl_ªgi°î_õì80211_hw
(
©h6kl
 *
¨
);

73 
©h6kl
 *
©h6kl_c‹e_Æloc
(
devi˚
 *
dev
);

74 
©h6kl_deöô_õì80211_hw
(
©h6kl
 *
¨
);

76 
©h6kl_cfg80211_sˇn_com∂ëe_evít
(
©h6kl_vif
 *
vif
, 
boﬁ
 
ab‹ãd
);

78 
©h6kl_cfg80211_c⁄√˘_ªsu…
(
©h6kl_vif
 *
vif
,

79 c⁄° 
u8
 *
bssid
,

80 c⁄° 
u8
 *
ªq_õ
,

81 
size_t
 
ªq_õ_Àn
,

82 c⁄° 
u8
 *
ª•_õ
,

83 
size_t
 
ª•_õ_Àn
,

84 
u16
 
°©us
,

85 
gÂ_t
 
gÂ
);

87 
©h6kl_cfg80211_disc⁄√˘ed
(
©h6kl_vif
 *
vif
,

88 
u16
 
ªas⁄
,

89 
u8
 *
õ
,

90 
size_t
 
õ_Àn
,

91 
gÂ_t
 
gÂ
);

93 
©h6kl_cfg80211_c⁄√˘_evít
(
©h6kl_vif
 *
vif
, 
u16
 
ch™√l
,

94 
u8
 *
bssid
, 
u16
 
li°í_ötvl
,

95 
u16
 
bóc⁄_ötvl
,

96 
√tw‹k_ty≥
 
nw_ty≥
,

97 
u8
 
bóc⁄_õ_Àn
, u8 
assoc_ªq_Àn
,

98 
u8
 
assoc_ª•_Àn
, u8 *
assoc_öfo
);

100 
©h6kl_cfg80211_disc⁄√˘_evít
(
©h6kl_vif
 *
vif
, 
u8
 
ªas⁄
,

101 
u8
 *
bssid
, u8 
assoc_ª•_Àn
,

102 
u8
 *
assoc_öfo
, 
u16
 
¥Ÿo_ªas⁄
);

104 
©h6kl_cfg80211_tkù_mi˚º_evít
(
©h6kl_vif
 *
vif
, 
u8
 
keyid
,

105 
boﬁ
 
ismˇ°
);

107 
©h6kl_cfg80211_su•íd
(
©h6kl
 *
¨
,

108 
©h6kl_cfg_su•íd_mode
 
mode
,

109 
cfg80211_wowœn
 *
wow
);

111 
©h6kl_cfg80211_ªsume
(
©h6kl
 *
¨
);

113 
©h6kl_cfg80211_°›
(
©h6kl_vif
 *
vif
);

114 
©h6kl_cfg80211_°›_Æl
(
©h6kl
 *
¨
);

116 #i‡
deföed
(
CONFIG_ANDROID
Ë|| deföed(
USB_AUTO_SUSPEND
)

117 
©h6kl_£t_wow_mode
(
wùhy
 *wùhy, 
cfg80211_wowœn
 *
wow
);

118 
©h6kl_˛ór_wow_mode
(
wùhy
 *wiphy);

121 
boﬁ
 
©h6kl_sched_sˇn_åiggî
(
©h6kl_vif
 *
vif
);

123 
©h6kl_sˇn_timî_h™dÀr
(
±r
);

125 
©h6kl_sh¥Ÿe˘_timî_h™dÀr
(
±r
);

127 
©h6kl_judge_rﬂm_∑ømëî
(
©h6kl_vif
 *
vif
,

128 
boﬁ
 
ˇŒ_⁄_disc⁄√˘
);

130 
©h6kl_swôch_∑ømëî_ba£d_⁄_c⁄√˘i⁄
(

131 
©h6kl_vif
 *
vif
,

132 
boﬁ
 
ˇŒ_⁄_disc⁄√˘
);

134 #i‡
deföed
(
USB_AUTO_SUSPEND
)

135 
©h6kl_auto_pm_wakeup_ªsume
(
©h6kl
 *
wk
);

	@cfg80211_btcoex.c

17 
	~<löux/moduÀ∑øm.h
>

18 
	~<löux/öëdevi˚.h
>

20 #ifde‡
CONFIG_HAS_WAKELOCK


21 
	~<löux/wakñock.h
>

24 
	~"c‹e.h
"

25 
	~"cfg80211.h
"

26 
	~"debug.h
"

27 
	~"hif-›s.h
"

28 
	~"ã°mode.h
"

29 
	~"cfg80211_btc€x.h
"

31 
boﬁ
 
	$__©h6kl_btc€x_cfg80211_ªady
(
©h6kl
 *
¨
)

33 i‡(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
)) {

34 
	`©h6kl_îr
("wmi isÇotÑeady\n");

35  
Ál£
;

38  
åue
;

39 
	}
}

41 
boﬁ
 
	$©h6kl_btc€x_cfg80211_ªady
(
©h6kl_vif
 *
vif
)

43 i‡(!
	`__©h6kl_btc€x_cfg80211_ªady
(
vif
->
¨
))

44  
Ál£
;

46 i‡(!
	`ã°_bô
(
WLAN_ENABLED
, &
vif
->
Êags
))

47  
Ál£
;

49  
åue
;

50 
	}
}

52 #ifde‡
NL80211_CMD_BTCOEX_QCA


53 
	$©h6kl_nŸify_btc€x
(
wùhy
 *wùhy, 
u8
 *
buf
,

54 
Àn
)

56 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

57 
©h6kl_vif
 *
vif
;

58 
ªt
;

60 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

61 i‡(!
vif
)

62  -
EIO
;

64 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "BT c€x wmòcomm™d:%p\n", 
buf
);

66 i‡(!
	`©h6kl_btc€x_cfg80211_ªady
(
vif
))

67  -
EIO
;

69 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

70 
	`©h6kl_îr
("busy, couldn't getáccess\n");

71  -
ERESTARTSYS
;

74 
ªt
 = 
	`©h6kl_wmi_£nd_btc€x_cmd
(
¨
, 
buf
, 
Àn
);

76 
	`up
(&
¨
->
£m
);

78  
ªt
;

79 
	}
}

	@cfg80211_btcoex.h

16 
©h6kl_nŸify_btc€x
(
wùhy
 *wùhy, 
u8
 *
buf
,

17 
Àn
);

	@common.h

17 #i‚de‡
COMMON_H


18 
	#COMMON_H


	)

20 
	~<löux/√tdevi˚.h
>

22 
	#ATH6KL_MAX_IE
 256

	)

24 
©h6kl_¥ötk
(c⁄° *
Àvñ
, c⁄° *
fmt
, ...);

32 
	#ATH6KL_ABI_VERSION
 1

	)

34 
	#SIGNAL_QUALITY_METRICS_NUM_MAX
 2

	)

37 
	mSIGNAL_QUALITY_METRICS_SNR
 = 0,

38 
	mSIGNAL_QUALITY_METRICS_RSSI
,

39 
	mSIGNAL_QUALITY_METRICS_ALL
,

46 
	#WMI_MAX_TX_DATA_FRAME_LENGTH
 \

47 (1500 + (
wmi_d©a_hdr
) + \

48 (
ëhhdr
) + \

49 (
©h6kl_Œc_¢≠_hdr
))

	)

52 
	#WMI_MAX_AMSDU_RX_DATA_FRAME_LENGTH
 \

53 (3840 + (
wmi_d©a_hdr
) + \

54 (
ëhhdr
) + \

55 (
©h6kl_Œc_¢≠_hdr
))

	)

57 
	#EPPING_ALIGNMENT_PAD
 \

58 ((((
htc_‰ame_hdr
) + 3) & (~0x3)) \

59 - (
htc_‰ame_hdr
))

	)

61 
	s©h6kl_Œc_¢≠_hdr
 {

62 
u8
 
	mdßp
;

63 
u8
 
	msßp
;

64 
u8
 
	m˙é
;

65 
u8
 
	m‹g_code
[3];

66 
__be16
 
	mëh_ty≥
;

67 } 
	g__∑cked
;

69 
	e¸y±o_ty≥
 {

70 
	mNONE_CRYPT
 = 0x01,

71 
	mWEP_CRYPT
 = 0x02,

72 
	mTKIP_CRYPT
 = 0x04,

73 
	mAES_CRYPT
 = 0x08,

74 
	mWAPI_CRYPT
 = 0x10,

75 
	mBIP_CRYPT
 = 0x20,

76 
	mKTK_CRYPT
 = 0x40,

79 
	ghtc_ídpoöt_¸edô_di°
;

80 
	g©h6kl
;

81 
	ghtc_¸edô_di°_ªas⁄
;

82 
	g©h6kl_htc_¸edô_öfo
;

84 
©h6kl
 *
©h6kl_c‹e_Æloc
(
devi˚
 *
sdev
);

85 
©h6kl_c‹e_öô
(
©h6kl
 *
¨
);

86 
©h6kl_c‹e_öô_de„r
(
w‹k_°ru˘
 *
wk
);

87 
©h6kl_c‹e_˛ónup
(
©h6kl
 *
¨
);

88 
sk_buff
 *
©h6kl_buf_Æloc
(
size
);

	@core.h

17 #i‚de‡
CORE_H


18 
	#CORE_H


	)

20 #ifde‡
CE_SUPPORT


21 #ifde‡
CONFIG_ANDROID


22 #unde‡
CONFIG_ANDROID


26 
	~<löux/ëhîdevi˚.h
>

27 
	~<löux/π√éök.h
>

28 
	~<löux/fúmw¨e.h
>

29 
	~<löux/sched.h
>

30 
	~<löux/cúc_buf.h
>

31 
	~<löux/ù.h
>

32 
	~<√t/cfg80211.h
>

33 #ifde‡
CONFIG_ANDROID


34 #ifde‡
CONFIG_HAS_WAKELOCK


35 
	~<löux/wakñock.h
>

36 
	~<asm/mach-ty≥s.h
>

39 #ifde‡
CONFIG_HAS_EARLYSUSPEND


40 
	~<löux/óæysu•íd.h
>

42 
	~"htc.h
"

43 
	~"wmi.h
"

44 
	~"bmi.h
"

45 
	~"èrgë.h
"

46 
	~"wmi_btc€x.h
"

47 #ifde‡
ACS_SUPPORT


48 
	~"acs.h
"

50 
	~"htc€x.h
"

51 
	~"p2p.h
"

52 
	~"≠.h
"

53 
	~"ªg.h
"

54 
	~<löux/wúñess.h
>

55 
	~<löux/öãºu±.h
>

57 
	#MAKE_STR
(
symbﬁ
Ë#symbﬁ

	)

58 
	#TO_STR
(
symbﬁ
Ë
	`MAKE_STR
(symbﬁ)

	)

61 
	#__BUILD_VERSION_
 (3.5.0.411)

	)

63 
	#DRV_VERSION
 
	`TO_STR
(
__BUILD_VERSION_
)

	)

66 
	#ATH6KL_DIAGNOSTIC
 1

	)

67 #ifde‡
ATH6KL_DIAGNOSTIC


68 
	~"dügno£.h
"

71 #i‚de‡
CONFIG_ATH6KL_MCC


72 
	#CONFIG_ATH6KL_MCC


	)

75 #ifde‡
CONFIG_ATH6KL_UB134


76 #i‚de‡
CONFIG_ATH6KL_UDP_TPUT_WAR


77 
	#CONFIG_ATH6KL_UDP_TPUT_WAR


	)

79 #i‚de‡
ATH6KL_HSIC_RECOVER


80 
	#ATH6KL_HSIC_RECOVER


	)

84 #ifde‡
CONFIG_ATH6KL_MCC


85 
	#ATH6KL_MODULEP2P_DEF_MODE
 \

86 (
ATH6KL_MODULEP2P_P2P_ENABLE
 | \

87 
ATH6KL_MODULEP2P_CONCURRENT_ENABLE_DEDICATE
 | \

88 
ATH6KL_MODULEP2P_CONCURRENT_MULTICHAN
 | \

89 
ATH6KL_MODULEP2P_P2P_WISE_SCAN
)

	)

91 
	#ATH6KL_MODULEP2P_DEF_MODE
 \

92 (
ATH6KL_MODULEP2P_P2P_ENABLE
 | \

93 
ATH6KL_MODULEP2P_CONCURRENT_ENABLE_DEDICATE
 | \

94 
ATH6KL_MODULEP2P_P2P_WISE_SCAN
)

	)

98 #i‚de‡
CE_SUPPORT


99 #ifde‡
CONFIG_ANDROID


100 
	#ATH6KL_MODULE_DEF_DEBUG_QUIRKS
 \

101 (
ATH6KL_MODULE_DISABLE_WMI_SYC
 | \

102 
ATH6KL_MODULE_DISABLE_RX_AGGR_DROP
 | \

103 
ATH6KL_MODULES_ANI_ENABLE
 | \

104 
ATH6KL_MODULE_ENABLE_FW_CRASH_NOTIFY
 | \

105 0)

	)

107 
	#ATH6KL_MODULE_DEF_DEBUG_QUIRKS
 \

108 (
ATH6KL_MODULE_DISABLE_WMI_SYC
 | \

109 
ATH6KL_MODULE_DISABLE_RX_AGGR_DROP
 | \

110 
ATH6KL_MODULES_ANI_ENABLE
 | \

111 0)

	)

114 
	#ATH6KL_MODULE_DEF_DEBUG_QUIRKS
 \

115 (
ATH6KL_MODULE_DISABLE_WMI_SYC
 | \

116 
ATH6KL_MODULE_DISABLE_SKB_DUP
 | \

117 0)

	)

120 #i‚de‡
ATH6KL_MODULEP2P_DEF_MODE


121 
	#ATH6KL_MODULEP2P_DEF_MODE
 (0)

	)

124 #i‚de‡
ATH6KL_MODULEVAP_DEF_MODE


125 
	#ATH6KL_MODULEVAP_DEF_MODE
 (0)

	)

128 #i‚de‡
ATH6KL_MODULE_DEF_DEBUG_QUIRKS


129 
	#ATH6KL_MODULE_DEF_DEBUG_QUIRKS
 (0)

	)

132 #i‚de‡
ATH6KL_DEVNAME_DEF_P2P


133 
	#ATH6KL_DEVNAME_DEF_P2P
 "p2p%d"

	)

136 #i‚de‡
ATH6KL_DEVNAME_DEF_AP


137 
	#ATH6KL_DEVNAME_DEF_AP
 "≠%d"

	)

140 #i‚de‡
ATH6KL_DEVNAME_DEF_STA


141 
	#ATH6KL_DEVNAME_DEF_STA
 "°a%d"

	)

155 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_9


156 #i‚de‡
ATH6KL_SUPPORT_NL80211_KERNEL3_8


157 
	#ATH6KL_SUPPORT_NL80211_KERNEL3_8


	)

161 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_8


162 #i‚de‡
ATH6KL_SUPPORT_NL80211_KERNEL3_7


163 
	#ATH6KL_SUPPORT_NL80211_KERNEL3_7


	)

167 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_7


168 #i‚de‡
ATH6KL_SUPPORT_NETLINK_KERNEL3_7


169 
	#ATH6KL_SUPPORT_NETLINK_KERNEL3_7


	)

172 #i‚de‡
ATH6KL_SUPPORT_NL80211_KERNEL3_6


173 
	#ATH6KL_SUPPORT_NL80211_KERNEL3_6


	)

177 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_6


178 #i‚de‡
ATH6KL_SUPPORT_NETLINK_KERNEL3_6


179 
	#ATH6KL_SUPPORT_NETLINK_KERNEL3_6


	)

182 #i‚de‡
ATH6KL_SUPPORT_NL80211_KERNEL3_5


183 
	#ATH6KL_SUPPORT_NL80211_KERNEL3_5


	)

187 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_5


188 #i‚de‡
ATH6KL_SUPPORT_NL80211_KERNEL3_4


189 
	#ATH6KL_SUPPORT_NL80211_KERNEL3_4


	)

197 #ifde‡
CONFIG_ANDROID


198 
	#ATH6KL_SUPPORT_NL80211_QCA


	)

200 #i‡
deföed
(
ATH6KL_SUPPORT_NL80211_KERNEL3_4
) || \

201 
	$deföed
(
ATH6KL_SUPPORT_NL80211_KERNEL3_6
)

206 #unde‡
ATH6KL_SUPPORT_NL80211_QCA


209 #i‚de‡
machöe_is_≠q8064_dma


210 
	#machöe_is_≠q8064_dma
(Ë0

	)

213 #i‚de‡
machöe_is_≠q8064_buñÀr


214 
	#machöe_is_≠q8064_buñÀr
(Ë0

	)

230 #ifde‡
ATH6KL_SUPPORT_NL80211_QCA


240 
	#NL80211_CMD_GET_WOWLAN_QCA


	)

241 
	#NL80211_CMD_BTCOEX_QCA


	)

243 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_4


250 
	#NL80211_CMD_START_STOP_AP


	)

251 
	#NL80211_ATTR_WIPHY_RX_SIGNAL_DBM


	)

252 
	#CFG80211_WIPHY_FLAG_HAS_REMAIN_ON_CHANNEL


	)

253 
	#NL80211_ATTR_AP_INACTIVITY_TIMEOUT


	)

255 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_5


259 
	#NL80211_CMD_OPER_CH_SWITCH_NOTIFY


	)

261 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_6


267 
	#CFG80211_NETDEV_REPLACED_BY_WDEV


	)

268 
	#CFG80211_NO_SET_CHAN_OPERATION


	)

270 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_8


280 
	#NL80211_WIPHY_FEATURE_SCAN_FLUSH


	)

281 
	#CFG80211_TX_POWER_PER_WDEV


	)

282 
	#CFG80211_REMOVE_ROC_CHAN_TYPE


	)

283 
	#CFG80211_NEW_CHAN_DEFINITION


	)

284 
	#CFG80211_SAFE_BSS_INFO_ACCESS


	)

286 #ifde‡
ATH6KL_SUPPORT_NL80211_KERNEL3_9


292 
	#CFG80211_VOID_REG_NOTIFIER


	)

293 
	#CFG80211_NEW_REF_BSS_OPER


	)

294 
	#NL80211_CMD_SET_AP_MAC_ACL


	)

297 
	#ATH6KL_SUPPORT_WIFI_DISC
 1

	)

298 
	#ATH6KL_SUPPORT_WIFI_KTK
 1

	)

299 
	#ATH6KL_SUPPORT_WLAN_HB
 1

	)

301 
	#MAX_ATH6KL
 1

	)

302 
	#ATH6KL_MAX_RX_BUFFERS
 16

	)

303 
	#ATH6KL_BUFFER_SIZE
 1664

	)

304 
	#ATH6KL_MAX_AMSDU_RX_BUFFERS
 4

	)

305 
	#ATH6KL_AMSDU_REFILL_THRESHOLD
 3

	)

306 
	#ATH6KL_AMSDU_BUFFER_SIZE
 (
WMI_MAX_AMSDU_RX_DATA_FRAME_LENGTH
 + 128)

	)

307 
	#MAX_MSDU_SUBFRAME_PAYLOAD_LEN
 1508

	)

308 
	#MIN_MSDU_SUBFRAME_PAYLOAD_LEN
 36

	)

310 
	#USER_SAVEDKEYS_STAT_INIT
 0

	)

311 
	#USER_SAVEDKEYS_STAT_RUN
 1

	)

313 
	#ATH6KL_TX_TIMEOUT
 10

	)

314 
	#ATH6KL_MAX_ENDPOINTS
 4

	)

315 
	#MAX_NODE_NUM
 15

	)

318 
	#ATH6KL_HTC_ALIGN_BYTES
 3

	)

324 
	#MAX_DEF_COOKIE_NUM
 400

	)

325 
	#MAX_HI_COOKIE_NUM
 40

	)

326 
	#MAX_VIF_COOKIE_NUM
 200

	)

328 
	#MAX_COOKIE_DATA_NUM
 (
MAX_DEF_COOKIE_NUM
 + 
MAX_HI_COOKIE_NUM
)

	)

329 
	#MAX_COOKIE_CTRL_NUM
 (64 + 2)

	)

331 
	#MAX_DEFAULT_SEND_QUEUE_DEPTH
 (
MAX_DEF_COOKIE_NUM
 / 
WMM_NUM_AC
)

	)

332 
	#MAX_DEFAULT_SEND_QUEUE_DEPTH_CTRL
 
MAX_COOKIE_CTRL_NUM


	)

334 
	#DISCON_TIMER_INTVAL
 10000

	)

335 
	#A_DEFAULT_LISTEN_INTERVAL
 100

	)

336 
	#A_MAX_WOW_LISTEN_INTERVAL
 1000

	)

338 
	#ATH6KL_DISCONNECT_TIMEOUT
 3

	)

339 
	#ATH6KL_SEAMLESS_ROAMING_DISCONNECT_TIMEOUT
 10

	)

342 
	#ATH6KL_FG_SCAN_INTERVAL
 100

	)

344 
	#ATH6KL_SCAN_ACT_DEWELL_TIME
 20

	)

345 
	#ATH6KL_SCAN_PAS_DEWELL_TIME
 50

	)

346 
	#ATH6KL_SCAN_PROBE_PER_SSID
 1

	)

347 
	#ATH6KL_SCAN_FG_MAX_PERIOD
 (5Ë

	)

348 
	#ATH6KL_SCAN_PAS_DEWELL_TIME_WITHOUT_ROAM
 100

	)

351 
	#ATH6KL_ROC_MAX_PERIOD
 (5Ë

	)

354 
	#ATH6KL_SCAN_TIMEOUT_LONG
 (8 * 
HZ
Ë

	)

355 
	#ATH6KL_SCAN_TIMEOUT_SHORT
 (5 * 
HZ
Ë

	)

356 
	#ATH6KL_SCAN_TIMEOUT_WITHOUT_ROAM
 (20 * 
HZ
Ë

	)

359 
	#ATH6KL_HANDSHAKE_PROC_TIMEOUT
 (3 * 
HZ
Ë

	)

362 
	#ATH6KL_FIRMWARE_MAGIC
 "QCA-ATH6KL"

	)

365 
	#ATH6KL_24GHZ_HT40_DEF_STA_IDX
 (0Ë

	)

366 
	#ATH6KL_24GHZ_HT40_DEF_WIDTH
 (1Ë

	)

367 
	#ATH6KL_24GHZ_HT40_DEF_SGI
 (1Ë

	)

368 
	#ATH6KL_24GHZ_HT40_DEF_INTOLR40
 (0Ë

	)

369 
	#ATH6KL_5GHZ_HT40_DEF_WIDTH
 (1Ë

	)

370 
	#ATH6KL_5GHZ_HT40_DEF_SGI
 (1Ë

	)

371 
	#ATH6KL_5GHZ_HT40_DEF_INTOLR40
 (0Ë

	)

374 
	#ATH6KL_GTX_NEXT_PROBE_COUNT
 20

	)

375 
	#ATH6KL_GTX_MAX_BACK_OFF
 6

	)

376 
	#ATH6KL_GTX_MIN_RSSI
 35

	)

377 
	#ATH6KL_GTX_FORCE_BACKOFF
 0

	)

382 
	#ATH6KL_EAPOL_DELAY_REPORT_IN_HANDSHAKE
 (
	`m£cs_to_jiffõs
(30))

	)

396 
	#ATH6KL_SCAN_PREEMPT_IN_HANDSHAKE
 (
	`m£cs_to_jiffõs
(1250))

	)

399 #i‡(
	`deföed
(
CONFIG_ANDROID
Ë&& !deföed(
ATH6KL_USB_ANDROID_CE
))

400 
	#ATH6KL_SDIO_DEFAULT_ROAM_MODE
 \

401 
ATH6KL_MODULEROAM_NO_LRSSI_SCAN_AT_MULTI


	)

402 
	#ATH6KL_USB_DEFAULT_ROAM_MODE
 \

403 
ATH6KL_MODULEROAM_NO_LRSSI_SCAN_AT_MULTI


	)

405 
	#ATH6KL_SDIO_DEFAULT_ROAM_MODE
 \

406 
ATH6KL_MODULEROAM_DISABLE_LRSSI_SCAN


	)

407 
	#ATH6KL_USB_DEFAULT_ROAM_MODE
 \

408 
ATH6KL_MODULEROAM_DISABLE


	)

411 
	e©h6kl_fw_õ_ty≥
 {

412 
ATH6KL_FW_IE_FW_VERSION
 = 0,

413 
ATH6KL_FW_IE_TIMESTAMP
 = 1,

414 
ATH6KL_FW_IE_OTP_IMAGE
 = 2,

415 
ATH6KL_FW_IE_FW_IMAGE
 = 3,

416 
ATH6KL_FW_IE_PATCH_IMAGE
 = 4,

417 
ATH6KL_FW_IE_RESERVED_RAM_SIZE
 = 5,

418 
ATH6KL_FW_IE_CAPABILITIES
 = 6,

419 
ATH6KL_FW_IE_PATCH_ADDR
 = 7,

420 
ATH6KL_FW_IE_BOARD_ADDR
 = 8,

421 
ATH6KL_FW_IE_VIF_MAX
 = 9,

424 
	e©h6kl_fw_ˇ∑bûôy
 {

425 
ATH6KL_FW_CAPABILITY_HOST_P2P
 = 0,

428 
ATH6KL_FW_CAPABILITY_MAX
,

431 
	#ATH6KL_CAPABILITY_LEN
 (
	`ALIGN
(
ATH6KL_FW_CAPABILITY_MAX
, 32Ë/ 32)

	)

433 
	s©h6kl_fw_õ
 {

434 
__À32
 
id
;

435 
__À32
 
Àn
;

436 
u8
 
d©a
[0];

440 
	#ATH6KL_IOCTL_STANDARD01
 (
SIOCDEVPRIVATE
+1)

	)

443 
	#ATH6KL_IOCTL_STANDARD02
 (
SIOCDEVPRIVATE
+2)

	)

446 
	#ATH6KL_IOCTL_STANDARD03
 (
SIOCDEVPRIVATE
+3)

	)

449 
	#ATH6KL_IOCTL_STANDARD12
 (
SIOCDEVPRIVATE
+12)

	)

452 
	#ATH6KL_IOCTL_STANDARD13
 (
SIOCDEVPRIVATE
+13)

	)

455 
	#ATH6KL_IOCTL_STANDARD15
 (
SIOCDEVPRIVATE
+15)

	)

458 
	#ATH6KL_IOCTL_WEXT_PRIV6
 (
SIOCIWFIRSTPRIV
+6)

	)

461 
	#ATH6KL_IOCTL_WEXT_PRIV26
 (
SIOCIWFIRSTPRIV
+26)

	)

464 
	#ATH6KL_IOCTL_WEXT_PRIV27
 (
SIOCIWFIRSTPRIV
+27)

	)

467 
	#ATH6KL_IOCTL_WEXT_PRIV31
 (
SIOCIWFIRSTPRIV
+31)

	)

469 
	#ATH6KL_IOCTL_AP_APSD
 (0)

	)

470 
	#ATH6KL_IOCTL_AP_INTRABSS
 (1)

	)

475 
	e©h6kl_xio˘l
 {

476 
ATH6KL_XIOCTL_TRAFFIC_ACTIVITY_CHANGE
 = 80,

479 
	s©h6kl_åaffic_a˘ivôy_ch™ge
 {

480 
u32
 
°ªam_id
;

481 
u32
 
a˘ive
;

484 
	s©h6kl_io˘l_cmd
 {

485 
u32
 
subcmd
;

486 
u32
 
›ti⁄s
;

490 
	#ANDROID_SETBAND_ALL
 0

	)

491 
	#ANDROID_SETBAND_5G
 1

	)

492 
	#ANDROID_SETBAND_2G
 2

	)

493 
	#ANDROID_SETBAND_NO_DFS
 3

	)

494 
	#ANDROID_SETBAND_NO_CH
 4

	)

496 
	s©h6kl_™droid_wifi_¥iv_cmd
 {

497 *
buf
;

498 
u£d_Àn
;

499 
tŸÆ_Àn
;

502 
	sbtc€x_io˘l
 {

503 *
cmd
;

504 
cmd_Àn
;

507 
	e©h6kl_ªcovîy_mode
 {

508 
ATH6KL_RECOVERY_MODE_NONE
 = 0,

509 
ATH6KL_RECOVERY_MODE_WARM
,

510 
ATH6KL_RECOVERY_MODE_COLD
,

513 #ifde‡
CONFIG_ATH6KL_RECOVERY_MODE_USER


514 
	#ATH6KL_RECOVERY_MODE_DEFAULT
 
CONFIG_ATH6KL_RECOVERY_MODE_USER


	)

516 
	#ATH6KL_RECOVERY_MODE_DEFAULT
 
ATH6KL_RECOVERY_MODE_NONE


	)

519 
	#ATH6KL_FW_API2_FILE
 "fw-2.bö"

	)

522 
	#AR6003_HW_1_0_VERSION
 0x300002ba

	)

525 
	#AR6003_HW_2_0_VERSION
 0x30000384

	)

526 
	#AR6003_HW_2_0_PATCH_DOWNLOAD_ADDRESS
 0x57e910

	)

527 
	#AR6003_HW_2_0_FW_DIR
 "©h6k/AR6003/hw2.0"

	)

528 
	#AR6003_HW_2_0_OTP_FILE
 "Ÿp.bö.z77"

	)

529 
	#AR6003_HW_2_0_FIRMWARE_FILE
 "©hwœn.bö.z77"

	)

530 
	#AR6003_HW_2_0_TCMD_FIRMWARE_FILE
 "©htcmd_øm.bö"

	)

531 
	#AR6003_HW_2_0_PATCH_FILE
 "d©a.∑tch.bö"

	)

532 
	#AR6003_HW_2_0_BOARD_DATA_FILE
 "©h6k/AR6003/hw2.0/bd©a.bö"

	)

533 
	#AR6003_HW_2_0_DEFAULT_BOARD_DATA_FILE
 \

534 "©h6k/AR6003/hw2.0/bd©a.SD31.bö"

	)

537 
	#AR6003_HW_2_1_1_VERSION
 0x30000582

	)

538 
	#AR6003_HW_2_1_1_FW_DIR
 "©h6k/AR6003/hw2.1.1"

	)

539 
	#AR6003_HW_2_1_1_OTP_FILE
 "Ÿp.bö"

	)

540 
	#AR6003_HW_2_1_1_FIRMWARE_FILE
 "©hwœn.bö"

	)

541 
	#AR6003_HW_2_1_1_TCMD_FIRMWARE_FILE
 "©htcmd_øm.bö"

	)

542 
	#AR6003_HW_2_1_1_UTF_FIRMWARE_FILE
 "utf.bö"

	)

543 
	#AR6003_HW_2_1_1_TESTSCRIPT_FILE
 "nuŒTe°Flow.bö"

	)

544 
	#AR6003_HW_2_1_1_PATCH_FILE
 "d©a.∑tch.bö"

	)

545 
	#AR6003_HW_2_1_1_BOARD_DATA_FILE
 "©h6k/AR6003/hw2.1.1/bd©a.bö"

	)

546 
	#AR6003_HW_2_1_1_DEFAULT_BOARD_DATA_FILE
 \

547 "©h6k/AR6003/hw2.1.1/bd©a.SD31.bö"

	)

550 
	#AR6004_HW_1_0_VERSION
 0x30000623

	)

551 
	#AR6004_HW_1_0_FW_DIR
 "©h6k/AR6004/hw1.0"

	)

552 
	#AR6004_HW_1_0_OTP_FILE
 "Ÿp.bö"

	)

553 
	#AR6004_HW_1_0_FIRMWARE_FILE
 "fw.øm.bö"

	)

554 
	#AR6004_HW_1_0_BOARD_DATA_FILE
 "©h6k/AR6004/hw1.0/bd©a.bö"

	)

555 
	#AR6004_HW_1_0_DEFAULT_BOARD_DATA_FILE
 \

556 "©h6k/AR6004/hw1.0/bd©a.DB132.bö"

	)

559 
	#AR6004_HW_1_1_VERSION
 0x30000001

	)

560 
	#AR6004_HW_1_1_FW_DIR
 "©h6k/AR6004/hw1.1"

	)

561 
	#AR6004_HW_1_1_OTP_FILE
 "Ÿp.bö"

	)

562 
	#AR6004_HW_1_1_FIRMWARE_FILE
 "fw.øm.bö"

	)

563 
	#AR6004_HW_1_1_TCMD_FIRMWARE_FILE
 "utf.bö"

	)

564 
	#AR6004_HW_1_1_UTF_FIRMWARE_FILE
 "utf.bö"

	)

565 
	#AR6004_HW_1_1_TESTSCRIPT_FILE
 "nuŒTe°Flow.bö"

	)

566 
	#AR6004_HW_1_1_BOARD_DATA_FILE
 "©h6k/AR6004/hw1.1/bd©a.bö"

	)

567 
	#AR6004_HW_1_1_DEFAULT_BOARD_DATA_FILE
 \

568 "©h6k/AR6004/hw1.1/bd©a.DB132.bö"

	)

569 
	#AR6004_HW_1_1_EPPING_FILE
 "©h6k/AR6004/hw1.1/ïpög.bö"

	)

570 
	#AR6004_HW_1_1_SOFTMAC_FILE
 "©h6k/AR6004/hw1.1/so·mac.bö"

	)

571 
	#AR6004_HW_1_1_SOFTMAC_2_FILE
 \

572 "©h6k/AR6004/hw1.1/so·mac_2.bö"

	)

576 
	#AR6004_HW_1_2_VERSION
 0x300007e8

	)

577 
	#AR6004_HW_1_2_FW_DIR
 "©h6k/AR6004/hw1.2"

	)

578 
	#AR6004_HW_1_2_OTP_FILE
 "Ÿp.bö"

	)

579 
	#AR6004_HW_1_2_FIRMWARE_2_FILE
 "fw-2.bö"

	)

580 
	#AR6004_HW_1_2_FIRMWARE_FILE
 "fw.øm.bö"

	)

581 
	#AR6004_HW_1_2_TCMD_FIRMWARE_FILE
 "utf.bö"

	)

582 
	#AR6004_HW_1_2_UTF_FIRMWARE_FILE
 "utf.bö"

	)

583 
	#AR6004_HW_1_2_TESTSCRIPT_FILE
 "nuŒTe°Flow.bö"

	)

584 
	#AR6004_HW_1_2_BOARD_DATA_FILE
 "©h6k/AR6004/hw1.2/bd©a.bö"

	)

585 
	#AR6004_HW_1_2_DEFAULT_BOARD_DATA_FILE
 \

586 "©h6k/AR6004/hw1.2/bd©a.bö"

	)

587 
	#AR6004_HW_1_2_EPPING_FILE
 "©h6k/AR6004/hw1.2/ïpög.bö"

	)

588 
	#AR6004_HW_1_2_SOFTMAC_FILE
 "©h6k/AR6004/hw1.2/so·mac.bö"

	)

589 
	#AR6004_HW_1_2_SOFTMAC_2_FILE
 \

590 "©h6k/AR6004/hw1.2/so·mac_2.bö"

	)

593 
	#AR6004_HW_1_3_VERSION
 0x31c8088a

	)

594 
	#AR6004_HW_1_3_FW_DIR
 "©h6k/AR6004/hw1.3"

	)

595 
	#AR6004_HW_1_3_OTP_FILE
 "Ÿp.bö"

	)

596 
	#AR6004_HW_1_3_FIRMWARE_2_FILE
 "fw-2.bö"

	)

597 
	#AR6004_HW_1_3_FIRMWARE_FILE
 "fw.øm.bö"

	)

598 
	#AR6004_HW_1_3_FIRMWARE_EXT_FILE
 "fw_ext.øm.bö"

	)

599 
	#AR6004_HW_1_3_TCMD_FIRMWARE_FILE
 "utf.bö"

	)

600 
	#AR6004_HW_1_3_UTF_FIRMWARE_FILE
 "utf.bö"

	)

601 
	#AR6004_HW_1_3_TESTSCRIPT_FILE
 "nuŒTe°Flow.bö"

	)

602 
	#AR6004_HW_1_3_BOARD_DATA_FILE
 "©h6k/AR6004/hw1.3/bd©a.bö"

	)

603 
	#AR6004_HW_1_3_DEFAULT_BOARD_DATA_FILE
 \

604 "©h6k/AR6004/hw1.3/bd©a.bö"

	)

605 
	#AR6004_HW_1_3_EPPING_FILE
 "©h6k/AR6004/hw1.3/ïpög.bö"

	)

606 
	#AR6004_HW_1_3_SOFTMAC_FILE
 "©h6k/AR6004/hw1.3/so·mac.bö"

	)

607 
	#AR6004_HW_1_3_SOFTMAC_2_FILE
 \

608 "©h6k/AR6004/hw1.3/so·mac_2.bö"

	)

611 
	#AR6004_HW_2_0_VERSION
 0x31c80958

	)

612 
	#AR6004_HW_2_0_FW_DIR
 "©h6k/AR6004/hw2.0"

	)

613 
	#AR6004_HW_2_0_OTP_FILE
 "Ÿp.bö"

	)

614 
	#AR6004_HW_2_0_FIRMWARE_2_FILE
 "fw-2.bö"

	)

615 
	#AR6004_HW_2_0_FIRMWARE_FILE
 "fw.øm.bö"

	)

616 
	#AR6004_HW_2_0_TCMD_FIRMWARE_FILE
 "utf.bö"

	)

617 
	#AR6004_HW_2_0_UTF_FIRMWARE_FILE
 "utf.bö"

	)

618 
	#AR6004_HW_2_0_TESTSCRIPT_FILE
 "nuŒTe°Flow.bö"

	)

619 
	#AR6004_HW_2_0_BOARD_DATA_FILE
 "©h6k/AR6004/hw2.0/bd©a.bö"

	)

620 
	#AR6004_HW_2_0_DEFAULT_BOARD_DATA_FILE
 \

621 "©h6k/AR6004/hw2.0/bd©a.bö"

	)

622 
	#AR6004_HW_2_0_EPPING_FILE
 "©h6k/AR6004/hw2.0/ïpög.bö"

	)

623 
	#AR6004_HW_2_0_SOFTMAC_FILE
 "©h6k/AR6004/hw2.0/so·mac.bö"

	)

624 
	#AR6004_HW_2_0_SOFTMAC_2_FILE
 \

625 "©h6k/AR6004/hw2.0/so·mac_2.bö"

	)

628 
	#AR6004_HW_3_0_VERSION
 0x31C809F8

	)

629 
	#AR6004_HW_3_0_FW_DIR
 "©h6k/AR6004/hw3.0"

	)

630 
	#AR6004_HW_3_0_OTP_FILE
 "Ÿp.bö"

	)

631 
	#AR6004_HW_3_0_FIRMWARE_2_FILE
 "fw-2.bö"

	)

632 
	#AR6004_HW_3_0_FIRMWARE_FILE
 "fw.øm.bö"

	)

633 
	#AR6004_HW_3_0_TCMD_FIRMWARE_FILE
 "utf.bö"

	)

634 
	#AR6004_HW_3_0_UTF_FIRMWARE_FILE
 "utf.bö"

	)

635 
	#AR6004_HW_3_0_TESTSCRIPT_FILE
 "nuŒTe°Flow.bö"

	)

636 
	#AR6004_HW_3_0_BOARD_DATA_FILE
 "©h6k/AR6004/hw3.0/bd©a.bö"

	)

637 
	#AR6004_HW_3_0_DEFAULT_BOARD_DATA_FILE
 \

638 "©h6k/AR6004/hw3.0/bd©a.bö"

	)

639 
	#AR6004_HW_3_0_EPPING_FILE
 "©h6k/AR6004/hw3.0/ïpög.bö"

	)

640 
	#AR6004_HW_3_0_SOFTMAC_FILE
 "©h6k/AR6004/hw3.0/so·mac.bö"

	)

641 
	#AR6004_HW_3_0_SOFTMAC_2_FILE
 \

642 "©h6k/AR6004/hw3.0/so·mac_2.bö"

	)

645 
	#AR6006_HW_1_0_VERSION
 0x31c80997

	)

646 
	#AR6006_HW_1_0_FW_DIR
 "©h6k/AR6006/hw1.0"

	)

647 
	#AR6006_HW_1_0_FIRMWARE_2_FILE
 "fw-2.bö"

	)

648 
	#AR6006_HW_1_0_FIRMWARE_FILE
 "fw.øm.bö"

	)

649 
	#AR6006_HW_1_0_BOARD_DATA_FILE
 "©h6k/AR6006/hw1.0/bd©a.bö"

	)

650 
	#AR6006_HW_1_0_EPPING_FILE
 "©h6k/AR6006/hw1.0/ïpög.bö"

	)

651 
	#AR6006_HW_1_0_DEFAULT_BOARD_DATA_FILE
 \

652 "©h6k/AR6006/hw1.0/bd©a.bö"

	)

653 
	#AR6006_HW_1_0_SOFTMAC_FILE
 "©h6k/AR6006/hw1.0/so·mac.bö"

	)

654 
	#AR6006_HW_1_0_SOFTMAC_2_FILE
 \

655 "©h6k/AR6006/hw1.0/so·mac_2.bö"

	)

658 
	#AR6006_HW_1_1_VERSION
 0x31c80002

	)

659 
	#AR6006_HW_1_1_FW_DIR
 "©h6k/AR6006/hw1.1"

	)

660 
	#AR6006_HW_1_1_FIRMWARE_2_FILE
 "fw-2.bö"

	)

661 
	#AR6006_HW_1_1_FIRMWARE_FILE
 "fw.øm.bö"

	)

662 
	#AR6006_HW_1_1_BOARD_DATA_FILE
 "©h6k/AR6006/hw1.1/bd©a.bö"

	)

663 
	#AR6006_HW_1_1_EPPING_FILE
 "©h6k/AR6006/hw1.1/ïpög.bö"

	)

664 
	#AR6006_HW_1_1_DEFAULT_BOARD_DATA_FILE
 \

665 "©h6k/AR6006/hw1.1/bd©a.bö"

	)

666 
	#AR6006_HW_1_1_SOFTMAC_FILE
 "©h6k/AR6006/hw1.1/so·mac.bö"

	)

667 
	#AR6006_HW_1_1_SOFTMAC_2_FILE
 \

668 "©h6k/AR6006/hw1.1/so·mac_2.bö"

	)

670 
	#AR6004_MAX_64K_FW_SIZE
 65536

	)

672 
	#BDATA_CHECKSUM_OFFSET
 4

	)

673 
	#BDATA_MAC_ADDR_OFFSET
 8

	)

674 
	#BDATA_OPFLAGS_OFFSET
 24

	)

675 
	#BDATA_TXRXMASK_OFFSET
 40

	)

678 
	#STA_PS_AWAKE
 
	`BIT
(0)

	)

679 
	#STA_PS_SLEEP
 
	`BIT
(1)

	)

680 
	#STA_PS_POLLED
 
	`BIT
(2)

	)

681 
	#STA_PS_APSD_TRIGGER
 
	`BIT
(3)

	)

682 
	#STA_PS_APSD_EOSP
 
	`BIT
(4)

	)

683 
	#STA_HT_SUPPORT
 
	`BIT
(5)

	)

686 
	#ATH6KL_CONTROL_PKT_TAG
 
HTC_TX_PACKET_TAG_USER_DEFINED


	)

687 
	#ATH6KL_DATA_PKT_TAG
 (
ATH6KL_CONTROL_PKT_TAG
 + 1)

	)

688 
	#ATH6KL_PRI_DATA_PKT_TAG
 (
ATH6KL_CONTROL_PKT_TAG
 + 2)

	)

690 
	#AR6003_CUST_DATA_SIZE
 16

	)

692 
	#AGGR_WIN_IDX
(
x
, 
y
Ë((xË% (y))

	)

693 
	#AGGR_INCR_IDX
(
x
, 
y
Ë
	`AGGR_WIN_IDX
(((xË+ 1), (y))

	)

694 
	#AGGR_DCRM_IDX
(
x
, 
y
Ë
	`AGGR_WIN_IDX
(((xË- 1), (y))

	)

695 
	#ATH6KL_MAX_SEQ_NO
 0xFFF

	)

696 
	#ATH6KL_NEXT_SEQ_NO
(
x
Ë(((xË+ 1Ë& 
ATH6KL_MAX_SEQ_NO
)

	)

698 
	#NUM_OF_TIDS
 8

	)

699 
	#AGGR_SZ_DEFAULT
 8

	)

701 
	#AGGR_WIN_SZ_MIN
 2

	)

702 
	#AGGR_WIN_SZ_MAX
 8

	)

704 
	#TID_WINDOW_SZ
(
_x
Ë((_xË<< 1)

	)

706 
	#AGGR_NUM_OF_FREE_NETBUFS
 16

	)

708 
	#AGGR_RX_TIMEOUT
 100

	)

709 
	#AGGR_RX_TIMEOUT_VO
 50

	)

710 
	#MCC_AGGR_RX_TIMEOUT
 300

	)

711 
	#MCC_AGGR_RX_TIMEOUT_VO
 150

	)

713 
	#AGGR_GET_RXTID_STATS
(
_p
, 
_x
Ë(&(_p->
°©
[(_x)]))

	)

714 
	#AGGR_GET_RXTID
(
_p
, 
_x
Ë(&(_p->
rx_tid
[(_x)]))

	)

716 
	#AGGR_BA_EVT_GET_CONNID
(
_c⁄n
Ë((_c⁄nË>> 4)

	)

717 
	#AGGR_BA_EVT_GET_TID
(
_tid
Ë((_tidË& 0xF)

	)

719 
	#AGGR_TX_MAX_AGGR_SIZE
 1600

	)

720 
	#AGGR_TX_MAX_PDU_SIZE
 120

	)

721 
	#AGGR_TX_MIN_PDU_SIZE
 64

	)

722 
	#AGGR_TX_MAX_NUM
 6

	)

723 
	#AGGR_TX_TIMEOUT
 4

	)

725 
	#AGGR_TX_PROG_HS_THRESH
 1000

	)

726 
	#AGGR_TX_PROG_HS_FACTOR
 2

	)

727 
	#AGGR_TX_PROG_NS_THRESH
 250

	)

728 
	#AGGR_TX_PROG_NS_FACTOR
 4

	)

729 
	#AGGR_TX_PROG_CHECK_INTVAL
 (1 * 
HZ
)

	)

730 
	#AGGR_TX_PROG_HS_MAX_NUM
 22

	)

731 
	#AGGR_TX_PROG_HS_TIMEOUT
 8

	)

733 
	#AGGR_GET_TXTID
(
_p
, 
_x
Ë(&(_p->
tx_tid
[(_x)]))

	)

735 
	#WMI_TIMEOUT
 (2 * 
HZ
)

	)

737 
	#MBOX_YIELD_LIMIT
 99

	)

740 
	#ATH6KL_PS_QUEUE_CHECK_AGE
 (1 * 1000Ë

	)

741 
	#ATH6KL_PS_QUEUE_MAX_AGE
 (5Ë

	)

742 
	#ATH6KL_PS_QUEUE_NO_AGE
 (0Ë

	)

744 
	#ATH6KL_PS_QUEUE_MAX_DEPTH
 (65535)

	)

745 
	#ATH6KL_PS_QUEUE_NO_DEPTH
 (0Ë

	)

747 
	eps_queue_ty≥
 {

748 
PS_QUEUE_TYPE_NONE
,

749 
PS_QUEUE_TYPE_STA_UNICAST
,

750 
PS_QUEUE_TYPE_STA_MGMT
,

751 
PS_QUEUE_TYPE_AP_MULTICAST
,

755 
	esˇnb™d_ty≥
 {

756 
SCANBAND_TYPE_ALL
,

757 
SCANBAND_TYPE_2G
,

758 
SCANBAND_TYPE_5G
,

759 
SCANBAND_TYPE_CHAN_ONLY
,

760 
SCANBAND_TYPE_P2PCHAN
,

761 
SCANBAND_TYPE_2_P2PCHAN
,

762 
SCANBAND_TYPE_IGNORE_DFS
,

763 
SCANBAND_TYPE_IGNORE_CH
,

766 
	#ATH6KL_RSN_CAP_NULLCONF
 (0xffff)

	)

777 
	#ATH6KL_CONF_IGNORE_ERP_BARKER
 
	`BIT
(0)

	)

778 
	#ATH6KL_CONF_IGNORE_PS_FAIL_EVT_IN_SCAN
 
	`BIT
(1)

	)

779 
	#ATH6KL_CONF_ENABLE_11N
 
	`BIT
(2)

	)

780 
	#ATH6KL_CONF_ENABLE_TX_BURST
 
	`BIT
(3)

	)

781 
	#ATH6KL_CONF_SUSPEND_CUTPOWER
 
	`BIT
(4)

	)

782 
	#ATH6KL_CONF_ENABLE_FLOWCTRL
 
	`BIT
(5)

	)

783 
	#ATH6KL_CONF_DISABLE_SKIP_FLOWCTRL
 
	`BIT
(6)

	)

784 
	#ATH6KL_CONF_DISABLE_RX_AGGR_DROP
 
	`BIT
(7)

	)

785 
	#ATH6KL_CONF_SKB_DUP
 
	`BIT
(8)

	)

787 
	ewœn_low_pwr_°©e
 {

788 
WLAN_POWER_STATE_ON
,

789 
WLAN_POWER_STATE_CUT_PWR
,

790 
WLAN_POWER_STATE_DEEP_SLEEP
,

791 
WLAN_POWER_STATE_WOW


794 
	esme_°©e
 {

795 
SME_DISCONNECTED
,

796 
SME_CONNECTING
,

797 
SME_CONNECTED


800 
	sskb_hﬁd_q
 {

801 
sk_buff
 *
skb
;

802 
boﬁ
 
is_amsdu
;

803 
u16
 
£q_no
;

812 
	#ATH6KL_MAX_WAIT_CONTINUOUS_PKT
 3

	)

814 
	srxtid
 {

815 
boﬁ
 
aggr
;

816 
u16
 
wö_sz
;

817 
u16
 
£q_√xt
;

818 
u32
 
hﬁd_q_sz
;

819 
skb_hﬁd_q
 *
hﬁd_q
;

820 
sk_buff_hód
 
q
;

821 
•ölock_t
 
lock
;

822 
u16
 
timîwaô_£q_num
;

823 
boﬁ
 
sync_√xt_£q
;

824 
timî_li°
 
tid_timî
;

825 
u8
 
tid_timî_scheduÀd
;

826 
u8
 
tid
;

827 
u16
 
issue_timî_£q
;

828 
aggr_c⁄n_öfo
 *
aggr_c⁄n
;

829 
u8
 
c⁄töuous_cou¡
;

832 
	srxtid_°©s
 {

833 
u32
 
num_öto_aggr
;

834 
u32
 
num_dups
;

835 
u32
 
num_oow
;

836 
u32
 
num_mpdu
;

837 
u32
 
num_amsdu
;

838 
u32
 
num_dñivîed
;

839 
u32
 
num_timeouts
;

840 
u32
 
num_hﬁe
;

841 
u32
 
num_b¨
;

845 
AGGR_TX_OK
 = 0,

846 
AGGR_TX_DONE
,

847 
AGGR_TX_BYPASS
,

848 
AGGR_TX_DROP
,

849 
AGGR_TX_UNKNOW
,

852 
	stxtid
 {

853 
u8
 
tid
;

854 
u16
 
aid
;

855 
u16
 
max_aggr_sz
;

856 
timî_li°
 
timî
;

857 
sk_buff
 *
amsdu_skb
;

858 
u8
 
amsdu_˙t
;

859 
u8
 *
amsdu_°¨t
;

860 
u16
 
amsdu_Àn
;

861 
u16
 
amsdu_œ°pdu_Àn
;

862 
•ölock_t
 
lock
;

863 
©h6kl_vif
 *
vif
;

866 
œ°_check_time
;

867 
u32
 
œ°_num_amsdu
;

868 
u32
 
œ°_num_timeout
;

871 
u32
 
num_pdu
;

872 
u32
 
num_amsdu
;

873 
u32
 
num_timeout
;

874 
u32
 
num_Êush
;

875 
u32
 
num_tx_nuŒ
;

876 
u32
 
num_ovîÊow
;

879 
	saggr_öfo
 {

880 
©h6kl_vif
 *
vif
;

881 
sk_buff_hód
 
‰ì_q
;

884 
u16
 
rx_aggr_timeout
;

887 
boﬁ
 
tx_amsdu_íabÀ
;

888 
boﬁ
 
tx_amsdu_£q_pkt
;

889 
boﬁ
 
tx_amsdu_¥ogªssive
;

890 
boﬁ
 
tx_amsdu_¥ogªssive_hi•ìd
;

892 
u8
 
tx_amsdu_max_aggr_num
;

893 
u32
 
tx_amsdu_max_aggr_Àn
;

894 
u16
 
tx_amsdu_max_pdu_Àn
;

895 
u16
 
tx_amsdu_timeout
;

898 
	saggr_c⁄n_öfo
 {

899 
u8
 
aggr_sz
;

900 
aggr_öfo
 *
aggr_˙txt
;

901 
√t_devi˚
 *
dev
;

902 
rxtid
 
rx_tid
[
NUM_OF_TIDS
];

903 
rxtid_°©s
 
°©
[
NUM_OF_TIDS
];

904 
u32
 
tid_timeout_£âög
[
NUM_OF_TIDS
];

906 
txtid
 
tx_tid
[
NUM_OF_TIDS
];

909 
	s©h6kl_wï_key
 {

910 
u8
 
key_ödex
;

911 
u8
 
key_Àn
;

912 
u8
 
key
[64];

915 
	#ATH6KL_KEY_SEQ_LEN
 8

	)

917 
	s©h6kl_key
 {

918 
u8
 
key
[
WLAN_MAX_KEY_LEN
];

919 
u8
 
key_Àn
;

920 
u8
 
£q
[
ATH6KL_KEY_SEQ_LEN
];

921 
u8
 
£q_Àn
;

922 
u32
 
cùhî
;

925 
	s©h6kl_node_m≠pög
 {

926 
u8
 
mac_addr
[
ETH_ALEN
];

927 
u8
 
ï_id
;

928 
u8
 
tx_≥nd
;

931 
	ecookõ_ty≥
 {

932 
COOKIE_TYPE_NONE
,

933 
COOKIE_TYPE_DATA
,

934 
COOKIE_TYPE_CTRL
,

937 
	s©h6kl_cookõ
 {

938 
©h6kl_cookõ_poﬁ
 *
cookõ_poﬁ
;

939 
sk_buff
 *
skb
;

940 
u32
 
m≠_no
;

941 
htc_∑ckë
 *
htc_pkt
;

942 
©h6kl_cookõ
 *
¨c_li°_√xt
;

945 
	s©h6kl_cookõ_poﬁ
 {

946 
cookõ_ty≥
 cookie_type;

947 
u32
 
cookõ_num
;

949 
©h6kl_cookõ
 *
cookõ_li°
;

950 
u32
 
cookõ_cou¡
;

951 
©h6kl_cookõ
 *
cookõ_mem
;

954 
u32
 
cookõ_Æloc_˙t
;

955 
u32
 
cookõ_Æloc_Áû_˙t
;

956 
u32
 
cookõ_‰ì_˙t
;

957 
u32
 
cookõ_≥ak_˙t
;

960 
	s©h6kl_ps_buf_desc
 {

961 
li°_hód
 
li°
;

963 
u32
 
age
;

964 
size_t
 
Àn
;

967 
sk_buff
 *
skb
;

970 
u32
 
‰eq
;

971 
u32
 
waô
;

972 
u32
 
id
;

973 
boﬁ
 
no_cck
;

974 
boﬁ
 
d⁄t_waô_f‹_ack
;

975 
u8
 
buf
[1];

978 
	s©h6kl_ps_buf_hód
 {

979 
li°_hód
 
li°
;

980 
•ölock_t
 
lock
;

982 
ps_queue_ty≥
 
queue_ty≥
;

983 
dïth
;

985 
u32
 
age_cy˛e
;

986 
u32
 
max_dïth
;

989 
u32
 
íqueued
;

990 
u32
 
íqueued_îr
;

991 
u32
 
dequeued
;

992 
u32
 
aged
;

995 #ifde‡
ATHTST_SUPPORT


996 
	#ATH_RSSI_LPF_LEN
 10

	)

997 
	#ATH_RSSI_DUMMY_MARKER
 0x127

	)

998 
	#RSSI_LPF_THRESHOLD
 -20

	)

999 
	#ATH_RSSI_EP_MULTIPLIER
 (1<<7Ë

	)

1000 
	#HAL_RSSI_EP_MULTIPLIER
 (1<<7Ë

	)

1001 
	#ATH_EP_RND
(
x
, 
mul
) \

1002 ((((
x
)%(
mul
)Ë>((mul)/2)Ë? ((xË+ ((mulË- 1)Ë/ (mulË: (x)/(mul))

	)

1004 
	#ATH_EP_MUL
(
x
, 
mul
Ë((xË* (mul))

	)

1006 
	#ATH_RSSI_IN
(
x
) \

1007 (
	`ATH_EP_MUL
((
x
), 
ATH_RSSI_EP_MULTIPLIER
))

	)

1009 
	#ATH_LPF_RSSI
(
x
, 
y
, 
Àn
) \

1010 ((
x
 !
ATH_RSSI_DUMMY_MARKER
Ë? (((xË* ((
Àn
Ë- 1Ë+ (
y
)Ë/ (Àn)Ë: (y))

	)

1012 
	#ATH_RSSI_LPF
(
x
, 
y
) do { \

1013 i‡((
y
Ë>
RSSI_LPF_THRESHOLD
) \

1014 
x
 = 
	`ATH_LPF_RSSI
((x), 
	`ATH_RSSI_IN
((
y
)), 
ATH_RSSI_LPF_LEN
); \

1015 
	}
} 0)

	)

1018 
	e©h6kl_phy_mode
 {

1019 
	mATH6KL_PHY_MODE_11A
 = 0,

1020 
	mATH6KL_PHY_MODE_11G
 = 1,

1021 
	mATH6KL_PHY_MODE_11B
 = 2,

1022 
	mATH6KL_PHY_MODE_11GONLY
 = 3,

1023 
	mATH6KL_PHY_MODE_11NA_HT20
 = 4,

1024 
	mATH6KL_PHY_MODE_11NG_HT20
 = 5,

1025 
	mATH6KL_PHY_MODE_11NA_HT40
 = 6,

1026 
	mATH6KL_PHY_MODE_11NG_HT40
 = 7,

1027 
	mATH6KL_PHY_MODE_UNKNOWN
 = 8,

1028 
	mATH6KL_PHY_MODE_MAX
 = 8,

1031 
	s©h6kl_°a
 {

1032 
u16
 
	m°a_Êags
;

1033 
u8
 
	mmac
[
ETH_ALEN
];

1034 
u8
 
	maid
;

1035 
u8
 
	mkeymgmt
;

1036 
u8
 
	mucùhî
;

1037 
u8
 
	mauth
;

1038 
u8
 
	mw∑_õ
[
ATH6KL_MAX_IE
];

1039 
©h6kl_phy_mode
 
	mphymode
;

1040 
©h6kl_vif
 *
	mvif
;

1043 
•ölock_t
 
	mlock
;

1046 
©h6kl_ps_buf_hód
 
	mpsq_d©a
;

1047 
©h6kl_ps_buf_hód
 
	mpsq_mgmt
;

1048 
timî_li°
 
	mpsq_age_timî
;

1049 
u8
 
	mpsq_age_a˘ive
;

1050 
u8
 
	m≠sd_öfo
;

1053 
aggr_c⁄n_öfo
 *
	maggr_c⁄n_˙txt
;

1056 
u16
 
	mœ°_txrx_time_tgt
;

1057 
	mœ°_txrx_time
;

1058 #ifde‡
ATHTST_SUPPORT


1059 
	mavg_d©a_rssi
;

1063 
	s©h6kl_vîsi⁄
 {

1064 
u32
 
	mèrgë_vî
;

1065 
u32
 
	mwœn_vî
;

1066 
u32
 
	mabi_vî
;

1069 
	s©h6kl_bmi
 {

1070 
u32
 
	mcmd_¸edôs
;

1071 
boﬁ
 
	md⁄e_£¡
;

1072 
u8
 *
	mcmd_buf
;

1073 
u32
 
	mmax_d©a_size
;

1074 
u32
 
	mmax_cmd_size
;

1077 
	sèrgë_°©s
 {

1078 
u64
 
	mtx_pkt
;

1079 
u64
 
	mtx_byã
;

1080 
u64
 
	mtx_uˇ°_pkt
;

1081 
u64
 
	mtx_uˇ°_byã
;

1082 
u64
 
	mtx_mˇ°_pkt
;

1083 
u64
 
	mtx_mˇ°_byã
;

1084 
u64
 
	mtx_bˇ°_pkt
;

1085 
u64
 
	mtx_bˇ°_byã
;

1086 
u64
 
	mtx_πs_suc˚ss_˙t
;

1087 
u64
 
	mtx_pkt_≥r_ac
[4];

1089 
u64
 
	mtx_îr
;

1090 
u64
 
	mtx_Áû_˙t
;

1091 
u64
 
	mtx_ªåy_˙t
;

1092 
u64
 
	mtx_mu…_ªåy_˙t
;

1093 
u64
 
	mtx_πs_Áû_˙t
;

1095 
u64
 
	mrx_pkt
;

1096 
u64
 
	mrx_byã
;

1097 
u64
 
	mrx_uˇ°_pkt
;

1098 
u64
 
	mrx_uˇ°_byã
;

1099 
u64
 
	mrx_mˇ°_pkt
;

1100 
u64
 
	mrx_mˇ°_byã
;

1101 
u64
 
	mrx_bˇ°_pkt
;

1102 
u64
 
	mrx_bˇ°_byã
;

1103 
u64
 
	mrx_‰gmít_pkt
;

1105 
u64
 
	mrx_îr
;

1106 
u64
 
	mrx_¸c_îr
;

1107 
u64
 
	mrx_key_ˇche_miss
;

1108 
u64
 
	mrx_de¸y±_îr
;

1109 
u64
 
	mrx_du∂_‰ame
;

1111 
u64
 
	mtkù_loˇl_mic_Áû
;

1112 
u64
 
	mtkù_˙ãr_mósuªs_övoked
;

1113 
u64
 
	mtkù_ª∂ays
;

1114 
u64
 
	mtkù_fmt_îr
;

1115 
u64
 
	mccmp_fmt_îr
;

1116 
u64
 
	mccmp_ª∂ays
;

1118 
u64
 
	mpwr_ßve_Áû_˙t
;

1120 
u64
 
	mcs_bmiss_˙t
;

1121 
u64
 
	mcs_low_rssi_˙t
;

1122 
u64
 
	mcs_c⁄√˘_˙t
;

1123 
u64
 
	mcs_disc⁄_˙t
;

1125 
s32
 
	mtx_uˇ°_øã
;

1126 
s8
 
	mtx_øã_ödex
;

1127 
s32
 
	mrx_uˇ°_øã
;

1129 
u32
 
	mlq_vÆ
;

1131 
u32
 
	mwow_pkt_dr›≥d
;

1132 
u16
 
	mwow_evt_disˇrded
;

1134 
s16
 
	mnoi£_Êo‹_ˇlib
;

1135 
s16
 
	mcs_rssi
;

1136 
s16
 
	mcs_ave_bóc⁄_rssi
;

1137 
u8
 
	mcs_ave_bóc⁄_¢r
;

1138 
u8
 
	mcs_œ°_rﬂm_m£c
;

1139 
u8
 
	mcs_¢r
;

1141 
u8
 
	mwow_ho°_pkt_wakeups
;

1142 
u8
 
	mwow_ho°_evt_wakeups
;

1144 
u32
 
	m¨p_ª˚ived
;

1145 
u32
 
	m¨p_m©ched
;

1146 
u32
 
	m¨p_ª∂õd
;

1148 
timevÆ
 
	mupd©e_time
;

1151 
	s©h6kl_mbox_öfo
 {

1152 
u32
 
	mhtc_addr
;

1153 
u32
 
	mhtc_ext_addr
;

1154 
u32
 
	mhtc_ext_sz
;

1156 
u32
 
	mblock_size
;

1158 
u32
 
	mgmbox_addr
;

1160 
u32
 
	mgmbox_sz
;

1163 
	e©h6kl_hw_Êags
 {

1164 
	mATH6KL_HW_TGT_ALIGN_PADDING
 = 
BIT
(0),

1165 
	mATH6KL_HW_SINGLE_PIPE_SCHED
 = 
BIT
(1),

1166 
	mATH6KL_HW_FIRMWARE_EXT_SUPPORT
 = 
BIT
(2),

1167 
	mATH6KL_HW_USB_FLOWCTRL
 = 
BIT
(3),

1168 
	mATH6KL_HW_XTAL_40MHZ
 = 
BIT
(4),

1179 
	#ATH6KL_KEYBUF_SIZE
 16

	)

1180 
	#ATH6KL_MICBUF_SIZE
 (8+8Ë

	)

1182 
	#ATH6KL_KEY_XMIT
 0x01

	)

1183 
	#ATH6KL_KEY_RECV
 0x02

	)

1184 
	#ATH6KL_KEY_DEFAULT
 0x80

	)

1187 
	s©h6kl_ªq_key
 {

1188 
boﬁ
 
	mvÆid
;

1189 
u8
 
	mkey_ödex
;

1190 
	mkey_ty≥
;

1191 
u8
 
	mkey
[
WLAN_MAX_KEY_LEN
];

1192 
u8
 
	mkey_Àn
;

1200 
	s©h6kl_btc€x
 {

1201 
u32
 
	ma˛_rﬁe
;

1202 
u32
 
	mªmŸe_lmp_vî
;

1203 
u32
 
	mbt_víd‹
;

1205 
	e©h6kl_hif_ty≥
 {

1206 
	mATH6KL_HIF_TYPE_SDIO
,

1207 
	mATH6KL_HIF_TYPE_USB
,

1210 
	e©h6kl_ch™_ty≥
 {

1211 
	mATH6KL_CHAN_TYPE_NONE
,

1212 
	mATH6KL_CHAN_TYPE_HT40PLUS
,

1213 
	mATH6KL_CHAN_TYPE_HT40MINUS
,

1214 
	mATH6KL_CHAN_TYPE_HT20
,

1217 
	esˇn_∂™_ty≥
 {

1218 
	mATH6KL_SCAN_PLAN_IN_ORDER
,

1219 
	mATH6KL_SCAN_PLAN_REVERSE_ORDER
,

1220 
	mATH6KL_SCAN_PLAN_HOST_ORDER
,

1223 
	s©h6kl_sˇn_∂™
 {

1224 
sˇn_∂™_ty≥
 
	mty≥
;

1225 
u8
 
	mnumCh™
;

1226 
u16
 
	mch™Li°
[64];

1233 
	#ATH6KL_VIF_MAX
 8

	)

1236 
	e©h6kl_vif_°©e
 {

1237 
	mCONNECTED
,

1238 
	mCONNECT_PEND
,

1239 
	mCONNECT_HANDSHAKE_PROTECT
,

1240 
	mFIRST_EAPOL_PENDSENT
,

1241 
	mWMM_ENABLED
,

1242 
	mNETQ_STOPPED
,

1243 
	mDTIM_EXPIRED
,

1244 
	mNETDEV_REGISTERED
,

1245 
	mCLEAR_BSSFILTER_ON_BEACON
,

1246 
	mDTIM_PERIOD_AVAIL
,

1247 
	mWLAN_ENABLED
,

1248 
	mSTATS_UPDATE_PEND
,

1249 
	mAMSDU_ENABLED
,

1250 
	mHOST_SLEEP_MODE_CMD_PROCESSED
,

1251 
	mROC_PEND
,

1252 
	mROC_ONGOING
,

1253 
	mROC_CANCEL_PEND
,

1254 
	mROC_WAIT_EVENT
,

1255 
	mDISCONNECT_PEND
,

1256 
	mPMKLIST_GET_PEND
,

1257 
	mPORT_STATUS_PEND
,

1258 
	mWLAN_WOW_ENABLE
,

1259 
	mSCANNING
,

1260 
	mSCANNING_WAIT
,

1261 
	mDORMANT
,

1262 
	mPS_STICK
,

1263 #ifde‡
ATHTST_SUPPORT


1264 
	mCE_WMI_UPDATE
,

1265 
	mCE_WMI_SCAN
,

1266 
	mCE_WMI_TESTMODE_RX
,

1267 
	mCE_WMI_TESTMODE_GET
,

1270 #ifde‡
ATHTST_SUPPORT


1272 
	s©hr_cmd
 {

1273 
	mcmd
;

1274 
	md©a
[4];

1275 
	mli°
[16];

1278 
	#ATHR_WLAN_SCAN_BAND
 1

	)

1279 
	#ATHR_WLAN_FIND_BEST_CHANNEL
 2

	)

1280 
	#ATHR_WLAN_ACS_LIST
 3

	)

1282 
	#ATHR_CMD_SCANBAND_ALL
 0

	)

1283 
	#ATHR_CMD_SCANBAND_2G
 1

	)

1284 
	#ATHR_CMD_SCANBAND_5G
 2

	)

1285 
	#ATHR_CMD_SCANBAND_CHAN_ONLY
 3

	)

1287 
	#ATHR_CMD_ACS_2G_LIST
 1

	)

1288 
	#ATHR_CMD_ACS_5G_LIST
 2

	)

1291 #ifde‡
ACL_SUPPORT


1292 
	#AP_ACL_SIZE
 10

	)

1293 
	#ATH_MAC_LEN
 6

	)

1295 
	sWMI_AP_ACL
 {

1296 
u16
 
	mödex
;

1297 
u8
 
	ma˛_mac
[
AP_ACL_SIZE
][
ATH_MAC_LEN
];

1298 
u8
 
	mwûdˇrd
[
AP_ACL_SIZE
];

1299 
u8
 
	mpﬁicy
;

1303 
	sbss_öfo_íåy
 {

1304 
li°_hód
 
	mli°
;

1306 
s32
 
	msig«l
;

1307 
õì80211_ch™√l
 *
	mch™√l
;

1308 
õì80211_mgmt
 *
	mmgmt
;

1309 
size_t
 
	mÀn
;

1312 
	#ATH6KL_BSS_POST_PROC_SCAN_ONGOING
 (1 << 0)

	)

1314 
	sbss_po°_¥oc
 {

1315 
©h6kl_vif
 *
	mvif
;

1316 
u32
 
	mÊags
;

1317 
•ölock_t
 
	mbss_öfo_lock
;

1318 
li°_hód
 
	mbss_öfo_li°
;

1321 
	s©h6kl_vif
 {

1322 
li°_hód
 
	mli°
;

1323 
wúñess_dev
 
	mwdev
;

1324 
√t_devi˚
 *
	mndev
;

1325 
©h6kl
 *
	m¨
;

1327 
•ölock_t
 
	mif_lock
;

1328 
u8
 
	mfw_vif_idx
;

1329 
	mÊags
;

1330 
	mssid_Àn
;

1331 
u8
 
	mssid
[
IEEE80211_MAX_SSID_LEN
];

1332 
u8
 
	mdŸ11_auth_mode
;

1333 
u8
 
	mauth_mode
;

1334 
u8
 
	m¥wi£_¸y±o
;

1335 
u8
 
	m¥wi£_¸y±o_Àn
;

1336 
u8
 
	mgΩ_¸y±o
;

1337 
u8
 
	mgΩ_¸y±o_Àn
;

1338 
u8
 
	mdef_txkey_ödex
;

1339 
u8
 
	m√xt_mode
;

1340 
u8
 
	mnw_ty≥
;

1341 
u8
 
	mbssid
[
ETH_ALEN
];

1342 
u8
 
	mªq_bssid
[
ETH_ALEN
];

1343 
u16
 
	mch_höt
;

1344 
u16
 
	mbss_ch
;

1345 
©h6kl_phy_mode
 
	mphymode
;

1346 
©h6kl_ch™_ty≥
 
	mch™_ty≥
;

1347 
©h6kl_wï_key
 
	mwï_key_li°
[
WMI_MAX_KEY_INDEX
 + 1];

1348 #ifde‡
PMF_SUPPORT


1349 
©h6kl_key
 
	mkeys
[
WMI_MAX_IGTK_INDEX
 + 1];

1351 
©h6kl_key
 
	mkeys
[
WMI_MAX_KEY_INDEX
 + 1];

1353 
aggr_öfo
 *
	maggr_˙txt
;

1354 
timî_li°
 
	mdisc⁄√˘_timî
;

1355 
u32
 
	mc⁄√˘_˘æ_Êags
;

1356 
u8
 
	mu§_bss_fûãr
;

1357 
cfg80211_sˇn_ªque°
 *
	msˇn_ªq
;

1358 
timî_li°
 
	mvifsˇn_timî
;

1359 
timî_li°
 
	msh¥Ÿe˘_timî
;

1360 
sme_°©e
 
	msme_°©e
;

1361 
u8
 
	möåa_bss
;

1362 
u8
 
	m≠_≠sd
;

1363 
wmi_≠_mode_°©
 
	m≠_°©s
;

1364 
	mœ°_dump_≠_°©s_idx
;

1365 
u8
 
	m≠_cou¡ry_code
[3];

1366 
	m°a_no_ht_num
;

1367 
©h6kl_°a
 
	m°a_li°
[
AP_MAX_NUM_STA
];

1368 
u16
 
	m°a_li°_ödex
;

1369 
©h6kl_ªq_key
 
	m≠_mode_bkey
;

1370 
©h6kl_ps_buf_hód
 
	mpsq_mˇ°
;

1371 
•ölock_t
 
	mpsq_mˇ°_lock
;

1372 
	mªc⁄√˘_Êag
;

1373 
u32
 
	mœ°_roc_id
;

1374 
õì80211_ch™√l
 *
	mœ°_roc_ch™√l
;

1375 
	mœ°_roc_duøti⁄
;

1376 
u32
 
	mœ°_ˇn˚l_roc_id
;

1377 
u32
 
	m£nd_a˘i⁄_id
;

1378 
boﬁ
 
	m¥obe_ªq_ªp‹t
;

1379 #ifde‡
CE_SUPPORT


1380 
boﬁ
 
	m¥obe_ª•_ªp‹t
;

1382 
u16
 
	m√xt_ch™
;

1383 
©h6kl_ch™_ty≥
 
	m√xt_ch™_ty≥
;

1384 
u16
 
	massoc_bss_bóc⁄_öt
;

1385 
u8
 
	massoc_bss_dtim_≥riod
;

1386 
√t_devi˚_°©s
 
	m√t_°©s
;

1387 
èrgë_°©s
 
	mèrgë_°©s
;

1388 
htc€x
 *
	mhtc€x_˘x
;

1389 
wmi_sˇn_∑øms_cmd
 
	msc_∑øms
;

1390 
wmi_sˇn_∑øms_cmd
 
	msc_∑øms_deÁu…
;

1391 
u8
 
	mpmkid_li°_buf
[
MAX_PMKID_LIST_SIZE
];

1392 
u16
 
	mœ°_r¢_ˇp
;

1393 #ifde‡
ATH6KL_DIAGNOSTIC


1394 
wifi_düg
 
	mdüg
;

1396 
p2p_ps_öfo
 *
	mp2p_ps_öfo_˘x
;

1397 
sˇnb™d_ty≥
 
	msˇnb™d_ty≥
;

1398 
u32
 
	msˇnb™d_ch™
;

1399 
u16
 
	msˇnb™d_ign‹e_ch™
[64];

1400 
©h6kl_sˇn_∂™
 
	msˇn_∂™
;

1401 
≠_kì∑live_öfo
 *
	m≠_kì∑live_˘x
;

1402 
≠_a˛_öfo
 *
	m≠_a˛_˘x
;

1403 
≠_admc_öfo
 *
	m≠_admc_˘x
;

1404 
timî_li°
 
	msche_sˇn_timî
;

1405 
	msche_sˇn_öãrvÆ
;

1407 
u8
 
	mœ°_pwr_mode
;

1408 
u8
 
	mßved_pwr_mode
;

1409 
u8
 
	m¨p_ofÊﬂd_ù_£t
;

1410 
u32
 
	m¨p_ofÊﬂd_ù
;

1411 
dñayed_w‹k
 
	mw‹k_ópﬁ_£nd
;

1412 
sk_buff
 *
	m≥nd_skb
;

1413 
•ölock_t
 
	m≥nd_skb_lock
;

1415 
	m√eded_hódroom
;

1416 #ifde‡
CE_SUPPORT


1417 
u8
 
	msˇn_b™d
;

1418 
u32
 
	msˇn_ch™
;

1420 
u8
 
	mp2p_acs_2g_li°
[16];

1421 
u8
 
	mp2p_acs_5g_li°
[16];

1424 #ifde‡
ACL_SUPPORT


1425 
WMI_AP_ACL
 
	ma˛_db
;

1428 #ifde‡
ACS_SUPPORT


1429 
acs
 *
	macs_˘x
;

1430 
	mbe°_ch™
[4];

1432 
wmi_™t_div_°©
 
	m™t_div_°©
;

1433 
wmi_™i_°©
 
	m™i_°©
;

1434 
u8
 
	m™i_íabÀ
;

1435 
u8
 
	m™i_pﬁl˙t
;

1437 
dñayed_w‹k
 
	mw‹k_≥ndög_c⁄√˘
;

1438 
p2p_≥ndög_c⁄√˘_öfo
 *
	m≥ndög_c⁄√˘_öfo
;

1440 
bss_po°_¥oc
 *
	mbss_po°_¥oc_˘x
;

1441 
u32
 
	md©a_cookõ_cou¡
;

1443 
≠_rc_öfo
 
	m≠_rc_öfo_˘x
;

1446 
	#WOW_LIST_ID
 0

	)

1447 
	#WOW_HOST_REQ_DELAY
 5000

	)

1450 
	e©h6kl_dev_°©e
 {

1451 
	mWMI_ENABLED
,

1452 
	mWMI_READY
,

1453 
	mWMI_CTRL_EP_FULL
,

1454 
	mTESTMODE
,

1455 
	mTESTMODE_EPPING
,

1456 
	mDESTROY_IN_PROGRESS
,

1457 
	mSKIP_SCAN
,

1458 
	mROAM_TBL_PEND
,

1459 
	mFIRST_BOOT
,

1460 
	mUSB_REMOTE_WKUP
,

1461 
	mINIT_DEFER_PROGRESS
,

1462 
	mDOWNLOAD_FIRMWARE_EXT
,

1463 
	mMCC_ENABLED
,

1464 
	mSKIP_FLOWCTRL_EVENT
,

1465 
	mDISABLE_SCAN
,

1466 
	mINTERNAL_REGDB
,

1467 
	mEAPOL_HANDSHAKE_PROTECT
,

1468 
	mREG_COUNTRY_UPDATE
,

1469 
	mCFG80211_REGDB
,

1472 
	e©h6kl_°©e
 {

1473 
	mATH6KL_STATE_OFF
,

1474 
	mATH6KL_STATE_ON
,

1475 
	mATH6KL_STATE_DEEPSLEEP
,

1476 
	mATH6KL_STATE_CUTPOWER
,

1477 
	mATH6KL_STATE_WOW
,

1478 
	mATH6KL_STATE_PRE_SUSPEND
,

1479 
	mATH6KL_STATE_PRE_SUSPEND_DEEPSLEEP
,

1482 
	#ATH6KL_VAPMODE_MASK
 (0xfË

	)

1483 
	#ATH6KL_VAPMODE_OFFSET
 (4)

	)

1485 
	e©h6kl_v≠_mode
 {

1486 
	mATH6KL_VAPMODE_DISABLED
 = 0x0,

1487 
	mATH6KL_VAPMODE_STA
,

1488 
	mATH6KL_VAPMODE_AP
,

1491 
	mATH6KL_VAPMODE_ADHOC
,

1492 
	mATH6KL_VAPMODE_WDS
,

1493 
	mATH6KL_VAPMODE_P2PDEV
,

1494 
	mATH6KL_VAPMODE_P2P
,

1496 
	mATH6KL_VAPMODE_LAST
 = 0xf,

1500 #ifde‡
USB_AUTO_SUSPEND


1502 
	susb_pm_skb_queue_t
 {

1503 
li°_hód
 
	mli°
;

1504 
sk_buff
 *
	mskb
;

1505 
	mpùeID
;

1506 
©h6kl
 *
	m¨
;

1511 
	s©h6kl
 {

1512 
devi˚
 *
	mdev
;

1513 
wùhy
 *
	mwùhy
;

1515 
•ölock_t
 
	m°©e_lock
;

1516 
©h6kl_°©e
 
	m°©e
;

1517 
	mã°mode
;

1519 
	m°¨vög_¥evíti⁄
;

1521 
©h6kl_bmi
 
	mbmi
;

1522 c⁄° 
©h6kl_hif_›s
 *
	mhif_›s
;

1523 c⁄° 
©h6kl_htc_›s
 *
	mhtc_›s
;

1524 
wmi
 *
	mwmi
;

1525 
	mtx_≥ndög
[
ENDPOINT_MAX
];

1526 
	mtŸÆ_tx_d©a_≥nd
;

1527 
htc_èrgë
 *
	mhtc_èrgë
;

1528 
©h6kl_hif_ty≥
 
	mhif_ty≥
;

1529 *
	mhif_¥iv
;

1530 
li°_hód
 
	mvif_li°
;

1532 
•ölock_t
 
	mli°_lock
;

1533 
u8
 
	mnum_vif
;

1534 
	mvif_max
;

1535 
u8
 
	mmax_n‹m_iÁ˚
;

1536 
u8
 
	mavaû_idx_m≠
;

1537 
©h6kl_v≠_mode
 
	m√xt_mode
[
ATH6KL_VIF_MAX
];

1538 
•ölock_t
 
	mlock
;

1539 
£m≠h‹e
 
	m£m
;

1540 
£m≠h‹e
 
	mwmi_evt_£m
;

1541 
u16
 
	mli°í_ötvl_b
;

1542 
u16
 
	mli°í_ötvl_t
;

1543 
low_rssi_sˇn_∑øms
 
	mlow_rssi_rﬂm_∑øms
;

1544 
©h6kl_vîsi⁄
 
	mvîsi⁄
;

1545 
u32
 
	mèrgë_ty≥
;

1546 
u32
 
	mèrgë_subty≥
;

1547 
u8
 
	mtx_pwr
;

1548 
©h6kl_node_m≠pög
 
	mnode_m≠
[
MAX_NODE_NUM
];

1549 
u8
 
	mibss_ps_íabÀ
;

1550 
boﬁ
 
	mibss_if_a˘ive
;

1551 
u8
 
	mnode_num
;

1552 
u8
 
	m√xt_ï_id
;

1553 
©h6kl_cookõ_poﬁ
 
	mcookõ_d©a
;

1554 
©h6kl_cookõ_poﬁ
 
	mcookõ_˘æ
;

1555 
htc_ídpoöt_id
 
	mac2ï_m≠
[
WMM_NUM_AC
];

1556 
boﬁ
 
	mac_°ªam_a˘ive
[
WMM_NUM_AC
];

1557 
u8
 
	mac_°ªam_¥i_m≠
[
WMM_NUM_AC
];

1558 
u8
 
	mhüc_°ªam_a˘ive_¥i
;

1559 
u8
 
	mac_°ªam_a˘ive_num
;

1560 
u8
 
	mï2ac_m≠
[
ENDPOINT_MAX
];

1561 
htc_ídpoöt_id
 
	m˘æ_ï
;

1562 
©h6kl_htc_¸edô_öfo
 
	m¸edô_°©e_öfo
;

1563 
u32
 
	mu£r_key_˘æ
;

1564 
li°_hód
 
	mamsdu_rx_buf„r_queue
;

1565 
u8
 
	mrx_mëa_vî
;

1566 
wœn_low_pwr_°©e
 
	mwœn_pwr_°©e
;

1567 
u8
 
	mmac_addr
[
ETH_ALEN
];

1568 
	#AR_MCAST_FILTER_MAC_ADDR_SIZE
 4

	)

1570 *
	mrx_ªp‹t
;

1571 
size_t
 
	mrx_ªp‹t_Àn
;

1572 } 
	mtm
;

1574 
	s©h6kl_hw
 {

1575 
u32
 
	mid
;

1576 c⁄° *
	m«me
;

1577 
u32
 
	md©a£t_∑tch_addr
;

1578 
u32
 
	m≠p_lﬂd_addr
;

1579 
u32
 
	m≠p_°¨t_ovîride_addr
;

1580 
u32
 
	m≠p_lﬂd_ext_addr
;

1581 
u32
 
	mbﬂrd_ext_d©a_addr
;

1582 
u32
 
	mª£rved_øm_size
;

1583 
u32
 
	mbﬂrd_addr
;

1584 
u32
 
	mã°s¸ùt_addr
;

1585 
u32
 
	mÊags
;

1587 
	s©h6kl_hw_fw
 {

1588 c⁄° *
	mdú
;

1589 c⁄° *
	mŸp
;

1590 c⁄° *
	mfw
;

1591 c⁄° *
	mtcmd
;

1592 c⁄° *
	m∑tch
;

1593 c⁄° *
	m≠i2
;

1594 c⁄° *
	mutf
;

1595 c⁄° *
	mã°s¸ùt
;

1596 c⁄° *
	mfw_ext
;

1597 } 
	mfw
;

1599 c⁄° *
	mfw_bﬂrd
;

1600 c⁄° *
	mfw_deÁu…_bﬂrd
;

1601 c⁄° *
	mfw_ïpög
;

1602 c⁄° *
	mfw_so·mac
;

1603 c⁄° *
	mfw_so·mac_2
;

1604 } 
	mhw
;

1606 
u16
 
	mc⁄f_Êags
;

1607 
waô_queue_hód_t
 
	mevít_wq
;

1608 
©h6kl_mbox_öfo
 
	mmbox_öfo
;

1610 
	mÊag
;

1612 
u8
 *
	mfw_bﬂrd
;

1613 
size_t
 
	mfw_bﬂrd_Àn
;

1615 
u8
 *
	mfw_Ÿp
;

1616 
size_t
 
	mfw_Ÿp_Àn
;

1618 
u8
 *
	mfw
;

1619 
size_t
 
	mfw_Àn
;

1621 
u8
 *
	mfw_∑tch
;

1622 
size_t
 
	mfw_∑tch_Àn
;

1624 
u8
 *
	mfw_ã°s¸ùt
;

1625 
size_t
 
	mfw_ã°s¸ùt_Àn
;

1627 
u8
 *
	mfw_so·mac
;

1628 
size_t
 
	mfw_so·mac_Àn
;

1630 
u8
 *
	mfw_so·mac_2
;

1631 
size_t
 
	mfw_so·mac_2_Àn
;

1633 
u8
 *
	mfw_ext
;

1634 
size_t
 
	mfw_ext_Àn
;

1636 
	mfw_ˇ∑bûôõs
[
ATH6KL_CAPABILITY_LEN
];

1638 
w‹kqueue_°ru˘
 *
	m©h6kl_wq
;

1640 
díåy
 *
	mdebugfs_phy
;

1643 
boﬁ
 
	mp2p
;

1646 
boﬁ
 
	mp2p_c⁄cuºít
;

1649 
boﬁ
 
	mp2p_mu…ich™_c⁄cuºít
;

1652 
boﬁ
 
	mp2p_dediˇã
;

1655 
boﬁ
 
	mp2p_com∑t
;

1662 
	#IS_STA_AP_ONLY
(
_¨
) \

1663 ((
_¨
)->
p2p_c⁄cuºít_≠
 && ((_¨)->
vif_max
 < 
TARGET_VIF_MAX
))

	)

1666 
boﬁ
 
	mp2p_c⁄cuºít_≠
;

1669 
boﬁ
 
	mp2p_‰ame_ªåy
;

1672 
boﬁ
 
	mp2p_‰ame_nŸ_ªp‹t
;

1675 
boﬁ
 
	mp2p_ö_∑sv_ch™
;

1678 
boﬁ
 
	mp2p_wi£_sˇn
;

1681 
boﬁ
 
	mp2p_w¨_bad_öãl_go
;

1684 
boﬁ
 
	mp2p_w¨_bad_brﬂdcom_go
;

1687 
boﬁ
 
	mp2p_w¨_p2p_˛õ¡_awake
;

1690 
	#P2P_IE_IN_PROBE_REQ
 (1 << 0)

	)

1691 
	#P2P_IE_IN_ASSOC_REQ
 (1 << 1)

	)

1692 
u8
 
	mp2p_õ_nŸ_≠≥nd
;

1694 
boﬁ
 
	msche_sˇn
;

1696 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


1698 
boﬁ
 
	mktk_a˘ive
;

1701 
u8
 
	mktk_∑s•hø£
[16];

1704 #ifde‡
ATH6KL_SUPPORT_WIFI_DISC


1706 
boﬁ
 
	mdisc_a˘ive
;

1709 
©h6kl_btc€x
 
	mbtc€x_öfo
;

1710 
u32
 
	mmod_debug_quúks
;

1712 #ifde‡
CONFIG_ATH6KL_DEBUG


1714 
sk_buff_hód
 
	mfwlog_queue
;

1715 
com∂ëi⁄
 
	mfwlog_com∂ëi⁄
;

1716 
boﬁ
 
	mfwlog_›í
;

1717 
u32
 
	mfwlog_mask
;

1718 
	mdbgfs_düg_ªg
;

1719 
u32
 
	mdüg_ªg_addr_wr
;

1720 
u32
 
	mdüg_ªg_vÆ_wr
;

1721 
u64
 
	m£t_tx_£rõs
;

1724 
	mövÆid_øã
;

1725 } 
	mw¨_°©s
;

1727 
u8
 *
	mrﬂm_tbl
;

1728 
	mrﬂm_tbl_Àn
;

1730 
u8
 
	mkì∑live
;

1731 
u8
 
	mdisc_timeout
;

1732 
u8
 
	mmimo_ps_íabÀ
;

1733 
u8
 
	mf‹˚_∑ssive
;

1734 
u16
 
	mbgsˇn_öt
;

1735 
wmi_rﬂm_mode
 
	mrﬂm_mode
;

1736 
	#ROAM_NULL_5G_BIAS
 (255)

	)

1737 
u8
 
	mrﬂm_5g_büs
;

1739 
	ssmps_∑øm
 {

1740 
u8
 
	mÊags
;

1741 
u8
 
	mrssi_thªsh
;

1742 
u8
 
	md©a_thªsh
;

1743 
u8
 
	mmode
;

1744 
u8
 
	mautom©ic
;

1745 } 
	msmps_∑øms
;

1747 
	sÕl_f‹˚_íabÀ_∑øm
 {

1748 
u8
 
	mÕl_pﬁicy
;

1749 
u8
 
	mno_blockî_dëe˘
;

1750 
u8
 
	mno_rfb_dëe˘
;

1751 
u8
 
	mrsvd
;

1752 } 
	mÕl_f‹˚_íabÀ_∑øms
;

1754 
	spowî_∑øm
 {

1755 
u16
 
	midÀ_≥riod
;

1756 
u16
 
	mps_pﬁl_num
;

1757 
u16
 
	mdtim
;

1758 
u16
 
	mtx_wakeup
;

1759 
u16
 
	mnum_tx
;

1760 } 
	mpowî_∑øms
;

1762 
	sht_ˇp_∑øm
 {

1763 
u8
 
	misC⁄fig
;

1764 
u8
 
	mb™d
;

1765 
u8
 
	mch™_width_40M_suµ‹ãd
;

1766 
u8
 
	msh‹t_GI
;

1767 
u8
 
	mötﬁî™˚_40MHz
;

1768 } 
	mht_ˇp_∑øm
[
IEEE80211_NUM_BANDS
];

1770 
u8
 
	m™i°©_íabÀ
;

1771 } 
	mdebug
;

1774 
	mwow_úq
;

1775 #ifde‡
CONFIG_ANDROID


1776 #ifde‡
CONFIG_HAS_WAKELOCK


1777 
wake_lock
 
	mwake_lock
;

1780 
©h6kl_p2p_Êow˘æ
 *
	mp2p_Êow˘æ_˘x
;

1781 
©h6kl_p2p_rc_öfo
 *
	mp2p_rc_öfo_˘x
;

1782 #ifde‡
CONFIG_HAS_EARLYSUSPEND


1783 
óæy_su•íd
 
	móæy_su•íd
;

1786 
	#INIT_DEFER_WAIT_TIMEOUT
 (5 * 
HZ
)

	)

1787 
w‹k_°ru˘
 
	möô_de„r_wk
;

1788 
waô_queue_hód_t
 
	möô_de„r_waô_wq
;

1790 
u32
 
	mtx_⁄_vif
;

1792 
ªg_öfo
 *
	mªg_˘x
;

1794 (*
	mfw_¸ash_nŸify
)(
©h6kl
 *
	m¨
);

1796 
u32
 
	mrﬂm_mode
;

1797 
u32
 
	mboŸ°øp_mode
;

1798 #ifde‡
USB_AUTO_SUSPEND


1799 
usb_pm_skb_queue_t
 
	musb_pm_skb_queue
;

1800 
•ölock_t
 
	musb_pm_lock
;

1801 
	musb_aut›m_sˇn
;

1802 
	mauto_pm_˙t
;

1805 
wmi_gªí_tx_∑øms
 
	mgªí_tx_∑øms
;

1807 
timî_li°
 
	mópﬁ_sh¥Ÿe˘_timî
;

1808 
u32
 
	mópﬁ_sh¥Ÿe˘_vif
;

1811 
u8
 
	mdtim_ext
;

1814 
boﬁ
 
	mgë_wow_∑âîn
;

1817 
ölöe
 *
	$©h6kl_¥iv
(
√t_devi˚
 *
dev
)

1819  ((
©h6kl_vif
 *Ë
	`√tdev_¥iv
(
dev
))->
¨
;

1820 
	}
}

1822 
ölöe
 
u32
 
	$©h6kl_gë_hi_ôem_addr
(
©h6kl
 *
¨
,

1823 
u32
 
ôem_off£t
)

1825 
u32
 
addr
 = 0;

1827 i‡(
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6003
)

1828 
addr
 = 
ATH6KL_AR6003_HI_START_ADDR
 + 
ôem_off£t
;

1829 i‡(
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6004
)

1830 
addr
 = 
ATH6KL_AR6004_HI_START_ADDR
 + 
ôem_off£t
;

1831 i‡(
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6006
)

1832 
addr
 = 
ATH6KL_AR6006_HI_START_ADDR
 + 
ôem_off£t
;

1834  
addr
;

1835 
	}
}

1837 
ölöe
 
u32
 
	$©h6kl_ps_queue_gë_age
(
©h6kl_ps_buf_desc
 *
ps_buf
)

1839  
ps_buf
->
age
;

1840 
	}
}

1842 
ölöe
 
	$©h6kl_ps_queue_£t_age
(
©h6kl_ps_buf_desc
 *
ps_buf
,

1843 
u32
 
age
)

1845 
ps_buf
->
age
 =áge;

1846 
	}
}

1848 
ölöe
 
	$©h6kl_fw_¸ash_å≠
(
©h6kl
 *
¨
)

1851 i‡(
¨
->
fw_¸ash_nŸify
)

1852 
¨
->
	`fw_¸ash_nŸify
(ar);

1853 
	}
}

1855 
ölöe
 
boﬁ
 
	$©h6kl_is_p2p_õ
(c⁄° 
u8
 *
pos
)

1857  
pos
[0] =
WLAN_EID_VENDOR_SPECIFIC
 &&Öos[1] >= 4 &&

1858 
pos
[2] == 0x50 &&Öos[3] == 0x6f &&

1859 
pos
[4] == 0x9a &&Öos[5] == 0x09;

1860 
	}
}

1862 
ölöe
 
boﬁ
 
	$©h6kl_is_wfd_õ
(c⁄° 
u8
 *
pos
)

1864  
pos
[0] =
WLAN_EID_VENDOR_SPECIFIC
 &&Öos[1] >= 4 &&

1865 
pos
[2] == 0x50 &&Öos[3] == 0x6f &&

1866 
pos
[4] == 0x9a &&Öos[5] == 0x0a;

1867 
	}
}

1869 
ölöe
 
cfg80211_bss
 *
	$©h6kl_bss_gë
(
©h6kl
 *
¨
,

1870 
õì80211_ch™√l
 *
ch™√l
,

1871 c⁄° 
u8
 *
bssid
,

1872 c⁄° 
u8
 *
ssid
, 
size_t
 
ssid_Àn
,

1873 
u16
 
ˇ∑_mask
, u16 
ˇ∑_vÆ
)

1875  
	`cfg80211_gë_bss
(
¨
->
wùhy
,

1876 
ch™√l
,

1877 
bssid
,

1878 
ssid
,

1879 
ssid_Àn
,

1880 
ˇ∑_mask
,

1881 
ˇ∑_vÆ
);

1882 
	}
}

1884 
ölöe
 
	$©h6kl_bss_put
(
©h6kl
 *
¨
, 
cfg80211_bss
 *
pub
)

1886 #ifde‡
CFG80211_NEW_REF_BSS_OPER


1887 
	`cfg80211_put_bss
(
¨
->
wùhy
, 
pub
);

1889 
	`cfg80211_put_bss
(
pub
);

1891 
	}
}

1893 
©h6kl_c⁄figuª_èrgë
(
©h6kl
 *
¨
);

1894 
©h6kl_dëe˘_îr‹
(
±r
);

1895 
disc⁄√˘_timî_h™dÀr
(
±r
);

1896 
öô_√tdev
(
√t_devi˚
 *
dev
);

1897 
©h6kl_cookõ_öô
(
©h6kl
 *
¨
);

1898 
©h6kl_cookõ_˛ónup
(
©h6kl
 *
¨
);

1899 
©h6kl_rx
(
htc_èrgë
 *
èrgë
, 
htc_∑ckë
 *
∑ckë
);

1900 
©h6kl_tx_com∂ëe
(
htc_èrgë
 *
c⁄ãxt
,

1901 
li°_hód
 *
∑ckë_queue
);

1902 
htc_£nd_fuŒ_a˘i⁄
 
©h6kl_tx_queue_fuŒ
(
htc_èrgë
 *
èrgë
,

1903 
htc_∑ckë
 *
∑ckë
);

1904 
©h6kl_°›_txrx
(
©h6kl
 *
¨
);

1905 
©h6kl_˛ónup_amsdu_rxbufs
(
©h6kl
 *
¨
);

1906 
©h6kl_düg_wrôe32
(
©h6kl
 *
¨
, 
u32
 
addªss
, 
__À32
 
vÆue
);

1907 
©h6kl_düg_wrôe
(
©h6kl
 *
¨
, 
u32
 
addªss
, *
d©a
, u32 
Àngth
);

1908 
©h6kl_düg_ªad32
(
©h6kl
 *
¨
, 
u32
 
addªss
, u32 *
vÆue
);

1909 
©h6kl_düg_ªad
(
©h6kl
 *
¨
, 
u32
 
addªss
, *
d©a
, u32 
Àngth
);

1910 
©h6kl_ªad_fwlogs
(
©h6kl
 *
¨
);

1911 
©h6kl_öô_¥ofûe_öfo
(
©h6kl_vif
 *
vif
);

1912 
©h6kl_tx_d©a_˛ónup
(
©h6kl
 *
¨
);

1913 
©h6kl_tx_d©a_˛ónup_by_if
(
©h6kl_vif
 *
vif
);

1915 
©h6kl_cookõ
 *
©h6kl_Æloc_cookõ
(
©h6kl
 *
¨
,

1916 
cookõ_ty≥
 cookie_type);

1917 
©h6kl_‰ì_cookõ
(
©h6kl
 *
¨
, 
©h6kl_cookõ
 *
cookõ
);

1918 
boﬁ
 
©h6kl_mgmt_powîßve_≠
(
©h6kl_vif
 *
vif
, 
u32
 
id
, u32 
‰eq
,

1919 
u32
 
waô
, c⁄° 
u8
 *
buf
, 
size_t
 
Àn
, 
boﬁ
 
no_cck
,

1920 
boﬁ
 
d⁄t_waô_f‹_ack
, 
u32
 *
Êags
);

1921 
©h6kl_d©a_tx
(
sk_buff
 *
skb
, 
√t_devi˚
 *
dev
,

1922 
boﬁ
 
by∑ss_tx_aggr
);

1923 
©h6kl_°¨t_tx
(
sk_buff
 *
skb
, 
√t_devi˚
 *
dev
);

1925 
aggr_tx_c⁄fig
(
©h6kl_vif
 *
vif
,

1926 
boﬁ
 
tx_amsdu_£q_pkt
,

1927 
boﬁ
 
tx_amsdu_¥ogªssive
,

1928 
u8
 
tx_amsdu_max_aggr_num
,

1929 
u16
 
tx_amsdu_max_pdu_Àn
,

1930 
u16
 
tx_amsdu_timeout
);

1931 
aggr_c⁄fig
(
©h6kl_vif
 *
vif
,

1932 
u16
 
rx_aggr_timeout
);

1933 
aggr_öfo
 *
aggr_öô
(
©h6kl_vif
 *
vif
);

1934 
aggr_c⁄n_öfo
 *
aggr_öô_c⁄n
(
©h6kl_vif
 *
vif
);

1936 
©h6kl_rx_ªfûl
(
htc_èrgë
 *
èrgë
,

1937 
htc_ídpoöt_id
 
ídpoöt
);

1938 
©h6kl_ªfûl_amsdu_rxbufs
(
©h6kl
 *
¨
, 
cou¡
);

1939 
htc_∑ckë
 *
©h6kl_Æloc_amsdu_rxbuf
(
htc_èrgë
 *
èrgë
,

1940 
htc_ídpoöt_id
 
ídpoöt
,

1941 
Àn
);

1943 
aggr_moduÀ_de°roy
(
aggr_öfo
 *
aggr
);

1944 
aggr_moduÀ_de°roy_c⁄n
(
aggr_c⁄n_öfo
 *
aggr_c⁄n
);

1945 
aggr_ª£t_°©e
(
aggr_c⁄n_öfo
 *
aggr_c⁄n
);

1947 
©h6kl_°a
 *
©h6kl_föd_°a
(
©h6kl_vif
 *
vif
, 
u8
 * 
node_addr
);

1948 
©h6kl_°a
 *
©h6kl_föd_°a_by_aid
(
©h6kl_vif
 *
vif
, 
u8
 
aid
);

1950 
©h6kl_ªady_evít
(*
devt
, 
u8
 * 
d©≠
, 
u32
 
sw_vî
, u32 
abi_vî
);

1951 
©h6kl_c⁄åﬁ_tx
(*
devt
, 
sk_buff
 *
skb
,

1952 
htc_ídpoöt_id
 
eid
);

1953 
©h6kl_c⁄√˘_evít
(
©h6kl_vif
 *
vif
, 
u16
 
ch™√l
,

1954 
u8
 *
bssid
, 
u16
 
li°í_öt
,

1955 
u16
 
bóc⁄_öt
, 
√tw‹k_ty≥
 
√t_ty≥
,

1956 
u8
 
bóc⁄_õ_Àn
, u8 
assoc_ªq_Àn
,

1957 
u8
 
assoc_ª•_Àn
, u8 *
assoc_öfo
);

1958 
©h6kl_c⁄√˘_≠_mode_bss
(
©h6kl_vif
 *
vif
, 
u16
 
ch™√l
,

1959 
u8
 *
bóc⁄
, u8 
bóc⁄_Àn
);

1960 
©h6kl_c⁄√˘_≠_mode_°a
(
©h6kl_vif
 *
vif
, 
u8
 
aid
, u8 *
mac_addr
,

1961 
u8
 
keymgmt
, u8 
ucùhî
, u8 
auth
,

1962 
u16
 
assoc_ªq_Àn
, 
u8
 *
assoc_öfo
,

1963 
u8
 
≠sd_öfo
, u8 
phymode
);

1964 
©h6kl_disc⁄√˘_evít
(
©h6kl_vif
 *
vif
, 
u8
 
ªas⁄
,

1965 
u8
 *
bssid
, u8 
assoc_ª•_Àn
,

1966 
u8
 *
assoc_öfo
, 
u16
 
¥Ÿ_ªas⁄_°©us
);

1967 
©h6kl_tkù_mi˚º_evít
(
©h6kl_vif
 *
vif
, 
u8
 
keyid
, 
boﬁ
 
ismˇ°
);

1968 
©h6kl_txpwr_rx_evt
(*
devt
, 
u8
 
tx_pwr
);

1969 
©h6kl_sˇn_com∂ëe_evt
(
©h6kl_vif
 *
vif
, 
°©us
);

1970 
©h6kl_tgt_°©s_evít
(
©h6kl_vif
 *
vif
, 
u8
 *
±r
, 
u32
 
Àn
);

1971 
©h6kl_ödiˇã_tx_a˘ivôy
(*
devt
, 
u8
 
åaffic_˛ass
, 
boﬁ
 
a˘ive
);

1972 
htc_ídpoöt_id
 
©h6kl_ac2_ídpoöt_id
(*
devt
, 
u8
 
ac
);

1974 
©h6kl_p•ﬁl_evít
(
©h6kl_vif
 *
vif
, 
u8
 
aid
);

1976 
©h6kl_dtimexpúy_evít
(
©h6kl_vif
 *
vif
);

1977 
©h6kl_disc⁄√˘
(
©h6kl_vif
 *
vif
);

1978 
aggr_ªcv_dñba_ªq_evt
(
©h6kl_vif
 *
vif
, 
u8
 
tid
, u8 
öôüt‹
);

1979 
aggr_ªcv_addba_ªq_evt
(
©h6kl_vif
 *
vif
, 
u8
 
tid
, 
u16
 
£q_no
,

1980 
u8
 
wö_sz
);

1981 
aggr_ªcv_addba_ª•_evt
(
©h6kl_vif
 *
vif
, 
u8
 
tid
,

1982 
u16
 
amsdu_sz
, 
u8
 
°©us
);

1983 
©h6kl_wakeup_evít
(*
dev
);

1985 
©h6kl_ª£t_devi˚
(
©h6kl
 *
¨
, 
u32
 
èrgë_ty≥
,

1986 
boﬁ
 
waô_fŸ_com∂ä
, boﬁ 
cﬁd_ª£t
);

1987 
©h6kl_öô_c⁄åﬁ_öfo
(
©h6kl_vif
 *
vif
);

1988 
©h6kl_deöô_if_d©a
(
©h6kl_vif
 *
vif
);

1989 
©h6kl_c‹e_‰ì
(
©h6kl
 *
¨
);

1990 
©h6kl_vif
 *
©h6kl_vif_fú°
(
©h6kl
 *
¨
);

1991 
©h6kl_˛ónup_vif
(
©h6kl_vif
 *
vif
, 
boﬁ
 
wmi_ªady
);

1992 
©h6kl_öô_hw_°¨t
(
©h6kl
 *
¨
);

1993 
©h6kl_öô_hw_°›
(
©h6kl
 *
¨
);

1994 
©h6kl_check_wow_°©us
(
©h6kl
 *
¨
);

1995 
©h6kl_htc_pùe_©èch
(
©h6kl
 *
¨
);

1996 
©h6kl_htc_mbox_©èch
(
©h6kl
 *
¨
);

1998 
©h6kl_ps_queue_öô
(
©h6kl_ps_buf_hód
 *
psq
,

1999 
ps_queue_ty≥
 
queue_ty≥
,

2000 
u32
 
age_cy˛e
,

2001 
u32
 
max_dïth
);

2002 
©h6kl_ps_queue_purge
(
©h6kl_ps_buf_hód
 *
psq
);

2003 
©h6kl_ps_queue_em±y
(
©h6kl_ps_buf_hód
 *
psq
);

2004 
©h6kl_ps_queue_dïth
(
©h6kl_ps_buf_hód
 *
psq
);

2005 
©h6kl_ps_queue_°©
(
©h6kl_ps_buf_hód
 *
psq
, *
dïth
,

2006 
u32
 *
íqueued
, u32 *
íqueued_îr
, u32 *
dequeued
, u32 *
aged
);

2007 
©h6kl_ps_buf_desc
 *
©h6kl_ps_queue_dequeue
(

2008 
©h6kl_ps_buf_hód
 *
psq
);

2009 
©h6kl_ps_queue_íqueue_mgmt
(
©h6kl_ps_buf_hód
 *
psq
, c⁄° 
u8
 *
buf
,

2010 
u16
 
Àn
, 
u32
 
id
, u32 
‰eq
, u32 
waô
, 
boﬁ
 
no_cck
,

2011 
boﬁ
 
d⁄t_waô_f‹_ack
);

2012 
©h6kl_ps_queue_íqueue_d©a
(
©h6kl_ps_buf_hód
 *
psq
,

2013 
sk_buff
 *
skb
);

2014 
©h6kl_ps_queue_age_h™dÀr
(
±r
);

2015 
©h6kl_ps_queue_age_°¨t
(
©h6kl_°a
 *
c⁄n
);

2016 
©h6kl_ps_queue_age_°›
(
©h6kl_°a
 *
c⁄n
);

2018 
bss_po°_¥oc
 *
©h6kl_bss_po°_¥oc_öô
(
©h6kl_vif
 *
vif
);

2019 
©h6kl_bss_po°_¥oc_deöô
(
©h6kl_vif
 *
vif
);

2020 
©h6kl_bss_po°_¥oc_bss_sˇn_°¨t
(
©h6kl_vif
 *
vif
);

2021 
©h6kl_bss_po°_¥oc_bss_com∂ëe_evít
(
©h6kl_vif
 *
vif
);

2022 
©h6kl_bss_po°_¥oc_bss_öfo
(
©h6kl_vif
 *
vif
,

2023 
õì80211_mgmt
 *
mgmt
,

2024 
Àn
,

2025 
s32
 
¢r
,

2026 
õì80211_ch™√l
 *
ch™√l
);

2028 #ifde‡
CONFIG_ANDROID


2029 
©h6kl_sdio_öô_msm
();

2030 
©h6kl_sdio_exô_msm
();

2033 #ifde‡
ATH6KL_BUS_VOTE


2034 
©h6kl_hsic_öô_msm
(
u8
 *
has_vªg
);

2035 
©h6kl_hsic_exô_msm
();

2036 
©h6kl_hsic_böd
(
böd
);

2039 #ifde‡
ATH6KL_HSIC_RECOVER


2040 
©h6kl_hsic_ªdiscovîy
();

2043 
©h6kl_fw_¸ash_nŸify
(
©h6kl
 *
¨
);

2044 
©h6kl_ödiˇã_wmm_scheduÀ_ch™ge
(*
devt
, 
boﬁ
 
a˘ive
);

2045 
_°rög_to_mac
(*
°rög
, 
Àn
, 
u8
 *
maˇddr
);

2046 
©h6kl_Êush_≥nd_skb
(
©h6kl_vif
 *
vif
);

2048 #i‡ 
deföed
(
CONFIG_ANDROID
Ë|| deföed(
USB_AUTO_SUSPEND
)

2049 
©h6kl_™droid_íabÀ_wow_deÁu…
(
©h6kl
 *
¨
);

2050 
boﬁ
 
©h6kl_™droid_√ed_wow_su•íd
(
©h6kl
 *
¨
);

2053 #ifde‡
ATH6KL_SUPPORT_WLAN_HB


2054 
©h6kl_íabÀ_wow_hb
(
©h6kl
 *
¨
);

2057 
©h6kl_fw_w©chdog_íabÀ
(
©h6kl
 *
¨
);

2058 
©h6kl_fw_¸ash_cﬁd_ª£t_íabÀ
(
©h6kl
 *
¨
);

2060 
htc_bundÀ_ªcv
;

2061 
htc_bundÀ_£nd
;

2062 
htc_bundÀ_£nd_timî
;

2063 
htc_bundÀ_£nd_th
;

2064 #ifde‡
CE_SUPPORT


2065 
©h6kl_˚_Êags
;

2068 #ifde‡
CONFIG_ANDROID


2069 
©h6kl_bt_⁄
;

	@debug.c

17 
	~"c‹e.h
"

19 
	~<löux/skbuff.h
>

20 
	~<löux/fs.h
>

21 
	~<löux/vmÆloc.h
>

22 
	~<löux/exp‹t.h
>

24 
	~"debug.h
"

25 
	~"èrgë.h
"

26 
	~"wœn_loˇti⁄_defs.h
"

27 
	~"htc-›s.h
"

28 
	~"hif-›s.h
"

29 
	~"wmi.h
"

30 
	~<√t/iw_h™dÀr.h
>

32 
	s©h6kl_fwlog_¶Ÿ
 {

33 
__À32
 
	mtime°amp
;

34 
__À32
 
	mÀngth
;

37 
u8
 
	m∑ylﬂd
[0];

40 
	#SKIP_SPACE
 \

	)

41 *
	gp
 =' ' && *
p
 != '\0') \

42 
p
++;

44 
	#SEEK_SPACE
 \

	)

45 *
	gp
 !' ' && *
p
 != '\0') \

46 
p
++;

48 
	#ATH6KL_FWLOG_MAX_ENTRIES
 20

	)

49 
	#ATH6KL_FWLOG_VALID_MASK
 0x1ffff

	)

51 
	#ATH6KL_FWLOG_NUM_ARGS_OFFSET
 30

	)

52 
	#ATH6KL_FWLOG_NUM_ARGS_MASK
 0xC0000000

	)

53 
	#AT6HKL_FWLOG_NUM_ARGS_MAX
 2

	)

55 
	#ATH6KL_FWGLOG_GET_NUMARGS
(
¨g
Ë\

	)

56 ((
	g¨g
 & 
	gATH6KL_FWLOG_NUM_ARGS_MASK
Ë>> 
	gATH6KL_FWLOG_NUM_ARGS_OFFSET
)

58 
	$©h6kl_¥ötk
(c⁄° *
Àvñ
, c⁄° *
fmt
, ...)

60 
va_f‹m©
 
vaf
;

61 
va_li°
 
¨gs
;

62 
πn
;

64 
	`va_°¨t
(
¨gs
, 
fmt
);

66 
vaf
.
fmt
 = fmt;

67 
vaf
.
va
 = &
¨gs
;

69 
πn
 = 
	`¥ötk
(
KERN_INFO
 "%ßth6kl: %pV", 
Àvñ
, &
vaf
);

71 
	`va_íd
(
¨gs
);

73  
πn
;

74 
	}
}

82 
	$exåa˘_öt
(**
±r
)

84 
ªt_vÆ
 = -1;

85 
ødix
;

86 
ch
;

88 if((
±r
) && (*ptr))

91 (*(*
±r
)) && (*(*ptr) == ' '))

92 (*
±r
)++;

95 if(*(*
±r
))

98 
ødix
 = 10;

99 
ªt_vÆ
 = 0;

100 *(*
±r
))

104 
ch
 = *(*
±r
);

105 if(
ch
 == ' ')

109 if((
ch
 >= 0) && (ch <= '9'))

111 
ªt_vÆ
 = ()(‘ë_vÆ*
ødix
Ë+ (
ch
 & 0x0F));

112 (*
±r
)++;

118 if((
ødix
 =16Ë&& (((
ch
 >= 'a') && (ch <= 'f')) || ((ch >= 'A') && (ch <= 'F'))))

120 
ªt_vÆ
 = ()(‘ë_vÆ*
ødix
Ë+ ((
ch
+9) & 0x0F));

121 (*
±r
)++;

127 if((
ªt_vÆ
 =0Ë&& ((
ch
 == 'x') || (ch == 'X')))

129 
ødix
 = 16;

130 (*
±r
)++;

135 
ªt_vÆ
 = -1;

142 (
ªt_vÆ
);

143 
	}
}

145 
	$exåa˘_mac
(
u8
 *
buf
, u8 *
mac
)

147 
ªt
 = -1;

148 
vÆ
;

149 
nibbÀ
;

151 if((
buf
Ë&& (
mac
))

154 if((
buf
[0] == 'x') || (buf[0] == 'X'))

155 
buf
++;

156 if((
buf
[0] == '0') && ((buf[1] == 'x') || (buf[1] == 'X')))

157 
buf
 += 2;

159 
vÆ
 = 0;

160 
ªt
 = 0;

161 
nibbÀ
 = 0;

162 (*
buf
Ë&& (
ªt
 < 
ETH_ALEN
))

165 if(((*
buf
 >= '0') && (*buf <= '9')) ||

166 ((*
buf
 >= 'a') && (*buf <= 'f')) ||

167 ((*
buf
 >= 'A') && (*buf <= 'F')))

170 
vÆ
 <<= 4;

171 if(*
buf
 > '9')

172 
vÆ
 +(
u8
)((*
buf
 + 9) & 0x0F);

174 
vÆ
 +(*
buf
 & 0x0F);

176 
buf
++;

179 if(++
nibbÀ
 == 2)

181 
mac
[
ªt
++] = 
vÆ
;

182 
vÆ
 = 0;

183 
nibbÀ
 = 0;

186 if((*
buf
 == ':') || (*buf == '.') || (*buf == '-'))

187 
buf
++;

195 (
ªt
);

196 
	}
}

198 
	#EVENT_ID_LEN
 2

	)

199 
	#INTF_ID_LEN
 1

	)

201 
	$©h6kl_£nd_gíevít_to_≠p
(
√t_devi˚
 *
dev
,

202 
u16
 
evít_id
, 
u8
 
ifid
,

203 
u8
 *
d©≠
, 
Àn
)

205 *
buf
;

206 
u16
 
size
;

207 
iwªq_d©a
 
wrqu
;

209 
size
 = 
Àn
 + 
EVENT_ID_LEN
 + 
INTF_ID_LEN
;

211 i‡(
size
 > 
IW_GENERIC_IE_MAX
)

214 
buf
 = 
	`kmÆloc
(
size
, 
GFP_ATOMIC
);

215 i‡(
buf
 =
NULL
)

218 
	`mem£t
(
buf
, 0, 
size
);

219 
	`mem˝y
(
buf
, &
evít_id
, 
EVENT_ID_LEN
);

220 
	`mem˝y
(
buf
 + 
EVENT_ID_LEN
, &
ifid
, 
INTF_ID_LEN
);

221 
	`mem˝y
(
buf
 + 
EVENT_ID_LEN
 + 
INTF_ID_LEN
, 
d©≠
, 
Àn
);

223 
	`mem£t
(&
wrqu
, 0, (wrqu));

224 
wrqu
.
d©a
.
Àngth
 = 
size
;

225 
	`wúñess_£nd_evít
(
dev
, 
IWEVGENIE
, &
wrqu
, 
buf
);

226 
	`k‰ì
(
buf
);

228 
	}
}

230 
	$©h6kl_£nd_evít_to_≠p
(
√t_devi˚
 *
dev
,

231 
u16
 
evít_id
, 
u8
 
ifid
,

232 
u8
 *
d©≠
, 
Àn
)

234 *
buf
;

235 
u16
 
size
;

236 
iwªq_d©a
 
wrqu
;

238 
size
 = 
Àn
 + 
EVENT_ID_LEN
 + 
INTF_ID_LEN
;

240 i‡(
size
 > 
IW_CUSTOM_MAX
)

243 
buf
 = 
	`kmÆloc
(
size
, 
GFP_ATOMIC
);

244 i‡(
buf
 =
NULL
)

247 
	`mem£t
(
buf
, 0, 
size
);

248 
	`mem˝y
(
buf
, &
evít_id
, 
EVENT_ID_LEN
);

249 
	`mem˝y
(
buf
 + 
EVENT_ID_LEN
, &
ifid
, 
INTF_ID_LEN
);

250 
	`mem˝y
(
buf
 + 
EVENT_ID_LEN
 + 
INTF_ID_LEN
, 
d©≠
, 
Àn
);

252 
	`mem£t
(&
wrqu
, 0, (wrqu));

253 
wrqu
.
d©a
.
Àngth
 = 
size
;

254 
	`wúñess_£nd_evít
(
dev
, 
IWEVCUSTOM
, &
wrqu
, 
buf
);

255 
	`k‰ì
(
buf
);

256 
	}
}

259 #ifde‡
CONFIG_ATH6KL_DEBUG


261 
	#REG_OUTPUT_LEN_PER_LINE
 25

	)

262 
	#REGTYPE_STR_LEN
 100

	)

264 
	s©h6kl_düg_ªg_öfo
 {

265 
u32
 
	mªg_°¨t
;

266 
u32
 
	mªg_íd
;

267 c⁄° *
	mªg_öfo
;

270 c⁄° 
©h6kl_düg_ªg_öfo
 
	gdüg_ªg
[] = {

284 
	$©h6kl_dump_ªgi°îs
(
©h6kl_devi˚
 *
dev
,

285 
©h6kl_úq_¥oc_ªgi°îs
 *
úq_¥oc_ªg
,

286 
©h6kl_úq_íabÀ_ªg
 *
úq_íabÀ_ªg
)

289 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
, ("<------- Register Table -------->\n"));

291 i‡(
úq_¥oc_ªg
 !
NULL
) {

292 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

294 
úq_¥oc_ªg
->
ho°_öt_°©us
);

295 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

297 
úq_¥oc_ªg
->
˝u_öt_°©us
);

298 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

300 
úq_¥oc_ªg
->
îr‹_öt_°©us
);

301 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

303 
úq_¥oc_ªg
->
cou¡î_öt_°©us
);

304 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

306 
úq_¥oc_ªg
->
mbox_‰ame
);

307 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

309 
úq_¥oc_ªg
->
rx_lkahd_vÆid
);

310 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

312 
	`À32_to_˝u
(
úq_¥oc_ªg
->
rx_lkahd
[0]));

313 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

315 
	`À32_to_˝u
(
úq_¥oc_ªg
->
rx_lkahd
[1]));

317 i‡(
dev
->
¨
->
mbox_öfo
.
gmbox_addr
 != 0) {

322 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

324 
úq_¥oc_ªg
->
ho°_öt_°©us2
);

325 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

327 
úq_¥oc_ªg
->
gmbox_rx_avaû
);

328 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

330 
	`À32_to_˝u
(

331 
úq_¥oc_ªg
->
rx_gmbox_lkahd_Æüs
[0]));

332 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

334 
	`À32_to_˝u
(

335 
úq_¥oc_ªg
->
rx_gmbox_lkahd_Æüs
[1]));

340 i‡(
úq_íabÀ_ªg
 !
NULL
) {

341 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
,

343 
úq_íabÀ_ªg
->
öt_°©us_í
);

344 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
, "Counter Int status Enable: 0x%x\n",

345 
úq_íabÀ_ªg
->
˙å_öt_°©us_í
);

347 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
, "<------------------------------->\n");

348 
	}
}

350 
	$dump_¸ed_di°
(
htc_ídpoöt_¸edô_di°
 *
ï_di°
)

352 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
,

354 
ï_di°
->
ídpoöt
,Ép_di°->
svc_id
);

355 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " dist_flags : 0x%X\n",

356 
ï_di°
->
di°_Êags
);

357 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " cred_norm : %d\n",

358 
ï_di°
->
¸ed_n‹m
);

359 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " cred_min : %d\n",

360 
ï_di°
->
¸ed_mö
);

361 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " credits : %d\n",

362 
ï_di°
->
¸edôs
);

363 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " cred_assngd : %d\n",

364 
ï_di°
->
¸ed_as¢gd
);

365 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " seek_cred : %d\n",

366 
ï_di°
->
£ek_¸ed
);

367 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " cred_sz : %d\n",

368 
ï_di°
->
¸ed_sz
);

369 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " cred_per_msg : %d\n",

370 
ï_di°
->
¸ed_≥r_msg
);

371 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " cred_to_dist : %d\n",

372 
ï_di°
->
¸ed_to_di°
);

373 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, " cred_alloc_max : %d\n",

374 
ï_di°
->
¸ed_Æloc_max
);

375 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, "Åxq_depth : %d\n",

376 
	`gë_queue_dïth
(&
ï_di°
->
htc_ï
->
txq
));

377 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
,

379 
	}
}

382 
	$dump_¸ed_di°_°©s
(
htc_èrgë
 *
èrgë
)

384 
htc_ídpoöt_¸edô_di°
 *
ï_li°
;

386 i‡(!
	`AR_DBG_LVL_CHECK
(
ATH6KL_DBG_CREDIT
))

389 
	`li°_f‹_óch_íåy
(
ï_li°
, &
èrgë
->
¸ed_di°_li°
, 
li°
)

390 
	`dump_¸ed_di°
(
ï_li°
);

392 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
,

394 
èrgë
->
¸edô_öfo
->
tŸÆ_avaû_¸edôs
,

395 
èrgë
->
¸edô_öfo
->
cur_‰ì_¸edôs
);

396 
	}
}

398 
	$©h6kl_debugfs_›í
(
öode
 *öode, 
fûe
 *file)

400 
fûe
->
¥iv©e_d©a
 = 
öode
->
i_¥iv©e
;

402 
	}
}

404 
	$©h6kl_debug_w¨
(
©h6kl
 *
¨
, 
©h6kl_w¨
 
w¨
)

406 
w¨
) {

407 
ATH6KL_WAR_INVALID_RATE
:

408 
¨
->
debug
.
w¨_°©s
.
övÆid_øã
++;

411 
	}
}

413 
ssize_t
 
	$ªad_fûe_w¨_°©s
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

414 
size_t
 
cou¡
, 
loff_t
 *
µos
)

416 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

417 *
buf
;

418 
Àn
 = 0, 
buf_Àn
 = 1500;

419 
ssize_t
 
ªt_˙t
;

421 
buf
 = 
	`kzÆloc
(
buf_Àn
, 
GFP_KERNEL
);

422 i‡(!
buf
)

423  -
ENOMEM
;

425 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n");

426 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n",

428 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n\n",

430 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10u\n",

431 "InvÆidÑ©es", 
¨
->
debug
.
w¨_°©s
.
övÆid_øã
);

433 i‡(
	`WARN_ON
(
Àn
 > 
buf_Àn
))

434 
Àn
 = 
buf_Àn
;

436 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

438 
	`k‰ì
(
buf
);

439  
ªt_˙t
;

440 
	}
}

442 c⁄° 
fûe_›î©i⁄s
 
	gf›s_w¨_°©s
 = {

443 .
ªad
 = 
ªad_fûe_w¨_°©s
,

444 .
	g›í
 = 
©h6kl_debugfs_›í
,

445 .
	gow√r
 = 
THIS_MODULE
,

446 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

450 
u32


451 
	$©h6kl_fwlog_‰agmít
(c⁄° 
u8
 *
d©≠
, 
u32
 
Àn
, u32 
limô
)

453 
u32
 *
buf„r
;

454 
u32
 
cou¡
;

455 
u32
 
num¨gs
;

456 
u32
 
Àngth
;

457 
u32
 
‰agÀn
;

459 
cou¡
 = 
‰agÀn
 = 0;

460 
buf„r
 = (
u32
 *)
d©≠
;

461 
Àngth
 = (
limô
 >> 2);

463 i‡(
Àn
 <
limô
) {

464 
‰agÀn
 = 
Àn
;

466 
cou¡
 < 
Àngth
) {

467 
num¨gs
 = 
	`ATH6KL_FWGLOG_GET_NUMARGS
(
buf„r
[
cou¡
]);

468 
‰agÀn
 = (
cou¡
 << 2);

469 
cou¡
 +
num¨gs
 + 1;

473  
‰agÀn
;

474 
	}
}

478 
	$©h6kl_debug_fwlog_evít_£nd
(
©h6kl
 *
¨
, c⁄° 
u8
 *
buf„r
, 
u32
 
Àngth
)

480 
	#MAX_WIRELESS_EVENT_SIZE
 252

	)

487 
u32
 
£nd
, 
£¡
;

488 
©h6kl_vif
 *
vif
;

489 
√t_devi˚
 *
dev
;

491 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

494 i‡(!
vif
)

497 
dev
 = 
vif
->
ndev
;

499 
£¡
 = 0;

500 
£nd
 = 
	`©h6kl_fwlog_‰agmít
(&
buf„r
[
£¡
], 
Àngth
 - sent,

501 
MAX_WIRELESS_EVENT_SIZE
);

502 
£nd
) {

503 
	`©h6kl_£nd_evít_to_≠p
(
dev
, 
WMIX_DBGLOG_EVENTID
,

504 
vif
->
fw_vif_idx
, (
u8
 *)&
buf„r
[
£¡
], 
£nd
);

505 
£¡
 +
£nd
;

506 
£nd
 = 
	`©h6kl_fwlog_‰agmít
(&
buf„r
[
£¡
], 
Àngth
 - sent,

507 
MAX_WIRELESS_EVENT_SIZE
);

509 
	}
}

512 
	$©h6kl_debug_fwlog_evít
(
©h6kl
 *
¨
, c⁄° *
buf
, 
size_t
 
Àn
)

514 
©h6kl_fwlog_¶Ÿ
 *
¶Ÿ
;

515 
sk_buff
 *
skb
;

516 
size_t
 
¶Ÿ_Àn
;

518 
	`¥ötk
("ath6kl_debug_fwlog_event\n");

520 i‡(
	`WARN_ON
(
Àn
 > 
ATH6KL_FWLOG_PAYLOAD_SIZE
))

523 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_ENABLE_FWLOG_EXT
))

524 
	`©h6kl_debug_fwlog_evít_£nd
(
¨
, 
buf
, 
Àn
);

526 
¶Ÿ_Àn
 = (*
¶Ÿ
Ë+ 
ATH6KL_FWLOG_PAYLOAD_SIZE
;

528 
skb
 = 
	`Æloc_skb
(
¶Ÿ_Àn
, 
GFP_KERNEL
);

529 i‡(!
skb
)

532 
¶Ÿ
 = (
©h6kl_fwlog_¶Ÿ
 *Ë
	`skb_put
(
skb
, 
¶Ÿ_Àn
);

534 
¶Ÿ
->
time°amp
 = 
	`˝u_to_À32
(
jiffõs
);

535 
¶Ÿ
->
Àngth
 = 
	`˝u_to_À32
(
Àn
);

536 
	`mem˝y
(
¶Ÿ
->
∑ylﬂd
, 
buf
, 
Àn
);

539 
	`mem£t
(
¶Ÿ
->
∑ylﬂd
 + 
Àn
, 0, 
ATH6KL_FWLOG_PAYLOAD_SIZE
 -Üen);

541 
	`•ö_lock
(&
¨
->
debug
.
fwlog_queue
.
lock
);

543 
	`__skb_queue_èû
(&
¨
->
debug
.
fwlog_queue
, 
skb
);

544 
	`com∂ëe
(&
¨
->
debug
.
fwlog_com∂ëi⁄
);

547 
	`skb_queue_Àn
(&
¨
->
debug
.
fwlog_queue
) >

548 
ATH6KL_FWLOG_MAX_ENTRIES
) {

549 
skb
 = 
	`__skb_dequeue
(&
¨
->
debug
.
fwlog_queue
);

550 
	`k‰ì_skb
(
skb
);

553 
	`•ö_u∆ock
(&
¨
->
debug
.
fwlog_queue
.
lock
);

555 
	}
}

557 
	$©h6kl_fwlog_›í
(
öode
 *öode, 
fûe
 *file)

559 
©h6kl
 *
¨
 = 
öode
->
i_¥iv©e
;

561 i‡(
¨
->
debug
.
fwlog_›í
)

562  -
EBUSY
;

564 
¨
->
debug
.
fwlog_›í
 = 
åue
;

566 
fûe
->
¥iv©e_d©a
 = 
öode
->
i_¥iv©e
;

568 
	}
}

570 
	$©h6kl_fwlog_ªÀa£
(
öode
 *öode, 
fûe
 *file)

572 
©h6kl
 *
¨
 = 
öode
->
i_¥iv©e
;

574 
¨
->
debug
.
fwlog_›í
 = 
Ál£
;

577 
	}
}

580 
ssize_t
 
	$©h6kl_fwlog_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

581 
size_t
 
cou¡
, 
loff_t
 *
µos
)

583 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

584 
sk_buff
 *
skb
;

585 
size_t
 
Àn
 = 0;

587 
ssize_t
 
ªt_˙t
;

588 *
buf
;

590 
buf
 = 
	`vmÆloc
(
cou¡
);

591 i‡(!
buf
)

592  -
ENOMEM
;

595 
	`©h6kl_ªad_fwlogs
(
¨
);

597 
	`•ö_lock
(&
¨
->
debug
.
fwlog_queue
.
lock
);

599 (
skb
 = 
	`__skb_dequeue
(&
¨
->
debug
.
fwlog_queue
))) {

600 i‡(
skb
->
Àn
 > 
cou¡
 -Üen) {

602 
	`__skb_queue_hód
(&
¨
->
debug
.
fwlog_queue
, 
skb
);

606 
	`mem˝y
(
buf
 + 
Àn
, 
skb
->
d©a
, skb->len);

607 
Àn
 +
skb
->len;

609 
	`k‰ì_skb
(
skb
);

612 
	`•ö_u∆ock
(&
¨
->
debug
.
fwlog_queue
.
lock
);

615 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

617 
	`v‰ì
(
buf
);

619  
ªt_˙t
;

620 
	}
}

622 c⁄° 
fûe_›î©i⁄s
 
	gf›s_fwlog
 = {

623 .
›í
 = 
©h6kl_fwlog_›í
,

624 .
	gªad
 = 
©h6kl_fwlog_ªad
,

625 .
	gªÀa£
 = 
©h6kl_fwlog_ªÀa£
,

626 .
	gow√r
 = 
THIS_MODULE
,

627 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

630 
ssize_t
 
	$©h6kl_fwlog_block_ªad
(
fûe
 *file,

631 
__u£r
 *
u£r_buf
,

632 
size_t
 
cou¡
,

633 
loff_t
 *
µos
)

635 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

636 
sk_buff
 *
skb
;

637 
ssize_t
 
ªt_˙t
;

638 
size_t
 
Àn
 = 0, 
nŸ_c›õd
;

639 *
buf
;

640 
ªt
;

642 
buf
 = 
	`vmÆloc
(
cou¡
);

643 i‡(!
buf
)

644  -
ENOMEM
;

646 
	`•ö_lock
(&
¨
->
debug
.
fwlog_queue
.
lock
);

648 i‡(
	`skb_queue_Àn
(&
¨
->
debug
.
fwlog_queue
) == 0) {

650 
	`öô_com∂ëi⁄
(&
¨
->
debug
.
fwlog_com∂ëi⁄
);

652 
	`•ö_u∆ock
(&
¨
->
debug
.
fwlog_queue
.
lock
);

654 
ªt
 = 
	`waô_f‹_com∂ëi⁄_öãºu±ibÀ
(

655 &
¨
->
debug
.
fwlog_com∂ëi⁄
);

656 i‡(
ªt
 =-
ERESTARTSYS
) {

657 
	`v‰ì
(
buf
);

658  
ªt
;

661 
	`•ö_lock
(&
¨
->
debug
.
fwlog_queue
.
lock
);

664 (
skb
 = 
	`__skb_dequeue
(&
¨
->
debug
.
fwlog_queue
))) {

665 i‡(
skb
->
Àn
 > 
cou¡
 -Üen) {

667 
	`__skb_queue_hód
(&
¨
->
debug
.
fwlog_queue
, 
skb
);

672 
	`mem˝y
(
buf
 + 
Àn
, 
skb
->
d©a
, skb->len);

673 
Àn
 +
skb
->len;

675 
	`k‰ì_skb
(
skb
);

678 
	`•ö_u∆ock
(&
¨
->
debug
.
fwlog_queue
.
lock
);

681 
nŸ_c›õd
 = 
	`c›y_to_u£r
(
u£r_buf
, 
buf
, 
Àn
);

682 i‡(
nŸ_c›õd
 != 0) {

683 
ªt_˙t
 = -
EFAULT
;

684 
out
;

687 *
µos
 = *µo†+ 
Àn
;

689 
ªt_˙t
 = 
Àn
;

691 
out
:

692 
	`v‰ì
(
buf
);

694  
ªt_˙t
;

695 
	}
}

697 c⁄° 
fûe_›î©i⁄s
 
	gf›s_fwlog_block
 = {

698 .
›í
 = 
©h6kl_fwlog_›í
,

699 .
	gªÀa£
 = 
©h6kl_fwlog_ªÀa£
,

700 .
	gªad
 = 
©h6kl_fwlog_block_ªad
,

701 .
	gow√r
 = 
THIS_MODULE
,

702 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

706 
ssize_t
 
	$©h6kl_fwlog_mask_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

707 
size_t
 
cou¡
, 
loff_t
 *
µos
)

709 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

710 
buf
[16];

711 
Àn
;

713 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "0x%x\n", 
¨
->
debug
.
fwlog_mask
);

715  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

716 
	}
}

718 
ssize_t
 
	$©h6kl_fwlog_mask_wrôe
(
fûe
 *file,

719 c⁄° 
__u£r
 *
u£r_buf
,

720 
size_t
 
cou¡
, 
loff_t
 *
µos
)

722 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

723 
ªt
;

725 
ªt
 = 
	`k°πou32_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
¨
->
debug
.
fwlog_mask
);

726 i‡(
ªt
)

727  
ªt
;

729 
ªt
 = 
	`©h6kl_wmi_c⁄fig_debug_moduÀ_cmd
(
¨
->
wmi
,

730 
ATH6KL_FWLOG_VALID_MASK
,

731 
¨
->
debug
.
fwlog_mask
);

732 i‡(
ªt
)

733  
ªt
;

735  
cou¡
;

736 
	}
}

738 c⁄° 
fûe_›î©i⁄s
 
	gf›s_fwlog_mask
 = {

739 .
›í
 = 
©h6kl_debugfs_›í
,

740 .
	gªad
 = 
©h6kl_fwlog_mask_ªad
,

741 .
	gwrôe
 = 
©h6kl_fwlog_mask_wrôe
,

742 .
	gow√r
 = 
THIS_MODULE
,

743 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

746 
ssize_t
 
	$ªad_fûe_tgt_°©s
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

747 
size_t
 
cou¡
, 
loff_t
 *
µos
)

749 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

750 
©h6kl_vif
 *
vif
;

751 
èrgë_°©s
 *
tgt_°©s
;

752 *
buf
;

753 
Àn
 = 0, 
buf_Àn
 = 1500;

754 
i
;

755 
À·
;

756 
ssize_t
 
ªt_˙t
;

758 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

759 i‡(!
vif
)

760  -
EIO
;

762 
tgt_°©s
 = &
vif
->
èrgë_°©s
;

764 
buf
 = 
	`kzÆloc
(
buf_Àn
, 
GFP_KERNEL
);

765 i‡(!
buf
) {

766 
	`k‰ì
(
buf
);

767  -
ENOMEM
;

770 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

771 
	`k‰ì
(
buf
);

772  -
EBUSY
;

775 
	`£t_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
);

777 i‡(
	`©h6kl_wmi_gë_°©s_cmd
(
¨
->
wmi
, 0)) {

778 
	`up
(&
¨
->
£m
);

779 
	`k‰ì
(
buf
);

780  -
EIO
;

783 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

784 !
	`ã°_bô
(
STATS_UPDATE_PEND
,

785 &
vif
->
Êags
), 
WMI_TIMEOUT
);

787 
	`up
(&
¨
->
£m
);

789 i‡(
À·
 <= 0) {

790 
	`k‰ì
(
buf
);

791  -
ETIMEDOUT
;

794 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n");

795 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n",

797 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n\n",

799 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

800 "Uˇ°Öackës", 
tgt_°©s
->
tx_uˇ°_pkt
);

801 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

802 "Bˇ°Öackës", 
tgt_°©s
->
tx_bˇ°_pkt
);

803 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

804 "Mˇ°Öackës", 
tgt_°©s
->
tx_mˇ°_pkt
);

805 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

806 "Uˇ° byã", 
tgt_°©s
->
tx_uˇ°_byã
);

807 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

808 "Bˇ° byã", 
tgt_°©s
->
tx_bˇ°_byã
);

809 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

810 "Mˇ° byã", 
tgt_°©s
->
tx_mˇ°_byã
);

811 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

812 "Rt†suc˚s†˙t", 
tgt_°©s
->
tx_πs_suc˚ss_˙t
);

813 
i
 = 0; i < 4; i++)

814 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

816 
i
, 
tgt_°©s
->
tx_pkt_≥r_ac
[i]);

817 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

818 "Eº‹", 
tgt_°©s
->
tx_îr
);

819 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

820 "Faû cou¡", 
tgt_°©s
->
tx_Áû_˙t
);

821 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

822 "Rëry cou¡", 
tgt_°©s
->
tx_ªåy_˙t
);

823 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

824 "Mu…òªåy c¡", 
tgt_°©s
->
tx_mu…_ªåy_˙t
);

825 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

826 "Rt†Áû c¡", 
tgt_°©s
->
tx_πs_Áû_˙t
);

827 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s %10llu\n\n",

829 
tgt_°©s
->
tkù_˙ãr_mósuªs_övoked
);

831 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n",

833 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n",

836 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

837 "Uˇ°Öackës", 
tgt_°©s
->
rx_uˇ°_pkt
);

838 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10d\n",

839 "Uˇ° R©e", 
tgt_°©s
->
rx_uˇ°_øã
);

840 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

841 "Bˇ°Öackës", 
tgt_°©s
->
rx_bˇ°_pkt
);

842 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

843 "Mˇ°Öackës", 
tgt_°©s
->
rx_mˇ°_pkt
);

844 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

845 "Uˇ° byã", 
tgt_°©s
->
rx_uˇ°_byã
);

846 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

847 "Bˇ° byã", 
tgt_°©s
->
rx_bˇ°_byã
);

848 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

849 "Mˇ° byã", 
tgt_°©s
->
rx_mˇ°_byã
);

850 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

851 "FøgmíãdÖkt", 
tgt_°©s
->
rx_‰gmít_pkt
);

852 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

853 "Eº‹", 
tgt_°©s
->
rx_îr
);

854 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

855 "CRC Eº", 
tgt_°©s
->
rx_¸c_îr
);

856 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

857 "Key chachêmiss", 
tgt_°©s
->
rx_key_ˇche_miss
);

858 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

859 "De¸y± Eº", 
tgt_°©s
->
rx_de¸y±_îr
);

860 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

861 "Du∂iˇã føme", 
tgt_°©s
->
rx_du∂_‰ame
);

862 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

863 "Tkù Mi¯Áûuª", 
tgt_°©s
->
tkù_loˇl_mic_Áû
);

864 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

865 "TKIP f‹m©Éº", 
tgt_°©s
->
tkù_fmt_îr
);

866 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

867 "CCMP f‹m© Eº", 
tgt_°©s
->
ccmp_fmt_îr
);

868 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n\n",

869 "CCMP Rïœy Eº", 
tgt_°©s
->
ccmp_ª∂ays
);

871 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n",

873 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n",

875 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

876 "Bóc⁄ Mis†cou¡", 
tgt_°©s
->
cs_bmiss_˙t
);

877 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

878 "Num C⁄√˘s", 
tgt_°©s
->
cs_c⁄√˘_˙t
);

879 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10llu\n",

880 "Num disc⁄√˘s", 
tgt_°©s
->
cs_disc⁄_˙t
);

881 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10d\n",

882 "Bóc⁄ávgÑssi", 
tgt_°©s
->
cs_ave_bóc⁄_rssi
);

884 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n",

886 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s\n",

888 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10u\n",

889 "WowÖkàdr›≥d", 
tgt_°©s
->
wow_pkt_dr›≥d
);

890 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10u\n",

891 "WowÉvàdisˇrded", 
tgt_°©s
->
wow_evt_disˇrded
);

892 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10u\n",

893 "Wow ho°Ökàwakeup", 
tgt_°©s
->
wow_ho°_pkt_wakeups
);

894 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%20s %10u\n",

895 "Wow ho°Évàwakeups", 
tgt_°©s
->
wow_ho°_evt_wakeups
);

897 i‡(
Àn
 > 
buf_Àn
)

898 
Àn
 = 
buf_Àn
;

900 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

902 
	`k‰ì
(
buf
);

903  
ªt_˙t
;

904 
	}
}

906 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tgt_°©s
 = {

907 .
ªad
 = 
ªad_fûe_tgt_°©s
,

908 .
	g›í
 = 
©h6kl_debugfs_›í
,

909 .
	gow√r
 = 
THIS_MODULE
,

910 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

913 
	#¥öt_¸edô_öfo
(
fmt_°r
, 
ï_li°_fõld
Ë\

	)

914 (
	gÀn
 +
s˙¥ötf
(
buf
 + 
Àn
, 
buf_Àn
 -Üí, 
fmt_°r
, \

915 
ï_li°
->
ï_li°_fõld
))

916 
	#CREDIT_INFO_DISPLAY_STRING_LEN
 200

	)

917 
	#CREDIT_INFO_LEN
 128

	)

919 
ssize_t
 
	$ªad_fûe_¸edô_di°_°©s
(
fûe
 *file,

920 
__u£r
 *
u£r_buf
,

921 
size_t
 
cou¡
, 
loff_t
 *
µos
)

923 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

924 
htc_èrgë
 *
èrgë
 = 
¨
->htc_target;

925 
htc_ídpoöt_¸edô_di°
 *
ï_li°
;

926 *
buf
;

927 
buf_Àn
, 
Àn
 = 0;

928 
ssize_t
 
ªt_˙t
;

929 
li°_hód
 *li°_hód = &
èrgë
->
¸ed_di°_li°
;

931 i‡(
	`WARN_ON
(
li°_hód
->
√xt
 =
NULL
))

932  -
EFAULT
;

934 
buf_Àn
 = 
CREDIT_INFO_DISPLAY_STRING_LEN
 +

935 
	`gë_queue_dïth
(&
èrgë
->
¸ed_di°_li°
Ë* 
CREDIT_INFO_LEN
;

936 
buf
 = 
	`kzÆloc
(
buf_Àn
, 
GFP_KERNEL
);

937 i‡(!
buf
)

938  -
ENOMEM
;

940 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s%5d\n",

942 
èrgë
->
¸edô_öfo
->
tŸÆ_avaû_¸edôs
);

943 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%25s%5d\n",

945 
èrgë
->
¸edô_öfo
->
cur_‰ì_¸edôs
);

947 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

952 
	`li°_f‹_óch_íåy
(
ï_li°
, &
èrgë
->
¸ed_di°_li°
, 
li°
) {

953 
	`¥öt_¸edô_öfo
(" %2d", 
ídpoöt
);

954 
	`¥öt_¸edô_öfo
("%10x", 
di°_Êags
);

955 
	`¥öt_¸edô_öfo
("%8d", 
¸ed_n‹m
);

956 
	`¥öt_¸edô_öfo
("%9d", 
¸ed_mö
);

957 
	`¥öt_¸edô_öfo
("%9d", 
¸edôs
);

958 
	`¥öt_¸edô_öfo
("%10d", 
¸ed_as¢gd
);

959 
	`¥öt_¸edô_öfo
("%13d", 
£ek_¸ed
);

960 
	`¥öt_¸edô_öfo
("%12d", 
¸ed_sz
);

961 
	`¥öt_¸edô_öfo
("%9d", 
¸ed_≥r_msg
);

962 
	`¥öt_¸edô_öfo
("%14d", 
¸ed_to_di°
);

963 
	`¥öt_¸edô_öfo
("%17d", 
¸ed_Æloc_max
);

964 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "%12d\n",

965 
	`gë_queue_dïth
(&
ï_li°
->
htc_ï
->
txq
));

968 i‡(
Àn
 > 
buf_Àn
)

969 
Àn
 = 
buf_Àn
;

971 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

972 
	`k‰ì
(
buf
);

973  
ªt_˙t
;

974 
	}
}

976 c⁄° 
fûe_›î©i⁄s
 
	gf›s_¸edô_di°_°©s
 = {

977 .
ªad
 = 
ªad_fûe_¸edô_di°_°©s
,

978 .
	g›í
 = 
©h6kl_debugfs_›í
,

979 .
	gow√r
 = 
THIS_MODULE
,

980 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

983 
	$¥öt_ídpoöt_°©
(
htc_èrgë
 *
èrgë
, *
buf
,

984 
buf_Àn
, 
Àn
,

985 
off£t
, c⁄° *
«me
)

987 
i
;

988 
htc_ídpoöt_°©s
 *
ï_°
;

989 
u32
 *
cou¡î
;

991 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üí, "%s:", 
«me
);

992 
i
 = 0; i < 
ENDPOINT_MAX
; i++) {

993 
ï_°
 = &
èrgë
->
ídpoöt
[
i
].ep_st;

994 
cou¡î
 = ((
u32
 *Ë
ï_°
Ë+ (
off£t
 / 4);

995 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üí, " %u", *
cou¡î
);

997 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n");

999  
Àn
;

1000 
	}
}

1002 
ssize_t
 
	$©h6kl_ídpoöt_°©s_ªad
(
fûe
 *file,

1003 
__u£r
 *
u£r_buf
,

1004 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1006 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1007 
htc_èrgë
 *
èrgë
 = 
¨
->htc_target;

1008 *
buf
;

1009 
buf_Àn
, 
Àn
 = 0;

1010 
ssize_t
 
ªt_˙t
;

1012 
buf_Àn
 = (
htc_ídpoöt_°©s
Ë/ (
u32
) *

1013 (25 + 
ENDPOINT_MAX
 * 11);

1014 
buf
 = 
	`kmÆloc
(
buf_Àn
, 
GFP_KERNEL
);

1015 i‡(!
buf
)

1016  -
ENOMEM
;

1018 
	#EPSTAT
(
«me
Ë\

	)

1019 
Àn
 = 
	`¥öt_ídpoöt_°©
(
èrgë
, 
buf
, 
buf_Àn
,Üen, \

1020 
	`off£tof
(
htc_ídpoöt_°©s
, 
«me
), \

1022 
	`EPSTAT
(
¸ed_low_ödiˇã
);

1023 
	`EPSTAT
(
tx_issued
);

1024 
	`EPSTAT
(
tx_pkt_bundÀd
);

1025 
	`EPSTAT
(
tx_bundÀs
);

1026 
	`EPSTAT
(
tx_dr›≥d
);

1027 
	`EPSTAT
(
tx_¸ed_Ωt
);

1028 
	`EPSTAT
(
¸ed_Ωt_‰om_rx
);

1029 
	`EPSTAT
(
¸ed_Ωt_‰om_Ÿhî
);

1030 
	`EPSTAT
(
¸ed_Ωt_ï0
);

1031 
	`EPSTAT
(
¸ed_‰om_rx
);

1032 
	`EPSTAT
(
¸ed_‰om_Ÿhî
);

1033 
	`EPSTAT
(
¸ed_‰om_ï0
);

1034 
	`EPSTAT
(
¸ed_cosumd
);

1035 
	`EPSTAT
(
¸ed_ªäd
);

1036 
	`EPSTAT
(
rx_pkts
);

1037 
	`EPSTAT
(
rx_lkahds
);

1038 
	`EPSTAT
(
rx_bundl
);

1039 
	`EPSTAT
(
rx_bundÀ_lkahd
);

1040 
	`EPSTAT
(
rx_bundÀ_‰om_hdr
);

1041 
	`EPSTAT
(
rx_Æloc_thªsh_hô
);

1042 
	`EPSTAT
(
rxÆloc_thªsh_byã
);

1043 #unde‡
EPSTAT


1045 i‡(
Àn
 > 
buf_Àn
)

1046 
Àn
 = 
buf_Àn
;

1048 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1049 
	`k‰ì
(
buf
);

1050  
ªt_˙t
;

1051 
	}
}

1053 
ssize_t
 
	$©h6kl_ídpoöt_°©s_wrôe
(
fûe
 *file,

1054 c⁄° 
__u£r
 *
u£r_buf
,

1055 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1057 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1058 
htc_èrgë
 *
èrgë
 = 
¨
->htc_target;

1059 
ªt
, 
i
;

1060 
u32
 
vÆ
;

1061 
htc_ídpoöt_°©s
 *
ï_°
;

1063 
ªt
 = 
	`k°πou32_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
vÆ
);

1064 i‡(
ªt
)

1065  
ªt
;

1066 i‡(
vÆ
 == 0) {

1067 
i
 = 0; i < 
ENDPOINT_MAX
; i++) {

1068 
ï_°
 = &
èrgë
->
ídpoöt
[
i
].ep_st;

1069 
	`mem£t
(
ï_°
, 0, (*ep_st));

1073  
cou¡
;

1074 
	}
}

1076 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ídpoöt_°©s
 = {

1077 .
›í
 = 
©h6kl_debugfs_›í
,

1078 .
	gªad
 = 
©h6kl_ídpoöt_°©s_ªad
,

1079 .
	gwrôe
 = 
©h6kl_ídpoöt_°©s_wrôe
,

1080 .
	gow√r
 = 
THIS_MODULE
,

1081 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1084 
	$©h6kl_gë_num_ªg
()

1086 
i
;

1087 
n_ªg
 = 0;

1089 
i
 = 0; i < 
	`ARRAY_SIZE
(
düg_ªg
); i++)

1090 
n_ªg
 =Ç_reg +

1091 (
düg_ªg
[
i
].
ªg_íd
 - düg_ªg[i].
ªg_°¨t
) / 4 + 1;

1093  
n_ªg
;

1094 
	}
}

1096 
boﬁ
 
	$©h6kl_dbg_is_düg_ªg_vÆid
(
u32
 
ªg_addr
)

1098 
i
;

1100 
i
 = 0; i < 
	`ARRAY_SIZE
(
düg_ªg
); i++) {

1101 i‡(
ªg_addr
 >
düg_ªg
[
i
].
ªg_°¨t
 &&

1102 
ªg_addr
 <
düg_ªg
[
i
].
ªg_íd
)

1103  
åue
;

1106  
åue
;

1107 
	}
}

1109 
ssize_t
 
	$©h6kl_ªgªad_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1110 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1112 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1113 
u8
 
buf
[50];

1114 
Àn
 = 0;

1116 i‡(
¨
->
debug
.
dbgfs_düg_ªg
)

1117 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen, "0x%x\n",

1118 
¨
->
debug
.
dbgfs_düg_ªg
);

1120 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen, (buf) -Üen,

1123  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1124 
	}
}

1126 
ssize_t
 
	$©h6kl_ªgªad_wrôe
(
fûe
 *file,

1127 c⁄° 
__u£r
 *
u£r_buf
,

1128 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1130 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1131 
u8
 
buf
[50];

1132 
Àn
;

1133 
ªg_addr
;

1135 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1136 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1137  -
EFAULT
;

1139 
buf
[
Àn
] = '\0';

1141 i‡(
	`k°πoul
(
buf
, 0, &
ªg_addr
))

1142  -
EINVAL
;

1144 i‡((
ªg_addr
 % 4) != 0)

1145  -
EINVAL
;

1147 i‡(
ªg_addr
 && !
	`©h6kl_dbg_is_düg_ªg_vÆid
(reg_addr))

1148  -
EINVAL
;

1150 
¨
->
debug
.
dbgfs_düg_ªg
 = 
ªg_addr
;

1152  
cou¡
;

1153 
	}
}

1155 c⁄° 
fûe_›î©i⁄s
 
	gf›s_düg_ªg_ªad
 = {

1156 .
ªad
 = 
©h6kl_ªgªad_ªad
,

1157 .
	gwrôe
 = 
©h6kl_ªgªad_wrôe
,

1158 .
	g›í
 = 
©h6kl_debugfs_›í
,

1159 .
	gow√r
 = 
THIS_MODULE
,

1160 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1163 
	$©h6kl_ªgdump_›í
(
öode
 *öode, 
fûe
 *file)

1165 
©h6kl
 *
¨
 = 
öode
->
i_¥iv©e
;

1166 
u8
 *
buf
;

1167 
ªg_Àn
;

1168 
Àn
 = 0, 
n_ªg
;

1169 
u32
 
addr
;

1170 
__À32
 
ªg_vÆ
;

1171 
i
, 
°©us
;

1174 i‡(!
¨
->
debug
.
dbgfs_düg_ªg
)

1175 
n_ªg
 = 
	`©h6kl_gë_num_ªg
();

1177 
n_ªg
 = 1;

1179 
ªg_Àn
 = 
n_ªg
 * 
REG_OUTPUT_LEN_PER_LINE
;

1180 i‡(
n_ªg
 > 1)

1181 
ªg_Àn
 +
REGTYPE_STR_LEN
;

1183 
buf
 = 
	`vmÆloc
(
ªg_Àn
);

1184 i‡(!
buf
)

1185  -
ENOMEM
;

1187 i‡(
n_ªg
 == 1) {

1188 
addr
 = 
¨
->
debug
.
dbgfs_düg_ªg
;

1190 
°©us
 = 
	`©h6kl_düg_ªad32
(
¨
,

1191 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
, 
addr
),

1192 (
u32
 *)&
ªg_vÆ
);

1193 i‡(
°©us
)

1194 
Áû_ªg_ªad
;

1196 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
ªg_Àn
 -Üen,

1197 "0x%06x 0x%08x\n", 
addr
, 
	`À32_to_˝u
(
ªg_vÆ
));

1198 
d⁄e
;

1201 
i
 = 0; i < 
	`ARRAY_SIZE
(
düg_ªg
); i++) {

1202 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
ªg_Àn
 -Üen,

1203 "%s\n", 
düg_ªg
[
i
].
ªg_öfo
);

1204 
addr
 = 
düg_ªg
[
i
].
ªg_°¨t
;

1205 
addr
 <
düg_ªg
[
i
].
ªg_íd
;áddr += 4) {

1206 
°©us
 = 
	`©h6kl_düg_ªad32
(
¨
,

1207 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
, 
addr
),

1208 (
u32
 *)&
ªg_vÆ
);

1209 i‡(
°©us
)

1210 
Áû_ªg_ªad
;

1212 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
ªg_Àn
 -Üen,

1214 
addr
, 
	`À32_to_˝u
(
ªg_vÆ
));

1218 
d⁄e
:

1219 
fûe
->
¥iv©e_d©a
 = 
buf
;

1222 
Áû_ªg_ªad
:

1223 
	`©h6kl_w¨n
("U«bÀÅÿªad mem‹y:%u\n", 
addr
);

1224 
	`v‰ì
(
buf
);

1225  -
EIO
;

1226 
	}
}

1228 
ssize_t
 
	$©h6kl_ªgdump_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1229 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1231 
u8
 *
buf
 = 
fûe
->
¥iv©e_d©a
;

1232  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
	`°æí
(buf));

1233 
	}
}

1235 
	$©h6kl_ªgdump_ªÀa£
(
öode
 *öode, 
fûe
 *file)

1237 
	`v‰ì
(
fûe
->
¥iv©e_d©a
);

1239 
	}
}

1241 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ªg_dump
 = {

1242 .
›í
 = 
©h6kl_ªgdump_›í
,

1243 .
	gªad
 = 
©h6kl_ªgdump_ªad
,

1244 .
	gªÀa£
 = 
©h6kl_ªgdump_ªÀa£
,

1245 .
	gow√r
 = 
THIS_MODULE
,

1246 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1249 
	$©h6kl_£t_rﬂm_∑øms
(c⁄° 
__u£r
 *
u£r_buf
,

1250 
size_t
 
cou¡
,

1251 
low_rssi_sˇn_∑øms
 *
low_rssi_rﬂm_∑øms
)

1253 
buf
[64];

1254 *
p
;

1255 
Àn
;

1256 
vÆue
;

1258 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1259 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1260  -
EFAULT
;

1262 
p
 = 
buf
;

1264 
SKIP_SPACE
;

1266 
	`ssˇnf
(
p
, "%d", &
vÆue
);

1267 
low_rssi_rﬂm_∑øms
->
Ãssi_sˇn_≥riod
 = (
u16
Ë
vÆue
;

1269 
SEEK_SPACE
;

1270 
SKIP_SPACE
;

1272 
	`ssˇnf
(
p
, "%d", &
vÆue
);

1273 
low_rssi_rﬂm_∑øms
->
Ãssi_sˇn_thªshﬁd
 = (
u16
Ë
vÆue
;

1275 
SEEK_SPACE
;

1276 
SKIP_SPACE
;

1278 
	`ssˇnf
(
p
, "%d", &
vÆue
);

1279 
low_rssi_rﬂm_∑øms
->
Ãssi_rﬂm_thªshﬁd
 = (
u16
Ë
vÆue
;

1281 
SEEK_SPACE
;

1282 
SKIP_SPACE
;

1284 
	`ssˇnf
(
p
, "%d", &
vÆue
);

1285 
low_rssi_rﬂm_∑øms
->
rﬂm_rssi_Êo‹
 = (
u8
Ë
vÆue
;

1288 
	}
}

1291 
ssize_t
 
	$©h6kl_Ãssi_rﬂm_wrôe
(
fûe
 *file,

1292 c⁄° 
__u£r
 *
u£r_buf
,

1293 
size_t
 
cou¡
,

1294 
loff_t
 *
µos
)

1296 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1297 
ªt
;

1299 
ªt
 = 
	`©h6kl_£t_rﬂm_∑øms
(
u£r_buf
, 
cou¡
,

1300 &
¨
->
low_rssi_rﬂm_∑øms
);

1302 i‡(
ªt
)

1303  
ªt
;

1305 
	`©h6kl_wmi_£t_rﬂm_˘æ_cmd
(
¨
->
wmi
,

1307 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_sˇn_≥riod
,

1308 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_sˇn_thªshﬁd
,

1309 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_rﬂm_thªshﬁd
,

1310 
¨
->
low_rssi_rﬂm_∑øms
.
rﬂm_rssi_Êo‹
);

1312  
cou¡
;

1313 
	}
}

1315 
ssize_t
 
	$©h6kl_Ãssi_rﬂm_ªad
(
fûe
 *file,

1316 
__u£r
 *
u£r_buf
,

1317 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1319 
	#_BUF_SIZE
 (128)

	)

1320 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1321 
u8
 *
buf
;

1322 
Àn
 = 0;

1323 
ssize_t
 
ªt_˙t
;

1325 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

1326 i‡(!
buf
)

1327  -
ENOMEM
;

1329 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

1331 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_sˇn_≥riod
,

1332 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_sˇn_thªshﬁd
,

1333 
¨
->
low_rssi_rﬂm_∑øms
.
Ãssi_rﬂm_thªshﬁd
,

1334 
¨
->
low_rssi_rﬂm_∑øms
.
rﬂm_rssi_Êo‹
);

1336 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1338 
	`k‰ì
(
buf
);

1340  
ªt_˙t
;

1341 #unde‡
_BUF_SIZE


1342 
	}
}

1344 c⁄° 
fûe_›î©i⁄s
 
	gf›s_Ãssi_rﬂm_∑øm
 = {

1345 .
ªad
 = 
©h6kl_Ãssi_rﬂm_ªad
,

1346 .
	gwrôe
 = 
©h6kl_Ãssi_rﬂm_wrôe
,

1347 .
	g›í
 = 
©h6kl_debugfs_›í
,

1348 .
	gow√r
 = 
THIS_MODULE
,

1349 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1352 
ssize_t
 
	$©h6kl_drivî_vîsi⁄_ªad
(
fûe
 *file,

1353 
__u£r
 *
u£r_buf
,

1354 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1356 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1357 
buf
[64];

1358 
Àn
;

1360 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "%s\n", 
DRV_VERSION
);

1361 
Àn
 +
	`¢¥ötf
(
buf
 +Üen, (buf) -Üen, "%s %s\n",

1362 
¨
->
hw
.
«me
,

1363 (
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_SDIO
) ?

1365 ((
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_USB
) ?

1367 
Àn
 +
	`¢¥ötf
(
buf
 +Üen, (buf) -Üen, "%s\n",

1368 
¨
->
wùhy
->
fw_vîsi⁄
);

1370  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1371 
	}
}

1373 c⁄° 
fûe_›î©i⁄s
 
	gf›s_drivî_vîsi⁄
 = {

1374 .
ªad
 = 
©h6kl_drivî_vîsi⁄_ªad
,

1375 .
	g›í
 = 
©h6kl_debugfs_›í
,

1376 .
	gow√r
 = 
THIS_MODULE
,

1377 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1380 
ssize_t
 
	$©h6kl_rx_dr›_›î©i⁄_ªad
(
fûe
 *file,

1381 
__u£r
 *
u£r_buf
,

1382 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1384 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1385 
buf
[64];

1386 
Àn
;

1388 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "RXággregation dropÖackets %s\n",

1389 (
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_DISABLE_RX_AGGR_DROP
)

1392  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1393 
	}
}

1395 
ssize_t
 
	$©h6kl_rx_dr›_›î©i⁄_wrôe
(
fûe
 *file,

1396 c⁄° 
__u£r
 *
u£r_buf
,

1397 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1399 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1400 
buf
[20];

1401 
size_t
 
Àn
;

1403 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1404 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1405  -
EFAULT
;

1407 
buf
[
Àn
] = '\0';

1408 i‡(
Àn
 > 0 && 
buf
[len - 1] == '\n')

1409 
buf
[
Àn
 - 1] = '\0';

1411 i‡(
	`°rˇ£cmp
(
buf
, "enable") == 0)

1412 
¨
->
c⁄f_Êags
 &=

1413 ~
ATH6KL_CONF_DISABLE_RX_AGGR_DROP
;

1414 i‡(
	`°rˇ£cmp
(
buf
, "disable") == 0)

1415 
¨
->
c⁄f_Êags
 |=

1416 
ATH6KL_CONF_DISABLE_RX_AGGR_DROP
;

1418  -
EINVAL
;

1420  
cou¡
;

1421 
	}
}

1423 c⁄° 
fûe_›î©i⁄s
 
	gf›s_rx_dr›_›î©i⁄
 = {

1424 .
ªad
 = 
©h6kl_rx_dr›_›î©i⁄_ªad
,

1425 .
	gwrôe
 = 
©h6kl_rx_dr›_›î©i⁄_wrôe
,

1426 .
	g›í
 = 
©h6kl_debugfs_›í
,

1427 .
	gow√r
 = 
THIS_MODULE
,

1428 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1431 
ssize_t
 
	$©h6kl_ªgwrôe_ªad
(
fûe
 *file,

1432 
__u£r
 *
u£r_buf
,

1433 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1435 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1436 
u8
 
buf
[32];

1437 
Àn
 = 0;

1439 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "Addr: 0x%x Val: 0x%x\n",

1440 
¨
->
debug
.
düg_ªg_addr_wr
,ár->debug.
düg_ªg_vÆ_wr
);

1442  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1443 
	}
}

1445 
ssize_t
 
	$©h6kl_ªgwrôe_wrôe
(
fûe
 *file,

1446 c⁄° 
__u£r
 *
u£r_buf
,

1447 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1449 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1450 
buf
[32];

1451 *
•å
, *
tokí
;

1452 
Àn
 = 0;

1453 
u32
 
ªg_addr
, 
ªg_vÆ
;

1455 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1456 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1457  -
EFAULT
;

1459 
buf
[
Àn
] = '\0';

1460 
•å
 = 
buf
;

1462 
tokí
 = 
	`°r£p
(&
•å
, "=");

1463 i‡(!
tokí
)

1464  -
EINVAL
;

1466 i‡(
	`k°πou32
(
tokí
, 0, &
ªg_addr
))

1467  -
EINVAL
;

1469 i‡(!
	`©h6kl_dbg_is_düg_ªg_vÆid
(
ªg_addr
))

1470  -
EINVAL
;

1472 i‡(
	`k°πou32
(
•å
, 0, &
ªg_vÆ
))

1473  -
EINVAL
;

1475 
¨
->
debug
.
düg_ªg_addr_wr
 = 
ªg_addr
;

1476 
¨
->
debug
.
düg_ªg_vÆ_wr
 = 
ªg_vÆ
;

1478 i‡(
	`©h6kl_düg_wrôe32
(
¨
,ár->
debug
.
düg_ªg_addr_wr
,

1479 
	`˝u_to_À32
(
¨
->
debug
.
düg_ªg_vÆ_wr
)))

1480  -
EIO
;

1482  
cou¡
;

1483 
	}
}

1485 c⁄° 
fûe_›î©i⁄s
 
	gf›s_düg_ªg_wrôe
 = {

1486 .
ªad
 = 
©h6kl_ªgwrôe_ªad
,

1487 .
	gwrôe
 = 
©h6kl_ªgwrôe_wrôe
,

1488 .
	g›í
 = 
©h6kl_debugfs_›í
,

1489 .
	gow√r
 = 
THIS_MODULE
,

1490 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1493 
	$©h6kl_debug_rﬂm_tbl_evít
(
©h6kl
 *
¨
, c⁄° *
buf
,

1494 
size_t
 
Àn
)

1496 c⁄° 
wmi_èrgë_rﬂm_tbl
 *
tbl
;

1497 
u16
 
num_íåõs
;

1499 i‡(
Àn
 < (*
tbl
))

1500  -
EINVAL
;

1502 
tbl
 = (c⁄° 
wmi_èrgë_rﬂm_tbl
 *Ë
buf
;

1503 
num_íåõs
 = 
	`À16_to_˝u
(
tbl
->num_entries);

1504 i‡((*
tbl
Ë+ 
num_íåõs
 * (
wmi_bss_rﬂm_öfo
) >

1505 
Àn
)

1506  -
EINVAL
;

1508 i‡(
¨
->
debug
.
rﬂm_tbl
 =
NULL
 ||

1509 
¨
->
debug
.
rﬂm_tbl_Àn
 < (Ë
Àn
) {

1510 
	`k‰ì
(
¨
->
debug
.
rﬂm_tbl
);

1511 
¨
->
debug
.
rﬂm_tbl
 = 
	`kmÆloc
(
Àn
, 
GFP_ATOMIC
);

1512 i‡(
¨
->
debug
.
rﬂm_tbl
 =
NULL
)

1513  -
ENOMEM
;

1516 
	`mem˝y
(
¨
->
debug
.
rﬂm_tbl
, 
buf
, 
Àn
);

1517 
¨
->
debug
.
rﬂm_tbl_Àn
 = 
Àn
;

1519 i‡(
	`ã°_bô
(
ROAM_TBL_PEND
, &
¨
->
Êag
)) {

1520 
	`˛ór_bô
(
ROAM_TBL_PEND
, &
¨
->
Êag
);

1521 
	`wake_up
(&
¨
->
evít_wq
);

1525 
	}
}

1527 
ssize_t
 
	$©h6kl_rﬂm_èbÀ_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1528 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1530 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1531 
ªt
;

1532 
À·
;

1533 
wmi_èrgë_rﬂm_tbl
 *
tbl
;

1534 
u16
 
num_íåõs
, 
i
;

1535 *
buf
;

1536 
Àn
, 
buf_Àn
;

1537 
ssize_t
 
ªt_˙t
;

1539 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
))

1540  -
EBUSY
;

1542 
	`£t_bô
(
ROAM_TBL_PEND
, &
¨
->
Êag
);

1544 
ªt
 = 
	`©h6kl_wmi_gë_rﬂm_tbl_cmd
(
¨
->
wmi
);

1545 i‡(
ªt
) {

1546 
	`up
(&
¨
->
£m
);

1547  
ªt
;

1550 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(

1551 
¨
->
evít_wq
, !
	`ã°_bô
(
ROAM_TBL_PEND
, &¨->
Êag
), 
WMI_TIMEOUT
);

1552 
	`up
(&
¨
->
£m
);

1554 i‡(
À·
 <= 0)

1555  -
ETIMEDOUT
;

1557 i‡(
¨
->
debug
.
rﬂm_tbl
 =
NULL
)

1558  -
ENOMEM
;

1560 
tbl
 = (
wmi_èrgë_rﬂm_tbl
 *Ë
¨
->
debug
.
rﬂm_tbl
;

1561 
num_íåõs
 = 
	`À16_to_˝u
(
tbl
->num_entries);

1563 
buf_Àn
 = 100 + 
num_íåõs
 * 100;

1564 
buf
 = 
	`kzÆloc
(
buf_Àn
, 
GFP_KERNEL
);

1565 i‡(
buf
 =
NULL
)

1566  -
ENOMEM
;

1567 
Àn
 = 0;

1568 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1571 
	`À16_to_˝u
(
tbl
->
rﬂm_mode
));

1573 
i
 = 0; i < 
num_íåõs
; i++) {

1574 
wmi_bss_rﬂm_öfo
 *
öfo
 = &
tbl
->öfo[
i
];

1575 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1577 
	`a_¶e32_to_˝u
(
öfo
->
rﬂm_utû
), info->
bssid
,

1578 
öfo
->
rssi
, info->
rssidt
, info->
œ°_rssi
,

1579 
öfo
->
utû
, info->
büs
);

1582 i‡(
Àn
 > 
buf_Àn
)

1583 
Àn
 = 
buf_Àn
;

1585 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1587 
	`k‰ì
(
buf
);

1588  
ªt_˙t
;

1589 
	}
}

1591 c⁄° 
fûe_›î©i⁄s
 
	gf›s_rﬂm_èbÀ
 = {

1592 .
ªad
 = 
©h6kl_rﬂm_èbÀ_ªad
,

1593 .
	g›í
 = 
©h6kl_debugfs_›í
,

1594 .
	gow√r
 = 
THIS_MODULE
,

1595 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1598 
ssize_t
 
	$©h6kl_f‹˚_rﬂm_wrôe
(
fûe
 *file,

1599 c⁄° 
__u£r
 *
u£r_buf
,

1600 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1602 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1603 
ªt
;

1604 
buf
[20];

1605 
size_t
 
Àn
;

1606 
u8
 
bssid
[
ETH_ALEN
];

1607 
i
;

1608 
addr
[
ETH_ALEN
];

1610 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1611 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1612  -
EFAULT
;

1613 
buf
[
Àn
] = '\0';

1615 i‡(
	`ssˇnf
(
buf
, "%02x:%02x:%02x:%02x:%02x:%02x",

1616 &
addr
[0], &addr[1], &addr[2], &addr[3], &addr[4], &addr[5])

1617 !
ETH_ALEN
)

1618  -
EINVAL
;

1619 
i
 = 0; i < 
ETH_ALEN
; i++)

1620 
bssid
[
i
] = 
addr
[i];

1622 
ªt
 = 
	`©h6kl_wmi_f‹˚_rﬂm_cmd
(
¨
->
wmi
, 
bssid
);

1623 i‡(
ªt
)

1624  
ªt
;

1626  
cou¡
;

1627 
	}
}

1629 c⁄° 
fûe_›î©i⁄s
 
	gf›s_f‹˚_rﬂm
 = {

1630 .
wrôe
 = 
©h6kl_f‹˚_rﬂm_wrôe
,

1631 .
	g›í
 = 
©h6kl_debugfs_›í
,

1632 .
	gow√r
 = 
THIS_MODULE
,

1633 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1636 
ssize_t
 
	$©h6kl_rﬂm_mode_ªad
(
fûe
 *file,

1637 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1639 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1640 
u8
 
buf
[32];

1641 
Àn
 = 0;

1642 *
°r
;

1644 i‡(
¨
->
debug
.
rﬂm_mode
 =
WMI_DEFAULT_ROAM_MODE
)

1645 
°r
 = "default";

1646 i‡(
¨
->
debug
.
rﬂm_mode
 =
WMI_HOST_BIAS_ROAM_MODE
)

1647 
°r
 = "bssbias";

1648 i‡(
¨
->
debug
.
rﬂm_mode
 =
WMI_LOCK_BSS_MODE
)

1649 
°r
 = "lock";

1651 
°r
 = "NONE";

1653 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "roam mode: %s\n",

1654 
°r
);

1656  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1657 
	}
}

1659 
ssize_t
 
	$©h6kl_rﬂm_mode_wrôe
(
fûe
 *file,

1660 c⁄° 
__u£r
 *
u£r_buf
,

1661 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1663 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1664 
ªt
;

1665 
buf
[20];

1666 
size_t
 
Àn
;

1667 
wmi_rﬂm_mode
 
mode
;

1669 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1670 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1671  -
EFAULT
;

1672 
buf
[
Àn
] = '\0';

1673 i‡(
Àn
 > 0 && 
buf
[len - 1] == '\n')

1674 
buf
[
Àn
 - 1] = '\0';

1676 i‡(
	`°rˇ£cmp
(
buf
, "default") == 0)

1677 
mode
 = 
WMI_DEFAULT_ROAM_MODE
;

1678 i‡(
	`°rˇ£cmp
(
buf
, "bssbias") == 0)

1679 
mode
 = 
WMI_HOST_BIAS_ROAM_MODE
;

1680 i‡(
	`°rˇ£cmp
(
buf
, "lock") == 0)

1681 
mode
 = 
WMI_LOCK_BSS_MODE
;

1683  -
EINVAL
;

1685 
¨
->
debug
.
rﬂm_mode
 = 
mode
;

1687 
ªt
 = 
	`©h6kl_wmi_£t_rﬂm_mode_cmd
(
¨
->
wmi
, 
mode
);

1688 i‡(
ªt
)

1689  
ªt
;

1691  
cou¡
;

1692 
	}
}

1694 c⁄° 
fûe_›î©i⁄s
 
	gf›s_rﬂm_mode
 = {

1695 .
ªad
 = 
©h6kl_rﬂm_mode_ªad
,

1696 .
	gwrôe
 = 
©h6kl_rﬂm_mode_wrôe
,

1697 .
	g›í
 = 
©h6kl_debugfs_›í
,

1698 .
	gow√r
 = 
THIS_MODULE
,

1699 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1702 
ssize_t
 
	$©h6kl_rﬂm_5g_büs_ªad
(
fûe
 *file,

1703 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1705 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1706 
u8
 
buf
[32];

1707 
Àn
 = 0;

1709 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "roam 5g bias: %d\n",

1710 
¨
->
debug
.
rﬂm_5g_büs
);

1712  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1713 
	}
}

1715 
ssize_t
 
	$©h6kl_rﬂm_5g_büs_wrôe
(
fûe
 *file,

1716 c⁄° 
__u£r
 *
u£r_buf
,

1717 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1719 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1720 
ªt
;

1721 
u8
 
büs_5g
;

1723 
ªt
 = 
	`k°πou8_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
büs_5g
);

1724 i‡(
ªt
)

1725  
ªt
;

1727 
¨
->
debug
.
rﬂm_5g_büs
 = 
büs_5g
;

1729 
ªt
 = 
	`©h6kl_wmi_£t_rﬂm_5g_büs_cmd
(
¨
->
wmi
, 
büs_5g
);

1730 i‡(
ªt
)

1731  
ªt
;

1733  
cou¡
;

1734 
	}
}

1736 c⁄° 
fûe_›î©i⁄s
 
	gf›s_rﬂm_5g_büs
 = {

1737 .
ªad
 = 
©h6kl_rﬂm_5g_büs_ªad
,

1738 .
	gwrôe
 = 
©h6kl_rﬂm_5g_büs_wrôe
,

1739 .
	g›í
 = 
©h6kl_debugfs_›í
,

1740 .
	gow√r
 = 
THIS_MODULE
,

1741 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1744 
	$©h6kl_debug_£t_kì∑live
(
©h6kl
 *
¨
, 
u8
 
kì∑live
)

1746 
¨
->
debug
.
kì∑live
 = keepalive;

1747 
	}
}

1749 
ssize_t
 
	$©h6kl_kì∑live_ªad
(
fûe
 *fûe, 
__u£r
 *
u£r_buf
,

1750 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1752 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1753 
buf
[16];

1754 
Àn
;

1756 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "%u\n", 
¨
->
debug
.
kì∑live
);

1758  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1759 
	}
}

1761 
ssize_t
 
	$©h6kl_kì∑live_wrôe
(
fûe
 *file,

1762 c⁄° 
__u£r
 *
u£r_buf
,

1763 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1765 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1766 
ªt
;

1767 
u8
 
vÆ
;

1769 
ªt
 = 
	`k°πou8_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
vÆ
);

1770 i‡(
ªt
)

1771  
ªt
;

1773 
ªt
 = 
	`©h6kl_wmi_£t_kì∑live_cmd
(
¨
->
wmi
, 0, 
vÆ
);

1774 i‡(
ªt
)

1775  
ªt
;

1777  
cou¡
;

1778 
	}
}

1780 c⁄° 
fûe_›î©i⁄s
 
	gf›s_kì∑live
 = {

1781 .
›í
 = 
©h6kl_debugfs_›í
,

1782 .
	gªad
 = 
©h6kl_kì∑live_ªad
,

1783 .
	gwrôe
 = 
©h6kl_kì∑live_wrôe
,

1784 .
	gow√r
 = 
THIS_MODULE
,

1785 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1788 
	$©h6kl_debug_£t_disc⁄√˘_timeout
(
©h6kl
 *
¨
, 
u8
 
timeout
)

1790 
¨
->
debug
.
disc_timeout
 = 
timeout
;

1791 
	}
}

1793 
ssize_t
 
	$©h6kl_disc⁄√˘_timeout_ªad
(
fûe
 *file,

1794 
__u£r
 *
u£r_buf
,

1795 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1797 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1798 
buf
[16];

1799 
Àn
;

1801 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "%u\n", 
¨
->
debug
.
disc_timeout
);

1803  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

1804 
	}
}

1806 
ssize_t
 
	$©h6kl_disc⁄√˘_timeout_wrôe
(
fûe
 *file,

1807 c⁄° 
__u£r
 *
u£r_buf
,

1808 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1810 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1811 
ªt
;

1812 
u8
 
vÆ
;

1814 
ªt
 = 
	`k°πou8_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
vÆ
);

1815 i‡(
ªt
)

1816  
ªt
;

1818 
ªt
 = 
	`©h6kl_wmi_dis˘imeout_cmd
(
¨
->
wmi
, 0, 
vÆ
);

1819 i‡(
ªt
)

1820  
ªt
;

1822  
cou¡
;

1823 
	}
}

1825 c⁄° 
fûe_›î©i⁄s
 
	gf›s_disc⁄√˘_timeout
 = {

1826 .
›í
 = 
©h6kl_debugfs_›í
,

1827 .
	gªad
 = 
©h6kl_disc⁄√˘_timeout_ªad
,

1828 .
	gwrôe
 = 
©h6kl_disc⁄√˘_timeout_wrôe
,

1829 .
	gow√r
 = 
THIS_MODULE
,

1830 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

1833 
ssize_t
 
	$©h6kl_¸óã_qos_wrôe
(
fûe
 *file,

1834 c⁄° 
__u£r
 *
u£r_buf
,

1835 
size_t
 
cou¡
, 
loff_t
 *
µos
)

1838 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

1839 
©h6kl_vif
 *
vif
;

1840 
buf
[200];

1841 
ssize_t
 
Àn
;

1842 *
•å
, *
tokí
;

1843 
wmi_¸óã_p°ªam_cmd
 
p°ªam
;

1844 
u32
 
vÆ32
;

1845 
u16
 
vÆ16
;

1847 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

1848 i‡(!
vif
)

1849  -
EIO
;

1851 
	`mem£t
(&
p°ªam
, 0x00, (
wmi_¸óã_p°ªam_cmd
));

1852 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

1853 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

1854  -
EFAULT
;

1855 
buf
[
Àn
] = '\0';

1856 
•å
 = 
buf
;

1858 
tokí
 = 
	`°r£p
(&
•å
, " ");

1859 i‡(!
tokí
)

1860  -
EINVAL
;

1861 i‡(
	`k°πou8
(
tokí
, 0, &
p°ªam
.
u£r_¥i
))

1862  -
EINVAL
;

1864 
tokí
 = 
	`°r£p
(&
•å
, " ");

1865 i‡(!
tokí
)

1866  -
EINVAL
;

1867 i‡(
	`k°πou8
(
tokí
, 0, &
p°ªam
.
åaffic_dúec
))

1868  -
EINVAL
;

1870 
tokí
 = 
	`°r£p
(&
•å
, " ");

1871 i‡(!
tokí
)

1872  -
EINVAL
;

1873 i‡(
	`k°πou8
(
tokí
, 0, &
p°ªam
.
åaffic_˛ass
))

1874  -
EINVAL
;

1876 
tokí
 = 
	`°r£p
(&
•å
, " ");

1877 i‡(!
tokí
)

1878  -
EINVAL
;

1879 i‡(
	`k°πou8
(
tokí
, 0, &
p°ªam
.
åaffic_ty≥
))

1880  -
EINVAL
;

1882 
tokí
 = 
	`°r£p
(&
•å
, " ");

1883 i‡(!
tokí
)

1884  -
EINVAL
;

1885 i‡(
	`k°πou8
(
tokí
, 0, &
p°ªam
.
voi˚_psc_ˇp
))

1886  -
EINVAL
;

1888 
tokí
 = 
	`°r£p
(&
•å
, " ");

1889 i‡(!
tokí
)

1890  -
EINVAL
;

1891 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1892  -
EINVAL
;

1893 
p°ªam
.
mö_£rvi˚_öt
 = 
	`˝u_to_À32
(
vÆ32
);

1895 
tokí
 = 
	`°r£p
(&
•å
, " ");

1896 i‡(!
tokí
)

1897  -
EINVAL
;

1898 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1899  -
EINVAL
;

1900 
p°ªam
.
max_£rvi˚_öt
 = 
	`˝u_to_À32
(
vÆ32
);

1902 
tokí
 = 
	`°r£p
(&
•å
, " ");

1903 i‡(!
tokí
)

1904  -
EINVAL
;

1905 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1906  -
EINVAL
;

1907 
p°ªam
.
öa˘ivôy_öt
 = 
	`˝u_to_À32
(
vÆ32
);

1909 
tokí
 = 
	`°r£p
(&
•å
, " ");

1910 i‡(!
tokí
)

1911  -
EINVAL
;

1912 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1913  -
EINVAL
;

1914 
p°ªam
.
su•ísi⁄_öt
 = 
	`˝u_to_À32
(
vÆ32
);

1916 
tokí
 = 
	`°r£p
(&
•å
, " ");

1917 i‡(!
tokí
)

1918  -
EINVAL
;

1919 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1920  -
EINVAL
;

1921 
p°ªam
.
£rvi˚_°¨t_time
 = 
	`˝u_to_À32
(
vÆ32
);

1923 
tokí
 = 
	`°r£p
(&
•å
, " ");

1924 i‡(!
tokí
)

1925  -
EINVAL
;

1926 i‡(
	`k°πou8
(
tokí
, 0, &
p°ªam
.
tsid
))

1927  -
EINVAL
;

1929 
tokí
 = 
	`°r£p
(&
•å
, " ");

1930 i‡(!
tokí
)

1931  -
EINVAL
;

1932 i‡(
	`k°πou16
(
tokí
, 0, &
vÆ16
))

1933  -
EINVAL
;

1934 
p°ªam
.
nomöÆ_msdu
 = 
	`˝u_to_À16
(
vÆ16
);

1936 
tokí
 = 
	`°r£p
(&
•å
, " ");

1937 i‡(!
tokí
)

1938  -
EINVAL
;

1939 i‡(
	`k°πou16
(
tokí
, 0, &
vÆ16
))

1940  -
EINVAL
;

1941 
p°ªam
.
max_msdu
 = 
	`˝u_to_À16
(
vÆ16
);

1943 
tokí
 = 
	`°r£p
(&
•å
, " ");

1944 i‡(!
tokí
)

1945  -
EINVAL
;

1946 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1947  -
EINVAL
;

1948 
p°ªam
.
mö_d©a_øã
 = 
	`˝u_to_À32
(
vÆ32
);

1950 
tokí
 = 
	`°r£p
(&
•å
, " ");

1951 i‡(!
tokí
)

1952  -
EINVAL
;

1953 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1954  -
EINVAL
;

1955 
p°ªam
.
món_d©a_øã
 = 
	`˝u_to_À32
(
vÆ32
);

1957 
tokí
 = 
	`°r£p
(&
•å
, " ");

1958 i‡(!
tokí
)

1959  -
EINVAL
;

1960 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1961  -
EINVAL
;

1962 
p°ªam
.
≥ak_d©a_øã
 = 
	`˝u_to_À32
(
vÆ32
);

1964 
tokí
 = 
	`°r£p
(&
•å
, " ");

1965 i‡(!
tokí
)

1966  -
EINVAL
;

1967 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1968  -
EINVAL
;

1969 
p°ªam
.
max_bur°_size
 = 
	`˝u_to_À32
(
vÆ32
);

1971 
tokí
 = 
	`°r£p
(&
•å
, " ");

1972 i‡(!
tokí
)

1973  -
EINVAL
;

1974 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1975  -
EINVAL
;

1976 
p°ªam
.
dñay_bound
 = 
	`˝u_to_À32
(
vÆ32
);

1978 
tokí
 = 
	`°r£p
(&
•å
, " ");

1979 i‡(!
tokí
)

1980  -
EINVAL
;

1981 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1982  -
EINVAL
;

1983 
p°ªam
.
mö_phy_øã
 = 
	`˝u_to_À32
(
vÆ32
);

1985 
tokí
 = 
	`°r£p
(&
•å
, " ");

1986 i‡(!
tokí
)

1987  -
EINVAL
;

1988 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1989  -
EINVAL
;

1990 
p°ªam
.
sba
 = 
	`˝u_to_À32
(
vÆ32
);

1992 
tokí
 = 
	`°r£p
(&
•å
, " ");

1993 i‡(!
tokí
)

1994  -
EINVAL
;

1995 i‡(
	`k°πou32
(
tokí
, 0, &
vÆ32
))

1996  -
EINVAL
;

1997 
p°ªam
.
medium_time
 = 
	`˝u_to_À32
(
vÆ32
);

1999 
	`©h6kl_wmi_¸óã_p°ªam_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, &
p°ªam
);

2001  
cou¡
;

2002 
	}
}

2004 c⁄° 
fûe_›î©i⁄s
 
	gf›s_¸óã_qos
 = {

2005 .
wrôe
 = 
©h6kl_¸óã_qos_wrôe
,

2006 .
	g›í
 = 
©h6kl_debugfs_›í
,

2007 .
	gow√r
 = 
THIS_MODULE
,

2008 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2011 
ssize_t
 
	$©h6kl_dñëe_qos_wrôe
(
fûe
 *file,

2012 c⁄° 
__u£r
 *
u£r_buf
,

2013 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2016 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2017 
©h6kl_vif
 *
vif
;

2018 
buf
[100];

2019 
ssize_t
 
Àn
;

2020 *
•å
, *
tokí
;

2021 
u8
 
åaffic_˛ass
;

2022 
u8
 
tsid
;

2024 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

2025 i‡(!
vif
)

2026  -
EIO
;

2028 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2029 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2030  -
EFAULT
;

2031 
buf
[
Àn
] = '\0';

2032 
•å
 = 
buf
;

2034 
tokí
 = 
	`°r£p
(&
•å
, " ");

2035 i‡(!
tokí
)

2036  -
EINVAL
;

2037 i‡(
	`k°πou8
(
tokí
, 0, &
åaffic_˛ass
))

2038  -
EINVAL
;

2040 
tokí
 = 
	`°r£p
(&
•å
, " ");

2041 i‡(!
tokí
)

2042  -
EINVAL
;

2043 i‡(
	`k°πou8
(
tokí
, 0, &
tsid
))

2044  -
EINVAL
;

2046 
	`©h6kl_wmi_dñëe_p°ªam_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

2047 
åaffic_˛ass
, 
tsid
);

2049  
cou¡
;

2050 
	}
}

2052 c⁄° 
fûe_›î©i⁄s
 
	gf›s_dñëe_qos
 = {

2053 .
wrôe
 = 
©h6kl_dñëe_qos_wrôe
,

2054 .
	g›í
 = 
©h6kl_debugfs_›í
,

2055 .
	gow√r
 = 
THIS_MODULE
,

2056 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2059 
ssize_t
 
	$©h6kl_bgsˇn_öt_ªad
(
fûe
 *file,

2060 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2062 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2063 
u8
 
buf
[128];

2064 
Àn
 = 0;

2066 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "bgscan interval: %d\n",

2067 
¨
->
debug
.
bgsˇn_öt
);

2069  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2070 
	}
}

2072 
ssize_t
 
	$©h6kl_bgsˇn_öt_wrôe
(
fûe
 *file,

2073 c⁄° 
__u£r
 *
u£r_buf
,

2074 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2076 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2077 
©h6kl_vif
 *
vif
;

2078 
u16
 
bgsˇn_öt
;

2079 
buf
[32];

2080 
ssize_t
 
Àn
;

2082 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

2083 i‡(!
vif
)

2084  -
EIO
;

2086 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2087 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2088  -
EFAULT
;

2090 
buf
[
Àn
] = '\0';

2091 i‡(
	`k°πou16
(
buf
, 0, &
bgsˇn_öt
))

2092  -
EINVAL
;

2094 i‡(
bgsˇn_öt
 == 0)

2095 
bgsˇn_öt
 = 0xffff;

2097 
¨
->
debug
.
bgsˇn_öt
 = bgscan_int;

2099 
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
¨
->
wmi
, 0,

2100 
vif
->
sc_∑øms
.
fg_°¨t_≥riod
,

2101 
vif
->
sc_∑øms
.
fg_íd_≥riod
,

2102 
bgsˇn_öt
,

2103 
vif
->
sc_∑øms
.
möa˘_chdwñl_time
,

2104 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
,

2105 
vif
->
sc_∑øms
.
∑s_chdwñl_time
,

2106 
vif
->
sc_∑øms
.
sh‹t_sˇn_øtio
,

2107 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
,

2108 
vif
->
sc_∑øms
.
max_dfsch_a˘_time
,

2109 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
);

2111  
cou¡
;

2112 
	}
}

2114 c⁄° 
fûe_›î©i⁄s
 
	gf›s_bgsˇn_öt
 = {

2115 .
ªad
 = 
©h6kl_bgsˇn_öt_ªad
,

2116 .
	gwrôe
 = 
©h6kl_bgsˇn_öt_wrôe
,

2117 .
	g›í
 = 
©h6kl_debugfs_›í
,

2118 .
	gow√r
 = 
THIS_MODULE
,

2119 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2122 
ssize_t
 
	$©h6kl_li°í_öt_wrôe
(
fûe
 *file,

2123 c⁄° 
__u£r
 *
u£r_buf
,

2124 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2126 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2127 
u16
 
li°í_öt_t
, 
li°í_öt_b
;

2128 
buf
[32];

2129 *
•å
, *
tokí
;

2130 
ssize_t
 
Àn
;

2132 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2133 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2134  -
EFAULT
;

2136 
buf
[
Àn
] = '\0';

2137 
•å
 = 
buf
;

2139 
tokí
 = 
	`°r£p
(&
•å
, " ");

2140 i‡(!
tokí
)

2141  -
EINVAL
;

2143 i‡(
	`k°πou16
(
tokí
, 0, &
li°í_öt_t
))

2144  -
EINVAL
;

2146 i‡(
	`k°πou16
(
•å
, 0, &
li°í_öt_b
))

2147  -
EINVAL
;

2149 i‡((
li°í_öt_t
 < 15) || (listen_int_t > 5000))

2150  -
EINVAL
;

2152 i‡((
li°í_öt_b
 < 1) || (listen_int_b > 50))

2153  -
EINVAL
;

2155 
¨
->
li°í_ötvl_t
 = 
li°í_öt_t
;

2156 
¨
->
li°í_ötvl_b
 = 
li°í_öt_b
;

2158 
	`©h6kl_wmi_li°íöãrvÆ_cmd
(
¨
->
wmi
, 0,ár->
li°í_ötvl_t
,

2159 
¨
->
li°í_ötvl_b
);

2161  
cou¡
;

2162 
	}
}

2164 
ssize_t
 
	$©h6kl_li°í_öt_ªad
(
fûe
 *file,

2165 
__u£r
 *
u£r_buf
,

2166 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2168 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2169 
buf
[32];

2170 
Àn
;

2172 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "%u %u\n", 
¨
->
li°í_ötvl_t
,

2173 
¨
->
li°í_ötvl_b
);

2175  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2176 
	}
}

2178 c⁄° 
fûe_›î©i⁄s
 
	gf›s_li°í_öt
 = {

2179 .
ªad
 = 
©h6kl_li°í_öt_ªad
,

2180 .
	gwrôe
 = 
©h6kl_li°í_öt_wrôe
,

2181 .
	g›í
 = 
©h6kl_debugfs_›í
,

2182 .
	gow√r
 = 
THIS_MODULE
,

2183 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2186 
ssize_t
 
	$©h6kl_powî_∑øms_wrôe
(
fûe
 *file,

2187 c⁄° 
__u£r
 *
u£r_buf
,

2188 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2190 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2191 
u8
 
buf
[100];

2192 
Àn
 = 0;

2193 *
•å
, *
tokí
;

2194 
u16
 
idÀ_≥riod
, 
ps_pﬁl_num
, 
dtim
,

2195 
tx_wakeup
, 
num_tx
;

2197 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2198 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2199  -
EFAULT
;

2200 
buf
[
Àn
] = '\0';

2201 
•å
 = 
buf
;

2203 
tokí
 = 
	`°r£p
(&
•å
, " ");

2204 i‡(!
tokí
)

2205  -
EINVAL
;

2206 i‡(
	`k°πou16
(
tokí
, 0, &
idÀ_≥riod
))

2207  -
EINVAL
;

2209 
tokí
 = 
	`°r£p
(&
•å
, " ");

2210 i‡(!
tokí
)

2211  -
EINVAL
;

2212 i‡(
	`k°πou16
(
tokí
, 0, &
ps_pﬁl_num
))

2213  -
EINVAL
;

2215 
tokí
 = 
	`°r£p
(&
•å
, " ");

2216 i‡(!
tokí
)

2217  -
EINVAL
;

2218 i‡(
	`k°πou16
(
tokí
, 0, &
dtim
))

2219  -
EINVAL
;

2221 
tokí
 = 
	`°r£p
(&
•å
, " ");

2222 i‡(!
tokí
)

2223  -
EINVAL
;

2224 i‡(
	`k°πou16
(
tokí
, 0, &
tx_wakeup
))

2225  -
EINVAL
;

2227 
tokí
 = 
	`°r£p
(&
•å
, " ");

2228 i‡(!
tokí
)

2229  -
EINVAL
;

2230 i‡(
	`k°πou16
(
tokí
, 0, &
num_tx
))

2231  -
EINVAL
;

2233 
¨
->
debug
.
powî_∑øms
.
idÀ_≥riod
 = idle_period;

2234 
¨
->
debug
.
powî_∑øms
.
ps_pﬁl_num
 =Ös_poll_num;

2235 
¨
->
debug
.
powî_∑øms
.
dtim
 = dtim;

2236 
¨
->
debug
.
powî_∑øms
.
tx_wakeup
 =Åx_wakeup;

2237 
¨
->
debug
.
powî_∑øms
.
num_tx
 =Çum_tx;

2239 
	`©h6kl_wmi_pm∑øms_cmd
(
¨
->
wmi
, 0, 
idÀ_≥riod
, 
ps_pﬁl_num
,

2240 
dtim
, 
tx_wakeup
, 
num_tx
, 0);

2242  
cou¡
;

2243 
	}
}

2245 
ssize_t
 
	$©h6kl_powî_∑øms_ªad
(
fûe
 *file,

2246 
__u£r
 *
u£r_buf
,

2247 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2249 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2250 
u8
 
buf
[256];

2251 
Àn
 = 0;

2253 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf),

2255 
¨
->
debug
.
powî_∑øms
.
idÀ_≥riod
,

2256 
¨
->
debug
.
powî_∑øms
.
ps_pﬁl_num
,

2257 
¨
->
debug
.
powî_∑øms
.
dtim
,

2258 
¨
->
debug
.
powî_∑øms
.
tx_wakeup
,

2259 
¨
->
debug
.
powî_∑øms
.
num_tx
);

2261  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2262 
	}
}

2264 c⁄° 
fûe_›î©i⁄s
 
	gf›s_powî_∑øms
 = {

2265 .
ªad
 = 
©h6kl_powî_∑øms_ªad
,

2266 .
	gwrôe
 = 
©h6kl_powî_∑øms_wrôe
,

2267 .
	g›í
 = 
©h6kl_debugfs_›í
,

2268 .
	gow√r
 = 
THIS_MODULE
,

2269 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2272 
	$©h6kl_∑r£_Õl_f‹˚_íabÀ_∑øms
(c⁄° 
__u£r
 *
u£r_buf
,

2273 
size_t
 
cou¡
,

2274 
Õl_f‹˚_íabÀ_∑øm
 *
∑øm
)

2276 
buf
[64];

2277 *
p
;

2278 
Àn
;

2279 
vÆue
;

2281 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2282 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2283  -
EFAULT
;

2285 
p
 = 
buf
;

2287 
SKIP_SPACE
;

2289 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2290 
∑øm
->
Õl_pﬁicy
 = 
vÆue
;

2292 
SEEK_SPACE
;

2293 
SKIP_SPACE
;

2295 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2296 
∑øm
->
no_blockî_dëe˘
 = 
vÆue
;

2298 
SEEK_SPACE
;

2299 
SKIP_SPACE
;

2301 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2302 
∑øm
->
no_rfb_dëe˘
 = 
vÆue
;

2305 
	}
}

2308 
ssize_t
 
	$©h6kl_Õl_f‹˚_íabÀ_wrôe
(
fûe
 *file,

2309 c⁄° 
__u£r
 *
u£r_buf
,

2310 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2312 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2313 
ªt
;

2315 
ªt
 = 
	`©h6kl_∑r£_Õl_f‹˚_íabÀ_∑øms
(
u£r_buf
, 
cou¡
,

2316 &
¨
->
debug
.
Õl_f‹˚_íabÀ_∑øms
);

2317 i‡(
ªt
)

2318  
ªt
;

2320 i‡(
	`©h6kl_wmi_Õl_íabÀ_cmd
(
¨
->
wmi
,

2321 (
wmi_Õl_f‹˚_íabÀ_cmd
 *)

2322 &
¨
->
debug
.
Õl_f‹˚_íabÀ_∑øms
))

2323  -
EIO
;

2325  
cou¡
;

2326 
	}
}

2328 
ssize_t
 
	$©h6kl_Õl_f‹˚_íabÀ_ªad
(
fûe
 *file,

2329 
__u£r
 *
u£r_buf
,

2330 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2332 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2333 
u8
 
buf
[128];

2334 
Àn
 = 0;

2336 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf),

2338 
¨
->
debug
.
Õl_f‹˚_íabÀ_∑øms
.
Õl_pﬁicy
,

2339 
¨
->
debug
.
Õl_f‹˚_íabÀ_∑øms
.
no_blockî_dëe˘
,

2340 
¨
->
debug
.
Õl_f‹˚_íabÀ_∑øms
.
no_rfb_dëe˘
);

2342  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2343 
	}
}

2346 c⁄° 
fûe_›î©i⁄s
 
	gf›s_Õl_f‹˚_íabÀ
 = {

2347 .
ªad
 = 
©h6kl_Õl_f‹˚_íabÀ_ªad
,

2348 .
	gwrôe
 = 
©h6kl_Õl_f‹˚_íabÀ_wrôe
,

2349 .
	g›í
 = 
©h6kl_debugfs_›í
,

2350 .
	gow√r
 = 
THIS_MODULE
,

2351 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2355 
ssize_t
 
	$©h6kl_mimo_ps_íabÀ_wrôe
(
fûe
 *file,

2356 c⁄° 
__u£r
 *
u£r_buf
,

2357 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2359 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2360 
ªt
;

2362 
ªt
 = 
	`k°πou8_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
¨
->
debug
.
mimo_ps_íabÀ
);

2363 i‡(
ªt
)

2364  
ªt
;

2366 i‡(
	`©h6kl_wmi_smps_íabÀ
(
¨
->
wmi
,

2367 (
wmi_c⁄fig_íabÀ_cmd
 *)&
¨
->
debug
.
mimo_ps_íabÀ
))

2368  -
EIO
;

2370  
cou¡
;

2371 
	}
}

2373 
ssize_t
 
	$©h6kl_mimo_ps_íabÀ_ªad
(
fûe
 *file,

2374 
__u£r
 *
u£r_buf
,

2375 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2377 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2378 
u8
 
buf
[32];

2379 
Àn
 = 0;

2381 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "MIMO Power Saving: %d\n",

2382 
¨
->
debug
.
mimo_ps_íabÀ
);

2384  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2385 
	}
}

2388 c⁄° 
fûe_›î©i⁄s
 
	gf›s_mimo_ps_íabÀ
 = {

2389 .
ªad
 = 
©h6kl_mimo_ps_íabÀ_ªad
,

2390 .
	gwrôe
 = 
©h6kl_mimo_ps_íabÀ_wrôe
,

2391 .
	g›í
 = 
©h6kl_debugfs_›í
,

2392 .
	gow√r
 = 
THIS_MODULE
,

2393 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2396 
	$©h6kl_∑r£_mimo_ps_∑øms
(c⁄° 
__u£r
 *
u£r_buf
,

2397 
size_t
 
cou¡
,

2398 
smps_∑øm
 *
∑øm
)

2400 
buf
[64];

2401 *
p
;

2402 
Àn
;

2403 
vÆue
;

2405 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2406 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2407  -
EFAULT
;

2409 
p
 = 
buf
;

2411 
SKIP_SPACE
;

2413 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2415 i‡(
vÆue
 == 1)

2416 
∑øm
->
mode
 = 
WMI_SMPS_MODE_STATIC
;

2417 i‡(
vÆue
 == 2)

2418 
∑øm
->
mode
 = 
WMI_SMPS_MODE_DYNAMIC
;

2420  -
EINVAL
;

2422 
∑øm
->
Êags
 = 
WMI_SMPS_OPTION_MODE
;

2424 
SEEK_SPACE
;

2425 
SKIP_SPACE
;

2427 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2428 
∑øm
->
autom©ic
 = 
vÆue
;

2430 i‡(
vÆue
 == 0 || value == 1)

2431 
∑øm
->
Êags
 |
WMI_SMPS_OPTION_AUTO
;

2433 
SEEK_SPACE
;

2434 
SKIP_SPACE
;

2436 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2438 i‡(
vÆue
 != -1) {

2439 
∑øm
->
d©a_thªsh
 = 
vÆue
;

2440 
∑øm
->
Êags
 |
WMI_SMPS_OPTION_DATATHRESH
;

2443 
SEEK_SPACE
;

2444 
SKIP_SPACE
;

2446 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2448 i‡(
vÆue
 != -1) {

2449 
∑øm
->
rssi_thªsh
 = 
vÆue
;

2450 
∑øm
->
Êags
 |
WMI_SMPS_OPTION_RSSITHRESH
;

2454 
	}
}

2457 
ssize_t
 
	$©h6kl_mimo_ps_∑øms_wrôe
(
fûe
 *file,

2458 c⁄° 
__u£r
 *
u£r_buf
,

2459 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2461 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2462 
ªt
;

2464 
ªt
 = 
	`©h6kl_∑r£_mimo_ps_∑øms
(
u£r_buf
,

2465 
cou¡
, &
¨
->
debug
.
smps_∑øms
);

2466 i‡(
ªt
)

2467  
ªt
;

2469 i‡(
	`©h6kl_wmi_smps_c⁄fig
(
¨
->
wmi
,

2470 (
wmi_c⁄fig_smps_cmd
 *)&
¨
->
debug
.
smps_∑øms
))

2471  -
EIO
;

2473  
cou¡
;

2474 
	}
}

2476 
ssize_t
 
	$©h6kl_mimo_ps_∑øms_ªad
(
fûe
 *file,

2477 
__u£r
 *
u£r_buf
,

2478 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2480 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2481 
u8
 
buf
[128];

2482 
Àn
 = 0;

2484 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf),

2486 
¨
->
debug
.
smps_∑øms
.
Êags
,

2487 
¨
->
debug
.
smps_∑øms
.
mode
,

2488 
¨
->
debug
.
smps_∑øms
.
autom©ic
,

2489 
¨
->
debug
.
smps_∑øms
.
d©a_thªsh
,

2490 
¨
->
debug
.
smps_∑øms
.
rssi_thªsh
);

2492  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2493 
	}
}

2496 c⁄° 
fûe_›î©i⁄s
 
	gf›s_mimo_ps_∑øms
 = {

2497 .
ªad
 = 
©h6kl_mimo_ps_∑øms_ªad
,

2498 .
	gwrôe
 = 
©h6kl_mimo_ps_∑øms_wrôe
,

2499 .
	g›í
 = 
©h6kl_debugfs_›í
,

2500 .
	gow√r
 = 
THIS_MODULE
,

2501 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2506 
ssize_t
 
	$©h6kl_gªí_tx_wrôe
(
fûe
 *file,

2507 c⁄° 
__u£r
 *
u£r_buf
,

2508 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2510 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2511 
ªt
;

2513 
ªt
 = 
	`k°πou32_‰om_u£r
(
u£r_buf
, 
cou¡
, 0,

2514 &
¨
->
gªí_tx_∑øms
.
íabÀ
);

2516 i‡(
ªt
)

2517  
ªt
;

2519 i‡(
	`©h6kl_wmi_£t_gªí_tx_∑øms
(
¨
->
wmi
,

2520 (
wmi_gªí_tx_∑øms
 *Ë&
¨
->
gªí_tx_∑øms
))

2521  -
EIO
;

2523  
cou¡
;

2524 
	}
}

2526 
ssize_t
 
	$©h6kl_gªí_tx_ªad
(
fûe
 *file,

2527 
__u£r
 *
u£r_buf
,

2528 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2530 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2531 
u8
 
buf
[32];

2532 
Àn
 = 0;

2534 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "Green Tx: %d\n",

2535 
¨
->
gªí_tx_∑øms
.
íabÀ
);

2537  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2538 
	}
}

2541 c⁄° 
fûe_›î©i⁄s
 
	gf›s_gªí_tx
 = {

2542 .
ªad
 = 
©h6kl_gªí_tx_ªad
,

2543 .
	gwrôe
 = 
©h6kl_gªí_tx_wrôe
,

2544 .
	g›í
 = 
©h6kl_debugfs_›í
,

2545 .
	gow√r
 = 
THIS_MODULE
,

2546 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2549 
	$©h6kl_∑r£_gªí_tx_∑øms
(c⁄° 
__u£r
 *
u£r_buf
,

2550 
size_t
 
cou¡
,

2551 
wmi_gªí_tx_∑øms
 *
∑øm
)

2553 
buf
[64];

2554 *
p
;

2555 
Àn
;

2556 
vÆue
;

2558 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2559 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2560  -
EFAULT
;

2562 
p
 = 
buf
;

2564 
SKIP_SPACE
;

2566 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2567 
∑øm
->
√xt_¥obe_cou¡
 = 
vÆue
;

2569 
SEEK_SPACE
;

2570 
SKIP_SPACE
;

2572 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2573 
∑øm
->
max_back_off
 = 
vÆue
;

2575 
SEEK_SPACE
;

2576 
SKIP_SPACE
;

2578 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2579 
∑øm
->
mö_gtx_rssi
 = 
vÆue
;

2581 
SEEK_SPACE
;

2582 
SKIP_SPACE
;

2584 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2585 
∑øm
->
f‹˚_back_off
 = 
vÆue
;

2588 
	}
}

2590 
ssize_t
 
	$©h6kl_gªí_tx_∑øms_wrôe
(
fûe
 *file,

2591 c⁄° 
__u£r
 *
u£r_buf
,

2592 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2594 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2595 
ªt
;

2597 
ªt
 = 
	`©h6kl_∑r£_gªí_tx_∑øms
(
u£r_buf
,

2598 
cou¡
, &
¨
->
gªí_tx_∑øms
);

2600 i‡(
ªt
)

2601  
ªt
;

2603 i‡(
	`©h6kl_wmi_£t_gªí_tx_∑øms
(
¨
->
wmi
,

2604 (
wmi_gªí_tx_∑øms
 *Ë&
¨
->
gªí_tx_∑øms
))

2605  -
EIO
;

2607  
cou¡
;

2608 
	}
}

2610 
ssize_t
 
	$©h6kl_gªí_tx_∑øms_ªad
(
fûe
 *file,

2611 
__u£r
 *
u£r_buf
,

2612 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2614 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2615 
u8
 
buf
[128];

2616 
Àn
 = 0;

2618 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf),

2620 
¨
->
gªí_tx_∑øms
.
√xt_¥obe_cou¡
,

2621 
¨
->
gªí_tx_∑øms
.
max_back_off
,

2622 
¨
->
gªí_tx_∑øms
.
mö_gtx_rssi
,

2623 
¨
->
gªí_tx_∑øms
.
f‹˚_back_off
);

2625  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2626 
	}
}

2628 c⁄° 
fûe_›î©i⁄s
 
	gf›s_gªí_tx_∑øms
 = {

2629 .
ªad
 = 
©h6kl_gªí_tx_∑øms_ªad
,

2630 .
	gwrôe
 = 
©h6kl_gªí_tx_∑øms_wrôe
,

2631 .
	g›í
 = 
©h6kl_debugfs_›í
,

2632 .
	gow√r
 = 
THIS_MODULE
,

2633 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2637 
	$©h6kl_∑r£_ht_ˇp_∑øms
(c⁄° 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
,

2638 
ht_ˇp_∑øm
 *
htC≠P¨am
)

2640 
buf
[64];

2641 *
p
;

2642 
Àn
;

2643 
vÆue
;

2645 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2646 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2647  -
EFAULT
;

2649 
p
 = 
buf
;

2651 
SKIP_SPACE
;

2653 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2655 i‡(
vÆue
 >
IEEE80211_NUM_BANDS
)

2656  -
EFAULT
;

2658 
htC≠P¨am
->
b™d
 = (
u8
Ë
vÆue
;

2660 
SEEK_SPACE
;

2661 
SKIP_SPACE
;

2663 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2664 
htC≠P¨am
->
ch™_width_40M_suµ‹ãd
 = (
u8
Ë
vÆue
;

2666 
SEEK_SPACE
;

2667 
SKIP_SPACE
;

2669 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2670 
htC≠P¨am
->
sh‹t_GI
 = (
u8
Ë
vÆue
;

2672 
SEEK_SPACE
;

2673 
SKIP_SPACE
;

2675 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2676 
htC≠P¨am
->
ötﬁî™˚_40MHz
 = (
u8
Ë
vÆue
;

2679 
	}
}

2682 
ssize_t
 
	$©h6kl_ht_ˇp_∑øms_wrôe
(
fûe
 *file,

2683 c⁄° 
__u£r
 *
u£r_buf
,

2684 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2686 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2687 
ht_ˇp_∑øm
 
ãmpHtC≠
;

2688 
i
, 
ªt
;

2690 
	`mem£t
(&
ãmpHtC≠
, 0, (
ht_ˇp_∑øm
));

2691 
ªt
 = 
	`©h6kl_∑r£_ht_ˇp_∑øms
(
u£r_buf
, 
cou¡
, &
ãmpHtC≠
);

2693 i‡(
ªt
)

2694  
ªt
;

2696 
i
 = 0; i < 
¨
->
vif_max
; i++) {

2697 i‡(
	`©h6kl_wmi_£t_ht_ˇp_cmd
(
¨
->
wmi
, 
i
,

2698 
ãmpHtC≠
.
b™d
,

2699 
ãmpHtC≠
.
ch™_width_40M_suµ‹ãd
,

2700 
ãmpHtC≠
.
sh‹t_GI
,

2701 
ãmpHtC≠
.
ötﬁî™˚_40MHz
))

2702  -
EIO
;

2705 
ãmpHtC≠
.
isC⁄fig
 = 1;

2706 
	`mem˝y
(&
¨
->
debug
.
ht_ˇp_∑øm
[
ãmpHtC≠
.
b™d
],

2707 &
ãmpHtC≠
, (
ht_ˇp_∑øm
));

2709  
cou¡
;

2710 
	}
}

2712 
ssize_t
 
	$©h6kl_ht_ˇp_∑øms_ªad
(
fûe
 *file,

2713 
__u£r
 *
u£r_buf
,

2714 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2716 
	#_BUF_SIZE
 (128)

	)

2717 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2718 
u8
 *
buf
;

2719 
Àn
 = 0;

2720 
b™d
;

2721 
ssize_t
 
ªt_˙t
;

2723 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

2724 i‡(!
buf
)

2725  -
ENOMEM
;

2727 
b™d
 = 0; b™d < 
A_NUM_BANDS
; band++) {

2728 i‡(
¨
->
debug
.
ht_ˇp_∑øm
[
b™d
].
isC⁄fig
)

2729 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

2731 (
¨
->
debug
.
ht_ˇp_∑øm
[
b™d
].b™d =
A_BAND_24GHZ
 ?

2733 
¨
->
debug
.
ht_ˇp_∑øm
[
b™d
].
ch™_width_40M_suµ‹ãd
,

2734 
¨
->
debug
.
ht_ˇp_∑øm
[
b™d
].
sh‹t_GI
,

2735 
¨
->
debug
.
ht_ˇp_∑øm
[
b™d
].
ötﬁî™˚_40MHz
);

2738 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2740 
	`k‰ì
(
buf
);

2742  
ªt_˙t
;

2743 #unde‡
_BUF_SIZE


2744 
	}
}

2747 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ht_ˇp_∑øms
 = {

2748 .
ªad
 = 
©h6kl_ht_ˇp_∑øms_ªad
,

2749 .
	gwrôe
 = 
©h6kl_ht_ˇp_∑øms_wrôe
,

2750 .
	g›í
 = 
©h6kl_debugfs_›í
,

2751 .
	gow√r
 = 
THIS_MODULE
,

2752 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2755 
ssize_t
 
	$©h6kl_debug_mask_wrôe
(
fûe
 *file,

2756 c⁄° 
__u£r
 *
u£r_buf
,

2757 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2759 
ªt
;

2761 
ªt
 = 
	`k°πou32_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
debug_mask
);

2763 i‡(
ªt
)

2764  
ªt
;

2766  
cou¡
;

2767 
	}
}

2769 
ssize_t
 
	$©h6kl_debug_mask_ªad
(
fûe
 *file,

2770 
__u£r
 *
u£r_buf
,

2771 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2773 
buf
[32];

2774 
Àn
;

2776 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "debug_mask: 0x%x\n", 
debug_mask
);

2778  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2779 
	}
}

2781 
ssize_t
 
	$©h6kl_debug_mask_ext_wrôe
(
fûe
 *file,

2782 c⁄° 
__u£r
 *
u£r_buf
,

2783 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2785 
ªt
;

2787 
ªt
 = 
	`k°πou32_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
debug_mask_ext
);

2789 i‡(
ªt
)

2790  
ªt
;

2792  
cou¡
;

2793 
	}
}

2795 
ssize_t
 
	$©h6kl_debug_mask_ext_ªad
(
fûe
 *file,

2796 
__u£r
 *
u£r_buf
,

2797 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2799 
buf
[32];

2800 
Àn
;

2802 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "debug_mask_ext: 0x%x\n",

2803 
debug_mask_ext
);

2805  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2806 
	}
}

2808 c⁄° 
fûe_›î©i⁄s
 
	gf›s_debug_mask
 = {

2809 .
ªad
 = 
©h6kl_debug_mask_ªad
,

2810 .
	gwrôe
 = 
©h6kl_debug_mask_wrôe
,

2811 .
	g›í
 = 
©h6kl_debugfs_›í
,

2812 .
	gow√r
 = 
THIS_MODULE
,

2813 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2816 c⁄° 
fûe_›î©i⁄s
 
	gf›s_debug_mask_ext
 = {

2817 .
ªad
 = 
©h6kl_debug_mask_ext_ªad
,

2818 .
	gwrôe
 = 
©h6kl_debug_mask_ext_wrôe
,

2819 .
	g›í
 = 
©h6kl_debugfs_›í
,

2820 .
	gow√r
 = 
THIS_MODULE
,

2821 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2825 
ssize_t
 
	$©h6kl_ht_c€x_∑øms_wrôe
(
fûe
 *file,

2826 c⁄° 
__u£r
 *
u£r_buf
,

2827 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2829 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2830 
©h6kl_vif
 *
vif
;

2831 *
p
;

2832 
sˇn_öãrvÆ
, 
øã_öãrvÆ
;

2833 
buf
[32];

2834 
ssize_t
 
Àn
;

2835 
i
;

2837 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2838 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2839  -
EFAULT
;

2841 
p
 = 
buf
;

2843 
SKIP_SPACE
;

2845 
	`ssˇnf
(
p
, "%d", &
sˇn_öãrvÆ
);

2847 
SEEK_SPACE
;

2848 
SKIP_SPACE
;

2850 
	`ssˇnf
(
p
, "%d", &
øã_öãrvÆ
);

2852 
i
 = 0; i < 
¨
->
vif_max
; i++) {

2853 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

2854 i‡(
vif
)

2855 
	`©h6kl_htc€x_c⁄fig
(
vif
,

2856 (
u32
)
sˇn_öãrvÆ
,

2857 (
u8
)
øã_öãrvÆ
);

2860  
cou¡
;

2861 
	}
}

2863 
ssize_t
 
	$©h6kl_ht_c€x_∑øms_ªad
(
fûe
 *file,

2864 
__u£r
 *
u£r_buf
,

2865 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2867 
	#_BUF_SIZE
 (128)

	)

2868 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2869 
©h6kl_vif
 *
vif
;

2870 
u8
 *
buf
;

2871 
Àn
 = 0;

2872 
i
;

2873 
ssize_t
 
ªt_˙t
;

2875 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

2876 i‡(!
buf
)

2877  -
ENOMEM
;

2879 
i
 = 0; i < 
¨
->
vif_max
; i++) {

2880 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

2881 i‡((
vif
) &&

2882 (
vif
->
htc€x_˘x
))

2883 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

2885 
i
,

2886 
vif
->
htc€x_˘x
->
Êags
,

2887 
vif
->
htc€x_˘x
->
sˇn_öãrvÆ
,

2888 
vif
->
htc€x_˘x
->
num_sˇn
,

2889 
vif
->
htc€x_˘x
->
øã_rﬁlback_öãrvÆ
,

2890 
vif
->
htc€x_˘x
->
tﬁî™t40_˙t
);

2893 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

2895 
	`k‰ì
(
buf
);

2897  
ªt_˙t
;

2898 #unde‡
_BUF_SIZE


2899 
	}
}

2902 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ht_c€x_∑øms
 = {

2903 .
ªad
 = 
©h6kl_ht_c€x_∑øms_ªad
,

2904 .
	gwrôe
 = 
©h6kl_ht_c€x_∑øms_wrôe
,

2905 .
	g›í
 = 
©h6kl_debugfs_›í
,

2906 .
	gow√r
 = 
THIS_MODULE
,

2907 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

2910 
	$©h6kl_∑r£_tx_amsdu_∑øms
(c⁄° 
__u£r
 *
u£r_buf
,

2911 
size_t
 
cou¡
,

2912 
©h6kl_vif
 *
vif
)

2914 
buf
[64];

2915 *
p
;

2916 
Àn
;

2917 
vÆue
;

2918 
u8
 
tx_amsdu_max_aggr_num
;

2919 
u16
 
tx_amsdu_max_pdu_Àn
, 
tx_amsdu_timeout
;

2920 
boﬁ
 
tx_amsdu_£q_pkt
;

2921 
boﬁ
 
tx_amsdu_¥ogªssive
;

2923 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

2924 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

2925  -
EFAULT
;

2927 
p
 = 
buf
;

2929 
SKIP_SPACE
;

2931 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2932 
tx_amsdu_max_aggr_num
 = 
vÆue
;

2934 
SEEK_SPACE
;

2935 
SKIP_SPACE
;

2937 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2938 
tx_amsdu_max_pdu_Àn
 = 
vÆue
;

2940 
SEEK_SPACE
;

2941 
SKIP_SPACE
;

2943 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2944 
tx_amsdu_timeout
 = 
vÆue
;

2946 
SEEK_SPACE
;

2947 
SKIP_SPACE
;

2949 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2950 i‡(
vÆue
)

2951 
tx_amsdu_£q_pkt
 = 
åue
;

2953 
tx_amsdu_£q_pkt
 = 
Ál£
;

2955 
SEEK_SPACE
;

2956 
SKIP_SPACE
;

2958 
	`ssˇnf
(
p
, "%d", &
vÆue
);

2959 i‡(
vÆue
)

2960 
tx_amsdu_¥ogªssive
 = 
åue
;

2962 
tx_amsdu_¥ogªssive
 = 
Ál£
;

2964 
	`aggr_tx_c⁄fig
(
vif
,

2965 
tx_amsdu_£q_pkt
,

2966 
tx_amsdu_¥ogªssive
,

2967 
tx_amsdu_max_aggr_num
,

2968 
tx_amsdu_max_pdu_Àn
,

2969 
tx_amsdu_timeout
);

2972 
	}
}

2975 
ssize_t
 
	$©h6kl_tx_amsdu_∑øms_wrôe
(
fûe
 *file,

2976 c⁄° 
__u£r
 *
u£r_buf
,

2977 
size_t
 
cou¡
, 
loff_t
 *
µos
)

2979 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

2980 
©h6kl_vif
 *
vif
;

2981 
i
, 
ªt
;

2983 
i
 = 0; i < 
¨
->
vif_max
; i++) {

2984 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

2985 i‡((
vif
) &&

2986 (
vif
->
aggr_˙txt
)) {

2987 
ªt
 = 
	`©h6kl_∑r£_tx_amsdu_∑øms
(
u£r_buf
,

2988 
cou¡
, 
vif
);

2990 i‡(
ªt
)

2991  
ªt
;

2995  
cou¡
;

2996 
	}
}

2998 
ssize_t
 
	$©h6kl_tx_amsdu_∑øms_ªad
(
fûe
 *file,

2999 
__u£r
 *
u£r_buf
,

3000 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3002 
	#_BUF_SIZE
 (8192)

	)

3003 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3004 
©h6kl_vif
 *
vif
;

3005 
©h6kl_°a
 *
c⁄n
;

3006 
txtid
 *txtid;

3007 
u8
 *
buf
;

3008 
Àn
 = 0;

3009 
i
, 
j
, 
k
, 
num_°a
;

3010 
ssize_t
 
ªt_˙t
;

3012 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

3013 i‡(!
buf
)

3014  -
ENOMEM
;

3016 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3017 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3018 i‡((
vif
) &&

3019 (
vif
->
aggr_˙txt
)) {

3020 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

3022 
i
,

3023 (
vif
->
aggr_˙txt
->
tx_amsdu_íabÀ
 =
åue
 ?

3025 
vif
->
aggr_˙txt
->
tx_amsdu_max_aggr_Àn
,

3026 
vif
->
aggr_˙txt
->
tx_amsdu_max_aggr_num
,

3027 
vif
->
aggr_˙txt
->
tx_amsdu_max_pdu_Àn
,

3028 
vif
->
aggr_˙txt
->
tx_amsdu_timeout
,

3029 (
vif
->
aggr_˙txt
->
tx_amsdu_£q_pkt
 =
åue
 ?

3031 (
vif
->
aggr_˙txt
->
tx_amsdu_¥ogªssive
 =
åue
 ?

3034 
num_°a
 = (
vif
->
nw_ty≥
 =
INFRA_NETWORK
) ?

3035 1 : 
AP_MAX_NUM_STA
;

3036 
j
 = 0; j < 
num_°a
; j++) {

3037 
c⁄n
 = &
vif
->
°a_li°
[
j
];

3038 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

3040 
c⁄n
->
mac
[0], conn->mac[1],

3041 
c⁄n
->
mac
[2], conn->mac[3],

3042 
c⁄n
->
mac
[4], conn->mac[5]);

3043 
k
 = 0; k < 
NUM_OF_TIDS
; k++) {

3044 
txtid
 = 
	`AGGR_GET_TXTID
(

3045 
c⁄n
->
aggr_c⁄n_˙txt
, 
k
);

3046 
Àn
 +
	`s˙¥ötf
(
buf
 +Üen,

3047 
_BUF_SIZE
 - 
Àn
,

3049 
txtid
->
tid
,

3050 
txtid
->
aid
,

3051 (
txtid
->
max_aggr_sz
 ?

3053 
txtid
->
num_amsdu
,

3054 
txtid
->
num_pdu
,

3055 
txtid
->
œ°_num_amsdu
,

3056 
txtid
->
œ°_num_timeout
,

3057 
txtid
->
num_timeout
,

3058 
txtid
->
num_Êush
,

3059 
txtid
->
num_tx_nuŒ
,

3060 
txtid
->
num_ovîÊow
);

3066 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3068 
	`k‰ì
(
buf
);

3070  
ªt_˙t
;

3071 #unde‡
_BUF_SIZE


3072 
	}
}

3075 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tx_amsdu_∑øms
 = {

3076 .
ªad
 = 
©h6kl_tx_amsdu_∑øms_ªad
,

3077 .
	gwrôe
 = 
©h6kl_tx_amsdu_∑øms_wrôe
,

3078 .
	g›í
 = 
©h6kl_debugfs_›í
,

3079 .
	gow√r
 = 
THIS_MODULE
,

3080 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3083 
	$©h6kl_∑r£_tx_amsdu
(c⁄° 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
,

3084 
©h6kl_vif
 *
vif
)

3086 
buf
[64];

3087 *
p
;

3088 
Àn
;

3089 
vÆue
;

3091 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

3092 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

3093  -
EFAULT
;

3095 
p
 = 
buf
;

3097 
SKIP_SPACE
;

3099 
	`ssˇnf
(
p
, "%d", &
vÆue
);

3100 i‡(
vÆue
)

3101 
	`£t_bô
(
AMSDU_ENABLED
, &
vif
->
Êags
);

3103 
	`˛ór_bô
(
AMSDU_ENABLED
, &
vif
->
Êags
);

3106 
	}
}

3109 
ssize_t
 
	$©h6kl_tx_amsdu_wrôe
(
fûe
 *file,

3110 c⁄° 
__u£r
 *
u£r_buf
,

3111 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3113 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3114 
©h6kl_vif
 *
vif
;

3115 
i
, 
ªt
;

3117 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3118 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3119 i‡((
vif
) &&

3120 (
vif
->
aggr_˙txt
)) {

3121 
ªt
 = 
	`©h6kl_∑r£_tx_amsdu
(
u£r_buf
, 
cou¡
, 
vif
);

3123 i‡(
ªt
)

3124  
ªt
;

3128  
cou¡
;

3129 
	}
}

3131 
ssize_t
 
	$©h6kl_tx_amsdu_ªad
(
fûe
 *file,

3132 
__u£r
 *
u£r_buf
,

3133 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3135 
	#_BUF_SIZE
 (128)

	)

3136 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3137 
©h6kl_vif
 *
vif
;

3138 
u8
 *
buf
;

3139 
Àn
 = 0;

3140 
i
;

3141 
ssize_t
 
ªt_˙t
;

3143 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

3144 i‡(!
buf
)

3145  -
ENOMEM
;

3147 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3148 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3149 i‡((
vif
) &&

3150 (
vif
->
aggr_˙txt
))

3151 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

3153 
i
,

3154 (
	`ã°_bô
(
AMSDU_ENABLED
, &
vif
->
Êags
)

3158 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3160 
	`k‰ì
(
buf
);

3162  
ªt_˙t
;

3163 #unde‡
_BUF_SIZE


3164 
	}
}

3167 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tx_amsdu
 = {

3168 .
ªad
 = 
©h6kl_tx_amsdu_ªad
,

3169 .
	gwrôe
 = 
©h6kl_tx_amsdu_wrôe
,

3170 .
	g›í
 = 
©h6kl_debugfs_›í
,

3171 .
	gow√r
 = 
THIS_MODULE
,

3172 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3175 
ssize_t
 
	$©h6kl_htc_°©_ªad
(
fûe
 *file,

3176 
__u£r
 *
u£r_buf
,

3177 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3179 
	#_BUF_SIZE
 (8192)

	)

3180 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3181 
©h6kl_cookõ_poﬁ
 *
cookõ_poﬁ
;

3182 
u8
 *
buf
;

3183 
Àn
 = 0;

3184 
ssize_t
 
ªt_˙t
;

3186 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

3187 i‡(!
buf
)

3188  -
ENOMEM
;

3191 
cookõ_poﬁ
 = &
¨
->
cookõ_d©a
;

3192 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

3194 
cookõ_poﬁ
->
cookõ_num
,

3195 
cookõ_poﬁ
->
cookõ_cou¡
,

3196 
cookõ_poﬁ
->
cookõ_Æloc_˙t
,

3197 
cookõ_poﬁ
->
cookõ_Æloc_Áû_˙t
,

3198 
cookõ_poﬁ
->
cookõ_‰ì_˙t
,

3199 
cookõ_poﬁ
->
cookõ_≥ak_˙t
);

3201 
cookõ_poﬁ
 = &
¨
->
cookõ_˘æ
;

3202 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

3204 
cookõ_poﬁ
->
cookõ_num
,

3205 
cookõ_poﬁ
->
cookõ_cou¡
,

3206 
cookõ_poﬁ
->
cookõ_Æloc_˙t
,

3207 
cookõ_poﬁ
->
cookõ_Æloc_Áû_˙t
,

3208 
cookõ_poﬁ
->
cookõ_‰ì_˙t
,

3209 
cookõ_poﬁ
->
cookõ_≥ak_˙t
);

3212 
Àn
 +
	`©h6kl_htc_°©
(
¨
->
htc_èrgë
, 
buf
 +Üí, 
_BUF_SIZE
 -Üen);

3214 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3216 
	`k‰ì
(
buf
);

3218  
ªt_˙t
;

3219 #unde‡
_BUF_SIZE


3220 
	}
}

3224 c⁄° 
fûe_›î©i⁄s
 
	gf›s_htc_°©
 = {

3225 .
ªad
 = 
©h6kl_htc_°©_ªad
,

3226 .
	g›í
 = 
©h6kl_debugfs_›í
,

3227 .
	gow√r
 = 
THIS_MODULE
,

3228 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3231 
ssize_t
 
	$©h6kl_hif_°©_ªad
(
fûe
 *file,

3232 
__u£r
 *
u£r_buf
,

3233 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3235 
	#_BUF_SIZE
 (4096)

	)

3236 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3237 
u8
 *
buf
;

3238 
Àn
;

3239 
ssize_t
 
ªt_˙t
;

3241 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

3242 i‡(!
buf
)

3243  -
ENOMEM
;

3245 
Àn
 = 
	`©h6kl_hif_°©
(
¨
, 
buf
, 
_BUF_SIZE
);

3247 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3249 
	`k‰ì
(
buf
);

3251  
ªt_˙t
;

3252 #unde‡
_BUF_SIZE


3253 
	}
}

3257 c⁄° 
fûe_›î©i⁄s
 
	gf›s_hif_°©
 = {

3258 .
ªad
 = 
©h6kl_hif_°©_ªad
,

3259 .
	g›í
 = 
©h6kl_debugfs_›í
,

3260 .
	gow√r
 = 
THIS_MODULE
,

3261 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3265 
ssize_t
 
	$©h6kl_hif_pùe_max_sche_wrôe
(
fûe
 *file,

3266 c⁄° 
__u£r
 *
u£r_buf
,

3267 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3269 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3270 
buf
[64];

3271 *
p
;

3272 
Àn
;

3273 
u32
 
max_sche_tx
, 
max_sche_rx
;

3275 i‡(
¨
->
hif_ty≥
 !
ATH6KL_HIF_TYPE_USB
)

3276  -
EIO
;

3278 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

3279 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

3280  -
EFAULT
;

3282 
p
 = 
buf
;

3284 
SKIP_SPACE
;

3286 
	`ssˇnf
(
p
, "%d", &
max_sche_tx
);

3288 
SEEK_SPACE
;

3289 
SKIP_SPACE
;

3291 
	`ssˇnf
(
p
, "%d", &
max_sche_rx
);

3293 
	`©h6kl_hif_pùe_£t_max_sche
(
¨
, 
max_sche_tx
, 
max_sche_rx
);

3295  
cou¡
;

3296 
	}
}

3299 c⁄° 
fûe_›î©i⁄s
 
	gf›s_hif_pùe_max_sche
 = {

3300 .
wrôe
 = 
©h6kl_hif_pùe_max_sche_wrôe
,

3301 .
	g›í
 = 
©h6kl_debugfs_›í
,

3302 .
	gow√r
 = 
THIS_MODULE
,

3303 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3307 
ssize_t
 
	$©h6kl_≠_≠sd_ªad
(
fûe
 *file,

3308 
__u£r
 *
u£r_buf
,

3309 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3311 
	#_BUF_SIZE
 (128)

	)

3312 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3313 
©h6kl_vif
 *
vif
;

3314 
u8
 *
buf
;

3315 
Àn
 = 0;

3316 
i
;

3317 
ssize_t
 
ªt_˙t
;

3319 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

3320 i‡(!
buf
)

3321  -
ENOMEM
;

3323 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3324 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3325 i‡((
vif
Ë&& (vif->
nw_ty≥
 =
AP_NETWORK
)) {

3326 
Àn
 +
	`s˙¥ötf
(
buf
, 
_BUF_SIZE
,

3327 "VAP(%d),ápsd: %d\n", 
i
,

3328 
vif
->
≠_≠sd
);

3332 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3334 
	`k‰ì
(
buf
);

3336  
ªt_˙t
;

3337 #unde‡
_BUF_SIZE


3338 
	}
}

3340 
ssize_t
 
	$©h6kl_≠_≠sd_wrôe
(
fûe
 *file,

3341 c⁄° 
__u£r
 *
u£r_buf
,

3342 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3344 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3345 
©h6kl_vif
 *
vif
;

3346 
u32
 
≠_≠sd
;

3347 
buf
[32];

3348 
ssize_t
 
Àn
;

3349 
i
;

3351 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

3352 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

3353  -
EFAULT
;

3355 
buf
[
Àn
] = '\0';

3356 i‡(
	`k°πou32
(
buf
, 0, &
≠_≠sd
))

3357  -
EINVAL
;

3359 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3360 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3361 i‡((
vif
) &&

3362 (
vif
->
nw_ty≥
 =
AP_NETWORK
)) {

3363 
	`©h6kl_wmi_≠_£t_≠sd
(
vif
->
¨
->
wmi
, vif->
fw_vif_idx
,

3364 
≠_≠sd
 ?

3365 
WMI_AP_APSD_ENABLED
 : 
WMI_AP_APSD_DISABLED
);

3366 
vif
->
≠_≠sd
 =áp_apsd;

3370  
cou¡
;

3371 
	}
}

3374 c⁄° 
fûe_›î©i⁄s
 
	gf›s_≠_≠sd
 = {

3375 .
ªad
 = 
©h6kl_≠_≠sd_ªad
,

3376 .
	gwrôe
 = 
©h6kl_≠_≠sd_wrôe
,

3377 .
	g›í
 = 
©h6kl_debugfs_›í
,

3378 .
	gow√r
 = 
THIS_MODULE
,

3379 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3383 
ssize_t
 
	$©h6kl_≠_öåabss_ªad
(
fûe
 *file,

3384 
__u£r
 *
u£r_buf
,

3385 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3387 
	#_BUF_SIZE
 (256)

	)

3388 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3389 
©h6kl_vif
 *
vif
;

3390 
u8
 *
buf
;

3391 
Àn
 = 0;

3392 
i
;

3393 
ssize_t
 
ªt_˙t
;

3395 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

3396 i‡(!
buf
)

3397  -
ENOMEM
;

3399 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3400 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3401 i‡((
vif
Ë&& (vif->
nw_ty≥
 =
AP_NETWORK
)) {

3402 
Àn
 +
	`s˙¥ötf
(
buf
, 
_BUF_SIZE
,

3403 "VAP(%d),áp_öåabss: %d\n", 
i
,

3404 
vif
->
öåa_bss
);

3408 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3410 
	`k‰ì
(
buf
);

3412  
ªt_˙t
;

3413 #unde‡
_BUF_SIZE


3414 
	}
}

3416 
ssize_t
 
	$©h6kl_≠_öåabss_wrôe
(
fûe
 *file,

3417 c⁄° 
__u£r
 *
u£r_buf
,

3418 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3420 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3421 
©h6kl_vif
 *
vif
;

3422 
u32
 
≠_öåabss
;

3423 
buf
[32];

3424 
ssize_t
 
Àn
;

3425 
i
;

3427 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

3428 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

3429  -
EFAULT
;

3431 
buf
[
Àn
] = '\0';

3432 i‡(
	`k°πou32
(
buf
, 0, &
≠_öåabss
))

3433  -
EINVAL
;

3435 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3436 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3437 i‡((
vif
) &&

3438 (
vif
->
nw_ty≥
 =
AP_NETWORK
))

3439 
vif
->
öåa_bss
 = (
≠_öåabss
 ? 1 : 0);

3442  
cou¡
;

3443 
	}
}

3446 c⁄° 
fûe_›î©i⁄s
 
	gf›s_≠_öåabss
 = {

3447 .
ªad
 = 
©h6kl_≠_öåabss_ªad
,

3448 .
	gwrôe
 = 
©h6kl_≠_öåabss_wrôe
,

3449 .
	g›í
 = 
©h6kl_debugfs_›í
,

3450 .
	gow√r
 = 
THIS_MODULE
,

3451 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3454 
ssize_t
 
	$©h6kl_gë_f‹˚_∑ssˇn
(
fûe
 *file,

3455 
__u£r
 *
u£r_buf
,

3456 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3458 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3459 
u8
 
buf
[128];

3460 
Àn
 = 0;

3462 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf),

3463 "f‹˚Öassive: %d\n", 
¨
->
debug
.
f‹˚_∑ssive
);

3465  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3466 
	}
}

3468 
ssize_t
 
	$©h6kl_£t_f‹˚_∑ssˇn
(
fûe
 *file,

3469 c⁄° 
__u£r
 *
u£r_buf
,

3470 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3472 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3473 
©h6kl_vif
 *
vif
;

3474 
Àn
 = 0;

3475 
u8
 
buf
[16];

3476 
u32
 
f‹˚_∑ssˇn
;

3478 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

3479 i‡(!
vif
)

3480  -
EIO
;

3482 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

3483 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

3484  -
EFAULT
;

3486 
buf
[
Àn
] = '\0';

3487 i‡(
	`k°πou32
(
buf
, 0, &
f‹˚_∑ssˇn
))

3488  -
EINVAL
;

3490 i‡(
f‹˚_∑ssˇn
 == 1)

3491 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
 &~
ACTIVE_SCAN_CTRL_FLAGS
;

3493 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
 |
ACTIVE_SCAN_CTRL_FLAGS
;

3495 
¨
->
debug
.
f‹˚_∑ssive
 = 
f‹˚_∑ssˇn
;

3497 
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

3498 
vif
->
sc_∑øms
.
fg_°¨t_≥riod
,

3499 
vif
->
sc_∑øms
.
fg_íd_≥riod
,

3500 
vif
->
sc_∑øms
.
bg_≥riod
,

3501 
vif
->
sc_∑øms
.
möa˘_chdwñl_time
,

3502 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
,

3503 
vif
->
sc_∑øms
.
∑s_chdwñl_time
,

3504 
vif
->
sc_∑øms
.
sh‹t_sˇn_øtio
,

3505 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
,

3506 
vif
->
sc_∑øms
.
max_dfsch_a˘_time
,

3507 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
);

3509  
cou¡
;

3510 
	}
}

3512 c⁄° 
fûe_›î©i⁄s
 
	gf›s_f‹˚_∑ssˇn
 = {

3513 .
ªad
 = 
©h6kl_gë_f‹˚_∑ssˇn
,

3514 .
	gwrôe
 = 
©h6kl_£t_f‹˚_∑ssˇn
,

3515 .
	g›í
 = 
©h6kl_debugfs_›í
,

3516 .
	gow√r
 = 
THIS_MODULE
,

3517 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3520 
ssize_t
 
	$©h6kl_gë_pmkid_li°
(
fûe
 *file,

3521 
__u£r
 *
u£r_buf
,

3522 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3524 
	#PMKID_LIST_NUM_SIZE
 4

	)

3526 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3527 
©h6kl_vif
 *
vif
;

3528 
Àn
 = 0, 
buf_Àn
;

3529 
u8
 *
p
;

3530 
u8
 
buf
[512];

3531 
wmi_pmkid_li°_ª∂y
 *
ª∂y
;

3532 
À·
;

3534 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

3535 i‡(!
vif
)

3536  -
EIO
;

3538 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
))

3539  -
EBUSY
;

3541 
	`£t_bô
(
PMKLIST_GET_PEND
, &
vif
->
Êags
);

3543 i‡(
	`©h6kl_wmi_gë_pmkid_li°
(
¨
->
wmi
, 0)) {

3544 
	`up
(&
¨
->
£m
);

3545  -
EIO
;

3548 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

3549 !
	`ã°_bô
(
PMKLIST_GET_PEND
,

3550 &
vif
->
Êags
), 
WMI_TIMEOUT
);

3552 
	`up
(&
¨
->
£m
);

3554 i‡(
À·
 <= 0)

3555  -
ETIMEDOUT
;

3557 
ª∂y
 = (
wmi_pmkid_li°_ª∂y
 *Ë
vif
->
pmkid_li°_buf
;

3558 
p
 = 
buf
;

3559 
buf_Àn
 = (
buf
);

3561 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen, "PMKID List\n");

3563 i‡(
ª∂y
->
num_pmkid
 !0 &&Ñïly->num_pmkid <
WMI_MAX_PMKID_CACHE
) {

3564 
i
;

3565 *
bssid
 = (*)
ª∂y
 + 
PMKID_LIST_NUM_SIZE
;

3566 *
pmkid
 = (*)
ª∂y
 + 
PMKID_LIST_NUM_SIZE
 + 
ETH_ALEN
;

3568 
i
 = 0; i < 
ª∂y
->
num_pmkid
; i++) {

3569 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

3571 (
bssid
[0] & 0xff), (bssid[1] & 0xff),

3572 (
bssid
[2] & 0xff), (bssid[3] & 0xff),

3573 (
bssid
[4] & 0xff), (bssid[5] & 0xff));

3574 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

3576 (
pmkid
[0] & 0xff), (pmkid[1] & 0xff),

3577 (
pmkid
[2] & 0xff), (pmkid[3] & 0xff),

3578 (
pmkid
[4] & 0xff), (pmkid[5] & 0xff),

3579 (
pmkid
[6] & 0xff), (pmkid[7] & 0xff),

3580 (
pmkid
[8] & 0xff), (pmkid[9] & 0xff),

3581 (
pmkid
[10] & 0xff), (pmkid[11] & 0xff),

3582 (
pmkid
[12] & 0xff), (pmkid[13] & 0xff),

3583 (
pmkid
[14] & 0xff), (pmkid[15] & 0xff));

3585 
bssid
 +((
wmi_pmkid
Ë+ 
ETH_ALEN
);

3586 
pmkid
 +((
wmi_pmkid
Ë+ 
ETH_ALEN
);

3590  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3591 
	}
}

3593 c⁄° 
fûe_›î©i⁄s
 
	gf›s_pmkid_li°
 = {

3594 .
ªad
 = 
©h6kl_gë_pmkid_li°
,

3595 .
	g›í
 = 
©h6kl_debugfs_›í
,

3596 .
	gow√r
 = 
THIS_MODULE
,

3597 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3600 
ssize_t
 
	$©h6kl_tx£rõs_wrôe
(
fûe
 *file,

3601 c⁄° 
__u£r
 *
u£r_buf
,

3602 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3604 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3605 
©h6kl_vif
 *
vif
;

3606 
u64
 
tx_£rõs
;

3607 
ªt
, 
i
;

3609 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3610 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3612 i‡(
vif
) {

3614 
ªt
 = 
	`k°πou64_‰om_u£r
(
u£r_buf
, 
cou¡
, 0,

3615 &
tx_£rõs
);

3616 i‡(
ªt
)

3617  
ªt
;

3619 
¨
->
debug
.
£t_tx_£rõs
 = 
tx_£rõs
;

3621 i‡(
	`©h6kl_wmi_£t_tx_£À˘_øãs_⁄_Æl_mode
(

3622 
¨
->
wmi
,

3623 
vif
->
fw_vif_idx
,

3624 
tx_£rõs
))

3625  -
EIO
;

3629  
cou¡
;

3630 
	}
}

3632 
ssize_t
 
	$©h6kl_tx£rõs_ªad
(
fûe
 *file,

3633 
__u£r
 *
u£r_buf
,

3634 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3636 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3637 
u8
 
buf
[32];

3638 
Àn
 = 0;

3640 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "Txratemask is 0x%llx\n",

3641 
¨
->
debug
.
£t_tx_£rõs
);

3643  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3644 
	}
}

3646 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tx£rõs_wrôe
 = {

3647 .
ªad
 = 
©h6kl_tx£rõs_ªad
,

3648 .
	gwrôe
 = 
©h6kl_tx£rõs_wrôe
,

3649 .
	g›í
 = 
©h6kl_debugfs_›í
,

3650 .
	gow√r
 = 
THIS_MODULE
,

3651 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3654 
ssize_t
 
	$©h6kl_™tdivcfg_wrôe
(
fûe
 *file,

3655 c⁄° 
__u£r
 *
u£r_buf
,

3656 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3658 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3659 
©h6kl_vif
 *
vif
;

3660 
u8
 
div_c⁄åﬁ
;

3661 
ªt
;

3663 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

3664 i‡(!
vif
)

3665  -
EIO
;

3667 
ªt
 = 
	`k°πou8_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
div_c⁄åﬁ
);

3668 i‡(
ªt
)

3669  
ªt
;

3671 i‡(
	`©h6kl_wmi_£t_™tdivcfg
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
div_c⁄åﬁ
))

3672  -
EIO
;

3674  
cou¡
;

3675 
	}
}

3677 c⁄° 
fûe_›î©i⁄s
 
	gf›s_™tdiv_wrôe
 = {

3678 .
wrôe
 = 
©h6kl_™tdivcfg_wrôe
,

3679 .
	g›í
 = 
©h6kl_debugfs_›í
,

3680 .
	gow√r
 = 
THIS_MODULE
,

3681 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3684 
	$©h6kl_™tdiv_°©
(
©h6kl_vif
 *
vif
,

3685 
u8
 *
buf
, 
buf_Àn
)

3687 
Àn
 = 0;

3688 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Scan startÅime : %d",

3689 
vif
->
™t_div_°©
.
sˇn_°¨t_time
);

3690 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n TotalÖacket count : %d",

3691 
vif
->
™t_div_°©
.
tŸÆ_pkt_cou¡
);

3692 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Main Recv count : %d",

3693 
vif
->
™t_div_°©
.
maö_ªcv_˙t
);

3694 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Alt Recv count : %d",

3695 
vif
->
™t_div_°©
.
Æt_ªcv_˙t
);

3696 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Main Rssi Avg : %d",

3697 
vif
->
™t_div_°©
.
maö_rssi_avg
);

3698 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Alt Rssi Avg : %d",

3699 
vif
->
™t_div_°©
.
Æt_rssi_avg
);

3700 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Current Main Set : %d",

3701 
vif
->
™t_div_°©
.
cuº_maö_£t
);

3702 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Current Alt Set : %d",

3703 
vif
->
™t_div_°©
.
cuº_Æt_£t
);

3704 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Current Bias : %d",

3705 
vif
->
™t_div_°©
.
cuº_büs
);

3706 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Main LNA conf : %d",

3707 
vif
->
™t_div_°©
.
maö_ a_c⁄f
);

3708 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Alt LNA conf : %d",

3709 
vif
->
™t_div_°©
.
Æt_ a_c⁄f
);

3710 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Fast Div Bias: %d",

3711 
vif
->
™t_div_°©
.
Á°_div_büs
);

3712 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n End state : %d",

3713 
vif
->
™t_div_°©
.
íd_°
);

3714 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n Scan: %d",

3715 
vif
->
™t_div_°©
.
sˇn
);

3716 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n ScanÇot start : %d\n",

3717 
vif
->
™t_div_°©
.
sˇn_nŸ_°¨t
);

3718  
Àn
;

3719 
	}
}

3721 
ssize_t
 
	$©h6kl_™tdiv°©_ªad
(
fûe
 *file,

3722 
__u£r
 *
u£r_buf
,

3723 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3725 
	#_BUF_SIZE
 (4096)

	)

3726 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3727 
u8
 *
buf
;

3728 
Àn
;

3729 
ssize_t
 
ªt_˙t
;

3730 
©h6kl_vif
 *
vif
;

3731 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

3734 i‡(!
vif
)

3735  -
EIO
;

3737 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

3738 i‡(!
buf
)

3739  -
ENOMEM
;

3740 
Àn
 = 
	`©h6kl_™tdiv_°©
(
vif
, 
buf
, 
_BUF_SIZE
);

3741 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3742 
	`k‰ì
(
buf
);

3743  
ªt_˙t
;

3744 #unde‡
_BUF_SIZE


3745 
	}
}

3747 c⁄° 
fûe_›î©i⁄s
 
	gf›s_™tdiv_°©e_ªad
 = {

3748 .
ªad
 = 
©h6kl_™tdiv°©_ªad
,

3749 .
	g›í
 = 
©h6kl_debugfs_›í
,

3750 .
	gow√r
 = 
THIS_MODULE
,

3751 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3754 
	$©h6kl_™i_°©
(
©h6kl_vif
 *
vif
,

3755 
u8
 *
buf
, 
buf_Àn
)

3757 
Àn
 = 0;

3759 i‡(!
vif
->
¨
->
debug
.
™i°©_íabÀ
) {

3760 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3763 i‡((
vif
->
™i_íabÀ
 =vif->
™i_°©
.
íabÀ
) &&

3764 (
vif
->
™i_pﬁl˙t
 =vif->
™i_°©
.
pﬁl˙t
)) {

3765 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3767 
vif
->
™i_íabÀ
,

3768 
vif
->
™i_°©
.
pﬁl˙t
);

3770 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3772 
vif
->
™i_°©
.
íabÀ
 ? "ON" : "OFF");

3773 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3775 
vif
->
™i_°©
.
rssi
);

3776 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3778 
vif
->
™i_°©
.
pﬁl˙t
);

3779 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3781 
vif
->
™i_°©
.
noi£ImmunôyLevñ
);

3782 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3784 
vif
->
™i_°©
.
•urImmunôyLevñ
);

3785 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3787 
vif
->
™i_°©
.
fú°ïLevñ
);

3788 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3790 
vif
->
™i_°©
.
ofdmWókSigDëe˘Off
 ?

3792 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3794 
vif
->
™i_°©
.
cckWókSigThªshﬁd
 ?

3797 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3799 
vif
->
™i_°©
.
li°íTime
);

3800 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3802 
vif
->
™i_°©
.
ofdmTrigHigh
);

3803 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3805 
vif
->
™i_°©
.
ofdmTrigLow
);

3806 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3808 
vif
->
™i_°©
.
cckTrigHigh
);

3809 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3811 
vif
->
™i_°©
.
cckTrigLow
);

3812 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3814 
vif
->
™i_°©
.
rssiThrLow
);

3815 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3817 
vif
->
™i_°©
.
rssiThrHigh
);

3818 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3820 
vif
->
™i_°©
.
cy˛eCou¡
);

3821 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3823 
vif
->
™i_°©
.
ofdmPhyEºCou¡
);

3824 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3826 
vif
->
™i_°©
.
cckPhyEºCou¡
);

3827 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3829 
vif
->
™i_°©
.
ofdmPhyEºBa£
);

3830 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3832 
vif
->
™i_°©
.
cckPhyEºBa£
);

3833 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3835 
vif
->
™i_°©
.
rxFømeCou¡
);

3836 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3838 
vif
->
™i_°©
.
txFømeCou¡
);

3840 
vif
->
™i_íabÀ
 = vif->
™i_°©
.
íabÀ
;

3841 
vif
->
™i_pﬁl˙t
 = vif->
™i_°©
.
pﬁl˙t
;

3845  
Àn
;

3846 
	}
}

3848 
ssize_t
 
	$©h6kl_™i°©_ªad
(
fûe
 *file,

3849 
__u£r
 *
u£r_buf
,

3850 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3852 
	#_BUF_SIZE
 (4096)

	)

3853 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3854 
u8
 *
buf
;

3855 
Àn
;

3856 
ssize_t
 
ªt_˙t
;

3857 
©h6kl_vif
 *
vif
;

3858 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

3861 i‡(!
vif
)

3862  -
EIO
;

3864 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

3865 i‡(!
buf
)

3866  -
ENOMEM
;

3867 
Àn
 = 
	`©h6kl_™i_°©
(
vif
, 
buf
, 
_BUF_SIZE
);

3868 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

3869 
	`k‰ì
(
buf
);

3870  
ªt_˙t
;

3871 #unde‡
_BUF_SIZE


3872 
	}
}

3875 
ssize_t
 
	$©h6kl_™i°©_wrôe
(
fûe
 *file,

3876 c⁄° 
__u£r
 *
u£r_buf
,

3877 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3879 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3880 
ªt
;

3882 
ªt
 = 
	`k°πou8_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
¨
->
debug
.
™i°©_íabÀ
);

3883 i‡(
ªt
)

3884  
ªt
;

3886 i‡(
	`©h6kl_wmi_™i°©e_íabÀ
(
¨
->
wmi
,

3887 (
wmi_c⁄fig_íabÀ_cmd
 *)&
¨
->
debug
.
™i°©_íabÀ
))

3888  -
EIO
;

3890  
cou¡
;

3891 
	}
}

3893 c⁄° 
fûe_›î©i⁄s
 
	gf›s_™i_°©e_ªad
 = {

3894 .
ªad
 = 
©h6kl_™i°©_ªad
,

3895 .
	gwrôe
 = 
©h6kl_™i°©_wrôe
,

3896 .
	g›í
 = 
©h6kl_debugfs_›í
,

3897 .
	gow√r
 = 
THIS_MODULE
,

3898 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

3901 
	s∑âîn_hdr
 {

3902 
u8
 
	m¥ómbÀ
[4];

3903 
u16
 
	mduøti⁄
;

3904 
u8
 
	m£qno
;

3905 
u8
 
	mscheduÀ
;

3906 
u16
 
	mpkéí
;

3907 
u16
 
	mchksum
;

3908 } 
	g__∑cked
;

3910 
	$ªad∑âînfûe
(*
∑th
, 
u8
* 
buf
, 
Àn
)

3912 
fûe
 *
Â
 = 
NULL
;

3913 
mm_£gmít_t
 
¥e_fd
;

3914 
fûñí
 = 0;

3916 
∑th
[
	`°æí
(path)-1] = '\0';

3918 
Â
 = 
	`fûp_›í
((c⁄° *)
∑th
, 
O_RDONLY
, 0);

3920 
¥e_fd
 = 
	`gë_fs
();

3921 
	`£t_fs
(
KERNEL_DS
);

3922 i‡(
Â
 && !
	`IS_ERR
(fp)) {

3923 i‡(
Â
->
f_›
 && fp->f_›->
ªad
) {

3924 
Â
->
f_›
->
	`ªad
(Â, 
buf
, 
Àn
, &Â->
f_pos
);

3925 
fûñí
 = 
Â
->
f_díåy
->
d_öode
->
i_size
;

3927 
	`fûp_˛o£
(
Â
, 0);

3929 
	`£t_fs
(
¥e_fd
);

3930  
fûñí
;

3931 
	}
}

3933 
ssize_t
 
	$©h6kl_∑âîngí_wrôe
(
fûe
 *file,

3934 c⁄° 
__u£r
 *
u£r_buf
,

3935 
size_t
 
cou¡
, 
loff_t
 *
µos
)

3937 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

3938 
©h6kl_vif
 *
vif
;

3939 
©h6kl_cookõ
 *
cookõ
 = 
NULL
;

3940 
htc_ídpoöt_id
 
eid
 = 
ENDPOINT_UNUSED
;

3941 
ªt
;

3943 
u8
 
∑âîn_idx
 = 0;

3944 
u16
 
∑âîn_duøti⁄
 = 0;

3945 
u8
 *
∑âîn_buf
 = 
NULL
;

3946 
u16
 
∑âîn_Àn
;

3947 
sk_buff
 *
skb
 = 
NULL
;

3949 
u32
 
m≠_no
 = 0;

3950 
u16
 
htc_èg
 = 
ATH6KL_DATA_PKT_TAG
;

3951 
u8
 
ac
 = 99 ;

3952 
boﬁ
 
chk_adhoc_ps_m≠pög
 = 
Ál£
;

3953 
u32
 
wmi_d©a_Êags
 = 0;

3956 
u8
 
buf
[512];

3957 
∑âîn_hdr
 
PHdr
;

3958 
Àn
 = 0;

3959 *
•å
, *
tokí
;

3960 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

3961 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

3962  -
EFAULT
;

3963 
buf
[
Àn
] = '\0';

3964 
•å
 = 
buf
;

3967 
tokí
 = 
	`°r£p
(&
•å
, " ");

3968 i‡(!
tokí
)

3969  -
EINVAL
;

3970 i‡(
	`k°πou8
(
tokí
, 0, &
∑âîn_idx
))

3971  -
EINVAL
;

3972 i‡(
∑âîn_idx
 > 6)

3973  -
EINVAL
;

3975 
tokí
 = 
	`°r£p
(&
•å
, " ");

3976 i‡(!
tokí
)

3977  -
EINVAL
;

3978 i‡(
	`k°πou16
(
tokí
, 0, &
∑âîn_duøti⁄
))

3979  -
EINVAL
;

3981 i‡(
∑âîn_duøti⁄
 == 0) {

3982 
∑âîn_buf
 = 
	`kmÆloc
(64, 
GFP_ATOMIC
);

3983 i‡(!
∑âîn_buf
)

3984  -
ENOMEM
;

3985 
	`mem£t
(
∑âîn_buf
, 0, 64);

3986 
∑âîn_Àn
 = 64;

3989 
tokí
 = 
	`°r£p
(&
•å
, " ");

3990 i‡(!
tokí
)

3991  -
EINVAL
;

3993 
∑âîn_buf
 = 
	`kmÆloc
(1024, 
GFP_ATOMIC
);

3994 i‡(!
∑âîn_buf
)

3995  -
ENOMEM
;

3997 
∑âîn_Àn
 = 
	`ªad∑âînfûe
(
tokí
, 
∑âîn_buf
, 1024);

3999 i‡(!
∑âîn_Àn
 ||Öattern_len > 1024)

4000  -
EINVAL
;

4003 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

4004 i‡(!
vif
)

4005  -
EIO
;

4008 i‡(!
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))

4009  -
EINVAL
;

4011 i‡(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
) &&

4012 !
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

4013 
Áû_tx
;

4017 
skb
 = 
	`Æloc_skb
(
∑âîn_Àn
, 
GFP_KERNEL
);

4018 i‡(!
skb
)

4019 
Áû_tx
;

4020 
	`mem˝y
(
skb
->
d©a
, 
∑âîn_buf
, 
∑âîn_Àn
);

4021 
skb
->
Àn
 = 
∑âîn_Àn
;

4023 i‡(
	`ã°_bô
(
WMI_ENABLED
, &
¨
->
Êag
)) {

4024 i‡(
	`skb_hódroom
(
skb
Ë< 
vif
->
√eded_hódroom
) {

4025 
sk_buff
 *
tmp_skb
 = 
	`©h6kl_buf_Æloc
(
skb
->
Àn
);

4027 i‡(
tmp_skb
 =
NULL
) {

4028 
vif
->
√t_°©s
.
tx_dr›≥d
++;

4029 
Áû_tx
;

4032 
	`skb_put
(
tmp_skb
, 
skb
->
Àn
);

4033 
	`mem˝y
(
tmp_skb
->
d©a
, 
skb
->d©a, skb->
Àn
);

4034 
	`k‰ì_skb
(
skb
);

4035 
skb
 = 
tmp_skb
;

4038 
PHdr
.
¥ómbÀ
[0] = 0xDE;

4039 
PHdr
.
¥ómbÀ
[1] = 0xAD;

4040 
PHdr
.
¥ómbÀ
[2] = 0xBE;

4041 
PHdr
.
¥ómbÀ
[3] = 0xEF;

4042 
PHdr
.
£qno
 = 
∑âîn_idx
;

4043 
PHdr
.
pkéí
 = 
∑âîn_Àn
;

4044 
PHdr
.
duøti⁄
 = (
∑âîn_duøti⁄
)*500;

4045 
PHdr
.
scheduÀ
 = 0;

4046 
PHdr
.
chksum
 = 0;

4048 
	`¥ötk
("∑âîn_duøti⁄ %d\n",
PHdr
.
duøti⁄
 );

4050 i‡(
	`©h6kl_wmi_d©a_hdr_add
(
¨
->
wmi
, 
skb
, 
DATA_MSGTYPE
,

4051 
wmi_d©a_Êags
, 0,

4052 
WMI_META_VERSION_2
, (*)&
PHdr
,

4053 
vif
->
fw_vif_idx
)) {

4054 
	`©h6kl_îr
("wmi_data_hdr_add failed\n");

4055 
Áû_tx
;

4058 
	`mem˝y
(
skb
->
d©a
+6, &
PHdr
, (PHdr));

4060 i‡((
vif
->
nw_ty≥
 =
ADHOC_NETWORK
) &&

4061 
¨
->
ibss_ps_íabÀ
 && 
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))

4062 
chk_adhoc_ps_m≠pög
 = 
åue
;

4065 
ªt
 = 
	`©h6kl_wmi_im∂icô_¸óã_p°ªam
(
¨
->
wmi
,

4066 
vif
->
fw_vif_idx
, 
skb
,

4067 0, 
	`ã°_bô
(
WMM_ENABLED
, &
vif
->
Êags
),

4068 &
ac
, &
htc_èg
);

4069 i‡(
ªt
)

4070 
Áû_tx
;

4073 
Áû_tx
;

4076 
	`•ö_lock_bh
(&
¨
->
lock
);

4078 
eid
 = 
¨
->
ac2ï_m≠
[
ac
];

4080 i‡(
eid
 =0 ||Éid =
ENDPOINT_UNUSED
) {

4081 i‡((
ac
 =
WMM_NUM_AC
)) {

4085 
eid
 = 
¨
->
˘æ_ï
;

4087 
	`©h6kl_îr
("eid %d i†nŸ m≠≥d!\n", 
eid
);

4088 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

4089 
Áû_tx
;

4094 i‡(
htc_èg
 =
ATH6KL_DATA_PKT_TAG
)

4095 
cookõ
 = 
	`©h6kl_Æloc_cookõ
(
¨
, 
COOKIE_TYPE_DATA
);

4097 
cookõ
 = 
	`©h6kl_Æloc_cookõ
(
¨
, 
COOKIE_TYPE_CTRL
);

4099 i‡(!
cookõ
) {

4100 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

4101 
Áû_tx
;

4105 
¨
->
tx_≥ndög
[
eid
]++;

4106 
¨
->
tŸÆ_tx_d©a_≥nd
++;

4108 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

4110 i‡(!
	`IS_ALIGNED
((Ë
skb
->
d©a
 - 
HTC_HDR_LENGTH
, 4) &&

4111 
	`skb_˛⁄ed
(
skb
)) {

4119 
sk_buff
 *
nskb
;

4121 
nskb
 = 
	`skb_c›y_ex∑nd
(
skb
, 
HTC_HDR_LENGTH
, 0, 
GFP_ATOMIC
);

4122 i‡(
nskb
 =
NULL
)

4123 
Áû_tx
;

4124 
	`k‰ì_skb
(
skb
);

4125 
skb
 = 
nskb
;

4128 
cookõ
->
skb
 = skb;

4129 
cookõ
->
m≠_no
 = map_no;

4130 
	`£t_htc_pkt_öfo
(
cookõ
->
htc_pkt
, cookõ, 
skb
->
d©a
, skb->
Àn
,

4131 
eid
, 
htc_èg
);

4132 
cookõ
->
htc_pkt
->
skb
 = skb;

4134 
¨
->
tx_⁄_vif
 |(1 << 
vif
->
fw_vif_idx
);

4140 
	`©h6kl_htc_tx
(
¨
->
htc_èrgë
, 
cookõ
->
htc_pkt
);

4142 
	`k‰ì
(
∑âîn_buf
);

4144  
cou¡
;

4146 
Áû_tx
:

4147 i‡(
skb
)

4148 
	`dev_k‰ì_skb
(
skb
);

4150 
	`k‰ì
(
∑âîn_buf
);

4152 
vif
->
√t_°©s
.
tx_dr›≥d
++;

4153 
vif
->
√t_°©s
.
tx_ab‹ãd_îr‹s
++;

4155  -
EINVAL
;

4156 
	}
}

4159 c⁄° 
fûe_›î©i⁄s
 
	gf›s_∑âîn_gí
 = {

4160 .
wrôe
 = 
©h6kl_∑âîngí_wrôe
,

4161 .
	g›í
 = 
©h6kl_debugfs_›í
,

4162 .
	gow√r
 = 
THIS_MODULE
,

4163 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4167 
ssize_t
 
	$©h6kl_ho°_¶ìp_mode_wrôe
(
fûe
 *file,

4168 c⁄° 
__u£r
 *
u£r_buf
,

4169 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4171 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4172 
©h6kl_vif
 *
vif
;

4173 
ªt
;

4174 
u8
 *
buf
;

4175 
u32
 
¶ìp_mode
;

4178 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

4179 i‡(!
vif
)

4180  -
EIO
;

4182 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

4183 i‡(!
buf
)

4184  -
EFAULT
;

4186 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

4187 
	`k‰ì
(
buf
);

4188  -
EFAULT
;

4191 
ªt
 = 
	`ssˇnf
(
buf
, "%d", &
¶ìp_mode
);

4192 i‡((
ªt
 !1Ë|| ((
¶ìp_mode
 !
ATH6KL_HOST_MODE_AWAKE
) &&

4193 (
¶ìp_mode
 !
ATH6KL_HOST_MODE_ASLEEP
)))

4195 
	`k‰ì
(
buf
);

4196  -
EINVAL
;

4199 
	`k‰ì
(
buf
);

4201 
	`©h6kl_wmi_£t_ho°_¶ìp_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

4202 (
©h6kl_wow_mode
)
¶ìp_mode
);

4204  
cou¡
;

4205 
	}
}

4207 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ho°_¶ìp_mode
 = {

4208 .
wrôe
 = 
©h6kl_ho°_¶ìp_mode_wrôe
,

4209 .
	g›í
 = 
©h6kl_debugfs_›í
,

4210 .
	gow√r
 = 
THIS_MODULE
,

4211 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4216 
ssize_t
 
	$©h6kl_wow_mode_wrôe
(
fûe
 *file,

4217 c⁄° 
__u£r
 *
u£r_buf
,

4218 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4220 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4221 
©h6kl_vif
 *
vif
;

4222 
ªt
;

4223 
u8
 *
buf
;

4224 
u32
 
wow_mode
;

4225 
u32
 
fûãr
;

4226 
u32
 
ho°_ªq_dñay
;

4229 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

4230 i‡(!
vif
)

4231  -
EIO
;

4233 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

4234 i‡(!
buf
)

4235  -
EFAULT
;

4237 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

4238 
	`k‰ì
(
buf
);

4239  -
EFAULT
;

4242 
ªt
 = 
	`ssˇnf
(
buf
, "%d %d %d", &
wow_mode
, &
fûãr
, &
ho°_ªq_dñay
);

4243 i‡((
ªt
 !1Ë|| ((
wow_mode
 !
ATH6KL_WOW_MODE_DISABLE
) &&

4244 (
wow_mode
 !
ATH6KL_WOW_MODE_ENABLE
)))

4246 
	`k‰ì
(
buf
);

4247  -
EINVAL
;

4250 
	`k‰ì
(
buf
);

4252 
	`©h6kl_wmi_£t_wow_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

4253 (
©h6kl_wow_mode
)
wow_mode
,

4254 
fûãr
, (
u16
)
ho°_ªq_dñay
);

4256  
cou¡
;

4257 
	}
}

4259 c⁄° 
fûe_›î©i⁄s
 
	gf›s_wow_mode
 = {

4260 .
wrôe
 = 
©h6kl_wow_mode_wrôe
,

4261 .
	g›í
 = 
©h6kl_debugfs_›í
,

4262 .
	gow√r
 = 
THIS_MODULE
,

4263 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4268 
ssize_t
 
	$©h6kl_wow∑âîn_wrôe
(
fûe
 *file,

4269 c⁄° 
__u£r
 *
u£r_buf
,

4270 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4272 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4273 
©h6kl_vif
 *
vif
;

4274 
ªt
;

4276 
u8
 
∑âîn_idx
 = 0;

4277 
u8
 
∑âîn_off£t
;

4278 
u8
 
∑âîn_buf
[128];

4279 
u8
 
∑âîn_mask
[16];

4280 
u8
 
∑âîn_Àn
;

4281 
u8
 
mask_idx
 = 0;

4282 
u32
 
ho°_ªq_dñay
 = 
WOW_HOST_REQ_DELAY
;

4285 
u8
 
buf
[512];

4286 
Àn
 = 0;

4287 *
•å
, *
tokí
;

4289 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

4290 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

4291  -
EFAULT
;

4292 
buf
[
Àn
] = '\0';

4293 
•å
 = 
buf
;

4295 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

4296 i‡(!
vif
)

4297  -
EIO
;

4301 
tokí
 = 
	`°r£p
(&
•å
, " ");

4302 i‡(!
tokí
)

4303  -
EINVAL
;

4304 i‡(
	`k°πou8
(
tokí
, 0, &
∑âîn_idx
))

4305  -
EINVAL
;

4307 i‡(
∑âîn_idx
 >= 4)

4308  -
EINVAL
;

4311 
tokí
 = 
	`°r£p
(&
•å
, " ");

4314 i‡(!
tokí
) {

4315 
	`©h6kl_wmi_dñ_wow_∑âîn_cmd
(
¨
->
wmi
,

4316 
vif
->
fw_vif_idx
,

4317 
WOW_LIST_ID
,

4318 
∑âîn_idx
);

4319  
cou¡
;

4321 i‡(
	`k°πou8
(
tokí
, 0, &
∑âîn_off£t
))

4322  -
EINVAL
;

4324 
tokí
 = 
	`°r£p
(&
•å
, " ");

4325 i‡(!
tokí
)

4326  -
EINVAL
;

4328 
∑âîn_Àn
 = 
	`ªad∑âînfûe
(
tokí
, 
∑âîn_buf
, (pattern_buf));

4330 i‡(!
∑âîn_Àn
 ||Öattern_len > 128)

4331  -
EINVAL
;

4336 i‡(
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_SDIO
)

4337 
ho°_ªq_dñay
 = 2000;

4340 i‡(
	`BOOTSTRAP_IS_HSIC
(
¨
->
boŸ°øp_mode
))

4341 
ho°_ªq_dñay
 = 2000;

4344 
mask_idx
 = 0; mask_idx < 
∑âîn_Àn
/8; mask_idx++)

4345 
∑âîn_mask
[
mask_idx
] = 0xff;

4347 i‡(
∑âîn_Àn
 % 8)

4348 
∑âîn_mask
[
mask_idx
] = (1 << (
∑âîn_Àn
 % 8)) - 1;

4350 
	`©h6kl_wmi_dñ_wow_∑âîn_cmd
(
¨
->
wmi
,

4351 
vif
->
fw_vif_idx
,

4352 
WOW_LIST_ID
,

4353 
∑âîn_idx
);

4355 
ªt
 = 
	`©h6kl_wmi_add_wow_ext_∑âîn_cmd
(
¨
->
wmi
,

4356 
vif
->
fw_vif_idx
,

4357 
WOW_LIST_ID
,

4358 
∑âîn_Àn
,

4359 
∑âîn_idx
,

4360 
∑âîn_off£t
,

4361 
∑âîn_buf
,

4362 
∑âîn_mask
);

4364 i‡(
ªt
)

4365  -
EINVAL
;

4366 #i‚de‡
CONFIG_ANDROID


4367 
ªt
 = 
	`©h6kl_wmi_£t_wow_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

4368 
ATH6KL_WOW_MODE_ENABLE
,

4369 
WOW_FILTER_OPTION_PATTERNS
,

4370 
ho°_ªq_dñay
);

4372 i‡(
ªt
)

4373  -
EINVAL
;

4375 
	`£t_bô
(
WLAN_WOW_ENABLE
, &
vif
->
Êags
);

4377 
¨
->
gë_wow_∑âîn
 = 
åue
;

4379  
cou¡
;

4380 
	}
}

4383 c⁄° 
fûe_›î©i⁄s
 
	gf›s_wow∑âîn_gí
 = {

4384 .
wrôe
 = 
©h6kl_wow∑âîn_wrôe
,

4385 .
	g›í
 = 
©h6kl_debugfs_›í
,

4386 .
	gow√r
 = 
THIS_MODULE
,

4387 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4391 
ssize_t
 
	$©h6kl_p2p_Êow˘æ_°©_ªad
(
fûe
 *file,

4392 
__u£r
 *
u£r_buf
,

4393 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4395 
	#_BUF_SIZE
 (4096)

	)

4396 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4397 
u8
 *
buf
;

4398 
Àn
;

4399 
ssize_t
 
ªt_˙t
;

4401 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

4402 i‡(!
buf
)

4403  -
ENOMEM
;

4405 
Àn
 = 
	`©h6kl_p2p_Êow˘æ_°©
(
¨
, 
buf
, 
_BUF_SIZE
);

4407 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

4409 
	`k‰ì
(
buf
);

4411  
ªt_˙t
;

4412 #unde‡
_BUF_SIZE


4413 
	}
}

4416 c⁄° 
fûe_›î©i⁄s
 
	gf›s_p2p_Êow˘æ_°©
 = {

4417 .
ªad
 = 
©h6kl_p2p_Êow˘æ_°©_ªad
,

4418 .
	g›í
 = 
©h6kl_debugfs_›í
,

4419 .
	gow√r
 = 
THIS_MODULE
,

4420 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4423 
ssize_t
 
	$©h6kl_≠_ps_°©_ªad
(
fûe
 *file,

4424 
__u£r
 *
u£r_buf
,

4425 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4427 
	#_BUF_SIZE
 (2048)

	)

4428 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4429 
©h6kl_vif
 *
vif
;

4430 
©h6kl_°a
 *
c⁄n
;

4431 
u8
 *
buf
, *
p
;

4432 
Àn
 = 0;

4433 
i
, 
j
, 
buf_Àn
, 
dïth
;

4434 
u32
 
íq
, 
íq_îr
, 
deq
, 
age
;

4435 
ssize_t
 
ªt_˙t
;

4437 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

4438 i‡(!
buf
)

4439  -
ENOMEM
;

4441 
p
 = 
buf
;

4442 
buf_Àn
 = 
_BUF_SIZE
;

4443 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4444 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4445 i‡((
vif
) &&

4446 (
vif
->
nw_ty≥
 =
AP_NETWORK
)) {

4448 
	`©h6kl_ps_queue_°©
(&
vif
->
psq_mˇ°
,

4449 &
dïth
, &
íq
, &
íq_îr
, &
deq
, &
age
);

4450 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

4452 
vif
->
fw_vif_idx
,

4453 
dïth
, 
íq
, 
íq_îr
, 
deq
, 
age
);

4455 
j
 = 0; j < 
AP_MAX_NUM_STA
; j++) {

4456 
c⁄n
 = &
vif
->
°a_li°
[
j
];

4458 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

4460 
c⁄n
->
mac
[0], conn->mac[1],

4461 
c⁄n
->
mac
[2], conn->mac[3],

4462 
c⁄n
->
mac
[4], conn->mac[5],

4463 
c⁄n
->
aid
,

4464 
c⁄n
->
≠sd_öfo
,

4465 
c⁄n
->
°a_Êags
,

4466 
c⁄n
->
phymode
);

4468 
	`©h6kl_ps_queue_°©
(&
c⁄n
->
psq_d©a
,

4469 &
dïth
, &
íq
, &
íq_îr
,

4470 &
deq
, &
age
);

4471 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

4473 
dïth
, 
íq
, 
íq_îr
, 
deq
, 
age
);

4475 
	`©h6kl_ps_queue_°©
(&
c⁄n
->
psq_mgmt
,

4476 &
dïth
, &
íq
, &
íq_îr
,

4477 &
deq
, &
age
);

4478 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

4480 
dïth
, 
íq
, 
íq_îr
, 
deq
, 
age
);

4485 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

4487 
	`k‰ì
(
buf
);

4489  
ªt_˙t
;

4490 #unde‡
_BUF_SIZE


4491 
	}
}

4494 c⁄° 
fûe_›î©i⁄s
 
	gf›s_≠_ps_°©
 = {

4495 .
ªad
 = 
©h6kl_≠_ps_°©_ªad
,

4496 .
	g›í
 = 
©h6kl_debugfs_›í
,

4497 .
	gow√r
 = 
THIS_MODULE
,

4498 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4501 
	$©h6kl_∑r£_rx_aggr_∑øms
(c⁄° 
__u£r
 *
u£r_buf
,

4502 
size_t
 
cou¡
,

4503 
©h6kl_vif
 *
vif
)

4505 
buf
[64];

4506 *
p
;

4507 
Àn
;

4508 
vÆue
;

4509 
u16
 
rx_aggr_timeout
;

4512 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

4513 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

4514  -
EFAULT
;

4516 
p
 = 
buf
;

4518 
SKIP_SPACE
;

4520 
	`ssˇnf
(
p
, "%d", &
vÆue
);

4521 
rx_aggr_timeout
 = 
vÆue
;

4523 
	`aggr_c⁄fig
(
vif
, 
rx_aggr_timeout
);

4526 
	}
}

4529 
ssize_t
 
	$©h6kl_rx_aggr_∑øms_wrôe
(
fûe
 *file,

4530 c⁄° 
__u£r
 *
u£r_buf
,

4531 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4533 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4534 
©h6kl_vif
 *
vif
;

4535 
i
, 
ªt
;

4537 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4538 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4539 i‡((
vif
) &&

4540 (
vif
->
aggr_˙txt
)) {

4541 
ªt
 = 
	`©h6kl_∑r£_rx_aggr_∑øms
(
u£r_buf
, 
cou¡
, 
vif
);

4543 i‡(
ªt
)

4544  
ªt
;

4548  
cou¡
;

4549 
	}
}

4551 
ssize_t
 
	$©h6kl_rx_aggr_∑øms_ªad
(
fûe
 *file,

4552 
__u£r
 *
u£r_buf
,

4553 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4555 
	#_BUF_SIZE
 (512)

	)

4556 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4557 
©h6kl_vif
 *
vif
;

4558 
u8
 *
buf
;

4559 
Àn
 = 0;

4560 
i
;

4561 
ssize_t
 
ªt_˙t
;

4563 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

4564 i‡(!
buf
)

4565  -
ENOMEM
;

4567 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4568 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4569 i‡((
vif
) &&

4570 (
vif
->
aggr_˙txt
)) {

4571 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

4573 
i
,

4574 
vif
->
aggr_˙txt
->
rx_aggr_timeout
);

4578 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

4580 
	`k‰ì
(
buf
);

4582  
ªt_˙t
;

4583 #unde‡
_BUF_SIZE


4584 
	}
}

4587 c⁄° 
fûe_›î©i⁄s
 
	gf›s_rx_aggr_∑øms
 = {

4588 .
ªad
 = 
©h6kl_rx_aggr_∑øms_ªad
,

4589 .
	gwrôe
 = 
©h6kl_rx_aggr_∑øms_wrôe
,

4590 .
	g›í
 = 
©h6kl_debugfs_›í
,

4591 .
	gow√r
 = 
THIS_MODULE
,

4592 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4596 
	$©h6kl_∑r£_sˇn_∑øms
(c⁄° 
__u£r
 *
u£r_buf
, 
size_t
 
cou¡
,

4597 *
maxa˘_chdwñl_time
,

4598 *
∑s_chdwñl_time
,

4599 *
maxa˘_sˇn_≥r_ssid
)

4601 
buf
[16];

4602 *
p
;

4603 
vÆue
;

4604 
Àn
;

4606 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

4607 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

4608  -
EFAULT
;

4610 
p
 = 
buf
;

4612 
SKIP_SPACE
;

4614 
	`ssˇnf
(
p
, "%d", &
vÆue
);

4615 i‡(
vÆue
 < 
ATH6KL_SCAN_ACT_DEWELL_TIME
)

4616 
vÆue
 = 
ATH6KL_SCAN_ACT_DEWELL_TIME
;

4617 *
maxa˘_chdwñl_time
 = 
vÆue
;

4619 
SEEK_SPACE
;

4620 
SKIP_SPACE
;

4622 
	`ssˇnf
(
p
, "%d", &
vÆue
);

4623 i‡(
vÆue
 < 
ATH6KL_SCAN_PAS_DEWELL_TIME
)

4624 
vÆue
 = 
ATH6KL_SCAN_PAS_DEWELL_TIME
;

4625 *
∑s_chdwñl_time
 = 
vÆue
;

4627 
SEEK_SPACE
;

4628 
SKIP_SPACE
;

4630 
	`ssˇnf
(
p
, "%d", &
vÆue
);

4631 i‡(
vÆue
 <
ATH6KL_SCAN_PROBE_PER_SSID
)

4632 
vÆue
 = 1;

4633 *
maxa˘_sˇn_≥r_ssid
 = 
vÆue
;

4636 
	}
}

4638 
ssize_t
 
	$©h6kl_sˇn_∑øms_wrôe
(
fûe
 *file,

4639 c⁄° 
__u£r
 *
u£r_buf
,

4640 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4642 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4643 
©h6kl_vif
 *
vif
;

4644 
i
, 
ªt
;

4645 
maxa˘_chdwñl_time
, 
∑s_chdwñl_time
, 
maxa˘_sˇn_≥r_ssid
;

4647 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4648 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4649 i‡(
vif
) {

4650 
ªt
 = 
	`©h6kl_∑r£_sˇn_∑øms
(
u£r_buf
, 
cou¡
,

4651 &
maxa˘_chdwñl_time
,

4652 &
∑s_chdwñl_time
,

4653 &
maxa˘_sˇn_≥r_ssid
);

4654 i‡(!
ªt
) {

4655 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
 =

4656 
maxa˘_chdwñl_time
;

4657 
vif
->
sc_∑øms
.
∑s_chdwñl_time
 =

4658 
∑s_chdwñl_time
;

4659 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
 =

4660 
maxa˘_sˇn_≥r_ssid
;

4661 
	`mem˝y
(&
vif
->
sc_∑øms_deÁu…
, &vif->
sc_∑øms
,

4662 (
wmi_sˇn_∑øms_cmd
));

4664  
ªt
;

4668  
cou¡
;

4669 
	}
}

4671 
ssize_t
 
	$©h6kl_sˇn_∑øms_ªad
(
fûe
 *file,

4672 
__u£r
 *
u£r_buf
,

4673 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4675 
	#_BUF_SIZE
 (512)

	)

4676 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4677 
©h6kl_vif
 *
vif
;

4678 
u8
 *
buf
;

4679 
Àn
 = 0;

4680 
i
;

4681 
ssize_t
 
ªt_˙t
;

4683 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

4684 i‡(!
buf
)

4685  -
ENOMEM
;

4687 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4688 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4689 i‡(
vif
) {

4690 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

4692 
i
,

4693 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
,

4694 (
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
 == 0 ?

4695 
ATH6KL_SCAN_ACT_DEWELL_TIME
 :

4696 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
),

4697 (
vif
->
sc_∑øms
.
∑s_chdwñl_time
 == 0 ?

4698 
ATH6KL_SCAN_PAS_DEWELL_TIME
 :

4699 
vif
->
sc_∑øms
.
∑s_chdwñl_time
),

4700 (
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
 == 0 ?

4701 
ATH6KL_SCAN_PROBE_PER_SSID
 :

4702 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
));

4706 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

4708 
	`k‰ì
(
buf
);

4710  
ªt_˙t
;

4711 #unde‡
_BUF_SIZE


4712 
	}
}

4715 c⁄° 
fûe_›î©i⁄s
 
	gf›s_sˇn_∑øms
 = {

4716 .
ªad
 = 
©h6kl_sˇn_∑øms_ªad
,

4717 .
	gwrôe
 = 
©h6kl_sˇn_∑øms_wrôe
,

4718 .
	g›í
 = 
©h6kl_debugfs_›í
,

4719 .
	gow√r
 = 
THIS_MODULE
,

4720 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4724 
ssize_t
 
	$©h6kl_≠_kì∑live_∑øms_wrôe
(
fûe
 *file,

4725 c⁄° 
__u£r
 *
u£r_buf
,

4726 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4728 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4729 
©h6kl_vif
 *
vif
;

4730 *
p
;

4731 
öã∫Æ
, 
cy˛e
;

4732 
buf
[32];

4733 
ssize_t
 
Àn
;

4734 
i
;

4736 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

4737 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

4738  -
EFAULT
;

4740 
p
 = 
buf
;

4742 
SKIP_SPACE
;

4744 
	`ssˇnf
(
p
, "%d", &
öã∫Æ
);

4746 
SEEK_SPACE
;

4747 
SKIP_SPACE
;

4749 
	`ssˇnf
(
p
, "%d", &
cy˛e
);

4751 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4752 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4753 i‡(
vif
)

4754 
	`©h6kl_≠_kì∑live_c⁄fig
(
vif
,

4755 (
u32
)
öã∫Æ
,

4756 (
u32
)
cy˛e
);

4759  
cou¡
;

4760 
	}
}

4762 
ssize_t
 
	$©h6kl_≠_kì∑live_∑øms_ªad
(
fûe
 *file,

4763 
__u£r
 *
u£r_buf
,

4764 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4766 
	#_BUF_SIZE
 (256)

	)

4767 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4768 
©h6kl_vif
 *
vif
;

4769 
u8
 *
buf
;

4770 
Àn
 = 0;

4771 
i
;

4772 
ssize_t
 
ªt_˙t
;

4774 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

4775 i‡(!
buf
)

4776  -
ENOMEM
;

4778 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4779 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4780 i‡((
vif
) &&

4781 (
vif
->
≠_kì∑live_˘x
)) {

4782 i‡(
vif
->
≠_kì∑live_˘x
->
Êags
 &

4783 
ATH6KL_AP_KA_FLAGS_BY_SUPP
)

4784 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

4786 
i
);

4788 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

4790 
i
,

4791 
vif
->
≠_kì∑live_˘x
->
Êags
,

4792 
vif
->
≠_kì∑live_˘x
->
≠_ka_öãrvÆ
,

4793 
vif
->
≠_kì∑live_˘x
->
≠_ka_ª˛aim_cy˛e
);

4797 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

4799 
	`k‰ì
(
buf
);

4801  
ªt_˙t
;

4802 #unde‡
_BUF_SIZE


4803 
	}
}

4806 c⁄° 
fûe_›î©i⁄s
 
	gf›s_≠_kì∑live_∑øms
 = {

4807 .
ªad
 = 
©h6kl_≠_kì∑live_∑øms_ªad
,

4808 .
	gwrôe
 = 
©h6kl_≠_kì∑live_∑øms_wrôe
,

4809 .
	g›í
 = 
©h6kl_debugfs_›í
,

4810 .
	gow√r
 = 
THIS_MODULE
,

4811 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4814 
ssize_t
 
	$©h6kl_tgt_≠_°©_ªad
(
fûe
 *file,

4815 
__u£r
 *
u£r_buf
,

4816 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4818 
	#_BUF_SIZE
 (2048)

	)

4819 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4820 
©h6kl_vif
 *
vif
;

4821 
u8
 *
buf
;

4822 
u8
 *
p
;

4823 
Àn
 = 0;

4824 
i
, 
j
, 
buf_Àn
;

4825 
À·
;

4826 
ssize_t
 
ªt_˙t
;

4828 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

4829 i‡(!
buf
)

4830  -
ENOMEM
;

4832 
p
 = 
buf
;

4833 
buf_Àn
 = 
_BUF_SIZE
;

4834 
i
 = 0; i < 
¨
->
vif_max
; i++) {

4835 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

4837 i‡((
vif
) &&

4838 (
vif
->
nw_ty≥
 =
AP_NETWORK
)) {

4839 
wmi_≠_mode_°©
 *
≠_°©s
;

4841 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

4842 
ªt_˙t
 = -
EBUSY
;

4843 
FAIL
;

4846 
	`£t_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
);

4848 i‡(
	`©h6kl_wmi_gë_°©s_cmd
(
¨
->
wmi
,

4849 
vif
->
fw_vif_idx
)) {

4850 
	`up
(&
¨
->
£m
);

4851 
ªt_˙t
 = -
EIO
;

4852 
FAIL
;

4855 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

4856 !
	`ã°_bô
(
STATS_UPDATE_PEND
,

4857 &
vif
->
Êags
), 
WMI_TIMEOUT
);

4858 
	`up
(&
¨
->
£m
);

4860 i‡(
À·
 <= 0) {

4861 
ªt_˙t
 = -
ETIMEDOUT
;

4862 
FAIL
;

4865 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen, "VIF[%d]\n",

4866 
vif
->
fw_vif_idx
);

4868 
≠_°©s
 = &
vif
->ap_stats;

4869 
j
 = 0; j < 
AP_MAX_NUM_STA
; j++) {

4870 
wmi_≥r_°a_°©
 *
≥r_°a_°©
 =

4871 &
≠_°©s
->
°a
[
j
];

4873 i‡(
≥r_°a_°©
->
aid
) {

4874 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

4876 
≥r_°a_°©
->
aid
,

4877 
≥r_°a_°©
->
tx_byãs
,

4878 
≥r_°a_°©
->
tx_pkts
,

4879 
≥r_°a_°©
->
tx_îr‹
,

4880 
≥r_°a_°©
->
rx_byãs
,

4881 
≥r_°a_°©
->
rx_pkts
,

4882 
≥r_°a_°©
->
rx_îr‹
,

4883 
≥r_°a_°©
->
tx_uˇ°_øã
,

4884 
≥r_°a_°©
->
œ°_txrx_time
);

4890 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

4892 
FAIL
:

4893 
	`k‰ì
(
buf
);

4895  
ªt_˙t
;

4896 #unde‡
_BUF_SIZE


4897 
	}
}

4900 c⁄° 
fûe_›î©i⁄s
 
	gf›s_tgt_≠_°©s
 = {

4901 .
ªad
 = 
©h6kl_tgt_≠_°©_ªad
,

4902 .
	g›í
 = 
©h6kl_debugfs_›í
,

4903 .
	gow√r
 = 
THIS_MODULE
,

4904 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

4907 
	$__ch™_Êag_to_°rög
(
u32
 
Êags
, 
u8
 *
°rög
, 
°r_Àn
)

4909 
u8
 *
p
 = 
°rög
;

4910 
Àn
 = 0;

4912 
°rög
[0] = '\0';

4914 i‡(
Êags
 & 
IEEE80211_CHAN_DISABLED
)

4915 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
°r_Àn
 -Üen,

4919 i‡(
Êags
 & 
IEEE80211_CHAN_PASSIVE_SCAN
)

4920 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
°r_Àn
 -Üen,

4924 i‡(
Êags
 & 
IEEE80211_CHAN_NO_IBSS
)

4925 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
°r_Àn
 -Üen,

4929 i‡(
Êags
 & 
IEEE80211_CHAN_RADAR
)

4930 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
°r_Àn
 -Üen,

4934 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
°r_Àn
 -Üen,

4938 i‡((
Êags
 & 
IEEE80211_CHAN_NO_HT40PLUS
) &&

4939 (
Êags
 & 
IEEE80211_CHAN_NO_HT40MINUS
)) {

4942 i‡(
Êags
 & 
IEEE80211_CHAN_NO_HT40PLUS
)

4943 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
°r_Àn
 -Üen,

4946 i‡(
Êags
 & 
IEEE80211_CHAN_NO_HT40MINUS
)

4947 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
°r_Àn
 -Üen,

4951 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
°r_Àn
 -Üen,

4957 
	}
}

4959 
ssize_t
 
	$©h6kl_ch™_li°_ªad
(
fûe
 *file,

4960 
__u£r
 *
u£r_buf
,

4961 
size_t
 
cou¡
, 
loff_t
 *
µos
)

4963 
	#_BUF_SIZE
 (2048)

	)

4964 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

4965 
wùhy
 *wùhy = 
¨
->wiphy;

4966 
ªg_öfo
 *
ªg
 = 
¨
->
ªg_˘x
;

4967 
u8
 *
buf
, *
p
;

4968 
u8
 
Êag_°rög
[96];

4969 
Àn
 = 0;

4970 
i
, 
buf_Àn
;

4971 
õì80211_b™d
 
b™d
;

4972 
ssize_t
 
ªt_˙t
;

4974 i‡(!
ªg
)

4977 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

4978 i‡(!
buf
)

4979  -
ENOMEM
;

4981 
p
 = 
buf
;

4982 
buf_Àn
 = 
_BUF_SIZE
;

4984 i‡(
ªg
->
cuºít_ªgd
) {

4985 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

4987 
ªg
->
cuºít_ªg_code
,

4988 
ªg
->
cuºít_ªgd
->
Æpha2
[0],

4989 
ªg
->
cuºít_ªgd
->
Æpha2
[1],

4990 
ªg
->
cuºít_ªgd
->
n_ªg_ruÀs
);

4992 
i
 = 0; i < 
ªg
->
cuºít_ªgd
->
n_ªg_ruÀs
; i++) {

4993 
õì80211_ªg_ruÀ
 *
ªgRuÀ
;

4995 
ªgRuÀ
 = &
ªg
->
cuºít_ªgd
->
ªg_ruÀs
[
i
];

4996 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

4998 
ªgRuÀ
->
‰eq_ønge
.
°¨t_‰eq_khz
 / 1000,

4999 
ªgRuÀ
->
‰eq_ønge
.
íd_‰eq_khz
 / 1000,

5000 
ªgRuÀ
->
‰eq_ønge
.
max_b™dwidth_khz
 / 1000);

5004 
b™d
 = 0; b™d < 
IEEE80211_NUM_BANDS
; band++) {

5005 i‡(!
wùhy
->
b™ds
[
b™d
])

5008 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen, "\n%s\n",

5009 (
b™d
 =
IEEE80211_BAND_2GHZ
 ?

5012 
i
 = 0; i < 
wùhy
->
b™ds
[
b™d
]->
n_ch™√ls
; i++) {

5013 
õì80211_ch™√l
 *
ch™
;

5015 
ch™
 = &
wùhy
->
b™ds
[
b™d
]->
ch™√ls
[
i
];

5017 i‡(
ch™
->
Êags
 & 
IEEE80211_CHAN_DISABLED
)

5020 
	`__ch™_Êag_to_°rög
(
ch™
->
Êags
, 
Êag_°rög
, 96);

5021 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

5023 
ch™
->
hw_vÆue
,

5024 
ch™
->
˚¡î_‰eq
,

5025 
Êag_°rög
);

5029 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

5032 
i
 = 0; i < 
¨
->
vif_max
; i++) {

5033 
©h6kl_vif
 *
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

5035 i‡(
vif
)

5036 
Àn
 +
	`s˙¥ötf
(
p
 +Üí, 
buf_Àn
 -Üen,

5038 
i
,

5039 (
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) ?

5041 
vif
->
bss_ch
,

5042 
vif
->
phymode
,

5043 
vif
->
ch™_ty≥
);

5046 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5048 
	`k‰ì
(
buf
);

5050  
ªt_˙t
;

5051 #unde‡
_BUF_SIZE


5052 
	}
}

5055 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ch™_li°
 = {

5056 .
ªad
 = 
©h6kl_ch™_li°_ªad
,

5057 .
	g›í
 = 
©h6kl_debugfs_›í
,

5058 .
	gow√r
 = 
THIS_MODULE
,

5059 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5063 
ssize_t
 
	$©h6kl_≠_a˛_pﬁicy_wrôe
(
fûe
 *file,

5064 c⁄° 
__u£r
 *
u£r_buf
,

5065 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5067 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5068 
©h6kl_vif
 *
vif
;

5069 *
p
;

5070 
pﬁicy
;

5071 
buf
[32];

5072 
ssize_t
 
Àn
;

5073 
i
;

5075 #ifde‡
NL80211_CMD_SET_AP_MAC_ACL


5077 i‡(
¨
->
wùhy
->
max_a˛_mac_addrs
)

5078  -
EINVAL
;

5081 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5082 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5083  -
EFAULT
;

5085 
p
 = 
buf
;

5087 
SKIP_SPACE
;

5089 
	`ssˇnf
(
p
, "%d", &
pﬁicy
);

5091 
i
 = 0; i < 
¨
->
vif_max
; i++) {

5092 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

5095 i‡((
vif
) &&

5096 (
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_AP
))

5097 
	`©h6kl_≠_a˛_c⁄fig_pﬁicy
(
vif
, (
u8
)
pﬁicy
);

5100  
cou¡
;

5101 
	}
}

5103 
ssize_t
 
	$©h6kl_≠_a˛_pﬁicy_ªad
(
fûe
 *file,

5104 
__u£r
 *
u£r_buf
,

5105 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5107 
	#_BUF_SIZE
 (256)

	)

5108 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5109 
©h6kl_vif
 *
vif
;

5110 
u8
 *
buf
;

5111 
Àn
 = 0;

5112 
i
;

5113 
ssize_t
 
ªt_˙t
;

5115 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

5116 i‡(!
buf
)

5117  -
ENOMEM
;

5119 
i
 = 0; i < 
¨
->
vif_max
; i++) {

5120 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

5121 i‡((
vif
) &&

5122 (
vif
->
≠_a˛_˘x
)) {

5123 
≠_a˛_öfo
 *
≠_a˛
 = 
vif
->
≠_a˛_˘x
;

5125 
Àn
 +
	`s˙¥ötf
(
buf
 +Üí, 
_BUF_SIZE
 -Üen,

5127 
vif
->
fw_vif_idx
,

5128 (
≠_a˛
->
a˛_mode
 ?

5129 (
≠_a˛
->
a˛_mode
 =
AP_ACL_MODE_DENY
 ?

5135 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5137 
	`k‰ì
(
buf
);

5139  
ªt_˙t
;

5140 #unde‡
_BUF_SIZE


5141 
	}
}

5144 c⁄° 
fûe_›î©i⁄s
 
	gf›s_≠_a˛_pﬁicy
 = {

5145 .
ªad
 = 
©h6kl_≠_a˛_pﬁicy_ªad
,

5146 .
	gwrôe
 = 
©h6kl_≠_a˛_pﬁicy_wrôe
,

5147 .
	g›í
 = 
©h6kl_debugfs_›í
,

5148 .
	gow√r
 = 
THIS_MODULE
,

5149 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5153 
ssize_t
 
	$©h6kl_≠_a˛_mac_li°_wrôe
(
fûe
 *file,

5154 c⁄° 
__u£r
 *
u£r_buf
,

5155 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5157 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5158 
©h6kl_vif
 *
vif
;

5159 *
p
;

5160 
boﬁ
 
ªmoved
;

5161 
buf
[32];

5162 
u8
 
mac_addr
[
ETH_ALEN
];

5163 
addr
[
ETH_ALEN
];

5164 
ssize_t
 
Àn
;

5165 
i
;

5167 #ifde‡
NL80211_CMD_SET_AP_MAC_ACL


5169 i‡(
¨
->
wùhy
->
max_a˛_mac_addrs
)

5170  -
EINVAL
;

5173 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5174 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5175  -
EFAULT
;

5177 
p
 = 
buf
;

5179 
SKIP_SPACE
;

5181 i‡(
	`ssˇnf
(
p
, "%02x:%02x:%02x:%02x:%02x:%02x",

5182 &
addr
[0], &addr[1], &addr[2],

5183 &
addr
[3], &addr[4], &addr[5]Ë!
ETH_ALEN
)

5184  -
EINVAL
;

5186 
SEEK_SPACE
;

5187 
SKIP_SPACE
;

5189 i‡(
	`°r°r
(
p
, "r"))

5190 
ªmoved
 = 
åue
;

5192 
ªmoved
 = 
Ál£
;

5194 
i
 = 0; i < 
ETH_ALEN
; i++)

5195 
mac_addr
[
i
] = (
u8
)
addr
[i];

5197 
i
 = 0; i < 
¨
->
vif_max
; i++) {

5198 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

5201 i‡((
vif
) &&

5202 (
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_AP
))

5203 
	`©h6kl_≠_a˛_c⁄fig_mac_li°
(
vif
,

5204 
mac_addr
,

5205 
ªmoved
);

5208  
cou¡
;

5209 
	}
}

5211 
ssize_t
 
	$©h6kl_≠_a˛_mac_li°_ªad
(
fûe
 *file,

5212 
__u£r
 *
u£r_buf
,

5213 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5215 
	#_BUF_SIZE
 (2048)

	)

5216 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5217 
u8
 *
buf
;

5218 
Àn
 = 0;

5219 
ssize_t
 
ªt_˙t
;

5221 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

5222 i‡(!
buf
)

5223  -
ENOMEM
;

5225 
Àn
 = 
	`©h6kl_≠_a˛_dump
(
¨
, 
buf
, 
_BUF_SIZE
);

5227 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5229 
	`k‰ì
(
buf
);

5231  
ªt_˙t
;

5232 #unde‡
_BUF_SIZE


5233 
	}
}

5236 c⁄° 
fûe_›î©i⁄s
 
	gf›s_≠_a˛_mac_li°
 = {

5237 .
ªad
 = 
©h6kl_≠_a˛_mac_li°_ªad
,

5238 .
	gwrôe
 = 
©h6kl_≠_a˛_mac_li°_wrôe
,

5239 .
	g›í
 = 
©h6kl_debugfs_›í
,

5240 .
	gow√r
 = 
THIS_MODULE
,

5241 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5245 
ssize_t
 
	$©h6kl_ampdu_wrôe
(
fûe
 *file,

5246 c⁄° 
__u£r
 *
u£r_buf
,

5247 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5249 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5250 
©h6kl_vif
 *
vif
;

5251 
u32
 
ampdu
;

5252 
buf
[32];

5253 
ssize_t
 
Àn
;

5254 
i
;

5256 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5257 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5258  -
EFAULT
;

5260 
buf
[
Àn
] = '\0';

5261 i‡(
	`k°πou32
(
buf
, 0, &
ampdu
))

5262  -
EINVAL
;

5264 
i
 = 0; i < 
¨
->
vif_max
; i++) {

5265 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

5267 i‡(
vif
)

5268 
	`©h6kl_wmi_Ælow_aggr_cmd
(
vif
->
¨
->
wmi
,

5269 
vif
->
fw_vif_idx
,

5270 (
ampdu
 ? 0xff : 0),

5271 (
ampdu
 ? 0xff : 0));

5274  
cou¡
;

5275 
	}
}

5278 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ampdu
 = {

5279 .
wrôe
 = 
©h6kl_ampdu_wrôe
,

5280 .
	g›í
 = 
©h6kl_debugfs_›í
,

5281 .
	gow√r
 = 
THIS_MODULE
,

5282 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5285 
	$©h6kl_∑r£_¨p_ofÊﬂd_ù_addrs
(c⁄° 
__u£r
 *
u£r_buf
,

5286 
size_t
 
cou¡
,

5287 
u8
 *
ù_addrs
)

5289 
buf
[64];

5290 *
p
;

5291 
Àn
;

5292 
vÆue
, 
i
;

5294 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5295 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5296  -
EFAULT
;

5298 
p
 = 
buf
;

5300 
SKIP_SPACE
;

5302 
i
 = 0 ; i < 4; i++) {

5303 
	`ssˇnf
(
p
, "%d", &
vÆue
);

5304 i‡(
vÆue
 > 0xff) {

5306  -
EFAULT
;

5308 *(
ù_addrs
+
i
Ë
vÆue
;

5309 i‡(
i
 < 3) {

5310 
SEEK_SPACE
;

5311 
SKIP_SPACE
;

5316 
	}
}

5318 
ssize_t
 
	$©h6kl_¨p_ofÊﬂd_ùaddrs_wrôe
(
fûe
 *file,

5319 c⁄° 
__u£r
 *
u£r_buf
,

5320 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5322 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5323 
©h6kl_vif
 *
vif
;

5324 
ªt
;

5325 
u8
 
ù_addrs
[4];

5327 
	`¥ötk
("1\n");

5328 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

5329 i‡(!
vif
)

5330  -
EIO
;

5332 
vif
->
¨p_ofÊﬂd_ù_£t
 = 0;

5333 
ªt
 = 
	`©h6kl_∑r£_¨p_ofÊﬂd_ù_addrs
(
u£r_buf
, 
cou¡
, 
ù_addrs
);

5335 
	`¥ötk
("ªà%d\n",
ªt
);

5336 i‡(
ªt
)

5337  
ªt
;

5338 
	`¥ötk
("2\n");

5339 i‡(
	`©h6kl_wmi_£t_¨p_ofÊﬂd_ù_cmd
(
¨
->
wmi
, 
ù_addrs
))

5340  -
EIO
;

5341 
vif
->
¨p_ofÊﬂd_ù_£t
 = 1;

5342 
	`¥ötk
("3\n");

5343  
cou¡
;

5344 
	}
}

5347 c⁄° 
fûe_›î©i⁄s
 
	gf›s_¨p_ofÊﬂd_ù_addrs
 = {

5348 .
wrôe
 = 
©h6kl_¨p_ofÊﬂd_ùaddrs_wrôe
,

5349 .
	g›í
 = 
©h6kl_debugfs_›í
,

5350 .
	gow√r
 = 
THIS_MODULE
,

5351 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5354 
	#TBTT_MCC_STA_LOWER_BOUND
 20

	)

5355 
	#TBTT_MCC_STA_UPPER_BOUND
 80

	)

5357 
ssize_t
 
	$©h6kl_mcc_¥ofûe
(
fûe
 *file,

5358 c⁄° 
__u£r
 *
u£r_buf
,

5359 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5361 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5362 
buf
[10];

5363 
ssize_t
 
Àn
;

5364 
u32
 
mcc_¥ofûe
;

5365 
u32
 
°a_time
;

5366 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5367 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5368  -
EFAULT
;

5370 
buf
[
Àn
] = '\0';

5371 i‡(
	`k°πou32
(
buf
, 0, &
mcc_¥ofûe
))

5372  -
EINVAL
;

5373 
°a_time
 = (
mcc_¥ofûe
 & 0x0F)*10;

5374 i‡(
mcc_¥ofûe
 & 
WMI_MCC_DUAL_TIME_MASK
) {

5375 i‡(
°a_time
 > 
TBTT_MCC_STA_UPPER_BOUND
 ||

5376 
°a_time
 < 
TBTT_MCC_STA_LOWER_BOUND
) {

5377  -
EINVAL
;

5380 i‡(
	`©h6kl_wmi_£t_mcc_¥ofûe_cmd
(
¨
->
wmi
, 
mcc_¥ofûe
))

5381  -
EIO
;

5382  
cou¡
;

5383 
	}
}

5386 c⁄° 
fûe_›î©i⁄s
 
	gf›s_mcc_¥ofûe
 = {

5387 .
wrôe
 = 
©h6kl_mcc_¥ofûe
,

5388 .
	g›í
 = 
©h6kl_debugfs_›í
,

5389 .
	gow√r
 = 
THIS_MODULE
,

5390 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5394 
ssize_t
 
	$©h6kl_£amÀss_mcc_scc_swôch
(
fûe
 *file,

5395 c⁄° 
__u£r
 *
u£r_buf
,

5396 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5398 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5399 
buf
[10];

5400 
ssize_t
 
Àn
;

5401 
u32
 
‰eq
;

5403 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5404 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5405  -
EFAULT
;

5407 
buf
[
Àn
] = '\0';

5408 i‡(
	`k°πou32
(
buf
, 0, &
‰eq
))

5409  -
EINVAL
;

5411 i‡(
	`©h6kl_wmi_£t_£amÀss_mcc_scc_swôch_‰eq_cmd
(
¨
->
wmi
, 
‰eq
))

5412  -
EIO
;

5414  
cou¡
;

5415 
	}
}

5418 c⁄° 
fûe_›î©i⁄s
 
	gf›s_£amÀss_mcc_scc_swôch
 = {

5419 .
wrôe
 = 
©h6kl_£amÀss_mcc_scc_swôch
,

5420 .
	g›í
 = 
©h6kl_debugfs_›í
,

5421 .
	gow√r
 = 
THIS_MODULE
,

5422 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5426 
ssize_t
 
	$©h6kl_p2p_‰ame_ªåy_wrôe
(
fûe
 *file,

5427 c⁄° 
__u£r
 *
u£r_buf
,

5428 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5430 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5431 
u32
 
p2p_‰ame_ªåy
;

5432 
buf
[32];

5433 
ssize_t
 
Àn
;

5435 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5436 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5437  -
EFAULT
;

5439 
buf
[
Àn
] = '\0';

5440 i‡(
	`k°πou32
(
buf
, 0, &
p2p_‰ame_ªåy
))

5441  -
EINVAL
;

5443 i‡(
p2p_‰ame_ªåy
)

5444 
¨
->
p2p_‰ame_ªåy
 = 
åue
;

5446 
¨
->
p2p_‰ame_ªåy
 = 
Ál£
;

5448  
cou¡
;

5449 
	}
}

5452 c⁄° 
fûe_›î©i⁄s
 
	gf›s_p2p_‰ame_ªåy
 = {

5453 .
wrôe
 = 
©h6kl_p2p_‰ame_ªåy_wrôe
,

5454 .
	g›í
 = 
©h6kl_debugfs_›í
,

5455 .
	gow√r
 = 
THIS_MODULE
,

5456 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5460 
ssize_t
 
	$©h6kl_p2p_‰ame_c⁄d_ªje˘_wrôe
(
fûe
 *file,

5461 c⁄° 
__u£r
 *
u£r_buf
,

5462 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5464 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5465 
u32
 
p2p_‰ame_c⁄d_ªje˘
;

5466 
buf
[32];

5467 
ssize_t
 
Àn
;

5469 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5470 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5471  -
EFAULT
;

5473 
buf
[
Àn
] = '\0';

5474 i‡(
	`k°πou32
(
buf
, 0, &
p2p_‰ame_c⁄d_ªje˘
))

5475  -
EINVAL
;

5477 i‡(
p2p_‰ame_c⁄d_ªje˘
)

5478 
¨
->
p2p_‰ame_nŸ_ªp‹t
 = 
åue
;

5480 
¨
->
p2p_‰ame_nŸ_ªp‹t
 = 
Ál£
;

5482  
cou¡
;

5483 
	}
}

5486 c⁄° 
fûe_›î©i⁄s
 
	gp2p_‰ame_c⁄d_ªje˘
 = {

5487 .
wrôe
 = 
©h6kl_p2p_‰ame_c⁄d_ªje˘_wrôe
,

5488 .
	g›í
 = 
©h6kl_debugfs_›í
,

5489 .
	gow√r
 = 
THIS_MODULE
,

5490 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5493 
ssize_t
 
	$©h6kl_debug_quúks_wrôe
(
fûe
 *file,

5494 c⁄° 
__u£r
 *
u£r_buf
,

5495 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5497 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5498 
buf
[32];

5499 
ssize_t
 
Àn
;

5500 *
p
;

5501 
u32
 
quúks
, 
ª£t
;

5503 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5504 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5505  -
EFAULT
;

5507 
p
 = 
buf
;

5509 
SKIP_SPACE
;

5511 
	`ssˇnf
(
p
, "0x%x", &
quúks
);

5513 
SEEK_SPACE
;

5514 
SKIP_SPACE
;

5516 
	`ssˇnf
(
p
, "%d", &
ª£t
);

5518 
debug_quúks
 = 
quúks
;

5519 
¨
->
mod_debug_quúks
 = 
debug_quúks
;

5521 i‡(
ª£t
)

5522 
	`©h6kl_ª£t_devi˚
(
¨
,ár->
èrgë_ty≥
, 
åue
,Årue);

5524  
cou¡
;

5525 
	}
}

5527 
ssize_t
 
	$©h6kl_debug_quúks_ªad
(
fûe
 *file,

5528 
__u£r
 *
u£r_buf
,

5529 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5531 
buf
[32];

5532 
Àn
;

5534 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "debug_quúks: 0x%x\n", 
debug_quúks
);

5536  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5537 
	}
}

5539 c⁄° 
fûe_›î©i⁄s
 
	gf›s_debug_quúks
 = {

5540 .
ªad
 = 
©h6kl_debug_quúks_ªad
,

5541 .
	gwrôe
 = 
©h6kl_debug_quúks_wrôe
,

5542 .
	g›í
 = 
©h6kl_debugfs_›í
,

5543 .
	gow√r
 = 
THIS_MODULE
,

5544 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5547 
ssize_t
 
	$©h6kl_debug_dißbÀ_sˇn
(
fûe
 *file,

5548 c⁄° 
__u£r
 *
u£r_buf
,

5549 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5551 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5552 
buf
[32];

5553 
ssize_t
 
Àn
;

5554 
u32
 
vÆue
;

5556 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5557 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5558  -
EFAULT
;

5560 
buf
[
Àn
] = '\0';

5561 i‡(
	`k°πou32
(
buf
, 0, &
vÆue
))

5562  -
EINVAL
;

5564 i‡(
vÆue
)

5565 
	`£t_bô
(
DISABLE_SCAN
, &
¨
->
Êag
);

5567 
	`˛ór_bô
(
DISABLE_SCAN
, &
¨
->
Êag
);

5569  
cou¡
;

5570 
	}
}

5572 c⁄° 
fûe_›î©i⁄s
 
	gf›s_dißbÀ_sˇn
 = {

5573 .
wrôe
 = 
©h6kl_debug_dißbÀ_sˇn
,

5574 .
	g›í
 = 
©h6kl_debugfs_›í
,

5575 .
	gow√r
 = 
THIS_MODULE
,

5576 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5580 
ssize_t
 
	$©h6kl_dißbÀ_ru¡ime_Êow˘æ_wrôe
(
fûe
 *file,

5581 c⁄° 
__u£r
 *
u£r_buf
,

5582 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5584 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5585 
u32
 
vÆue
;

5586 
buf
[32];

5587 
ssize_t
 
Àn
;

5589 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5590 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5591  -
EFAULT
;

5593 
buf
[
Àn
] = '\0';

5594 i‡(
	`k°πou32
(
buf
, 0, &
vÆue
))

5595  -
EINVAL
;

5597 i‡(
vÆue
)

5598 
¨
->
c⁄f_Êags
 |
ATH6KL_CONF_DISABLE_SKIP_FLOWCTRL
;

5600 
¨
->
c⁄f_Êags
 &~
ATH6KL_CONF_DISABLE_SKIP_FLOWCTRL
;

5602 i‡(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_ENABLE_FLOWCTRL
) {

5603 i‡(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_DISABLE_SKIP_FLOWCTRL
)

5604 
	`˛ór_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
);

5606 i‡(
	`ã°_bô
(
MCC_ENABLED
, &
¨
->
Êag
))

5607 
	`˛ór_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
);

5609 
	`£t_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
);

5612 
	`˛ór_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
);

5614  
cou¡
;

5615 
	}
}

5617 
ssize_t
 
	$©h6kl_dißbÀ_ru¡ime_Êow˘æ_ªad
(
fûe
 *file,

5618 
__u£r
 *
u£r_buf
,

5619 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5621 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5622 
buf
[16];

5623 
Àn
;

5625 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "%d %d\n",

5626 (
¨
->
c⁄f_Êags
 &

5627 
ATH6KL_CONF_DISABLE_SKIP_FLOWCTRL
) ? 1 : 0,

5628 
	`ã°_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
));

5630  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5631 
	}
}

5634 c⁄° 
fûe_›î©i⁄s
 
	gf›s_dißbÀ_ru¡ime_Êow˘æ
 = {

5635 .
ªad
 = 
©h6kl_dißbÀ_ru¡ime_Êow˘æ_ªad
,

5636 .
	gwrôe
 = 
©h6kl_dißbÀ_ru¡ime_Êow˘æ_wrôe
,

5637 .
	g›í
 = 
©h6kl_debugfs_›í
,

5638 .
	gow√r
 = 
THIS_MODULE
,

5639 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5641 #ifde‡
USB_AUTO_SUSPEND


5643 
	$debugfs_gë_pm_°©e
(
©h6kl
 *
usbpm_¨
)

5645  
usbpm_¨
->
°©e
;

5646 
	}
}

5648 
ssize_t
 
	$©h6kl_usb_aut›m_ußge˙t_wrôe
(
fûe
 *file,

5649 c⁄° 
__u£r
 *
u£r_buf
,

5650 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5652 
ªt
;

5653 
vÆue
;

5654 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5656 
ªt
 = 
	`k°πou32_‰om_u£r
(
u£r_buf
, 
cou¡
, 0, &
vÆue
);

5658 i‡(
ªt
)

5659  
ªt
;

5661 i‡(
vÆue
 == 0) {

5662 
	`©h6kl_hif_auto_pm_íabÀ
(
¨
);

5663 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
, ("autoÖm -1\n"));

5664 } i‡(
vÆue
 == 1) {

5665 
	`©h6kl_hif_auto_pm_dißbÀ
(
¨
);

5666 
	`©h6kl_dbg
(
ATH6KL_DBG_ANY
, ("autoÖm +1\n"));

5669  
cou¡
;

5671 
	}
}

5672 
ssize_t
 
	$©h6kl_usb_aut›m_ußge˙t_ªad
(
fûe
 *file,

5673 
__u£r
 *
u£r_buf
,

5674 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5676 
buf
[32];

5677 
Àn
;

5678 
usb_auto_ußge˙t
;

5679 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5681 
usb_auto_ußge˙t
 = 
	`©h6kl_hif_auto_pm_gë_ußge_˙t
(
¨
);

5683 
Àn
 = 
	`¢¥ötf
(
buf
, (buf),

5684 "usbaut›m: 0x%x\n", 
usb_auto_ußge˙t
);

5686  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5687 
	}
}

5689 c⁄° 
fûe_›î©i⁄s
 
	gf›s_usb_aut›m_ußge˙t
 = {

5690 .
ªad
 = 
©h6kl_usb_aut›m_ußge˙t_ªad
,

5691 .
	gwrôe
 = 
©h6kl_usb_aut›m_ußge˙t_wrôe
,

5692 .
	g›í
 = 
©h6kl_debugfs_›í
,

5693 .
	gow√r
 = 
THIS_MODULE
,

5694 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5697 *
	g¨_°©e
[] = {

5706 
ssize_t
 
	$©h6kl_usb_pm_°©us_ªad
(
fûe
 *file,

5707 
__u£r
 *
u£r_buf
,

5708 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5710 
buf
[256];

5711 
Àn
;

5712 
°©e
;

5713 
buf_Àn
;

5714 
usb_pm_skb_queue_t
 *
p_usb_pm_skb_queue
;

5715 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5717 
buf_Àn
 = (
buf
);

5719 
°©e
 = 
	`debugfs_gë_pm_°©e
(
¨
);

5721 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "°©e: %s\n", 
¨_°©e
[
°©e
]);

5723 
p_usb_pm_skb_queue
 = &
¨
->
usb_pm_skb_queue
;

5725 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "usb_pm_q depth: %d\n",

5726 
	`gë_queue_dïth
(&(
p_usb_pm_skb_queue
->
li°
)));

5728  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5729 
	}
}

5731 c⁄° 
fûe_›î©i⁄s
 
	gf›s_usb_pm_°©us
 = {

5732 .
ªad
 = 
©h6kl_usb_pm_°©us_ªad
,

5733 .
	g›í
 = 
©h6kl_debugfs_›í
,

5734 .
	gow√r
 = 
THIS_MODULE
,

5735 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5741 
ssize_t
 
	$©h6kl_p2p_õ_nŸ_≠≥nd_wrôe
(
fûe
 *file,

5742 c⁄° 
__u£r
 *
u£r_buf
,

5743 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5745 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5746 
u32
 
p2p_õ_nŸ_≠≥nd
;

5747 
buf
[32];

5748 
ssize_t
 
Àn
;

5750 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5751 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5752  -
EFAULT
;

5754 
buf
[
Àn
] = '\0';

5755 i‡(
	`k°πou32
(
buf
, 0, &
p2p_õ_nŸ_≠≥nd
))

5756  -
EINVAL
;

5758 
¨
->
p2p_õ_nŸ_≠≥nd
 = 0;

5759 i‡(
p2p_õ_nŸ_≠≥nd
 & 
P2P_IE_IN_PROBE_REQ
)

5760 
¨
->
p2p_õ_nŸ_≠≥nd
 |
P2P_IE_IN_PROBE_REQ
;

5762 i‡(
p2p_õ_nŸ_≠≥nd
 & 
P2P_IE_IN_ASSOC_REQ
)

5763 
¨
->
p2p_õ_nŸ_≠≥nd
 |
P2P_IE_IN_ASSOC_REQ
;

5765  
cou¡
;

5766 
	}
}

5768 
ssize_t
 
	$©h6kl_p2p_õ_nŸ_≠≥nd_ªad
(
fûe
 *file,

5769 
__u£r
 *
u£r_buf
,

5770 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5772 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5773 
©h6kl_vif
 *
vif
;

5774 
buf
[64];

5775 
Àn
 = 0;

5777 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

5778 i‡(!
vif
)

5779  -
EIO
;

5781 i‡((
¨
->
p2p_c⁄cuºít
) &&

5782 (
vif
->
nw_ty≥
 =
INFRA_NETWORK
)) {

5783 
Àn
 = 
	`¢¥ötf
(
buf
, (buf),

5785 ((
¨
->
p2p_õ_nŸ_≠≥nd
 & 
P2P_IE_IN_PROBE_REQ
) ?

5787 ((
¨
->
p2p_õ_nŸ_≠≥nd
 & 
P2P_IE_IN_ASSOC_REQ
) ?

5791  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5792 
	}
}

5795 c⁄° 
fûe_›î©i⁄s
 
	gf›s_p2p_õ_nŸ_≠≥nd
 = {

5796 .
ªad
 = 
©h6kl_p2p_õ_nŸ_≠≥nd_ªad
,

5797 .
	gwrôe
 = 
©h6kl_p2p_õ_nŸ_≠≥nd_wrôe
,

5798 .
	g›í
 = 
©h6kl_debugfs_›í
,

5799 .
	gow√r
 = 
THIS_MODULE
,

5800 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5804 
ssize_t
 
	$©h6kl_≠_admc_ªad
(
fûe
 *file,

5805 
__u£r
 *
u£r_buf
,

5806 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5808 
	#_BUF_SIZE
 (256)

	)

5809 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5810 
u8
 *
buf
;

5811 
Àn
 = 0;

5812 
ssize_t
 
ªt_˙t
;

5814 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

5815 i‡(!
buf
)

5816  -
ENOMEM
;

5818 
Àn
 = 
	`©h6kl_≠_admc_dump
(
¨
, 
buf
, 
_BUF_SIZE
);

5820 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5822 
	`k‰ì
(
buf
);

5824  
ªt_˙t
;

5825 #unde‡
_BUF_SIZE


5826 
	}
}

5829 c⁄° 
fûe_›î©i⁄s
 
	gf›s_≠_admc
 = {

5830 .
ªad
 = 
©h6kl_≠_admc_ªad
,

5831 .
	g›í
 = 
©h6kl_debugfs_›í
,

5832 .
	gow√r
 = 
THIS_MODULE
,

5833 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5837 
ssize_t
 
	$©h6kl_p2p_rc_wrôe
(
fûe
 *file,

5838 c⁄° 
__u£r
 *
u£r_buf
,

5839 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5841 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5842 
u32
 
tmp
;

5843 
ty≥
 = 0;

5844 
u16
 
‰eq
 = 0;

5845 
buf
[8];

5846 
ssize_t
 
Àn
;

5848 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5849 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5850  -
EFAULT
;

5852 
buf
[
Àn
] = '\0';

5853 i‡(
	`k°πou32
(
buf
, 0, &
tmp
))

5854  -
EINVAL
;

5856 i‡(
tmp
 =
P2P_RC_USER_BLACK_CHAN
)

5857 
ty≥
 = 
P2P_RC_USER_BLACK_CHAN
;

5858 i‡(
tmp
 =
P2P_RC_USER_WHITE_CHAN
)

5859 
ty≥
 = 
P2P_RC_USER_WHITE_CHAN
;

5860 i‡((
tmp
 >= 2412) && (tmp <= 5825))

5861 
‰eq
 = (
u16
)
tmp
;

5863  -
EINVAL
;

5865 
	`©h6kl_p2p_rc_c⁄fig
(
¨
, 
‰eq
, (‰eq ? -1 : 
ty≥
));

5867  
cou¡
;

5868 
	}
}

5870 
ssize_t
 
	$©h6kl_p2p_rc_ªad
(
fûe
 *file,

5871 
__u£r
 *
u£r_buf
,

5872 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5874 
	#_BUF_SIZE
 (2048)

	)

5875 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5876 
u8
 *
buf
;

5877 
Àn
 = 0;

5878 
ssize_t
 
ªt_˙t
;

5880 
buf
 = 
	`kmÆloc
(
_BUF_SIZE
, 
GFP_ATOMIC
);

5881 i‡(!
buf
)

5882  -
ENOMEM
;

5884 
Àn
 = 
	`©h6kl_p2p_rc_dump
(
¨
, 
buf
, 
_BUF_SIZE
);

5886 
ªt_˙t
 = 
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5888 
	`k‰ì
(
buf
);

5890  
ªt_˙t
;

5891 #unde‡
_BUF_SIZE


5892 
	}
}

5895 c⁄° 
fûe_›î©i⁄s
 
	gf›s_p2p_rc
 = {

5896 .
ªad
 = 
©h6kl_p2p_rc_ªad
,

5897 .
	gwrôe
 = 
©h6kl_p2p_rc_wrôe
,

5898 .
	g›í
 = 
©h6kl_debugfs_›í
,

5899 .
	gow√r
 = 
THIS_MODULE
,

5900 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5904 
ssize_t
 
	$©h6kl_hif_pùe_rxq_thªshﬁd_wrôe
(
fûe
 *file,

5905 c⁄° 
__u£r
 *
u£r_buf
,

5906 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5908 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5909 
buf
[64];

5910 *
•å
, *
tokí
;

5911 
Àn
;

5912 
u32
 
rxq_thªshﬁd
 = 0;

5914 i‡(
¨
->
hif_ty≥
 !
ATH6KL_HIF_TYPE_USB
)

5915  -
EIO
;

5917 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5918 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5919  -
EFAULT
;

5921 
buf
[
Àn
] = '\0';

5923 
•å
 = 
buf
;

5925 
tokí
 = 
	`°r£p
(&
•å
, " ");

5926 i‡(!
tokí
)

5927  -
EINVAL
;

5928 i‡(
	`k°πou32
(
tokí
, 0, &
rxq_thªshﬁd
))

5929  -
EINVAL
;

5931 
	`©h6kl_hif_pùe_£t_rxq_thªshﬁd
(
¨
, 
rxq_thªshﬁd
);

5933  
cou¡
;

5934 
	}
}

5937 c⁄° 
fûe_›î©i⁄s
 
	gf›s_hif_pùe_rxq_thªshﬁd
 = {

5938 .
wrôe
 = 
©h6kl_hif_pùe_rxq_thªshﬁd_wrôe
,

5939 .
	g›í
 = 
©h6kl_debugfs_›í
,

5940 .
	gow√r
 = 
THIS_MODULE
,

5941 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5944 
ssize_t
 
	$©h6kl_skb_dup_ªad
(
fûe
 *file,

5945 
__u£r
 *
u£r_buf
,

5946 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5948 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5949 
buf
[64];

5950 
Àn
;

5952 
Àn
 = 
	`¢¥ötf
(
buf
, (buf), "skb_duplicate %s\n",

5953 (
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_SKB_DUP
)

5956  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

5957 
	}
}

5959 
ssize_t
 
	$©h6kl_skb_dup_wrôe
(
fûe
 *file,

5960 c⁄° 
__u£r
 *
u£r_buf
,

5961 
size_t
 
cou¡
, 
loff_t
 *
µos
)

5963 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

5964 
buf
[20];

5965 
size_t
 
Àn
;

5967 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

5968 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

5969  -
EFAULT
;

5971 
buf
[
Àn
] = '\0';

5972 i‡(
Àn
 > 0 && 
buf
[len - 1] == '\n')

5973 
buf
[
Àn
 - 1] = '\0';

5975 i‡(
	`°rˇ£cmp
(
buf
, "disable") == 0)

5976 
¨
->
c⁄f_Êags
 &=

5977 ~
ATH6KL_CONF_SKB_DUP
;

5978 i‡(
	`°rˇ£cmp
(
buf
, "enable") == 0)

5979 
¨
->
c⁄f_Êags
 |=

5980 
ATH6KL_CONF_SKB_DUP
;

5982  -
EINVAL
;

5984  
cou¡
;

5985 
	}
}

5987 c⁄° 
fûe_›î©i⁄s
 
	gf›s_skb_dup_›î©i⁄
 = {

5988 .
ªad
 = 
©h6kl_skb_dup_ªad
,

5989 .
	gwrôe
 = 
©h6kl_skb_dup_wrôe
,

5990 .
	g›í
 = 
©h6kl_debugfs_›í
,

5991 .
	gow√r
 = 
THIS_MODULE
,

5992 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

5996 
ssize_t
 
	$©h6kl_dtim_ext_wrôe
(
fûe
 *file,

5997 c⁄° 
__u£r
 *
u£r_buf
,

5998 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6000 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6001 
ªt
;

6003 
ªt
 = 
	`k°πou8_‰om_u£r
(
u£r_buf
, 
cou¡
, 0,

6004 &
¨
->
dtim_ext
);

6006 i‡(
ªt
)

6007  
ªt
;

6009 i‡(
	`©h6kl_wmi_£t_dtim_ext
(
¨
->
wmi
,ár->
dtim_ext
))

6010  -
EIO
;

6012  
cou¡
;

6013 
	}
}

6015 
ssize_t
 
	$©h6kl_dtim_ext_ªad
(
fûe
 *file,

6016 
__u£r
 *
u£r_buf
,

6017 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6019 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6020 
u8
 
buf
[32];

6021 
Àn
 = 0;

6023 
Àn
 = 
	`s˙¥ötf
(
buf
, (buf), "DTIM Ext: %d\n",

6024 
¨
->
dtim_ext
);

6026  
	`sim∂e_ªad_‰om_buf„r
(
u£r_buf
, 
cou¡
, 
µos
, 
buf
, 
Àn
);

6027 
	}
}

6030 c⁄° 
fûe_›î©i⁄s
 
	gf›s_dtim_ext
 = {

6031 .
ªad
 = 
©h6kl_dtim_ext_ªad
,

6032 .
	gwrôe
 = 
©h6kl_dtim_ext_wrôe
,

6033 .
	g›í
 = 
©h6kl_debugfs_›í
,

6034 .
	gow√r
 = 
THIS_MODULE
,

6035 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6039 
ssize_t
 
	$©h6kl_ªg_cou¡ry_wrôe
(
fûe
 *file,

6040 c⁄° 
__u£r
 *
u£r_buf
,

6041 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6043 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6044 
buf
[8], 
Æpha2
[2];

6045 
Àn
;

6047 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

6048 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

6049  -
EFAULT
;

6051 
Æpha2
[0] = 
buf
[0];

6052 
Æpha2
[1] = 
buf
[1];

6054 i‡(
	`©h6kl_ªg_£t_cou¡ry
(
¨
, 
Æpha2
))

6055  -
EIO
;

6057  
cou¡
;

6058 
	}
}

6061 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ªg_cou¡ry_wrôe
 = {

6062 .
wrôe
 = 
©h6kl_ªg_cou¡ry_wrôe
,

6063 .
	g›í
 = 
©h6kl_debugfs_›í
,

6064 .
	gow√r
 = 
THIS_MODULE
,

6065 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6069 
ssize_t
 
	$©h6kl_p2p_go_sync_wrôe
(
fûe
 *file,

6070 c⁄° 
__u£r
 *
u£r_buf
,

6071 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6073 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6074 *
buf
, *
p
;

6075 
vÆue
, 
i
, 
addr
[
ETH_ALEN
];

6076 
u16
 
ch_li°
[1];

6077 
wmi_£t_go_sync_cmd
 
gsync
;

6078 
©h6kl_vif
 *
vif
;

6080 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

6081 i‡(
buf
 =
NULL
)

6082  -
EFAULT
;

6083 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

6084 
	`k‰ì
(
buf
);

6085  -
EFAULT
;

6088 
p
 = 
buf
;

6089 
SKIP_SPACE
;

6090 
	`ssˇnf
(
p
, "%d", &
vÆue
);

6091 
ch_li°
[0] = 
gsync
.
‰eq
 = (
u16
)
vÆue
;

6092 
SEEK_SPACE
;

6093 
SKIP_SPACE
;

6094 i‡(
	`ssˇnf
(
p
, "%02x:%02x:%02x:%02x:%02x:%02x",

6095 &
addr
[0], &addr[1], &addr[2], &addr[3], &addr[4], &addr[5])

6096 !
ETH_ALEN
) {

6097 
	`k‰ì
(
buf
);

6098  -
EINVAL
;

6100 
i
 = 0; i < 
ETH_ALEN
; i++)

6101 
gsync
.
addr
[
i
] = (
u8
)addr[i];

6103 
SEEK_SPACE
;

6104 
SKIP_SPACE
;

6105 
	`ssˇnf
(
p
, "%d", &
vÆue
);

6106 
gsync
.
ª≥©
 = (
u8
)
vÆue
;

6107 
SEEK_SPACE
;

6108 
SKIP_SPACE
;

6109 
	`ssˇnf
(
p
, "%d", &
vÆue
);

6110 
gsync
.
°a_dwñl_time
 = (
u8
)
vÆue
;

6112 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6113 i‡(!
vif
->
u§_bss_fûãr
) {

6114 
	`˛ór_bô
(
CLEAR_BSSFILTER_ON_BEACON
, &
vif
->
Êags
);

6115 
	`©h6kl_wmi_bssfûãr_cmd
(

6116 
¨
->
wmi
,

6117 
vif
->
fw_vif_idx
,

6118 
ALL_BSS_FILTER
,

6121 
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

6122 
vif
->
sc_∑øms
.
fg_°¨t_≥riod
,

6123 
vif
->
sc_∑øms
.
fg_íd_≥riod
,

6124 
vif
->
sc_∑øms
.
bg_≥riod
,

6127 
vif
->
sc_∑øms
.
∑s_chdwñl_time
,

6128 
vif
->
sc_∑øms
.
sh‹t_sˇn_øtio
,

6129 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
,

6130 
vif
->
sc_∑øms
.
max_dfsch_a˘_time
,

6131 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
);

6132 
	`©h6kl_wmi_go_sync_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, &
gsync
);

6133 
	`©h6kl_wmi_°¨tsˇn_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
WMI_LONG_SCAN
,

6134 1, 
Ál£
, 0,

6136 1, 
ch_li°
);

6137 
	`k‰ì
(
buf
);

6138  
cou¡
;

6139 
	}
}

6142 c⁄° 
fûe_›î©i⁄s
 
	gf›s_p2p_go_sync
 = {

6143 .
wrôe
 = 
©h6kl_p2p_go_sync_wrôe
,

6144 .
	g›í
 = 
©h6kl_debugfs_›í
,

6145 .
	gow√r
 = 
THIS_MODULE
,

6146 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6150 
ssize_t
 
	$©h6kl_≠_rc_wrôe
(
fûe
 *file,

6151 c⁄° 
__u£r
 *
u£r_buf
,

6152 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6154 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6155 
©h6kl_vif
 *
vif
;

6156 
u32
 
i
, 
tmp
;

6157 
mode_‹_‰eq
 = 0;

6158 
buf
[8];

6159 
ssize_t
 
Àn
;

6161 
Àn
 = 
	`mö
(
cou¡
, (
buf
) - 1);

6162 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, 
Àn
))

6163  -
EFAULT
;

6165 
buf
[
Àn
] = '\0';

6166 i‡(
	`k°πou32
(
buf
, 0, &
tmp
))

6167  -
EINVAL
;

6169 
mode_‹_‰eq
 = ()
tmp
;

6171 
i
 = 0; i < 
¨
->
vif_max
; i++) {

6172 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

6173 i‡(
vif
)

6174 
	`©h6kl_≠_rc_c⁄fig
(
vif
, 
mode_‹_‰eq
);

6181 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6182 
	`©h6kl_≠_rc_upd©e
(
vif
);

6184  
cou¡
;

6185 
	}
}

6188 c⁄° 
fûe_›î©i⁄s
 
	gf›s_≠_rc
 = {

6189 .
wrôe
 = 
©h6kl_≠_rc_wrôe
,

6190 .
	g›í
 = 
©h6kl_debugfs_›í
,

6191 .
	gow√r
 = 
THIS_MODULE
,

6192 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6196 
ssize_t
 
	$©h6kl_f›s_ømdom_bóc⁄_skù_wrôe
(
fûe
 *file,

6197 c⁄° 
__u£r
 *
u£r_buf
,

6198 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6200 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6201 
©h6kl_vif
 *
vif
;

6202 
u8
 *
buf
;

6203 
u32
 
íabÀd
;

6204 
u32
 
⁄
;

6205 
u32
 
∫d
;

6206 
u32
 
off
;

6209 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6210 i‡(!
vif
)

6211  -
EIO
;

6213 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

6214 i‡(!
buf
)

6215  -
EFAULT
;

6216 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

6217 
	`k‰ì
(
buf
);

6218  -
EFAULT
;

6221 i‡(
	`ssˇnf
(
buf
, "%d %d %d %d", &
íabÀd
, &
⁄
, &
∫d
, &
off
) != 4) {

6222 
	`k‰ì
(
buf
);

6223  -
EINVAL
;

6226 
	`k‰ì
(
buf
);

6228 
	`©h6kl_wmi_£t_øndom_bóc⁄_skù
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
íabÀd
, 
⁄
, 
∫d
, 
off
);

6230  
cou¡
;

6231 
	}
}

6234 c⁄° 
fûe_›î©i⁄s
 
	gf›s_ømdom_bóc⁄_skù
 = {

6235 .
wrôe
 = 
©h6kl_f›s_ømdom_bóc⁄_skù_wrôe
,

6236 .
	g›í
 = 
©h6kl_debugfs_›í
,

6237 .
	gow√r
 = 
THIS_MODULE
,

6238 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6241 #ifde‡
DHCP_CLIENT_FEATURE


6244 
ssize_t
 
	$©h6kl_f›s_£t_dh˝_˛õ¡_wrôe
(
fûe
 *file,

6245 c⁄° 
__u£r
 *
u£r_buf
,

6246 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6248 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6249 
©h6kl_vif
 *
vif
;

6250 
u8
 *
buf
;

6251 
u32
 
íabÀd
;

6252 
u32
 
ù
 = 0;

6253 
u32
 
ù_add
[4];

6254 
ªt
;

6257 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6258 i‡(!
vif
)

6259  -
EIO
;

6261 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

6262 i‡(!
buf
)

6263  -
EFAULT
;

6264 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

6265 
	`k‰ì
(
buf
);

6266  -
EFAULT
;

6269 
ªt
 = 
	`ssˇnf
(
buf
, "%d %d.%d.%d.%d", &
íabÀd
, &
ù_add
[0], &ip_add[1], &ip_add[2], &ip_add[3]);

6270 i‡(((!
íabÀd
Ë&& (
ªt
 != 1)) || ((enabled) && (ret != 5))) {

6271 
	`k‰ì
(
buf
);

6272  -
EINVAL
;

6275 
	`k‰ì
(
buf
);

6277 if(
ªt
 == 5) {

6278 
ù
 = (((
ù_add
[0] & 0xFF) << 24) | ((ip_add[1] & 0xFF) << 16) | ((ip_add[2] & 0xFF) << 8) | (ip_add[3] & 0xFF));

6281 
	`©h6kl_wmi_£t_dh˝_˛õ¡
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
ù
, 
íabÀd
);

6283  
cou¡
;

6284 
	}
}

6287 c⁄° 
fûe_›î©i⁄s
 
	gf›s_£t_dh˝_˛õ¡
 = {

6288 .
wrôe
 = 
©h6kl_f›s_£t_dh˝_˛õ¡_wrôe
,

6289 .
	g›í
 = 
©h6kl_debugfs_›í
,

6290 .
	gow√r
 = 
THIS_MODULE
,

6291 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6296 #ifde‡
DHCP_SERVER_FEATURE


6299 
ssize_t
 
	$©h6kl_f›s_£t_dh˝_£rvî_wrôe
(
fûe
 *file,

6300 c⁄° 
__u£r
 *
u£r_buf
,

6301 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6303 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6304 
©h6kl_vif
 *
vif
;

6305 
u8
 *
buf
;

6306 
u32
 
íabÀd
;

6307 
u32
 
ù
 = 0;

6308 
u32
 
ù_add
[4];

6309 
ªt
;

6312 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6313 i‡(!
vif
)

6314  -
EIO
;

6316 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

6317 i‡(!
buf
)

6318  -
EFAULT
;

6319 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

6320 
	`k‰ì
(
buf
);

6321  -
EFAULT
;

6324 
ªt
 = 
	`ssˇnf
(
buf
, "%d %d.%d.%d.%d", &
íabÀd
, &
ù_add
[0], &ip_add[1], &ip_add[2], &ip_add[3]);

6325 i‡(((!
íabÀd
Ë&& (
ªt
 != 1)) || ((enabled) && (ret != 5))) {

6326 
	`k‰ì
(
buf
);

6327  -
EINVAL
;

6330 
	`k‰ì
(
buf
);

6332 if(
ªt
 == 5) {

6333 
ù
 = (((
ù_add
[0] & 0xFF) << 24) | ((ip_add[1] & 0xFF) << 16) | ((ip_add[2] & 0xFF) << 8) | (ip_add[3] & 0xFF));

6336 
	`©h6kl_wmi_£t_dh˝_£rvî
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
ù
, 
íabÀd
);

6338  
cou¡
;

6339 
	}
}

6342 c⁄° 
fûe_›î©i⁄s
 
	gf›s_£t_dh˝_£rvî
 = {

6343 .
wrôe
 = 
©h6kl_f›s_£t_dh˝_£rvî_wrôe
,

6344 .
	g›í
 = 
©h6kl_debugfs_›í
,

6345 .
	gow√r
 = 
THIS_MODULE
,

6346 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6352 #ifde‡
CONFIG_WLAN_QRF


6355 
ssize_t
 
	$©h6kl_f›s_qrf_íabÀ_wrôe
(
fûe
 *file,

6356 c⁄° 
__u£r
 *
u£r_buf
,

6357 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6359 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6360 
©h6kl_vif
 *
vif
;

6361 
ªt
;

6362 
u8
 *
buf
;

6363 
íabÀd
;

6366 if(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
))

6368 
	`¥ötk
("1\n");

6369  -
EIO
;

6373 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6374 i‡(!
vif
)

6375  -
EIO
;

6377 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

6378 i‡(!
buf
)

6379  -
EFAULT
;

6381 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

6382 
	`k‰ì
(
buf
);

6383 
	`¥ötk
("4\n");

6384  -
EFAULT
;

6387 
ªt
 = 
	`ssˇnf
(
buf
, "%d", &
íabÀd
);

6388 i‡((
ªt
 !1Ë|| ((
íabÀd
 < 0) && (enabled > 2))) {

6389 
	`k‰ì
(
buf
);

6390  -
EINVAL
;

6393 
	`k‰ì
(
buf
);

6395 
	`©h6kl_wmi_qrf_íabÀ
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, (
u8
)
íabÀd
);

6397  
cou¡
;

6398 
	}
}

6401 c⁄° 
fûe_›î©i⁄s
 
	gf›s_qrf_íabÀ
 = {

6402 .
wrôe
 = 
©h6kl_f›s_qrf_íabÀ_wrôe
,

6403 .
	g›í
 = 
©h6kl_debugfs_›í
,

6404 .
	gow√r
 = 
THIS_MODULE
,

6405 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6409 
ssize_t
 
	$©h6kl_f›s_qrf_£t_ssid_wrôe
(
fûe
 *file,

6410 c⁄° 
__u£r
 *
u£r_buf
,

6411 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6413 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6414 
©h6kl_vif
 *
vif
;

6415 
u8
 *
buf
;

6416 
u8
 
ssid
[
IEEE80211_MAX_SSID_LEN
];

6417 
ssid_Àn
;

6418 
u8
 
Êag
;

6421 if(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
))

6422  -
EIO
;

6425 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6426 i‡(!
vif
)

6427  -
EIO
;

6429 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

6430 i‡(!
buf
)

6431  -
EFAULT
;

6432 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

6433 
	`k‰ì
(
buf
);

6434  -
EFAULT
;

6438 
buf
[
cou¡
-1] = 0;

6440 
ssid_Àn
 = 
	`°æí
(
buf
);

6441 i‡(!
ssid_Àn
) {

6442 
	`k‰ì
(
buf
);

6443  -
EINVAL
;

6446 if(
ssid_Àn
 > 
IEEE80211_MAX_SSID_LEN
)

6447 
ssid_Àn
 = 
IEEE80211_MAX_SSID_LEN
;

6449 
	`mem˝y
(
ssid
, 
buf
, (
ssid_Àn
+1));

6451 
	`k‰ì
(
buf
);

6454 if(
ssid
[
ssid_Àn
-1] == '*')

6456 
Êag
 = 
ANY_SSID_FLAG
;

6457 
ssid_Àn
 -= 1;

6458 
ssid
[
ssid_Àn
] = 0;

6461 
Êag
 = 
SPECIFIC_SSID_FLAG
;

6463 
	`©h6kl_wmi_qrf_£t_ssid
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
Êag
, (
u8
)
ssid_Àn
, 
ssid
);

6465  
cou¡
;

6466 
	}
}

6469 c⁄° 
fûe_›î©i⁄s
 
	gf›s_qrf_£t_ssid
 = {

6470 .
wrôe
 = 
©h6kl_f›s_qrf_£t_ssid_wrôe
,

6471 .
	g›í
 = 
©h6kl_debugfs_›í
,

6472 .
	gow√r
 = 
THIS_MODULE
,

6473 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6477 
ssize_t
 
	$©h6kl_f›s_qrf_£t_mac_wrôe
(
fûe
 *file,

6478 c⁄° 
__u£r
 *
u£r_buf
,

6479 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6481 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6482 
©h6kl_vif
 *
vif
;

6483 
ªt
;

6484 
u8
 *
buf
;

6485 
u8
 
mac
[
ETH_ALEN
];

6488 if(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
))

6489  -
EIO
;

6492 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6493 i‡(!
vif
)

6494  -
EIO
;

6496 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

6497 i‡(!
buf
)

6498  -
EFAULT
;

6499 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

6500 
	`k‰ì
(
buf
);

6501  -
EFAULT
;

6504 
ªt
 = 
	`exåa˘_mac
(
buf
, 
mac
);

6505 i‡(
ªt
 != 6) {

6506 
	`k‰ì
(
buf
);

6507  -
EINVAL
;

6510 
	`k‰ì
(
buf
);

6512 
	`©h6kl_wmi_qrf_£t_mac
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
mac
);

6514  
cou¡
;

6515 
	}
}

6518 c⁄° 
fûe_›î©i⁄s
 
	gf›s_qrf_£t_mac
 = {

6519 .
wrôe
 = 
©h6kl_f›s_qrf_£t_mac_wrôe
,

6520 .
	g›í
 = 
©h6kl_debugfs_›í
,

6521 .
	gow√r
 = 
THIS_MODULE
,

6522 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6526 
ssize_t
 
	$©h6kl_f›s_qrf_£t_∑øms_wrôe
(
fûe
 *file,

6527 c⁄° 
__u£r
 *
u£r_buf
,

6528 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6530 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6531 
©h6kl_vif
 *
vif
;

6532 
u8
 *
buf
;

6533 
d⁄e
;

6534 
num_∑øms
;

6535 *
±r
;

6536 
∑øm
[
WMI_QRF_NUM_CHANNELS_MAX
+2];

6537 
u32
 
sˇnI¡îvÆ
;

6538 
u32
 
sˇnDwñlI¡îvÆ
;

6539 
u8
 
numCh™√ls
;

6540 
u16
 
ch™√lLi°
[
WMI_QRF_NUM_CHANNELS_MAX
];

6543 if(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
))

6544  -
EIO
;

6547 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6548 i‡(!
vif
)

6549  -
EIO
;

6551 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

6552 i‡(!
buf
)

6553  -
EFAULT
;

6554 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

6555 
	`k‰ì
(
buf
);

6556  -
EFAULT
;

6560 
buf
[
cou¡
-1] = 0;

6562 
d⁄e
 = 0;

6563 
num_∑øms
 = 0;

6564 
±r
 = (*)
buf
;

6565 
	`¥ötk
("%s\n", 
±r
);

6567 (!
d⁄e
Ë&& (
num_∑øms
 < (
WMI_QRF_NUM_CHANNELS_MAX
+2)))

6569 
∑øm
[
num_∑øms
] = 
	`exåa˘_öt
(&
±r
);

6570 if(
∑øm
[
num_∑øms
] >= 0)

6571 
num_∑øms
++;

6573 
d⁄e
 = 1;

6576 if((
num_∑øms
 < 3Ë|| (“um_∑øm†<(
WMI_QRF_NUM_CHANNELS_MAX
+2)Ë&& (*
±r
))) {

6577 
	`k‰ì
(
buf
);

6578  -
EINVAL
;

6581 
	`k‰ì
(
buf
);

6583 
sˇnI¡îvÆ
 = 
∑øm
[0];

6584 
sˇnDwñlI¡îvÆ
 = 
∑øm
[1];

6585 
num_∑øms
 -= 2;

6586 
numCh™√ls
 = 0;

6587 
num_∑øms
--)

6589 
ch™√lLi°
[
numCh™√ls
] = (
u16
)(
∑øm
[2+numChannels]);

6590 
numCh™√ls
++;

6593 
	`©h6kl_wmi_qrf_£t_∑øms
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
sˇnI¡îvÆ
, 
sˇnDwñlI¡îvÆ
, 
numCh™√ls
, 
ch™√lLi°
);

6595  
cou¡
;

6596 
	}
}

6599 c⁄° 
fûe_›î©i⁄s
 
	gf›s_qrf_£t_∑øms
 = {

6600 .
wrôe
 = 
©h6kl_f›s_qrf_£t_∑øms_wrôe
,

6601 .
	g›í
 = 
©h6kl_debugfs_›í
,

6602 .
	gow√r
 = 
THIS_MODULE
,

6603 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6607 
ssize_t
 
	$©h6kl_f›s_qrf_£t_≠∑øms_wrôe
(
fûe
 *file,

6608 c⁄° 
__u£r
 *
u£r_buf
,

6609 
size_t
 
cou¡
, 
loff_t
 *
µos
)

6611 
©h6kl
 *
¨
 = 
fûe
->
¥iv©e_d©a
;

6612 
©h6kl_vif
 *
vif
;

6613 
u8
 *
buf
;

6614 
ªt
;

6615 
u32
 
sˇnDwñl
;

6616 
u32
 
sˇnRïót
;

6617 
u32
 
sˇnMode
;

6620 if(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
))

6621  -
EIO
;

6624 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

6625 i‡(!
vif
)

6626  -
EIO
;

6628 
buf
 = 
	`kzÆloc
(
cou¡
+1, 
GFP_ATOMIC
);

6629 i‡(!
buf
)

6630  -
EFAULT
;

6631 i‡(
	`c›y_‰om_u£r
(
buf
, 
u£r_buf
, ()
cou¡
)) {

6632 
	`k‰ì
(
buf
);

6633  -
EFAULT
;

6636 
ªt
 = 
	`ssˇnf
(
buf
, "%u %u %u", &
sˇnDwñl
, &
sˇnRïót
, &
sˇnMode
);

6637 i‡((
ªt
 !3Ë|| ((
sˇnMode
 !
WMI_AP_SCAN_DISABLED
) &&

6638 (
sˇnMode
 !
WMI_AP_SCAN_ENABLED
))) {

6639 
	`k‰ì
(
buf
);

6640  -
EINVAL
;

6643 
	`k‰ì
(
buf
);

6645 
	`©h6kl_wmi_qrf_£t_≠∑øms
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
sˇnDwñl
, 
sˇnRïót
, 
sˇnMode
);

6647  
cou¡
;

6648 
	}
}

6651 c⁄° 
fûe_›î©i⁄s
 
	gf›s_qrf_£t_≠∑øms
 = {

6652 .
wrôe
 = 
©h6kl_f›s_qrf_£t_≠∑øms_wrôe
,

6653 .
	g›í
 = 
©h6kl_debugfs_›í
,

6654 .
	gow√r
 = 
THIS_MODULE
,

6655 .
	gŒ£ek
 = 
deÁu…_Œ£ek
,

6660 
	$©h6kl_debug_öô
(
©h6kl
 *
¨
)

6662 
	`skb_queue_hód_öô
(&
¨
->
debug
.
fwlog_queue
);

6663 
	`öô_com∂ëi⁄
(&
¨
->
debug
.
fwlog_com∂ëi⁄
);

6669 
¨
->
debug
.
fwlog_mask
 = 0;

6671 
¨
->
debugfs_phy
 = 
	`debugfs_¸óã_dú
("ath6kl",

6672 
¨
->
wùhy
->
debugfsdú
);

6673 i‡(!
¨
->
debugfs_phy
)

6674  -
ENOMEM
;

6676 
	`debugfs_¸óã_fûe
("tgt_°©s", 
S_IRUSR
, 
¨
->
debugfs_phy
,ár,

6677 &
f›s_tgt_°©s
);

6679 
	`debugfs_¸óã_fûe
("¸edô_di°_°©s", 
S_IRUSR
, 
¨
->
debugfs_phy
,ár,

6680 &
f›s_¸edô_di°_°©s
);

6682 
	`debugfs_¸óã_fûe
("ídpoöt_°©s", 
S_IRUSR
 | 
S_IWUSR
,

6683 
¨
->
debugfs_phy
,ár, &
f›s_ídpoöt_°©s
);

6685 
	`debugfs_¸óã_fûe
("fwlog", 
S_IRUSR
, 
¨
->
debugfs_phy
,ár,

6686 &
f›s_fwlog
);

6688 
	`debugfs_¸óã_fûe
("fwlog_block", 
S_IRUSR
, 
¨
->
debugfs_phy
,ár,

6689 &
f›s_fwlog_block
);

6691 
	`debugfs_¸óã_fûe
("fwlog_mask", 
S_IRUSR
 | 
S_IWUSR
, 
¨
->
debugfs_phy
,

6692 
¨
, &
f›s_fwlog_mask
);

6694 
	`debugfs_¸óã_fûe
("ªg_addr", 
S_IRUSR
 | 
S_IWUSR
, 
¨
->
debugfs_phy
,ár,

6695 &
f›s_düg_ªg_ªad
);

6697 
	`debugfs_¸óã_fûe
("ªg_dump", 
S_IRUSR
, 
¨
->
debugfs_phy
,ár,

6698 &
f›s_ªg_dump
);

6700 
	`debugfs_¸óã_fûe
("Ãssi_rﬂm_∑øm", 
S_IRUSR
 | 
S_IWUSR
,

6701 
¨
->
debugfs_phy
,ár, &
f›s_Ãssi_rﬂm_∑øm
);

6703 
	`debugfs_¸óã_fûe
("drivî_vîsi⁄", 
S_IRUSR
 | 
S_IWUSR
,

6704 
¨
->
debugfs_phy
,ár, &
f›s_drivî_vîsi⁄
);

6706 
	`debugfs_¸óã_fûe
("rx_dr›_›î©i⁄", 
S_IRUSR
 | 
S_IWUSR
,

6707 
¨
->
debugfs_phy
,ár, &
f›s_rx_dr›_›î©i⁄
);

6709 
	`debugfs_¸óã_fûe
("ªg_wrôe", 
S_IRUSR
 | 
S_IWUSR
,

6710 
¨
->
debugfs_phy
,ár, &
f›s_düg_ªg_wrôe
);

6712 
	`debugfs_¸óã_fûe
("w¨_°©s", 
S_IRUSR
, 
¨
->
debugfs_phy
,ár,

6713 &
f›s_w¨_°©s
);

6715 
	`debugfs_¸óã_fûe
("rﬂm_èbÀ", 
S_IRUSR
, 
¨
->
debugfs_phy
,ár,

6716 &
f›s_rﬂm_èbÀ
);

6718 
	`debugfs_¸óã_fûe
("f‹˚_rﬂm", 
S_IWUSR
, 
¨
->
debugfs_phy
,ár,

6719 &
f›s_f‹˚_rﬂm
);

6721 
	`debugfs_¸óã_fûe
("rﬂm_mode", 
S_IWUSR
, 
¨
->
debugfs_phy
,ár,

6722 &
f›s_rﬂm_mode
);

6724 
	`debugfs_¸óã_fûe
("rﬂm_5g_büs", 
S_IWUSR
, 
¨
->
debugfs_phy
,ár,

6725 &
f›s_rﬂm_5g_büs
);

6727 
	`debugfs_¸óã_fûe
("kì∑live", 
S_IRUSR
 | 
S_IWUSR
, 
¨
->
debugfs_phy
,ár,

6728 &
f›s_kì∑live
);

6730 
	`debugfs_¸óã_fûe
("disc⁄√˘_timeout", 
S_IRUSR
 | 
S_IWUSR
,

6731 
¨
->
debugfs_phy
,ár, &
f›s_disc⁄√˘_timeout
);

6733 
	`debugfs_¸óã_fûe
("¸óã_qos", 
S_IWUSR
, 
¨
->
debugfs_phy
,ár,

6734 &
f›s_¸óã_qos
);

6736 
	`debugfs_¸óã_fûe
("dñëe_qos", 
S_IWUSR
, 
¨
->
debugfs_phy
,ár,

6737 &
f›s_dñëe_qos
);

6739 
	`debugfs_¸óã_fûe
("bgsˇn_öãrvÆ", 
S_IWUSR
,

6740 
¨
->
debugfs_phy
,ár, &
f›s_bgsˇn_öt
);

6742 
	`debugfs_¸óã_fûe
("powî_∑øms", 
S_IWUSR
, 
¨
->
debugfs_phy
,ár,

6743 &
f›s_powî_∑øms
);

6745 
	`debugfs_¸óã_fûe
("Õl_f‹˚_íabÀ", 
S_IRUSR
 | 
S_IWUSR
,

6746 
¨
->
debugfs_phy
,ár, &
f›s_Õl_f‹˚_íabÀ
);

6748 
	`debugfs_¸óã_fûe
("mimo_ps_íabÀ", 
S_IRUSR
 | 
S_IWUSR
,

6749 
¨
->
debugfs_phy
,ár, &
f›s_mimo_ps_íabÀ
);

6751 
	`debugfs_¸óã_fûe
("mimo_ps_∑øms", 
S_IRUSR
 | 
S_IWUSR
,

6752 
¨
->
debugfs_phy
,ár, &
f›s_mimo_ps_∑øms
);

6754 
	`debugfs_¸óã_fûe
("gªí_tx_íabÀ", 
S_IRUSR
 | 
S_IWUSR
,

6755 
¨
->
debugfs_phy
,ár, &
f›s_gªí_tx
);

6757 
	`debugfs_¸óã_fûe
("gªí_tx_∑øms", 
S_IRUSR
 | 
S_IWUSR
,

6758 
¨
->
debugfs_phy
,ár, &
f›s_gªí_tx_∑øms
);

6760 
	`debugfs_¸óã_fûe
("ht_ˇp_∑øms", 
S_IRUSR
 | 
S_IWUSR
,

6761 
¨
->
debugfs_phy
,ár, &
f›s_ht_ˇp_∑øms
);

6763 
	`debugfs_¸óã_fûe
("ht_c€x_∑øms", 
S_IRUSR
 | 
S_IWUSR
,

6764 
¨
->
debugfs_phy
,ár, &
f›s_ht_c€x_∑øms
);

6766 
	`debugfs_¸óã_fûe
("debug_mask", 
S_IRUSR
 | 
S_IWUSR
,

6767 
¨
->
debugfs_phy
,ár, &
f›s_debug_mask
);

6769 
	`debugfs_¸óã_fûe
("debug_mask_ext", 
S_IRUSR
 | 
S_IWUSR
,

6770 
¨
->
debugfs_phy
,ár, &
f›s_debug_mask_ext
);

6772 
	`debugfs_¸óã_fûe
("tx_amsdu", 
S_IRUSR
 | 
S_IWUSR
,

6773 
¨
->
debugfs_phy
,ár, &
f›s_tx_amsdu
);

6775 
	`debugfs_¸óã_fûe
("tx_amsdu_∑øms", 
S_IRUSR
 | 
S_IWUSR
,

6776 
¨
->
debugfs_phy
,ár, &
f›s_tx_amsdu_∑øms
);

6778 
	`debugfs_¸óã_fûe
("htc_°©", 
S_IRUSR
,

6779 
¨
->
debugfs_phy
,ár, &
f›s_htc_°©
);

6781 
	`debugfs_¸óã_fûe
("hif_°©", 
S_IRUSR
,

6782 
¨
->
debugfs_phy
,ár, &
f›s_hif_°©
);

6784 
	`debugfs_¸óã_fûe
("hif_max_sche", 
S_IWUSR
,

6785 
¨
->
debugfs_phy
,ár, &
f›s_hif_pùe_max_sche
);

6787 
	`debugfs_¸óã_fûe
("≠_≠sd", 
S_IWUSR
,

6788 
¨
->
debugfs_phy
,ár, &
f›s_≠_≠sd
);

6790 
	`debugfs_¸óã_fûe
("≠_öåabss", 
S_IWUSR
,

6791 
¨
->
debugfs_phy
,ár, &
f›s_≠_öåabss
);

6793 
	`debugfs_¸óã_fûe
("f‹˚_∑ssˇn", 
S_IRUSR
 | 
S_IWUSR
,

6794 
¨
->
debugfs_phy
,ár, &
f›s_f‹˚_∑ssˇn
);

6796 
	`debugfs_¸óã_fûe
("pmkid_li°", 
S_IRUSR
,

6797 
¨
->
debugfs_phy
,ár, &
f›s_pmkid_li°
);

6799 
	`debugfs_¸óã_fûe
("txøã_£ªõs", 
S_IWUSR
,

6800 
¨
->
debugfs_phy
,ár, &
f›s_tx£rõs_wrôe
);

6802 
	`debugfs_¸óã_fûe
("p2p_Êow˘æ_°©", 
S_IRUSR
,

6803 
¨
->
debugfs_phy
,ár, &
f›s_p2p_Êow˘æ_°©
);

6805 
	`debugfs_¸óã_fûe
("≠_ps_°©", 
S_IRUSR
,

6806 
¨
->
debugfs_phy
,ár, &
f›s_≠_ps_°©
);

6808 
	`debugfs_¸óã_fûe
("rx_aggr_∑øms", 
S_IRUSR
 | 
S_IWUSR
,

6809 
¨
->
debugfs_phy
,ár, &
f›s_rx_aggr_∑øms
);

6811 
	`debugfs_¸óã_fûe
("sˇn_∑øms", 
S_IRUSR
 | 
S_IWUSR
,

6812 
¨
->
debugfs_phy
,ár, &
f›s_sˇn_∑øms
);

6814 
	`debugfs_¸óã_fûe
("≠_kì∑live_∑øms", 
S_IRUSR
,

6815 
¨
->
debugfs_phy
,ár, &
f›s_≠_kì∑live_∑øms
);

6817 
	`debugfs_¸óã_fûe
("tgt_≠_°©s", 
S_IRUSR
 | 
S_IWUSR
,

6818 
¨
->
debugfs_phy
,ár, &
f›s_tgt_≠_°©s
);

6820 
	`debugfs_¸óã_fûe
("ch™_li°", 
S_IRUSR
,

6821 
¨
->
debugfs_phy
,ár, &
f›s_ch™_li°
);

6823 
	`debugfs_¸óã_fûe
("≠_a˛_pﬁicy", 
S_IRUSR
 | 
S_IWUSR
,

6824 
¨
->
debugfs_phy
,ár, &
f›s_≠_a˛_pﬁicy
);

6826 
	`debugfs_¸óã_fûe
("≠_a˛_mac_li°", 
S_IRUSR
 | 
S_IWUSR
,

6827 
¨
->
debugfs_phy
,ár, &
f›s_≠_a˛_mac_li°
);

6829 
	`debugfs_¸óã_fûe
("ampdu", 
S_IWUSR
,

6830 
¨
->
debugfs_phy
,ár, &
f›s_ampdu
);

6832 
	`debugfs_¸óã_fûe
("¨p_ù_addrs", 
S_IWUSR
,

6833 
¨
->
debugfs_phy
,ár, &
f›s_¨p_ofÊﬂd_ù_addrs
);

6835 
	`debugfs_¸óã_fûe
("mcc_¥ofûe", 
S_IWUSR
,

6836 
¨
->
debugfs_phy
,ár, &
f›s_mcc_¥ofûe
);

6838 
	`debugfs_¸óã_fûe
("£amÀss_mcc_scc_swôch", 
S_IWUSR
,

6839 
¨
->
debugfs_phy
,ár, &
f›s_£amÀss_mcc_scc_swôch
);

6841 
	`debugfs_¸óã_fûe
("p2p_‰ame_ªåy", 
S_IWUSR
,

6842 
¨
->
debugfs_phy
,ár, &
f›s_p2p_‰ame_ªåy
);

6844 
	`debugfs_¸óã_fûe
("p2p_‰ame_c⁄d_ªje˘", 
S_IWUSR
,

6845 
¨
->
debugfs_phy
,ár, &
p2p_‰ame_c⁄d_ªje˘
);

6847 
	`debugfs_¸óã_fûe
("debug_quúks", 
S_IRUSR
 | 
S_IWUSR
,

6848 
¨
->
debugfs_phy
,ár, &
f›s_debug_quúks
);

6850 
	`debugfs_¸óã_fûe
("dißbÀ_sˇn", 
S_IRUSR
 | 
S_IWUSR
,

6851 
¨
->
debugfs_phy
,ár, &
f›s_dißbÀ_sˇn
);

6853 
	`debugfs_¸óã_fûe
("dißbÀ_ru¡ime_Êow˘æ", 
S_IWUSR
,

6854 
¨
->
debugfs_phy
,ár, &
f›s_dißbÀ_ru¡ime_Êow˘æ
);

6855 #ifde‡
USB_AUTO_SUSPEND


6856 
	`debugfs_¸óã_fûe
("usb_aut›m_ußge˙t", 
S_IRUSR
 | 
S_IWUSR
,

6857 
¨
->
debugfs_phy
,ár, &
f›s_usb_aut›m_ußge˙t
);

6859 
	`debugfs_¸óã_fûe
("usb_pm_°©us", 
S_IRUSR
 | 
S_IWUSR
,

6860 
¨
->
debugfs_phy
,ár, &
f›s_usb_pm_°©us
);

6863 
	`debugfs_¸óã_fûe
("p2p_õ_nŸ_≠≥nd", 
S_IWUSR
,

6864 
¨
->
debugfs_phy
,ár, &
f›s_p2p_õ_nŸ_≠≥nd
);

6866 
	`debugfs_¸óã_fûe
("≠_admc", 
S_IRUSR
,

6867 
¨
->
debugfs_phy
,ár, &
f›s_≠_admc
);

6869 
	`debugfs_¸óã_fûe
("™tdivcfg", 
S_IWUSR
,

6870 
¨
->
debugfs_phy
,ár, &
f›s_™tdiv_wrôe
);

6872 
	`debugfs_¸óã_fûe
("™tdiv°©", 
S_IRUSR
,

6873 
¨
->
debugfs_phy
,ár, &
f›s_™tdiv_°©e_ªad
);

6875 
	`debugfs_¸óã_fûe
("™i°©", 
S_IRUSR
,

6876 
¨
->
debugfs_phy
,ár, &
f›s_™i_°©e_ªad
);

6878 
	`debugfs_¸óã_fûe
("∑âîn_gí", 
S_IWUSR
 | 
S_IRUSR
,

6879 
¨
->
debugfs_phy
,ár, &
f›s_∑âîn_gí
);

6881 
	`debugfs_¸óã_fûe
("p2p_rc", 
S_IRUSR
 | 
S_IWUSR
,

6882 
¨
->
debugfs_phy
,ár, &
f›s_p2p_rc
);

6884 
	`debugfs_¸óã_fûe
("hif_rxq_thªshﬁd", 
S_IWUSR
,

6885 
¨
->
debugfs_phy
,ár, &
f›s_hif_pùe_rxq_thªshﬁd
);

6887 
	`debugfs_¸óã_fûe
("skb_dup_íabÀ", 
S_IRUSR
 | 
S_IWUSR
,

6888 
¨
->
debugfs_phy
,ár, &
f›s_skb_dup_›î©i⁄
);

6890 
	`debugfs_¸óã_fûe
("dtim_ext", 
S_IRUSR
 | 
S_IWUSR
,

6891 
¨
->
debugfs_phy
,ár, &
f›s_dtim_ext
);

6893 
	`debugfs_¸óã_fûe
("ho°_¶ìp_mode", 
S_IWUSR
,

6894 
¨
->
debugfs_phy
,ár, &
f›s_ho°_¶ìp_mode
);

6899 
	`debugfs_¸óã_fûe
("wow_∑âîn", 
S_IRUSR
 | 
S_IWUSR
,

6900 
¨
->
debugfs_phy
,ár, &
f›s_wow∑âîn_gí
);

6902 
	`debugfs_¸óã_fûe
("ªg_cou¡ry", 
S_IWUSR
,

6903 
¨
->
debugfs_phy
,ár, &
f›s_ªg_cou¡ry_wrôe
);

6905 
	`debugfs_¸óã_fûe
("p2p_go_sync", 
S_IWUSR
,

6906 
¨
->
debugfs_phy
,ár, &
f›s_p2p_go_sync
);

6908 
	`debugfs_¸óã_fûe
("≠_rc", 
S_IWUSR
,

6909 
¨
->
debugfs_phy
,ár, &
f›s_≠_rc
);

6911 
	`debugfs_¸óã_fûe
("øndom_bóc⁄_skù", (
S_IWUSR
),

6912 
¨
->
debugfs_phy
,ár, &
f›s_ømdom_bóc⁄_skù
);

6914 #ifde‡
DHCP_CLIENT_FEATURE


6916 
	`debugfs_¸óã_fûe
("£t_dh˝_˛õ¡", (
S_IWUSR
),

6917 
¨
->
debugfs_phy
,ár, &
f›s_£t_dh˝_˛õ¡
);

6921 #ifde‡
DHCP_SERVER_FEATURE


6923 
	`debugfs_¸óã_fûe
("£t_dh˝_£rvî", (
S_IWUSR
),

6924 
¨
->
debugfs_phy
,ár, &
f›s_£t_dh˝_£rvî
);

6928 #ifde‡
CONFIG_WLAN_QRF


6930 
	`debugfs_¸óã_fûe
("qrf_íabÀ", (
S_IWUSR
),

6931 
¨
->
debugfs_phy
,ár, &
f›s_qrf_íabÀ
);

6933 
	`debugfs_¸óã_fûe
("qrf_£t_ssid", (
S_IWUSR
),

6934 
¨
->
debugfs_phy
,ár, &
f›s_qrf_£t_ssid
);

6936 
	`debugfs_¸óã_fûe
("qrf_£t_mac", (
S_IWUSR
),

6937 
¨
->
debugfs_phy
,ár, &
f›s_qrf_£t_mac
);

6939 
	`debugfs_¸óã_fûe
("qrf_£t_∑øms", (
S_IWUSR
),

6940 
¨
->
debugfs_phy
,ár, &
f›s_qrf_£t_∑øms
);

6942 
	`debugfs_¸óã_fûe
("qrf_£t_≠∑øms", (
S_IWUSR
),

6943 
¨
->
debugfs_phy
,ár, &
f›s_qrf_£t_≠∑øms
);

6948 
	}
}

6950 
	$©h6kl_debug_˛ónup
(
©h6kl
 *
¨
)

6952 
	`skb_queue_purge
(&
¨
->
debug
.
fwlog_queue
);

6953 
	`com∂ëe
(&
¨
->
debug
.
fwlog_com∂ëi⁄
);

6954 
	`k‰ì
(
¨
->
debug
.
rﬂm_tbl
);

6955 
	}
}

	@debug.h

17 #i‚de‡
DEBUG_H


18 
	#DEBUG_H


	)

20 
	~"hif.h
"

22 
	eATH6KL_MODULE_QUIRKS
 {

24 
	mATH6KL_MODULE_SUSPEND_CUTPOWER
 = 
BIT
(0),

27 
	mAT6HKL_MODULE_LPL_ENABLE
 = 
BIT
(1),

30 
	mATH6KL_MODULE_MIMO_PS_ENABLE
 = 
BIT
(2),

33 
	mATH6KL_MODULE_DISABLE_RX_AGGR_DROP
 = 
BIT
(3),

36 
	mATH6KL_MODULE_TESTMODE_ENABLE
 = 
BIT
(4),

39 
	mATH6KL_MODULES_ANI_ENABLE
 = 
BIT
(5),

42 
	mATH6KL_MODULE_ENABLE_EPPING
 = 
BIT
(6),

45 
	mATH6KL_MODULE_DISABLE_5G
 = 
BIT
(7),

48 
	mATH6KL_MODULE_P2P_MAX_FW_VIF
 = 
BIT
(8),

51 
	mATH6KL_MODULE_DISABLE_SKB_DUP
 = 
BIT
(9),

54 
	mATH6KL_MODULE_ENABLE_USB_REMOTE_WKUP
 = 
BIT
(10),

57 
	mATH6KL_MODULE_DISABLE_2G_HT40
 = 
BIT
(11),

60 
	mATH6KL_MODULE_ENABLE_FWLOG
 = 
BIT
(12),

63 
	mATH6KL_MODULE_DISABLE_USB_AUTO_SUSPEND
 = 
BIT
(13),

66 
	mATH6KL_MODULE_ENABLE_WOW_SINGLE_CHAIN
 = 
BIT
(14),

69 
	mATH6KL_MODULE_KEEPALIVE_BY_SUPP
 = 
BIT
(15),

72 
	mATH6KL_MODULE_DISABLE_AUTO_ADD_INF
 = 
BIT
(16),

75 
	mATH6KL_MODULE_ENABLE_SCHE_SCAN
 = 
BIT
(17),

78 
	mATH6KL_MODULE_ENABLE_FWLOG_EXT
 = 
BIT
(18),

81 
	mATH6KL_MODULE_ENABLE_P2P_CHANMODE
 = 
BIT
(19),

84 
	mATH6KL_MODULE_DISABLE_WAIT_DEFER
 = 
BIT
(20),

87 
	mATH6KL_MODULE_ENABLE_FW_CRASH_NOTIFY
 = 
BIT
(21),

90 
	mATH6KL_MODULE_DISABLE_USB_AUTO_PM
 = 
BIT
(22),

93 
	mATH6KL_MODULE_DISABLE_WMI_SYC
 = 
BIT
(23),

98 
	mATH6KL_MODULE_KEEPALIVE_CONFIG_BY_SUPP
 = 
BIT
(25),

103 
	mATH6KL_MODULE_AP_ACL_BY_NL80211
 = 
BIT
(27),

106 
	mATH6KL_MODULE_ENABLE_DIAGNOSTIC
 = 
BIT
(28),

109 
	mATH6KL_MODULE_ENABLE_RTT
 = 
BIT
(29),

112 
	eATH6KL_MODULE_P2P
 {

114 
	mATH6KL_MODULEP2P_P2P_ENABLE
 = 
BIT
(0),

117 
	mATH6KL_MODULEP2P_CONCURRENT_ENABLE_DEDICATE
 = 
BIT
(1),

120 
	mATH6KL_MODULEP2P_CONCURRENT_NO_DEDICATE
 = 
BIT
(2),

123 
	mATH6KL_MODULEP2P_CONCURRENT_COMPAT
 = 
BIT
(3),

126 
	mATH6KL_MODULEP2P_CONCURRENT_MULTICHAN
 = 
BIT
(4),

131 
	mATH6KL_MODULEP2P_CONCURRENT_AP
 = 
BIT
(8),

134 
	mATH6KL_MODULEP2P_P2P_IN_PASSIVE_CHAN
 = 
BIT
(9),

137 
	mATH6KL_MODULEP2P_P2P_WISE_SCAN
 = 
BIT
(10),

140 
	eATH6KL_MODULE_ROAM
 {

142 
	mATH6KL_MODULEROAM_DEFAULT
 = 
BIT
(0),

145 
	mATH6KL_MODULEROAM_NO_LRSSI_SCAN_AT_MULTI
 = 
BIT
(1),

148 
	mATH6KL_MODULEROAM_DISABLE_LRSSI_SCAN
 = 
BIT
(2),

151 
	mATH6KL_MODULEROAM_ENABLE_ALL
 = 
BIT
(3),

154 
	mATH6KL_MODULEROAM_DISABLE
 = 
BIT
(4),

157 
	eATH6K_DEBUG_MASK
 {

158 
	mATH6KL_DBG_CREDIT
 = 
BIT
(0),

159 
	mATH6KL_DBG_REGDB
 = 
BIT
(1),

160 
	mATH6KL_DBG_WLAN_TX
 = 
BIT
(2),

161 
	mATH6KL_DBG_WLAN_RX
 = 
BIT
(3),

162 
	mATH6KL_DBG_BMI
 = 
BIT
(4),

163 
	mATH6KL_DBG_HTC
 = 
BIT
(5),

164 
	mATH6KL_DBG_HIF
 = 
BIT
(6),

165 
	mATH6KL_DBG_IRQ
 = 
BIT
(7),

166 
	mATH6KL_DBG_ACL
 = 
BIT
(8),

167 
	mATH6KL_DBG_ADMC
 = 
ATH6KL_DBG_ACL
,

168 
	mATH6KL_DBG_RC
 = 
BIT
(9),

169 
	mATH6KL_DBG_AP_RC
 = 
ATH6KL_DBG_RC
,

170 
	mATH6KL_DBG_WMI
 = 
BIT
(10),

171 
	mATH6KL_DBG_TRC
 = 
BIT
(11),

172 
	mATH6KL_DBG_SCATTER
 = 
BIT
(12),

173 
	mATH6KL_DBG_WLAN_CFG
 = 
BIT
(13),

174 
	mATH6KL_DBG_RAW_BYTES
 = 
BIT
(14),

175 
	mATH6KL_DBG_AGGR
 = 
BIT
(15),

176 
	mATH6KL_DBG_SDIO
 = 
BIT
(16),

177 
	mATH6KL_DBG_SDIO_DUMP
 = 
BIT
(17),

178 
	mATH6KL_DBG_BOOT
 = 
BIT
(18),

179 
	mATH6KL_DBG_WMI_DUMP
 = 
BIT
(19),

180 
	mATH6KL_DBG_SUSPEND
 = 
BIT
(20),

181 
	mATH6KL_DBG_USB
 = 
BIT
(21),

182 
	mATH6KL_DBG_USB_BULK
 = 
BIT
(22),

183 
	mATH6KL_DBG_HTCOEX
 = 
BIT
(23),

184 
	mATH6KL_DBG_WLAN_TX_AMSDU
 = 
BIT
(24),

185 
	mATH6KL_DBG_POWERSAVE
 = 
BIT
(25),

186 
	mATH6KL_DBG_WOWLAN
 = 
BIT
(26),

187 
	mATH6KL_DBG_RTT
 = 
BIT
(27),

188 
	mATH6KL_DBG_FLOWCTRL
 = 
BIT
(28),

189 
	mATH6KL_DBG_KEEPALIVE
 = 
BIT
(29),

190 #ifde‡
ACS_SUPPORT


191 
	mATH6KL_DBG_ACS
 = 
BIT
(30),

195 
	mATH6KL_DBG_INFO
 = 
BIT
(31),

196 
	mATH6KL_DBG_ANY
 = 0xffffffff

200 
	#ATH6KL_DBG_EXT_INFO1
 0x100000000ULL

	)

202 
debug_mask
;

203 
debug_mask_ext
;

204 
debug_quúks
;

205 
	$__¥ötf
(2, 3)

206 
	`©h6kl_¥ötk
(c⁄° *
Àvñ
, c⁄° *
fmt
, ...);

208 
	#©h6kl_öfo
(
fmt
, ...) \

209 
	`©h6kl_¥ötk
(
KERN_INFO
, 
fmt
, ##
__VA_ARGS__
)

	)

210 
	#©h6kl_îr
(
fmt
, ...) \

211 
	`©h6kl_¥ötk
(
KERN_ERR
, 
fmt
, ##
__VA_ARGS__
)

	)

212 
	#©h6kl_w¨n
(
fmt
, ...) \

213 
	`©h6kl_¥ötk
(
KERN_WARNING
, 
fmt
, ##
__VA_ARGS__
)

	)

214 
	#©h6kl_debug
(
fmt
, ...) \

215 
	`¥ötk
(
KERN_DEBUG
 
fmt
, ##
__VA_ARGS__
)

	)

217 
	#AR_DBG_LVL_CHECK
(
mask
Ë(
debug_mask
 & mask)

	)

219 
	e©h6kl_w¨
 {

220 
ATH6KL_WAR_INVALID_RATE
,

223 
ölöe
 
	$©h6kl_mod_debug_quúks
(
©h6kl
 *
¨
,

224 
ATH6KL_MODULE_QUIRKS
 
mask
)

226 i‡(
¨
->
mod_debug_quúks
 & 
mask
)

230 
	}
}

232 
©h6kl_£nd_evít_to_≠p
(
√t_devi˚
 *
dev
,

233 
u16
 
evít_id
, 
u8
 
ifid
,

234 
u8
 *
d©≠
, 
Àn
);

236 
©h6kl_£nd_gíevít_to_≠p
(
√t_devi˚
 *
dev
,

237 
u16
 
evít_id
, 
u8
 
ifid
,

238 
u8
 *
d©≠
, 
Àn
);

240 #ifde‡
CONFIG_ATH6KL_DEBUG


241 
	#©h6kl_dbg
(
mask
, 
fmt
, ...) \

243 
πn
; \

244 i‡((
debug_mask
 & ()(
mask
)) || \

245 (
debug_mask_ext
 & \

246 ()(()(
mask
)>>32))) \

247 
πn
 = 
	`©h6kl_¥ötk
(
KERN_DEBUG
, 
fmt
, ##
__VA_ARGS__
); \

249 
πn
 = 0; \

251 
πn
; \

252 })

	)

254 
ölöe
 
	$©h6kl_dbg_dump
(
ATH6K_DEBUG_MASK
 
mask
,

255 c⁄° *
msg
, c⁄° *
¥efix
,

256 c⁄° *
buf
, 
size_t
 
Àn
)

258 i‡(
debug_mask
 & 
mask
) {

259 i‡(
msg
)

260 
	`©h6kl_dbg
(
mask
, "%s\n", 
msg
);

262 
	`¥öt_hex_dump_byãs
(
¥efix
, 
DUMP_PREFIX_OFFSET
, 
buf
, 
Àn
);

264 
	}
}

266 
©h6kl_dump_ªgi°îs
(
©h6kl_devi˚
 *
dev
,

267 
©h6kl_úq_¥oc_ªgi°îs
 *
úq_¥oc_ªg
,

268 
©h6kl_úq_íabÀ_ªg
 *
úq_í_ªg
);

269 
dump_¸ed_di°_°©s
(
htc_èrgë
 *
èrgë
);

270 
©h6kl_debug_fwlog_evít
(
©h6kl
 *
¨
, c⁄° *
buf
, 
size_t
 
Àn
);

271 
©h6kl_debug_w¨
(
©h6kl
 *
¨
, 
©h6kl_w¨
 
w¨
);

272 
©h6kl_debug_rﬂm_tbl_evít
(
©h6kl
 *
¨
, c⁄° *
buf
,

273 
size_t
 
Àn
);

274 
©h6kl_debug_£t_kì∑live
(
©h6kl
 *
¨
, 
u8
 
kì∑live
);

275 
©h6kl_debug_£t_disc⁄√˘_timeout
(
©h6kl
 *
¨
, 
u8
 
timeout
);

276 
©h6kl_debug_öô
(
©h6kl
 *
¨
);

277 
©h6kl_debug_˛ónup
(
©h6kl
 *
¨
);

280 
ölöe
 
	$©h6kl_dbg
(
dbg_mask
,

281 c⁄° *
fmt
, ...)

284 
	}
}

286 
ölöe
 
	$©h6kl_dbg_dump
(
ATH6K_DEBUG_MASK
 
mask
,

287 c⁄° *
msg
, c⁄° *
¥efix
,

288 c⁄° *
buf
, 
size_t
 
Àn
)

290 
	}
}

292 
ölöe
 
	$©h6kl_dump_ªgi°îs
(
©h6kl_devi˚
 *
dev
,

293 
©h6kl_úq_¥oc_ªgi°îs
 *
úq_¥oc_ªg
,

294 
©h6kl_úq_íabÀ_ªg
 *
úq_í_ªg
)

297 
	}
}

298 
ölöe
 
	$dump_¸ed_di°_°©s
(
htc_èrgë
 *
èrgë
)

300 
	}
}

302 
ölöe
 
	$©h6kl_debug_fwlog_evít
(
©h6kl
 *
¨
,

303 c⁄° *
buf
, 
size_t
 
Àn
)

305 
	}
}

307 
ölöe
 
	$©h6kl_debug_w¨
(
©h6kl
 *
¨
, 
©h6kl_w¨
 
w¨
)

309 
	}
}

311 
ölöe
 
	$©h6kl_debug_rﬂm_tbl_evít
(
©h6kl
 *
¨
,

312 c⁄° *
buf
, 
size_t
 
Àn
)

315 
	}
}

317 
ölöe
 
	$©h6kl_debug_£t_kì∑live
(
©h6kl
 *
¨
, 
u8
 
kì∑live
)

319 
	}
}

321 
ölöe
 
	$©h6kl_debug_£t_disc⁄√˘_timeout
(
©h6kl
 *
¨
,

322 
u8
 
timeout
)

324 
	}
}

326 
ölöe
 
	$©h6kl_debug_öô
(
©h6kl
 *
¨
)

329 
	}
}

331 
ölöe
 
	$©h6kl_debug_˛ónup
(
©h6kl
 *
¨
)

333 
	}
}

	@diag.c

17 
	~<löux/ù.h
>

18 
	~"c‹e.h
"

19 
	~"wmi.h
"

20 
	~"dügno£.h
"

23 #ifde‡
ATH6KL_DIAGNOSTIC


25 
wifi_düg_ˇŒbacks
 
	gdüg_evt_ˇŒback
;

26 
sk_buff_hód
 
	gdüg_evíts
;

27 
DEFINE_MUTEX
(
düg_evít_muãx
);

30 
	eWIFI_DIAG_PM_STATE
 {

31 
	mWIFI_DIAG_PM_STATE_SLEEP
 = 1,

32 
	mWIFI_DIAG_PM_STATE_AWAKE
 = 2,

33 
	mWIFI_DIAG_PM_STATE_FAKE_SLEEP
 = 3,

39 
	$©h6kl_wmi_cmd_£nd_düg
(
wmi
 *wmi, 
sk_buff
 *
skb
,

40 
wmid_comm™d_id
 
cmd_id
,

41 
wmi_sync_Êag
 
sync_Êag
)

43 
wmid_cmd_hdr
 *
cmd_hdr
;

44 
ªt
;

46 
	`skb_push
(
skb
, (
wmid_cmd_hdr
));

48 
cmd_hdr
 = (
wmid_cmd_hdr
 *Ë
skb
->
d©a
;

49 
cmd_hdr
->
cmd_id
 = 
	`˝u_to_À32
(cmd_id);

51 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_DIAGNOSTIC_CMDID
, 
sync_Êag
);

53  
ªt
;

54 
	}
}

57 
	$©h6kl_wmi_macfûãr_cmd
(
wmi
 *wmi, 
ty≥
, 
u32
 
low
, u32 
high
)

59 
sk_buff
 *
skb
;

60 
ªt
;

61 
wmid_macfûãr_cmd
 *
macfûãr
;

63 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(

64 (
wmid_cmd_hdr
)+(*
macfûãr
));

65 i‡(!
skb
)

66  -
ENOMEM
;

67 
macfûãr
 = (
wmid_macfûãr_cmd
 *)
skb
->
d©a
;

68 
macfûãr
->
ty≥
 =Åype;

69 
macfûãr
->
low
 =Üow;

70 
macfûãr
->
high
 = high;

72 
ªt
 = 
	`©h6kl_wmi_cmd_£nd_düg
(
wmi
, 
skb
, 
WMID_MACFILTER_CMDID
,

73 
NO_SYNC_WMIFLAG
);

74  
ªt
;

75 
	}
}

78 
	$©h6kl_wmi_fsm_cmd
(
wmi
 *wmi, 
boﬁ
 
íabÀ
)

80 
sk_buff
 *
skb
;

81 
ªt
;

82 
wmid_evít_£t_cmd
 *
fsm
;

84 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmid_cmd_hdr
)+(*
fsm
));

85 i‡(!
skb
)

86  -
ENOMEM
;

87 
fsm
 = (
wmid_evít_£t_cmd
 *)
skb
->
d©a
;

88 
fsm
->
íabÀ
 =Énable;

90 
ªt
 = 
	`©h6kl_wmi_cmd_£nd_düg
(
wmi
, 
skb
, 
WMID_FSM_EVENT_CMDID
,

91 
NO_SYNC_WMIFLAG
);

92  
ªt
;

93 
	}
}

96 
	$©h6kl_wmi_pwrßve_cmd
(
wmi
 *wmi, 
boﬁ
 
íabÀ
)

98 
sk_buff
 *
skb
;

99 
ªt
;

100 
wmid_evít_£t_cmd
 *
ps
;

102 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmid_cmd_hdr
)+(*
ps
));

103 i‡(!
skb
)

104  -
ENOMEM
;

105 
ps
 = (
wmid_evít_£t_cmd
 *)
skb
->
d©a
;

106 
ps
->
íabÀ
 =Énable;

108 
ªt
 = 
	`©h6kl_wmi_cmd_£nd_düg
(
wmi
, 
skb
, 
WMID_PWR_SAVE_EVENT_CMDID
,

109 
NO_SYNC_WMIFLAG
);

110  
ªt
;

111 
	}
}

114 
	$©h6kl_wmi_öãr„ªn˚_cmd
(
wmi
 *wmi)

116 
sk_buff
 *
skb
;

117 
ªt
;

119 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmid_cmd_hdr
));

120 i‡(!
skb
)

121  -
ENOMEM
;

123 
ªt
 = 
	`©h6kl_wmi_cmd_£nd_düg
(
wmi
, 
skb
, 
WMID_INTERFERENCE_CMDID
,

124 
NO_SYNC_WMIFLAG
);

125  
ªt
;

126 
	}
}

129 
	$©h6kl_wmi_rxtime_cmd
(
wmi
 *wmi)

131 
sk_buff
 *
skb
;

132 
ªt
;

134 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmid_cmd_hdr
));

135 i‡(!
skb
)

136  -
ENOMEM
;

138 
ªt
 = 
	`©h6kl_wmi_cmd_£nd_düg
(
wmi
, 
skb
, 
WMID_RXTIME_CMDID
,

139 
NO_SYNC_WMIFLAG
);

140  
ªt
;

141 
	}
}

144 
	$©h6kl_wmi_pkéog_íabÀ_cmd
(
wmi
 *wmi,

145 
wmi_íabÀ_pkéog_cmd
 *
›ti⁄s
)

147 
sk_buff
 *
skb
;

148 
wmi_íabÀ_pkéog_cmd
 *
cmd
;

149 
°©us
 = 0;

151 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_íabÀ_pkéog_cmd
));

152 i‡(!
skb
)

153  -
ENOMEM
;

155 
cmd
 = (
wmi_íabÀ_pkéog_cmd
 *Ë
skb
->
d©a
;

156 
cmd
->
evli°
 = 
›ti⁄s
->evlist;

157 
cmd
->
›ti⁄
 = 
›ti⁄s
->option;

158 
cmd
->
åiggî_thªsh
 = 
	`˝u_to_À32
(
›ti⁄s
->trigger_thresh);

159 
cmd
->
åiggî_öãrvÆ
 = 
	`˝u_to_À32
(
›ti⁄s
->trigger_interval);

160 
cmd
->
åiggî_èû_cou¡
 = 
	`˝u_to_À32
(
›ti⁄s
->trigger_tail_count);

161 
cmd
->
buf„r_size
 = 
	`˝u_to_À32
(
›ti⁄s
->buffer_size);

163 
°©us
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_PKTLOG_ENABLE_CMDID
,

164 
NO_SYNC_WMIFLAG
);

166  
°©us
;

167 
	}
}

170 
	$©h6kl_wmi_pkéog_dißbÀ_cmd
(
wmi
 *wmi)

172  
	`©h6kl_wmi_sim∂e_cmd
(
wmi
, 0, 
WMI_PKTLOG_DISABLE_CMDID
);

173 
	}
}

179 
	$dump_hex
(
u8
 *
‰m
, 
u32
 
Àn
)

181 
u32
 
i
;

182 
	`¥ötk
(
KERN_INFO
 "\n-----------------------------\n");

183 
i
 = 0; i < 
Àn
; i++) {

184 
	`¥ötk
(
KERN_INFO
 "0x%02x ", 
‰m
[
i
]);

185 i‡((
i
+1) % 16 == 0)

186 
	`¥ötk
(
KERN_INFO
 "\n");

188 
	`¥ötk
(
KERN_INFO
 "\n");

189 
	`¥ötk
(
KERN_INFO
 "\n=============================\n\n");

190 
	}
}

194 
	$©h6kl_wmi_pkéog_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
u32
 
Àn
)

196 
u8
 *
pd©a
 = 
NULL
;

197 
©h_pkéog_hdr
 *
log_hdr
 = (©h_pkéog_hd∏*)
d©≠
 ;

198 
u32
 
off£t
 = 0;

199 
©h6kl_vif
 *
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
wmi
->
∑ª¡_dev
, 0);

201 i‡(
vif
 =
NULL
)

202  -
EINVAL
;

204 
Àn
 - 
off£t
 > 0) {

205 
	`À16_to_˝u
(
log_hdr
->
log_ty≥
)) {

206 
PKTLOG_TYPE_TXSTATUS
:

207 
pd©a
 = (
u8
 *)
log_hdr
 + (
©h_pkéog_hdr
);

208 
	`wifi_düg_mac_tx_‰ame_evít
(
vif
,

209 (
©h_pkéog_tx°©us
 *)
pd©a
);

211 
PKTLOG_TYPE_TXCTL
:

212 
pd©a
 = (
u8
 *)
log_hdr
 + (
©h_pkéog_hdr
);

213 
	`wifi_düg_mac_tx˘æ_evít
(
vif
,

214 (
©h_pkéog_tx˘l
 *)
pd©a
);

216 
PKTLOG_TYPE_RX
:

217 
pd©a
 = (
u8
 *)
log_hdr
 + (
©h_pkéog_hdr
);

218 
	`wifi_düg_mac_rx_‰ame_evít
(
vif
,

219 (
©h_pkéog_rx
 *)
pd©a
);

224 
off£t
 +
	`À16_to_˝u
(
log_hdr
->
size
) +

225 (
©h_pkéog_hdr
);

226 
log_hdr
 = (
©h_pkéog_hdr
 *)

227 ((
u8
 *)
log_hdr
 + 
	`À16_to_˝u
÷og_hdr->
size
) +

228 (
©h_pkéog_hdr
));

232 
	}
}

235 
	$©h6kl_wmi_°¨t_sˇn_evít
(
©h6kl_vif
 *
vif
, 
u32
 
£q_num
)

237 
wifi_düg_mac_fsm_t
 
fsm_evít
 = 
WIFI_DIAG_MAC_FSM_SCANNING
;

238 
	`¥ötk
(
KERN_INFO
 "ath6kl_wmi_start_scan_event\n");

239 
	`wifi_düg_mac_fsm_evít
(
vif
, 
fsm_evít
, 
£q_num
);

241 
	}
}

244 
	$©h6kl_wmi_fsm_auth_evít
(
©h6kl_vif
 *
vif
, 
u32
 
£q_num
)

246 
wifi_düg_mac_fsm_t
 
fsm_evít
 = 
WIFI_DIAG_MAC_FSM_AUTH
;

247 
	`¥ötk
(
KERN_INFO
 "ath6kl_wmi_fsm_auth_event\n");

248 
	`wifi_düg_mac_fsm_evít
(
vif
, 
fsm_evít
, 
£q_num
);

250 
	}
}

253 
	$©h6kl_wmi_fsm_assoc_evít
(
©h6kl_vif
 *
vif
, 
u32
 
£q_num
)

255 
wifi_düg_mac_fsm_t
 
fsm_evít
 = 
WIFI_DIAG_MAC_FSM_ASSOC
;

256 
	`¥ötk
(
KERN_INFO
 "ath6kl_wmi_fsm_assoc_event\n");

257 
	`wifi_düg_mac_fsm_evít
(
vif
, 
fsm_evít
, 
£q_num
);

259 
	}
}

262 
	$©h6kl_wmi_fsm_dóuth_evít
(
©h6kl_vif
 *
vif
, 
u32
 
£q_num
)

264 
wifi_düg_mac_fsm_t
 
fsm_evít
 = 
WIFI_DIAG_MAC_FSM_DEAUTH
;

265 
	`¥ötk
(
KERN_INFO
 "ath6kl_wmi_fsm_deauth_event\n");

266 
	`wifi_düg_mac_fsm_evít
(
vif
, 
fsm_evít
, 
£q_num
);

268 
	}
}

271 
	$©h6kl_wmi_fsm_dißssoc_evít
(
©h6kl_vif
 *
vif
, 
u32
 
£q_num
)

273 
wifi_düg_mac_fsm_t
 
fsm_evít
 = 
WIFI_DIAG_MAC_FSM_DISASSOC
;

274 
	`¥ötk
(
KERN_INFO
 "ath6kl_wmi_fsm_disassoc_event\n");

275 
	`wifi_düg_mac_fsm_evít
(
vif
, 
fsm_evít
, 
£q_num
);

277 
	}
}

280 
	$©h6kl_wmi_pwrßve_evít
(
©h6kl_vif
 *
vif
,

281 
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
, 
u32
 
£q_num
)

283 
wmid_pwr_ßve_evít
 *
°©e
 =

284 (
wmid_pwr_ßve_evít
 *)
d©≠
;

285 
wifi_düg_pwrßve_t
 
ﬁdpwrßve
, 
pmpwrßve
;

287 
	`¥ötk
(
KERN_INFO
 "ath6kl_wmi_pwrsave_event\n");

289 
°©e
->
ﬁdSèã
) {

290 
WIFI_DIAG_PM_STATE_SLEEP
:

291 
ﬁdpwrßve
 = 
WIFI_DIAG_DEEPSLEEP_STOP
;

293 
WIFI_DIAG_PM_STATE_AWAKE
:

294 
ﬁdpwrßve
 = 
WIFI_DIAG_MAXPERF_STOP
;

296 
WIFI_DIAG_PM_STATE_FAKE_SLEEP
:

297 
ﬁdpwrßve
 = 
WIFI_DIAG_FAKESLEEP_STOP
;

303 
	`wifi_düg_£nd_pwrßve_evít
(
vif
, 
ﬁdpwrßve
, 
£q_num
);

305 
°©e
->
pmSèã
) {

306 
WIFI_DIAG_PM_STATE_SLEEP
:

307 
pmpwrßve
 = 
WIFI_DIAG_DEEPSLEEP_START
;

309 
WIFI_DIAG_PM_STATE_AWAKE
:

310 
pmpwrßve
 = 
WIFI_DIAG_MAXPERF_START
;

312 
WIFI_DIAG_PM_STATE_FAKE_SLEEP
:

313 
pmpwrßve
 = 
WIFI_DIAG_FAKESLEEP_START
;

319 
	`wifi_düg_£nd_pwrßve_evít
(
vif
, 
pmpwrßve
, 
£q_num
);

322 
	}
}

325 
	$©h6kl_wmi_düg_evít
(
©h6kl_vif
 *
vif
,

326 
wmi
 *wmi, 
sk_buff
 *
skb
)

328 
wmid_cmd_hdr
 *
cmd
;

329 
u32
 
Àn
;

330 
u16
 
id
;

331 
u32
 
£q_num
;

332 
u8
 *
d©≠
;

333 
ªt
 = 0;

335 i‡(
skb
->
Àn
 < (
wmid_cmd_hdr
)) {

336 
	`¥ötk
(
KERN_INFO
 "badÖacket 1\n");

337  -
EINVAL
;

340 
cmd
 = (
wmid_cmd_hdr
 *Ë
skb
->
d©a
;

341 
id
 = 
	`À32_to_˝u
(
cmd
->
cmd_id
);

342 
£q_num
 = 
	`À32_to_˝u
(
cmd
->seq_num);

344 
	`skb_puŒ
(
skb
, (
wmid_cmd_hdr
));

346 
d©≠
 = 
skb
->
d©a
;

347 
Àn
 = 
skb
->len;

349 
id
) {

350 
WMID_START_SCAN_EVENTID
:

351 
ªt
 = 
	`©h6kl_wmi_°¨t_sˇn_evít
(
vif
, 
£q_num
);

353 
WMID_FSM_AUTH_EVENTID
:

354 
ªt
 = 
	`©h6kl_wmi_fsm_auth_evít
(
vif
, 
£q_num
);

356 
WMID_FSM_ASSOC_EVENTID
:

357 
ªt
 = 
	`©h6kl_wmi_fsm_assoc_evít
(
vif
, 
£q_num
);

359 
WMID_FSM_DEAUTH_EVENTID
:

360 
ªt
 = 
	`©h6kl_wmi_fsm_dóuth_evít
(
vif
, 
£q_num
);

362 
WMID_FSM_DISASSOC_EVENTID
:

363 
ªt
 = 
	`©h6kl_wmi_fsm_dißssoc_evít
(
vif
, 
£q_num
);

365 
WMID_STAT_RX_RATE_EVENTID
:

366 
ªt
 = 
	`©h6kl_wmi_°©_rx_øã_evít
(
vif
, 
wmi
,

367 
d©≠
, 
Àn
, 
£q_num
);

369 
WMID_STAT_TX_RATE_EVENTID
:

370 
ªt
 = 
	`©h6kl_wmi_°©_tx_øã_evít
(
vif
, 
wmi
,

371 
d©≠
, 
Àn
, 
£q_num
);

373 
WMID_INTERFERENCE_EVENTID
:

374 
	`©h6kl_wmi_öãr„ªn˚_evít
(
vif
, 
wmi
, 
d©≠
, 
Àn
, 
£q_num
);

376 
WMID_RXTIME_EVENTID
:

377 
	`©h6kl_wmi_rxtime_evít
(
vif
, 
wmi
, 
d©≠
, 
Àn
, 
£q_num
);

379 
WMID_PWR_SAVE_EVENTID
:

380 
	`©h6kl_wmi_pwrßve_evít
(
vif
, 
wmi
, 
d©≠
, 
Àn
, 
£q_num
);

382 
WMID_FSM_CONNECT_EVENTID
:

383 
vif
->
düg
.
c⁄√˘_£q_num
 = 
£q_num
;

385 
WMID_FSM_DISCONNECT_EVENTID
:

386 
vif
->
düg
.
disc⁄√˘_£q_num
 = 
£q_num
;

389 
	`¥ötk
(
KERN_INFO
 "unknow¿cmd id 0x%x\n", 
id
);

390 
ªt
 = -
EINVAL
;

394  
ªt
;

395 
	}
}

398 
wifi_drv_hdl_li°
 
	gwifi_drv_hdl_èbÀ
 = {

399 .
wifi_ªgi°î
 = 
wifi_düg_drv_ªgi°î
,

400 .
	gwifi_uƒegi°î
 = 
wifi_düg_drv_uƒegi°î
,

401 .
	gwifi_düg_ªg_evít_ˇŒback
 = 
wifi_düg_ªgi°î_evít_ˇŒback
,

402 .
	gwifi_düg_cmd
 = 
wifi_düg_cmd_£nd
,

407 
	$wifi_düg_drv_ªgi°î
(*
düg_hdl
)

409  (*)&
wifi_drv_hdl_èbÀ
;

410 
	}
}

411 
EXPORT_SYMBOL
(
wifi_düg_drv_ªgi°î
);

413 
wifi_düg_°©us_t


414 
	$wifi_düg_drv_uƒegi°î
(*
drv_hdl
)

416 
©h6kl_vif
 *
vif
 = 
	`©h6kl_gë_vif_by_ödex
(

417 
globÆwmi
->
∑ª¡_dev
, 0);

419 
wifi_düg_°©us_t
 
düg_°©us
 = 
WIFI_DIAG_EOK
;

420 
	`©h6kl_wmi_macfûãr_cmd
(
globÆwmi
,

421 
WMI_PKTLOG_EVENT_TX
 | 
WMI_PKTLOG_EVENT_RX
,

422 
WIFI_DIAG_MACFILTER_DISABLEALL
,

423 
WIFI_DIAG_MACFILTER_DISABLEALL
);

424 
	`©h6kl_wmi_pkéog_dißbÀ_cmd
(
globÆwmi
);

425 
	`©h6kl_wmi_fsm_cmd
(
globÆwmi
, 
Ál£
);

426 
	`©h6kl_wmi_pwrßve_cmd
(
globÆwmi
, 
Ál£
);

428 i‡(
vif
 !
NULL
)

429 
	`wifi_düg_timî_de°roy
(
vif
);

431  
düg_°©us
;

432 
	}
}

434 
wifi_düg_°©us_t


435 
	$wifi_düg_ªgi°î_evít_ˇŒback
(*
drv_hdl
,

436 
wifi_düg_ˇŒbacks
 *
evt_ˇŒback
)

438 
wifi_düg_°©us_t
 
düg_°©us
 = 
WIFI_DIAG_EOK
;

439 
©h6kl_vif
 *
vif
 = 
	`©h6kl_gë_vif_by_ödex
(

440 
globÆwmi
->
∑ª¡_dev
, 0);

442 i‡(
vif
 =
NULL
)

443  
WIFI_DIAG_ENXIO
;

445 i‡(!
vif
->
düg
.
düg_evít_öô
) {

446 
	`skb_queue_hód_öô
(&
düg_evíts
);

447 
vif
->
düg
.
düg_evít_öô
 = 
åue
;

449 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =

450 
evt_ˇŒback
->
düg_evít_ˇŒback
;

452  
düg_°©us
;

453 
	}
}

455 
wifi_düg_°©us_t


456 
	$wifi_düg_cmd_£nd
(*
drv_hdl
, 
wifi_düg_cmd_t
 *
cmd
)

458 
wifi_düg_°©us_t
 
düg_°©us
 = 
WIFI_DIAG_EOK
;

459 
©h6kl_vif
 *
vif
 = 
	`©h6kl_gë_vif_by_ödex
(

460 
globÆwmi
->
∑ª¡_dev
, 0);

462 
cmd
->
cmd_id
) {

463 
WIFI_DIAG_MAC_TX_FILTER_CMDID
:

465 i‡(
cmd
->
Àn
 =(
wifi_düg_mac_tx_fûãr_cmd_t
)) {

466 
wifi_düg_mac_tx_fûãr_cmd_t
 *
±xfûãr
 =

467 (
wifi_düg_mac_tx_fûãr_cmd_t
 *)

468 
cmd
->
cmd_d©a
;

469 
	`©h6kl_wmi_macfûãr_cmd
(
globÆwmi
,

470 
WMI_PKTLOG_EVENT_TX
,

471 
±xfûãr
->
fûãr_mask_low
 &

472 
WIFI_DIAG_MACFILTER_LOW_MASK
,

473 
±xfûãr
->
fûãr_mask_high
 &

474 
WIFI_DIAG_MACFILTER_HIGH_MASK
);

478 
WIFI_DIAG_MAC_RX_FILTER_CMDID
:

480 i‡(
cmd
->
Àn
 =(
wifi_düg_mac_rx_fûãr_cmd_t
)) {

481 
wifi_düg_mac_rx_fûãr_cmd_t
 *
¥xfûãr
 =

482 (
wifi_düg_mac_rx_fûãr_cmd_t
 *)

483 
cmd
->
cmd_d©a
;

484 
	`©h6kl_wmi_macfûãr_cmd
(
globÆwmi
, 
WMI_PKTLOG_EVENT_RX
,

485 
¥xfûãr
->
fûãr_mask_low
 &

486 
WIFI_DIAG_MACFILTER_LOW_MASK
,

487 
¥xfûãr
->
fûãr_mask_high
 &

488 
WIFI_DIAG_MACFILTER_HIGH_MASK
);

492 
WIFI_DIAG_CFG_CMDID
:

494 i‡(
cmd
->
Àn
 =(
wifi_düg_cfg_cmd_t
)) {

495 
wifi_düg_cfg_cmd_t
 *
pcfg
 =

496 (
wifi_düg_cfg_cmd_t
 *)
cmd
->
cmd_d©a
;

498 i‡(
vif
 =
NULL
)

499  
WIFI_DIAG_ENXIO
;

501 i‡(
pcfg
->
cfg
 !
vif
->
düg
.
cfg_mask
) {

502 i‡(
pcfg
->
cfg
 &

503 (
WIFI_DIAG_MAC_TX_FRAME_EVENTENABLE
 |

504 
WIFI_DIAG_MAC_RX_FRAME_EVENTENABLE
)) {

505 
	`©h6kl_wmi_pkéog_dißbÀ_cmd
(
globÆwmi
);

507 
wmi_íabÀ_pkéog_cmd
 
cmd
;

508 
cmd
.
›ti⁄
 = 
WMI_PKTLOG_OPTION_LOG_DIAGNOSTIC
;

509 
cmd
.
evli°
 = 0;

510 
cmd
.
åiggî_öãrvÆ
 = 0;

511 
cmd
.
åiggî_èû_cou¡
 = 0;

512 
cmd
.
åiggî_thªsh
 = 0;

513 
cmd
.
buf„r_size
 = 1500;

515 i‡(
pcfg
->
cfg
 &

516 
WIFI_DIAG_MAC_TX_FRAME_EVENTENABLE
)

517 
cmd
.
evli°
 |
WMI_PKTLOG_EVENT_TX
;

519 i‡(
pcfg
->
cfg
 &

520 
WIFI_DIAG_MAC_RX_FRAME_EVENTENABLE
)

521 
cmd
.
evli°
 |=

522 
WMI_PKTLOG_EVENT_RX
;

524 
	`©h6kl_wmi_pkéog_íabÀ_cmd
(

525 
globÆwmi
, &
cmd
);

528 
	`©h6kl_wmi_pkéog_dißbÀ_cmd
(

529 
globÆwmi
);

532 i‡(
pcfg
->
cfg
 & 
WIFI_DIAG_MAC_FSM_EVENTENABLE
)

533 
	`©h6kl_wmi_fsm_cmd
(
globÆwmi
, 
åue
);

535 
	`©h6kl_wmi_fsm_cmd
(
globÆwmi
, 
Ál£
);

537 i‡(
pcfg
->
cfg
 &

538 
WIFI_DIAG_INTERFERENCE_EVENTENABLE
) {

539 
	`dñ_timî
(&
vif
->
düg
.
öãr„ªn˚_timî
);

540 
	`öô_timî
(&
vif
->
düg
.
öãr„ªn˚_timî
);

541 
	`£tup_timî
(&
vif
->
düg
.
öãr„ªn˚_timî
,

542 
wifi_düg_öãr„ªn˚_timî_h™dÀr
,

543 (Ë
vif
);

544 
	`mod_timî
(

545 &
vif
->
düg
.
öãr„ªn˚_timî
,

546 
jiffõs
 +

547 
	`m£cs_to_jiffõs
(1000));

549 
	`dñ_timî
(&
vif
->
düg
.

550 
öãr„ªn˚_timî
);

553 i‡(
pcfg
->
cfg
 & 
WIFI_DIAG_RX_TIME_EVENTENABLE
) {

554 
	`dñ_timî
(&
vif
->
düg
.
rxtime_timî
);

555 
	`öô_timî
(&
vif
->
düg
.
rxtime_timî
);

556 
	`£tup_timî
(&
vif
->
düg
.
rxtime_timî
,

557 
wifi_düg_rxtime_timî_h™dÀr
,

558 (Ë
vif
);

559 
	`mod_timî
(&
vif
->
düg
.
rxtime_timî
,

560 
jiffõs
 +

561 
	`m£cs_to_jiffõs
(1000));

563 
	`dñ_timî
(&
vif
->
düg
.
rxtime_timî
);

566 i‡(
pcfg
->
cfg
 & 
WIFI_DIAG_PWR_SAVE_EVENTENABLE
)

567 
	`©h6kl_wmi_pwrßve_cmd
(
globÆwmi
, 
åue
);

569 
	`©h6kl_wmi_pwrßve_cmd
(
globÆwmi
,

570 
Ál£
);

572 i‡(
pcfg
->
cfg
 & 
WIFI_DIAG_TX_STAT_EVENTENABLE
) {

573 
vif
->
düg
.
tx_timî_vÆ
 = 
pcfg
->
vÆue
;

575 
	`dñ_timî
(&
vif
->
düg
.
tx_°©_timî
);

576 
	`öô_timî
(&
vif
->
düg
.
tx_°©_timî
);

577 
	`£tup_timî
(&
vif
->
düg
.
tx_°©_timî
,

578 
wifi_düg_tx_°©_timî_h™dÀr
,

579 (Ë
vif
);

580 
	`mod_timî
(&
vif
->
düg
.
tx_°©_timî
,

581 
jiffõs
 +

582 
	`m£cs_to_jiffõs
(

583 
vif
->
düg
.
tx_timî_vÆ
));

585 
	`dñ_timî
(&
vif
->
düg
.
tx_°©_timî
);

588 i‡(
pcfg
->
cfg
 & 
WIFI_DIAG_RX_STAT_EVENTENABLE
) {

589 
vif
->
düg
.
rx_timî_vÆ
 = 
pcfg
->
vÆue
;

591 
	`dñ_timî
(&
vif
->
düg
.
rx_°©_timî
);

592 
	`öô_timî
(&
vif
->
düg
.
rx_°©_timî
);

593 
	`£tup_timî
(&
vif
->
düg
.
rx_°©_timî
,

594 
wifi_düg_rx_°©_timî_h™dÀr
,

595 (Ë
vif
);

596 
	`mod_timî
(&
vif
->
düg
.
rx_°©_timî
,

597 
jiffõs
 +

598 
	`m£cs_to_jiffõs
(

599 
vif
->
düg
.
rx_timî_vÆ
));

601 
	`dñ_timî
(&
vif
->
düg
.
rx_°©_timî
);

604 
vif
->
düg
.
cfg_mask
 = 
pcfg
->
cfg
;

614  
düg_°©us
;

615 
	}
}

619 c⁄° 
s32
 
	g_øã_tbl_11
[][2] = {

669 
	$wifi_düg_evít_¥o˚ss
(
w‹k_°ru˘
 *
w‹k
)

671 
sk_buff
 *
skb
;

672 
wifi_düg_evít_t
 *
pwifi_düg_evít
;

674 
	`muãx_lock
(&
düg_evít_muãx
);

676 (
skb
 = 
	`skb_dequeue
(&
düg_evíts
))) {

677 
pwifi_düg_evít
 = (
wifi_düg_evít_t
 *Ë
skb
->
d©a
;

679 i‡(!
düg_loˇl_ã°
) {

680 
düg_evt_ˇŒback
.
	`düg_evít_ˇŒback
(

681 (*)&
wifi_drv_hdl_èbÀ
, 
skb
);

683 
	`¥ötk
(
KERN_INFO
 "eventid=%d seq_num=%d\n",

684 
pwifi_düg_evít
->
evít_id
,

685 
pwifi_düg_evít
->
£q_num
);

686 
pwifi_düg_evít
->
evít_id
) {

687 
WIFI_DIAG_MAC_TX_FRAME_EVENTID
:

689 
wifi_düg_mac_tx_‰ame_evít_t


690 *
±x_‰ame_evít_d©a
;

691 
±x_‰ame_evít_d©a
 =

692 (
wifi_düg_mac_tx_‰ame_evít_t
 *)

693 
pwifi_düg_evít
->
evít_d©a
;

695 i‡(
±x_‰ame_evít_d©a
->
‰ame_d©a
 != 0) {

696 
	`¥ötk
(
KERN_INFO
 "tx wh[0]=%x wh[%d]=%x\n",

697 
±x_‰ame_evít_d©a
->
‰ame_d©a
[0],

698 
±x_‰ame_evít_d©a
->
‰ame_Àngth
-1,

699 
±x_‰ame_evít_d©a
->

700 
‰ame_d©a
[
±x_‰ame_evít_d©a
->

701 
‰ame_Àngth
-1]);

704 
	`¥ötk
(
KERN_INFO


706 
±x_‰ame_evít_d©a
->
‰ame_ty≥
,

707 
±x_‰ame_evít_d©a
->
‰ame_sub_ty≥
,

708 
±x_‰ame_evít_d©a
->
‰ame_Àngth
,

709 
±x_‰ame_evít_d©a
->
tx_pwr
,

710 
±x_‰ame_evít_d©a
->
tx_mcs
,

711 
±x_‰ame_evít_d©a
->
tx_bôøã
);

714 
WIFI_DIAG_MAC_RX_FRAME_EVENTID
:

716 
wifi_düg_mac_rx_‰ame_evít_t


717 *
¥x_‰ame_evít_d©a
;

718 
¥x_‰ame_evít_d©a
 =

719 (
wifi_düg_mac_rx_‰ame_evít_t
 *)

720 
pwifi_düg_evít
->
evít_d©a
;

722 i‡(
¥x_‰ame_evít_d©a
->
‰ame_d©a
 != 0) {

723 
	`¥ötk
(
KERN_INFO
 "rx wh[0]=%x wh[%d]=%x\n",

724 
¥x_‰ame_evít_d©a
->
‰ame_d©a
[0],

725 
¥x_‰ame_evít_d©a
->
‰ame_Àngth
-1,

726 
¥x_‰ame_evít_d©a
->

727 
‰ame_d©a
[
¥x_‰ame_evít_d©a
->

728 
‰ame_Àngth
-1]);

731 
	`¥ötk
(
KERN_INFO


733 
¥x_‰ame_evít_d©a
->
rssi
,

734 
¥x_‰ame_evít_d©a
->
‰ame_ty≥
,

735 
¥x_‰ame_evít_d©a
->
‰ame_sub_ty≥
,

736 
¥x_‰ame_evít_d©a
->
‰ame_Àngth
,

737 
¥x_‰ame_evít_d©a
->
rx_mcs
,

738 
¥x_‰ame_evít_d©a
->
rx_bôøã
);

741 
WIFI_DIAG_MAC_FSM_EVENTID
:

743 
wifi_düg_mac_fsm_evít_t


744 *
pfsm_evít_d©a
;

745 
pfsm_evít_d©a
 =

746 (
wifi_düg_mac_fsm_evít_t
 *)

747 
pwifi_düg_evít
->
evít_d©a
;

748 
	`¥ötk
(
KERN_INFO


749 "fsmÉvíà%d\n", 
pfsm_evít_d©a
->
fsm
);

752 
WIFI_DIAG_INTERFERENCE_EVENTID
:

754 
wifi_düg_öãr„ªn˚_evít_t


755 *
pöãr„ªn˚_evít_d©a
;

756 
pöãr„ªn˚_evít_d©a
 =

757 (
wifi_düg_öãr„ªn˚_evít_t
 *)

758 
pwifi_düg_evít
->
evít_d©a
;

759 
	`¥ötk
(
KERN_INFO


761 
pöãr„ªn˚_evít_d©a
->
rx_˛ór_˙t
);

764 
WIFI_DIAG_RX_TIME_EVENTID
:

766 
wifi_düg_rxtime_evít_t


767 *
¥xtime_evít_d©a
;

768 
¥xtime_evít_d©a
 =

769 (
wifi_düg_rxtime_evít_t
 *)

770 
pwifi_düg_evít
->
evít_d©a
;

771 
	`¥ötk
(
KERN_INFO


773 
¥xtime_evít_d©a
->
rx_‰ame_˙t
);

776 
WIFI_DIAG_PWR_SAVE_EVENTID
:

778 
wifi_düg_pwrßve_evít_t


779 *
µwrßve_evít_d©a
;

780 
µwrßve_evít_d©a
 =

781 (
wifi_düg_pwrßve_evít_t
 *)

782 
pwifi_düg_evít
->
evít_d©a
;

783 
	`¥ötk
(
KERN_INFO


785 
µwrßve_evít_d©a
->
pwrßve
);

788 
WIFI_DIAG_TX_STAT_EVENTID
:

790 
u32
 
i
;

791 
wifi_düg_tx_°©_evít_t


792 *
±x_°©_evít_d©a
;

793 
±x_°©_evít_d©a
 =

794 (
wifi_düg_tx_°©_evít_t
 *)

795 
pwifi_düg_evít
->
evít_d©a
;

797 
	`¥ötk
(
KERN_INFO
 "tx_pkt=%lld,Åx_ucast_pkt=%lld,Åx_retry_cnt=%lld,Åx_fail_cnt=%lld\n",

798 
±x_°©_evít_d©a
->
tx_pkt
,

799 
±x_°©_evít_d©a
->
tx_uˇ°_pkt
,

800 
±x_°©_evít_d©a
->
tx_ªåy_˙t
,

801 
±x_°©_evít_d©a
->
tx_Áû_˙t
);

802 
i
 = 0; i < 44; i++)

803 
	`¥ötk
(
KERN_INFO
 "tx_rate_pkt[%d]=%d\n",

804 
i
,

805 
±x_°©_evít_d©a
->

806 
tx_øã_pkt
[
i
]

810 
WIFI_DIAG_RX_STAT_EVENTID
:

812 
u32
 
i
;

813 
wifi_düg_rx_°©_evít_t


814 *
¥x_°©_evít_d©a
;

815 
¥x_°©_evít_d©a
 =

816 (
wifi_düg_rx_°©_evít_t
 *)

817 
pwifi_düg_evít
->
evít_d©a
;

819 
	`¥ötk
(
KERN_INFO
 "rx_pkt=%lld,Ñx_ucast_pkt=%lld,Ñx_dupl_frame=%lld\n",

820 
¥x_°©_evít_d©a
->
rx_pkt
,

821 
¥x_°©_evít_d©a
->
rx_uˇ°_pkt
,

822 
¥x_°©_evít_d©a
->
rx_du∂_‰ame
);

823 
i
 = 0; i < 44; i++)

824 
	`¥ötk
(
KERN_INFO


826 
i
,

827 
¥x_°©_evít_d©a
->

828 
rx_øã_pkt
[
i
]

835 
	`dev_k‰ì_skb
(
skb
);

838 
	`muãx_u∆ock
(&
düg_evít_muãx
);

839 
	}
}

841 
DECLARE_WORK
(
wifi_düg_evít_w‹k
, 
wifi_düg_evít_¥o˚ss
);

846 
	$wifi_düg_mac_tx_‰ame_evít
(
©h6kl_vif
 *
vif
,

847 
©h_pkéog_tx°©us
 *
tx°©us_log
)

849 
wifi_düg_evít_t
 *
pwifi_düg_tx‰ame_evít
;

850 
wifi_düg_mac_tx_‰ame_evít_t
 *
±x_‰ame_evít_d©a
;

851 
sk_buff
 *
skb
;

852 
u32
 
size
;

853 
u32
 
tx_mcs
;

854 
u8
 
sgi
 = 0;

855 
u32
 
tx_buf_Àn
 = 0;

857 i‡(!
düg_loˇl_ã°
) {

858 i‡(!(
vif
->
düg
.
cfg_mask
 & 
WIFI_DIAG_MAC_TX_FRAME_EVENTENABLE
)

859 || 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =
NULL
)

863 
size
 = (*
pwifi_düg_tx‰ame_evít
) +

864 (*
±x_‰ame_evít_d©a
) + 512;

865 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

866 i‡(!
skb
)

869 
pwifi_düg_tx‰ame_evít
 = (
wifi_düg_evít_t
 *Ë
skb
->
d©a
;

870 
pwifi_düg_tx‰ame_evít
->
evít_id
 = 
WIFI_DIAG_MAC_TX_FRAME_EVENTID
;

871 
pwifi_düg_tx‰ame_evít
->
£q_num
 = 
	`À32_to_˝u
(
tx°©us_log
->
misc
[2]);

872 
±x_‰ame_evít_d©a
 = (
wifi_düg_mac_tx_‰ame_evít_t
 *)

873 
pwifi_düg_tx‰ame_evít
->
evít_d©a
;

875 
±x_‰ame_evít_d©a
->
tx_pwr
 = 
tx°©us_log
->
misc
[1];

876 
tx_mcs
 = 
	`À16_to_˝u
(
tx°©us_log
->
misc
[0]);

877 i‡(
tx_mcs
 > 
MAX11_RATE_INDEX
)

878 
tx_mcs
 = 
MAX11_RATE_INDEX
;

879 
±x_‰ame_evít_d©a
->
tx_mcs
 =Åx_mcs;

880 
sgi
 = (
tx°©us_log
->
misc
[0]>>8Ë& 
WHAL_RC_FLAG_SGI
;

881 
±x_‰ame_evít_d©a
->
tx_bôøã
 = 
_øã_tbl_11
[
tx_mcs
][
sgi
];

882 
±x_‰ame_evít_d©a
->
‰ame_ty≥
 = 
vif
->
düg
.
tx_‰ame_ty≥
;

883 
±x_‰ame_evít_d©a
->
‰ame_sub_ty≥
 = 
vif
->
düg
.
tx_‰ame_subty≥
;

884 
±x_‰ame_evít_d©a
->
‰ame_Àngth
 = 
vif
->
düg
.
tx_‰ame_Àn
;

886 
tx_buf_Àn
 = 
	`À32_to_˝u
(
tx°©us_log
->
buf_Àn
);

887 
pwifi_düg_tx‰ame_evít
->
Àn
 = 
tx_buf_Àn
 +

888 (*
±x_‰ame_evít_d©a
) - 1;

890 i‡(
±x_‰ame_evít_d©a
->
‰ame_d©a
 != 0) {

891 
u16
 
‰ame˘æ
 = 
vif
->
düg
.
tx_‰ame_subty≥
 << 4 |

892 
vif
->
düg
.
tx_‰ame_ty≥
;

894 
	`mem£t
(
±x_‰ame_evít_d©a
->
‰ame_d©a
, 0, 512);

896 i‡(
	`IEEE80211_QOS_HAS_SEQ
(
‰ame˘æ
)) {

897 
tx_buf_Àn
 -
IEEE80211_QOS_PADLEN
;

898 
pwifi_düg_tx‰ame_evít
->
Àn
 -
IEEE80211_QOS_PADLEN
;

899 
±x_‰ame_evít_d©a
->
‰ame_Àngth
 -=

900 
IEEE80211_QOS_PADLEN
;

901 
	`mem˝y
(
±x_‰ame_evít_d©a
->
‰ame_d©a
,

902 
tx°©us_log
->
buf
, 
IEEE80211_QOS_HEADERLEN
);

903 
	`mem˝y
(
±x_‰ame_evít_d©a
->
‰ame_d©a
+

904 
IEEE80211_QOS_HEADERLEN
,

905 
tx°©us_log
->
buf
+

906 
IEEE80211_QOS_HEADERLEN
+

907 
IEEE80211_QOS_PADLEN
,

908 
tx_buf_Àn
 - 
IEEE80211_QOS_HEADERLEN
);

910 
	`mem˝y
(
±x_‰ame_evít_d©a
->
‰ame_d©a
,

911 
tx°©us_log
->
buf
, 
tx_buf_Àn
);

915 i‡(
vif
->
düg
.
düg_evít_öô
) {

916 
	`skb_queue_èû
(&
düg_evíts
, 
skb
);

917 
	`scheduÀ_w‹k
(&
wifi_düg_evít_w‹k
);

919 
	}
}

923 
	$wifi_düg_mac_tx˘æ_evít
(
©h6kl_vif
 *
vif
,

924 
©h_pkéog_tx˘l
 *
tx˘æ_log
)

926 
tx_˘æ_desc
 *
tx˘æ
;

928 i‡(!
düg_loˇl_ã°
) {

929 i‡(!(
vif
->
düg
.
cfg_mask
 & 
WIFI_DIAG_MAC_TX_FRAME_EVENTENABLE
)

930 || 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =
NULL
)

934 
vif
->
düg
.
tx_‰ame_ty≥
 = 
	`À16_to_˝u
(
tx˘æ_log
->
‰ame˘æ
) &

935 
IEEE80211_FC0_TYPE_MASK
;

936 
vif
->
düg
.
tx_‰ame_subty≥
 = (
	`À16_to_˝u
(
tx˘æ_log
->
‰ame˘æ
) &

937 
IEEE80211_FC0_SUBTYPE_MASK
) >> 4;

938 
tx˘æ
 = (
tx_˘æ_desc
 *)
tx˘æ_log
->
txdesc_˘l
;

939 
vif
->
düg
.
tx_‰ame_Àn
 = 
	`À16_to_˝u
(
	`WHAL_TXDESC_GET_FRAME_LEN
(
tx˘æ
));

940 
	}
}

943 
	$wifi_düg_mac_rx_‰ame_evít
(
©h6kl_vif
 *
vif
,

944 
©h_pkéog_rx
 *
rx_log
)

946 
wifi_düg_evít_t
 *
pwifi_düg_rx‰ame_evít
;

947 
wifi_düg_mac_rx_‰ame_evít_t
 *
¥x_‰ame_evít_d©a
;

948 
sk_buff
 *
skb
;

949 
u32
 
size
;

950 
rx_desc_°©us
 *
rx°©us
;

951 
u8
 
sgi
 = 0;

952 
u32
 
rx_mcs
 = 0, 
rx_buf_Àn
 = 0;

954 i‡(!
düg_loˇl_ã°
) {

955 i‡(!(
vif
->
düg
.
cfg_mask
 & 
WIFI_DIAG_MAC_RX_FRAME_EVENTENABLE
)

956 || 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =
NULL
)

960 
size
 = (*
pwifi_düg_rx‰ame_evít
) +

961 (*
¥x_‰ame_evít_d©a
) + 512;

962 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

963 i‡(!
skb
)

966 
pwifi_düg_rx‰ame_evít
 = (
wifi_düg_evít_t
 *Ë
skb
->
d©a
;

967 
pwifi_düg_rx‰ame_evít
->
evít_id
 = 
WIFI_DIAG_MAC_RX_FRAME_EVENTID
;

968 
pwifi_düg_rx‰ame_evít
->
£q_num
 = 
rx_log
->seq_num;

969 
¥x_‰ame_evít_d©a
 = (
wifi_düg_mac_rx_‰ame_evít_t
 *)

970 
pwifi_düg_rx‰ame_evít
->
evít_d©a
;

971 
rx°©us
 = (
rx_desc_°©us
 *)&
rx_log
->rxstatus[0];

972 
¥x_‰ame_evít_d©a
->
rssi
 = 
	`À16_to_˝u
(
rx°©us
->
rsRssi
) +

973 
rx_log
->
ˇlibøãdnf
;

975 
¥x_‰ame_evít_d©a
->
¢r
 = 
	`À16_to_˝u
(
rx°©us
->
rsRssi
);

976 
rx_mcs
 = 
	`À32_to_˝u
(
rx_log
->
rxmcs
);

977 i‡(
rx_mcs
 > 
MAX11_RATE_INDEX
)

978 
rx_mcs
 = 
MAX11_RATE_INDEX
;

979 
¥x_‰ame_evít_d©a
->
rx_mcs
 =Ñx_mcs;

980 
sgi
 = 
rx°©us
->
rsR©e
.
Êags
 & 
WHAL_RC_FLAG_SGI
;

981 
¥x_‰ame_evít_d©a
->
rx_bôøã
 = 
_øã_tbl_11
[
rx_mcs
][
sgi
];

982 
¥x_‰ame_evít_d©a
->
fcs
 = (
rx°©us
->
rsSètus
 & 
WHAL_RXERR_CRC
) ?

984 
¥x_‰ame_evít_d©a
->
‰ame_ty≥
 =

985 
	`À16_to_˝u
(
rx_log
->
‰ame˘æ
Ë& 
IEEE80211_FC0_TYPE_MASK
;

986 
¥x_‰ame_evít_d©a
->
‰ame_sub_ty≥
 =

987 (
	`À16_to_˝u
(
rx_log
->
‰ame˘æ
) &

988 
IEEE80211_FC0_SUBTYPE_MASK
) >> 4;

989 
¥x_‰ame_evít_d©a
->
‰ame_Àngth
 = 
	`À16_to_˝u
(
rx°©us
->
rsD©aLí
);

991 
rx_buf_Àn
 = 
	`À32_to_˝u
(
rx_log
->
buf_Àn
);

992 
pwifi_düg_rx‰ame_evít
->
Àn
 = 
rx_buf_Àn
 +

993 (*
¥x_‰ame_evít_d©a
) - 1;

995 i‡(
¥x_‰ame_evít_d©a
->
‰ame_d©a
 != 0) {

996 
	`mem£t
(
¥x_‰ame_evít_d©a
->
‰ame_d©a
, 0, 512);

999 i‡(
	`IEEE80211_QOS_HAS_SEQ
(
	`À16_to_˝u
(
rx_log
->
‰ame˘æ
))) {

1000 
rx_buf_Àn
 -
IEEE80211_QOS_PADLEN
;

1001 
pwifi_düg_rx‰ame_evít
->
Àn
 -
IEEE80211_QOS_PADLEN
;

1002 
¥x_‰ame_evít_d©a
->
‰ame_Àngth
 -=

1003 
IEEE80211_QOS_PADLEN
;

1004 
	`mem˝y
(
¥x_‰ame_evít_d©a
->
‰ame_d©a
,

1005 
rx_log
->
buf
, 
IEEE80211_QOS_HEADERLEN
);

1006 
	`mem˝y
(
¥x_‰ame_evít_d©a
->
‰ame_d©a
+

1007 
IEEE80211_QOS_HEADERLEN
,

1008 
rx_log
->
buf
+
IEEE80211_QOS_HEADERLEN
+

1009 
IEEE80211_QOS_PADLEN
,

1010 
rx_buf_Àn
 - 
IEEE80211_QOS_HEADERLEN
);

1012 
	`mem˝y
(
¥x_‰ame_evít_d©a
->
‰ame_d©a
,

1013 
rx_log
->
buf
, 
rx_buf_Àn
);

1017 i‡(
vif
->
düg
.
düg_evít_öô
) {

1018 
	`skb_queue_èû
(&
düg_evíts
, 
skb
);

1019 
	`scheduÀ_w‹k
(&
wifi_düg_evít_w‹k
);

1021 
	}
}

1024 
	$wifi_düg_mac_fsm_evít
(
©h6kl_vif
 *
vif
,

1025 
wifi_düg_mac_fsm_t
 
evíây≥
, 
u32
 
£q_num
)

1027 
wifi_düg_evít_t
 *
pwifi_düg_evít
;

1028 
wifi_düg_mac_fsm_evít_t
 *
pfsm_evít_d©a
;

1029 
sk_buff
 *
skb
;

1030 
u32
 
size
;

1032 i‡(!
düg_loˇl_ã°
) {

1033 i‡(!(
vif
->
düg
.
cfg_mask
 & 
WIFI_DIAG_MAC_FSM_EVENTENABLE
)

1034 || 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =
NULL
)

1038 
size
 = (*
pwifi_düg_evít
Ë+ (*
pfsm_evít_d©a
) ;

1039 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

1040 i‡(!
skb
)

1043 
pwifi_düg_evít
 = (
wifi_düg_evít_t
 *Ë
skb
->
d©a
;

1044 
pwifi_düg_evít
->
evít_id
 = 
WIFI_DIAG_MAC_FSM_EVENTID
;

1045 
pwifi_düg_evít
->
£q_num
 = seq_num;

1046 
pwifi_düg_evít
->
Àn
 = (*
pfsm_evít_d©a
);

1047 
pfsm_evít_d©a
 = (
wifi_düg_mac_fsm_evít_t
 *)

1048 
pwifi_düg_evít
->
evít_d©a
;

1049 
pfsm_evít_d©a
->
fsm
 = 
evíây≥
;

1051 i‡(
vif
->
düg
.
düg_evít_öô
) {

1052 
	`skb_queue_èû
(&
düg_evíts
, 
skb
);

1053 
	`scheduÀ_w‹k
(&
wifi_düg_evít_w‹k
);

1055 
	}
}

1058 
	$wifi_düg_£nd_pwrßve_evít
(
©h6kl_vif
 *
vif
,

1059 
wifi_düg_pwrßve_t
 
pwrßve
, 
u32
 
£q_num
)

1061 
wifi_düg_evít_t
 *
pwifi_düg_pwrßve_evít
;

1062 
wifi_düg_pwrßve_evít_t
 *
µwrßve_evít_d©a
;

1063 
sk_buff
 *
skb
;

1064 
u32
 
size
;

1066 i‡(!
düg_loˇl_ã°
) {

1067 i‡(!(
vif
->
düg
.
cfg_mask
 & 
WIFI_DIAG_PWR_SAVE_EVENTENABLE
)

1068 || 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =
NULL
)

1072 
size
 = (*
pwifi_düg_pwrßve_evít
Ë+ (*
µwrßve_evít_d©a
);

1073 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

1074 i‡(!
skb
)

1077 
pwifi_düg_pwrßve_evít
 = (
wifi_düg_evít_t
 *Ë
skb
->
d©a
;

1078 
pwifi_düg_pwrßve_evít
->
evít_id
 = 
WIFI_DIAG_PWR_SAVE_EVENTID
;

1079 
pwifi_düg_pwrßve_evít
->
£q_num
 = seq_num;

1080 
pwifi_düg_pwrßve_evít
->
Àn
 = (*
µwrßve_evít_d©a
);

1081 
µwrßve_evít_d©a
 = (
wifi_düg_pwrßve_evít_t
 *)

1082 
pwifi_düg_pwrßve_evít
->
evít_d©a
;

1083 
µwrßve_evít_d©a
->
pwrßve
 =Öwrsave;

1085 i‡(
vif
->
düg
.
düg_evít_öô
) {

1086 
	`skb_queue_èû
(&
düg_evíts
, 
skb
);

1087 
	`scheduÀ_w‹k
(&
wifi_düg_evít_w‹k
);

1089 
	}
}

1092 
	$©h6kl_wmi_°©_rx_øã_evít
(
©h6kl_vif
 *
vif
,

1093 
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
, 
u32
 
£q_num
)

1095 
wifi_düg_evít_t
 *
pwifi_düg_rx°©_evít
;

1096 
wifi_düg_rx_°©_evít_t
 *
¥x_°©_evít_d©a
;

1097 
sk_buff
 *
skb
;

1098 
u32
 
size
, 
i
;

1099 
u32
 
rx_øã_pkt
[44];

1101 
	`mem˝y
(&
rx_øã_pkt
[0], 
d©≠
, (
u32
)*44);

1103 i‡(!
düg_loˇl_ã°
) {

1104 i‡(!(
vif
->
düg
.
cfg_mask
 & 
WIFI_DIAG_RX_STAT_EVENTENABLE
)

1105 || 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =
NULL
)

1106  -
EINVAL
;

1109 
	`¥ötk
(
KERN_INFO
 "ath6kl_wmi_stat_rx_rate_event\n");

1111 
size
 = (*
pwifi_düg_rx°©_evít
Ë+ (*
¥x_°©_evít_d©a
);

1112 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

1113 i‡(!
skb
)

1114  -
ENOMEM
;

1116 
pwifi_düg_rx°©_evít
 = (
wifi_düg_evít_t
 *Ë
skb
->
d©a
;

1117 
pwifi_düg_rx°©_evít
->
evít_id
 = 
WIFI_DIAG_RX_STAT_EVENTID
;

1118 
pwifi_düg_rx°©_evít
->
£q_num
 = seq_num;

1119 
pwifi_düg_rx°©_evít
->
Àn
 = (*
¥x_°©_evít_d©a
);

1120 
¥x_°©_evít_d©a
 = (
wifi_düg_rx_°©_evít_t
 *)

1121 
pwifi_düg_rx°©_evít
->
evít_d©a
;

1122 
¥x_°©_evít_d©a
->
rx_pkt
 = 
vif
->
èrgë_°©s
.rx_pkt;

1123 
¥x_°©_evít_d©a
->
rx_uˇ°_pkt
 = 
vif
->
èrgë_°©s
.rx_ucast_pkt;

1124 
¥x_°©_evít_d©a
->
rx_du∂_‰ame
 = 
vif
->
èrgë_°©s
.rx_dupl_frame;

1125 
i
 = 0; i < 44; i++)

1126 
¥x_°©_evít_d©a
->
rx_øã_pkt
[
i
] =Ñx_rate_pkt[i];

1128 i‡(
vif
->
düg
.
düg_evít_öô
) {

1129 
	`skb_queue_èû
(&
düg_evíts
, 
skb
);

1130 
	`scheduÀ_w‹k
(&
wifi_düg_evít_w‹k
);

1134 
	}
}

1137 
	$©h6kl_wmi_°©_tx_øã_evít
(
©h6kl_vif
 *
vif
,

1138 
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
, 
u32
 
£q_num
)

1140 
wifi_düg_evít_t
 *
pwifi_düg_tx°©_evít
;

1141 
wifi_düg_tx_°©_evít_t
 *
±x_°©_evít_d©a
;

1142 
sk_buff
 *
skb
;

1143 
u32
 
size
, 
i
;

1144 
u32
 
tx_øã_pkt
[44];

1146 
	`mem˝y
(&
tx_øã_pkt
[0], 
d©≠
, (
u32
)*44);

1148 i‡(!
düg_loˇl_ã°
) {

1149 i‡(!(
vif
->
düg
.
cfg_mask
 & 
WIFI_DIAG_TX_STAT_EVENTENABLE
)

1150 || 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =
NULL
)

1151  -
EINVAL
;

1154 
	`¥ötk
(
KERN_INFO
 "ath6kl_wmi_stat_tx_rate_event\n");

1156 
size
 = (*
pwifi_düg_tx°©_evít
Ë+ (*
±x_°©_evít_d©a
);

1157 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

1158 i‡(!
skb
)

1159  -
ENOMEM
;

1161 
pwifi_düg_tx°©_evít
 = (
wifi_düg_evít_t
 *Ë
skb
->
d©a
;

1162 
pwifi_düg_tx°©_evít
->
evít_id
 = 
WIFI_DIAG_TX_STAT_EVENTID
;

1163 
pwifi_düg_tx°©_evít
->
£q_num
 = seq_num;

1164 
pwifi_düg_tx°©_evít
->
Àn
 = (*
±x_°©_evít_d©a
);

1165 
±x_°©_evít_d©a
 = (
wifi_düg_tx_°©_evít_t
 *)

1166 
pwifi_düg_tx°©_evít
->
evít_d©a
;

1167 
±x_°©_evít_d©a
->
tx_pkt
 = 
vif
->
èrgë_°©s
.tx_pkt;

1168 
±x_°©_evít_d©a
->
tx_uˇ°_pkt
 = 
vif
->
èrgë_°©s
.tx_ucast_pkt;

1169 
±x_°©_evít_d©a
->
tx_ªåy_˙t
 = 
vif
->
èrgë_°©s
.tx_retry_cnt;

1170 
±x_°©_evít_d©a
->
tx_Áû_˙t
 = 
vif
->
èrgë_°©s
.tx_fail_cnt;

1171 
i
 = 0; i < 44; i++)

1172 
±x_°©_evít_d©a
->
tx_øã_pkt
[
i
] =Åx_rate_pkt[i];

1174 i‡(
vif
->
düg
.
düg_evít_öô
) {

1175 
	`skb_queue_èû
(&
düg_evíts
, 
skb
);

1176 
	`scheduÀ_w‹k
(&
wifi_düg_evít_w‹k
);

1180 
	}
}

1183 
	$©h6kl_wmi_öãr„ªn˚_evít
(
©h6kl_vif
 *
vif
,

1184 
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
, 
u32
 
£q_num
)

1186 
wifi_düg_evít_t
 *
pwifi_düg_öãr„ªn˚_evít
;

1187 
wifi_düg_öãr„ªn˚_evít_t
 *
pöãr„ªn˚_evít_d©a
;

1188 
sk_buff
 *
skb
;

1189 
u32
 
size
, 
rx_˛ór_˙t
;

1191 
	`¥ötk
(
KERN_INFO
 "ath6kl_wmi_interference_event\n");

1193 i‡(!
düg_loˇl_ã°
) {

1194 i‡(!(
vif
->
düg
.
cfg_mask
 & 
WIFI_DIAG_INTERFERENCE_EVENTENABLE
)

1195 || 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =
NULL
)

1196  -
EINVAL
;

1199 
size
 = (*
pwifi_düg_öãr„ªn˚_evít
) +

1200 (*
pöãr„ªn˚_evít_d©a
);

1201 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

1202 i‡(!
skb
)

1203  -
ENOMEM
;

1205 
pwifi_düg_öãr„ªn˚_evít
 = (
wifi_düg_evít_t
 *Ë
skb
->
d©a
;

1206 
pwifi_düg_öãr„ªn˚_evít
->
evít_id
 =

1207 
WIFI_DIAG_INTERFERENCE_EVENTID
;

1208 
pwifi_düg_öãr„ªn˚_evít
->
£q_num
 = seq_num;

1209 
pwifi_düg_öãr„ªn˚_evít
->
Àn
 = (*
pöãr„ªn˚_evít_d©a
);

1210 
pöãr„ªn˚_evít_d©a
 = (
wifi_düg_öãr„ªn˚_evít_t
 *)

1211 
pwifi_düg_öãr„ªn˚_evít
->
evít_d©a
;

1213 
rx_˛ór_˙t
 = *((
u32
 *)
d©≠
);

1214 i‡(
rx_˛ór_˙t
 >
vif
->
düg
.
¥e_rx_˛ór_˙t
)

1215 
pöãr„ªn˚_evít_d©a
->
rx_˛ór_˙t
 =

1216 
rx_˛ór_˙t
 - 
vif
->
düg
.
¥e_rx_˛ór_˙t
;

1218 
pöãr„ªn˚_evít_d©a
->
rx_˛ór_˙t
 =

1219 0xFFFFFFFF - (
vif
->
düg
.
¥e_rx_˛ór_˙t
 - 
rx_˛ór_˙t
);

1220 
vif
->
düg
.
¥e_rx_˛ór_˙t
 = 
rx_˛ór_˙t
;

1222 i‡(
vif
->
düg
.
düg_evít_öô
) {

1223 
	`skb_queue_èû
(&
düg_evíts
, 
skb
);

1224 
	`scheduÀ_w‹k
(&
wifi_düg_evít_w‹k
);

1227 
	}
}

1230 
	$©h6kl_wmi_rxtime_evít
(
©h6kl_vif
 *
vif
,

1231 
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
, 
u32
 
£q_num
)

1233 
wifi_düg_evít_t
 *
pwifi_düg_rxtime_evít
;

1234 
wifi_düg_rxtime_evít_t
 *
¥xtime_evít_d©a
;

1235 
sk_buff
 *
skb
;

1236 
u32
 
size
, 
rx_‰ame_˙t
;

1238 
	`¥ötk
(
KERN_INFO
 KERN_INFO KERN_INFO "ath6kl_wmi_rxtime_event\n");

1240 i‡(!
düg_loˇl_ã°
) {

1241 i‡(!(
vif
->
düg
.
cfg_mask
 & 
WIFI_DIAG_RX_TIME_EVENTENABLE
)

1242 || 
düg_evt_ˇŒback
.
düg_evít_ˇŒback
 =
NULL
)

1243  -
EINVAL
;

1246 
size
 = (*
pwifi_düg_rxtime_evít
Ë+ (*
¥xtime_evít_d©a
);

1247 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

1248 i‡(!
skb
)

1249  -
ENOMEM
;

1251 
pwifi_düg_rxtime_evít
 = (
wifi_düg_evít_t
 *Ë
skb
->
d©a
;

1252 
pwifi_düg_rxtime_evít
->
evít_id
 = 
WIFI_DIAG_RX_TIME_EVENTID
;

1253 
pwifi_düg_rxtime_evít
->
£q_num
 = seq_num;

1254 
pwifi_düg_rxtime_evít
->
Àn
 = (*
¥xtime_evít_d©a
);

1255 
¥xtime_evít_d©a
 = (
wifi_düg_rxtime_evít_t
 *)

1256 
pwifi_düg_rxtime_evít
->
evít_d©a
;

1258 
rx_‰ame_˙t
 = *((
u32
 *)
d©≠
);

1259 i‡(
rx_‰ame_˙t
 >
vif
->
düg
.
¥e_rx_‰ame_˙t
)

1260 
¥xtime_evít_d©a
->
rx_‰ame_˙t
 =

1261 
rx_‰ame_˙t
 - 
vif
->
düg
.
¥e_rx_‰ame_˙t
;

1263 
¥xtime_evít_d©a
->
rx_‰ame_˙t
 =

1264 0xFFFFFFFF - (
vif
->
düg
.
¥e_rx_‰ame_˙t
 - 
rx_‰ame_˙t
);

1265 
vif
->
düg
.
¥e_rx_‰ame_˙t
 = 
rx_‰ame_˙t
;

1267 i‡(
vif
->
düg
.
düg_evít_öô
) {

1268 
	`skb_queue_èû
(&
düg_evíts
, 
skb
);

1269 
	`scheduÀ_w‹k
(&
wifi_düg_evít_w‹k
);

1272 
	}
}

1275 
	$wifi_düg_tx_°©_timî_h™dÀr
(
±r
)

1277 
©h6kl_vif
 *
vif
 = (©h6kl_vi‡*)
±r
;

1278 
sk_buff
 *
skb
;

1280 
	`©h6kl_wmi_gë_°©s_cmd
(
globÆwmi
, 0);

1282 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmid_cmd_hdr
));

1283 i‡(
skb
)

1284 
	`©h6kl_wmi_cmd_£nd_düg
(
globÆwmi
, 
skb
,

1285 
WMID_STAT_TX_RATE_CMDID
,

1286 
NO_SYNC_WMIFLAG
);

1288 
	`mod_timî
(&
vif
->
düg
.
tx_°©_timî
,

1289 
jiffõs
 + 
	`m£cs_to_jiffõs
(
vif
->
düg
.
tx_timî_vÆ
));

1290 
	}
}

1293 
	$wifi_düg_rx_°©_timî_h™dÀr
(
±r
)

1295 
©h6kl_vif
 *
vif
 = (©h6kl_vi‡*)
±r
;

1296 
sk_buff
 *
skb
;

1298 
	`©h6kl_wmi_gë_°©s_cmd
(
globÆwmi
, 0);

1300 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmid_cmd_hdr
));

1301 i‡(
skb
)

1302 
	`©h6kl_wmi_cmd_£nd_düg
(
globÆwmi
, 
skb
,

1303 
WMID_STAT_RX_RATE_CMDID
,

1304 
NO_SYNC_WMIFLAG
);

1306 
	`mod_timî
(&
vif
->
düg
.
rx_°©_timî
,

1307 
jiffõs
 + 
	`m£cs_to_jiffõs
(
vif
->
düg
.
rx_timî_vÆ
));

1308 
	}
}

1311 
	$wifi_düg_öãr„ªn˚_timî_h™dÀr
(
±r
)

1313 
©h6kl_vif
 *
vif
 = (©h6kl_vi‡*)
±r
;

1315 
	`©h6kl_wmi_öãr„ªn˚_cmd
(
globÆwmi
);

1316 
	`mod_timî
(&
vif
->
düg
.
öãr„ªn˚_timî
,

1317 
jiffõs
 + 
	`m£cs_to_jiffõs
(1000));

1320 
	}
}

1323 
	$wifi_düg_rxtime_timî_h™dÀr
(
±r
)

1325 
©h6kl_vif
 *
vif
 = (©h6kl_vi‡*)
±r
;

1327 
	`©h6kl_wmi_rxtime_cmd
(
globÆwmi
);

1328 
	`mod_timî
(&
vif
->
düg
.
rxtime_timî
, 
jiffõs
 + 
	`m£cs_to_jiffõs
(1000));

1331 
	}
}

1334 
	$wifi_düg_timî_de°roy
(
©h6kl_vif
 *
vif
)

1336 
	`dñ_timî
(&
vif
->
düg
.
tx_°©_timî
);

1337 
	`dñ_timî
(&
vif
->
düg
.
rx_°©_timî
);

1338 
	`dñ_timî
(&
vif
->
düg
.
öãr„ªn˚_timî
);

1339 
	`dñ_timî
(&
vif
->
düg
.
rxtime_timî
);

1341 i‡(
vif
->
düg
.
düg_evít_öô
) {

1342 
	`skb_queue_purge
(&
düg_evíts
);

1343 
vif
->
düg
.
düg_evít_öô
 = 
Ál£
;

1345 
	}
}

1348 
	$wifi_düg_öô
()

1350 
©h6kl_vif
 *
vif
 = 
	`©h6kl_gë_vif_by_ödex
(

1351 
globÆwmi
->
∑ª¡_dev
, 0);

1353 i‡(
vif
 =
NULL
)

1356 
	`skb_queue_hód_öô
(&
düg_evíts
);

1357 
vif
->
düg
.
düg_evít_öô
 = 
åue
;

1359 i‡(
düg_loˇl_ã°
 & 
WIFI_DIAG_MAC_FSM_EVENTENABLE
)

1360 
	`©h6kl_wmi_fsm_cmd
(
globÆwmi
, 
åue
);

1362 i‡(
düg_loˇl_ã°
 & 
WIFI_DIAG_PWR_SAVE_EVENTENABLE
)

1363 
	`©h6kl_wmi_pwrßve_cmd
(
globÆwmi
, 
åue
);

1365 i‡(
düg_loˇl_ã°
 & 
WIFI_DIAG_INTERFERENCE_EVENTENABLE
) {

1366 
	`dñ_timî
(&
vif
->
düg
.
öãr„ªn˚_timî
);

1367 
	`öô_timî
(&
vif
->
düg
.
öãr„ªn˚_timî
);

1368 
	`£tup_timî
(&
vif
->
düg
.
öãr„ªn˚_timî
,

1369 
wifi_düg_öãr„ªn˚_timî_h™dÀr
,

1370 (Ë
vif
);

1371 
	`mod_timî
(&
vif
->
düg
.
öãr„ªn˚_timî
,

1372 
jiffõs
 + 
	`m£cs_to_jiffõs
(1000));

1375 i‡(
düg_loˇl_ã°
 & 
WIFI_DIAG_RX_TIME_EVENTENABLE
) {

1376 
	`dñ_timî
(&
vif
->
düg
.
rxtime_timî
);

1377 
	`öô_timî
(&
vif
->
düg
.
rxtime_timî
);

1378 
	`£tup_timî
(&
vif
->
düg
.
rxtime_timî
,

1379 
wifi_düg_rxtime_timî_h™dÀr
, (Ë
vif
);

1380 
	`mod_timî
(&
vif
->
düg
.
rxtime_timî
,

1381 
jiffõs
 + 
	`m£cs_to_jiffõs
(1000));

1384 i‡(
düg_loˇl_ã°
 & 
WIFI_DIAG_TX_STAT_EVENTENABLE
) {

1385 
	`dñ_timî
(&
vif
->
düg
.
tx_°©_timî
);

1386 
	`öô_timî
(&
vif
->
düg
.
tx_°©_timî
);

1387 
	`£tup_timî
(&
vif
->
düg
.
tx_°©_timî
,

1388 
wifi_düg_tx_°©_timî_h™dÀr
, (Ë
vif
);

1389 
vif
->
düg
.
tx_timî_vÆ
 = 2000;

1390 
	`mod_timî
(&
vif
->
düg
.
tx_°©_timî
,

1391 
jiffõs
 + 
	`m£cs_to_jiffõs
(
vif
->
düg
.
tx_timî_vÆ
));

1394 i‡(
düg_loˇl_ã°
 & 
WIFI_DIAG_RX_STAT_EVENTENABLE
) {

1395 
	`dñ_timî
(&
vif
->
düg
.
rx_°©_timî
);

1396 
	`öô_timî
(&
vif
->
düg
.
rx_°©_timî
);

1397 
	`£tup_timî
(&
vif
->
düg
.
rx_°©_timî
,

1398 
wifi_düg_rx_°©_timî_h™dÀr
, (Ë
vif
);

1399 
vif
->
düg
.
rx_timî_vÆ
 = 2000;

1400 
	`mod_timî
(&
vif
->
düg
.
rx_°©_timî
,

1401 
jiffõs
 + 
	`m£cs_to_jiffõs
(
vif
->
düg
.
rx_timî_vÆ
));

1404 i‡((
düg_loˇl_ã°
 & 
WIFI_DIAG_MAC_TX_FRAME_EVENTENABLE
) ||

1405 (
düg_loˇl_ã°
 & 
WIFI_DIAG_MAC_RX_FRAME_EVENTENABLE
)) {

1406 i‡((
düg_loˇl_ã°
 & 0x00000200) &&

1407 (
düg_loˇl_ã°
 & 0xFFFF0000)) {

1408 
	`©h6kl_wmi_macfûãr_cmd
(
globÆwmi
,

1409 
WMI_PKTLOG_EVENT_TX
 | 
WMI_PKTLOG_EVENT_RX
,

1410 ((
düg_loˇl_ã°
 & 0xFFFF0000)>>16) &

1411 
WIFI_DIAG_MACFILTER_LOW_MASK
,

1412 
WIFI_DIAG_MACFILTER_DISABLEALL
 &

1413 
WIFI_DIAG_MACFILTER_HIGH_MASK
);

1414 } i‡((
düg_loˇl_ã°
 & 0x00000800) &&

1415 (
düg_loˇl_ã°
 & 0xFFFF0000)) {

1416 
	`©h6kl_wmi_macfûãr_cmd
(
globÆwmi
,

1417 
WMI_PKTLOG_EVENT_TX
 | 
WMI_PKTLOG_EVENT_RX
,

1418 
WIFI_DIAG_MACFILTER_DISABLEALL
 &

1419 
WIFI_DIAG_MACFILTER_LOW_MASK
,

1420 ((
düg_loˇl_ã°
 & 0xFFFF0000)>>16) &

1421 
WIFI_DIAG_MACFILTER_HIGH_MASK
);

1423 
	`©h6kl_wmi_macfûãr_cmd
(
globÆwmi
,

1424 
WMI_PKTLOG_EVENT_TX
 | 
WMI_PKTLOG_EVENT_RX
,

1425 
WIFI_DIAG_MACFILTER_ENABLEALL
 &

1426 
WIFI_DIAG_MACFILTER_LOW_MASK
,

1427 
WIFI_DIAG_MACFILTER_ENABLEALL
 &

1428 
WIFI_DIAG_MACFILTER_HIGH_MASK
);

1431 
wmi_íabÀ_pkéog_cmd
 
cmd
;

1432 
cmd
.
›ti⁄
 = 
WMI_PKTLOG_OPTION_LOG_DIAGNOSTIC
;

1433 
cmd
.
evli°
 = 
WMI_PKTLOG_EVENT_TX
 | 
WMI_PKTLOG_EVENT_RX
;

1434 
cmd
.
åiggî_öãrvÆ
 = 0;

1435 
cmd
.
åiggî_èû_cou¡
 = 0;

1436 
cmd
.
åiggî_thªsh
 = 0;

1437 
cmd
.
buf„r_size
 = 1500;

1438 
	`©h6kl_wmi_pkéog_íabÀ_cmd
(
globÆwmi
, &
cmd
);

1441 
	}
}

	@diagnose.h

17 #i‚de‡
DIAGNOSE_H


18 
	#DIAGNOSE_H


	)

21 #ifde‡
ATH6KL_DIAGNOSTIC


22 
	~<löux/exp‹t.h
>

27 
	#PKTLOG_TYPE_TXCTL
 0

	)

28 
	#PKTLOG_TYPE_TXSTATUS
 1

	)

29 
	#PKTLOG_TYPE_RX
 2

	)

31 
	#PKTLOG_MAX_TXCTL_WORDS
 13

	)

32 
	#PKTLOG_MAX_TXSTATUS_WORDS
 10

	)

34 
	#IEEE80211_FC0_TYPE_MASK
 0x0c

	)

35 
	#IEEE80211_FC0_TYPE_MGT
 0x00

	)

36 
	#IEEE80211_FC0_TYPE_CTL
 0x04

	)

37 
	#IEEE80211_FC0_TYPE_DATA
 0x08

	)

39 
	#IEEE80211_FC0_SUBTYPE_QOS
 0x80

	)

40 
	#IEEE80211_FC0_SUBTYPE_MASK
 0xf0

	)

43 
	#IEEE80211_QOS_HAS_SEQ
(
‰ame˘æ
) \

44 ((
‰ame˘æ
 & \

45 (
IEEE80211_FC0_TYPE_MASK
 | 
IEEE80211_FC0_SUBTYPE_QOS
)) == \

46 (
IEEE80211_FC0_TYPE_DATA
 | 
IEEE80211_FC0_SUBTYPE_QOS
))

	)

48 
	#IEEE80211_QOS_HEADERLEN
 26

	)

49 
	#IEEE80211_QOS_PADLEN
 2

	)

53 
	#WIFI_DIAG_MAC_TX_FILTER_CMDID
 0x0001

	)

54 
	#WIFI_DIAG_MAC_RX_FILTER_CMDID
 0x0002

	)

55 
	#WIFI_DIAG_CFG_CMDID
 0x0003

	)

58 
	#WIFI_DIAG_MACFILTER_MGT
 0x00003F3F

	)

59 
	#WIFI_DIAG_MACFILTER_CTL
 0xFF000000

	)

60 
	#WIFI_DIAG_MACFILTER_DATA
 0x0000DFFF

	)

61 
	#WIFI_DIAG_MACFILTER_LOW_MASK
 0xFF003F3F

	)

62 
	#WIFI_DIAG_MACFILTER_HIGH_MASK
 0x0000DFFF

	)

63 
	#WIFI_DIAG_MACFILTER_ENABLEALL
 0xFFFFFFFF

	)

64 
	#WIFI_DIAG_MACFILTER_DISABLEALL
 0x00000000

	)

67 
	#WIFI_DIAG_MAC_TX_FRAME_EVENTENABLE
 0x00000001

	)

68 
	#WIFI_DIAG_MAC_RX_FRAME_EVENTENABLE
 0x00000002

	)

69 
	#WIFI_DIAG_MAC_FSM_EVENTENABLE
 0x00000004

	)

70 
	#WIFI_DIAG_INTERFERENCE_EVENTENABLE
 0x00000008

	)

71 
	#WIFI_DIAG_RX_TIME_EVENTENABLE
 0x00000010

	)

72 
	#WIFI_DIAG_PWR_SAVE_EVENTENABLE
 0x00000020

	)

73 
	#WIFI_DIAG_TX_STAT_EVENTENABLE
 0x00000040

	)

74 
	#WIFI_DIAG_RX_STAT_EVENTENABLE
 0x00000080

	)

75 
	#WIFI_DIAG_BT_TIME_EVENTENABLE
 0x00000100

	)

78 
	#WHAL_RC_FLAG_SGI
 0x08

	)

79 
	#MAX11_RATE_INDEX
 43

	)

80 
	#WHAL_RXERR_CRC
 0x01

	)

82 
düg_loˇl_ã°
;

83 
wmi
 *
globÆwmi
;

85 
	s©h_pkéog_tx˘l
 {

86 
u16
 
	m‰ame˘æ
;

87 
u16
 
	m£q˘æ
;

88 
u16
 
	mbssid_èû
;

89 
u16
 
	mß_èû
;

90 
u16
 
	mda_èû
;

91 
u16
 
	mªsvd
;

92 
u32
 
	mtxdesc_˘l
[
PKTLOG_MAX_TXCTL_WORDS
];

93 
u32
 *
	m¥Ÿo_hdr
;

94 
u32
 *
	mmisc
;

95 } 
	g__∑cked
;

97 
	s©h_pkéog_tx°©us
 {

99 
u32
 
	mtxdesc_°©us
[
PKTLOG_MAX_TXSTATUS_WORDS
];

103 
u32
 
	mmisc
[3];

105 
u32
 
	mbuf_Àn
;

106 
u8
 
	mbuf
[1];

107 } 
	g__∑cked
;

109 
	#PKTLOG_MAX_RXSTATUS_WORDS
 12

	)

111 
	s©h_pkéog_rx
 {

112 
u16
 
	m‰ame˘æ
;

113 
u16
 
	m£q˘æ
;

114 
u16
 
	mbssid_èû
;

115 
u16
 
	mß_èû
;

116 
u16
 
	mda_èû
;

117 
u16
 
	mªsvd
;

118 
u32
 
	mrxdesc_°©us
[
PKTLOG_MAX_RXSTATUS_WORDS
];

119 
u32
 *
	m¥Ÿo_hdr
;

120 
u32
 *
	mmisc
;

121 
u32
 
	mrxmcs
;

122 
u32
 
	mˇlibøãdnf
;

123 
u32
 
	mrx°©us
[5];

124 
u32
 
	m£q_num
;

125 
u32
 
	mbuf_Àn
;

126 
u8
 
	mbuf
[1];

127 } 
	g__∑cked
;

131 
	s©h_pkéog_hdr
 {

132 
u32
 
	mÊags
;

133 
u16
 
	mlog_ty≥
;

134 
u16
 
	msize
;

135 
u32
 
	mtime°amp
;

136 } 
	g__∑cked
;

138 
	swhÆ_øã_code
 {

139 
u8
 
	møãCode
;

140 
u8
 
	mÊags
;

141 } 
	g__∑cked
;

146 
	srx_desc_°©us
 {

147 
u16
 
	mrsD©aLí
;

148 
u16
 
	mª£rved0
;

149 
u8
 
	mrsSètus
;

150 
u8
 
	mª£rved1
;

151 
u8
 
	mrsRssi
;

152 
u8
 
	mª£rved2
;

155 
whÆ_øã_code
 
	mrsR©e
;

156 } 
	g__∑cked
;

159 
	stx_˘æ_desc
 {

160 
u32
 
	mdsCé0
;

161 } 
	g__∑cked
;

163 
	#WHAL_TXDESC_GET_FRAME_LEN
(
x
Ë((x)->
dsCé0
 & 0xFFF)

	)

170 
	ewifi_düg_evít_id
 {

171 
	mWIFI_DIAG_MAC_TX_FRAME_EVENTID
 = 0x0001,

172 
	mWIFI_DIAG_MAC_RX_FRAME_EVENTID
,

173 
	mWIFI_DIAG_MAC_FSM_EVENTID
,

174 
	mWIFI_DIAG_INTERFERENCE_EVENTID
,

175 
	mWIFI_DIAG_RX_TIME_EVENTID
,

176 
	mWIFI_DIAG_PWR_SAVE_EVENTID
,

177 
	mWIFI_DIAG_TX_STAT_EVENTID
,

178 
	mWIFI_DIAG_RX_STAT_EVENTID
,

179 
	mWIFI_DIAG_BT_TIME_EVENTID
,

183 
	ewifi_düg_°©us_t
 {

184 
	mWIFI_DIAG_EOK
 = 0x0,

185 
	mWIFI_DIAG_ENXIO
,

186 
	mWIFI_DIAG_ENOMEM
,

187 
	mWIFI_DIAG_EINVAL
,

188 
	mWIFI_DIAG_ENOTSUPP
,

189 
	mWIFI_DIAG_EINPROGRESS
,

190 
	mWIFI_DIAG_EBUSY
,

191 
	mWIFI_DIAG_EEXIST
,

192 
	mWIFI_DIAG_ENOSPC
,

193 
	mWIFI_DIAG_ASYNC
,

197 
	swifi_düg_evít_t
 {

198 
u16
 
	mevít_id
;

199 
u16
 
	mÀn
;

200 
u32
 
	m£q_num
;

201 
u8
 
	mevít_d©a
[1];

202 } 
	g__∑cked
;

204 
	ewifi_düg_mac_fsm_t
 {

205 
	mWIFI_DIAG_MAC_FSM_SCANNING
 = 0x0,

206 
	mWIFI_DIAG_MAC_FSM_AUTH
,

207 
	mWIFI_DIAG_MAC_FSM_ASSOC
,

208 
	mWIFI_DIAG_MAC_FSM_CONNECTED
,

209 
	mWIFI_DIAG_MAC_FSM_DEAUTH
,

210 
	mWIFI_DIAG_MAC_FSM_DISASSOC
,

211 
	mWIFI_DIAG_MAC_FSM_DISCONNECTED
,

214 
	swifi_düg_mac_fsm_evít_t
 {

215 
wifi_düg_mac_fsm_t
 
	mfsm
;

216 } 
	g__∑cked
;

220 
	swifi_düg_mac_rx_‰ame_evít_t
 {

221 
u32
 
	mrssi
;

222 
u8
 
	m¢r
;

223 
u32
 
	mrx_mcs
;

224 
u32
 
	mrx_bôøã
;

225 
boﬁ
 
	mfcs
;

226 
u8
 
	m‰ame_ty≥
;

227 
u8
 
	m‰ame_sub_ty≥
;

228 
u16
 
	m‰ame_Àngth
;

229 
u8
 
	m‰ame_d©a
[1];

230 } 
	g__∑cked
;

232 
	swifi_düg_mac_tx_‰ame_evít_t
 {

233 
u32
 
	mtx_pwr
;

234 
u8
 
	mtx_mcs
;

235 
u32
 
	mtx_bôøã
;

236 
u8
 
	m‰ame_ty≥
;

237 
u8
 
	m‰ame_sub_ty≥
;

238 
u16
 
	m‰ame_Àngth
;

239 
u8
 
	m‰ame_d©a
[1];

240 } 
	g__∑cked
;

243 
	swifi_düg_tx_°©_evít_t
 {

244 
u64
 
	mtx_pkt
;

245 
u64
 
	mtx_uˇ°_pkt
;

246 
u64
 
	mtx_ªåy_˙t
;

247 
u64
 
	mtx_Áû_˙t
;

248 
u32
 
	mtx_øã_pkt
[44];

249 } 
	g__∑cked
;

251 
	swifi_düg_rx_°©_evít_t
 {

252 
u64
 
	mrx_pkt
;

253 
u64
 
	mrx_uˇ°_pkt
;

254 
u64
 
	mrx_du∂_‰ame
;

255 
u32
 
	mrx_øã_pkt
[44];

256 } 
	g__∑cked
;

259 
	swifi_düg_öãr„ªn˚_evít_t
 {

260 
u32
 
	mrx_˛ór_˙t
;

261 } 
	g__∑cked
;

264 
	swifi_düg_rxtime_evít_t
 {

265 
u32
 
	mrx_‰ame_˙t
;

266 } 
	g__∑cked
;

269 
	ewifi_düg_pwrßve_t
 {

270 
	mWIFI_DIAG_DEEPSLEEP_START
 = 0x0,

271 
	mWIFI_DIAG_DEEPSLEEP_STOP
,

272 
	mWIFI_DIAG_FAKESLEEP_START
,

273 
	mWIFI_DIAG_FAKESLEEP_STOP
,

274 
	mWIFI_DIAG_MAXPERF_START
,

275 
	mWIFI_DIAG_MAXPERF_STOP
,

278 
	swifi_düg_pwrßve_evít_t
 {

279 
wifi_düg_pwrßve_t
 
	mpwrßve
;

280 } 
	g__∑cked
;

283 
	swifi_düg_cmd_t
 {

284 
u16
 
	mcmd_id
;

285 
u16
 
	mÀn
;

286 
u8
 
	mcmd_d©a
[1];

287 } 
	g__∑cked
;

289 
	swifi_düg_mac_tx_fûãr_cmd_t
 {

290 
u32
 
	mfûãr_mask_low
;

291 
u32
 
	mfûãr_mask_high
;

292 } 
	g__∑cked
;

294 
	swifi_düg_mac_rx_fûãr_cmd_t
 {

295 
u32
 
	mfûãr_mask_low
;

296 
u32
 
	mfûãr_mask_high
;

297 } 
	g__∑cked
;

299 
	swifi_düg_cfg_cmd_t
 {

300 
u32
 
	mcfg
;

301 
u16
 
	mvÆue
;

302 } 
	g__∑cked
;

304 
	swifi_düg_ˇŒbacks
 {

305 
wifi_düg_°©us_t
 (*
düg_evít_ˇŒback
)

306 (*
	mdüg_hdl
, 
sk_buff
 *
	mskb
);

309 
	swifi_drv_hdl_li°
 {

310 * (*
	mwifi_ªgi°î
)(*
	mdüg_hdl
);

311 
wifi_düg_°©us_t
 (*
wifi_uƒegi°î
)(*
	mdrv_hdl
);

312 
wifi_düg_°©us_t
 (*
wifi_düg_ªg_evít_ˇŒback
)

313 (*
	mdrv_hdl
, 
wifi_düg_ˇŒbacks
 *
	mevt_ˇŒback
);

314 
wifi_düg_°©us_t
 (*
wifi_düg_cmd
)

315 (*
	mdrv_hdl
, 
wifi_düg_cmd_t
 *
	mcmd
);

316 } 
	g__∑cked
;

319 
	swifi_düg
 {

320 
u32
 
	mcfg_mask
;

321 
boﬁ
 
	mdüg_evít_öô
;

322 
u8
 
	mtx_‰ame_ty≥
;

323 
u8
 
	mtx_‰ame_subty≥
;

324 
u16
 
	mtx_‰ame_Àn
;

325 
u32
 
	m¥e_rx_˛ór_˙t
;

326 
u32
 
	m¥e_rx_‰ame_˙t
;

327 
u32
 
	mc⁄√˘_£q_num
;

328 
u32
 
	mdisc⁄√˘_£q_num
;

329 
timî_li°
 
	mtx_°©_timî
;

330 
timî_li°
 
	mrx_°©_timî
;

331 
timî_li°
 
	möãr„ªn˚_timî
;

332 
timî_li°
 
	mrxtime_timî
;

333 
u32
 
	mtx_timî_vÆ
;

334 
u32
 
	mrx_timî_vÆ
;

335 } 
	g__∑cked
;

339 
wifi_düg_drv_ªgi°î
(*
düg_hdl
);

340 
wifi_düg_°©us_t


341 
wifi_düg_drv_uƒegi°î
(*
drv_hdl
);

342 
wifi_düg_°©us_t
 
wifi_düg_ªgi°î_evít_ˇŒback
(*
drv_hdl
,

343 
wifi_düg_ˇŒbacks
 *
evt_ˇŒback
);

344 
wifi_düg_°©us_t
 
wifi_düg_cmd_£nd
(*
drv_hdl
,

345 
wifi_düg_cmd_t
 *
cmd
);

346 
wifi_düg_mac_tx_‰ame_evít
(
©h6kl_vif
 *
vif
,

347 
©h_pkéog_tx°©us
 *
tx°©us_log
);

348 
wifi_düg_mac_tx˘æ_evít
(
©h6kl_vif
 *
vif
,

349 
©h_pkéog_tx˘l
 *
tx˘æ_log
);

350 
wifi_düg_mac_rx_‰ame_evít
(
©h6kl_vif
 *
vif
,

351 
©h_pkéog_rx
 *
rx_log
);

352 
wifi_düg_mac_fsm_evít
(
©h6kl_vif
 *
vif
,

353 
wifi_düg_mac_fsm_t
 
evíây≥
, 
u32
 
£q_num
);

354 
wifi_düg_£nd_pwrßve_evít
(
©h6kl_vif
 *
vif
,

355 
wifi_düg_pwrßve_t
 
pwrßve
, 
u32
 
£q_num
);

356 
wifi_düg_tx_°©_timî_h™dÀr
(
±r
);

357 
wifi_düg_rx_°©_timî_h™dÀr
(
±r
);

358 
wifi_düg_öãr„ªn˚_timî_h™dÀr
(
±r
);

359 
wifi_düg_rxtime_timî_h™dÀr
(
±r
);

360 
wifi_düg_timî_de°roy
(
©h6kl_vif
 *
vif
);

361 
wifi_düg_öô
();

363 
©h6kl_wmi_°©_rx_øã_evít
(
©h6kl_vif
 *
vif
,

364 
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
, 
u32
 
£q_num
);

365 
©h6kl_wmi_°©_tx_øã_evít
(
©h6kl_vif
 *
vif
,

366 
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
, 
u32
 
£q_num
);

367 
©h6kl_wmi_öãr„ªn˚_evít
(
©h6kl_vif
 *
vif
,

368 
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
, 
u32
 
£q_num
);

369 
©h6kl_wmi_rxtime_evít
(
©h6kl_vif
 *
vif
,

370 
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
, 
u32
 
£q_num
);

371 
©h6kl_wmi_düg_evít
(
©h6kl_vif
 *
vif
,

372 
wmi
 *wmi, 
sk_buff
 *
skb
);

	@epping.h

17 #i‚de‡
EPPING_H


18 
	#EPPING_H


	)

20 
	~"htc.h
"

23 
	#EPPING_ALIGNMENT_PAD
 ((((
htc_‰ame_hdr
) + 3) & (~0x3)) \

24 - (
htc_‰ame_hdr
))

	)

26 
	#HCI_RSVD_EXPECTED_PKT_TYPE_RECV_OFFSET
 7

	)

28 
	sïpög_hódî
 {

30 
u8
 
	mhcúsvd
[8];

33 
u8
 
	m°ªam_echo_h
;

37 
u8
 
	m°ªam_echo_£¡_t
;

40 
u8
 
	m°ªam_ªcv_t
;

43 
u8
 
	m°ªam_no_h
;

46 
u8
 
	mmagic_h
[4];

51 
u8
 
	m§svd
[6];

54 
u8
 
	m∑d
[2];

57 
u8
 
	mtime_°amp
[8];

60 
u32
 
	mho°_c⁄ãxt
;

63 
u32
 
	m£q_no
;

66 
u16
 
	mcmd_id_h
;

69 
u16
 
	mcmd_Êags_h
;

72 
u8
 
	mcmd_buf„r_h
[8];

75 
u8
 
	mcmd_buf„r_t
[8];

78 
u16
 
	md©a_Àngth
;

81 
u16
 
	m¸c
;

84 
u16
 
	mhódî_¸c
;

85 } 
	g__∑cked
;

87 
	#EPPING_PING_MAGIC_0
 0xAA

	)

88 
	#EPPING_PING_MAGIC_1
 0x55

	)

89 
	#EPPING_PING_MAGIC_2
 0xCE

	)

90 
	#EPPING_PING_MAGIC_3
 0xEC

	)

92 
	#IS_EPPING_PACKET
(
pPkt
) \

93 (((
pPkt
)->
magic_h
[0] =
EPPING_PING_MAGIC_0
) && \

94 ((
pPkt
)->
magic_h
[1] =
EPPING_PING_MAGIC_1
) && \

95 ((
pPkt
)->
magic_h
[2] =
EPPING_PING_MAGIC_2
) && \

96 ((
pPkt
)->
magic_h
[3] =
EPPING_PING_MAGIC_3
))

	)

99 
	#CMD_FLAGS_DATA_CRC
 (1 << 0)

	)

102 
	#CMD_FLAGS_DELAY_ECHO
 (1 << 1)

	)

105 
	#CMD_FLAGS_NO_DROP
 (1 << 2)

	)

107 
	#IS_EPING_PACKET_NO_DROP
(
pPkt
Ë(’Pkt)->
cmd_Êags_h
 & 
CMD_FLAGS_NO_DROP
)

	)

111 
	#HCI_TRANSPORT_STREAM_NUM
 16

	)

	@hif-ops.h

17 #i‚de‡
HIF_OPS_H


18 
	#HIF_OPS_H


	)

20 
	~"hif.h
"

21 
	~"debug.h
"

23 
ölöe
 
	$hif_ªad_wrôe_sync
(
©h6kl
 *
¨
, 
u32
 
addr
, 
u8
 *
buf
,

24 
u32
 
Àn
, u32 
ªque°
)

26 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
,

28 (
ªque°
 & 
HIF_WRITE
) ? "write" : "read",

29 
addr
, 
buf
, 
Àn
, 
ªque°
);

31  
¨
->
hif_›s
->
	`ªad_wrôe_sync
◊r, 
addr
, 
buf
, 
Àn
, 
ªque°
);

32 
	}
}

34 
ölöe
 
	$hif_wrôe_async
(
©h6kl
 *
¨
, 
u32
 
addªss
, 
u8
 *
buf„r
,

35 
u32
 
Àngth
, u32 
ªque°
,

36 
htc_∑ckë
 *
∑ckë
)

38 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
,

40 
addªss
, 
buf„r
, 
Àngth
, 
ªque°
);

42  
¨
->
hif_›s
->
	`wrôe_async
◊r, 
addªss
, 
buf„r
, 
Àngth
,

43 
ªque°
, 
∑ckë
);

44 
	}
}

45 
ölöe
 
	$©h6kl_hif_úq_íabÀ
(
©h6kl
 *
¨
)

47 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hif irqÉnable\n");

49  
¨
->
hif_›s
->
	`úq_íabÀ
(ar);

50 
	}
}

52 
ölöe
 
	$©h6kl_hif_úq_dißbÀ
(
©h6kl
 *
¨
)

54 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hif irq disable\n");

56  
¨
->
hif_›s
->
	`úq_dißbÀ
(ar);

57 
	}
}

59 
ölöe
 
hif_sˇâî_ªq
 *
	$hif_sˇâî_ªq_gë
(
©h6kl
 *
¨
)

61  
¨
->
hif_›s
->
	`sˇâî_ªq_gë
(ar);

62 
	}
}

64 
ölöe
 
	$hif_sˇâî_ªq_add
(
©h6kl
 *
¨
,

65 
hif_sˇâî_ªq
 *
s_ªq
)

67  
¨
->
hif_›s
->
	`sˇâî_ªq_add
◊r, 
s_ªq
);

68 
	}
}

70 
ölöe
 
	$©h6kl_hif_íabÀ_sˇâî
(
©h6kl
 *
¨
)

72  
¨
->
hif_›s
->
	`íabÀ_sˇâî
(ar);

73 
	}
}

75 
ölöe
 
	$©h6kl_hif_sˇt_ªq_rw
(
©h6kl
 *
¨
,

76 
hif_sˇâî_ªq
 *
sˇt_ªq
)

78  
¨
->
hif_›s
->
	`sˇt_ªq_rw
◊r, 
sˇt_ªq
);

79 
	}
}

81 
ölöe
 
	$©h6kl_hif_˛ónup_sˇâî
(
©h6kl
 *
¨
)

83  
¨
->
hif_›s
->
	`˛ónup_sˇâî
(ar);

84 
	}
}

86 
ölöe
 
	$©h6kl_hif_su•íd
(
©h6kl
 *
¨
,

87 
cfg80211_wowœn
 *
wow
)

89 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hif suspend\n");

91  
¨
->
hif_›s
->
	`su•íd
◊r, 
wow
);

92 
	}
}

98 
ölöe
 
	$©h6kl_hif_düg_ªad32
(
©h6kl
 *
¨
, 
u32
 
addªss
,

99 
u32
 *
vÆue
)

101  
¨
->
hif_›s
->
	`düg_ªad32
◊r, 
addªss
, 
vÆue
);

102 
	}
}

108 
ölöe
 
	$©h6kl_hif_düg_wrôe32
(
©h6kl
 *
¨
, 
u32
 
addªss
,

109 
__À32
 
vÆue
)

111  
¨
->
hif_›s
->
	`düg_wrôe32
◊r, 
addªss
, 
vÆue
);

112 
	}
}

114 
ölöe
 
	$©h6kl_hif_bmi_ªad
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
u32
 
Àn
)

116  
¨
->
hif_›s
->
	`bmi_ªad
◊r, 
buf
, 
Àn
);

117 
	}
}

119 
ölöe
 
	$©h6kl_hif_bmi_wrôe
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
u32
 
Àn
)

121  
¨
->
hif_›s
->
	`bmi_wrôe
◊r, 
buf
, 
Àn
);

122 
	}
}

124 
ölöe
 
	$©h6kl_hif_ªsume
(
©h6kl
 *
¨
)

126 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÑesume\n");

128  
¨
->
hif_›s
->
	`ªsume
(ar);

129 
	}
}

131 
ölöe
 
	$©h6kl_hif_powî_⁄
(
©h6kl
 *
¨
)

133 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖower on\n");

135  
¨
->
hif_›s
->
	`powî_⁄
(ar);

136 
	}
}

138 
ölöe
 
	$©h6kl_hif_powî_off
(
©h6kl
 *
¨
)

140 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖower off\n");

142  
¨
->
hif_›s
->
	`powî_off
(ar);

143 
	}
}

145 
ölöe
 
	$©h6kl_hif_°›
(
©h6kl
 *
¨
)

147 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hif stop\n");

149 
¨
->
hif_›s
->
	`°›
(ar);

150 
	}
}

152 
ölöe
 
	$©h6kl_hif_°©
(
©h6kl
 *
¨
, 
u8
 *
buf
,

153 
buf_Àn
)

155  
¨
->
hif_›s
->
	`gë_°©
◊r, 
buf
, 
buf_Àn
);

156 
	}
}

158 
ölöe
 
	$©h6kl_hif_pùe_ªgi°î_ˇŒback
(
©h6kl
 *
¨
,

159 *
htc_c⁄ãxt
,

160 
©h6kl_hif_pùe_ˇŒbacks
 *
ˇŒbacks
)

162 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖipeÑegister callback\n");

164 
¨
->
hif_›s
->
	`pùe_ªgi°î_ˇŒback
◊r, 
htc_c⁄ãxt
, 
ˇŒbacks
);

165 
	}
}

167 
ölöe
 
	$©h6kl_hif_pùe_£nd_bundÀ
(
©h6kl
 *
¨
, 
u8
 
pid
,

168 
sk_buff
 **
msg_bundÀ
, 
num_msgs
)

170 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖipe send bundle\n");

172  
¨
->
hif_›s
->
	`pùe_£nd_bundÀ
◊r, 
pid
, 
msg_bundÀ
, 
num_msgs
);

173 
	}
}

175 
ölöe
 
	$©h6kl_hif_pùe_£nd
(
©h6kl
 *
¨
,

176 
u8
 
pùe
, 
sk_buff
 *
hdr_buf
, sk_buf‡*
buf
)

178 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖipe send\n");

180  
¨
->
hif_›s
->
	`pùe_£nd
◊r, 
pùe
, 
hdr_buf
, 
buf
);

181 
	}
}

183 
ölöe
 
	$©h6kl_hif_pùe_gë_deÁu…
(
©h6kl
 *
¨
,

184 
u8
 *
ul_pùe
, u8 *
dl_pùe
)

186 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖipe get default\n");

188 
¨
->
hif_›s
->
	`pùe_gë_deÁu…
◊r, 
ul_pùe
, 
dl_pùe
);

189 
	}
}

191 
ölöe
 
	$©h6kl_hif_pùe_m≠_£rvi˚
(
©h6kl
 *
¨
,

192 
u16
 
£rvi˚_id
, 
u8
 *
ul_pùe
, u8 *
dl_pùe
)

194 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖipe get default\n");

196  
¨
->
hif_›s
->
	`pùe_m≠_£rvi˚
◊r, 
£rvi˚_id
, 
ul_pùe
, 
dl_pùe
);

197 
	}
}

199 
ölöe
 
u16
 
	$©h6kl_hif_pùe_gë_‰ì_queue_numbî
(
©h6kl
 *
¨
,

200 
u8
 
pùe
)

202 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖipe get free queueÇumber\n");

204  
¨
->
hif_›s
->
	`pùe_gë_‰ì_queue_numbî
◊r, 
pùe
);

205 
	}
}

207 
ölöe
 
u16
 
	$©h6kl_hif_pùe_gë_max_queue_numbî
(
©h6kl
 *
¨
,

208 
u8
 
pùe
)

210 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖipe get max queueÇumber\n");

212  
¨
->
hif_›s
->
	`pùe_gë_max_queue_numbî
◊r, 
pùe
);

213 
	}
}

215 
ölöe
 
u16
 
	$©h6kl_hif_pùe_£t_max_sche
(
©h6kl
 *
¨
,

216 
u32
 
max_sche_tx
, u32 
max_sche_rx
)

218 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖipe set max scheduledÖackages\n");

220  
¨
->
hif_›s
->
	`pùe_£t_max_sche
◊r, 
max_sche_tx
, 
max_sche_rx
);

221 
	}
}

223 
ölöe
 
	$©h6kl_hif_düg_w¨m_ª£t
(
©h6kl
 *
¨
)

225 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hif diag warmÑeset\n");

227  
¨
->
hif_›s
->
	`düg_w¨m_ª£t
(ar);

228 
	}
}

230 #ifde‡
CONFIG_HAS_EARLYSUSPEND


231 
ölöe
 
	$©h6kl_hif_óæy_su•íd
(
©h6kl
 *
¨
)

233 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÉarly_suspend\n");

235 
¨
->
hif_›s
->
	`óæy_su•íd
(ar);

236 
	}
}

237 
ölöe
 
	$©h6kl_hif_œã_ªsume
(
©h6kl
 *
¨
)

239 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÜate_resume\n");

241 
¨
->
hif_›s
->
	`œã_ªsume
(ar);

242 
	}
}

245 
ölöe
 
	$©h6kl_hif_bus_c⁄fig
(
©h6kl
 *
¨
)

247 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hif buf config\n");

249  
¨
->
hif_›s
->
	`bus_c⁄fig
(ar);

250 
	}
}

252 #ifde‡
USB_AUTO_SUSPEND


253 
ölöe
 
	$©h6kl_hif_auto_pm_dißbÀ
(
©h6kl
 *
¨
)

255 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifáth6kl_hif_auto_pm_disable\n");

257 
¨
->
hif_›s
->
	`auto_pm_dißbÀ
(ar);

258 
	}
}

260 
ölöe
 
	$©h6kl_hif_auto_pm_íabÀ
(
©h6kl
 *
¨
)

262 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifáth6kl_hif_auto_pm_enable\n");

264 
¨
->
hif_›s
->
	`auto_pm_íabÀ
(ar);

265 
	}
}

267 
ölöe
 
	$©h6kl_hif_auto_pm_tu∫⁄
(
©h6kl
 *
¨
)

269 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifáth6kl_hif_auto_pm_turnon\n");

270 
¨
->
hif_›s
->
	`auto_pm_tu∫⁄
(ar);

271 
	}
}

273 
ölöe
 
	$©h6kl_hif_auto_pm_tu∫off
(
©h6kl
 *
¨
)

275 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifáth6kl_hif_auto_pm_turnoff\n");

276 
¨
->
hif_›s
->
	`auto_pm_tu∫off
(ar);

277 
	}
}

279 
ölöe
 
	$©h6kl_hif_auto_pm_gë_ußge_˙t
(
©h6kl
 *
¨
)

281 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifáuto_pm_get_usage_cnt\n");

283  
¨
->
hif_›s
->
	`auto_pm_gë_ußge_˙t
(ar);

284 
	}
}

287 
ölöe
 
u16
 
	$©h6kl_hif_pùe_£t_rxq_thªshﬁd
(
©h6kl
 *
¨
,

288 
u32
 
rxq_thªshﬁd
)

290 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÖipe set RX queueÅhreshold\n");

292  
¨
->
hif_›s
->
	`pùe_£t_rxq_thªshﬁd
◊r, 
rxq_thªshﬁd
);

293 
	}
}

295 #ifde‡
ATH6KL_HSIC_RECOVER


296 
ölöe
 
	$©h6kl_hif_sw_ªcovî
(
©h6kl
 *
¨
)

298 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hif start swÑecover\n");

300  
¨
->
hif_›s
->
	`sw_ªcovî
(ar);

301 
	}
}

	@hif.c

16 
	~"hif.h
"

18 
	~"c‹e.h
"

19 
	~"èrgë.h
"

20 
	~"hif-›s.h
"

21 
	~"debug.h
"

23 
	#MAILBOX_FOR_BLOCK_SIZE
 1

	)

25 
	#ATH6KL_TIME_QUANTUM
 10

	)

27 
	$©h6kl_hif_˝_sˇt_dma_buf
(
hif_sˇâî_ªq
 *
ªq
,

28 
boﬁ
 
‰om_dma
)

30 
u8
 *
buf
;

31 
i
;

33 
buf
 = 
ªq
->
vút_dma_buf
;

35 
i
 = 0; i < 
ªq
->
sˇt_íåõs
; i++) {

37 i‡(
‰om_dma
)

38 
	`mem˝y
(
ªq
->
sˇt_li°
[
i
].
buf
, buf,

39 
ªq
->
sˇt_li°
[
i
].
Àn
);

41 
	`mem˝y
(
buf
, 
ªq
->
sˇt_li°
[
i
].buf,

42 
ªq
->
sˇt_li°
[
i
].
Àn
);

44 
buf
 +
ªq
->
sˇt_li°
[
i
].
Àn
;

48 
	}
}

50 
	$©h6kl_hif_rw_comp_h™dÀr
(*
c⁄ãxt
, 
°©us
)

52 
htc_∑ckë
 *
∑ckë
 = 
c⁄ãxt
;

54 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÑw completionÖkt 0x%p status %d\n",

55 
∑ckë
, 
°©us
);

57 
∑ckë
->
°©us
 = status;

58 
∑ckë
->
	`com∂ëi⁄
’ackë->
c⁄ãxt
,Öacket);

61 
	}
}

62 
	#REG_DUMP_COUNT_AR6003
 60

	)

63 
	#REGISTER_DUMP_LEN_MAX
 60

	)

64 
	#REG_DUMP_COUNT_AR6004
 60

	)

66 
	$©h6kl_hif_dump_fw_¸ash
(
©h6kl
 *
¨
)

68 
__À32
 
ªgdump_vÆ
[
REGISTER_DUMP_LEN_MAX
];

69 
u32
 
i
, 
addªss
, 
ªgdump_addr
 = 0;

70 
ªt
;

71 
dumpcou¡
 = 
REG_DUMP_COUNT_AR6004
;

73 i‡(
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6003
 &&

74 
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6004
)

77 
¨
->
èrgë_ty≥
) {

78 
TARGET_TYPE_AR6003
:

79 
dumpcou¡
 = 
REG_DUMP_COUNT_AR6003
;

81 
TARGET_TYPE_AR6004
:

83 
dumpcou¡
 = 
REG_DUMP_COUNT_AR6004
;

88 
addªss
 = 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_Áûuª_°©e
));

89 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
,áddress);

92 
ªt
 = 
	`©h6kl_düg_ªad32
(
¨
, 
addªss
, &
ªgdump_addr
);

94 i‡(
ªt
 || !
ªgdump_addr
) {

95 
	`©h6kl_w¨n
("failedÅo getÖtrÅoÑegister dumpárea: %d\n",

96 
ªt
);

100 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
, "register dump dataáddress 0x%x\n",

101 
ªgdump_addr
);

102 
ªgdump_addr
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
,Ñegdump_addr);

105 
ªt
 = 
	`©h6kl_düg_ªad
(
¨
, 
ªgdump_addr
, (
u8
 *)&
ªgdump_vÆ
[0],

106 
dumpcou¡
 * ((
u32
)));

107 i‡(
ªt
) {

108 
	`©h6kl_w¨n
("ÁûedÅÿgëÑegi°î dump: %d\n", 
ªt
);

112 
	`©h6kl_öfo
("crash dump:\n");

113 
	`©h6kl_öfo
("hw 0x%x fw %s\n", 
¨
->
wùhy
->
hw_vîsi⁄
,

114 
¨
->
wùhy
->
fw_vîsi⁄
);

116 
	`BUILD_BUG_ON
(
REG_DUMP_COUNT_AR6004
 % 4);

118 
i
 = 0; i < 
dumpcou¡
 / 4; i++) {

119 
	`©h6kl_öfo
("%d: 0x%8.8x 0x%8.8x 0x%8.8x 0x%8.8x\n",

120 4 * 
i
,

121 
	`À32_to_˝u
(
ªgdump_vÆ
[
i
]),

122 
	`À32_to_˝u
(
ªgdump_vÆ
[
i
 + 1]),

123 
	`À32_to_˝u
(
ªgdump_vÆ
[
i
 + 2]),

124 
	`À32_to_˝u
(
ªgdump_vÆ
[
i
 + 3]));

127 
	}
}

129 
	$©h6kl_hif_¥oc_dbg_öå
(
©h6kl_devi˚
 *
dev
)

131 
u32
 
dummy
;

132 
ªt
;

134 
	`©h6kl_w¨n
("firmware crashed\n");

140 
ªt
 = 
	`hif_ªad_wrôe_sync
(
dev
->
¨
, 
COUNT_DEC_ADDRESS
,

141 (
u8
 *)&
dummy
, 4, 
HIF_RD_SYNC_BYTE_INC
);

142 i‡(
ªt
)

143 
	`©h6kl_w¨n
("FaûedÅÿ˛ó∏debug i¡îru±: %d\n", 
ªt
);

145 
	`©h6kl_hif_dump_fw_¸ash
(
dev
->
¨
);

147 
	`©h6kl_fw_¸ash_å≠
(
dev
->
¨
);

149  
ªt
;

150 
	}
}

153 
	$©h6kl_hif_pﬁl_mboxmsg_rx
(
©h6kl_devi˚
 *
dev
, 
u32
 *
lk_ahd
,

154 
timeout
)

156 
©h6kl_úq_¥oc_ªgi°îs
 *
rg
;

157 
°©us
 = 0, 
i
;

158 
u8
 
htc_mbox
 = 1 << 
HTC_MAILBOX
;

160 
i
 = 
timeout
 / 
ATH6KL_TIME_QUANTUM
; i > 0; i--) {

162 
°©us
 = 
	`hif_ªad_wrôe_sync
(
dev
->
¨
, 
HOST_INT_STATUS_ADDRESS
,

163 (
u8
 *Ë&
dev
->
úq_¥oc_ªg
,

164 (
dev
->
úq_¥oc_ªg
),

165 
HIF_RD_SYNC_BYTE_INC
);

167 i‡(
°©us
) {

168 
	`©h6kl_îr
("failedÅoÑeadÑegÅable\n");

169  
°©us
;

173 i‡(
dev
->
úq_¥oc_ªg
.
ho°_öt_°©us
 & 
htc_mbox
) {

174 i‡(
dev
->
úq_¥oc_ªg
.
rx_lkahd_vÆid
 &

175 
htc_mbox
) {

180 
rg
 = &
dev
->
úq_¥oc_ªg
;

181 *
lk_ahd
 =

182 
	`À32_to_˝u
(
rg
->
rx_lkahd
[
HTC_MAILBOX
]);

188 
	`mdñay
(
ATH6KL_TIME_QUANTUM
);

189 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hi‡ªåy mboxÖﬁ»åy %d\n", 
i
);

192 i‡(
i
 == 0) {

193 
	`©h6kl_îr
("timeout waiting forÑecv message\n");

194 
°©us
 = -
ETIME
;

196 i‡(
dev
->
úq_¥oc_ªg
.
cou¡î_öt_°©us
 &

197 
ATH6KL_TARGET_DEBUG_INTR_MASK
)

202 
	`©h6kl_hif_¥oc_dbg_öå
(
dev
);

205  
°©us
;

206 
	}
}

212 
	$©h6kl_hif_rx_c⁄åﬁ
(
©h6kl_devi˚
 *
dev
, 
boﬁ
 
íabÀ_rx
)

214 
©h6kl_úq_íabÀ_ªg
 
ªgs
;

215 
°©us
 = 0;

217 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hifÑx %s\n",

218 
íabÀ_rx
 ? "enable" : "disable");

221 
	`•ö_lock_bh
(&
dev
->
lock
);

223 i‡(
íabÀ_rx
)

224 
dev
->
úq_í_ªg
.
öt_°©us_í
 |=

225 
	`SM
(
INT_STATUS_ENABLE_MBOX_DATA
, 0x01);

227 
dev
->
úq_í_ªg
.
öt_°©us_í
 &=

228 ~
	`SM
(
INT_STATUS_ENABLE_MBOX_DATA
, 0x01);

230 
	`mem˝y
(&
ªgs
, &
dev
->
úq_í_ªg
, (regs));

232 
	`•ö_u∆ock_bh
(&
dev
->
lock
);

234 
°©us
 = 
	`hif_ªad_wrôe_sync
(
dev
->
¨
, 
INT_STATUS_ENABLE_ADDRESS
,

235 &
ªgs
.
öt_°©us_í
,

236 (
©h6kl_úq_íabÀ_ªg
),

237 
HIF_WR_SYNC_BYTE_INC
);

239  
°©us
;

240 
	}
}

242 
	$©h6kl_hif_submô_sˇt_ªq
(
©h6kl_devi˚
 *
dev
,

243 
hif_sˇâî_ªq
 *
sˇt_ªq
, 
boﬁ
 
ªad
)

245 
°©us
 = 0;

247 i‡(
ªad
) {

248 
sˇt_ªq
->
ªq
 = 
HIF_RD_SYNC_BLOCK_FIX
;

249 
sˇt_ªq
->
addr
 = 
dev
->
¨
->
mbox_öfo
.
htc_addr
;

251 
sˇt_ªq
->
ªq
 = 
HIF_WR_ASYNC_BLOCK_INC
;

253 
sˇt_ªq
->
addr
 =

254 (
sˇt_ªq
->
Àn
 > 
HIF_MBOX_WIDTH
) ?

255 
dev
->
¨
->
mbox_öfo
.
htc_ext_addr
 :

256 
dev
->
¨
->
mbox_öfo
.
htc_addr
;

259 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
,

261 
sˇt_ªq
->
sˇt_íåõs
, sˇt_ªq->
Àn
,

262 
sˇt_ªq
->
addr
, !
ªad
 ? "async" : "sync",

263 (
ªad
) ? "rd" : "wr");

265 i‡(!
ªad
 && 
sˇt_ªq
->
vút_sˇt
) {

266 
°©us
 = 
	`©h6kl_hif_˝_sˇt_dma_buf
(
sˇt_ªq
, 
Ál£
);

267 i‡(
°©us
) {

268 
sˇt_ªq
->
°©us
 = status;

269 
sˇt_ªq
->
	`com∂ëe
(
dev
->
¨
->
htc_èrgë
, scat_req);

274 
°©us
 = 
	`©h6kl_hif_sˇt_ªq_rw
(
dev
->
¨
, 
sˇt_ªq
);

276 i‡(
ªad
) {

278 
sˇt_ªq
->
°©us
 = status;

279 i‡(!
°©us
 && 
sˇt_ªq
->
vút_sˇt
)

280 
sˇt_ªq
->
°©us
 =

281 
	`©h6kl_hif_˝_sˇt_dma_buf
(
sˇt_ªq
, 
åue
);

284  
°©us
;

285 
	}
}

287 
	$©h6kl_hif_¥oc_cou¡î_öå
(
©h6kl_devi˚
 *
dev
)

289 
u8
 
cou¡î_öt_°©us
;

291 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
, "counter interrupt\n");

293 
cou¡î_öt_°©us
 = 
dev
->
úq_¥oc_ªg
.counter_int_status &

294 
dev
->
úq_í_ªg
.
˙å_öt_°©us_í
;

296 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
,

298 
cou¡î_öt_°©us
);

305 i‡(
cou¡î_öt_°©us
 & 
ATH6KL_TARGET_DEBUG_INTR_MASK
)

306  
	`©h6kl_hif_¥oc_dbg_öå
(
dev
);

309 
	}
}

311 
	$©h6kl_hif_¥oc_îr_öå
(
©h6kl_devi˚
 *
dev
)

313 
°©us
;

314 
u8
 
îr‹_öt_°©us
;

315 
u8
 
ªg_buf
[4];

317 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
, "error interrupt\n");

319 
îr‹_öt_°©us
 = 
dev
->
úq_¥oc_ªg
.error_int_status & 0x0F;

320 i‡(!
îr‹_öt_°©us
) {

321 
	`WARN_ON
(1);

322  -
EIO
;

325 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
,

327 
îr‹_öt_°©us
);

329 i‡(
	`MS
(
ERROR_INT_STATUS_WAKEUP
, 
îr‹_öt_°©us
))

330 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
, "error : wakeup\n");

332 i‡(
	`MS
(
ERROR_INT_STATUS_RX_UNDERFLOW
, 
îr‹_öt_°©us
))

333 
	`©h6kl_îr
("rx underflow\n");

335 i‡(
	`MS
(
ERROR_INT_STATUS_TX_OVERFLOW
, 
îr‹_öt_°©us
))

336 
	`©h6kl_îr
("tx overflow\n");

339 
dev
->
úq_¥oc_ªg
.
îr‹_öt_°©us
 &= ~error_int_status;

342 
ªg_buf
[0] = 
îr‹_öt_°©us
;

343 
ªg_buf
[1] = 0;

344 
ªg_buf
[2] = 0;

345 
ªg_buf
[3] = 0;

347 
°©us
 = 
	`hif_ªad_wrôe_sync
(
dev
->
¨
, 
ERROR_INT_STATUS_ADDRESS
,

348 
ªg_buf
, 4, 
HIF_WR_SYNC_BYTE_FIX
);

350 i‡(
°©us
)

351 
	`WARN_ON
(1);

353  
°©us
;

354 
	}
}

356 
	$©h6kl_hif_¥oc_˝u_öå
(
©h6kl_devi˚
 *
dev
)

358 
°©us
;

359 
u8
 
˝u_öt_°©us
;

360 
u8
 
ªg_buf
[4];

362 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
, "cpu interrupt\n");

364 
˝u_öt_°©us
 = 
dev
->
úq_¥oc_ªg
.cpu_int_status &

365 
dev
->
úq_í_ªg
.
˝u_öt_°©us_í
;

366 i‡(!
˝u_öt_°©us
) {

367 
	`WARN_ON
(1);

368  -
EIO
;

371 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
,

373 
˝u_öt_°©us
);

376 
dev
->
úq_¥oc_ªg
.
˝u_öt_°©us
 &= ~cpu_int_status;

386 
ªg_buf
[0] = 
˝u_öt_°©us
;

388 
ªg_buf
[1] = 0;

389 
ªg_buf
[2] = 0;

390 
ªg_buf
[3] = 0;

392 
°©us
 = 
	`hif_ªad_wrôe_sync
(
dev
->
¨
, 
CPU_INT_STATUS_ADDRESS
,

393 
ªg_buf
, 4, 
HIF_WR_SYNC_BYTE_FIX
);

395 i‡(
°©us
)

396 
	`WARN_ON
(1);

398  
°©us
;

399 
	}
}

402 
	$¥oc_≥ndög_úqs
(
©h6kl_devi˚
 *
dev
, 
boﬁ
 *
d⁄e
)

404 
©h6kl_úq_¥oc_ªgi°îs
 *
rg
;

405 
°©us
 = 0;

406 
u8
 
ho°_öt_°©us
 = 0;

407 
u32
 
lk_ahd
 = 0;

408 
u8
 
htc_mbox
 = 1 << 
HTC_MAILBOX
;

410 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
, "¥oc_≥ndög_úqs: (dev: 0x%p)\n", 
dev
);

424 i‡(
dev
->
úq_í_ªg
.
öt_°©us_í
) {

440 
°©us
 = 
	`hif_ªad_wrôe_sync
(
dev
->
¨
, 
HOST_INT_STATUS_ADDRESS
,

441 (
u8
 *Ë&
dev
->
úq_¥oc_ªg
,

442 (
dev
->
úq_¥oc_ªg
),

443 
HIF_RD_SYNC_BYTE_INC
);

444 i‡(
°©us
)

445 
out
;

447 i‡(
	`AR_DBG_LVL_CHECK
(
ATH6KL_DBG_IRQ
))

448 
	`©h6kl_dump_ªgi°îs
(
dev
, &dev->
úq_¥oc_ªg
,

449 &
dev
->
úq_í_ªg
);

452 
ho°_öt_°©us
 = 
dev
->
úq_¥oc_ªg
.host_int_status &

453 
dev
->
úq_í_ªg
.
öt_°©us_í
;

456 i‡(
ho°_öt_°©us
 & 
htc_mbox
) {

461 
ho°_öt_°©us
 &~
htc_mbox
;

462 i‡(
dev
->
úq_¥oc_ªg
.
rx_lkahd_vÆid
 &

463 
htc_mbox
) {

464 
rg
 = &
dev
->
úq_¥oc_ªg
;

465 
lk_ahd
 = 
	`À32_to_˝u
(
rg
->
rx_lkahd
[
HTC_MAILBOX
]);

466 i‡(!
lk_ahd
)

467 
	`©h6kl_îr
("lookAhead is zero!\n");

472 i‡(!
ho°_öt_°©us
 && !
lk_ahd
) {

473 *
d⁄e
 = 
åue
;

474 
out
;

477 i‡(
lk_ahd
) {

478 
„tched
 = 0;

480 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
,

481 "≥ndög maûbox msg,Ük_ahd: 0x%X\n", 
lk_ahd
);

490 
°©us
 = 
	`©h6kl_htc_rxmsg_≥ndög_h™dÀr
(
dev
->
htc_˙xt
,

491 
lk_ahd
, &
„tched
);

492 i‡(
°©us
)

493 
out
;

495 i‡(!
„tched
)

500 
dev
->
htc_˙xt
->
chk_úq_°©us_˙t
 = 0;

504 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
,

506 
ho°_öt_°©us
);

508 i‡(
	`MS
(
HOST_INT_STATUS_CPU
, 
ho°_öt_°©us
)) {

510 
°©us
 = 
	`©h6kl_hif_¥oc_˝u_öå
(
dev
);

511 i‡(
°©us
)

512 
out
;

515 i‡(
	`MS
(
HOST_INT_STATUS_ERROR
, 
ho°_öt_°©us
)) {

517 
°©us
 = 
	`©h6kl_hif_¥oc_îr_öå
(
dev
);

518 i‡(
°©us
)

519 
out
;

522 i‡(
	`MS
(
HOST_INT_STATUS_COUNTER
, 
ho°_öt_°©us
))

524 
°©us
 = 
	`©h6kl_hif_¥oc_cou¡î_öå
(
dev
);

526 
out
:

527 #ifde‡
BYPASS_IRQ_RECHECK


541 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
,

544 i‡(!
dev
->
htc_˙xt
->
chk_úq_°©us_˙t
)

545 *
d⁄e
 = 
åue
;

559 
	`©h6kl_dbg
(
ATH6KL_DBG_IRQ
,

560 "¥oc_≥ndög_úqs: (d⁄e:%d, sètus=%d\n", *
d⁄e
, 
°©us
);

562  
°©us
;

563 
	}
}

566 
	$©h6kl_hif_öå_bh_h™dÀr
(
©h6kl
 *
¨
)

568 
©h6kl_devi˚
 *
dev
 = 
¨
->
htc_èrgë
->dev;

569 
timeout
;

570 
°©us
 = 0;

571 
boﬁ
 
d⁄e
 = 
Ál£
;

577 
dev
->
htc_˙xt
->
chk_úq_°©us_˙t
 = 0;

583 
timeout
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
ATH6KL_HIF_COMMUNICATION_TIMEOUT
);

584 
	`time_bef‹e
(
jiffõs
, 
timeout
Ë&& !
d⁄e
) {

585 
°©us
 = 
	`¥oc_≥ndög_úqs
(
dev
, &
d⁄e
);

586 i‡(
°©us
)

590  
°©us
;

591 
	}
}

593 
	$©h6kl_hif_íabÀ_öås
(
©h6kl_devi˚
 *
dev
)

595 
©h6kl_úq_íabÀ_ªg
 
ªgs
;

596 
°©us
;

598 
	`•ö_lock_bh
(&
dev
->
lock
);

601 
dev
->
úq_í_ªg
.
öt_°©us_í
 =

602 
	`SM
(
INT_STATUS_ENABLE_ERROR
, 0x01) |

603 
	`SM
(
INT_STATUS_ENABLE_CPU
, 0x01) |

604 
	`SM
(
INT_STATUS_ENABLE_COUNTER
, 0x01);

610 
dev
->
úq_í_ªg
.
öt_°©us_í
 |
	`SM
(
INT_STATUS_ENABLE_MBOX_DATA
, 0x01);

613 
dev
->
úq_í_ªg
.
˝u_öt_°©us_í
 = 0;

616 
dev
->
úq_í_ªg
.
îr_öt_°©us_í
 =

617 
	`SM
(
ERROR_STATUS_ENABLE_RX_UNDERFLOW
, 0x01) |

618 
	`SM
(
ERROR_STATUS_ENABLE_TX_OVERFLOW
, 0x1);

624 
dev
->
úq_í_ªg
.
˙å_öt_°©us_í
 = 
	`SM
(
COUNTER_INT_STATUS_ENABLE_BIT
,

625 
ATH6KL_TARGET_DEBUG_INTR_MASK
);

626 
	`mem˝y
(&
ªgs
, &
dev
->
úq_í_ªg
, (regs));

628 
	`•ö_u∆ock_bh
(&
dev
->
lock
);

630 
°©us
 = 
	`hif_ªad_wrôe_sync
(
dev
->
¨
, 
INT_STATUS_ENABLE_ADDRESS
,

631 &
ªgs
.
öt_°©us_í
, (regs),

632 
HIF_WR_SYNC_BYTE_INC
);

634 i‡(
°©us
)

635 
	`©h6kl_îr
("failedÅo update interrupt ctlÑegÉrr: %d\n",

636 
°©us
);

638  
°©us
;

639 
	}
}

641 
	$©h6kl_hif_dißbÀ_öås
(
©h6kl_devi˚
 *
dev
)

643 
©h6kl_úq_íabÀ_ªg
 
ªgs
;

645 
	`•ö_lock_bh
(&
dev
->
lock
);

647 
dev
->
úq_í_ªg
.
öt_°©us_í
 = 0;

648 
dev
->
úq_í_ªg
.
˝u_öt_°©us_í
 = 0;

649 
dev
->
úq_í_ªg
.
îr_öt_°©us_í
 = 0;

650 
dev
->
úq_í_ªg
.
˙å_öt_°©us_í
 = 0;

651 
	`mem˝y
(&
ªgs
, &
dev
->
úq_í_ªg
, (regs));

652 
	`•ö_u∆ock_bh
(&
dev
->
lock
);

654  
	`hif_ªad_wrôe_sync
(
dev
->
¨
, 
INT_STATUS_ENABLE_ADDRESS
,

655 &
ªgs
.
öt_°©us_í
, (regs),

656 
HIF_WR_SYNC_BYTE_INC
);

657 
	}
}

660 
	$©h6kl_hif_unmask_öås
(
©h6kl_devi˚
 *
dev
)

662 
°©us
 = 0;

672 
	`©h6kl_hif_dißbÀ_öås
(
dev
);

675 
	`©h6kl_hif_úq_íabÀ
(
dev
->
¨
);

676 
°©us
 = 
	`©h6kl_hif_íabÀ_öås
(
dev
);

678  
°©us
;

679 
	}
}

682 
	$©h6kl_hif_mask_öås
(
©h6kl_devi˚
 *
dev
)

689 
	`©h6kl_hif_úq_dißbÀ
(
dev
->
¨
);

691  
	`©h6kl_hif_dißbÀ_öås
(
dev
);

692 
	}
}

694 
	$©h6kl_hif_£tup
(
©h6kl_devi˚
 *
dev
)

696 
°©us
 = 0;

698 
	`•ö_lock_öô
(&
dev
->
lock
);

705 
dev
->
htc_˙xt
->
block_sz
 = dev->
¨
->
mbox_öfo
.
block_size
;

708 i‡((
dev
->
htc_˙xt
->
block_sz
 & (dev->htc_cnxt->block_sz - 1)) != 0) {

709 
	`WARN_ON
(1);

710 
°©us
 = -
EINVAL
;

711 
Áû_£tup
;

715 
dev
->
htc_˙xt
->
block_mask
 = dev->htc_˙xt->
block_sz
 - 1;

717 
	`©h6kl_dbg
(
ATH6KL_DBG_HIF
, "hif block size %d mboxáddr 0x%x\n",

718 
dev
->
htc_˙xt
->
block_sz
, dev->
¨
->
mbox_öfo
.
htc_addr
);

722 i‡(
dev
->
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_USB
)

725 
°©us
 = 
	`©h6kl_hif_dißbÀ_öås
(
dev
);

727 
Áû_£tup
:

728  
°©us
;

730 
	}
}

	@hif.h

17 #i‚de‡
HIF_H


18 
	#HIF_H


	)

20 
	~"comm⁄.h
"

21 
	~"c‹e.h
"

23 
	~<löux/sˇâîli°.h
>

25 
	#BUS_REQUEST_MAX_NUM
 64

	)

26 
	#HIF_MBOX_BLOCK_SIZE
 128

	)

27 
	#HIF_MBOX0_BLOCK_SIZE
 1

	)

29 
	#HIF_DMA_BUFFER_SIZE
 (32 * 1024)

	)

30 
	#CMD53_FIXED_ADDRESS
 1

	)

31 
	#CMD53_INCR_ADDRESS
 2

	)

33 
	#MAX_SCATTER_REQUESTS
 4

	)

34 
	#MAX_SCATTER_ENTRIES_PER_REQ
 16

	)

35 
	#MAX_SCATTER_REQ_TRANSFER_SIZE
 (32 * 1024)

	)

37 
	#MANUFACTURER_ID_AR6003_BASE
 0x300

	)

38 
	#MANUFACTURER_ID_AR6004_BASE
 0x400

	)

40 
	#MANUFACTURER_ID_AR6006_BASE
 0xD00

	)

42 
	#MANUFACTURER_ID_ATH6KL_BASE_MASK
 0xFF00

	)

43 
	#MANUFACTURER_CODE
 0x271

	)

46 
	#HIF_MBOX_BASE_ADDR
 0x800

	)

47 
	#HIF_MBOX_WIDTH
 0x800

	)

49 
	#HIF_MBOX_END_ADDR
 (
HTC_MAILBOX_NUM_MAX
 * 
HIF_MBOX_WIDTH
 - 1)

	)

52 
	#HIF_MBOX0_EXT_BASE_ADDR
 0x4000

	)

53 
	#HIF_MBOX0_EXT_WIDTH
 (12*1024)

	)

56 
	#HIF_GMBOX_BASE_ADDR
 0x7000

	)

57 
	#HIF_GMBOX_WIDTH
 0x4000

	)

60 
	#CCCR_SDIO_IRQ_MODE_REG
 0xF0

	)

63 
	#SDIO_IRQ_MODE_ASYNC_4BIT_IRQ
 (1 << 0)

	)

66 
	#HTC_MAILBOX
 0

	)

68 
	#ATH6KL_TARGET_DEBUG_INTR_MASK
 0x01

	)

71 
	#ATH6KL_SCATTER_ENTRIES_PER_REQ
 16

	)

72 
	#ATH6KL_MAX_TRANSFER_SIZE_PER_SCATTER
 (16 * 1024)

	)

73 
	#ATH6KL_SCATTER_REQS
 4

	)

75 
	#ATH6KL_HIF_COMMUNICATION_TIMEOUT
 1000

	)

77 
	sbus_ªque°
 {

78 
li°_hód
 
	mli°
;

81 
u32
 
	maddªss
;

83 
u8
 *
	mbuf„r
;

84 
u32
 
	mÀngth
;

85 
u32
 
	mªque°
;

86 
htc_∑ckë
 *
	m∑ckë
;

87 
	m°©us
;

90 
hif_sˇâî_ªq
 *
	msˇt_ªq
;

94 
	#HIF_READ
 0x00000001

	)

95 
	#HIF_WRITE
 0x00000002

	)

96 
	#HIF_DIR_MASK
 (
HIF_READ
 | 
HIF_WRITE
)

	)

109 
	#HIF_SYNCHRONOUS
 0x00000010

	)

110 
	#HIF_ASYNCHRONOUS
 0x00000020

	)

111 
	#HIF_EMODE_MASK
 (
HIF_SYNCHRONOUS
 | 
HIF_ASYNCHRONOUS
)

	)

123 
	#HIF_BYTE_BASIS
 0x00000040

	)

124 
	#HIF_BLOCK_BASIS
 0x00000080

	)

125 
	#HIF_DMODE_MASK
 (
HIF_BYTE_BASIS
 | 
HIF_BLOCK_BASIS
)

	)

132 
	#HIF_FIXED_ADDRESS
 0x00000100

	)

133 
	#HIF_INCREMENTAL_ADDRESS
 0x00000200

	)

134 
	#HIF_AMODE_MASK
 (
HIF_FIXED_ADDRESS
 | 
HIF_INCREMENTAL_ADDRESS
)

	)

136 
	#HIF_WR_ASYNC_BYTE_INC
 \

137 (
HIF_WRITE
 | 
HIF_ASYNCHRONOUS
 | \

138 
HIF_BYTE_BASIS
 | 
HIF_INCREMENTAL_ADDRESS
)

	)

140 
	#HIF_WR_ASYNC_BLOCK_INC
 \

141 (
HIF_WRITE
 | 
HIF_ASYNCHRONOUS
 | \

142 
HIF_BLOCK_BASIS
 | 
HIF_INCREMENTAL_ADDRESS
)

	)

144 
	#HIF_WR_SYNC_BYTE_FIX
 \

145 (
HIF_WRITE
 | 
HIF_SYNCHRONOUS
 | \

146 
HIF_BYTE_BASIS
 | 
HIF_FIXED_ADDRESS
)

	)

148 
	#HIF_WR_SYNC_BYTE_INC
 \

149 (
HIF_WRITE
 | 
HIF_SYNCHRONOUS
 | \

150 
HIF_BYTE_BASIS
 | 
HIF_INCREMENTAL_ADDRESS
)

	)

152 
	#HIF_WR_SYNC_BLOCK_INC
 \

153 (
HIF_WRITE
 | 
HIF_SYNCHRONOUS
 | \

154 
HIF_BLOCK_BASIS
 | 
HIF_INCREMENTAL_ADDRESS
)

	)

156 
	#HIF_RD_SYNC_BYTE_INC
 \

157 (
HIF_READ
 | 
HIF_SYNCHRONOUS
 | \

158 
HIF_BYTE_BASIS
 | 
HIF_INCREMENTAL_ADDRESS
)

	)

160 
	#HIF_RD_SYNC_BYTE_FIX
 \

161 (
HIF_READ
 | 
HIF_SYNCHRONOUS
 | \

162 
HIF_BYTE_BASIS
 | 
HIF_FIXED_ADDRESS
)

	)

164 
	#HIF_RD_ASYNC_BLOCK_FIX
 \

165 (
HIF_READ
 | 
HIF_ASYNCHRONOUS
 | \

166 
HIF_BLOCK_BASIS
 | 
HIF_FIXED_ADDRESS
)

	)

168 
	#HIF_RD_SYNC_BLOCK_FIX
 \

169 (
HIF_READ
 | 
HIF_SYNCHRONOUS
 | \

170 
HIF_BLOCK_BASIS
 | 
HIF_FIXED_ADDRESS
)

	)

172 
	shif_sˇâî_ôem
 {

173 
u8
 *
	mbuf
;

174 
	mÀn
;

175 
htc_∑ckë
 *
	m∑ckë
;

178 
	shif_sˇâî_ªq
 {

179 
li°_hód
 
	mli°
;

181 
u32
 
	maddr
;

184 
u32
 
	mªq
;

187 
u32
 
	mÀn
;

189 
boﬁ
 
	mvút_sˇt
;

191 (*
	mcom∂ëe
Ë(
	mhtc_èrgë
 *, 
	mhif_sˇâî_ªq
 *);

192 
	m°©us
;

193 
	msˇt_íåõs
;

195 
bus_ªque°
 *
	mbu§eque°
;

196 
sˇâîli°
 *
	msgíåõs
;

199 
u8
 *
	mvút_dma_buf
;

201 
u32
 
	msˇt_q_dïth
;

203 
hif_sˇâî_ôem
 
	msˇt_li°
[1];

206 
	s©h6kl_úq_¥oc_ªgi°îs
 {

207 
u8
 
	mho°_öt_°©us
;

208 
u8
 
	m˝u_öt_°©us
;

209 
u8
 
	mîr‹_öt_°©us
;

210 
u8
 
	mcou¡î_öt_°©us
;

211 
u8
 
	mmbox_‰ame
;

212 
u8
 
	mrx_lkahd_vÆid
;

213 
u8
 
	mho°_öt_°©us2
;

214 
u8
 
	mgmbox_rx_avaû
;

215 
__À32
 
	mrx_lkahd
[2];

216 
__À32
 
	mrx_gmbox_lkahd_Æüs
[2];

217 } 
	g__∑cked
;

219 
	s©h6kl_úq_íabÀ_ªg
 {

220 
u8
 
	möt_°©us_í
;

221 
u8
 
	m˝u_öt_°©us_í
;

222 
u8
 
	mîr_öt_°©us_í
;

223 
u8
 
	m˙å_öt_°©us_í
;

224 } 
	g__∑cked
;

229 
	s©h6kl_hif_pùe_ˇŒbacks
 {

230 (*
	mtx_com∂ëi⁄
Ë(
htc_èrgë
 *
	mc⁄ãxt
, 
sk_buff
 * 
	mskb
);

231 (*
	mrx_com∂ëi⁄
Ë(
htc_èrgë
 *
	mc⁄ãxt
,

232 
sk_buff
 *
	mskb
, 
u8
 
	mpùe
);

233 (*
	mtx_ªsour˚_avaûabÀ
Ë(
htc_èrgë
 *
	mc⁄ãxt
, 
u8
 
	mpùe
);

236 
	s©h6kl_devi˚
 {

237 
•ölock_t
 
	mlock
;

238 
©h6kl_úq_¥oc_ªgi°îs
 
	múq_¥oc_ªg
;

239 
©h6kl_úq_íabÀ_ªg
 
	múq_í_ªg
;

240 
htc_èrgë
 *
	mhtc_˙xt
;

241 
©h6kl
 *
	m¨
;

244 
	s©h6kl_hif_›s
 {

245 (*
	mªad_wrôe_sync
)(
©h6kl
 *
	m¨
, 
u32
 
	maddr
, 
u8
 *
	mbuf
,

246 
u32
 
	mÀn
, u32 
	mªque°
);

247 (*
	mwrôe_async
)(
©h6kl
 *
	m¨
, 
u32
 
	maddªss
, 
u8
 *
	mbuf„r
,

248 
u32
 
	mÀngth
, u32 
	mªque°
, 
htc_∑ckë
 *
	m∑ckë
);

250 (*
	múq_íabÀ
)(
©h6kl
 *
	m¨
);

251 (*
	múq_dißbÀ
)(
©h6kl
 *
	m¨
);

253 
	mhif_sˇâî_ªq
 *(*
	msˇâî_ªq_gë
)(
©h6kl
 *
	m¨
);

254 (*
	msˇâî_ªq_add
)(
©h6kl
 *
	m¨
,

255 
hif_sˇâî_ªq
 *
	ms_ªq
);

256 (*
	míabÀ_sˇâî
)(
©h6kl
 *
	m¨
);

257 (*
	msˇt_ªq_rw
Ë(
©h6kl
 *
	m¨
,

258 
hif_sˇâî_ªq
 *
	msˇt_ªq
);

259 (*
	m˛ónup_sˇâî
)(
©h6kl
 *
	m¨
);

260 (*
	msu•íd
)(
©h6kl
 *
	m¨
, 
cfg80211_wowœn
 *
	mwow
);

261 (*
	mªsume
)(
©h6kl
 *
	m¨
);

262 (*
	mdüg_ªad32
)(
©h6kl
 *
	m¨
, 
u32
 
	maddªss
, u32 *
	mvÆue
);

263 (*
	mdüg_wrôe32
)(
©h6kl
 *
	m¨
, 
u32
 
	maddªss
, 
__À32
 
	mvÆue
);

264 (*
	mbmi_ªad
)(
©h6kl
 *
	m¨
, 
u8
 *
	mbuf
, 
u32
 
	mÀn
);

265 (*
	mbmi_wrôe
)(
©h6kl
 *
	m¨
, 
u8
 *
	mbuf
, 
u32
 
	mÀn
);

266 (*
	mpowî_⁄
)(
©h6kl
 *
	m¨
);

267 (*
	mpowî_off
)(
©h6kl
 *
	m¨
);

268 (*
	m°›
)(
©h6kl
 *
	m¨
);

269 (*
	mgë_°©
)(
©h6kl
 *
	m¨
, 
u8
 *
	mbuf
, 
	mbuf_Àn
);

270 (*
	mpùe_ªgi°î_ˇŒback
)(
©h6kl
 *
	m¨
,

271 *
	mhtc_c⁄ãxt
, 
©h6kl_hif_pùe_ˇŒbacks
 *
	mˇŒbacks
);

272 (*
	mpùe_£nd
)(
©h6kl
 *
	m¨
, 
u8
 
	mpùe
, 
sk_buff
 *
	mhdr_buf
,

273 
sk_buff
 *
	mbuf
);

274 (*
	mpùe_gë_deÁu…
)(
©h6kl
 *
	m¨
, 
u8
 *
	mpùe_ul
, u8 *
	mpùe_dl
);

275 (*
	mpùe_m≠_£rvi˚
)(
©h6kl
 *
	m¨
, 
u16
 
	m£rvi˚_id
, 
u8
 *
	mpùe_ul
,

276 
u8
 *
	mpùe_dl
);

277 
u16
 (*
pùe_gë_‰ì_queue_numbî
)(
©h6kl
 *
	m¨
, 
u8
 
	mpùe
);

278 (*
	mpùe_£nd_bundÀ
)(
©h6kl
 *
	m¨
, 
u8
 
	mpid
,

279 
sk_buff
 **
	mmsg_bundÀ
, 
	mnum_msgs
);

280 
u16
 (*
pùe_gë_max_queue_numbî
)(
©h6kl
 *
	m¨
, 
u8
 
	mpùe
);

281 (*
	mpùe_£t_max_sche
)(
©h6kl
 *
	m¨
, 
u32
 
	mmax_sche_tx
,

282 
u32
 
	mmax_sche_rx
);

283 (*
	mdüg_w¨m_ª£t
)(
©h6kl
 *
	m¨
);

284 #ifde‡
CONFIG_HAS_EARLYSUSPEND


285 (*
	móæy_su•íd
)(
©h6kl
 *
	m¨
);

286 (*
	mœã_ªsume
)(
©h6kl
 *
	m¨
);

288 (*
	mbus_c⁄fig
)(
©h6kl
 *
	m¨
);

290 #ifde‡
USB_AUTO_SUSPEND


291 (*
	mauto_pm_gë_ußge_˙t
)(
©h6kl
 *
	m¨
);

292 (*
	mauto_pm_dißbÀ
)(
©h6kl
 *
	m¨
);

293 (*
	mauto_pm_íabÀ
)(
©h6kl
 *
	m¨
);

294 (*
	mauto_pm_tu∫⁄
)(
©h6kl
 *
	m¨
);

295 (*
	mauto_pm_tu∫off
)(
©h6kl
 *
	m¨
);

297 (*
	mpùe_£t_rxq_thªshﬁd
)(
©h6kl
 *
	m¨
, 
u32
 
	mrxq_thªshﬁd
);

298 #ifde‡
ATH6KL_HSIC_RECOVER


299 (*
	msw_ªcovî
)(
©h6kl
 *
	m¨
);

303 
©h6kl_hif_£tup
(
©h6kl_devi˚
 *
dev
);

304 
©h6kl_hif_unmask_öås
(
©h6kl_devi˚
 *
dev
);

305 
©h6kl_hif_mask_öås
(
©h6kl_devi˚
 *
dev
);

306 
©h6kl_hif_pﬁl_mboxmsg_rx
(
©h6kl_devi˚
 *
dev
,

307 
u32
 *
lk_ahd
, 
timeout
);

308 
©h6kl_hif_rx_c⁄åﬁ
(
©h6kl_devi˚
 *
dev
, 
boﬁ
 
íabÀ_rx
);

309 
©h6kl_hif_dißbÀ_öås
(
©h6kl_devi˚
 *
dev
);

311 
©h6kl_hif_rw_comp_h™dÀr
(*
c⁄ãxt
, 
°©us
);

312 
©h6kl_hif_öå_bh_h™dÀr
(
©h6kl
 *
¨
);

315 
©h6kl_hif_submô_sˇt_ªq
(
©h6kl_devi˚
 *
dev
,

316 
hif_sˇâî_ªq
 *
sˇt_ªq
, 
boﬁ
 
ªad
);

	@htc-ops.h

17 #i‚de‡
HTC_OPS_H


18 
	#HTC_OPS_H


	)

20 
	~"htc.h
"

21 
	~"debug.h
"

23 
ölöe
 *
	$©h6kl_htc_¸óã
(
©h6kl
 *
¨
)

25  
¨
->
htc_›s
->
	`¸óã
(ar);

26 
	}
}

28 
ölöe
 
	$©h6kl_htc_waô_èrgë
(
htc_èrgë
 *
èrgë
)

30  
èrgë
->
dev
->
¨
->
htc_›s
->
	`waô_èrgë
(target);

31 
	}
}

33 
ölöe
 
	$©h6kl_htc_°¨t
(
htc_èrgë
 *
èrgë
)

35  
èrgë
->
dev
->
¨
->
htc_›s
->
	`°¨t
(target);

36 
	}
}

38 
ölöe
 
	$©h6kl_htc_c⁄n_£rvi˚
(
htc_èrgë
 *
èrgë
,

39 
htc_£rvi˚_c⁄√˘_ªq
 *
ªq
,

40 
htc_£rvi˚_c⁄√˘_ª•
 *
ª•
)

42  
èrgë
->
dev
->
¨
->
htc_›s
->
	`c⁄n_£rvi˚
—¨gë, 
ªq
, 
ª•
);

43 
	}
}

45 
ölöe
 
	$©h6kl_htc_tx
(
htc_èrgë
 *
èrgë
,

46 
htc_∑ckë
 *
∑ckë
)

48  
èrgë
->
dev
->
¨
->
htc_›s
->
	`tx
—¨gë, 
∑ckë
);

49 
	}
}

51 
ölöe
 
	$©h6kl_htc_°›
(
htc_èrgë
 *
èrgë
)

53  
èrgë
->
dev
->
¨
->
htc_›s
->
	`°›
(target);

54 
	}
}

56 
ölöe
 
	$©h6kl_htc_˛ónup
(
htc_èrgë
 *
èrgë
)

58  
èrgë
->
dev
->
¨
->
htc_›s
->
	`˛ónup
(target);

59 
	}
}

61 
ölöe
 
	$©h6kl_htc_Êush_txï
(
htc_èrgë
 *
èrgë
,

62 
htc_ídpoöt_id
 
ídpoöt
, 
u16
 
èg
)

64  
èrgë
->
dev
->
¨
->
htc_›s
->
	`Êush_txï
—¨gë, 
ídpoöt
, 
èg
);

65 
	}
}

67 
ölöe
 
	$©h6kl_htc_Êush_rx_buf
(
htc_èrgë
 *
èrgë
)

69  
èrgë
->
dev
->
¨
->
htc_›s
->
	`Êush_rx_buf
(target);

70 
	}
}

72 
ölöe
 
	$©h6kl_htc_ödiˇã_a˘ivôy_ch™ge
(

73 
htc_èrgë
 *
èrgë
, 
htc_ídpoöt_id
 
ídpoöt
, 
boﬁ
 
a˘ive
)

75  
èrgë
->
dev
->
¨
->
htc_›s
->
	`ödiˇã_a˘ivôy_ch™ge
(target,

76 
ídpoöt
, 
a˘ive
);

77 
	}
}

79 
ölöe
 
	$©h6kl_htc_gë_rxbuf_num
(
htc_èrgë
 *
èrgë
,

80 
htc_ídpoöt_id
 
ídpoöt
)

82  
èrgë
->
dev
->
¨
->
htc_›s
->
	`gë_rxbuf_num
—¨gë, 
ídpoöt
);

83 
	}
}

85 
ölöe
 
	$©h6kl_htc_add_rxbuf_mu…ùÀ
(
htc_èrgë
 *
èrgë
,

86 
li°_hód
 *
pktq
)

88  
èrgë
->
dev
->
¨
->
htc_›s
->
	`add_rxbuf_mu…ùÀ
—¨gë, 
pktq
);

89 
	}
}

91 
ölöe
 
	$©h6kl_htc_¸edô_£tup
(
htc_èrgë
 *
èrgë
,

92 
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
)

94  
èrgë
->
dev
->
¨
->
htc_›s
->
	`¸edô_£tup
—¨gë, 
¸ed_öfo
);

95 
	}
}

97 
ölöe
 
	$©h6kl_htc_°©
(
htc_èrgë
 *
èrgë
,

98 
u8
 *
buf
, 
buf_Àn
)

100  
èrgë
->
dev
->
¨
->
htc_›s
->
	`gë_°©
—¨gë, 
buf
, 
buf_Àn
);

101 
	}
}

103 
ölöe
 
	$©h6kl_htc_°›_√tif_queue_fuŒ
(
htc_èrgë
 *
èrgë
)

105  
èrgë
->
dev
->
¨
->
htc_›s
->
	`°›_√tif_queue_fuŒ
(target);

106 
	}
}

108 
ölöe
 
	$©h6kl_htc_wmm_scheduÀ_ch™ge
(
htc_èrgë
 *
èrgë
,

109 
boﬁ
 
ch™ge
)

111  
èrgë
->
dev
->
¨
->
htc_›s
->
	`ödiˇã_wmm_scheduÀ_ch™ge
(target,

112 
ch™ge
);

113 
	}
}

115 
ölöe
 
	$©h6kl_htc_ch™ge_¸edô_by∑ss
(
htc_èrgë
 *
èrgë
,

116 
u8
 
åaffic_˛ass
)

118  
èrgë
->
dev
->
¨
->
htc_›s
->
	`ch™ge_¸edô_by∑ss
(target,

119 
åaffic_˛ass
);

120 
	}
}

	@htc.c

17 
	~"c‹e.h
"

18 
	~"hif.h
"

19 
	~"debug.h
"

20 
	~"hif-›s.h
"

21 
	~<asm/u«lig√d.h
>

23 
	#CALC_TXRX_PADDED_LEN
(
dev
, 
Àn
Ë(
	`__ALIGN_MASK
(÷í), (dev)->
block_mask
))

	)

26 
	#TX_RESUME_BUNDLE_THRESHOLD
 1500

	)

28 
©h6kl_htc_mbox_˛ónup
(
htc_èrgë
 *
èrgë
);

29 
©h6kl_htc_mbox_°›
(
htc_èrgë
 *
èrgë
);

30 
©h6kl_htc_mbox_add_rxbuf_mu…ùÀ
(
htc_èrgë
 *
èrgë
,

31 
li°_hód
 *
pkt_queue
);

32 
©h6kl_htc_£t_¸edô_di°
(
htc_èrgë
 *
èrgë
,

33 
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
,

34 
u16
 
svc_¥i_‹dî
[], 
Àn
);

37 
	$©h6kl_¸edô_dïosô
(
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
,

38 
htc_ídpoöt_¸edô_di°
 *
ï_di°
,

39 
¸edôs
)

41 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, "credit depositÉp %d credits %d\n",

42 
ï_di°
->
ídpoöt
, 
¸edôs
);

44 
ï_di°
->
¸edôs
 += credits;

45 
ï_di°
->
¸ed_as¢gd
 +
¸edôs
;

46 
¸ed_öfo
->
cur_‰ì_¸edôs
 -
¸edôs
;

47 
	}
}

49 
	$©h6kl_¸edô_öô
(
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
,

50 
li°_hód
 *
ï_li°
,

51 
tŸ_¸edôs
)

53 
htc_ídpoöt_¸edô_di°
 *
cur_ï_di°
;

54 
cou¡
;

56 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, "¸edô inôÅŸÆ %d\n", 
tŸ_¸edôs
);

58 
¸ed_öfo
->
cur_‰ì_¸edôs
 = 
tŸ_¸edôs
;

59 
¸ed_öfo
->
tŸÆ_avaû_¸edôs
 = 
tŸ_¸edôs
;

61 
	`li°_f‹_óch_íåy
(
cur_ï_di°
, 
ï_li°
, 
li°
) {

62 i‡(
cur_ï_di°
->
ídpoöt
 =
ENDPOINT_0
)

65 
cur_ï_di°
->
¸ed_mö
 = cur_ï_di°->
¸ed_≥r_msg
;

67 i‡(
tŸ_¸edôs
 > 4) {

68 i‡((
cur_ï_di°
->
svc_id
 =
WMI_DATA_BK_SVC
) ||

69 (
cur_ï_di°
->
svc_id
 =
WMI_DATA_BE_SVC
)) {

70 
	`©h6kl_¸edô_dïosô
(
¸ed_öfo
,

71 
cur_ï_di°
,

72 
cur_ï_di°
->
¸ed_mö
);

73 
cur_ï_di°
->
di°_Êags
 |
HTC_EP_ACTIVE
;

77 i‡(
cur_ï_di°
->
svc_id
 =
WMI_CONTROL_SVC
) {

78 
	`©h6kl_¸edô_dïosô
(
¸ed_öfo
, 
cur_ï_di°
,

79 
cur_ï_di°
->
¸ed_mö
);

84 
cur_ï_di°
->
di°_Êags
 |
HTC_EP_ACTIVE
;

102 
¸ed_öfo
->
lowe°¥i_ï_di°
 = 
cur_ï_di°
->
li°
;

104 
	`WARN_ON
(
¸ed_öfo
->
cur_‰ì_¸edôs
 <= 0);

106 
	`li°_f‹_óch_íåy
(
cur_ï_di°
, 
ï_li°
, 
li°
) {

107 i‡(
cur_ï_di°
->
ídpoöt
 =
ENDPOINT_0
)

110 i‡(
cur_ï_di°
->
svc_id
 =
WMI_CONTROL_SVC
)

111 
cur_ï_di°
->
¸ed_n‹m
 = cur_ï_di°->
¸ed_≥r_msg
;

121 
cou¡
 = (
¸ed_öfo
->
cur_‰ì_¸edôs
 /

122 
cur_ï_di°
->
¸ed_≥r_msg
)

123 * 
cur_ï_di°
->
¸ed_≥r_msg
;

124 
cou¡
 = (count * 3) >> 2;

125 
cou¡
 = 
	`max
(cou¡, 
cur_ï_di°
->
¸ed_≥r_msg
);

126 
cur_ï_di°
->
¸ed_n‹m
 = 
cou¡
;

130 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
,

132 
cur_ï_di°
->
ídpoöt
,

133 
cur_ï_di°
->
svc_id
,

134 
cur_ï_di°
->
¸edôs
,

135 
cur_ï_di°
->
¸ed_≥r_msg
,

136 
cur_ï_di°
->
¸ed_n‹m
,

137 
cur_ï_di°
->
¸ed_mö
);

139 
	}
}

142 
	$©h6kl_htc_mbox_¸edô_£tup
(
htc_èrgë
 *htc_target,

143 
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
)

145 
u16
 
£rvi˚¥i‹ôy
[5];

147 
	`mem£t
(
¸ed_öfo
, 0, (
©h6kl_htc_¸edô_öfo
));

149 
£rvi˚¥i‹ôy
[0] = 
WMI_CONTROL_SVC
;

150 
£rvi˚¥i‹ôy
[1] = 
WMI_DATA_VO_SVC
;

151 
£rvi˚¥i‹ôy
[2] = 
WMI_DATA_VI_SVC
;

152 
£rvi˚¥i‹ôy
[3] = 
WMI_DATA_BE_SVC
;

153 
£rvi˚¥i‹ôy
[4] = 
WMI_DATA_BK_SVC
;

156 
	`©h6kl_htc_£t_¸edô_di°
(
htc_èrgë
, 
¸ed_öfo
, 
£rvi˚¥i‹ôy
, 5);

159 
	}
}

162 
	$©h6kl_¸edô_ªdu˚
(
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
,

163 
htc_ídpoöt_¸edô_di°
 *
ï_di°
,

164 
limô
)

166 
¸edôs
;

168 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, "creditÑeduceÉp %dÜimit %d\n",

169 
ï_di°
->
ídpoöt
, 
limô
);

171 
ï_di°
->
¸ed_as¢gd
 = 
limô
;

173 i‡(
ï_di°
->
¸edôs
 <
limô
)

176 
¸edôs
 = 
ï_di°
->¸edô†- 
limô
;

177 
ï_di°
->
¸edôs
 -= credits;

178 
¸ed_öfo
->
cur_‰ì_¸edôs
 +
¸edôs
;

179 
	}
}

181 
	$©h6kl_¸edô_upd©e
(
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
,

182 
li°_hód
 *
ïdi°_li°
)

184 
htc_ídpoöt_¸edô_di°
 *
cur_di°_li°
;

186 
	`li°_f‹_óch_íåy
(
cur_di°_li°
, 
ïdi°_li°
, 
li°
) {

187 i‡(
cur_di°_li°
->
ídpoöt
 =
ENDPOINT_0
)

190 i‡(
cur_di°_li°
->
¸ed_to_di°
 > 0) {

191 
cur_di°_li°
->
¸edôs
 +=

192 
cur_di°_li°
->
¸ed_to_di°
;

193 
cur_di°_li°
->
¸ed_to_di°
 = 0;

194 i‡(
cur_di°_li°
->
¸edôs
 >

195 
cur_di°_li°
->
¸ed_as¢gd
)

196 
	`©h6kl_¸edô_ªdu˚
(
¸ed_öfo
,

197 
cur_di°_li°
,

198 
cur_di°_li°
->
¸ed_as¢gd
);

200 i‡(
cur_di°_li°
->
¸edôs
 >

201 
cur_di°_li°
->
¸ed_n‹m
)

202 
	`©h6kl_¸edô_ªdu˚
(
¸ed_öfo
, 
cur_di°_li°
,

203 
cur_di°_li°
->
¸ed_n‹m
);

205 i‡(!(
cur_di°_li°
->
di°_Êags
 & 
HTC_EP_ACTIVE
)) {

206 i‡(
cur_di°_li°
->
txq_dïth
 == 0)

207 
	`©h6kl_¸edô_ªdu˚
(
¸ed_öfo
,

208 
cur_di°_li°
, 0);

212 
	}
}

218 
	$©h6kl_¸edô_£ek
(
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
,

219 
htc_ídpoöt_¸edô_di°
 *
ï_di°
)

221 
htc_ídpoöt_¸edô_di°
 *
curdi°_li°
;

222 
¸edôs
 = 0;

223 
√ed
;

225 i‡(
ï_di°
->
svc_id
 =
WMI_CONTROL_SVC
)

226 
out
;

233 i‡(
ï_di°
->
svc_id
 =
WMI_DATA_VI_SVC
) {

234 i‡(
ï_di°
->
¸ed_Æloc_max
 != 0) {

235 i‡(
ï_di°
->
¸ed_as¢gd
 >ï_di°->
¸ed_Æloc_max
)

236 
out
;

239 i‡((
ï_di°
->
¸ed_as¢gd
 >ï_di°->
¸ed_n‹m
))

240 
out
;

250 
¸edôs
 = 
	`mö
(
¸ed_öfo
->
cur_‰ì_¸edôs
, 
ï_di°
->
£ek_¸ed
);

252 i‡(
¸edôs
 >
ï_di°
->
£ek_¸ed
)

253 
out
;

265 
	`li°_f‹_óch_íåy_ªvî£
(
curdi°_li°
,

266 &
¸ed_öfo
->
lowe°¥i_ï_di°
,

267 
li°
) {

268 i‡(
curdi°_li°
 =
ï_di°
)

271 
√ed
 = 
ï_di°
->
£ek_¸ed
 - 
¸ed_öfo
->
cur_‰ì_¸edôs
;

273 i‡((
curdi°_li°
->
¸ed_as¢gd
 - 
√ed
) >=

274 
curdi°_li°
->
¸ed_mö
) {

281 
	`©h6kl_¸edô_ªdu˚
(
¸ed_öfo
, 
curdi°_li°
,

282 
curdi°_li°
->
¸ed_as¢gd
 - 
√ed
);

284 i‡(
¸ed_öfo
->
cur_‰ì_¸edôs
 >=

285 
ï_di°
->
£ek_¸ed
)

289 i‡(
curdi°_li°
->
ídpoöt
 =
ENDPOINT_0
)

293 
¸edôs
 = 
	`mö
(
¸ed_öfo
->
cur_‰ì_¸edôs
, 
ï_di°
->
£ek_¸ed
);

295 
out
:

297 i‡(
¸edôs
)

298 
	`©h6kl_¸edô_dïosô
(
¸ed_öfo
, 
ï_di°
, 
¸edôs
);

300 
ï_di°
->
£ek_¸ed
 = 0;

301 
	}
}

304 
	$©h6kl_¸edô_ªdi°ribuã
(
©h6kl_htc_¸edô_öfo
 *
öfo
,

305 
li°_hód
 *
ï_di°_li°
)

307 
htc_ídpoöt_¸edô_di°
 *
curdi°_li°
;

309 
	`li°_f‹_óch_íåy
(
curdi°_li°
, 
ï_di°_li°
, 
li°
) {

310 i‡(
curdi°_li°
->
ídpoöt
 =
ENDPOINT_0
)

313 i‡((
curdi°_li°
->
svc_id
 =
WMI_DATA_BK_SVC
) ||

314 (
curdi°_li°
->
svc_id
 =
WMI_DATA_BE_SVC
))

315 
curdi°_li°
->
di°_Êags
 |
HTC_EP_ACTIVE
;

317 i‡((
curdi°_li°
->
svc_id
 !
WMI_CONTROL_SVC
) &&

318 !(
curdi°_li°
->
di°_Êags
 & 
HTC_EP_ACTIVE
)) {

319 i‡(
curdi°_li°
->
txq_dïth
 == 0)

320 
	`©h6kl_¸edô_ªdu˚
(
öfo
, 
curdi°_li°
, 0);

322 
	`©h6kl_¸edô_ªdu˚
(
öfo
,

323 
curdi°_li°
,

324 
curdi°_li°
->
¸ed_mö
);

327 
	}
}

337 
	$©h6kl_¸edô_di°ribuã
(
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
,

338 
li°_hód
 *
ï_di°_li°
,

339 
htc_¸edô_di°_ªas⁄
 
ªas⁄
)

341 
ªas⁄
) {

342 
HTC_CREDIT_DIST_SEND_COMPLETE
:

343 
	`©h6kl_¸edô_upd©e
(
¸ed_öfo
, 
ï_di°_li°
);

345 
HTC_CREDIT_DIST_ACTIVITY_CHANGE
:

346 
	`©h6kl_¸edô_ªdi°ribuã
(
¸ed_öfo
, 
ï_di°_li°
);

352 
	`WARN_ON
(
¸ed_öfo
->
cur_‰ì_¸edôs
 > cªd_öfo->
tŸÆ_avaû_¸edôs
);

353 
	`WARN_ON
(
¸ed_öfo
->
cur_‰ì_¸edôs
 < 0);

354 
	}
}

356 
	$©h6kl_htc_tx_buf_Æign
(
u8
 **
buf
, 
Àn
)

358 
u8
 *
Æign_addr
;

360 i‡(!
	`IS_ALIGNED
((Ë*
buf
, 4)) {

361 
Æign_addr
 = 
	`PTR_ALIGN
(*
buf
 - 4, 4);

362 
	`memmove
(
Æign_addr
, *
buf
, 
Àn
);

363 *
buf
 = 
Æign_addr
;

365 
	}
}

367 
	$©h6kl_htc_tx_¥ï_pkt
(
htc_∑ckë
 *
∑ckë
, 
u8
 
Êags
,

368 
˘æ0
, 
˘æ1
)

370 
htc_‰ame_hdr
 *
hdr
;

372 
∑ckë
->
buf
 -
HTC_HDR_LENGTH
;

373 
hdr
 = (
htc_‰ame_hdr
 *)
∑ckë
->
buf
;

376 
	`put_u«lig√d
((
u16
)
∑ckë
->
a˘_Àn
, &
hdr
->
∑yld_Àn
);

377 
hdr
->
∑yld_Àn
 = 
	`˝u_to_À16
(hdr->payld_len);

378 
hdr
->
Êags
 = flags;

379 
hdr
->
eid
 = 
∑ckë
->
ídpoöt
;

380 
hdr
->
˘æ
[0] = 
˘æ0
;

381 
hdr
->
˘æ
[1] = 
˘æ1
;

382 
	}
}

384 
	$htc_ª˛aim_tx˘æ_buf
(
htc_èrgë
 *
èrgë
,

385 
htc_∑ckë
 *
pkt
)

387 
	`•ö_lock_bh
(&
èrgë
->
htc_lock
);

388 
	`li°_add_èû
(&
pkt
->
li°
, &
èrgë
->
‰ì_˘æ_txbuf
);

389 
	`•ö_u∆ock_bh
(&
èrgë
->
htc_lock
);

390 
	}
}

392 
htc_∑ckë
 *
	$htc_gë_c⁄åﬁ_buf
(
htc_èrgë
 *
èrgë
,

393 
boﬁ
 
tx
)

395 
htc_∑ckë
 *
∑ckë
 = 
NULL
;

396 
li°_hód
 *
buf_li°
;

398 
buf_li°
 = 
tx
 ? &
èrgë
->
‰ì_˘æ_txbuf
 : &èrgë->
‰ì_˘æ_rxbuf
;

400 
	`•ö_lock_bh
(&
èrgë
->
htc_lock
);

402 i‡(
	`li°_em±y
(
buf_li°
)) {

403 
	`•ö_u∆ock_bh
(&
èrgë
->
htc_lock
);

404  
NULL
;

407 
∑ckë
 = 
	`li°_fú°_íåy
(
buf_li°
, 
htc_∑ckë
, 
li°
);

408 
	`li°_dñ
(&
∑ckë
->
li°
);

409 
	`•ö_u∆ock_bh
(&
èrgë
->
htc_lock
);

411 i‡(
tx
)

412 
∑ckë
->
buf
 =Öackë->
buf_°¨t
 + 
HTC_HDR_LENGTH
;

414  
∑ckë
;

415 
	}
}

417 
	$htc_tx_comp_upd©e
(
htc_èrgë
 *
èrgë
,

418 
htc_ídpoöt
 *
ídpoöt
,

419 
htc_∑ckë
 *
∑ckë
)

421 
∑ckë
->
com∂ëi⁄
 = 
NULL
;

422 
∑ckë
->
buf
 +
HTC_HDR_LENGTH
;

424 i‡(!
∑ckë
->
°©us
)

427 
	`©h6kl_îr
("req failed (status:%d,Ép:%d,Üen:%d creds:%d)\n",

428 
∑ckë
->
°©us
,Öackë->
ídpoöt
,Öackë->
a˘_Àn
,

429 
∑ckë
->
öfo
.
tx
.
¸ed_u£d
);

432 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

433 
ídpoöt
->
¸ed_di°
.
¸ed_to_di°
 +=

434 
∑ckë
->
öfo
.
tx
.
¸ed_u£d
;

435 
ídpoöt
->
¸ed_di°
.
txq_dïth
 = 
	`gë_queue_dïth
(&ídpoöt->
txq
);

437 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "htcÅx ctxt 0x%p dist 0x%p\n",

438 
èrgë
->
¸edô_öfo
, &èrgë->
¸ed_di°_li°
);

440 
	`©h6kl_¸edô_di°ribuã
(
èrgë
->
¸edô_öfo
,

441 &
èrgë
->
¸ed_di°_li°
,

442 
HTC_CREDIT_DIST_SEND_COMPLETE
);

444 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

445 
	}
}

447 
	$htc_tx_com∂ëe
(
htc_ídpoöt
 *
ídpoöt
,

448 
li°_hód
 *
txq
)

450 i‡(
	`li°_em±y
(
txq
))

453 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

455 
ídpoöt
->
eid
, 
	`gë_queue_dïth
(
txq
));

457 
	`©h6kl_tx_com∂ëe
(
ídpoöt
->
èrgë
, 
txq
);

458 
	}
}

460 
	$htc_tx_comp_h™dÀr
(
htc_èrgë
 *
èrgë
,

461 
htc_∑ckë
 *
∑ckë
)

463 
htc_ídpoöt
 *
ídpoöt
 = &
èrgë
->ídpoöt[
∑ckë
->endpoint];

464 
li°_hód
 
c⁄èöî
;

466 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "htcÅx complete seqno %d\n",

467 
∑ckë
->
öfo
.
tx
.
£qno
);

469 
	`htc_tx_comp_upd©e
(
èrgë
, 
ídpoöt
, 
∑ckë
);

470 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

471 
	`li°_add_èû
(&
∑ckë
->
li°
, &
c⁄èöî
);

473 
	`htc_tx_com∂ëe
(
ídpoöt
, &
c⁄èöî
);

474 
	}
}

476 
	$htc_async_tx_sˇt_com∂ëe
(
htc_èrgë
 *
èrgë
,

477 
hif_sˇâî_ªq
 *
sˇt_ªq
)

479 
htc_ídpoöt
 *
ídpoöt
;

480 
htc_∑ckë
 *
∑ckë
;

481 
li°_hód
 
tx_compq
;

482 
i
;

484 
	`INIT_LIST_HEAD
(&
tx_compq
);

486 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

488 
sˇt_ªq
->
Àn
, sˇt_ªq->
sˇt_íåõs
);

490 i‡(
sˇt_ªq
->
°©us
)

491 
	`©h6kl_îr
("£nd sˇâîÑeq faûed: %d\n", 
sˇt_ªq
->
°©us
);

493 
∑ckë
 = 
sˇt_ªq
->
sˇt_li°
[0].packet;

494 
ídpoöt
 = &
èrgë
->ídpoöt[
∑ckë
->endpoint];

497 
i
 = 0; i < 
sˇt_ªq
->
sˇt_íåõs
; i++) {

498 
∑ckë
 = 
sˇt_ªq
->
sˇt_li°
[
i
].packet;

499 i‡(!
∑ckë
) {

500 
	`WARN_ON
(1);

504 
∑ckë
->
°©us
 = 
sˇt_ªq
->status;

505 
	`htc_tx_comp_upd©e
(
èrgë
, 
ídpoöt
, 
∑ckë
);

506 
	`li°_add_èû
(&
∑ckë
->
li°
, &
tx_compq
);

510 
	`hif_sˇâî_ªq_add
(
èrgë
->
dev
->
¨
, 
sˇt_ªq
);

513 
	`htc_tx_com∂ëe
(
ídpoöt
, &
tx_compq
);

514 
	}
}

516 
	$©h6kl_htc_tx_issue
(
htc_èrgë
 *
èrgë
,

517 
htc_∑ckë
 *
∑ckë
)

519 
°©us
;

520 
boﬁ
 
sync
 = 
Ál£
;

521 
u32
 
∑dded_Àn
, 
£nd_Àn
;

523 i‡(!
∑ckë
->
com∂ëi⁄
)

524 
sync
 = 
åue
;

526 
£nd_Àn
 = 
∑ckë
->
a˘_Àn
 + 
HTC_HDR_LENGTH
;

528 
∑dded_Àn
 = 
	`CALC_TXRX_PADDED_LEN
(
èrgë
, 
£nd_Àn
);

530 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

532 
£nd_Àn
, 
∑ckë
->
öfo
.
tx
.
£qno
, 
∑dded_Àn
,

533 
èrgë
->
dev
->
¨
->
mbox_öfo
.
htc_addr
,

534 
sync
 ? "sync" : "async");

536 i‡(
sync
) {

537 
°©us
 = 
	`hif_ªad_wrôe_sync
(
èrgë
->
dev
->
¨
,

538 
èrgë
->
dev
->
¨
->
mbox_öfo
.
htc_addr
,

539 
∑ckë
->
buf
, 
∑dded_Àn
,

540 
HIF_WR_SYNC_BLOCK_INC
);

542 
∑ckë
->
°©us
 = status;

543 
∑ckë
->
buf
 +
HTC_HDR_LENGTH
;

545 
°©us
 = 
	`hif_wrôe_async
(
èrgë
->
dev
->
¨
,

546 
èrgë
->
dev
->
¨
->
mbox_öfo
.
htc_addr
,

547 
∑ckë
->
buf
, 
∑dded_Àn
,

548 
HIF_WR_ASYNC_BLOCK_INC
, 
∑ckë
);

550  
°©us
;

551 
	}
}

553 
	$htc_check_¸edôs
(
htc_èrgë
 *
èrgë
,

554 
htc_ídpoöt
 *
ï
, 
u8
 *
Êags
,

555 
htc_ídpoöt_id
 
eid
, 
Àn
,

556 *
ªq_¸ed
)

559 *
ªq_¸ed
 = (
Àn
 > 
èrgë
->
tgt_¸ed_sz
) ?

560 
	`DIV_ROUND_UP
(
Àn
, 
èrgë
->
tgt_¸ed_sz
) : 1;

562 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
, "credit checkÇeed %d got %d\n",

563 *
ªq_¸ed
, 
ï
->
¸ed_di°
.
¸edôs
);

565 i‡(
ï
->
¸ed_di°
.
¸edôs
 < *
ªq_¸ed
) {

566 i‡(
eid
 =
ENDPOINT_0
)

567  -
EINVAL
;

570 
ï
->
¸ed_di°
.
£ek_¸ed
 = *
ªq_¸ed
 -Ép->¸ed_di°.
¸edôs
;

572 
	`©h6kl_¸edô_£ek
(
èrgë
->
¸edô_öfo
, &
ï
->
¸ed_di°
);

574 
ï
->
¸ed_di°
.
£ek_¸ed
 = 0;

576 i‡(
ï
->
¸ed_di°
.
¸edôs
 < *
ªq_¸ed
) {

577 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
,

579 
eid
);

580  -
EINVAL
;

584 
ï
->
¸ed_di°
.
¸edôs
 -*
ªq_¸ed
;

585 
ï
->
ï_°
.
¸ed_cosumd
 +*
ªq_¸ed
;

588 i‡(
ï
->
¸ed_di°
.
¸edôs
 <Ép->¸ed_di°.
¸ed_≥r_msg
) {

589 
ï
->
¸ed_di°
.
£ek_¸ed
 =

590 
ï
->
¸ed_di°
.
¸ed_≥r_msg
 -Ép->¸ed_di°.
¸edôs
;

592 
	`©h6kl_¸edô_£ek
(
èrgë
->
¸edô_öfo
, &
ï
->
¸ed_di°
);

595 i‡(
ï
->
¸ed_di°
.
¸edôs
 <Ép->¸ed_di°.
¸ed_≥r_msg
) {

597 *
Êags
 |
HTC_FLAGS_NEED_CREDIT_UPDATE
;

598 
ï
->
ï_°
.
¸ed_low_ödiˇã
 += 1;

599 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
,

605 
	}
}

607 
	$©h6kl_htc_tx_pkts_gë
(
htc_èrgë
 *
èrgë
,

608 
htc_ídpoöt
 *
ídpoöt
,

609 
li°_hód
 *
queue
)

611 
ªq_¸ed
;

612 
u8
 
Êags
;

613 
htc_∑ckë
 *
∑ckë
;

614 
Àn
;

616 
åue
) {

618 
Êags
 = 0;

620 i‡(
	`li°_em±y
(&
ídpoöt
->
txq
))

622 
∑ckë
 = 
	`li°_fú°_íåy
(&
ídpoöt
->
txq
, 
htc_∑ckë
,

623 
li°
);

625 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

627 
∑ckë
, 
	`gë_queue_dïth
(&
ídpoöt
->
txq
));

629 
Àn
 = 
	`CALC_TXRX_PADDED_LEN
(
èrgë
,

630 
∑ckë
->
a˘_Àn
 + 
HTC_HDR_LENGTH
);

632 i‡(
	`htc_check_¸edôs
(
èrgë
, 
ídpoöt
, &
Êags
,

633 
∑ckë
->
ídpoöt
, 
Àn
, &
ªq_¸ed
))

637 
∑ckë
 = 
	`li°_fú°_íåy
(&
ídpoöt
->
txq
, 
htc_∑ckë
,

638 
li°
);

639 
	`li°_move_èû
(&
∑ckë
->
li°
, 
queue
);

642 
∑ckë
->
öfo
.
tx
.
¸ed_u£d
 = 
ªq_¸ed
;

645 
∑ckë
->
com∂ëi⁄
 = 
htc_tx_comp_h™dÀr
;

646 
∑ckë
->
c⁄ãxt
 = 
èrgë
;

647 
ídpoöt
->
ï_°
.
tx_issued
 += 1;

650 
∑ckë
->
öfo
.
tx
.
Êags
 = flags;

651 
∑ckë
->
öfo
.
tx
.
£qno
 = 
ídpoöt
->seqno;

652 
ídpoöt
->
£qno
++;

654 
	}
}

657 
	$htc_gë_¸edô_∑ddög
(
¸ed_sz
, *
Àn
,

658 
htc_ídpoöt
 *
ï
)

660 
ªm_¸ed
, 
¸ed_∑d
;

662 
ªm_¸ed
 = *
Àn
 % 
¸ed_sz
;

665 i‡(!
ªm_¸ed
)

668 i‡(!(
ï
->
c⁄n_Êags
 & 
HTC_FLGS_TX_BNDL_PAD_EN
))

677 
¸ed_∑d
 = *
Àn
 < 
¸ed_sz
 ? (¸ed_sz - *ÀnË: 
ªm_¸ed
;

679 i‡((
¸ed_∑d
 > 0) && (cred_pad <= 255))

680 *
Àn
 +
¸ed_∑d
;

685  
¸ed_∑d
;

686 
	}
}

688 
	$©h6kl_htc_tx_£tup_sˇt_li°
(
htc_èrgë
 *
èrgë
,

689 
htc_ídpoöt
 *
ídpoöt
,

690 
hif_sˇâî_ªq
 *
sˇt_ªq
,

691 
n_sˇt
,

692 
li°_hód
 *
queue
)

694 
htc_∑ckë
 *
∑ckë
;

695 
i
, 
Àn
, 
ªm_sˇt
, 
¸ed_∑d
;

696 
°©us
 = 0;

698 
ªm_sˇt
 = 
èrgë
->
max_tx_bndl_sz
;

700 
i
 = 0; i < 
n_sˇt
; i++) {

701 
sˇt_ªq
->
sˇt_li°
[
i
].
∑ckë
 = 
NULL
;

703 i‡(
	`li°_em±y
(
queue
))

706 
∑ckë
 = 
	`li°_fú°_íåy
(
queue
, 
htc_∑ckë
, 
li°
);

707 
Àn
 = 
	`CALC_TXRX_PADDED_LEN
(
èrgë
,

708 
∑ckë
->
a˘_Àn
 + 
HTC_HDR_LENGTH
);

710 
¸ed_∑d
 = 
	`htc_gë_¸edô_∑ddög
(
èrgë
->
tgt_¸ed_sz
,

711 &
Àn
, 
ídpoöt
);

712 i‡(
¸ed_∑d
 < 0 || 
ªm_sˇt
 < 
Àn
) {

713 
°©us
 = -
ENOSPC
;

717 
ªm_sˇt
 -
Àn
;

719 
	`li°_dñ
(&
∑ckë
->
li°
);

721 
sˇt_ªq
->
sˇt_li°
[
i
].
∑ckë
 =Öacket;

723 
	`©h6kl_htc_tx_¥ï_pkt
(
∑ckë
,

724 
∑ckë
->
öfo
.
tx
.
Êags
 | 
HTC_FLAGS_SEND_BUNDLE
,

725 
¸ed_∑d
, 
∑ckë
->
öfo
.
tx
.
£qno
);

727 
	`©h6kl_htc_tx_buf_Æign
(&
∑ckë
->
buf
,

728 
∑ckë
->
a˘_Àn
 + 
HTC_HDR_LENGTH
);

729 
sˇt_ªq
->
sˇt_li°
[
i
].
buf
 = 
∑ckë
->buf;

730 
sˇt_ªq
->
sˇt_li°
[
i
].
Àn
 =Üen;

732 
sˇt_ªq
->
Àn
 +=Üen;

733 
sˇt_ªq
->
sˇt_íåõs
++;

734 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

736 
i
, 
∑ckë
,Öackë->
öfo
.
tx
.
£qno
, 
Àn
, 
ªm_sˇt
);

740 i‡(
sˇt_ªq
->
sˇt_íåõs
 < 
HTC_MIN_HTC_MSGS_TO_BUNDLE
) {

741 
i
 = 
sˇt_ªq
->
sˇt_íåõs
 - 1; i >= 0; i--) {

742 
∑ckë
 = 
sˇt_ªq
->
sˇt_li°
[
i
].packet;

743 i‡(
∑ckë
) {

744 
∑ckë
->
buf
 +
HTC_HDR_LENGTH
;

745 
	`li°_add
(&
∑ckë
->
li°
, 
queue
);

748  -
EAGAIN
;

751  
°©us
;

752 
	}
}

763 
	$©h6kl_htc_tx_bundÀ
(
htc_ídpoöt
 *
ídpoöt
,

764 
li°_hód
 *
queue
,

765 *
£¡_bundÀ
, *
n_bundÀ_pkts
)

767 
htc_èrgë
 *
èrgë
 = 
ídpoöt
->target;

768 
hif_sˇâî_ªq
 *
sˇt_ªq
 = 
NULL
;

769 
n_sˇt
, 
n_£¡_bundÀ
 = 0, 
tŸ_pkts_bundÀ
 = 0;

770 
°©us
;

771 
u32
 
txb_mask
;

772 
u8
 
ac
 = 
WMM_NUM_AC
;

774 i‡((
HTC_CTRL_RSVD_SVC
 !
ídpoöt
->
svc_id
) ||

775 (
WMI_CONTROL_SVC
 !
ídpoöt
->
svc_id
))

776 
ac
 = 
èrgë
->
dev
->
¨
->
ï2ac_m≠
[
ídpoöt
->
eid
];

778 
åue
) {

779 
°©us
 = 0;

780 
n_sˇt
 = 
	`gë_queue_dïth
(
queue
);

781 
n_sˇt
 = 
	`mö
“_sˇt, 
èrgë
->
msg_≥r_bndl_max
);

783 i‡(
n_sˇt
 < 
HTC_MIN_HTC_MSGS_TO_BUNDLE
)

787 
sˇt_ªq
 = 
	`hif_sˇâî_ªq_gë
(
èrgë
->
dev
->
¨
);

789 i‡(!
sˇt_ªq
) {

791 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

796 i‡((
ac
 < 
WMM_NUM_AC
Ë&& (a¯!
WMM_AC_BK
)) {

797 i‡(
WMM_AC_BE
 =
ac
)

802 
txb_mask
 = (1 << 
WMM_AC_BK
);

808 
txb_mask
 = ((1 << 
ac
) - 1);

815 i‡(
sˇt_ªq
->
sˇt_q_dïth
 < 
ATH6KL_SCATTER_REQS
)

816 
èrgë
->
tx_bndl_mask
 &~
txb_mask
;

818 
èrgë
->
tx_bndl_mask
 |
txb_mask
;

821 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "htcÅxÖktsÅo scatter: %d\n",

822 
n_sˇt
);

824 
sˇt_ªq
->
Àn
 = 0;

825 
sˇt_ªq
->
sˇt_íåõs
 = 0;

827 
°©us
 = 
	`©h6kl_htc_tx_£tup_sˇt_li°
(
èrgë
, 
ídpoöt
,

828 
sˇt_ªq
, 
n_sˇt
,

829 
queue
);

830 i‡(
°©us
 =-
EAGAIN
) {

831 
	`hif_sˇâî_ªq_add
(
èrgë
->
dev
->
¨
, 
sˇt_ªq
);

836 
sˇt_ªq
->
com∂ëe
 = 
htc_async_tx_sˇt_com∂ëe
;

837 
n_£¡_bundÀ
++;

838 
tŸ_pkts_bundÀ
 +
sˇt_ªq
->
sˇt_íåõs
;

840 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

842 
sˇt_ªq
->
Àn
, sˇt_ªq->
sˇt_íåõs
);

843 
	`©h6kl_hif_submô_sˇt_ªq
(
èrgë
->
dev
, 
sˇt_ªq
, 
Ál£
);

845 i‡(
°©us
)

849 *
£¡_bundÀ
 = 
n_£¡_bundÀ
;

850 *
n_bundÀ_pkts
 = 
tŸ_pkts_bundÀ
;

851 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "htcÅx bundle sent %dÖkts\n",

852 
n_£¡_bundÀ
);

855 
	}
}

857 
	$©h6kl_htc_tx_‰om_queue
(
htc_èrgë
 *
èrgë
,

858 
htc_ídpoöt
 *
ídpoöt
)

860 
li°_hód
 
txq
;

861 
htc_∑ckë
 *
∑ckë
;

862 
bundÀ_£¡
;

863 
n_pkts_bundÀ
;

864 
u8
 
ac
 = 
WMM_NUM_AC
;

866 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

868 
ídpoöt
->
tx_¥oc_˙t
++;

869 i‡(
ídpoöt
->
tx_¥oc_˙t
 > 1) {

870 
ídpoöt
->
tx_¥oc_˙t
--;

871 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

872 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "htcÅx busy\n");

880 
	`INIT_LIST_HEAD
(&
txq
);

882 i‡((
HTC_CTRL_RSVD_SVC
 !
ídpoöt
->
svc_id
) ||

883 (
WMI_CONTROL_SVC
 !
ídpoöt
->
svc_id
))

884 
ac
 = 
èrgë
->
dev
->
¨
->
ï2ac_m≠
[
ídpoöt
->
eid
];

886 
åue
) {

888 i‡(
	`li°_em±y
(&
ídpoöt
->
txq
))

891 
	`©h6kl_htc_tx_pkts_gë
(
èrgë
, 
ídpoöt
, &
txq
);

893 i‡(
	`li°_em±y
(&
txq
))

896 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

898 
bundÀ_£¡
 = 0;

899 
n_pkts_bundÀ
 = 0;

901 
åue
) {

903 i‡((
èrgë
->
tx_bndl_mask
) &&

904 (
	`gë_queue_dïth
(&
txq
) >=

905 
HTC_MIN_HTC_MSGS_TO_BUNDLE
)) {

906 
ãmp1
 = 0, 
ãmp2
 = 0;

909 i‡(
èrgë
->
tx_bndl_mask
 & (1 << 
ac
)) {

910 
	`©h6kl_htc_tx_bundÀ
(
ídpoöt
, &
txq
,

911 &
ãmp1
, &
ãmp2
);

912 
bundÀ_£¡
 +
ãmp1
;

913 
n_pkts_bundÀ
 +
ãmp2
;

917 i‡(
	`li°_em±y
(&
txq
))

920 
∑ckë
 = 
	`li°_fú°_íåy
(&
txq
, 
htc_∑ckë
,

921 
li°
);

922 
	`li°_dñ
(&
∑ckë
->
li°
);

924 
	`©h6kl_htc_tx_¥ï_pkt
(
∑ckë
,Öackë->
öfo
.
tx
.
Êags
,

925 0, 
∑ckë
->
öfo
.
tx
.
£qno
);

926 
	`©h6kl_htc_tx_issue
(
èrgë
, 
∑ckë
);

929 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

931 
ídpoöt
->
ï_°
.
tx_bundÀs
 +
bundÀ_£¡
;

932 
ídpoöt
->
ï_°
.
tx_pkt_bundÀd
 +
n_pkts_bundÀ
;

939 i‡(!
bundÀ_£¡
) {

940 i‡(!(
èrgë
->
tx_bndl_mask
 & (1 << 
ac
)) &&

941 (
ac
 < 
WMM_NUM_AC
)) {

942 i‡(++
èrgë
->
ac_tx_cou¡
[
ac
] >=

943 
TX_RESUME_BUNDLE_THRESHOLD
) {

944 
èrgë
->
ac_tx_cou¡
[
ac
] = 0;

945 
èrgë
->
tx_bndl_mask
 |(1 << 
ac
);

950 i‡(
ac
 < 
WMM_NUM_AC
)

951 
èrgë
->
ac_tx_cou¡
[
ac
] = 0;

955 
ídpoöt
->
tx_¥oc_˙t
 = 0;

956 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

957 
	}
}

959 
boﬁ
 
	$©h6kl_htc_tx_åy
(
htc_èrgë
 *
èrgë
,

960 
htc_ídpoöt
 *
ídpoöt
,

961 
htc_∑ckë
 *
tx_pkt
)

963 
htc_ï_ˇŒbacks
 
ï_cb
;

964 
txq_dïth
;

965 
boﬁ
 
ovîÊow
 = 
Ál£
;

967 
ï_cb
 = 
ídpoöt
->ep_cb;

969 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

970 
txq_dïth
 = 
	`gë_queue_dïth
(&
ídpoöt
->
txq
);

971 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

973 i‡(
txq_dïth
 >
ídpoöt
->
max_txq_dïth
)

974 
ovîÊow
 = 
åue
;

976 i‡(
ovîÊow
)

977 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

979 
ídpoöt
->
eid
, 
txq_dïth
,

980 
ídpoöt
->
max_txq_dïth
);

982 i‡(
ovîÊow
 && 
ï_cb
.
tx_fuŒ
) {

983 i‡(
ï_cb
.
	`tx_fuŒ
(
ídpoöt
->
èrgë
, 
tx_pkt
) ==

984 
HTC_SEND_FULL_DROP
) {

985 
ídpoöt
->
ï_°
.
tx_dr›≥d
 += 1;

986  
Ál£
;

990 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

991 
	`li°_add_èû
(&
tx_pkt
->
li°
, &
ídpoöt
->
txq
);

992 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

994 
	`©h6kl_htc_tx_‰om_queue
(
èrgë
, 
ídpoöt
);

996  
åue
;

997 
	}
}

999 
	$htc_chk_ï_txq
(
htc_èrgë
 *
èrgë
)

1001 
htc_ídpoöt
 *
ídpoöt
;

1002 
htc_ídpoöt_¸edô_di°
 *
¸ed_di°
;

1010 
	`li°_f‹_óch_íåy
(
¸ed_di°
, &
èrgë
->
¸ed_di°_li°
, 
li°
) {

1011 
ídpoöt
 = 
¸ed_di°
->
htc_ï
;

1013 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

1014 i‡(!
	`li°_em±y
(&
ídpoöt
->
txq
)) {

1015 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1017 
¸ed_di°
->
ídpoöt
,

1018 
ídpoöt
->
¸ed_di°
.
¸edôs
,

1019 
	`gë_queue_dïth
(&
ídpoöt
->
txq
));

1020 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1028 
	`©h6kl_htc_tx_‰om_queue
(
èrgë
, 
ídpoöt
);

1029 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

1031 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1033 
	}
}

1035 
	$htc_£tup_tx_com∂ëe
(
htc_èrgë
 *
èrgë
)

1037 
htc_∑ckë
 *
£nd_pkt
 = 
NULL
;

1038 
°©us
;

1040 
£nd_pkt
 = 
	`htc_gë_c⁄åﬁ_buf
(
èrgë
, 
åue
);

1042 i‡(!
£nd_pkt
)

1043  -
ENOMEM
;

1045 i‡(
èrgë
->
htc_tgt_vî
 >
HTC_VERSION_2P1
) {

1046 
htc_£tup_comp_ext_msg
 *
£tup_comp_ext
;

1047 
u32
 
Êags
 = 0;

1049 
£tup_comp_ext
 =

1050 (
htc_£tup_comp_ext_msg
 *)
£nd_pkt
->
buf
;

1051 
	`mem£t
(
£tup_comp_ext
, 0, (*setup_comp_ext));

1052 
£tup_comp_ext
->
msg_id
 =

1053 
	`˝u_to_À16
(
HTC_MSG_SETUP_COMPLETE_EX_ID
);

1055 i‡(
èrgë
->
msg_≥r_bndl_max
 > 0) {

1057 
Êags
 |
HTC_SETUP_COMP_FLG_RX_BNDL_EN
;

1058 
£tup_comp_ext
->
msg_≥r_rxbndl
 =

1059 
èrgë
->
msg_≥r_bndl_max
;

1061 
Êags
 = 
	`˝u_to_À32
(flags);

1062 
	`mem˝y
(&
£tup_comp_ext
->
Êags
, &flags,

1063 (
£tup_comp_ext
->
Êags
));

1064 
	`£t_htc_pkt_öfo
(
£nd_pkt
, 
NULL
, (
u8
 *Ë
£tup_comp_ext
,

1065 (
htc_£tup_comp_ext_msg
),

1066 
ENDPOINT_0
, 
HTC_SERVICE_TX_PACKET_TAG
);

1069 
htc_£tup_comp_msg
 *
£tup_comp
;

1070 
£tup_comp
 = (
htc_£tup_comp_msg
 *)
£nd_pkt
->
buf
;

1071 
	`mem£t
(
£tup_comp
, 0, (
htc_£tup_comp_msg
));

1072 
£tup_comp
->
msg_id
 = 
	`˝u_to_À16
(
HTC_MSG_SETUP_COMPLETE_ID
);

1073 
	`£t_htc_pkt_öfo
(
£nd_pkt
, 
NULL
, (
u8
 *Ë
£tup_comp
,

1074 (
htc_£tup_comp_msg
),

1075 
ENDPOINT_0
, 
HTC_SERVICE_TX_PACKET_TAG
);

1079 
£nd_pkt
->
com∂ëi⁄
 = 
NULL
;

1080 
	`©h6kl_htc_tx_¥ï_pkt
(
£nd_pkt
, 0, 0, 0);

1081 
°©us
 = 
	`©h6kl_htc_tx_issue
(
èrgë
, 
£nd_pkt
);

1083 i‡(
£nd_pkt
 !
NULL
)

1084 
	`htc_ª˛aim_tx˘æ_buf
(
èrgë
, 
£nd_pkt
);

1086  
°©us
;

1087 
	}
}

1089 
	$©h6kl_htc_£t_¸edô_di°
(
htc_èrgë
 *
èrgë
,

1090 
©h6kl_htc_¸edô_öfo
 *
¸edô_öfo
,

1091 
u16
 
§vc_¥i_‹dî
[], 
li°_Àn
)

1093 
htc_ídpoöt
 *
ídpoöt
;

1094 
i
, 
ï
;

1096 
èrgë
->
¸edô_öfo
 = credit_info;

1098 
	`li°_add_èû
(&
èrgë
->
ídpoöt
[
ENDPOINT_0
].
¸ed_di°
.
li°
,

1099 &
èrgë
->
¸ed_di°_li°
);

1101 
i
 = 0; i < 
li°_Àn
; i++) {

1102 
ï
 = 
ENDPOINT_1
;É∞< 
ENDPOINT_MAX
;Ép++) {

1103 
ídpoöt
 = &
èrgë
->ídpoöt[
ï
];

1104 i‡(
ídpoöt
->
svc_id
 =
§vc_¥i_‹dî
[
i
]) {

1105 
	`li°_add_èû
(&
ídpoöt
->
¸ed_di°
.
li°
,

1106 &
èrgë
->
¸ed_di°_li°
);

1110 i‡(
ï
 >
ENDPOINT_MAX
) {

1111 
	`WARN_ON
(1);

1115 
	}
}

1117 
	$©h6kl_htc_mbox_tx
(
htc_èrgë
 *
èrgë
,

1118 
htc_∑ckë
 *
∑ckë
)

1120 
htc_ídpoöt
 *
ídpoöt
;

1121 
li°_hód
 
queue
;

1123 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1125 
∑ckë
->
ídpoöt
,Öackë->
buf
,Öackë->
a˘_Àn
);

1127 i‡(
∑ckë
->
ídpoöt
 >
ENDPOINT_MAX
) {

1128 
	`WARN_ON
(1);

1129  -
EINVAL
;

1132 
ídpoöt
 = &
èrgë
->ídpoöt[
∑ckë
->endpoint];

1134 i‡(!
	`©h6kl_htc_tx_åy
(
èrgë
, 
ídpoöt
, 
∑ckë
)) {

1135 
∑ckë
->
°©us
 = (
èrgë
->
htc_Êags
 & 
HTC_OP_STATE_STOPPING
) ?

1136 -
ECANCELED
 : -
ENOSPC
;

1137 
	`INIT_LIST_HEAD
(&
queue
);

1138 
	`li°_add
(&
∑ckë
->
li°
, &
queue
);

1139 
	`htc_tx_com∂ëe
(
ídpoöt
, &
queue
);

1143 
	}
}

1146 
	$©h6kl_htc_mbox_Êush_txï
(
htc_èrgë
 *
èrgë
,

1147 
htc_ídpoöt_id
 
eid
, 
u16
 
èg
)

1149 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

1150 
li°_hód
 
disˇrd_q
, 
c⁄èöî
;

1151 
htc_ídpoöt
 *
ídpoöt
 = &
èrgë
->ídpoöt[
eid
];

1153 i‡(!
ídpoöt
->
svc_id
) {

1154 
	`WARN_ON
(1);

1159 
	`INIT_LIST_HEAD
(&
disˇrd_q
);

1161 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

1163 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, &
ídpoöt
->
txq
, 
li°
) {

1164 i‡((
èg
 =
HTC_TX_PACKET_TAG_ALL
) ||

1165 (
èg
 =
∑ckë
->
öfo
.
tx
.tag))

1166 
	`li°_move_èû
(&
∑ckë
->
li°
, &
disˇrd_q
);

1169 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1171 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, &
disˇrd_q
, 
li°
) {

1172 
∑ckë
->
°©us
 = -
ECANCELED
;

1173 
	`li°_dñ
(&
∑ckë
->
li°
);

1174 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1176 
∑ckë
,Öackë->
a˘_Àn
,

1177 
∑ckë
->
ídpoöt
,Öackë->
öfo
.
tx
.
èg
);

1179 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

1180 
	`li°_add_èû
(&
∑ckë
->
li°
, &
c⁄èöî
);

1181 
	`htc_tx_com∂ëe
(
ídpoöt
, &
c⁄èöî
);

1184 
	}
}

1186 
	$©h6kl_htc_Êush_txï_Æl
(
htc_èrgë
 *
èrgë
)

1188 
htc_ídpoöt
 *
ídpoöt
;

1189 
i
;

1191 
	`dump_¸ed_di°_°©s
(
èrgë
);

1193 
i
 = 
ENDPOINT_0
; i < 
ENDPOINT_MAX
; i++) {

1194 
ídpoöt
 = &
èrgë
->ídpoöt[
i
];

1195 i‡(
ídpoöt
->
svc_id
 == 0)

1198 
	`©h6kl_htc_mbox_Êush_txï
(
èrgë
, 
i
, 
HTC_TX_PACKET_TAG_ALL
);

1200 
	}
}

1202 
	$©h6kl_htc_mbox_ödiˇã_a˘ivôy_ch™ge
(
htc_èrgë
 *
èrgë
,

1203 
htc_ídpoöt_id
 
eid
, 
boﬁ
 
a˘ive
)

1205 
htc_ídpoöt
 *
ídpoöt
 = &
èrgë
->ídpoöt[
eid
];

1206 
boﬁ
 
di°
 = 
Ál£
;

1208 i‡(
ídpoöt
->
svc_id
 == 0) {

1209 
	`WARN_ON
(1);

1213 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

1215 i‡(
a˘ive
) {

1216 i‡(!(
ídpoöt
->
¸ed_di°
.
di°_Êags
 & 
HTC_EP_ACTIVE
)) {

1217 
ídpoöt
->
¸ed_di°
.
di°_Êags
 |
HTC_EP_ACTIVE
;

1218 
di°
 = 
åue
;

1221 i‡(
ídpoöt
->
¸ed_di°
.
di°_Êags
 & 
HTC_EP_ACTIVE
) {

1222 
ídpoöt
->
¸ed_di°
.
di°_Êags
 &~
HTC_EP_ACTIVE
;

1223 
di°
 = 
åue
;

1227 i‡(
di°
) {

1228 
ídpoöt
->
¸ed_di°
.
txq_dïth
 =

1229 
	`gë_queue_dïth
(&
ídpoöt
->
txq
);

1231 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1233 
èrgë
->
¸edô_öfo
, &èrgë->
¸ed_di°_li°
);

1235 
	`©h6kl_¸edô_di°ribuã
(
èrgë
->
¸edô_öfo
,

1236 &
èrgë
->
¸ed_di°_li°
,

1237 
HTC_CREDIT_DIST_ACTIVITY_CHANGE
);

1240 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1242 i‡(
di°
 && !
a˘ive
)

1243 
	`htc_chk_ï_txq
(
èrgë
);

1244 
	}
}

1248 
ölöe
 
	$©h6kl_htc_rx_upd©e_°©s
(
htc_ídpoöt
 *
ídpoöt
,

1249 
n_look_ahds
)

1251 
ídpoöt
->
ï_°
.
rx_pkts
++;

1252 i‡(
n_look_ahds
 == 1)

1253 
ídpoöt
->
ï_°
.
rx_lkahds
++;

1254 i‡(
n_look_ahds
 > 1)

1255 
ídpoöt
->
ï_°
.
rx_bundÀ_lkahd
++;

1256 
	}
}

1258 
ölöe
 
boﬁ
 
	$htc_vÆid_rx_‰ame_Àn
(
htc_èrgë
 *
èrgë
,

1259 
htc_ídpoöt_id
 
eid
, 
Àn
)

1261  (
eid
 =
èrgë
->
dev
->
¨
->
˘æ_ï
) ?

1262 
Àn
 <
ATH6KL_BUFFER_SIZE
 :Üí <
ATH6KL_AMSDU_BUFFER_SIZE
;

1263 
	}
}

1265 
	$htc_add_rxbuf
(
htc_èrgë
 *
èrgë
, 
htc_∑ckë
 *
∑ckë
)

1267 
li°_hód
 
queue
;

1269 
	`INIT_LIST_HEAD
(&
queue
);

1270 
	`li°_add_èû
(&
∑ckë
->
li°
, &
queue
);

1271  
	`©h6kl_htc_mbox_add_rxbuf_mu…ùÀ
(
èrgë
, &
queue
);

1272 
	}
}

1274 
	$htc_ª˛aim_rxbuf
(
htc_èrgë
 *
èrgë
,

1275 
htc_∑ckë
 *
∑ckë
,

1276 
htc_ídpoöt
 *
ï
)

1278 i‡(
∑ckë
->
öfo
.
rx
.
rx_Êags
 & 
HTC_RX_PKT_NO_RECYCLE
) {

1279 
	`htc_rxpkt_ª£t
(
∑ckë
);

1280 
∑ckë
->
°©us
 = -
ECANCELED
;

1281 
ï
->
ï_cb
.
	`rx
”p->
èrgë
, 
∑ckë
);

1283 
	`htc_rxpkt_ª£t
(
∑ckë
);

1284 
	`htc_add_rxbuf
((*)(
èrgë
), 
∑ckë
);

1286 
	}
}

1288 
	$ª˛aim_rx_˘æ_buf
(
htc_èrgë
 *
èrgë
,

1289 
htc_∑ckë
 *
∑ckë
)

1291 
	`•ö_lock_bh
(&
èrgë
->
htc_lock
);

1292 
	`li°_add_èû
(&
∑ckë
->
li°
, &
èrgë
->
‰ì_˘æ_rxbuf
);

1293 
	`•ö_u∆ock_bh
(&
èrgë
->
htc_lock
);

1294 
	}
}

1296 
	$©h6kl_htc_rx_∑ckë
(
htc_èrgë
 *
èrgë
,

1297 
htc_∑ckë
 *
∑ckë
,

1298 
u32
 
rx_Àn
)

1300 
©h6kl_devi˚
 *
dev
 = 
èrgë
->dev;

1301 
u32
 
∑dded_Àn
;

1302 
°©us
;

1304 
∑dded_Àn
 = 
	`CALC_TXRX_PADDED_LEN
(
èrgë
, 
rx_Àn
);

1306 i‡(
∑dded_Àn
 > 
∑ckë
->
buf_Àn
) {

1307 
	`©h6kl_îr
("notÉnoughÑeceive space forÖacket -Öadlen %dÑecvlen %d bufferlen %d\n",

1308 
∑dded_Àn
, 
rx_Àn
, 
∑ckë
->
buf_Àn
);

1309  -
ENOMEM
;

1312 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1314 
∑ckë
,Öackë->
öfo
.
rx
.
exp_hdr
,

1315 
∑dded_Àn
, 
dev
->
¨
->
mbox_öfo
.
htc_addr
);

1317 
°©us
 = 
	`hif_ªad_wrôe_sync
(
dev
->
¨
,

1318 
dev
->
¨
->
mbox_öfo
.
htc_addr
,

1319 
∑ckë
->
buf
, 
∑dded_Àn
,

1320 
HIF_RD_SYNC_BLOCK_FIX
);

1322 
∑ckë
->
°©us
 = status;

1324  
°©us
;

1325 
	}
}

1332 
	$©h6kl_htc_rx_£t_ödiˇã
(
u32
 
lk_ahd
,

1333 
htc_ídpoöt
 *
ídpoöt
,

1334 
htc_∑ckë
 *
∑ckë
)

1336 
htc_‰ame_hdr
 *
htc_hdr
 = (htc_‰ame_hd∏*)&
lk_ahd
;

1338 i‡(
htc_hdr
->
eid
 =
∑ckë
->
ídpoöt
) {

1339 i‡(!
	`li°_em±y
(&
ídpoöt
->
rx_bufq
))

1340 
∑ckë
->
öfo
.
rx
.
ödiˇt_Êags
 |=

1341 
HTC_RX_FLAGS_INDICATE_MORE_PKTS
;

1343 
	}
}

1345 
	$©h6kl_htc_rx_chk_w©î_m¨k
(
htc_ídpoöt
 *
ídpoöt
)

1347 
htc_ï_ˇŒbacks
 
ï_cb
 = 
ídpoöt
->ep_cb;

1349 i‡(
ï_cb
.
rx_ªfûl_thªsh
 > 0) {

1350 
	`•ö_lock_bh
(&
ídpoöt
->
èrgë
->
rx_lock
);

1351 i‡(
	`gë_queue_dïth
(&
ídpoöt
->
rx_bufq
)

1352 < 
ï_cb
.
rx_ªfûl_thªsh
) {

1353 
	`•ö_u∆ock_bh
(&
ídpoöt
->
èrgë
->
rx_lock
);

1354 
ï_cb
.
	`rx_ªfûl
(
ídpoöt
->
èrgë
,Éndpoöt->
eid
);

1357 
	`•ö_u∆ock_bh
(&
ídpoöt
->
èrgë
->
rx_lock
);

1359 
	}
}

1362 
	$©h6kl_htc_rx_£tup
(
htc_èrgë
 *
èrgë
,

1363 
htc_ídpoöt
 *
ï
,

1364 
u32
 *
lk_ahds
, 
li°_hód
 *
queue
, 
n_msg
)

1366 
htc_∑ckë
 *
∑ckë
;

1368 
htc_‰ame_hdr
 *
htc_hdr
 = (htc_‰ame_hd∏*)
lk_ahds
;

1369 
htc_ï_ˇŒbacks
 
ï_cb
;

1370 
°©us
 = 0, 
j
, 
fuŒ_Àn
;

1371 
boﬁ
 
no_ªcy˛e
;

1373 
fuŒ_Àn
 = 
	`CALC_TXRX_PADDED_LEN
(
èrgë
,

1374 
	`À16_to_˝u
(
htc_hdr
->
∑yld_Àn
) +

1375 (*
htc_hdr
));

1377 i‡(!
	`htc_vÆid_rx_‰ame_Àn
(
èrgë
, 
ï
->
eid
, 
fuŒ_Àn
)) {

1378 
	`©h6kl_w¨n
("Rx bufferÑequested with invalidÜength\n");

1379  -
EINVAL
;

1382 
ï_cb
 = 
ï
->ep_cb;

1383 
j
 = 0; j < 
n_msg
; j++) {

1390 
no_ªcy˛e
 = 
Ál£
;

1392 i‡(
ï_cb
.
rx_Ælo˘hªsh
 &&

1393 (
fuŒ_Àn
 > 
ï_cb
.
rx_Æloc_thªsh
)) {

1394 
ï
->
ï_°
.
rx_Æloc_thªsh_hô
 += 1;

1395 
ï
->
ï_°
.
rxÆloc_thªsh_byã
 +=

1396 
	`À16_to_˝u
(
htc_hdr
->
∑yld_Àn
);

1398 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1399 
no_ªcy˛e
 = 
åue
;

1401 
∑ckë
 = 
ï_cb
.
	`rx_Ælo˘hªsh
(
ï
->
èrgë
,Ép->
eid
,

1402 
fuŒ_Àn
);

1403 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1406 i‡(
	`li°_em±y
(&
ï
->
rx_bufq
)) {

1407 i‡(
ï_cb
.
rx_ªfûl
) {

1408 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1409 
ï_cb
.
	`rx_ªfûl
(
ï
->
èrgë
,Ép->
eid
);

1410 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1414 i‡(
	`li°_em±y
(&
ï
->
rx_bufq
))

1415 
∑ckë
 = 
NULL
;

1417 
∑ckë
 = 
	`li°_fú°_íåy
(&
ï
->
rx_bufq
,

1418 
htc_∑ckë
, 
li°
);

1419 
	`li°_dñ
(&
∑ckë
->
li°
);

1423 i‡(!
∑ckë
) {

1424 
èrgë
->
rx_°_Êags
 |
HTC_RECV_WAIT_BUFFERS
;

1425 
èrgë
->
ï_waôög
 = 
ï
->
eid
;

1426  -
ENOSPC
;

1430 
∑ckë
->
öfo
.
rx
.
rx_Êags
 = 0;

1431 
∑ckë
->
öfo
.
rx
.
ödiˇt_Êags
 = 0;

1432 
∑ckë
->
°©us
 = 0;

1434 i‡(
no_ªcy˛e
)

1440 
∑ckë
->
öfo
.
rx
.
rx_Êags
 |
HTC_RX_PKT_NO_RECYCLE
;

1443 
	`li°_add_èû
(&
∑ckë
->
li°
, 
queue
);

1445 i‡(
èrgë
->
htc_Êags
 & 
HTC_OP_STATE_STOPPING
) {

1446 
°©us
 = -
ECANCELED
;

1450 i‡(
j
) {

1451 
∑ckë
->
öfo
.
rx
.
rx_Êags
 |
HTC_RX_PKT_REFRESH_HDR
;

1452 
∑ckë
->
öfo
.
rx
.
exp_hdr
 = 0xFFFFFFFF;

1455 
∑ckë
->
öfo
.
rx
.
exp_hdr
 = *
lk_ahds
;

1457 
∑ckë
->
a˘_Àn
 = 
	`À16_to_˝u
(
htc_hdr
->
∑yld_Àn
) +

1458 
HTC_HDR_LENGTH
;

1461  
°©us
;

1462 
	}
}

1464 
	$©h6kl_htc_rx_Æloc
(
htc_èrgë
 *
èrgë
,

1465 
u32
 
lk_ahds
[], 
msg
,

1466 
htc_ídpoöt
 *
ídpoöt
,

1467 
li°_hód
 *
queue
)

1469 
°©us
 = 0;

1470 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

1471 
htc_‰ame_hdr
 *
htc_hdr
;

1472 
i
, 
n_msg
;

1474 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1476 
i
 = 0; i < 
msg
; i++) {

1478 
htc_hdr
 = (
htc_‰ame_hdr
 *)&
lk_ahds
[
i
];

1480 i‡(
htc_hdr
->
eid
 >
ENDPOINT_MAX
) {

1481 
	`©h6kl_îr
("invalidÉp inÜook-ahead: %d\n",

1482 
htc_hdr
->
eid
);

1483 
°©us
 = -
ENOMEM
;

1487 i‡(
htc_hdr
->
eid
 !
ídpoöt
->eid) {

1488 
	`©h6kl_îr
("invalidÉp inÜook-ahead: %d should be : %d (index:%d)\n",

1489 
htc_hdr
->
eid
, 
ídpoöt
->eid, 
i
);

1490 
°©us
 = -
ENOMEM
;

1494 i‡(
	`À16_to_˝u
(
htc_hdr
->
∑yld_Àn
Ë> 
HTC_MAX_PAYLOAD_LENGTH
) {

1495 
	`©h6kl_îr
("payloadÜen %dÉxceeds max htc : %d !\n",

1496 
	`À16_to_˝u
(
htc_hdr
->
∑yld_Àn
),

1497 (
u32
Ë
HTC_MAX_PAYLOAD_LENGTH
);

1498 
°©us
 = -
ENOMEM
;

1502 i‡(
ídpoöt
->
svc_id
 == 0) {

1503 
	`©h6kl_îr
("ï %d i†nŸ c⁄√˘ed !\n", 
htc_hdr
->
eid
);

1504 
°©us
 = -
ENOMEM
;

1508 i‡(
htc_hdr
->
Êags
 & 
HTC_FLG_RX_BNDL_CNT
) {

1514 
n_msg
 = (
htc_hdr
->
Êags
 & 
HTC_FLG_RX_BNDL_CNT
) >>

1515 
HTC_FLG_RX_BNDL_CNT_S
;

1518 
n_msg
++;

1519 i‡(
n_msg
 > 
èrgë
->
msg_≥r_bndl_max
) {

1520 
°©us
 = -
ENOMEM
;

1524 
ídpoöt
->
ï_°
.
rx_bundÀ_‰om_hdr
 += 1;

1525 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1527 
n_msg
);

1530 
n_msg
 = 1;

1533 
°©us
 = 
	`©h6kl_htc_rx_£tup
(
èrgë
, 
ídpoöt
, &
lk_ahds
[
i
],

1534 
queue
, 
n_msg
);

1541 i‡(
°©us
 =-
ENOSPC
) {

1542 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1546 i‡(
°©us
)

1550 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1552 i‡(
°©us
) {

1553 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, 
queue
, 
li°
) {

1554 
	`li°_dñ
(&
∑ckë
->
li°
);

1555 
	`htc_ª˛aim_rxbuf
(
èrgë
, 
∑ckë
,

1556 &
èrgë
->
ídpoöt
[
∑ckë
->endpoint]);

1560  
°©us
;

1561 
	}
}

1563 
	$htc_˘æ_rx
(
htc_èrgë
 *
c⁄ãxt
, 
htc_∑ckë
 *
∑ckës
)

1565 i‡(
∑ckës
->
ídpoöt
 !
ENDPOINT_0
) {

1566 
	`WARN_ON
(1);

1570 i‡(
∑ckës
->
°©us
 =-
ECANCELED
) {

1571 
	`ª˛aim_rx_˘æ_buf
(
c⁄ãxt
, 
∑ckës
);

1575 i‡(
∑ckës
->
a˘_Àn
 > 0) {

1576 
	`©h6kl_îr
("htc_ctrl_rx, got message withÜen:%zu\n",

1577 
∑ckës
->
a˘_Àn
 + 
HTC_HDR_LENGTH
);

1579 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_HTC
,

1581 
∑ckës
->
buf
 - 
HTC_HDR_LENGTH
,

1582 
∑ckës
->
a˘_Àn
 + 
HTC_HDR_LENGTH
);

1585 
	`htc_ª˛aim_rxbuf
(
c⁄ãxt
, 
∑ckës
, &c⁄ãxt->
ídpoöt
[0]);

1586 
	}
}

1588 
	$htc_¥oc_¸ed_Ωt
(
htc_èrgë
 *
èrgë
,

1589 
htc_¸edô_ªp‹t
 *
Ωt
,

1590 
n_íåõs
,

1591 
htc_ídpoöt_id
 
‰om_ï
)

1593 
htc_ídpoöt
 *
ídpoöt
;

1594 
tŸ_¸edôs
 = 0, 
i
;

1595 
boﬁ
 
di°
 = 
Ál£
;

1597 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

1599 
i
 = 0; i < 
n_íåõs
; i++, 
Ωt
++) {

1600 i‡(
Ωt
->
eid
 >
ENDPOINT_MAX
) {

1601 
	`WARN_ON
(1);

1602 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1606 
ídpoöt
 = &
èrgë
->ídpoöt[
Ωt
->
eid
];

1608 
	`©h6kl_dbg
(
ATH6KL_DBG_CREDIT
,

1610 
Ωt
->
eid
,Ñ±->
¸edôs
);

1612 
ídpoöt
->
ï_°
.
tx_¸ed_Ωt
 += 1;

1613 
ídpoöt
->
ï_°
.
¸ed_ªäd
 +
Ωt
->
¸edôs
;

1615 i‡(
‰om_ï
 =
Ωt
->
eid
) {

1620 
ídpoöt
->
ï_°
.
¸ed_‰om_rx
 +
Ωt
->
¸edôs
;

1621 
ídpoöt
->
ï_°
.
¸ed_Ωt_‰om_rx
 += 1;

1622 } i‡(
‰om_ï
 =
ENDPOINT_0
) {

1624 
ídpoöt
->
ï_°
.
¸ed_‰om_ï0
 +
Ωt
->
¸edôs
;

1625 
ídpoöt
->
ï_°
.
¸ed_Ωt_ï0
 += 1;

1627 
ídpoöt
->
ï_°
.
¸ed_‰om_Ÿhî
 +
Ωt
->
¸edôs
;

1628 
ídpoöt
->
ï_°
.
¸ed_Ωt_‰om_Ÿhî
 += 1;

1631 i‡(
Ωt
->
eid
 =
ENDPOINT_0
)

1633 
ídpoöt
->
¸ed_di°
.
¸edôs
 +
Ωt
->credits;

1635 
ídpoöt
->
¸ed_di°
.
¸ed_to_di°
 +
Ωt
->
¸edôs
;

1636 
di°
 = 
åue
;

1644 
ídpoöt
->
¸ed_di°
.
txq_dïth
 =

1645 
	`gë_queue_dïth
(&
ídpoöt
->
txq
);

1647 
tŸ_¸edôs
 +
Ωt
->
¸edôs
;

1650 i‡(
di°
) {

1655 
	`©h6kl_¸edô_di°ribuã
(
èrgë
->
¸edô_öfo
,

1656 &
èrgë
->
¸ed_di°_li°
,

1657 
HTC_CREDIT_DIST_SEND_COMPLETE
);

1660 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1662 i‡(
tŸ_¸edôs
)

1663 
	`htc_chk_ï_txq
(
èrgë
);

1664 
	}
}

1666 
	$htc_∑r£_åaûî
(
htc_èrgë
 *
èrgë
,

1667 
htc_ªc‹d_hdr
 *
ªc‹d
,

1668 
u8
 *
ªc‹d_buf
, 
u32
 *
√xt_lk_ahds
,

1669 
htc_ídpoöt_id
 
ídpoöt
,

1670 *
n_lk_ahds
)

1672 
htc_bundÀ_lkahd_Ωt
 *
bundÀ_lkahd_Ωt
;

1673 
htc_lookahód_ªp‹t
 *
lk_ahd
;

1674 
Àn
;

1676 
ªc‹d
->
ªc_id
) {

1677 
HTC_RECORD_CREDITS
:

1678 
Àn
 = 
ªc‹d
->À¿/ (
htc_¸edô_ªp‹t
);

1679 i‡(!
Àn
) {

1680 
	`WARN_ON
(1);

1681  -
EINVAL
;

1684 
	`htc_¥oc_¸ed_Ωt
(
èrgë
,

1685 (
htc_¸edô_ªp‹t
 *Ë
ªc‹d_buf
,

1686 
Àn
, 
ídpoöt
);

1688 
HTC_RECORD_LOOKAHEAD
:

1689 
Àn
 = 
ªc‹d
->À¿/ (*
lk_ahd
);

1690 i‡(!
Àn
) {

1691 
	`WARN_ON
(1);

1692  -
EINVAL
;

1695 
lk_ahd
 = (
htc_lookahód_ªp‹t
 *Ë
ªc‹d_buf
;

1696 i‡((
lk_ahd
->
¥e_vÆid
 =((~lk_ahd->
po°_vÆid
) & 0xFF))

1697 && 
√xt_lk_ahds
) {

1699 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1701 
lk_ahd
->
¥e_vÆid
,Ük_ahd->
po°_vÆid
);

1704 
	`mem˝y
((
u8
 *)&
√xt_lk_ahds
[0], 
lk_ahd
->lk_ahd, 4);

1706 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_HTC
,

1708 "", 
√xt_lk_ahds
, 4);

1710 *
n_lk_ahds
 = 1;

1713 
HTC_RECORD_LOOKAHEAD_BUNDLE
:

1714 
Àn
 = 
ªc‹d
->À¿/ (*
bundÀ_lkahd_Ωt
);

1715 i‡(!
Àn
 || (À¿> 
HTC_HOST_MAX_MSG_PER_BUNDLE
)) {

1716 
	`WARN_ON
(1);

1717  -
EINVAL
;

1720 i‡(
√xt_lk_ahds
) {

1721 
i
;

1723 
bundÀ_lkahd_Ωt
 =

1724 (
htc_bundÀ_lkahd_Ωt
 *Ë
ªc‹d_buf
;

1726 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_HTC
, "htcÑx bundleÜk_ahd",

1727 "", 
ªc‹d_buf
, 
ªc‹d
->
Àn
);

1729 
i
 = 0; i < 
Àn
; i++) {

1730 
	`mem˝y
((
u8
 *)&
√xt_lk_ahds
[
i
],

1731 
bundÀ_lkahd_Ωt
->
lk_ahd
, 4);

1732 
bundÀ_lkahd_Ωt
++;

1735 *
n_lk_ahds
 = 
i
;

1739 
	`©h6kl_îr
("unhandledÑecord: id:%dÜen:%d\n",

1740 
ªc‹d
->
ªc_id
,Ñec‹d->
Àn
);

1746 
	}
}

1748 
	$htc_¥oc_åaûî
(
htc_èrgë
 *
èrgë
,

1749 
u8
 *
buf
, 
Àn
, 
u32
 *
√xt_lk_ahds
,

1750 *
n_lk_ahds
, 
htc_ídpoöt_id
 
ídpoöt
)

1752 
htc_ªc‹d_hdr
 *
ªc‹d
;

1753 
‹ig_Àn
;

1754 
°©us
;

1755 
u8
 *
ªc‹d_buf
;

1756 
u8
 *
‹ig_buf
;

1758 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "ht¯rxÅøûîÜí %d\n", 
Àn
);

1759 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_HTC
, 
NULL
, "", 
buf
, 
Àn
);

1761 
‹ig_buf
 = 
buf
;

1762 
‹ig_Àn
 = 
Àn
;

1763 
°©us
 = 0;

1765 
Àn
 > 0) {

1767 i‡(
Àn
 < (
htc_ªc‹d_hdr
)) {

1768 
°©us
 = -
ENOMEM
;

1772 
ªc‹d
 = (
htc_ªc‹d_hdr
 *Ë
buf
;

1773 
Àn
 -(
htc_ªc‹d_hdr
);

1774 
buf
 +(
htc_ªc‹d_hdr
);

1776 i‡(
ªc‹d
->
Àn
 >Üen) {

1777 
	`©h6kl_îr
("invalidÑecordÜen: %d (id:%d) buf has: %d bytesÜeft\n",

1778 
ªc‹d
->
Àn
,Ñec‹d->
ªc_id
,Üen);

1779 
°©us
 = -
ENOMEM
;

1782 
ªc‹d_buf
 = 
buf
;

1784 
°©us
 = 
	`htc_∑r£_åaûî
(
èrgë
, 
ªc‹d
, 
ªc‹d_buf
,

1785 
√xt_lk_ahds
, 
ídpoöt
, 
n_lk_ahds
);

1787 i‡(
°©us
)

1791 
buf
 +
ªc‹d
->
Àn
;

1792 
Àn
 -
ªc‹d
->len;

1795 i‡(
°©us
)

1796 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_HTC
, "htcÑx badÅrailer",

1797 "", 
‹ig_buf
, 
‹ig_Àn
);

1799  
°©us
;

1800 
	}
}

1802 
	$©h6kl_htc_rx_¥o˚ss_hdr
(
htc_èrgë
 *
èrgë
,

1803 
htc_∑ckë
 *
∑ckë
,

1804 
u32
 *
√xt_lkahds
, *
n_lkahds
)

1806 
°©us
 = 0;

1807 
u16
 
∑ylﬂd_Àn
;

1808 
u32
 
lk_ahd
;

1809 
htc_‰ame_hdr
 *
htc_hdr
 = (htc_‰ame_hd∏*)
∑ckë
->
buf
;

1811 i‡(
n_lkahds
 !
NULL
)

1812 *
n_lkahds
 = 0;

1818 
∑ylﬂd_Àn
 = 
	`À16_to_˝u
(
	`gë_u«lig√d
(&
htc_hdr
->
∑yld_Àn
));

1820 
	`mem˝y
((
u8
 *)&
lk_ahd
, 
∑ckë
->
buf
, (lk_ahd));

1822 i‡(
∑ckë
->
öfo
.
rx
.
rx_Êags
 & 
HTC_RX_PKT_REFRESH_HDR
) {

1828 
∑ckë
->
öfo
.
rx
.
exp_hdr
 = 
lk_ahd
;

1829 
∑ckë
->
a˘_Àn
 = 
∑ylﬂd_Àn
 + 
HTC_HDR_LENGTH
;

1832 i‡(
∑ckë
->
a˘_Àn
 >Öackë->
buf_Àn
) {

1833 
	`©h6kl_îr
("refreshed hdrÖayloadÜen (%d) in bundledÑecv is invalid (hdr: 0x%X)\n",

1834 
∑ylﬂd_Àn
, 
lk_ahd
);

1839 
∑ckë
->
a˘_Àn
 = 
	`mö
’ackë->a˘_Àn,Öackë->
buf_Àn
);

1840 
°©us
 = -
ENOMEM
;

1841 
Áû_rx
;

1844 i‡(
∑ckë
->
ídpoöt
 !
htc_hdr
->
eid
) {

1845 
	`©h6kl_îr
("refreshed hdrÉp (%d) doesÇot matchÉxpectedÉp (%d)\n",

1846 
htc_hdr
->
eid
, 
∑ckë
->
ídpoöt
);

1847 
°©us
 = -
ENOMEM
;

1848 
Áû_rx
;

1852 i‡(
lk_ahd
 !
∑ckë
->
öfo
.
rx
.
exp_hdr
) {

1853 
	`©h6kl_îr
("%s():Ük_ahd mismatch! (pPkt:0x%p flags:0x%X)\n",

1854 
__func__
, 
∑ckë
,Öackë->
öfo
.
rx
.
rx_Êags
);

1855 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_HTC
, "htcÑxÉxpectedÜk_ahd",

1856 "", &
∑ckë
->
öfo
.
rx
.
exp_hdr
, 4);

1857 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_HTC
, "htcÑx current header",

1858 "", (
u8
 *)&
lk_ahd
, (lk_ahd));

1859 
°©us
 = -
ENOMEM
;

1860 
Áû_rx
;

1863 i‡(
htc_hdr
->
Êags
 & 
HTC_FLG_RX_TRAILER
) {

1864 i‡(
htc_hdr
->
˘æ
[0] < (
htc_ªc‹d_hdr
) ||

1865 
htc_hdr
->
˘æ
[0] > 
∑ylﬂd_Àn
) {

1866 
	`©h6kl_îr
("%s(): invalid hdr (payloadÜen should be :%d, CB[0] is:%d)\n",

1867 
__func__
, 
∑ylﬂd_Àn
, 
htc_hdr
->
˘æ
[0]);

1868 
°©us
 = -
ENOMEM
;

1869 
Áû_rx
;

1872 i‡(
∑ckë
->
öfo
.
rx
.
rx_Êags
 & 
HTC_RX_PKT_IGNORE_LOOKAHEAD
) {

1873 
√xt_lkahds
 = 
NULL
;

1874 
n_lkahds
 = 
NULL
;

1877 
°©us
 = 
	`htc_¥oc_åaûî
(
èrgë
, 
∑ckë
->
buf
 + 
HTC_HDR_LENGTH


1878 + 
∑ylﬂd_Àn
 - 
htc_hdr
->
˘æ
[0],

1879 
htc_hdr
->
˘æ
[0], 
√xt_lkahds
,

1880 
n_lkahds
, 
∑ckë
->
ídpoöt
);

1882 i‡(
°©us
)

1883 
Áû_rx
;

1885 
∑ckë
->
a˘_Àn
 -
htc_hdr
->
˘æ
[0];

1888 
∑ckë
->
buf
 +
HTC_HDR_LENGTH
;

1889 
∑ckë
->
a˘_Àn
 -
HTC_HDR_LENGTH
;

1891 
Áû_rx
:

1892 i‡(
°©us
)

1893 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_HTC
, "htcÑx badÖacket",

1894 "", 
∑ckë
->
buf
,Öackë->
a˘_Àn
);

1896  
°©us
;

1897 
	}
}

1899 
	$©h6kl_htc_rx_com∂ëe
(
htc_ídpoöt
 *
ídpoöt
,

1900 
htc_∑ckë
 *
∑ckë
)

1902 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1904 
ídpoöt
->
eid
, 
∑ckë
);

1905 
ídpoöt
->
ï_cb
.
	`rx
”ndpoöt->
èrgë
, 
∑ckë
);

1906 
	}
}

1908 
	$©h6kl_htc_rx_bundÀ
(
htc_èrgë
 *
èrgë
,

1909 
li°_hód
 *
rxq
,

1910 
li°_hód
 *
sync_compq
,

1911 *
n_pkt_„tched
, 
boﬁ
 
∑π_bundÀ
)

1913 
hif_sˇâî_ªq
 *
sˇt_ªq
;

1914 
htc_∑ckë
 *
∑ckë
;

1915 
ªm_•a˚
 = 
èrgë
->
max_rx_bndl_sz
;

1916 
n_sˇt_pkt
, 
°©us
 = 0, 
i
, 
Àn
;

1918 
n_sˇt_pkt
 = 
	`gë_queue_dïth
(
rxq
);

1919 
n_sˇt_pkt
 = 
	`mö
“_sˇt_pkt, 
èrgë
->
msg_≥r_bndl_max
);

1921 i‡((
	`gë_queue_dïth
(
rxq
Ë- 
n_sˇt_pkt
) > 0) {

1927 
∑π_bundÀ
 = 
åue
;

1933 
	`©h6kl_w¨n
("%s():Öartial bundle detectedÇum:%d , %d\n",

1934 
__func__
, 
	`gë_queue_dïth
(
rxq
), 
n_sˇt_pkt
);

1937 
Àn
 = 0;

1939 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1941 
	`gë_queue_dïth
(
rxq
), 
n_sˇt_pkt
);

1943 
sˇt_ªq
 = 
	`hif_sˇâî_ªq_gë
(
èrgë
->
dev
->
¨
);

1945 i‡(
sˇt_ªq
 =
NULL
)

1946 
Áû_rx_pkt
;

1948 
i
 = 0; i < 
n_sˇt_pkt
; i++) {

1949 
∑d_Àn
;

1951 
∑ckë
 = 
	`li°_fú°_íåy
(
rxq
, 
htc_∑ckë
, 
li°
);

1952 
	`li°_dñ
(&
∑ckë
->
li°
);

1954 
∑d_Àn
 = 
	`CALC_TXRX_PADDED_LEN
(
èrgë
,

1955 
∑ckë
->
a˘_Àn
);

1957 i‡((
ªm_•a˚
 - 
∑d_Àn
) < 0) {

1958 
	`li°_add
(&
∑ckë
->
li°
, 
rxq
);

1962 
ªm_•a˚
 -
∑d_Àn
;

1964 i‡(
∑π_bundÀ
 || (
i
 < (
n_sˇt_pkt
 - 1)))

1970 
∑ckë
->
öfo
.
rx
.
rx_Êags
 |=

1971 
HTC_RX_PKT_IGNORE_LOOKAHEAD
;

1974 
sˇt_ªq
->
sˇt_li°
[
i
].
buf
 = 
∑ckë
->buf;

1975 
sˇt_ªq
->
sˇt_li°
[
i
].
Àn
 = 
∑d_Àn
;

1977 
∑ckë
->
öfo
.
rx
.
rx_Êags
 |
HTC_RX_PKT_PART_OF_BUNDLE
;

1979 
	`li°_add_èû
(&
∑ckë
->
li°
, 
sync_compq
);

1981 
	`WARN_ON
(!
sˇt_ªq
->
sˇt_li°
[
i
].
Àn
);

1982 
Àn
 +
sˇt_ªq
->
sˇt_li°
[
i
].len;

1985 
sˇt_ªq
->
Àn
 =Üen;

1986 
sˇt_ªq
->
sˇt_íåõs
 = 
i
;

1988 
°©us
 = 
	`©h6kl_hif_submô_sˇt_ªq
(
èrgë
->
dev
, 
sˇt_ªq
, 
åue
);

1990 i‡(!
°©us
)

1991 *
n_pkt_„tched
 = 
i
;

1994 
	`hif_sˇâî_ªq_add
(
èrgë
->
dev
->
¨
, 
sˇt_ªq
);

1996 
Áû_rx_pkt
:

1998  
°©us
;

1999 
	}
}

2001 
	$©h6kl_htc_rx_¥o˚ss_∑ckës
(
htc_èrgë
 *
èrgë
,

2002 
li°_hód
 *
comp_pktq
,

2003 
u32
 
lk_ahds
[],

2004 *
n_lk_ahd
)

2006 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

2007 
htc_ídpoöt
 *
ï
;

2008 
°©us
 = 0;

2010 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, 
comp_pktq
, 
li°
) {

2011 
ï
 = &
èrgë
->
ídpoöt
[
∑ckë
->endpoint];

2014 
°©us
 = 
	`©h6kl_htc_rx_¥o˚ss_hdr
(
èrgë
, 
∑ckë
, 
lk_ahds
,

2015 
n_lk_ahd
);

2016 i‡(
°©us
)

2017  
°©us
;

2019 
	`li°_dñ
(&
∑ckë
->
li°
);

2021 i‡(
	`li°_em±y
(
comp_pktq
)) {

2026 i‡(*
n_lk_ahd
 > 0)

2027 
	`©h6kl_htc_rx_£t_ödiˇã
(
lk_ahds
[0],

2028 
ï
, 
∑ckë
);

2034 
∑ckë
->
öfo
.
rx
.
ödiˇt_Êags
 |=

2035 
HTC_RX_FLAGS_INDICATE_MORE_PKTS
;

2037 
	`©h6kl_htc_rx_upd©e_°©s
(
ï
, *
n_lk_ahd
);

2039 i‡(
∑ckë
->
öfo
.
rx
.
rx_Êags
 & 
HTC_RX_PKT_PART_OF_BUNDLE
)

2040 
ï
->
ï_°
.
rx_bundl
 += 1;

2042 
	`©h6kl_htc_rx_com∂ëe
(
ï
, 
∑ckë
);

2045  
°©us
;

2046 
	}
}

2048 
	$©h6kl_htc_rx_„tch
(
htc_èrgë
 *
èrgë
,

2049 
li°_hód
 *
rx_pktq
,

2050 
li°_hód
 *
comp_pktq
)

2052 
„tched_pkts
;

2053 
boﬁ
 
∑π_bundÀ
 = 
Ál£
;

2054 
°©us
 = 0;

2055 
li°_hód
 
tmp_rxq
;

2056 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

2059 !
	`li°_em±y
(
rx_pktq
)) {

2060 
„tched_pkts
 = 0;

2062 
	`INIT_LIST_HEAD
(&
tmp_rxq
);

2064 i‡(
èrgë
->
rx_bndl_íabÀ
 && (
	`gë_queue_dïth
(
rx_pktq
) > 1)) {

2070 
°©us
 = 
	`©h6kl_htc_rx_bundÀ
(
èrgë
, 
rx_pktq
,

2071 &
tmp_rxq
,

2072 &
„tched_pkts
,

2073 
∑π_bundÀ
);

2074 i‡(
°©us
)

2075 
Áû_rx
;

2077 i‡(!
	`li°_em±y
(
rx_pktq
))

2078 
∑π_bundÀ
 = 
åue
;

2080 
	`li°_•li˚_èû_öô
(&
tmp_rxq
, 
comp_pktq
);

2083 i‡(!
„tched_pkts
) {

2085 
∑ckë
 = 
	`li°_fú°_íåy
(
rx_pktq
, 
htc_∑ckë
,

2086 
li°
);

2089 
∑ckë
->
com∂ëi⁄
 = 
NULL
;

2091 i‡(!
	`li°_is_söguœr
(
rx_pktq
))

2097 
∑ckë
->
öfo
.
rx
.
rx_Êags
 |=

2098 
HTC_RX_PKT_IGNORE_LOOKAHEAD
;

2101 
°©us
 = 
	`©h6kl_htc_rx_∑ckë
(
èrgë
, 
∑ckë
,

2102 
∑ckë
->
a˘_Àn
);

2104 
	`li°_move_èû
(&
∑ckë
->
li°
, &
tmp_rxq
);

2106 i‡(
°©us
)

2107 
Áû_rx
;

2109 
	`li°_•li˚_èû_öô
(&
tmp_rxq
, 
comp_pktq
);

2115 
Áû_rx
:

2122 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, 
rx_pktq
, 
li°
) {

2123 
	`li°_dñ
(&
∑ckë
->
li°
);

2124 
	`htc_ª˛aim_rxbuf
(
èrgë
, 
∑ckë
,

2125 &
èrgë
->
ídpoöt
[
∑ckë
->endpoint]);

2128 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, &
tmp_rxq
, 
li°
) {

2129 
	`li°_dñ
(&
∑ckë
->
li°
);

2130 
	`htc_ª˛aim_rxbuf
(
èrgë
, 
∑ckë
,

2131 &
èrgë
->
ídpoöt
[
∑ckë
->endpoint]);

2134  
°©us
;

2135 
	}
}

2137 
	$©h6kl_htc_rxmsg_≥ndög_h™dÀr
(
htc_èrgë
 *
èrgë
,

2138 
u32
 
msg_look_ahód
, *
num_pkts
)

2140 
htc_∑ckë
 *
∑ckës
, *
tmp_pkt
;

2141 
htc_ídpoöt
 *
ídpoöt
;

2142 
li°_hód
 
rx_pktq
, 
comp_pktq
;

2143 
°©us
 = 0;

2144 
u32
 
look_ahóds
[
HTC_HOST_MAX_MSG_PER_BUNDLE
];

2145 
num_look_ahód
 = 1;

2146 
htc_ídpoöt_id
 
id
;

2147 
n_„tched
 = 0;

2149 *
num_pkts
 = 0;

2155 
look_ahóds
[0] = 
msg_look_ahód
;

2157 
åue
) {

2163 
id
 = ((
htc_‰ame_hdr
 *)&
look_ahóds
[0])->
eid
;

2164 
ídpoöt
 = &
èrgë
->ídpoöt[
id
];

2166 i‡(
id
 >
ENDPOINT_MAX
) {

2167 
	`©h6kl_îr
("MsgPend, invalidÉndpoint inÜook-ahead: %d\n",

2168 
id
);

2169 
°©us
 = -
ENOMEM
;

2173 
	`INIT_LIST_HEAD
(&
rx_pktq
);

2174 
	`INIT_LIST_HEAD
(&
comp_pktq
);

2180 
°©us
 = 
	`©h6kl_htc_rx_Æloc
(
èrgë
, 
look_ahóds
,

2181 
num_look_ahód
, 
ídpoöt
,

2182 &
rx_pktq
);

2183 i‡(
°©us
)

2186 i‡(
	`gë_queue_dïth
(&
rx_pktq
) >= 2)

2191 
èrgë
->
chk_úq_°©us_˙t
 = 1;

2193 
n_„tched
 +
	`gë_queue_dïth
(&
rx_pktq
);

2195 
num_look_ahód
 = 0;

2197 
°©us
 = 
	`©h6kl_htc_rx_„tch
(
èrgë
, &
rx_pktq
, &
comp_pktq
);

2199 i‡(!
°©us
)

2200 
	`©h6kl_htc_rx_chk_w©î_m¨k
(
ídpoöt
);

2203 
°©us
 = 
	`©h6kl_htc_rx_¥o˚ss_∑ckës
(
èrgë
, &
comp_pktq
,

2204 
look_ahóds
,

2205 &
num_look_ahód
);

2207 i‡(!
num_look_ahód
 || 
°©us
)

2217 
èrgë
->
chk_úq_°©us_˙t
 = 1;

2220 i‡(
°©us
) {

2221 
	`©h6kl_îr
("failedÅo getÖendingÑecv messages: %d\n",

2222 
°©us
);

2225 
	`li°_f‹_óch_íåy_ß„
(
∑ckës
, 
tmp_pkt
, &
comp_pktq
, 
li°
) {

2226 
	`li°_dñ
(&
∑ckës
->
li°
);

2227 
	`htc_ª˛aim_rxbuf
(
èrgë
, 
∑ckës
,

2228 &
èrgë
->
ídpoöt
[
∑ckës
->endpoint]);

2231 i‡(
èrgë
->
htc_Êags
 & 
HTC_OP_STATE_STOPPING
) {

2232 
	`©h6kl_w¨n
("host is goingÅo stop blockingÑeceiver for htc_stop\n");

2233 
	`©h6kl_hif_rx_c⁄åﬁ
(
èrgë
->
dev
, 
Ál£
);

2241 i‡(
èrgë
->
rx_°_Êags
 & 
HTC_RECV_WAIT_BUFFERS
) {

2242 
	`©h6kl_w¨n
("host hasÇoÑx buffers blockingÑeceiverÅoÖrevent overrun\n");

2243 
	`©h6kl_hif_rx_c⁄åﬁ
(
èrgë
->
dev
, 
Ál£
);

2245 *
num_pkts
 = 
n_„tched
;

2247  
°©us
;

2248 
	}
}

2255 
htc_∑ckë
 *
	$htc_waô_f‹_˘æ_msg
(
htc_èrgë
 *
èrgë
)

2257 
htc_∑ckë
 *
∑ckë
 = 
NULL
;

2258 
htc_‰ame_hdr
 *
htc_hdr
;

2259 
u32
 
look_ahód
;

2261 i‡(
	`©h6kl_hif_pﬁl_mboxmsg_rx
(
èrgë
->
dev
, &
look_ahód
,

2262 
HTC_TARGET_RESPONSE_TIMEOUT
))

2263  
NULL
;

2265 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2266 "ht¯rx waô cå»look_ahód 0x%X\n", 
look_ahód
);

2268 
htc_hdr
 = (
htc_‰ame_hdr
 *)&
look_ahód
;

2270 i‡(
htc_hdr
->
eid
 !
ENDPOINT_0
)

2271  
NULL
;

2273 
∑ckë
 = 
	`htc_gë_c⁄åﬁ_buf
(
èrgë
, 
Ál£
);

2275 i‡(!
∑ckë
)

2276  
NULL
;

2278 
∑ckë
->
öfo
.
rx
.
rx_Êags
 = 0;

2279 
∑ckë
->
öfo
.
rx
.
exp_hdr
 = 
look_ahód
;

2280 
∑ckë
->
a˘_Àn
 = 
	`À16_to_˝u
(
htc_hdr
->
∑yld_Àn
Ë+ 
HTC_HDR_LENGTH
;

2282 i‡(
∑ckë
->
a˘_Àn
 >Öackë->
buf_Àn
)

2283 
Áû_˘æ_rx
;

2286 
∑ckë
->
com∂ëi⁄
 = 
NULL
;

2289 i‡(
	`©h6kl_htc_rx_∑ckë
(
èrgë
, 
∑ckë
,Öackë->
a˘_Àn
))

2290 
Áû_˘æ_rx
;

2293 
∑ckë
->
°©us
 = 
	`©h6kl_htc_rx_¥o˚ss_hdr
(
èrgë
,Öackë, 
NULL
, NULL);

2295 i‡(
∑ckë
->
°©us
) {

2296 
	`©h6kl_îr
("htc_wait_for_ctrl_msg,áth6kl_htc_rx_process_hdr failed (status = %d)\n",

2297 
∑ckë
->
°©us
);

2298 
Áû_˘æ_rx
;

2301  
∑ckë
;

2303 
Áû_˘æ_rx
:

2304 i‡(
∑ckë
 !
NULL
) {

2305 
	`htc_rxpkt_ª£t
(
∑ckë
);

2306 
	`ª˛aim_rx_˘æ_buf
(
èrgë
, 
∑ckë
);

2309  
NULL
;

2310 
	}
}

2312 
	$©h6kl_htc_mbox_add_rxbuf_mu…ùÀ
(
htc_èrgë
 *
èrgë
,

2313 
li°_hód
 *
pkt_queue
)

2315 
htc_ídpoöt
 *
ídpoöt
;

2316 
htc_∑ckë
 *
fú°_pkt
;

2317 
boﬁ
 
rx_unblock
 = 
Ál£
;

2318 
°©us
 = 0, 
dïth
;

2320 i‡(
	`li°_em±y
(
pkt_queue
))

2321  -
ENOMEM
;

2323 
fú°_pkt
 = 
	`li°_fú°_íåy
(
pkt_queue
, 
htc_∑ckë
, 
li°
);

2325 i‡(
fú°_pkt
->
ídpoöt
 >
ENDPOINT_MAX
)

2326  
°©us
;

2328 
dïth
 = 
	`gë_queue_dïth
(
pkt_queue
);

2330 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2332 
fú°_pkt
->
ídpoöt
, 
dïth
, fú°_pkt->
buf_Àn
);

2334 
ídpoöt
 = &
èrgë
->ídpoöt[
fú°_pkt
->endpoint];

2336 i‡(
èrgë
->
htc_Êags
 & 
HTC_OP_STATE_STOPPING
) {

2337 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

2340 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, 
pkt_queue
, 
li°
) {

2341 
∑ckë
->
°©us
 = -
ECANCELED
;

2342 
	`li°_dñ
(&
∑ckë
->
li°
);

2343 
	`©h6kl_htc_rx_com∂ëe
(
ídpoöt
, 
∑ckë
);

2346  
°©us
;

2349 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

2351 
	`li°_•li˚_èû_öô
(
pkt_queue
, &
ídpoöt
->
rx_bufq
);

2354 i‡(
èrgë
->
rx_°_Êags
 & 
HTC_RECV_WAIT_BUFFERS
) {

2355 i‡(
èrgë
->
ï_waôög
 =
fú°_pkt
->
ídpoöt
) {

2356 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2358 
èrgë
->
ï_waôög
);

2359 
èrgë
->
rx_°_Êags
 &~
HTC_RECV_WAIT_BUFFERS
;

2360 
èrgë
->
ï_waôög
 = 
ENDPOINT_MAX
;

2361 
rx_unblock
 = 
åue
;

2365 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

2367 i‡(
rx_unblock
 && !(
èrgë
->
htc_Êags
 & 
HTC_OP_STATE_STOPPING
))

2369 
	`©h6kl_hif_rx_c⁄åﬁ
(
èrgë
->
dev
, 
åue
);

2371  
°©us
;

2372 
	}
}

2374 
	$©h6kl_htc_mbox_Êush_rx_buf
(
htc_èrgë
 *
èrgë
)

2376 
htc_ídpoöt
 *
ídpoöt
;

2377 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

2378 
i
;

2380 
i
 = 
ENDPOINT_0
; i < 
ENDPOINT_MAX
; i++) {

2381 
ídpoöt
 = &
èrgë
->ídpoöt[
i
];

2382 i‡(!
ídpoöt
->
svc_id
)

2386 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

2387 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
,

2388 &
ídpoöt
->
rx_bufq
, 
li°
) {

2389 
	`li°_dñ
(&
∑ckë
->
li°
);

2390 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

2391 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2393 
∑ckë
,Öackë->
buf_Àn
,

2394 
∑ckë
->
ídpoöt
);

2395 
	`dev_k‰ì_skb
(
∑ckë
->
pkt_˙txt
);

2397 i‡(
∑ckë
->
ídpoöt
 =
ENDPOINT_0
 &&

2398 
∑ckë
->
buf_Àn
 !
ATH6KL_BUFFER_SIZE
) {

2399 
	`k‰ì
(
∑ckë
->
buf_°¨t
);

2400 
	`k‰ì
(
∑ckë
);

2402 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

2404 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

2406 
	}
}

2408 
	$©h6kl_htc_mbox_c⁄n_£rvi˚
(
htc_èrgë
 *
èrgë
,

2409 
htc_£rvi˚_c⁄√˘_ªq
 *
c⁄n_ªq
,

2410 
htc_£rvi˚_c⁄√˘_ª•
 *
c⁄n_ª•
)

2412 
htc_∑ckë
 *
rx_pkt
 = 
NULL
;

2413 
htc_∑ckë
 *
tx_pkt
 = 
NULL
;

2414 
htc_c⁄n_£rvi˚_ª•
 *
ª•_msg
;

2415 
htc_c⁄n_£rvi˚_msg
 *
c⁄n_msg
;

2416 
htc_ídpoöt
 *
ídpoöt
;

2417 
htc_ídpoöt_id
 
assig√d_ï
 = 
ENDPOINT_MAX
;

2418 
max_msg_sz
 = 0;

2419 
°©us
 = 0;

2421 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2423 
èrgë
, 
c⁄n_ªq
->
svc_id
);

2425 i‡(
c⁄n_ªq
->
svc_id
 =
HTC_CTRL_RSVD_SVC
) {

2427 
assig√d_ï
 = 
ENDPOINT_0
;

2428 
max_msg_sz
 = 
HTC_MAX_CTRL_MSG_LEN
;

2431 
tx_pkt
 = 
	`htc_gë_c⁄åﬁ_buf
(
èrgë
, 
åue
);

2433 i‡(!
tx_pkt
)

2434  -
ENOMEM
;

2436 
c⁄n_msg
 = (
htc_c⁄n_£rvi˚_msg
 *)
tx_pkt
->
buf
;

2437 
	`mem£t
(
c⁄n_msg
, 0, (*conn_msg));

2438 
c⁄n_msg
->
msg_id
 = 
	`˝u_to_À16
(
HTC_MSG_CONN_SVC_ID
);

2439 
c⁄n_msg
->
svc_id
 = 
	`˝u_to_À16
(
c⁄n_ªq
->svc_id);

2440 
c⁄n_msg
->
c⁄n_Êags
 = 
	`˝u_to_À16
(
c⁄n_ªq
->conn_flags);

2442 
	`£t_htc_pkt_öfo
(
tx_pkt
, 
NULL
, (
u8
 *Ë
c⁄n_msg
,

2443 (*
c⁄n_msg
Ë+ c⁄n_msg->
svc_mëa_Àn
,

2444 
ENDPOINT_0
, 
HTC_SERVICE_TX_PACKET_TAG
);

2447 
tx_pkt
->
com∂ëi⁄
 = 
NULL
;

2448 
	`©h6kl_htc_tx_¥ï_pkt
(
tx_pkt
, 0, 0, 0);

2449 
°©us
 = 
	`©h6kl_htc_tx_issue
(
èrgë
, 
tx_pkt
);

2451 i‡(
°©us
)

2452 
Áû_tx
;

2455 
rx_pkt
 = 
	`htc_waô_f‹_˘æ_msg
(
èrgë
);

2457 i‡(!
rx_pkt
) {

2458 
°©us
 = -
ENOMEM
;

2459 
Áû_tx
;

2462 
ª•_msg
 = (
htc_c⁄n_£rvi˚_ª•
 *)
rx_pkt
->
buf
;

2464 i‡((
	`À16_to_˝u
(
ª•_msg
->
msg_id
Ë!
HTC_MSG_CONN_SVC_RESP_ID
)

2465 || (
rx_pkt
->
a˘_Àn
 < (*
ª•_msg
))) {

2466 
°©us
 = -
ENOMEM
;

2467 
Áû_tx
;

2470 
c⁄n_ª•
->
ª•_code
 = 
ª•_msg
->
°©us
;

2472 i‡(
ª•_msg
->
°©us
 !
HTC_SERVICE_SUCCESS
) {

2473 
	`©h6kl_îr
("target failed service 0x%X "

2475 
	`À16_to_˝u
(
ª•_msg
->
svc_id
),

2476 
ª•_msg
->
°©us
);

2477 
°©us
 = -
ENOMEM
;

2478 
Áû_tx
;

2481 
assig√d_ï
 = (
htc_ídpoöt_id
)
ª•_msg
->
eid
;

2482 
max_msg_sz
 = 
	`À16_to_˝u
(
ª•_msg
->max_msg_sz);

2485 i‡(
assig√d_ï
 >
ENDPOINT_MAX
 ||ássig√d_ï <
ENDPOINT_UNUSED


2486 || !
max_msg_sz
) {

2487 
°©us
 = -
ENOMEM
;

2488 
Áû_tx
;

2491 
ídpoöt
 = &
èrgë
->ídpoöt[
assig√d_ï
];

2492 
ídpoöt
->
eid
 = 
assig√d_ï
;

2493 i‡(
ídpoöt
->
svc_id
) {

2494 
°©us
 = -
ENOMEM
;

2495 
Áû_tx
;

2499 
c⁄n_ª•
->
ídpoöt
 = 
assig√d_ï
;

2500 
c⁄n_ª•
->
Àn_max
 = 
max_msg_sz
;

2505 
ídpoöt
->
svc_id
 = 
c⁄n_ªq
->svc_id;

2507 
ídpoöt
->
max_txq_dïth
 = 
c⁄n_ªq
->max_txq_depth;

2508 
ídpoöt
->
Àn_max
 = 
max_msg_sz
;

2509 
ídpoöt
->
ï_cb
 = 
c⁄n_ªq
->ep_cb;

2510 
ídpoöt
->
¸ed_di°
.
svc_id
 = 
c⁄n_ªq
->svc_id;

2511 
ídpoöt
->
¸ed_di°
.
htc_ï
 =Éndpoint;

2512 
ídpoöt
->
¸ed_di°
.ídpoöà
assig√d_ï
;

2513 
ídpoöt
->
¸ed_di°
.
¸ed_sz
 = 
èrgë
->
tgt_¸ed_sz
;

2515 
ídpoöt
->
svc_id
) {

2516 
WMI_DATA_BK_SVC
:

2517 
ídpoöt
->
tx_dr›_∑ckë_thªshﬁd
 = 
MAX_DEF_COOKIE_NUM
 / 3;

2519 
WMI_DATA_BE_SVC
:

2520 
ídpoöt
->
tx_dr›_∑ckë_thªshﬁd
 = 
MAX_DEF_COOKIE_NUM
 / 4;

2522 
WMI_DATA_VI_SVC
:

2523 
ídpoöt
->
tx_dr›_∑ckë_thªshﬁd
 = 
MAX_DEF_COOKIE_NUM
 / 6;

2526 
ídpoöt
->
tx_dr›_∑ckë_thªshﬁd
 = 
MAX_HI_COOKIE_NUM
;

2530 i‡(
c⁄n_ªq
->
max_rxmsg_sz
) {

2536 i‡(
c⁄n_ªq
->
max_rxmsg_sz
 > 
max_msg_sz
) {

2537 
°©us
 = -
ENOMEM
;

2538 
Áû_tx
;

2540 
ídpoöt
->
¸ed_di°
.
¸ed_≥r_msg
 =

2541 
c⁄n_ªq
->
max_rxmsg_sz
 / 
èrgë
->
tgt_¸ed_sz
;

2543 
ídpoöt
->
¸ed_di°
.
¸ed_≥r_msg
 =

2544 
max_msg_sz
 / 
èrgë
->
tgt_¸ed_sz
;

2546 i‡(!
ídpoöt
->
¸ed_di°
.
¸ed_≥r_msg
)

2547 
ídpoöt
->
¸ed_di°
.
¸ed_≥r_msg
 = 1;

2550 
ídpoöt
->
c⁄n_Êags
 = 
c⁄n_ªq
->
Êags
;

2552 
Áû_tx
:

2553 i‡(
tx_pkt
)

2554 
	`htc_ª˛aim_tx˘æ_buf
(
èrgë
, 
tx_pkt
);

2556 i‡(
rx_pkt
) {

2557 
	`htc_rxpkt_ª£t
(
rx_pkt
);

2558 
	`ª˛aim_rx_˘æ_buf
(
èrgë
, 
rx_pkt
);

2561  
°©us
;

2562 
	}
}

2564 
	$ª£t_ï_°©e
(
htc_èrgë
 *
èrgë
)

2566 
htc_ídpoöt
 *
ídpoöt
;

2567 
i
;

2569 
i
 = 
ENDPOINT_0
; i < 
ENDPOINT_MAX
; i++) {

2570 
ídpoöt
 = &
èrgë
->ídpoöt[
i
];

2571 
	`mem£t
(&
ídpoöt
->
¸ed_di°
, 0, (endpoint->cred_dist));

2572 
ídpoöt
->
svc_id
 = 0;

2573 
ídpoöt
->
Àn_max
 = 0;

2574 
ídpoöt
->
max_txq_dïth
 = 0;

2575 
	`mem£t
(&
ídpoöt
->
ï_°
, 0,

2576 (
ídpoöt
->
ï_°
));

2577 
	`INIT_LIST_HEAD
(&
ídpoöt
->
rx_bufq
);

2578 
	`INIT_LIST_HEAD
(&
ídpoöt
->
txq
);

2579 
ídpoöt
->
èrgë
 =Åarget;

2584 
	`INIT_LIST_HEAD
(&
èrgë
->
¸ed_di°_li°
);

2585 
	}
}

2587 
	$©h6kl_htc_mbox_gë_rxbuf_num
(
htc_èrgë
 *
èrgë
,

2588 
htc_ídpoöt_id
 
ídpoöt
)

2590 
num
;

2592 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

2593 
num
 = 
	`gë_queue_dïth
(&(
èrgë
->
ídpoöt
[ídpoöt].
rx_bufq
));

2594 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

2595  
num
;

2596 
	}
}

2598 
	$htc_£tup_msg_bndl
(
htc_èrgë
 *
èrgë
)

2601 
èrgë
->
msg_≥r_bndl_max
 = 
	`mö
(
HTC_HOST_MAX_MSG_PER_BUNDLE
,

2602 
èrgë
->
msg_≥r_bndl_max
);

2604 i‡(
	`©h6kl_hif_íabÀ_sˇâî
(
èrgë
->
dev
->
¨
)) {

2605 
èrgë
->
msg_≥r_bndl_max
 = 0;

2610 
èrgë
->
msg_≥r_bndl_max
 = 
	`mö
—¨gë->
max_sˇt_íåõs
,

2611 
èrgë
->
msg_≥r_bndl_max
);

2613 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

2615 
èrgë
->
msg_≥r_bndl_max
);

2618 
èrgë
->
max_rx_bndl_sz
 =Å¨gë->
max_x„r_sz≥r_sˇåeq
;

2620 
èrgë
->
max_tx_bndl_sz
 = 
	`mö
(
HIF_MBOX0_EXT_WIDTH
,

2621 
èrgë
->
max_x„r_sz≥r_sˇåeq
);

2623 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "htc max_rx_bndl_sz %d max_tx_bndl_sz %d\n",

2624 
èrgë
->
max_rx_bndl_sz
,Å¨gë->
max_tx_bndl_sz
);

2626 i‡(
èrgë
->
max_tx_bndl_sz
)

2628 
èrgë
->
tx_bndl_mask
 = (1 << 
WMM_NUM_AC
) - 1;

2630 i‡(
èrgë
->
max_rx_bndl_sz
)

2631 
èrgë
->
rx_bndl_íabÀ
 = 
åue
;

2633 i‡((
èrgë
->
tgt_¸ed_sz
 %Å¨gë->
block_sz
) != 0) {

2634 
	`©h6kl_w¨n
("credit size: %d isÇot blockáligned! Disabling send bundling\n",

2635 
èrgë
->
tgt_¸ed_sz
);

2643 
èrgë
->
tx_bndl_mask
 = 0;

2645 
	}
}

2647 
	$©h6kl_htc_mbox_waô_èrgë
(
htc_èrgë
 *
èrgë
)

2649 
htc_∑ckë
 *
∑ckë
 = 
NULL
;

2650 
htc_ªady_ext_msg
 *
rdy_msg
;

2651 
htc_£rvi˚_c⁄√˘_ªq
 
c⁄√˘
;

2652 
htc_£rvi˚_c⁄√˘_ª•
 
ª•
;

2653 
°©us
;

2656 i‡(
èrgë
->
dev
->
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_USB
) {

2657 
	`©h6kl_îr
("HTC doesn't support USB yet. Patience!\n");

2658  -
EOPNOTSUPP
;

2662 
∑ckë
 = 
	`htc_waô_f‹_˘æ_msg
(
èrgë
);

2664 i‡(!
∑ckë
)

2665  -
ENOMEM
;

2668 
rdy_msg
 = (
htc_ªady_ext_msg
 *)
∑ckë
->
buf
;

2670 i‡((
	`À16_to_˝u
(
rdy_msg
->
vî2_0_öfo
.
msg_id
Ë!
HTC_MSG_READY_ID
) ||

2671 (
∑ckë
->
a˘_Àn
 < (
htc_ªady_msg
))) {

2672 
°©us
 = -
ENOMEM
;

2673 
Áû_waô_èrgë
;

2676 i‡(!
rdy_msg
->
vî2_0_öfo
.
¸ed_˙t
 || !rdy_msg->vî2_0_öfo.
¸ed_sz
) {

2677 
°©us
 = -
ENOMEM
;

2678 
Áû_waô_èrgë
;

2681 
èrgë
->
tgt_¸eds
 = 
	`À16_to_˝u
(
rdy_msg
->
vî2_0_öfo
.
¸ed_˙t
);

2682 
èrgë
->
tgt_¸ed_sz
 = 
	`À16_to_˝u
(
rdy_msg
->
vî2_0_öfo
.
¸ed_sz
);

2684 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

2686 
èrgë
->
tgt_¸eds
,Å¨gë->
tgt_¸ed_sz
);

2689 i‡(
∑ckë
->
a˘_Àn
 >(
htc_ªady_ext_msg
)) {

2691 
èrgë
->
htc_tgt_vî
 = 
rdy_msg
->
htc_vî
;

2692 
èrgë
->
msg_≥r_bndl_max
 = 
rdy_msg
->
msg_≥r_htc_bndl
;

2695 
èrgë
->
htc_tgt_vî
 = 
HTC_VERSION_2P0
;

2696 
èrgë
->
msg_≥r_bndl_max
 = 0;

2699 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "htc usingÖrotocol %s (%d) bndl_size %d\n",

2700 (
èrgë
->
htc_tgt_vî
 =
HTC_VERSION_2P0
) ? "2.0" : ">= 2.1",

2701 
èrgë
->
htc_tgt_vî
,

2702 
èrgë
->
msg_≥r_bndl_max
);

2704 i‡(
èrgë
->
msg_≥r_bndl_max
 > 0)

2705 
	`htc_£tup_msg_bndl
(
èrgë
);

2708 
	`mem£t
(&
c⁄√˘
, 0, (connect));

2709 
	`mem£t
(&
ª•
, 0, (resp));

2710 
c⁄√˘
.
ï_cb
.
rx
 = 
htc_˘æ_rx
;

2711 
c⁄√˘
.
ï_cb
.
rx_ªfûl
 = 
NULL
;

2712 
c⁄√˘
.
ï_cb
.
tx_fuŒ
 = 
NULL
;

2713 
c⁄√˘
.
max_txq_dïth
 = 
NUM_CONTROL_BUFFERS
;

2714 
c⁄√˘
.
svc_id
 = 
HTC_CTRL_RSVD_SVC
;

2717 
°©us
 = 
	`©h6kl_htc_mbox_c⁄n_£rvi˚
((*)
èrgë
, &
c⁄√˘
, &
ª•
);

2719 i‡(
°©us
)

2724 
	`©h6kl_hif_˛ónup_sˇâî
(
èrgë
->
dev
->
¨
);

2726 
Áû_waô_èrgë
:

2727 i‡(
∑ckë
) {

2728 
	`htc_rxpkt_ª£t
(
∑ckë
);

2729 
	`ª˛aim_rx_˘æ_buf
(
èrgë
, 
∑ckë
);

2732  
°©us
;

2733 
	}
}

2739 
	$©h6kl_htc_mbox_°¨t
(
htc_èrgë
 *
èrgë
)

2741 
htc_∑ckë
 *
∑ckë
;

2742 
°©us
;

2744 
	`mem£t
(&
èrgë
->
dev
->
úq_¥oc_ªg
, 0,

2745 (
èrgë
->
dev
->
úq_¥oc_ªg
));

2748 
	`©h6kl_hif_dißbÀ_öås
(
èrgë
->
dev
);

2750 
èrgë
->
htc_Êags
 = 0;

2751 
èrgë
->
rx_°_Êags
 = 0;

2754 (
∑ckë
 = 
	`htc_gë_c⁄åﬁ_buf
(
èrgë
, 
Ál£
)Ë!
NULL
) {

2755 
°©us
 = 
	`htc_add_rxbuf
(
èrgë
, 
∑ckë
);

2756 i‡(
°©us
)

2757  
°©us
;

2761 
	`©h6kl_¸edô_öô
(
èrgë
->
¸edô_öfo
, &èrgë->
¸ed_di°_li°
,

2762 
èrgë
->
tgt_¸eds
);

2764 
	`dump_¸ed_di°_°©s
(
èrgë
);

2767 
°©us
 = 
	`htc_£tup_tx_com∂ëe
(
èrgë
);

2769 i‡(
°©us
)

2770  
°©us
;

2773 
°©us
 = 
	`©h6kl_hif_unmask_öås
(
èrgë
->
dev
);

2775 i‡(
°©us
)

2776 
	`©h6kl_htc_mbox_°›
(
èrgë
);

2778  
°©us
;

2779 
	}
}

2781 
	$©h6kl_htc_ª£t
(
htc_èrgë
 *
èrgë
)

2783 
u32
 
block_size
, 
˘æ_bufsz
;

2784 
htc_∑ckë
 *
∑ckë
;

2785 
i
;

2787 
	`ª£t_ï_°©e
(
èrgë
);

2789 
block_size
 = 
èrgë
->
dev
->
¨
->
mbox_öfo
.block_size;

2791 
˘æ_bufsz
 = (
block_size
 > 
HTC_MAX_CTRL_MSG_LEN
) ?

2792 (
block_size
 + 
HTC_HDR_LENGTH
) :

2793 (
HTC_MAX_CTRL_MSG_LEN
 + 
HTC_HDR_LENGTH
);

2795 
i
 = 0; i < 
NUM_CONTROL_BUFFERS
; i++) {

2796 
∑ckë
 = 
	`kzÆloc
((*∑ckë), 
GFP_KERNEL
);

2797 i‡(!
∑ckë
)

2798  -
ENOMEM
;

2800 
∑ckë
->
buf_°¨t
 = 
	`kzÆloc
(
˘æ_bufsz
, 
GFP_KERNEL
);

2801 i‡(!
∑ckë
->
buf_°¨t
) {

2802 
	`k‰ì
(
∑ckë
);

2803  -
ENOMEM
;

2806 
∑ckë
->
buf_Àn
 = 
˘æ_bufsz
;

2807 i‡(
i
 < 
NUM_CONTROL_RX_BUFFERS
) {

2808 
∑ckë
->
a˘_Àn
 = 0;

2809 
∑ckë
->
buf
 =Öackë->
buf_°¨t
;

2810 
∑ckë
->
ídpoöt
 = 
ENDPOINT_0
;

2811 
	`li°_add_èû
(&
∑ckë
->
li°
, &
èrgë
->
‰ì_˘æ_rxbuf
);

2813 
	`li°_add_èû
(&
∑ckë
->
li°
, &
èrgë
->
‰ì_˘æ_txbuf
);

2817 
	}
}

2820 
	$©h6kl_htc_mbox_°›
(
htc_èrgë
 *
èrgë
)

2822 
	`•ö_lock_bh
(&
èrgë
->
htc_lock
);

2823 
èrgë
->
htc_Êags
 |
HTC_OP_STATE_STOPPING
;

2824 
	`•ö_u∆ock_bh
(&
èrgë
->
htc_lock
);

2831 
	`©h6kl_hif_mask_öås
(
èrgë
->
dev
);

2833 
	`©h6kl_htc_Êush_txï_Æl
(
èrgë
);

2835 
	`©h6kl_htc_mbox_Êush_rx_buf
(
èrgë
);

2837 
	`©h6kl_htc_ª£t
(
èrgë
);

2838 
	}
}

2840 *
	$©h6kl_htc_mbox_¸óã
(
©h6kl
 *
¨
)

2842 
htc_èrgë
 *
èrgë
 = 
NULL
;

2843 
°©us
 = 0;

2845 
èrgë
 = 
	`kzÆloc
((*èrgë), 
GFP_KERNEL
);

2846 i‡(!
èrgë
) {

2847 
	`©h6kl_îr
("unableÅoállocate memory\n");

2848  
NULL
;

2851 
èrgë
->
dev
 = 
	`kzÆloc
((*èrgë->dev), 
GFP_KERNEL
);

2852 i‡(!
èrgë
->
dev
) {

2853 
	`©h6kl_îr
("unableÅoállocate memory\n");

2854 
°©us
 = -
ENOMEM
;

2855 
îr_htc_˛ónup
;

2858 
	`•ö_lock_öô
(&
èrgë
->
htc_lock
);

2859 
	`•ö_lock_öô
(&
èrgë
->
rx_lock
);

2860 
	`•ö_lock_öô
(&
èrgë
->
tx_lock
);

2862 
	`INIT_LIST_HEAD
(&
èrgë
->
‰ì_˘æ_txbuf
);

2863 
	`INIT_LIST_HEAD
(&
èrgë
->
‰ì_˘æ_rxbuf
);

2864 
	`INIT_LIST_HEAD
(&
èrgë
->
¸ed_di°_li°
);

2866 
èrgë
->
dev
->
¨
 =ár;

2867 
èrgë
->
dev
->
htc_˙xt
 =Åarget;

2868 
èrgë
->
ï_waôög
 = 
ENDPOINT_MAX
;

2870 
°©us
 = 
	`©h6kl_hif_£tup
(
èrgë
->
dev
);

2871 i‡(
°©us
)

2872 
îr_htc_˛ónup
;

2874 
°©us
 = 
	`©h6kl_htc_ª£t
(
èrgë
);

2875 i‡(
°©us
)

2876 
îr_htc_˛ónup
;

2878  
èrgë
;

2880 
îr_htc_˛ónup
:

2881 
	`©h6kl_htc_mbox_˛ónup
(
èrgë
);

2883  
NULL
;

2884 
	}
}

2887 
	$©h6kl_htc_mbox_˛ónup
(
htc_èrgë
 *
èrgë
)

2889 
htc_∑ckë
 *
∑ckë
, *
tmp_∑ckë
;

2892 i‡(
èrgë
->
dev
->
¨
->
hif_ty≥
 !
ATH6KL_HIF_TYPE_USB
)

2893 
	`©h6kl_hif_˛ónup_sˇâî
(
èrgë
->
dev
->
¨
);

2895 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_∑ckë
,

2896 &
èrgë
->
‰ì_˘æ_txbuf
, 
li°
) {

2897 
	`li°_dñ
(&
∑ckë
->
li°
);

2898 
	`k‰ì
(
∑ckë
->
buf_°¨t
);

2899 
	`k‰ì
(
∑ckë
);

2902 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_∑ckë
,

2903 &
èrgë
->
‰ì_˘æ_rxbuf
, 
li°
) {

2904 
	`li°_dñ
(&
∑ckë
->
li°
);

2905 
	`k‰ì
(
∑ckë
->
buf_°¨t
);

2906 
	`k‰ì
(
∑ckë
);

2909 
	`k‰ì
(
èrgë
->
dev
);

2910 
	`k‰ì
(
èrgë
);

2911 
	}
}

2913 
	$©h6kl_htc_mbox_°©
(
htc_èrgë
 *
èrgë
,

2914 
u8
 *
buf
, 
buf_Àn
)

2916 
htc_ídpoöt
 *
ï
;

2917 
htc_ídpoöt_°©s
 *
ï_°
;

2918 
©h6kl_htc_¸edô_öfo
 *
¸edô_öfo
;

2919 
li°_hód
 *
tx_queue
;

2920 
i
, 
tmp
, 
Àn
 = 0;

2922 i‡((!
èrgë
Ë|| (!
buf
))

2925 
¸edô_öfo
 = 
èrgë
->credit_info;

2926 i‡(!
¸edô_öfo
)

2929 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2931 
èrgë
->
tgt_¸ed_sz
,

2932 
¸edô_öfo
->
cur_‰ì_¸edôs
,

2933 
¸edô_öfo
->
tŸÆ_avaû_¸edôs
);

2935 
i
 = 
ENDPOINT_2
; i <
ENDPOINT_5
; i++) {

2936 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üí, "EP-%d\n", 
i
);

2938 
ï
 = &
èrgë
->
ídpoöt
[
i
];

2939 
tx_queue
 = &
ï
->
txq
;

2940 
ï_°
 = &
ï
->ep_st;

2942 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

2943 
tmp
 = 
	`gë_queue_dïth
(
tx_queue
);

2944 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

2946 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2948 
ï
->
tx_¥oc_˙t
,Ép->
rx_¥oc_˙t
);

2949 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2951 
tmp
, 
ï
->
max_txq_dïth
);

2952 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2954 
ï
->
£qno
);

2955 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2957 
ï_°
->
¸ed_low_ödiˇã
);

2958 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2960 
ï_°
->
¸ed_Ωt_‰om_rx
);

2961 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2963 
ï_°
->
¸ed_Ωt_‰om_Ÿhî
);

2964 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2966 
ï_°
->
¸ed_Ωt_ï0
);

2967 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2969 
ï_°
->
¸ed_‰om_rx
);

2970 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2972 
ï_°
->
¸ed_‰om_Ÿhî
);

2973 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2975 
ï_°
->
¸ed_‰om_ï0
);

2976 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2978 
ï_°
->
¸ed_cosumd
);

2979 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2981 
ï_°
->
¸ed_ªäd
);

2982 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2984 
ï_°
->
tx_issued
);

2985 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2987 
ï_°
->
tx_dr›≥d
);

2988 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2990 
ï_°
->
tx_¸ed_Ωt
);

2991 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2993 
ï_°
->
rx_pkts
);

2994 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2996 
ï_°
->
rx_lkahds
);

2997 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2999 
ï_°
->
rx_Æloc_thªsh_hô
);

3000 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3002 
ï_°
->
rxÆloc_thªsh_byã
);

3003 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3005 
ï_°
->
tx_pkt_bundÀd
);

3006 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3008 
ï_°
->
tx_bundÀs
);

3009 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3011 
ï_°
->
rx_bundl
);

3012 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3014 
ï_°
->
rx_bundÀ_lkahd
);

3015 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

3017 
ï_°
->
rx_bundÀ_‰om_hdr
);

3020  
Àn
;

3021 
	}
}

3023 
	$©h6kl_htc_mbox_°›_√tif_queue_fuŒ
(
htc_èrgë
 *
èrgë
)

3026 
	}
}

3028 
	$©h6kl_htc_mbox_wmm_scheduÀ_ch™ge
(
htc_èrgë
 *
èrgë
,

3029 
boﬁ
 
ch™ge
)

3031 
li°_hód
 *
ï_li°
 = &
èrgë
->
¸ed_di°_li°
;

3032 
htc_ídpoöt_¸edô_di°
 *
cur_ï_di°
;

3034 
	`li°_f‹_óch_íåy
(
cur_ï_di°
, 
ï_li°
, 
li°
) {

3035 
cur_ï_di°
->
¸ed_Æloc_max
 = 0;

3037 i‡(
cur_ï_di°
->
svc_id
 =
WMI_DATA_VI_SVC
) {

3038 
htc_ídpoöt
 *
ídpoöt
 = 
cur_ï_di°
->
htc_ï
;

3040 i‡(
ch™ge
 =
åue
) {

3041 
cur_ï_di°
->
¸ed_Æloc_max
 =

3042 
cur_ï_di°
->
¸ed_n‹m
 - 2;

3043 
ídpoöt
->
tx_dr›_∑ckë_thªshﬁd
 =

3044 
MAX_DEF_COOKIE_NUM
 / 4;

3046 
ídpoöt
->
tx_dr›_∑ckë_thªshﬁd
 =

3047 
MAX_DEF_COOKIE_NUM
 / 6;

3053 
	}
}

3055 
	$©h6kl_htc_mbox_ch™ge_¸edô_by∑ss
(
htc_èrgë
 *
èrgë
,

3056 
u8
 
åaffic_˛ass
)

3058 i‡(
åaffic_˛ass
 =
WMM_AC_BK
)

3062 
	}
}

3064 c⁄° 
©h6kl_htc_›s
 
	g©h6kl_htc_mbox_›s
 = {

3065 .
¸óã
 = 
©h6kl_htc_mbox_¸óã
,

3066 .
	gwaô_èrgë
 = 
©h6kl_htc_mbox_waô_èrgë
,

3067 .
	g°¨t
 = 
©h6kl_htc_mbox_°¨t
,

3068 .
	gc⁄n_£rvi˚
 = 
©h6kl_htc_mbox_c⁄n_£rvi˚
,

3069 .
	gtx
 = 
©h6kl_htc_mbox_tx
,

3070 .
	g°›
 = 
©h6kl_htc_mbox_°›
,

3071 .
	g˛ónup
 = 
©h6kl_htc_mbox_˛ónup
,

3072 .
	gÊush_txï
 = 
©h6kl_htc_mbox_Êush_txï
,

3073 .
	gÊush_rx_buf
 = 
©h6kl_htc_mbox_Êush_rx_buf
,

3074 .
	gödiˇã_a˘ivôy_ch™ge
 = 
©h6kl_htc_mbox_ödiˇã_a˘ivôy_ch™ge
,

3075 .
	ggë_rxbuf_num
 = 
©h6kl_htc_mbox_gë_rxbuf_num
,

3076 .
	gadd_rxbuf_mu…ùÀ
 = 
©h6kl_htc_mbox_add_rxbuf_mu…ùÀ
,

3077 .
	g¸edô_£tup
 = 
©h6kl_htc_mbox_¸edô_£tup
,

3078 .
	ggë_°©
 = 
©h6kl_htc_mbox_°©
,

3079 .
	g°›_√tif_queue_fuŒ
 = 
©h6kl_htc_mbox_°›_√tif_queue_fuŒ
,

3080 .
	gödiˇã_wmm_scheduÀ_ch™ge
 = 
©h6kl_htc_mbox_wmm_scheduÀ_ch™ge
,

3081 .
	gch™ge_¸edô_by∑ss
 = 
©h6kl_htc_mbox_ch™ge_¸edô_by∑ss
,

3084 
	$©h6kl_htc_mbox_©èch
(
©h6kl
 *
¨
)

3086 
¨
->
htc_›s
 = &
©h6kl_htc_mbox_›s
;

3087 
	}
}

	@htc.h

17 #i‚de‡
HTC_H


18 
	#HTC_H


	)

20 
	~"c‹e.h
"

21 
	~"comm⁄.h
"

26 
	#HTC_FLAGS_NEED_CREDIT_UPDATE
 (1 << 0)

	)

27 
	#HTC_FLAGS_SEND_BUNDLE
 (1 << 1)

	)

28 
	#HTC_FLAGS_TX_FIXUP_NETBUF
 (1 << 2)

	)

31 
	#HTC_FLG_RX_UNUSED
 (1 << 0)

	)

32 
	#HTC_FLG_RX_TRAILER
 (1 << 1)

	)

34 
	#HTC_FLG_RX_BNDL_CNT
 (0xF0)

	)

35 
	#HTC_FLG_RX_BNDL_CNT_S
 4

	)

37 
	#HTC_HDR_LENGTH
 ((
htc_‰ame_hdr
))

	)

38 
	#HTC_MAX_PAYLOAD_LENGTH
 (4096 - (
htc_‰ame_hdr
))

	)

42 
	#HTC_MSG_READY_ID
 1

	)

43 
	#HTC_MSG_CONN_SVC_ID
 2

	)

44 
	#HTC_MSG_CONN_SVC_RESP_ID
 3

	)

45 
	#HTC_MSG_SETUP_COMPLETE_ID
 4

	)

46 
	#HTC_MSG_SETUP_COMPLETE_EX_ID
 5

	)

48 
	#HTC_MAX_CTRL_MSG_LEN
 256

	)

50 
	#HTC_VERSION_2P0
 0x00

	)

51 
	#HTC_VERSION_2P1
 0x01

	)

53 
	#HTC_SERVICE_META_DATA_MAX_LENGTH
 128

	)

55 
	#HTC_CONN_FLGS_THRESH_LVL_QUAT
 0x0

	)

56 
	#HTC_CONN_FLGS_THRESH_LVL_HALF
 0x1

	)

57 
	#HTC_CONN_FLGS_THRESH_LVL_THREE_QUAT
 0x2

	)

58 
	#HTC_CONN_FLGS_REDUCE_CRED_DRIB
 0x4

	)

59 
	#HTC_CONN_FLGS_THRESH_MASK
 0x3

	)

61 
	#HTC_CONN_FLGS_DISABLE_CRED_FLOW_CTRL
 (1 << 3)

	)

62 
	#HTC_CONN_FLGS_SET_RECV_ALLOC_SHIFT
 8

	)

63 
	#HTC_CONN_FLGS_SET_RECV_ALLOC_MASK
 0xFF00

	)

66 
	#HTC_SERVICE_SUCCESS
 0

	)

67 
	#HTC_SERVICE_NOT_FOUND
 1

	)

68 
	#HTC_SERVICE_FAILED
 2

	)

71 
	#HTC_SERVICE_NO_RESOURCES
 3

	)

74 
	#HTC_SERVICE_NO_MORE_EP
 4

	)

77 
	#HTC_RECORD_NULL
 0

	)

78 
	#HTC_RECORD_CREDITS
 1

	)

79 
	#HTC_RECORD_LOOKAHEAD
 2

	)

80 
	#HTC_RECORD_LOOKAHEAD_BUNDLE
 3

	)

82 
	#HTC_SETUP_COMP_FLG_RX_BNDL_EN
 (1 << 0)

	)

83 
	#HTC_SETUP_COMP_FLG_DISABLE_TX_CREDIT_FLOW
 (1 << 1)

	)

85 
	#MAKE_SERVICE_ID
(
group
, 
ödex
) \

86 ()((()
group
 << 8Ë| ()(
ödex
))

	)

89 
	#HTC_CTRL_RSVD_SVC
 
	`MAKE_SERVICE_ID
(
RSVD_SERVICE_GROUP
, 1)

	)

90 
	#WMI_CONTROL_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 0)

	)

91 
	#WMI_DATA_BE_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 1)

	)

92 
	#WMI_DATA_BK_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 2)

	)

93 
	#WMI_DATA_VI_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 3)

	)

94 
	#WMI_DATA_VO_SVC
 
	`MAKE_SERVICE_ID
(
WMI_SERVICE_GROUP
, 4)

	)

95 
	#WMI_MAX_SERVICES
 5

	)

97 
	#WMM_NUM_AC
 4

	)

100 
	#HTC_TX_PACKET_TAG_ALL
 0

	)

101 
	#HTC_SERVICE_TX_PACKET_TAG
 1

	)

102 
	#HTC_TX_PACKET_TAG_USER_DEFINED
 (
HTC_SERVICE_TX_PACKET_TAG
 + 9)

	)

105 
	#HTC_RX_FLAGS_INDICATE_MORE_PKTS
 (1 << 0)

	)

108 
	#ENDPOINT1
 0

	)

110 
	#HTC_MAILBOX_NUM_MAX
 4

	)

113 
	#HTC_FLGS_TX_BNDL_PAD_EN
 (1 << 0)

	)

114 
	#HTC_EP_ACTIVE
 ((
u32
Ë(1u << 31))

	)

117 
	#HTC_TARGET_RESPONSE_TIMEOUT
 2000

	)

118 
	#HTC_TARGET_RESPONSE_POLL_WAIT
 10

	)

119 
	#HTC_TARGET_RESPONSE_POLL_MS
 (
HTC_TARGET_RESPONSE_POLL_WAIT
)

	)

120 
	#HTC_TARGET_RESPONSE_POLL_COUNT
 200

	)

121 
	#HTC_TARGET_DEBUG_INTR_MASK
 0x01

	)

122 
	#HTC_TARGET_CREDIT_INTR_MASK
 0xF0

	)

124 
	#HTC_HOST_MAX_MSG_PER_BUNDLE
 8

	)

125 
	#HTC_MIN_HTC_MSGS_TO_BUNDLE
 2

	)

129 
	#HTC_RX_PKT_IGNORE_LOOKAHEAD
 (1 << 0)

	)

130 
	#HTC_RX_PKT_REFRESH_HDR
 (1 << 1)

	)

131 
	#HTC_RX_PKT_PART_OF_BUNDLE
 (1 << 2)

	)

132 
	#HTC_RX_PKT_NO_RECYCLE
 (1 << 3)

	)

134 
	#NUM_CONTROL_BUFFERS
 8

	)

135 
	#NUM_CONTROL_TX_BUFFERS
 2

	)

136 
	#NUM_CONTROL_RX_BUFFERS
 (
NUM_CONTROL_BUFFERS
 - 
NUM_CONTROL_TX_BUFFERS
)

	)

138 
	#HTC_RECV_WAIT_BUFFERS
 (1 << 0)

	)

139 
	#HTC_OP_STATE_STOPPING
 (1 << 0)

	)

140 
	#HTC_OP_STATE_SETUP_COMPLETE
 (1 << 1)

	)

156 
	shtc_‰ame_hdr
 {

157 
u8
 
	meid
;

158 
u8
 
	mÊags
;

161 
__À16
 
	m∑yld_Àn
;

165 
u8
 
	m˘æ
[2];

166 } 
	g__∑cked
;

169 
	shtc_ªady_msg
 {

170 
__À16
 
	mmsg_id
;

171 
__À16
 
	m¸ed_˙t
;

172 
__À16
 
	m¸ed_sz
;

173 
u8
 
	mmax_ï
;

174 
u8
 
	m∑d
;

175 } 
	g__∑cked
;

178 
	shtc_ªady_ext_msg
 {

179 
htc_ªady_msg
 
	mvî2_0_öfo
;

180 
u8
 
	mhtc_vî
;

181 
u8
 
	mmsg_≥r_htc_bndl
;

182 } 
	g__∑cked
;

185 
	shtc_c⁄n_£rvi˚_msg
 {

186 
__À16
 
	mmsg_id
;

187 
__À16
 
	msvc_id
;

188 
__À16
 
	mc⁄n_Êags
;

189 
u8
 
	msvc_mëa_Àn
;

190 
u8
 
	m∑d
;

191 } 
	g__∑cked
;

194 
	shtc_c⁄n_£rvi˚_ª•
 {

195 
__À16
 
	mmsg_id
;

196 
__À16
 
	msvc_id
;

197 
u8
 
	m°©us
;

198 
u8
 
	meid
;

199 
__À16
 
	mmax_msg_sz
;

200 
u8
 
	msvc_mëa_Àn
;

201 
u8
 
	m∑d
;

202 } 
	g__∑cked
;

204 
	shtc_£tup_comp_msg
 {

205 
__À16
 
	mmsg_id
;

206 } 
	g__∑cked
;

209 
	shtc_£tup_comp_ext_msg
 {

210 
__À16
 
	mmsg_id
;

211 
__À32
 
	mÊags
;

212 
u8
 
	mmsg_≥r_rxbndl
;

213 
u8
 
	mRsvd
[3];

214 } 
	g__∑cked
;

216 
	shtc_ªc‹d_hdr
 {

217 
u8
 
	mªc_id
;

218 
u8
 
	mÀn
;

219 } 
	g__∑cked
;

221 
	shtc_¸edô_ªp‹t
 {

222 
u8
 
	meid
;

223 
u8
 
	m¸edôs
;

224 } 
	g__∑cked
;

231 
	shtc_lookahód_ªp‹t
 {

232 
u8
 
	m¥e_vÆid
;

233 
u8
 
	mlk_ahd
[4];

234 
u8
 
	mpo°_vÆid
;

235 } 
	g__∑cked
;

237 
	shtc_bundÀ_lkahd_Ωt
 {

238 
u8
 
	mlk_ahd
[4];

239 } 
	g__∑cked
;

243 
	ehtc_£rvi˚_gΩ_ids
 {

244 
	mRSVD_SERVICE_GROUP
 = 0,

245 
	mWMI_SERVICE_GROUP
 = 1,

247 
	mHTC_TEST_GROUP
 = 254,

248 
	mHTC_SERVICE_GROUP_LAST
 = 255

253 
	ehtc_ídpoöt_id
 {

254 
	mENDPOINT_UNUSED
 = -1,

255 
	mENDPOINT_0
 = 0,

256 
	mENDPOINT_1
 = 1,

257 
	mENDPOINT_2
 = 2,

258 
	mENDPOINT_3
,

259 
	mENDPOINT_4
,

260 
	mENDPOINT_5
,

261 
	mENDPOINT_6
,

262 
	mENDPOINT_7
,

263 
	mENDPOINT_8
,

264 
	mENDPOINT_MAX
,

267 
	shtc_tx_∑ckë_öfo
 {

268 
u16
 
	mèg
;

269 
	m¸ed_u£d
;

270 
u8
 
	mÊags
;

271 
	m£qno
;

274 
	shtc_rx_∑ckë_öfo
 {

275 
u32
 
	mexp_hdr
;

276 
u32
 
	mrx_Êags
;

277 
u32
 
	mödiˇt_Êags
;

280 
	ghtc_èrgë
;

283 
	shtc_∑ckë
 {

284 
li°_hód
 
	mli°
;

287 *
	mpkt_˙txt
;

296 
u8
 *
	mbuf_°¨t
;

305 
u8
 *
	mbuf
;

306 
u32
 
	mbuf_Àn
;

309 
u32
 
	ma˘_Àn
;

312 
htc_ídpoöt_id
 
	mídpoöt
;

316 
	m°©us
;

318 
htc_tx_∑ckë_öfo
 
	mtx
;

319 
htc_rx_∑ckë_öfo
 
	mrx
;

320 } 
	möfo
;

322 (*
	mcom∂ëi⁄
Ë(
	mhtc_èrgë
 *, 
	mhtc_∑ckë
 *);

323 
htc_èrgë
 *
	mc⁄ãxt
;

331 
sk_buff
 *
	mskb
;

334 
u8
 
	mc⁄nid
;

335 
u8
 
	mªcy˛e_cou¡
;

337 
©h6kl_vif
 *
	mvif
;

340 
	ehtc_£nd_fuŒ_a˘i⁄
 {

341 
	mHTC_SEND_FULL_KEEP
 = 0,

342 
	mHTC_SEND_FULL_DROP
 = 1,

345 
	shtc_ï_ˇŒbacks
 {

346 (*
	mtx_com∂ëe
Ë(
	mhtc_èrgë
 *, 
	mhtc_∑ckë
 *);

347 (*
	mrx
Ë(
	mhtc_èrgë
 *, 
	mhtc_∑ckë
 *);

348 (*
	mrx_ªfûl
Ë(
	mhtc_èrgë
 *, 
htc_ídpoöt_id
 
	mídpoöt
);

349 
htc_£nd_fuŒ_a˘i⁄
 (*
tx_fuŒ
Ë(
	mhtc_èrgë
 *,

350 
	mhtc_∑ckë
 *);

351 
	mhtc_∑ckë
 *(*
	mrx_Ælo˘hªsh
Ë(
	mhtc_èrgë
 *,

352 
	mhtc_ídpoöt_id
, );

353 (*
	mtx_comp_mu…i
Ë(
	mhtc_èrgë
 *, 
	mli°_hód
 *);

354 
	mrx_Æloc_thªsh
;

355 
	mrx_ªfûl_thªsh
;

359 
	shtc_£rvi˚_c⁄√˘_ªq
 {

360 
u16
 
	msvc_id
;

361 
u16
 
	mc⁄n_Êags
;

362 
htc_ï_ˇŒbacks
 
	mï_cb
;

363 
	mmax_txq_dïth
;

364 
u32
 
	mÊags
;

365 
	mmax_rxmsg_sz
;

369 
	shtc_£rvi˚_c⁄√˘_ª•
 {

370 
u8
 
	mbuf_Àn
;

371 
u8
 
	ma˘_Àn
;

372 
htc_ídpoöt_id
 
	mídpoöt
;

373 
	mÀn_max
;

374 
u8
 
	mª•_code
;

378 
	shtc_ídpoöt_¸edô_di°
 {

379 
li°_hód
 
	mli°
;

382 
u16
 
	msvc_id
;

385 
htc_ídpoöt_id
 
	mídpoöt
;

387 
u32
 
	mdi°_Êags
;

393 
	m¸ed_n‹m
;

396 
	m¸ed_mö
;

398 
	m¸ed_as¢gd
;

401 
	m¸edôs
;

409 
	m¸ed_to_di°
;

416 
	m£ek_¸ed
;

419 
	m¸ed_sz
;

422 
	m¸ed_≥r_msg
;

425 
htc_ídpoöt
 *
	mhtc_ï
;

433 
	mtxq_dïth
;

436 
	m¸ed_Æloc_max
;

443 
	ehtc_¸edô_di°_ªas⁄
 {

444 
	mHTC_CREDIT_DIST_SEND_COMPLETE
 = 0,

445 
	mHTC_CREDIT_DIST_ACTIVITY_CHANGE
 = 1,

446 
	mHTC_CREDIT_DIST_SEEK_CREDITS
,

449 
	s©h6kl_htc_¸edô_öfo
 {

450 
	mtŸÆ_avaû_¸edôs
;

451 
	mcur_‰ì_¸edôs
;

454 
li°_hód
 
	mlowe°¥i_ï_di°
;

458 
	shtc_ídpoöt_°©s
 {

463 
u32
 
	m¸ed_low_ödiˇã
;

465 
u32
 
	mtx_issued
;

466 
u32
 
	mtx_pkt_bundÀd
;

467 
u32
 
	mtx_bundÀs
;

468 
u32
 
	mtx_dr›≥d
;

471 
u32
 
	mtx_¸ed_Ωt
;

474 
u32
 
	m¸ed_Ωt_‰om_rx
;

477 
u32
 
	m¸ed_Ωt_‰om_Ÿhî
;

480 
u32
 
	m¸ed_Ωt_ï0
;

483 
u32
 
	m¸ed_‰om_rx
;

486 
u32
 
	m¸ed_‰om_Ÿhî
;

489 
u32
 
	m¸ed_‰om_ï0
;

492 
u32
 
	m¸ed_cosumd
;

495 
u32
 
	m¸ed_ªäd
;

497 
u32
 
	mrx_pkts
;

500 
u32
 
	mrx_lkahds
;

503 
u32
 
	mrx_bundl
;

506 
u32
 
	mrx_bundÀ_lkahd
;

509 
u32
 
	mrx_bundÀ_‰om_hdr
;

512 
u32
 
	mrx_Æloc_thªsh_hô
;

515 
u32
 
	mrxÆloc_thªsh_byã
;

518 
	shtc_ídpoöt
 {

519 
htc_ídpoöt_id
 
	meid
;

520 
u16
 
	msvc_id
;

521 
li°_hód
 
	mtxq
;

522 
li°_hód
 
	mrx_bufq
;

523 
htc_ídpoöt_¸edô_di°
 
	m¸ed_di°
;

524 
htc_ï_ˇŒbacks
 
	mï_cb
;

525 
	mmax_txq_dïth
;

526 
	mÀn_max
;

527 
	mtx_¥oc_˙t
;

528 
	mrx_¥oc_˙t
;

529 
htc_èrgë
 *
	mèrgë
;

530 
u8
 
	m£qno
;

531 
u32
 
	mc⁄n_Êags
;

532 
htc_ídpoöt_°©s
 
	mï_°
;

533 
u16
 
	mtx_dr›_∑ckë_thªshﬁd
;

535 
u8
 
	mpùeid_ul
;

536 
u8
 
	mpùeid_dl
;

537 
li°_hód
 
	mtx_lookup_queue
;

538 
boﬁ
 
	mtx_¸edô_Êow_íabÀd
;

540 
timî_li°
 
	mtimî
;

541 
u8
 
	mˇŒ_by_timî
;

542 
u8
 
	mtimî_öô
;

543 
u8
 
	m∑ss_th
;

544 
u8
 
	m°¨vög
;

545 
	mœ°_£¡
;

548 
	shtc_c⁄åﬁ_buf„r
 {

549 
htc_∑ckë
 
	m∑ckë
;

550 
u8
 *
	mbuf
;

553 
	shtc_pùe_tx¸edô_Æloc
 {

554 
u16
 
	m£rvi˚_id
;

555 
u8
 
	m¸edô_Æloc
;

558 
	ehtc_£nd_queue_ªsu…
 {

559 
	mHTC_SEND_QUEUE_OK
 = 0,

560 
	mHTC_SEND_QUEUE_DROP
 = 1,

563 
	s©h6kl_htc_›s
 {

564 * (*
	m¸óã
)(
©h6kl
 *
	m¨
);

565 (*
	mwaô_èrgë
)(
htc_èrgë
 *
	mèrgë
);

566 (*
	m°¨t
)(
htc_èrgë
 *
	mèrgë
);

567 (*
	mc⁄n_£rvi˚
)(
htc_èrgë
 *
	mèrgë
,

568 
htc_£rvi˚_c⁄√˘_ªq
 *
	mªq
,

569 
htc_£rvi˚_c⁄√˘_ª•
 *
	mª•
);

570 (*
	mtx
)(
htc_èrgë
 *
	mèrgë
, 
htc_∑ckë
 *
	m∑ckë
);

571 (*
	m°›
)(
htc_èrgë
 *
	mèrgë
);

572 (*
	m˛ónup
)(
htc_èrgë
 *
	mèrgë
);

573 (*
	mÊush_txï
)(
htc_èrgë
 *
	mèrgë
,

574 
htc_ídpoöt_id
 
	mídpoöt
, 
u16
 
	mèg
);

575 (*
	mÊush_rx_buf
)(
htc_èrgë
 *
	mèrgë
);

576 (*
	mödiˇã_a˘ivôy_ch™ge
)(
htc_èrgë
 *
	mèrgë
,

577 
htc_ídpoöt_id
 
	mídpoöt
,

578 
boﬁ
 
	ma˘ive
);

579 (*
	mgë_rxbuf_num
)(
htc_èrgë
 *
	mèrgë
,

580 
htc_ídpoöt_id
 
	mídpoöt
);

581 (*
	madd_rxbuf_mu…ùÀ
)(
htc_èrgë
 *
	mèrgë
,

582 
li°_hód
 *
	mpktq
);

583 (*
	m¸edô_£tup
)(
htc_èrgë
 *
	mèrgë
,

584 
©h6kl_htc_¸edô_öfo
 *
	m¸ed_öfo
);

585 (*
	mgë_°©
)(
htc_èrgë
 *
	mèrgë
,

586 
u8
 *
	mbuf
, 
	mbuf_Àn
);

587 (*
	m°›_√tif_queue_fuŒ
)(
htc_èrgë
 *
	mèrgë
);

588 (*
	mödiˇã_wmm_scheduÀ_ch™ge
)(
htc_èrgë
 *
	mèrgë
,

589 
boﬁ
 
	mch™ge
);

590 (*
	mch™ge_¸edô_by∑ss
)(
htc_èrgë
 *
	mèrgë
,

591 
u8
 
	måaffic_˛ass
);

592 #ifde‡
USB_AUTO_SUSPEND


593 
boﬁ
 (*
skù_usb_m¨k_busy
)(
©h6kl
 *
	m¨
, 
sk_buff
 *
	mskb
);

597 
	g©h6kl_devi˚
;

600 
	shtc_èrgë
 {

601 
htc_ídpoöt
 
	mídpoöt
[
ENDPOINT_MAX
];

604 
li°_hód
 
	m¸ed_di°_li°
;

606 
li°_hód
 
	m‰ì_˘æ_txbuf
;

607 
li°_hód
 
	m‰ì_˘æ_rxbuf
;

608 
©h6kl_htc_¸edô_öfo
 *
	m¸edô_öfo
;

609 
	mtgt_¸eds
;

610 
	mtgt_¸ed_sz
;

611 
•ölock_t
 
	mhtc_lock
;

612 
•ölock_t
 
	mrx_lock
;

613 
•ölock_t
 
	mtx_lock
;

614 
©h6kl_devi˚
 *
	mdev
;

615 
u32
 
	mhtc_Êags
;

616 
u32
 
	mrx_°_Êags
;

617 
htc_ídpoöt_id
 
	mï_waôög
;

618 
u8
 
	mhtc_tgt_vî
;

621 
	mmsg_≥r_bndl_max
;

623 
u32
 
	mtx_bndl_mask
;

624 
	mrx_bndl_íabÀ
;

625 
	mmax_rx_bndl_sz
;

626 
	mmax_tx_bndl_sz
;

628 
u32
 
	mblock_sz
;

629 
u32
 
	mblock_mask
;

631 
	mmax_sˇt_íåõs
;

632 
	mmax_x„r_sz≥r_sˇåeq
;

634 
	mchk_úq_°©us_˙t
;

637 
u32
 
	mac_tx_cou¡
[
WMM_NUM_AC
];

639 
htc_∑ckë
 *
	mhtc_∑ckë_poﬁ
;

640 
u8
 
	m˘æ_ª•⁄£_buf
[
HTC_MAX_CTRL_MSG_LEN
];

641 
	m˘æ_ª•⁄£_Àn
;

642 
boﬁ
 
	m˘æ_ª•⁄£_vÆid
;

643 
htc_pùe_tx¸edô_Æloc
 
	mtx¸edô_Æloc
[
ENDPOINT_MAX
];

644 
	mavaû_tx_¸edôs
;

646 
sk_buff_hód
 
	mrx_sg_q
;

647 
boﬁ
 
	mrx_sg_ö_¥ogªss
;

648 
u32
 
	mrx_sg_tŸÆ_Àn_cur
;

649 
u32
 
	mrx_sg_tŸÆ_Àn_exp
;

653 
©h6kl_htc_rxmsg_≥ndög_h™dÀr
(
htc_èrgë
 *
èrgë
,

654 
u32
 
msg_look_ahód
, *
n_pkts
);

656 
ölöe
 
	$£t_htc_pkt_öfo
(
htc_∑ckë
 *
∑ckë
, *
c⁄ãxt
,

657 
u8
 *
buf
, 
Àn
,

658 
htc_ídpoöt_id
 
eid
, 
u16
 
èg
)

660 
∑ckë
->
pkt_˙txt
 = 
c⁄ãxt
;

661 
∑ckë
->
buf
 = buf;

662 
∑ckë
->
a˘_Àn
 = 
Àn
;

663 
∑ckë
->
ídpoöt
 = 
eid
;

664 
∑ckë
->
öfo
.
tx
.
èg
 =Åag;

665 
	}
}

667 
ölöe
 
	$htc_rxpkt_ª£t
(
htc_∑ckë
 *
∑ckë
)

669 
∑ckë
->
buf
 =Öackë->
buf_°¨t
;

670 
∑ckë
->
a˘_Àn
 = 0;

671 
	}
}

673 
ölöe
 
	$£t_htc_rxpkt_öfo
(
htc_∑ckë
 *
∑ckë
, *
c⁄ãxt
,

674 
u8
 *
buf
, 
Àn
,

675 
htc_ídpoöt_id
 
eid
)

677 
∑ckë
->
pkt_˙txt
 = 
c⁄ãxt
;

678 
∑ckë
->
buf
 = buf;

679 
∑ckë
->
buf_°¨t
 = 
buf
;

680 
∑ckë
->
buf_Àn
 = 
Àn
;

681 
∑ckë
->
ídpoöt
 = 
eid
;

682 
	}
}

684 
ölöe
 
	$gë_queue_dïth
(
li°_hód
 *
queue
)

686 
li°_hód
 *
tmp_li°
;

687 
dïth
 = 0;

689 
	`li°_f‹_óch
(
tmp_li°
, 
queue
)

690 
dïth
++;

692  
dïth
;

693 
	}
}

	@htc_pipe.c

17 
	~"c‹e.h
"

18 
	~"debug.h
"

19 
	~"hif-›s.h
"

21 
	~<asm/byã‹dî.h
>

23 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


24 
	~<asm/u«lig√d.h
>

27 
	#HTC_PACKET_CONTAINER_ALLOCATION
 32

	)

28 
	#HTC_CONTROL_BUFFER_SIZE
 (
HTC_MAX_CTRL_MSG_LEN
 + 
HTC_HDR_LENGTH
)

	)

29 
	#DATA_EP_SIZE
 4

	)

31 
©h6kl_htc_pùe_tx
(
htc_èrgë
 *
h™dÀ
,

32 
htc_∑ckë
 *
∑ckë
);

33 
©h6kl_htc_pùe_˛ónup
(
htc_èrgë
 *
h™dÀ
);

34 
htc_tx_bundÀ_timî_h™dÀr
(
±r
);

37 
ölöe
 
	$ª°‹e_tx_∑ckë
(
htc_∑ckë
 *
∑ckë
)

39 i‡(
∑ckë
->
öfo
.
tx
.
Êags
 & 
HTC_FLAGS_TX_FIXUP_NETBUF
) {

40 
	`skb_puŒ
(
∑ckë
->
skb
, (
htc_‰ame_hdr
));

41 
∑ckë
->
öfo
.
tx
.
Êags
 &~
HTC_FLAGS_TX_FIXUP_NETBUF
;

43 
	}
}

45 
	$do_£nd_com∂ëi⁄
(
htc_ídpoöt
 *
ï
,

46 
li°_hód
 *
queue_to_ödiˇã
)

48 i‡(
	`li°_em±y
(
queue_to_ödiˇã
)) {

53 i‡(
ï
->
ï_cb
.
tx_comp_mu…i
 !
NULL
) {

54 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

56 "(%dÖkts)\n", 
__func__
,

57 
ï
->
eid
, 
	`gë_queue_dïth
(
queue_to_ödiˇã
));

62 
ï
->
ï_cb
.
	`tx_comp_mu…i
(

63 (
htc_èrgë
 *Ë
ï
->
èrgë
,

64 
queue_to_ödiˇã
);

69 
	`INIT_LIST_HEAD
(
queue_to_ödiˇã
);

71 
htc_∑ckë
 *
∑ckë
;

74 
∑ckë
 = 
	`li°_fú°_íåy
(
queue_to_ödiˇã
,

75 
htc_∑ckë
, 
li°
);

77 
	`li°_dñ
(&
∑ckë
->
li°
);

78 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

80 "∑ckë 0x%lX\n", 
__func__
,

81 
ï
->
eid
, ()(
∑ckë
));

82 
ï
->
ï_cb
.
	`tx_com∂ëe
(

83 (
htc_èrgë
 *Ë
ï
->
èrgë
,

84 
∑ckë
);

85 } !
	`li°_em±y
(
queue_to_ödiˇã
));

88 
	}
}

90 
	$£nd_∑ckë_com∂ëi⁄
(
htc_èrgë
 *
èrgë
,

91 
htc_∑ckë
 *
∑ckë
)

93 
htc_ídpoöt
 *
ï
 = &
èrgë
->
ídpoöt
[
∑ckë
->endpoint];

94 
li°_hód
 
c⁄èöî
;

96 
	`ª°‹e_tx_∑ckë
(
∑ckë
);

97 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

98 
	`li°_add_èû
(&
∑ckë
->
li°
, &
c⁄èöî
);

100 
	`do_£nd_com∂ëi⁄
(
ï
, &
c⁄èöî
);

101 
	}
}

103 
	$gë_htc_∑ckë_¸edô_ba£d
(
htc_èrgë
 *
èrgë
,

104 
htc_ídpoöt
 *
ï
,

105 
li°_hód
 *
queue
)

107 
¸edôs_ªquúed
;

108 
ªmaödî
;

109 
u8
 
£nd_Êags
;

110 
htc_∑ckë
 *
∑ckë
;

111 
å™s„r_Àn
;

112 
°¨vög
 = 
ï
->starving;

113 
msgs_uµî_limô
 =

114 (
htc_bundÀ_£nd
Ë? 
HTC_HOST_MAX_MSG_PER_BUNDLE
 : 1;

116 i‡(
èrgë
->
tgt_¸ed_sz
 == 0)

121 
åue
) {

122 
£nd_Êags
 = 0;

123 i‡(
	`li°_em±y
(&
ï
->
txq
))

127 
∑ckë
 = 
	`li°_fú°_íåy
(&
ï
->
txq
,

128 
htc_∑ckë
, 
li°
);

129 i‡(
∑ckë
 =
NULL
)

132 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

134 
__func__
, ()
∑ckë
,

135 
	`gë_queue_dïth
(&
ï
->
txq
));

137 
å™s„r_Àn
 = 
∑ckë
->
a˘_Àn
 + 
HTC_HDR_LENGTH
;

138 i‡(
å™s„r_Àn
 <
èrgë
->
tgt_¸ed_sz
) {

139 
¸edôs_ªquúed
 = 1;

142 
¸edôs_ªquúed
 =

143 
å™s„r_Àn
 / 
èrgë
->
tgt_¸ed_sz
;

144 
ªmaödî
 = 
å™s„r_Àn
 % 
èrgë
->
tgt_¸ed_sz
;

146 i‡(
ªmaödî
)

147 
¸edôs_ªquúed
++;

150 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "%s: credsÑequired:%d"

151 "gŸ:%d\n", 
__func__
, 
¸edôs_ªquúed
,

152 
ï
->
¸ed_di°
.
¸edôs
);

154 i‡(
ï
->
eid
 =
ENDPOINT_0
) {

159 
¸edôs_ªquúed
 = 0;

161 } i‡(
ï
->
eid
 >
ENDPOINT_2
 &&Ép->eid <
ENDPOINT_5
) {

163 i‡(
èrgë
->
avaû_tx_¸edôs
 < 
¸edôs_ªquúed
)

166 i‡(
htc_bundÀ_£nd
 && !
msgs_uµî_limô
)

169 
èrgë
->
avaû_tx_¸edôs
 -
¸edôs_ªquúed
;

170 
ï
->
ï_°
.
¸ed_cosumd
 +
¸edôs_ªquúed
;

172 
ï
->
°¨vög
 = 0;

173 
ï
->
œ°_£¡
 = 
jiffõs
;

175 i‡(
èrgë
->
avaû_tx_¸edôs
 < 1) {

177 
£nd_Êags
 |
HTC_FLAGS_NEED_CREDIT_UPDATE
;

178 
ï
->
ï_°
.
¸ed_low_ödiˇã
 += 1;

179 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

180 "%s: ho°Çìd†¸edôs\n", 
__func__
);

185 i‡(
ï
->
¸ed_di°
.
¸edôs
 < 
¸edôs_ªquúed
)

188 i‡(
htc_bundÀ_£nd
 && !
msgs_uµî_limô
)

191 
ï
->
¸ed_di°
.
¸edôs
 -
¸edôs_ªquúed
;

192 
ï
->
ï_°
.
¸ed_cosumd
 +
¸edôs_ªquúed
;

195 i‡(
ï
->
¸ed_di°
.
¸edôs
 <

196 
ï
->
¸ed_di°
.
¸ed_≥r_msg
) {

198 
£nd_Êags
 |
HTC_FLAGS_NEED_CREDIT_UPDATE
;

199 
ï
->
ï_°
.
¸ed_low_ödiˇã
 += 1;

200 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

201 "%s: ho°Çìd†¸edôs\n", 
__func__
);

206 
∑ckë
 = 
	`li°_fú°_íåy
(&
ï
->
txq
,

207 
htc_∑ckë
, 
li°
);

209 
	`li°_dñ
(&
∑ckë
->
li°
);

211 
∑ckë
->
öfo
.
tx
.
¸ed_u£d
 = 
¸edôs_ªquúed
;

213 
∑ckë
->
öfo
.
tx
.
Êags
 = 
£nd_Êags
;

214 
∑ckë
->
öfo
.
tx
.
£qno
 = 
ï
->seqno;

215 
ï
->
£qno
++;

217 
	`li°_add_èû
(&
∑ckë
->
li°
, 
queue
);

219 i‡(
htc_bundÀ_£nd
)

220 
msgs_uµî_limô
--;

223 i‡(
°¨vög
)

227 
	}
}

229 
	$gë_htc_∑ckë
(
htc_èrgë
 *
èrgë
,

230 
htc_ídpoöt
 *
ï
,

231 
li°_hód
 *
queue
, 
ªsour˚s
)

234 
htc_∑ckë
 *
∑ckë
;

236 
msgs_uµî_limô
 =

237 (
htc_bundÀ_£nd
Ë? 
HTC_HOST_MAX_MSG_PER_BUNDLE
 : 
ªsour˚s
;

240 i‡(
htc_bundÀ_£nd
 && !
ªsour˚s
)

244 
msgs_uµî_limô
) {

245 i‡(
	`li°_em±y
(&
ï
->
txq
))

248 
∑ckë
 = 
	`li°_fú°_íåy
(&
ï
->
txq
,

249 
htc_∑ckë
, 
li°
);

250 
	`li°_dñ
(&
∑ckë
->
li°
);

252 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

254 
__func__
, ()
∑ckë
,

255 
	`gë_queue_dïth
(&
ï
->
txq
));

256 
∑ckë
->
öfo
.
tx
.
£qno
 = 
ï
->seqno;

257 
∑ckë
->
öfo
.
tx
.
Êags
 = 0;

258 
∑ckë
->
öfo
.
tx
.
¸ed_u£d
 = 0;

259 
ï
->
£qno
++;

261 
	`li°_add_èû
(&
∑ckë
->
li°
, 
queue
);

262 
msgs_uµî_limô
--;

265 
	}
}

267 
	$htc_issue_∑ckës
(
htc_èrgë
 *
èrgë
,

268 
htc_ídpoöt
 *
ï
,

269 
li°_hód
 *
pkt_queue
)

271 
°©us
 = 0;

272 
u16
 
∑ylﬂd_Àn
;

273 
sk_buff
 *
nbuf
;

274 
htc_‰ame_hdr
 *
htc_hdr
;

275 
htc_∑ckë
 *
∑ckë
 = 
NULL
;

277 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

278 "%s: queue: 0x%lX,Ökt†%d\n", 
__func__
,

279 ()
pkt_queue
, 
	`gë_queue_dïth
(pkt_queue));

280 i‡(
htc_bundÀ_£nd
 && (
ï
->
pùeid_ul
 != 0 )) {

282 
sk_buff
 *
msg_bundÀ
[
HTC_HOST_MAX_MSG_PER_BUNDLE
] = {};

283 
msgs_to_bundÀ
 = 0;

284 
bundÀ_¸edô_u£d
 = 0;

286 !
	`li°_em±y
(
pkt_queue
)) {

287 
∑ckë
 = 
	`li°_fú°_íåy
(
pkt_queue
,

288 
htc_∑ckë
, 
li°
);

289 
	`li°_dñ
(&
∑ckë
->
li°
);

291 
nbuf
 = 
∑ckë
->
skb
;

292 i‡(!
nbuf
) {

293 
	`WARN_ON
(1);

294 
°©us
 = -
EINVAL
;

298 
∑ylﬂd_Àn
 = 
∑ckë
->
a˘_Àn
;

300 
htc_hdr
 = (
htc_‰ame_hdr
 *)
	`skb_push
(
nbuf
,

301 (
htc_‰ame_hdr
));

302 i‡(!
htc_hdr
) {

303 
	`WARN_ON
(1);

304 
°©us
 = -
EINVAL
;

307 
∑ckë
->
öfo
.
tx
.
Êags
 |
HTC_FLAGS_TX_FIXUP_NETBUF
;

308 
∑ckë
->
öfo
.
tx
.
Êags
 |
HTC_FLAGS_SEND_BUNDLE
;

311 
	`put_u«lig√d
((
u16
Ë
∑ylﬂd_Àn
, &
htc_hdr
->
∑yld_Àn
);

312 
htc_hdr
->
∑yld_Àn
 = 
	`˝u_to_À16
(htc_hdr->payld_len);

313 
htc_hdr
->
Êags
 = 
∑ckë
->
öfo
.
tx
.flags;

314 
htc_hdr
->
eid
 = (
u8
Ë
∑ckë
->
ídpoöt
;

315 
htc_hdr
->
˘æ
[0] = 0;

316 
htc_hdr
->
˘æ
[1] = (
u8
Ë
∑ckë
->
öfo
.
tx
.
£qno
;

318 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

320 
	`li°_add_èû
(&
∑ckë
->
li°
, &
ï
->
tx_lookup_queue
);

321 
ï
->
ï_°
.
tx_issued
 += 1;

322 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

327 
msg_bundÀ
[
msgs_to_bundÀ
] = 
nbuf
;

328 
msgs_to_bundÀ
++;

329 
bundÀ_¸edô_u£d
 +
∑ckë
->
öfo
.
tx
.
¸ed_u£d
;

332 
°©us
 = 
	`©h6kl_hif_pùe_£nd_bundÀ
(
èrgë
->
dev
->
¨
,

333 
ï
->
pùeid_ul
, 
msg_bundÀ
, 
msgs_to_bundÀ
);

335 i‡(
°©us
 != 0) {

336 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

338 i‡(
ï
->
eid
 >
ENDPOINT_2
 &&Ép->eid <
ENDPOINT_5
)

339 
èrgë
->
avaû_tx_¸edôs
 +
bundÀ_¸edô_u£d
;

341 
ï
->
¸ed_di°
.
¸edôs
 +
bundÀ_¸edô_u£d
;

343 
ï
->
ï_°
.
¸ed_ªäd
 +
bundÀ_¸edô_u£d
;

344 
ï
->
ï_°
.
tx_dr›≥d
 +
bundÀ_¸edô_u£d
;

346 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

350 !
	`li°_em±y
(
pkt_queue
)) {

351 
∑ckë
 = 
	`li°_fú°_íåy
(
pkt_queue
,

352 
htc_∑ckë
, 
li°
);

353 
	`li°_dñ
(&
∑ckë
->
li°
);

355 
nbuf
 = 
∑ckë
->
skb
;

356 i‡(!
nbuf
) {

357 
	`WARN_ON
(1);

358 
°©us
 = -
EINVAL
;

362 
∑ylﬂd_Àn
 = 
∑ckë
->
a˘_Àn
;

364 
htc_hdr
 = (
htc_‰ame_hdr
 *)
	`skb_push
(
nbuf
,

365 (
htc_‰ame_hdr
));

366 i‡(!
htc_hdr
) {

367 
	`WARN_ON
(1);

368 
°©us
 = -
EINVAL
;

372 
∑ckë
->
öfo
.
tx
.
Êags
 |
HTC_FLAGS_TX_FIXUP_NETBUF
;

375 
	`put_u«lig√d
((
u16
Ë
∑ylﬂd_Àn
, &
htc_hdr
->
∑yld_Àn
);

376 
htc_hdr
->
∑yld_Àn
 = 
	`˝u_to_À16
(htc_hdr->payld_len);

377 
htc_hdr
->
Êags
 = 
∑ckë
->
öfo
.
tx
.flags;

378 
htc_hdr
->
eid
 = (
u8
Ë
∑ckë
->
ídpoöt
;

379 
htc_hdr
->
˘æ
[0] = 0;

380 
htc_hdr
->
˘æ
[1] = (
u8
Ë
∑ckë
->
öfo
.
tx
.
£qno
;

382 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

384 
	`li°_add_èû
(&
∑ckë
->
li°
, &
ï
->
tx_lookup_queue
);

385 
ï
->
ï_°
.
tx_issued
 += 1;

386 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

388 
°©us
 = 
	`©h6kl_hif_pùe_£nd
(
èrgë
->
dev
->
¨
,

389 
ï
->
pùeid_ul
, 
NULL
, 
nbuf
);

391 i‡(
°©us
 != 0) {

392 i‡(
°©us
 !-
ENOMEM
) {

398 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

400 
__func__
, 
°©us
);

402 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

403 
	`li°_dñ
(&
∑ckë
->
li°
);

405 i‡(
ï
->
eid
 >
ENDPOINT_2
 &&

406 
ï
->
eid
 <
ENDPOINT_5
)

407 
èrgë
->
avaû_tx_¸edôs
 +=

408 
∑ckë
->
öfo
.
tx
.
¸ed_u£d
;

410 
ï
->
¸ed_di°
.
¸edôs
 +=

411 
∑ckë
->
öfo
.
tx
.
¸ed_u£d
;

413 
ï
->
ï_°
.
tx_dr›≥d
 +=

414 
∑ckë
->
öfo
.
tx
.
¸ed_u£d
;

415 
ï
->
ï_°
.
¸ed_ªäd
 +=

416 
∑ckë
->
öfo
.
tx
.
¸ed_u£d
;

417 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

419 
	`li°_add
(&
∑ckë
->
li°
, 
pkt_queue
);

425 i‡(
°©us
 != 0) {

426 !
	`li°_em±y
(
pkt_queue
)) {

427 i‡(
°©us
 !-
ENOMEM
) {

428 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

430 
__func__
, 
∑ckë
, 
°©us
);

432 
∑ckë
 = 
	`li°_fú°_íåy
(
pkt_queue
,

433 
htc_∑ckë
, 
li°
);

434 
	`li°_dñ
(&
∑ckë
->
li°
);

435 
∑ckë
->
°©us
 = status;

436 
	`£nd_∑ckë_com∂ëi⁄
(
èrgë
, 
∑ckë
);

440  
°©us
;

441 
	}
}

443 
htc_£nd_queue_ªsu…
 
	$htc_åy_£nd
(
htc_èrgë
 *
èrgë
,

444 
htc_ídpoöt
 *
ï
,

445 
li°_hód
 *
ˇŒîs_£nd_queue
)

447 
li°_hód
 
£nd_queue
;

448 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

449 
©h6kl
 *
¨
 = 
èrgë
->
dev
->ar;

450 
tx_ªsour˚s
;

451 
°¨vög
;

452 
ovîÊow
, 
txqueue_dïth
;

454 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

456 
__func__
, ()
ˇŒîs_£nd_queue
,

457 (
ˇŒîs_£nd_queue
 ==

458 
NULL
Ë? 0 : 
	`gë_queue_dïth
(
ˇŒîs_£nd_queue
));

460 i‡(
htc_bundÀ_£nd
 && 
htc_bundÀ_£nd_timî
 &&

461 
ï
->
eid
 =
ENDPOINT_2
) {

463 i‡(
ï
->
timî_öô
 == 0) {

464 
	`£tup_timî
(&
ï
->
timî
, 
htc_tx_bundÀ_timî_h™dÀr
,

465 (Ë
èrgë
);

466 
	`mod_timî
(&
ï
->
timî
,

467 
jiffõs
 + 
	`m£cs_to_jiffõs
(
htc_bundÀ_£nd_timî
));

468 
ï
->
timî_öô
 = 1;

471 i‡(
ï
->
ˇŒ_by_timî
 =0 &&Ép->
∑ss_th
) {

472 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

473 i‡(
	`gë_queue_dïth
(&
ï
->
txq
) <

474 
HTC_HOST_MAX_MSG_PER_BUNDLE
) {

475 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

478 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

483 
	`INIT_LIST_HEAD
(&
£nd_queue
);

489 i‡(
ˇŒîs_£nd_queue
 !
NULL
) {

490 i‡(
	`li°_em±y
(
ˇŒîs_£nd_queue
)) {

492  
HTC_SEND_QUEUE_DROP
;

495 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

496 
txqueue_dïth
 = 
	`gë_queue_dïth
(&
ï
->
txq
);

497 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

499 i‡(
txqueue_dïth
 >
ï
->
max_txq_dïth
) {

501 
ovîÊow
 = 
	`gë_queue_dïth
(
ˇŒîs_£nd_queue
);

504 
ovîÊow
 = 
txqueue_dïth
;

505 
ovîÊow
 +
	`gë_queue_dïth
(
ˇŒîs_£nd_queue
);

507 
ovîÊow
 -
ï
->
max_txq_dïth
;

511 i‡(
ovîÊow
 > 0) {

512 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

514 "Tx Dïth:%d, Max:%d\n", 
__func__
,

515 
ï
->
eid
, 
ovîÊow
, 
txqueue_dïth
,

516 
ï
->
max_txq_dïth
);

518 i‡((
ovîÊow
 <= 0)

519 || (
ï
->
ï_cb
.
tx_fuŒ
 =
NULL
)) {

525 
	`li°_•li˚_èû_öô
(
ˇŒîs_£nd_queue
,

526 &
£nd_queue
);

528 
i
;

529 
good_pkts
 =

530 
	`gë_queue_dïth
(
ˇŒîs_£nd_queue
Ë- 
ovîÊow
;

531 i‡(
good_pkts
 < 0) {

532 
	`WARN_ON
(1);

533  
HTC_SEND_QUEUE_DROP
;

538 
i
 = 0; i < 
good_pkts
; i++) {

540 
∑ckë
 = 
	`li°_fú°_íåy
(

541 
ˇŒîs_£nd_queue
,

542 
htc_∑ckë
, 
li°
);

543 
	`li°_dñ
(&
∑ckë
->
li°
);

545 
	`li°_add_èû
(&
∑ckë
->
li°
, &
£nd_queue
);

553 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
,

554 
ˇŒîs_£nd_queue
, 
li°
) {

556 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

558 
__func__
, ()
∑ckë
);

559 i‡(
ï
->
ï_cb
.

560 
	`tx_fuŒ
((
htc_èrgë
 *)

561 
ï
->
èrgë
,

562 
∑ckë
Ë=
HTC_SEND_FULL_DROP
) {

564 
ï
->
ï_°
.
tx_dr›≥d
 += 1;

571 
	`li°_dñ
(&
∑ckë
->
li°
);

573 
	`li°_add_èû
(&
∑ckë
->
li°
,

574 &
£nd_queue
);

579 i‡(
	`li°_em±y
(&
£nd_queue
)) {

581  
HTC_SEND_QUEUE_DROP
;

586 i‡(!
ï
->
tx_¸edô_Êow_íabÀd
) {

587 
tx_ªsour˚s
 =

588 
	`©h6kl_hif_pùe_gë_‰ì_queue_numbî
(
¨
, 
ï
->
pùeid_ul
);

590 
tx_ªsour˚s
 = 0;

593 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

594 i‡(!
	`li°_em±y
(&
£nd_queue
)) {

596 
	`li°_•li˚_èû_öô
(&
£nd_queue
, &
ï
->
txq
);

597 i‡(!
	`li°_em±y
(&
£nd_queue
)) {

598 
	`WARN_ON
(1);

599 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

600  
HTC_SEND_QUEUE_DROP
;

602 
	`INIT_LIST_HEAD
(&
£nd_queue
);

606 
ï
->
tx_¥oc_˙t
++;

608 i‡(
ï
->
tx_¥oc_˙t
 > 1) {

614 
ï
->
tx_¥oc_˙t
--;

615 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

616  
HTC_SEND_QUEUE_OK
;

625 
°¨vög
 = 
ï
->starving;

626 
åue
) {

628 i‡(
	`gë_queue_dïth
(&
ï
->
txq
) == 0)

631 i‡(
ï
->
tx_¸edô_Êow_íabÀd
) {

637 
	`gë_htc_∑ckë_¸edô_ba£d
(
èrgë
, 
ï
, &
£nd_queue
);

642 
	`gë_htc_∑ckë
(
èrgë
, 
ï
, &
£nd_queue
, 
tx_ªsour˚s
);

645 i‡(
	`gë_queue_dïth
(&
£nd_queue
) == 0) {

652 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

655 
	`htc_issue_∑ckës
(
èrgë
, 
ï
, &
£nd_queue
);

657 i‡(!
ï
->
tx_¸edô_Êow_íabÀd
) {

658 
tx_ªsour˚s
 =

659 
	`©h6kl_hif_pùe_gë_‰ì_queue_numbî
(
¨
,

660 
ï
->
pùeid_ul
);

663 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

665 i‡(
°¨vög
)

669 
ï
->
tx_¥oc_˙t
 = 0;

670 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

672  
HTC_SEND_QUEUE_OK
;

673 
	}
}

675 
	$htc_tx_bundÀ_timî_h™dÀr
(
±r
)

677 
htc_èrgë
 *
èrgë
 = (htc_èrgë *)
±r
;

678 
htc_ídpoöt
 *
ídpoöt
 = &
èrgë
->ídpoöt[
ENDPOINT_2
];

679 
u32
 
cou¡
 = 0;

680 
u32
 
tx_issued
 = 0;

682 
ídpoöt
->
ˇŒ_by_timî
 = 1;

683 
cou¡
++;

685 i‡((
cou¡
%(1000/
htc_bundÀ_£nd_timî
)) == 0) {

689 i‡((
ídpoöt
->
ï_°
.
tx_issued
 -Åx_issued)

690 > 
htc_bundÀ_£nd_th
)

691 
ídpoöt
->
∑ss_th
 = 1;

693 
ídpoöt
->
∑ss_th
 = 0;

694 
tx_issued
 = 
ídpoöt
->
ï_°
.tx_issued;

696 
	`htc_åy_£nd
(
èrgë
, 
ídpoöt
, 
NULL
);

697 
ídpoöt
->
ˇŒ_by_timî
 = 0;

699 
	`mod_timî
(&
ídpoöt
->
timî
,

700 
jiffõs
 + 
	`m£cs_to_jiffõs
(
htc_bundÀ_£nd_timî
));

701 
	}
}

703 
	$htc_tx_ªsour˚_avaûabÀ
(
htc_èrgë
 *
c⁄ãxt
, 
u8
 
pùeid
)

705 
i
;

706 
htc_èrgë
 *
èrgë
 = (htc_èrgë *Ë
c⁄ãxt
;

707 
htc_ídpoöt
 *
ï
 = 
NULL
;

709 
i
 = 0; i < 
ENDPOINT_MAX
; i++) {

710 
ï
 = &
èrgë
->
ídpoöt
[
i
];

711 i‡(
ï
->
svc_id
 != 0) {

712 i‡(
ï
->
pùeid_ul
 =
pùeid
)

717 i‡(
i
 >
ENDPOINT_MAX
) {

718 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

720 
pùeid
);

724 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

726 
__func__
, 
pùeid
);

728 
	`htc_åy_£nd
(
èrgë
, 
ï
, 
NULL
);

729 
	}
}

732 
	$de°roy_htc_tx˘æ_∑ckë
(
htc_∑ckë
 *
∑ckë
)

734 
sk_buff
 *
√tbuf
;

735 
√tbuf
 = (
sk_buff
 *Ë
∑ckë
->
skb
;

736 i‡(
√tbuf
 !
NULL
)

737 
	`dev_k‰ì_skb
(
√tbuf
);

739 
	`k‰ì
(
∑ckë
);

740 
	}
}

742 
htc_∑ckë
 *
	$buûd_htc_tx˘æ_∑ckë
()

744 
htc_∑ckë
 *
∑ckë
 = 
NULL
;

745 
sk_buff
 *
√tbuf
;

747 
∑ckë
 = 
	`kzÆloc
((
htc_∑ckë
), 
GFP_KERNEL
);

748 i‡(
∑ckë
 =
NULL
)

749  
NULL
;

751 
	`mem£t
(
∑ckë
, 0, (
htc_∑ckë
));

752 
√tbuf
 = 
	`__dev_Æloc_skb
(
HTC_CONTROL_BUFFER_SIZE
, 
GFP_KERNEL
);

754 i‡(
√tbuf
 =
NULL
) {

755 
	`k‰ì
(
∑ckë
);

756  
NULL
;

758 
∑ckë
->
skb
 = 
√tbuf
;

760  
∑ckë
;

761 
	}
}

763 
	$htc_‰ì_tx˘æ_∑ckë
(
htc_èrgë
 *
èrgë
,

764 
htc_∑ckë
 *
∑ckë
)

766 
	`de°roy_htc_tx˘æ_∑ckë
(
∑ckë
);

767 
	}
}

769 
htc_∑ckë
 *
	$htc_Æloc_tx˘æ_∑ckë
(
htc_èrgë


770 *
èrgë
)

772  
	`buûd_htc_tx˘æ_∑ckë
();

773 
	}
}

775 
	$htc_tx˘æ_com∂ëe
(
htc_èrgë
 *
c⁄ãxt
,

776 
htc_∑ckë
 *
∑ckë
)

779 
htc_èrgë
 *
èrgë
 =

780 (
htc_èrgë
 *Ë
c⁄ãxt
;

781 
	`htc_‰ì_tx˘æ_∑ckë
(
èrgë
, 
∑ckë
);

782 
	}
}

784 
	#MAX_MESSAGE_SIZE
 1536

	)

786 
	$htc_£tup_èrgë_buf„r_assignmíts
(
htc_èrgë
 *
èrgë
)

788 
htc_pùe_tx¸edô_Æloc
 *
íåy
;

789 
°©us
;

790 
¸edôs
;

791 
¸edô_≥r_maxmsg
;

792 
hif_usbaudio˛ass
 = 0;

794 i‡(
èrgë
->
tgt_¸ed_sz
 == 0)

795  -
ECOMM
;

797 
¸edô_≥r_maxmsg
 = 
MAX_MESSAGE_SIZE
 / 
èrgë
->
tgt_¸ed_sz
;

798 i‡(
MAX_MESSAGE_SIZE
 % 
èrgë
->
tgt_¸ed_sz
)

799 
¸edô_≥r_maxmsg
++;

803 
¸edôs
 = 
èrgë
->
tgt_¸eds
;

804 
íåy
 = &
èrgë
->
tx¸edô_Æloc
[0];

806 
°©us
 = -
ENOMEM
;

808 i‡(
hif_usbaudio˛ass
) {

809 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

811 "F‹ USB AudiÿCœss- TŸÆ:%d\n", 
¸edôs
);

812 
íåy
++;

813 
íåy
++;

815 
íåy
->
£rvi˚_id
 = 
WMI_DATA_VO_SVC
;

816 
íåy
->
¸edô_Æloc
 = (
¸edôs
 - 6);

817 i‡(
íåy
->
¸edô_Æloc
 == 0)

818 
íåy
->
¸edô_Æloc
++;

820 
¸edôs
 -()
íåy
->
¸edô_Æloc
;

821 i‡(
¸edôs
 <= 0)

822  
°©us
;

824 
íåy
++;

825 
íåy
->
£rvi˚_id
 = 
WMI_CONTROL_SVC
;

826 
íåy
->
¸edô_Æloc
 = 
¸edô_≥r_maxmsg
;

827 
¸edôs
 -()
íåy
->
¸edô_Æloc
;

828 i‡(
¸edôs
 <= 0)

829  
°©us
;

832 
íåy
++;

833 
íåy
++;

834 
íåy
->
£rvi˚_id
 = 
WMI_DATA_BE_SVC
;

835 
íåy
->
¸edô_Æloc
 = (
u8
Ë
¸edôs
;

836 
°©us
 = 0;

838 
íåy
++;

839 
íåy
->
£rvi˚_id
 = 
WMI_DATA_VI_SVC
;

840 
íåy
->
¸edô_Æloc
 = 
¸edôs
 / 4;

841 i‡(
íåy
->
¸edô_Æloc
 == 0)

842 
íåy
->
¸edô_Æloc
++;

844 
¸edôs
 -()
íåy
->
¸edô_Æloc
;

845 i‡(
¸edôs
 <= 0)

846  
°©us
;

848 
íåy
++;

849 
íåy
->
£rvi˚_id
 = 
WMI_DATA_VO_SVC
;

850 
íåy
->
¸edô_Æloc
 = 
¸edôs
 / 4;

851 i‡(
íåy
->
¸edô_Æloc
 == 0)

852 
íåy
->
¸edô_Æloc
++;

854 
¸edôs
 -()
íåy
->
¸edô_Æloc
;

855 i‡(
¸edôs
 <= 0)

856  
°©us
;

858 
íåy
++;

859 
íåy
->
£rvi˚_id
 = 
WMI_CONTROL_SVC
;

860 
íåy
->
¸edô_Æloc
 = 
¸edô_≥r_maxmsg
;

861 
¸edôs
 -()
íåy
->
¸edô_Æloc
;

862 i‡(
¸edôs
 <= 0)

863  
°©us
;

865 
íåy
++;

866 
íåy
->
£rvi˚_id
 = 
WMI_DATA_BK_SVC
;

867 
íåy
->
¸edô_Æloc
 = 
¸edô_≥r_maxmsg
;

868 
¸edôs
 -()
íåy
->
¸edô_Æloc
;

869 i‡(
¸edôs
 <= 0)

870  
°©us
;

873 
íåy
++;

874 
íåy
->
£rvi˚_id
 = 
WMI_DATA_BE_SVC
;

875 
íåy
->
¸edô_Æloc
 = (
u8
Ë
¸edôs
;

876 
°©us
 = 0;

879 i‡(
°©us
 == 0) {

880 i‡(
	`AR_DBG_LVL_CHECK
(
ATH6KL_DBG_HTC
)) {

881 
i
;

882 
i
 = 0; i < 
ENDPOINT_MAX
; i++) {

883 i‡(
èrgë
->
tx¸edô_Æloc
[
i
].
£rvi˚_id
 != 0) {

884 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

886 "Æloc:%d\n", 
i
,

887 
èrgë
->
tx¸edô_Æloc
[
i
].

888 
£rvi˚_id
,

889 
èrgë
->
tx¸edô_Æloc
[
i
].

890 
¸edô_Æloc
);

895  
°©us
;

896 
	}
}

899 
	$htc_¥o˚ss_¸edô_ªp‹t
(
htc_èrgë
 *
èrgë
,

900 
htc_¸edô_ªp‹t
 *
Ωt
,

901 
num_íåõs
,

902 
htc_ídpoöt_id
 
‰om_ï
)

904 
i
;

905 
htc_ídpoöt
 *
ï
;

906 
tŸÆ_¸edôs
 = 0;

909 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

911 
i
 = 0; i < 
num_íåõs
; i++, 
Ωt
++) {

912 i‡(
Ωt
->
eid
 >
ENDPOINT_MAX
) {

913 
	`WARN_ON
(1);

914 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

918 
ï
 = &
èrgë
->
ídpoöt
[
Ωt
->
eid
];

920 i‡(
ï
->
eid
 >
ENDPOINT_2
 &&Ép->eid <
ENDPOINT_5
) {

921 
htc_ídpoöt_id
 
eid
[
DATA_EP_SIZE
] = {

922 
ENDPOINT_5
, 
ENDPOINT_4
, 
ENDPOINT_2
, 
ENDPOINT_3
};

923 
ïid_idx
;

925 
èrgë
->
avaû_tx_¸edôs
 +
Ωt
->
¸edôs
;

926 
ï
->
ï_°
.
¸ed_ªäd
 +
Ωt
->
¸edôs
;

927 
ï
->
ï_°
.
tx_¸ed_Ωt
++;

929 
ïid_idx
 = 0;Épid_idx < 
DATA_EP_SIZE
;

930 
ïid_idx
++) {

931 
ï
 = &
èrgë
->
ídpoöt
[
eid
[
ïid_idx
]];

932 i‡(
	`gë_queue_dïth
(&
ï
->
txq
))

935 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

937 
ïid_idx
 = 0;Épid_idx < 
DATA_EP_SIZE
;

938 
ïid_idx
++) {

939 
htc_ídpoöt
 *
°¨vög_ï
;

940 
°¨vög_ï
 = &
èrgë
->
ídpoöt
[
eid
[
ïid_idx
]];

941 i‡(
ï
 =
°¨vög_ï
)

944 i‡(
°¨vög_ï
->
°¨vög
)

945 
	`htc_åy_£nd
(
èrgë
, 
°¨vög_ï
, 
NULL
);

947 
	`htc_åy_£nd
(
èrgë
, 
ï
, 
NULL
);

948 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

950 
ï
->
¸ed_di°
.
¸edôs
 +
Ωt
->credits;

951 
ï
->
ï_°
.
¸ed_ªäd
 +
Ωt
->
¸edôs
;

952 
ï
->
ï_°
.
tx_¸ed_Ωt
++;

954 i‡(
ï
->
¸ed_di°
.
¸edôs
 &&

955 
	`gë_queue_dïth
(&
ï
->
txq
)) {

956 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

957 
	`htc_åy_£nd
(
èrgë
, 
ï
, 
NULL
);

958 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

962 
tŸÆ_¸edôs
 +
Ωt
->
¸edôs
;

964 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

966 
tŸÆ_¸edôs
);

968 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

969 
	}
}

972 
	$htc_Êush_tx_ídpoöt
(
htc_èrgë
 *
èrgë
,

973 
htc_ídpoöt
 *
ï
, 
u16
 
Tag
)

975 
htc_∑ckë
 *
∑ckë
;

977 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

978 
	`gë_queue_dïth
(&
ï
->
txq
)) {

979 
∑ckë
 = 
	`li°_fú°_íåy
(&
ï
->
txq
,

980 
htc_∑ckë
, 
li°
);

981 
	`li°_dñ
(&
∑ckë
->
li°
);

982 
∑ckë
->
°©us
 = 0;

983 
	`£nd_∑ckë_com∂ëi⁄
(
èrgë
, 
∑ckë
);

985 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

986 
	}
}

995 
htc_∑ckë
 *
	$htc_lookup_tx_∑ckë
(
htc_èrgë
 *
èrgë
,

996 
htc_ídpoöt
 *
ï
,

997 
sk_buff
 *
√tbuf
)

999 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

1000 
htc_∑ckë
 *
found_∑ckë
 = 
NULL
;

1002 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

1009 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, &
ï
->
tx_lookup_queue
, 
li°
) {

1011 i‡(
√tbuf
 =
∑ckë
->
skb
) {

1013 
	`li°_dñ
(&
∑ckë
->
li°
);

1014 
found_∑ckë
 = 
∑ckë
;

1020 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1022  
found_∑ckë
;

1023 
	}
}

1025 
	$htc_tx_com∂ëi⁄
(
htc_èrgë
 *
c⁄ãxt
, 
sk_buff
 *
√tbuf
)

1027 
htc_èrgë
 *
èrgë
 = (htc_èrgë *)
c⁄ãxt
;

1028 
u8
 *
√td©a
;

1029 
u32
 
√éí
;

1030 
htc_‰ame_hdr
 *
htc_hdr
;

1031 
u8
 
EpID
;

1032 
htc_ídpoöt
 *
ï
;

1033 
htc_∑ckë
 *
∑ckë
;

1034 
©h6kl
 *
¨
;

1035 
htc_ídpoöt_id
 
eid
[
DATA_EP_SIZE
] = {

1036 
ENDPOINT_5
, 
ENDPOINT_4
, 
ENDPOINT_2
, 
ENDPOINT_3
};

1037 
ïid_idx
;

1038 
u16
 
ªsour˚s_thªsh
[
DATA_EP_SIZE
];

1039 
u16
 
ªsour˚s
;

1040 
u16
 
ªsour˚s_max
;

1042 
√td©a
 = 
√tbuf
->
d©a
;

1043 
√éí
 = 
√tbuf
->
Àn
;

1045 
htc_hdr
 = (
htc_‰ame_hdr
 *)
√td©a
;

1047 
EpID
 = 
htc_hdr
->
eid
;

1048 
ï
 = &
èrgë
->
ídpoöt
[
EpID
];

1050 
∑ckë
 = 
	`htc_lookup_tx_∑ckë
(
èrgë
, 
ï
, 
√tbuf
);

1051 i‡(
∑ckë
 =
NULL
) {

1053 
	`©h6kl_îr
("HTC TXÜookup failed!\n");

1056 
∑ckë
->
°©us
 = 0;

1057 
	`£nd_∑ckë_com∂ëi⁄
(
èrgë
, 
∑ckë
);

1059 
√tbuf
 = 
NULL
;

1061 
ïid_idx
 = 0;Épid_idx < 
DATA_EP_SIZE
;Épid_idx++) {

1062 
htc_ídpoöt
 *
°¨vög_ï
;

1063 
°¨vög_ï
 = &
èrgë
->
ídpoöt
[
eid
[
ïid_idx
]];

1064 i‡(
ï
 =
°¨vög_ï
)

1066 i‡(
°¨vög_ï
->
°¨vög
)

1067 
	`htc_åy_£nd
(
èrgë
, 
°¨vög_ï
, 
NULL
);

1070 
¨
 = 
èrgë
->
dev
->ar;

1072 i‡(!
ï
->
tx_¸edô_Êow_íabÀd
) {

1073 i‡((
¨
->
hw
.
Êags
 & 
ATH6KL_HW_SINGLE_PIPE_SCHED
) &&

1074 (
htc_ídpoöt_id
)
EpID
 >
ENDPOINT_2
 &&

1075 (
htc_ídpoöt_id
)
EpID
 <
ENDPOINT_5
) {

1077 
ªsour˚s_max
 = 
	`©h6kl_hif_pùe_gë_max_queue_numbî
(

1078 
¨
, 
ï
->
pùeid_ul
);

1080 
ªsour˚s_thªsh
[0] = 0;

1081 
ªsour˚s_thªsh
[1] =

1082 (
ªsour˚s_max
 * 2) / 32;

1083 
ªsour˚s_thªsh
[2] =

1084 (
ªsour˚s_max
 * 3) / 32;

1085 
ªsour˚s_thªsh
[3] =

1086 (
ªsour˚s_max
 * 4) / 32;

1088 
ªsour˚s
 = 
	`©h6kl_hif_pùe_gë_‰ì_queue_numbî
(

1089 
¨
, 
ï
->
pùeid_ul
);

1090 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

1091 
ïid_idx
 = 0;Épid_idx < 
DATA_EP_SIZE
;

1092 
ïid_idx
++) {

1093 
ï
 = &
èrgë
->
ídpoöt
[
eid
[
ïid_idx
]];

1095 i‡(!
	`gë_queue_dïth
(&
ï
->
txq
))

1098 i‡(
ªsour˚s
 >
ªsour˚s_thªsh
[
ïid_idx
])

1101 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1103 i‡(
ïid_idx
 =
DATA_EP_SIZE
)

1126 
	`htc_åy_£nd
(
èrgë
, 
ï
, 
NULL
);

1130 
	}
}

1132 
	$htc_£nd_pkts_sched_check
(
htc_èrgë
 *
èrgë
,

1133 
htc_ídpoöt_id
 
id
)

1135 
htc_ídpoöt
 *
ídpoöt
;

1136 
htc_ídpoöt_id
 
eid
;

1137 
li°_hód
 *
tx_queue
;

1138 
u16
 
ac_queue_°©us
[
DATA_EP_SIZE
] = {0, 0, 0, 0};

1139 
u16
 
°©us
;

1141 i‡(
id
 < 
ENDPOINT_2
 || id > 
ENDPOINT_5
)

1144 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

1145 
eid
 = 
ENDPOINT_2
;Éid <
ENDPOINT_5
;Éid++) {

1146 
ídpoöt
 = &
èrgë
->ídpoöt[
eid
];

1147 
tx_queue
 = &
ídpoöt
->
txq
;

1149 i‡(
	`li°_em±y
(
tx_queue
))

1150 
ac_queue_°©us
[
eid
 - 2] = 1;

1152 i‡(
htc_bundÀ_£nd
 && 
htc_bundÀ_£nd_timî
 &&

1153 
eid
 =
ENDPOINT_2
) {

1155 i‡(
ídpoöt
->
timî_öô
 == 0) {

1156 
	`£tup_timî
(&
ídpoöt
->
timî
,

1157 
htc_tx_bundÀ_timî_h™dÀr
,

1158 (Ë
èrgë
);

1159 
	`mod_timî
(&
ídpoöt
->
timî
, 
jiffõs
 +

1160 
	`m£cs_to_jiffõs
(
htc_bundÀ_£nd_timî
));

1161 
ídpoöt
->
timî_öô
 = 1;

1164 i‡(
ídpoöt
->
∑ss_th
 &&

1165 
	`gë_queue_dïth
(&
ídpoöt
->
txq
) <

1166 
HTC_HOST_MAX_MSG_PER_BUNDLE
) {

1167 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1172 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1174 
id
) {

1175 
ENDPOINT_3
:

1176 
°©us
 = 
ac_queue_°©us
[0] &&ác_queue_status[1] &&

1177 
ac_queue_°©us
[2] &&ác_queue_status[3];

1179 
ENDPOINT_4
:

1180 
°©us
 = 
ac_queue_°©us
[2] &&ác_queue_status[3];

1182 
ENDPOINT_5
:

1183 
°©us
 = 
ac_queue_°©us
[3];

1186 
°©us
 = 
ac_queue_°©us
[0] &&ác_queue_status[2] &&

1187 
ac_queue_°©us
[3];

1190  
°©us
;

1191 
	}
}

1193 
	$htc_£nd_pkts_sched_queue
(
htc_èrgë
 *
èrgë
,

1194 
li°_hód
 *
pkt_queue
,

1195 
htc_ídpoöt_id
 
eid
)

1197 
htc_ídpoöt
 *
ídpoöt
;

1198 
li°_hód
 *
tx_queue
;

1199 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

1200 
good_pkts
;

1201 
©h6kl
 *
¨
 = 
èrgë
->
dev
->ar;

1203 
ídpoöt
 = &
èrgë
->ídpoöt[
eid
];

1204 
tx_queue
 = &
ídpoöt
->
txq
;

1206 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

1208 
good_pkts
 = 
ídpoöt
->
max_txq_dïth
 - 
	`gë_queue_dïth
(
tx_queue
);

1210 i‡(
good_pkts
 > 0) {

1211 !
	`li°_em±y
(
pkt_queue
)) {

1212 
∑ckë
 = 
	`li°_fú°_íåy
(
pkt_queue
,

1213 
htc_∑ckë
, 
li°
);

1214 
	`li°_dñ
(&
∑ckë
->
li°
);

1215 
	`li°_add_èû
(&
∑ckë
->
li°
, 
tx_queue
);

1217 
good_pkts
--;

1218 i‡(
good_pkts
 <= 0)

1223 i‡(
	`gë_queue_dïth
(
pkt_queue
)) {

1224 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, 
pkt_queue
, 
li°
) {

1225 i‡(
ídpoöt
->
ï_cb
.
	`tx_fuŒ
((
htc_èrgë
 *)

1226 
ídpoöt
->
èrgë
,

1227 
∑ckë
Ë=
HTC_SEND_FULL_DROP
) {

1228 
ídpoöt
->
ï_°
.
tx_dr›≥d
 += 1;

1230 
	`li°_dñ
(&
∑ckë
->
li°
);

1231 
	`li°_add_èû
(&
∑ckë
->
li°
, 
tx_queue
);

1234 } i‡(
	`ã°_bô
(
MCC_ENABLED
, &
¨
->
Êag
)) {

1235 i‡(
	`gë_queue_dïth
(
tx_queue
Ë> 
ATH6KL_P2P_FLOWCTRL_TXQ_LIMIT
)

1236 
	`©h6kl_p2p_Êow˘æ_√tif_å™sôi⁄
(

1237 
¨
, 
ATH6KL_P2P_FLOWCTRL_NETIF_STOP
);

1240 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

1243 
	}
}

1246 
	$htc_£nd_∑ckës_mu…ùÀ
(
htc_èrgë
 *
h™dÀ
,

1247 
li°_hód
 *
pkt_queue
)

1249 
htc_èrgë
 *
èrgë
 = (htc_èrgë *Ë
h™dÀ
;

1250 
htc_ídpoöt
 *
ï
;

1251 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

1252 
©h6kl
 *
¨
 = 
èrgë
->
dev
->ar;

1254 i‡(
	`li°_em±y
(
pkt_queue
))

1255  -
EINVAL
;

1258 
∑ckë
 = 
	`li°_fú°_íåy
(
pkt_queue
, 
htc_∑ckë
, 
li°
);

1259 i‡(
∑ckë
 =
NULL
)

1260  -
EINVAL
;

1262 i‡(
∑ckë
->
ídpoöt
 >
ENDPOINT_MAX
) {

1263 
	`WARN_ON
(1);

1264  -
EINVAL
;

1266 
ï
 = &
èrgë
->
ídpoöt
[
∑ckë
->endpoint];

1268 i‡(
¨
->
hw
.
Êags
 & 
ATH6KL_HW_SINGLE_PIPE_SCHED
) {

1269 i‡(!
	`htc_£nd_pkts_sched_check
(
èrgë
, 
ï
->
eid
)) {

1270 
	`htc_£nd_pkts_sched_queue
(
èrgë
, 
pkt_queue
, 
ï
->
eid
);

1273 i‡(
¨
->
°¨vög_¥evíti⁄
 &&

1274 
	`time_a·î
(
jiffõs
, 
ï
->
œ°_£¡
 + (
HZ
 >> 3)))

1275 
ï
->
°¨vög
 = 1;

1277 
	`htc_åy_£nd
(
èrgë
, 
ï
, 
pkt_queue
);

1279 
	`htc_åy_£nd
(
èrgë
, 
ï
, 
pkt_queue
);

1283 i‡(!
	`li°_em±y
(
pkt_queue
)) {

1285 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, 
pkt_queue
, 
li°
) {

1286 
∑ckë
->
°©us
 = -
ENOMEM
;

1289 
	`do_£nd_com∂ëi⁄
(
ï
, 
pkt_queue
);

1293 
	}
}

1296 
htc_∑ckë
 *
	$Æloc_htc_∑ckë_c⁄èöî
(
htc_èrgë


1297 *
èrgë
)

1299 
htc_∑ckë
 *
∑ckë
;

1300 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1302 i‡(
èrgë
->
htc_∑ckë_poﬁ
 =
NULL
) {

1303 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1304  
NULL
;

1307 
∑ckë
 = 
èrgë
->
htc_∑ckë_poﬁ
;

1308 
èrgë
->
htc_∑ckë_poﬁ
 = (
htc_∑ckë
 *)
∑ckë
->
li°
.
√xt
;

1310 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1312 
∑ckë
->
li°
.
√xt
 = 
NULL
;

1313  
∑ckë
;

1314 
	}
}

1316 
	$‰ì_htc_∑ckë_c⁄èöî
(
htc_èrgë
 *
èrgë
,

1317 
htc_∑ckë
 *
∑ckë
)

1319 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1321 i‡(
èrgë
->
htc_∑ckë_poﬁ
 =
NULL
) {

1322 
èrgë
->
htc_∑ckë_poﬁ
 = 
∑ckë
;

1323 
∑ckë
->
li°
.
√xt
 = 
NULL
;

1325 
∑ckë
->
li°
.
√xt
 = (
li°_hód
 *)
èrgë
->
htc_∑ckë_poﬁ
;

1326 
èrgë
->
htc_∑ckë_poﬁ
 = 
∑ckë
;

1329 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1330 
	}
}

1332 
	$htc_¥o˚ss_åaûî
(
htc_èrgë
 *
èrgë
,

1333 
u8
 *
buf„r
,

1334 
Àn
, 
htc_ídpoöt_id
 
‰om_ï
)

1336 
htc_ªc‹d_hdr
 *
ªc‹d
;

1337 
u8
 *
ªc‹d_buf
;

1338 
u8
 *
‹ig_buf
;

1339 
‹ig_Àn
;

1340 
°©us
;

1342 
‹ig_buf
 = 
buf„r
;

1343 
‹ig_Àn
 = 
Àn
;

1344 
°©us
 = 0;

1346 
Àn
 > 0) {

1348 i‡(
Àn
 < (
htc_ªc‹d_hdr
)) {

1349 
°©us
 = -
EINVAL
;

1353 
ªc‹d
 = (
htc_ªc‹d_hdr
 *)
buf„r
;

1354 
Àn
 -(
htc_ªc‹d_hdr
);

1355 
buf„r
 +(
htc_ªc‹d_hdr
);

1357 i‡(
ªc‹d
->
Àn
 >Üen) {

1359 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1361 
ªc‹d
->
Àn
,Ñec‹d->
ªc_id
,Üen);

1362 
°©us
 = -
EINVAL
;

1366 
ªc‹d_buf
 = 
buf„r
;

1368 
ªc‹d
->
ªc_id
) {

1369 
HTC_RECORD_CREDITS
:

1370 i‡(
ªc‹d
->
Àn
 <

1371 (
htc_¸edô_ªp‹t
)) {

1372 
	`WARN_ON
(1);

1373  -
EINVAL
;

1376 
	`htc_¥o˚ss_¸edô_ªp‹t
(
èrgë
,

1377 (
htc_¸edô_ªp‹t
 *)

1378 
ªc‹d_buf
,

1379 
ªc‹d
->
Àn
 /

1381 (
htc_¸edô_ªp‹t
)),

1382 
‰om_ï
);

1385 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1387 
ªc‹d
->
ªc_id
,Ñec‹d->
Àn
);

1392 
buf„r
 +
ªc‹d
->
Àn
;

1393 
Àn
 -
ªc‹d
->len;

1396  
°©us
;

1397 
	}
}

1399 
	$do_ªcv_com∂ëi⁄
(
htc_ídpoöt
 *
ï
,

1400 
li°_hód
 *
queue_to_ödiˇã
)

1402 
htc_∑ckë
 *
∑ckë
;

1403 i‡(
	`li°_em±y
(
queue_to_ödiˇã
)) {

1409 !
	`li°_em±y
(
queue_to_ödiˇã
)) {

1410 
∑ckë
 = 
	`li°_fú°_íåy
(
queue_to_ödiˇã
,

1411 
htc_∑ckë
, 
li°
);

1412 
	`li°_dñ
(&
∑ckë
->
li°
);

1413 
ï
->
ï_cb
.
	`rx
((
htc_èrgë
 *)

1414 
ï
->
èrgë
, 
∑ckë
);

1418 
	}
}

1420 
	$ªcv_∑ckë_com∂ëi⁄
(
htc_èrgë
 *
èrgë
,

1421 
htc_ídpoöt
 *
ï
,

1422 
htc_∑ckë
 *
∑ckë
)

1424 
li°_hód
 
c⁄èöî
;

1425 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

1426 
	`li°_add_èû
(&
∑ckë
->
li°
, &
c⁄èöî
);

1428 
	`do_ªcv_com∂ëi⁄
(
ï
, &
c⁄èöî
);

1429 
	}
}

1431 
sk_buff
 *
	$rx_sg_to_sögÀ_√tbuf
(
htc_èrgë
 *
èrgë
)

1433 
sk_buff
 *
skb
;

1434 
u8
 *
™bd©a
;

1435 
u8
 *
™bd©a_√w
;

1436 
u32
 
™bÀn
;

1437 
sk_buff
 *
√w_skb
 = 
NULL
;

1438 
sk_buff_hód
 *
rx_sg_queue
 = &
èrgë
->
rx_sg_q
;

1440 i‡(
	`skb_queue_em±y
(
rx_sg_queue
)) {

1441 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1442 "%s: invÆid sg queuêÀn\n", 
__func__
);

1443 
_Áûed
;

1446 
√w_skb
 = 
	`__dev_Æloc_skb
(
èrgë
->
rx_sg_tŸÆ_Àn_exp
, 
GFP_ATOMIC
);

1447 i‡(
√w_skb
 =
NULL
) {

1448 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1450 
__func__
, 
èrgë
->
rx_sg_tŸÆ_Àn_exp
);

1451 
_Áûed
;

1454 
™bd©a_√w
 = 
√w_skb
->
d©a
;

1455 
™bÀn
 = 
√w_skb
->
Àn
;

1457 (
skb
 = 
	`skb_dequeue
(
rx_sg_queue
))) {

1458 
™bd©a
 = 
skb
->
d©a
;

1459 
	`mem˝y
(
™bd©a_√w
, 
™bd©a
, 
skb
->
Àn
);

1460 
	`skb_put
(
√w_skb
, 
skb
->
Àn
);

1461 
™bd©a_√w
 +
skb
->
Àn
;

1462 
	`dev_k‰ì_skb
(
skb
);

1465 
èrgë
->
rx_sg_tŸÆ_Àn_exp
 = 0;

1466 
èrgë
->
rx_sg_tŸÆ_Àn_cur
 = 0;

1467 
èrgë
->
rx_sg_ö_¥ogªss
 = 
Ál£
;

1469  
√w_skb
;

1471 
_Áûed
:

1473 (
skb
 = 
	`skb_dequeue
(
rx_sg_queue
)))

1474 
	`dev_k‰ì_skb
(
skb
);

1475 
èrgë
->
rx_sg_tŸÆ_Àn_exp
 = 0;

1476 
èrgë
->
rx_sg_tŸÆ_Àn_cur
 = 0;

1477 
èrgë
->
rx_sg_ö_¥ogªss
 = 
Ál£
;

1478  
NULL
;

1479 
	}
}

1481 
	$htc_rx_com∂ëi⁄
(
htc_èrgë
 *
c⁄ãxt
,

1482 
sk_buff
 *
√tbuf
, 
u8
 
pùeid
)

1484 
°©us
 = 0;

1485 
htc_‰ame_hdr
 *
htc_hdr
;

1486 
htc_èrgë
 *
èrgë
 = (htc_èrgë *)
c⁄ãxt
;

1487 
u8
 *
√td©a
;

1488 
u8
 
hdr_öfo
;

1489 
u32
 
√éí
;

1490 
htc_ídpoöt
 *
ï
;

1491 
htc_∑ckë
 *
∑ckë
;

1492 
u16
 
∑ylﬂd_Àn
;

1493 
u32
 
åaûîÀn
 = 0;

1495 
i
;

1497 
u32
 
as£π_∑âîn
 = 
	`˝u_to_be32
(0x0000c600);

1499 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1500 i‡(
èrgë
->
rx_sg_ö_¥ogªss
) {

1501 
èrgë
->
rx_sg_tŸÆ_Àn_cur
 +
√tbuf
->
Àn
;

1502 
	`skb_queue_èû
(&
èrgë
->
rx_sg_q
, 
√tbuf
);

1503 i‡(
èrgë
->
rx_sg_tŸÆ_Àn_cur
 ==

1504 
èrgë
->
rx_sg_tŸÆ_Àn_exp
) {

1505 
√tbuf
 = 
	`rx_sg_to_sögÀ_√tbuf
(
èrgë
);

1506 i‡(
√tbuf
 =
NULL
) {

1507 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1508 
‰ì_√tbuf
;

1511 
√tbuf
 = 
NULL
;

1512 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1513 
‰ì_√tbuf
;

1517 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1519 
√td©a
 = 
√tbuf
->
d©a
;

1520 
√éí
 = 
√tbuf
->
Àn
;

1522 
	#CONFIG_CRASH_DUMP
 1

	)

1523 #i‡
CONFIG_CRASH_DUMP


1524 i‡(!
	`memcmp
(
√td©a
, &
as£π_∑âîn
, (assert_pattern))) {

1526 
	#REG_DUMP_COUNT_AR6004
 76

	)

1527 
√td©a
 += 4;

1529 
	`©h6kl_öfo
("Firmware crash detected...\n");

1530 
i
 = 0; i < 
REG_DUMP_COUNT_AR6004
 * 4; i += 16) {

1531 
	`©h6kl_öfo
("%d: 0x%08x 0x%08x 0x%08x 0x%08x\n", 
i
/4,

1532 
	`be32_to_˝u
(*(
u32
 *)(
√td©a
+
i
)),

1533 
	`be32_to_˝u
(*(
u32
 *)(
√td©a
+
i
 + 4)),

1534 
	`be32_to_˝u
(*(
u32
 *)(
√td©a
+
i
 + 8)),

1535 
	`be32_to_˝u
(*(
u32
 *)(
√td©a
+
i
 + 12)));

1537 
	`dev_k‰ì_skb
(
√tbuf
);

1538 
√tbuf
 = 
NULL
;

1540 
	`©h6kl_fw_¸ash_å≠
(
èrgë
->
dev
->
¨
);

1542 
‰ì_√tbuf
;

1546 
htc_hdr
 = (
htc_‰ame_hdr
 *)
√td©a
;

1548 
ï
 = &
èrgë
->
ídpoöt
[
htc_hdr
->
eid
];

1550 i‡(
htc_hdr
->
eid
 >
ENDPOINT_MAX
) {

1551 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1553 
htc_hdr
->
eid
);

1554 
°©us
 = -
EINVAL
;

1555 
‰ì_√tbuf
;

1558 
∑ylﬂd_Àn
 = 
	`À16_to_˝u
(
	`gë_u«lig√d
(&
htc_hdr
->
∑yld_Àn
));

1560 i‡(
√éí
 < (
∑ylﬂd_Àn
 + 
HTC_HDR_LENGTH
)) {

1561 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1562 
èrgë
->
rx_sg_ö_¥ogªss
 = 
åue
;

1563 
	`skb_queue_èû
(&
èrgë
->
rx_sg_q
, 
√tbuf
);

1564 
èrgë
->
rx_sg_tŸÆ_Àn_exp
 = (
∑ylﬂd_Àn
 + 
HTC_HDR_LENGTH
);

1565 
èrgë
->
rx_sg_tŸÆ_Àn_cur
 +
√éí
;

1566 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1567 
√tbuf
 = 
NULL
;

1568 
‰ì_√tbuf
;

1572 
hdr_öfo
 = 
htc_hdr
->
Êags
;

1573 i‡(
hdr_öfo
 & 
HTC_FLG_RX_TRAILER
) {

1575 
hdr_öfo
 = 
htc_hdr
->
˘æ
[0];

1576 i‡((
hdr_öfo
 < (
htc_ªc‹d_hdr
))

1577 || (
hdr_öfo
 > 
∑ylﬂd_Àn
)) {

1578 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1581 
∑ylﬂd_Àn
, 
hdr_öfo
);

1582 
°©us
 = -
EINVAL
;

1583 
‰ì_√tbuf
;

1586 
åaûîÀn
 = 
hdr_öfo
;

1588 
°©us
 = 
	`htc_¥o˚ss_åaûî
(
èrgë
,

1589 ((
u8
 *Ë
htc_hdr
 +

1590 
HTC_HDR_LENGTH
 +

1591 
∑ylﬂd_Àn
 -

1592 
hdr_öfo
), hdr_info,

1593 
htc_hdr
->
eid
);

1594 i‡(
°©us
 != 0)

1595 
‰ì_√tbuf
;

1598 i‡((()
∑ylﬂd_Àn
 - ()
åaûîÀn
) <= 0) {

1600 
‰ì_√tbuf
;

1603 i‡(
htc_hdr
->
eid
 =
ENDPOINT_0
) {

1605 i‡(
èrgë
->
htc_Êags
 & 
HTC_OP_STATE_SETUP_COMPLETE
) {

1610 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1612 
°©us
 = -
EINVAL
;

1613 
‰ì_√tbuf
;

1617 
	`skb_puŒ
(
√tbuf
, 
HTC_HDR_LENGTH
);

1619 
√td©a
 = 
√tbuf
->
d©a
;

1620 
√éí
 = 
√tbuf
->
Àn
;

1622 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1624 
èrgë
->
˘æ_ª•⁄£_vÆid
 = 
åue
;

1625 
èrgë
->
˘æ_ª•⁄£_Àn
 =

1626 
	`mö_t
(, 
√éí
, 
HTC_MAX_CTRL_MSG_LEN
);

1627 
	`mem˝y
(
èrgë
->
˘æ_ª•⁄£_buf
, 
√td©a
,

1628 
èrgë
->
˘æ_ª•⁄£_Àn
);

1630 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1632 
	`dev_k‰ì_skb
(
√tbuf
);

1633 
√tbuf
 = 
NULL
;

1634 
‰ì_√tbuf
;

1642 
∑ckë
 = 
	`Æloc_htc_∑ckë_c⁄èöî
(
èrgë
);

1643 i‡(
∑ckë
 =
NULL
) {

1644 
°©us
 = -
ENOMEM
;

1645 
‰ì_√tbuf
;

1647 
∑ckë
->
°©us
 = 0;

1648 
∑ckë
->
ídpoöt
 = 
htc_hdr
->
eid
;

1649 
∑ckë
->
pkt_˙txt
 = 
√tbuf
;

1651 
∑ckë
->
buf
 = 
	`skb_push
(
√tbuf
, 0Ë+ 
HTC_HDR_LENGTH
;

1652 
∑ckë
->
a˘_Àn
 = 
√éí
 - 
HTC_HDR_LENGTH
 - 
åaûîÀn
;

1653 
ï
->
ï_°
.
rx_pkts
++;

1659 
	`skb_åim
(
√tbuf
, 0);

1661 
	`ªcv_∑ckë_com∂ëi⁄
(
èrgë
, 
ï
, 
∑ckë
);

1663 
	`‰ì_htc_∑ckë_c⁄èöî
(
èrgë
, 
∑ckë
);

1664 
√tbuf
 = 
NULL
;

1666 
‰ì_√tbuf
:

1667 i‡(
√tbuf
 !
NULL
)

1668 
	`dev_k‰ì_skb
(
√tbuf
);

1670  
°©us
;

1672 
	}
}

1674 
	$htc_Êush_rx_queue
(
htc_èrgë
 *
èrgë
,

1675 
htc_ídpoöt
 *
ï
)

1677 
htc_∑ckë
 *
∑ckë
;

1678 
li°_hód
 
c⁄èöî
;

1680 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1683 i‡(
	`li°_em±y
(&
ï
->
rx_bufq
))

1685 
∑ckë
 = 
	`li°_fú°_íåy
(&
ï
->
rx_bufq
,

1686 
htc_∑ckë
, 
li°
);

1687 
	`li°_dñ
(&
∑ckë
->
li°
);

1689 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1690 
∑ckë
->
°©us
 = -
ECANCELED
;

1691 
∑ckë
->
a˘_Àn
 = 0;

1692 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1694 ()
∑ckë
,Öackë->
buf_Àn
,

1695 
∑ckë
->
ídpoöt
);

1696 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

1697 
	`li°_add_èû
(&
∑ckë
->
li°
, &
c⁄èöî
);

1699 
	`do_ªcv_com∂ëi⁄
(
ï
, &
c⁄èöî
);

1700 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1703 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1704 
	}
}

1707 
	$htc_waô_ªcv_˘æ_mesßge
(
htc_èrgë
 *
èrgë
)

1709 
ªt
, 
cou¡
 = 
HTC_TARGET_RESPONSE_POLL_COUNT
;

1711 
cou¡
 > 0) {

1712 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

1714 i‡(
èrgë
->
˘æ_ª•⁄£_vÆid
) {

1715 
èrgë
->
˘æ_ª•⁄£_vÆid
 = 
Ál£
;

1716 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1720 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

1722 
cou¡
--;

1724 
	`£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

1725 
ªt
 = 
	`scheduÀ_timeout
(
	`m£cs_to_jiffõs
(

1726 
HTC_TARGET_RESPONSE_POLL_MS
));

1727 
	`£t_cuºít_°©e
(
TASK_RUNNING
);

1729 i‡(
cou¡
 <= 0) {

1730 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1731 "%s: Timeout!\n", 
__func__
);

1732  -
ECOMM
;

1736 
	}
}

1738 
	$htc_rx˘æ_com∂ëe
(
htc_èrgë
 *
c⁄ãxt
,

1739 
htc_∑ckë
 *
∑ckë
)

1741 
sk_buff
 *
skb
 = 
∑ckë
->skb;

1743 i‡(
∑ckë
->
ídpoöt
 =
ENDPOINT_0
) {

1744 i‡(
∑ckë
->
°©us
 =-
ECANCELED
) {

1745 i‡(
skb
)

1746 
	`dev_k‰ì_skb
(
skb
);

1751 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "%s: invalid call function,Ép = %d\n",

1752 
__func__
, 
∑ckë
->
ídpoöt
);

1754 
	`WARN_ON
(1);

1757 
	}
}

1760 
	$ª£t_ídpoöt_°©es
(
htc_èrgë
 *
èrgë
)

1762 
htc_ídpoöt
 *
ï
;

1763 
i
;

1765 
i
 = 
ENDPOINT_0
; i < 
ENDPOINT_MAX
; i++) {

1766 
ï
 = &
èrgë
->
ídpoöt
[
i
];

1767 
ï
->
svc_id
 = 0;

1768 
ï
->
Àn_max
 = 0;

1769 
ï
->
max_txq_dïth
 = 0;

1770 
ï
->
eid
 = 
i
;

1771 
	`INIT_LIST_HEAD
(&
ï
->
txq
);

1772 
	`INIT_LIST_HEAD
(&
ï
->
tx_lookup_queue
);

1773 
	`INIT_LIST_HEAD
(&
ï
->
rx_bufq
);

1774 
ï
->
èrgë
 =Åarget;

1775 
ï
->
tx_¸edô_Êow_íabÀd
 = (
boﬁ
) 1;

1776 #ifde‡
USB_AUTO_SUSPEND


1777 i‡(
i
 =
ENDPOINT_1
)

1778 
ï
->
tx_¸edô_Êow_íabÀd
 = (
boﬁ
) 0;

1781 
	}
}

1784 
	$htc_c⁄fig_èrgë_hif_pùe
(
htc_èrgë
 *
èrgë
)

1787 
	}
}

1790 
u8
 
	$htc_gë_¸edô_Æloc
(
htc_èrgë
 *
èrgë
, 
u16
 
£rvi˚_id
)

1792 
u8
 
Æloˇti⁄
 = 0;

1793 
i
;

1795 
i
 = 0; i < 
ENDPOINT_MAX
; i++) {

1796 i‡(
èrgë
->
tx¸edô_Æloc
[
i
].
£rvi˚_id
 == service_id)

1797 
Æloˇti⁄
 = 
èrgë
->
tx¸edô_Æloc
[
i
].
¸edô_Æloc
;

1800 i‡(
Æloˇti⁄
 == 0) {

1801 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1803 
£rvi˚_id
);

1806  
Æloˇti⁄
;

1807 
	}
}

1809 
	$©h6kl_htc_pùe_c⁄n_£rvi˚
(
htc_èrgë
 *
h™dÀ
,

1810 
htc_£rvi˚_c⁄√˘_ªq
 *
c⁄n_ªq
,

1811 
htc_£rvi˚_c⁄√˘_ª•
 *
c⁄n_ª•
)

1813 
©h6kl
 *
¨
 = 
h™dÀ
->
dev
->ar;

1814 
htc_èrgë
 *
èrgë
 = (htc_èrgë *Ë
h™dÀ
;

1815 
°©us
 = 0;

1816 
htc_∑ckë
 *
∑ckë
 = 
NULL
;

1817 
htc_c⁄n_£rvi˚_ª•
 *
ª•_msg
;

1818 
htc_c⁄n_£rvi˚_msg
 *
c⁄n_msg
;

1819 
htc_ídpoöt_id
 
assig√d_ïid
 = 
ENDPOINT_MAX
;

1820 
htc_ídpoöt
 *
ï
;

1821 
max_msg_size
 = 0;

1822 
sk_buff
 *
√tbuf
;

1823 
u8
 
tx_Æloc
;

1824 
Àngth
;

1825 
boﬁ
 
dißbÀ_¸edô_Êow˘æ
 = 
Ál£
;

1827 i‡(
c⁄n_ªq
->
svc_id
 == 0) {

1828 
	`WARN_ON
(1);

1829 
°©us
 = -
EINVAL
;

1830 
‰ì_∑ckë
;

1833 i‡(
c⁄n_ªq
->
svc_id
 =
HTC_CTRL_RSVD_SVC
) {

1835 
assig√d_ïid
 = 
ENDPOINT_0
;

1836 
max_msg_size
 = 
HTC_MAX_CTRL_MSG_LEN
;

1837 
tx_Æloc
 = 0;

1841 
tx_Æloc
 =

1842 
	`htc_gë_¸edô_Æloc
(
èrgë
, 
c⁄n_ªq
->
svc_id
);

1843 i‡(
tx_Æloc
 == 0) {

1844 
°©us
 = -
ENOMEM
;

1845 
‰ì_∑ckë
;

1849 
∑ckë
 = 
	`htc_Æloc_tx˘æ_∑ckë
(
èrgë
);

1851 i‡(
∑ckë
 =
NULL
) {

1852 
	`WARN_ON
(1);

1853 
°©us
 = -
ENOMEM
;

1854 
‰ì_∑ckë
;

1857 
√tbuf
 = 
∑ckë
->
skb
;

1858 
Àngth
 = (
htc_c⁄n_£rvi˚_msg
);

1861 
c⁄n_msg
 =

1862 (
htc_c⁄n_£rvi˚_msg
 *)
	`skb_put
(
√tbuf
,

1863 
Àngth
);

1864 i‡(
c⁄n_msg
 =
NULL
) {

1865 
	`WARN_ON
(1);

1866 
°©us
 = -
EINVAL
;

1867 
‰ì_∑ckë
;

1870 
	`mem£t
(
c⁄n_msg
, 0,

1871 (
htc_c⁄n_£rvi˚_msg
));

1872 
c⁄n_msg
->
msg_id
 = 
	`˝u_to_À16
(
HTC_MSG_CONN_SVC_ID
);

1873 
c⁄n_msg
->
svc_id
 = 
	`˝u_to_À16
(
c⁄n_ªq
->svc_id);

1874 
c⁄n_msg
->
c⁄n_Êags
 = 
	`˝u_to_À16
(
c⁄n_ªq
->conn_flags &

1875 ~
HTC_CONN_FLGS_SET_RECV_ALLOC_MASK
);

1878 
c⁄n_msg
->
c⁄n_Êags
 |
	`˝u_to_À16
(

1879 
tx_Æloc
 << 
HTC_CONN_FLGS_SET_RECV_ALLOC_SHIFT
);

1881 i‡(
c⁄n_ªq
->
c⁄n_Êags
 &

1882 
HTC_CONN_FLGS_DISABLE_CRED_FLOW_CTRL
) {

1883 
dißbÀ_¸edô_Êow˘æ
 = 
åue
;

1886 
	`£t_htc_pkt_öfo
(
∑ckë
, 
NULL
, (
u8
 *Ë
c⁄n_msg
,

1887 
Àngth
,

1888 
ENDPOINT_0
, 
HTC_SERVICE_TX_PACKET_TAG
);

1890 
°©us
 = 
	`©h6kl_htc_pùe_tx
(
h™dÀ
, 
∑ckë
);

1892 
∑ckë
 = 
NULL
;

1893 i‡(
°©us
 != 0)

1894 
‰ì_∑ckë
;

1897 
°©us
 = 
	`htc_waô_ªcv_˘æ_mesßge
(
èrgë
);

1898 i‡(
°©us
 != 0)

1899 
‰ì_∑ckë
;

1904 
ª•_msg
 = (
htc_c⁄n_£rvi˚_ª•
 *)

1905 
èrgë
->
˘æ_ª•⁄£_buf
;

1907 i‡((
ª•_msg
->
msg_id
 !
	`˝u_to_À16
(
HTC_MSG_CONN_SVC_RESP_ID
))

1908 || (
èrgë
->
˘æ_ª•⁄£_Àn
 <

1909 (
htc_c⁄n_£rvi˚_ª•
))) {

1911 
	`WARN_ON
(1);

1912 
°©us
 = -
EINVAL
;

1913 
‰ì_∑ckë
;

1916 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
,

1918 "°©us: %dÉp: %d\n", 
__func__
,

1919 
	`À16_to_˝u
(
ª•_msg
->
svc_id
),Ñe•_msg->
°©us
,

1920 
ª•_msg
->
eid
);

1922 
c⁄n_ª•
->
ª•_code
 = 
ª•_msg
->
°©us
;

1924 i‡(
ª•_msg
->
°©us
 !
HTC_SERVICE_SUCCESS
) {

1925 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1928 
	`À16_to_˝u
(
ª•_msg
->
svc_id
),

1929 
ª•_msg
->
°©us
);

1930 
°©us
 = -
EINVAL
;

1931 
‰ì_∑ckë
;

1934 
assig√d_ïid
 = (
htc_ídpoöt_id
)
ª•_msg
->
eid
;

1935 
max_msg_size
 = 
	`À16_to_˝u
(
ª•_msg
->
max_msg_sz
);

1939 
°©us
 = -
EINVAL
;

1941 i‡(
assig√d_ïid
 >
ENDPOINT_MAX


1942 || 
assig√d_ïid
 <
ENDPOINT_UNUSED
) {

1943 
	`WARN_ON
(1);

1944 
‰ì_∑ckë
;

1947 i‡(
max_msg_size
 == 0) {

1948 
	`WARN_ON
(1);

1949 
‰ì_∑ckë
;

1952 
ï
 = &
èrgë
->
ídpoöt
[
assig√d_ïid
];

1953 
ï
->
eid
 = 
assig√d_ïid
;

1954 i‡(
ï
->
svc_id
 != 0) {

1956 
	`WARN_ON
(1);

1957 
‰ì_∑ckë
;

1960 i‡(
èrgë
->
tgt_¸ed_sz
 == 0)

1961 
‰ì_∑ckë
;

1964 
c⁄n_ª•
->
ídpoöt
 = 
assig√d_ïid
;

1965 
c⁄n_ª•
->
Àn_max
 = 
max_msg_size
;

1968 
ï
->
svc_id
 = 
c⁄n_ªq
->svc_id;

1969 
ï
->
max_txq_dïth
 = 
c⁄n_ªq
->max_txq_depth;

1970 
ï
->
Àn_max
 = 
max_msg_size
;

1971 
ï
->
¸ed_di°
.
¸edôs
 = 
tx_Æloc
;

1972 
ï
->
¸ed_di°
.
¸ed_sz
 = 
èrgë
->
tgt_¸ed_sz
;

1973 
ï
->
¸ed_di°
.
¸ed_≥r_msg
 =

1974 
max_msg_size
 / 
èrgë
->
tgt_¸ed_sz
;

1975 i‡(
max_msg_size
 % 
èrgë
->
tgt_¸ed_sz
)

1976 
ï
->
¸ed_di°
.
¸ed_≥r_msg
++;

1979 
ï
->
ï_cb
 = 
c⁄n_ªq
->ep_cb;

1982 
ï
->
tx_dr›_∑ckë_thªshﬁd
 = 
MAX_HI_COOKIE_NUM
;

1984 
°©us
 = 
	`©h6kl_hif_pùe_m≠_£rvi˚
(
¨
, 
ï
->
svc_id
,

1985 &
ï
->
pùeid_ul
, &ï->
pùeid_dl
);

1986 i‡(
°©us
 != 0)

1987 
‰ì_∑ckë
;

1989 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1991 
ï
->
svc_id
,Ép->
pùeid_ul
,

1992 
ï
->
pùeid_dl
,Ép->
eid
);

1994 i‡(
dißbÀ_¸edô_Êow˘æ
 && 
ï
->
tx_¸edô_Êow_íabÀd
) {

1995 
ï
->
tx_¸edô_Êow_íabÀd
 = 
Ál£
;

1996 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

1998 
ï
->
svc_id
, 
assig√d_ïid
);

2001 
‰ì_∑ckë
:

2002 i‡(
∑ckë
 !
NULL
)

2003 
	`htc_‰ì_tx˘æ_∑ckë
(
èrgë
, 
∑ckë
);

2004  
°©us
;

2005 
	}
}

2008 *
	$©h6kl_htc_pùe_¸óã
(
©h6kl
 *
¨
)

2010 
°©us
 = 0;

2011 
©h6kl_hif_pùe_ˇŒbacks
 
htc_ˇŒbacks
;

2012 
htc_ídpoöt
 *
ï
 = 
NULL
;

2013 
htc_èrgë
 *
èrgë
 = 
NULL
;

2014 
htc_∑ckë
 *
∑ckë
;

2015 
i
;

2017 
èrgë
 = 
	`kzÆloc
((
htc_èrgë
), 
GFP_KERNEL
);

2018 i‡(
èrgë
 =
NULL
) {

2019 
	`©h6kl_îr
("htc create unableÅoállocate memory\n");

2020 
°©us
 = -
ENOMEM
;

2021 
Áû_htc_¸óã
;

2024 
	`mem£t
(
èrgë
, 0, (
htc_èrgë
));

2026 
	`•ö_lock_öô
(&
èrgë
->
htc_lock
);

2027 
	`•ö_lock_öô
(&
èrgë
->
rx_lock
);

2028 
	`•ö_lock_öô
(&
èrgë
->
tx_lock
);

2030 
	`skb_queue_hód_öô
(&
èrgë
->
rx_sg_q
);

2032 
	`ª£t_ídpoöt_°©es
(
èrgë
);

2034 
i
 = 0; i < 
HTC_PACKET_CONTAINER_ALLOCATION
; i++) {

2035 
∑ckë
 = (
htc_∑ckë
 *)

2036 
	`kzÆloc
((
htc_∑ckë
), 
GFP_KERNEL
);

2037 i‡(
∑ckë
 !
NULL
) {

2038 
	`mem£t
(
∑ckë
, 0, (
htc_∑ckë
));

2039 
	`‰ì_htc_∑ckë_c⁄èöî
(
èrgë
, 
∑ckë
);

2043 
	`mem£t
(&
htc_ˇŒbacks
, 0, (
©h6kl_hif_pùe_ˇŒbacks
));

2044 
htc_ˇŒbacks
.
rx_com∂ëi⁄
 = 
htc_rx_com∂ëi⁄
;

2045 
htc_ˇŒbacks
.
tx_com∂ëi⁄
 = 
htc_tx_com∂ëi⁄
;

2046 
htc_ˇŒbacks
.
tx_ªsour˚_avaûabÀ
 = 
htc_tx_ªsour˚_avaûabÀ
;

2048 
èrgë
->
dev
 =

2049 
	`kzÆloc
((*
èrgë
->
dev
), 
GFP_KERNEL
);

2050 i‡(!
èrgë
->
dev
) {

2051 
	`©h6kl_îr
("unableÅoállocate memory\n");

2052 
°©us
 = -
ENOMEM
;

2053 
Áû_htc_¸óã
;

2055 
èrgë
->
dev
->
¨
 =ár;

2056 
èrgë
->
dev
->
htc_˙xt
 = (
htc_èrgë
 *)target;

2059 
ï
 = &
èrgë
->
ídpoöt
[
ENDPOINT_0
];

2061 
	`©h6kl_hif_pùe_ªgi°î_ˇŒback
(
¨
, 
èrgë
, &
htc_ˇŒbacks
);

2062 
	`©h6kl_hif_pùe_gë_deÁu…
(
¨
, &
ï
->
pùeid_ul
, &ï->
pùeid_dl
);

2064  (*)
èrgë
;

2066 
Áû_htc_¸óã
:

2067 i‡(
°©us
 != 0) {

2068 i‡(
èrgë
 !
NULL
)

2069 
	`©h6kl_htc_pùe_˛ónup
((
htc_èrgë
 *)
èrgë
);

2070 
èrgë
 = 
NULL
;

2072  (*)
èrgë
;

2073 
	}
}

2076 
	$©h6kl_htc_pùe_˛ónup
(
htc_èrgë
 *
h™dÀ
)

2078 
htc_∑ckë
 *
∑ckë
;

2079 
htc_èrgë
 *
èrgë
 = (htc_èrgë *Ë
h™dÀ
;

2081 
åue
) {

2082 
∑ckë
 = 
	`Æloc_htc_∑ckë_c⁄èöî
(
èrgë
);

2083 i‡(
∑ckë
 =
NULL
)

2085 
	`k‰ì
(
∑ckë
);

2087 
	`k‰ì
(
èrgë
->
dev
);

2089 
	`k‰ì
(
èrgë
);

2090 
	}
}

2092 
	$©h6kl_htc_pùe_°¨t
(
htc_èrgë
 *
h™dÀ
)

2094 
sk_buff
 *
√tbuf
;

2095 
htc_èrgë
 *
èrgë
 = (htc_èrgë *Ë
h™dÀ
;

2096 
htc_£tup_comp_ext_msg
 *
£tup_comp
;

2097 
htc_∑ckë
 *
∑ckë
;

2099 
	`htc_c⁄fig_èrgë_hif_pùe
(
èrgë
);

2101 
∑ckë
 = 
	`htc_Æloc_tx˘æ_∑ckë
(
èrgë
);

2102 i‡(
∑ckë
 =
NULL
) {

2103 
	`WARN_ON
(1);

2104  -
ENOMEM
;

2107 
√tbuf
 = 
∑ckë
->
skb
;

2109 
£tup_comp
 =

2110 (
htc_£tup_comp_ext_msg
 *)
	`skb_put
(
√tbuf
,

2111 (
htc_£tup_comp_ext_msg
));

2112 
	`mem£t
(
£tup_comp
, 0, (
htc_£tup_comp_ext_msg
));

2113 
£tup_comp
->
msg_id
 = 
	`˝u_to_À16
(
HTC_MSG_SETUP_COMPLETE_EX_ID
);

2116 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2118 
£tup_comp
->
Êags
 |=

2119 
HTC_SETUP_COMP_FLG_DISABLE_TX_CREDIT_FLOW
;

2121 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2125 i‡(
htc_bundÀ_ªcv
) {

2126 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "HTC will use bundleÑecv\n");

2127 
£tup_comp
->
Êags
 |
HTC_SETUP_COMP_FLG_RX_BNDL_EN
;

2129 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
, "HTC willÇot use bundleÑecv\n");

2132 
£tup_comp
->
Êags
 = 
	`˝u_to_À32
(setup_comp->flags);

2134 
	`£t_htc_pkt_öfo
(
∑ckë
, 
NULL
, (
u8
 *Ë
£tup_comp
,

2135 (
htc_£tup_comp_ext_msg
),

2136 
ENDPOINT_0
, 
HTC_SERVICE_TX_PACKET_TAG
);

2138 
èrgë
->
htc_Êags
 |
HTC_OP_STATE_SETUP_COMPLETE
;

2139  
	`©h6kl_htc_pùe_tx
(
h™dÀ
, 
∑ckë
);

2140 
	}
}

2142 
	$©h6kl_htc_pùe_°›
(
htc_èrgë
 *
h™dÀ
)

2144 
htc_èrgë
 *
èrgë
 = (htc_èrgë *Ë
h™dÀ
;

2145 
i
;

2146 
htc_ídpoöt
 *
ï
;

2147 
sk_buff
 *
skb
;

2148 
sk_buff_hód
 *
rx_sg_queue
 = &
èrgë
->
rx_sg_q
;

2151 
i
 = 0; i < 
ENDPOINT_MAX
; i++) {

2152 
ï
 = &
èrgë
->
ídpoöt
[
i
];

2153 
	`htc_Êush_rx_queue
(
èrgë
, 
ï
);

2154 
	`htc_Êush_tx_ídpoöt
(
èrgë
, 
ï
, 
HTC_TX_PACKET_TAG_ALL
);

2155 i‡(
i
 =
ENDPOINT_2
 && 
ï
->
timî_öô
) {

2156 
	`dñ_timî
(&
ï
->
timî
);

2157 
ï
->
ˇŒ_by_timî
 = 0;

2158 
ï
->
timî_öô
 = 0;

2162 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

2164 (
skb
 = 
	`skb_dequeue
(
rx_sg_queue
)))

2165 
	`dev_k‰ì_skb
(
skb
);

2166 
èrgë
->
rx_sg_tŸÆ_Àn_exp
 = 0;

2167 
èrgë
->
rx_sg_tŸÆ_Àn_cur
 = 0;

2168 
èrgë
->
rx_sg_ö_¥ogªss
 = 
Ál£
;

2170 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

2172 
	`ª£t_ídpoöt_°©es
(
èrgë
);

2173 
èrgë
->
htc_Êags
 &~
HTC_OP_STATE_SETUP_COMPLETE
;

2174 
	}
}

2176 
	$©h6kl_htc_pùe_gë_rxbuf_num
(
htc_èrgë
 *
htc_c⁄ãxt
,

2177 
htc_ídpoöt_id
 
ídpoöt
)

2179 
htc_èrgë
 *
èrgë
 =

2180 (
htc_èrgë
 *Ë
htc_c⁄ãxt
;

2181 
num
;

2183 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

2184 
num
 = 
	`gë_queue_dïth
(&(
èrgë
->
ídpoöt
[ídpoöt].
rx_bufq
));

2185 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

2187  
num
;

2188 
	}
}

2190 
	$©h6kl_htc_pùe_tx
(
htc_èrgë
 *
h™dÀ
,

2191 
htc_∑ckë
 *
∑ckë
)

2193 
li°_hód
 
queue
;

2194 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2196 
__func__
, 
∑ckë
->
ídpoöt
,

2197 ()
∑ckë
->
buf
,

2198 
∑ckë
->
a˘_Àn
);

2199 
	`INIT_LIST_HEAD
(&
queue
);

2200 
	`li°_add_èû
(&
∑ckë
->
li°
, &
queue
);

2201  
	`htc_£nd_∑ckës_mu…ùÀ
(
h™dÀ
, &
queue
);

2202 
	}
}

2204 
	$©h6kl_htc_pùe_waô_èrgë
(
htc_èrgë
 *
h™dÀ
)

2206 
°©us
 = 0;

2207 
htc_èrgë
 *
èrgë
 = (htc_èrgë *Ë
h™dÀ
;

2208 
htc_ªady_ext_msg
 *
ªady_msg
;

2209 
htc_£rvi˚_c⁄√˘_ªq
 
c⁄√˘
;

2210 
htc_£rvi˚_c⁄√˘_ª•
 
ª•
;

2212 
°©us
 = 
	`htc_waô_ªcv_˘æ_mesßge
(
èrgë
);

2214 i‡(
°©us
 != 0)

2215  
°©us
;

2217 i‡(
èrgë
->
˘æ_ª•⁄£_Àn
 <

2218 ((
htc_ªady_ext_msg
))) {

2219 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2221 
èrgë
->
˘æ_ª•⁄£_Àn
);

2222  -
ECOMM
;

2224 
ªady_msg
 =

2225 (
htc_ªady_ext_msg
 *)
èrgë
->
˘æ_ª•⁄£_buf
;

2227 i‡(
ªady_msg
->
vî2_0_öfo
.
msg_id
 !
	`˝u_to_À16
(
HTC_MSG_READY_ID
)) {

2228 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2230 
	`À16_to_˝u
(
ªady_msg
->
vî2_0_öfo
.
msg_id
));

2231  -
ECOMM
;

2234 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2236 
	`À16_to_˝u
(
ªady_msg
->
vî2_0_öfo
.
¸ed_˙t
),

2237 
	`À16_to_˝u
(
ªady_msg
->
vî2_0_öfo
.
¸ed_sz
));

2239 
èrgë
->
tgt_¸eds
 =

2240 
	`À16_to_˝u
(
ªady_msg
->
vî2_0_öfo
.
¸ed_˙t
);

2242 
èrgë
->
avaû_tx_¸edôs
 =Å¨gë->
tgt_¸eds
 - 1;

2243 
èrgë
->
tgt_¸ed_sz
 =

2244 
	`À16_to_˝u
(
ªady_msg
->
vî2_0_öfo
.
¸ed_sz
);

2245 i‡((
èrgë
->
tgt_¸eds
 == 0)

2246 || (
èrgë
->
tgt_¸ed_sz
 == 0)) {

2247  -
ECOMM
;

2250 
	`htc_£tup_èrgë_buf„r_assignmíts
(
èrgë
);

2253 
	`mem£t
(&
c⁄√˘
, 0, (connect));

2254 
	`mem£t
(&
ª•
, 0, (resp));

2255 
c⁄√˘
.
ï_cb
.
tx_com∂ëe
 = 
htc_tx˘æ_com∂ëe
;

2256 
c⁄√˘
.
ï_cb
.
rx
 = 
htc_rx˘æ_com∂ëe
;

2257 
c⁄√˘
.
max_txq_dïth
 = 
NUM_CONTROL_TX_BUFFERS
;

2258 
c⁄√˘
.
svc_id
 = 
HTC_CTRL_RSVD_SVC
;

2261 
°©us
 = 
	`©h6kl_htc_pùe_c⁄n_£rvi˚
((*)
èrgë
, &
c⁄√˘
, &
ª•
);

2262  
°©us
;

2263 
	}
}

2265 
	$©h6kl_htc_pùe_Êush_txï
(
htc_èrgë
 *
h™dÀ
,

2266 
htc_ídpoöt_id
 
Endpoöt
, 
u16
 
Tag
)

2268 
htc_èrgë
 *
èrgë
 = (htc_èrgë *Ë
h™dÀ
;

2269 
htc_ídpoöt
 *
ï
 = &
èrgë
->
ídpoöt
[
Endpoöt
];

2271 i‡(
ï
->
svc_id
 == 0) {

2272 
	`WARN_ON
(1);

2277 
	`htc_Êush_tx_ídpoöt
(
èrgë
, 
ï
, 
Tag
);

2278 
	}
}

2280 
	$©h6kl_htc_pùe_add_rxbuf_mu…ùÀ
(
htc_èrgë
 *
h™dÀ
,

2281 
li°_hód
 *
pkt_queue
)

2283 
htc_èrgë
 *
èrgë
 = (htc_èrgë *Ë
h™dÀ
;

2284 
htc_ídpoöt
 *
ï
;

2285 
htc_∑ckë
 *
pFú°Packë
;

2286 
°©us
 = 0;

2287 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

2289 i‡(
	`li°_em±y
(
pkt_queue
))

2290  -
EINVAL
;

2292 
pFú°Packë
 = 
	`li°_fú°_íåy
(
pkt_queue
, 
htc_∑ckë
, 
li°
);

2293 i‡(
pFú°Packë
 =
NULL
) {

2294 
	`WARN_ON
(1);

2295  -
EINVAL
;

2298 i‡(
pFú°Packë
->
ídpoöt
 >
ENDPOINT_MAX
) {

2299 
	`WARN_ON
(1);

2300  -
EINVAL
;

2303 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2305 
__func__
, 
pFú°Packë
->
ídpoöt
,

2306 
	`gë_queue_dïth
(
pkt_queue
), 
pFú°Packë
->
buf_Àn
);

2308 
ï
 = &
èrgë
->
ídpoöt
[
pFú°Packë
->endpoint];

2310 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

2313 
	`li°_•li˚_èû_öô
(
pkt_queue
, &
ï
->
rx_bufq
);

2315 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

2317 i‡(
°©us
 != 0) {

2319 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, 
pkt_queue
, 
li°
) {

2320 
∑ckë
->
°©us
 = -
ECANCELED
;

2323 
	`do_ªcv_com∂ëi⁄
(
ï
, 
pkt_queue
);

2326  
°©us
;

2327 
	}
}

2329 
	$©h6kl_htc_pùe_ödiˇã_a˘ivôy_ch™ge
(

2330 
htc_èrgë
 *
h™dÀ
,

2331 
htc_ídpoöt_id
 
Endpoöt
,

2332 
boﬁ
 
A˘ive
)

2335 
	}
}

2337 
	$©h6kl_htc_pùe_Êush_rx_buf
(
htc_èrgë
 *
èrgë
)

2339 
htc_ídpoöt
 *
ídpoöt
;

2340 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

2341 
i
;

2343 
i
 = 
ENDPOINT_0
; i < 
ENDPOINT_MAX
; i++) {

2344 
ídpoöt
 = &
èrgë
->ídpoöt[
i
];

2346 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

2347 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
,

2348 &
ídpoöt
->
rx_bufq
, 
li°
) {

2349 
	`li°_dñ
(&
∑ckë
->
li°
);

2350 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

2351 
	`©h6kl_dbg
(
ATH6KL_DBG_HTC
,

2353 
∑ckë
,Öackë->
buf_Àn
,

2354 
∑ckë
->
ídpoöt
);

2355 
	`dev_k‰ì_skb
(
∑ckë
->
pkt_˙txt
);

2356 
	`•ö_lock_bh
(&
èrgë
->
rx_lock
);

2358 
	`•ö_u∆ock_bh
(&
èrgë
->
rx_lock
);

2360 
	}
}

2362 
	$©h6kl_htc_£t_¸edô_di°
(
htc_èrgë
 *
èrgë
,

2363 
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
,

2364 
u16
 
svc_¥i_‹dî
[], 
Àn
)

2370 
	}
}

2372 
	$©h6kl_htc_pùe_¸edô_£tup
(
htc_èrgë
 *
èrgë
,

2373 
©h6kl_htc_¸edô_öfo
 *
¸ed_öfo
)

2376 
	}
}

2378 
	$©h6kl_htc_pùe_°©
(
htc_èrgë
 *
èrgë
,

2379 
u8
 *
buf
, 
buf_Àn
)

2381 
htc_ídpoöt
 *
ï
;

2382 
htc_ídpoöt_°©s
 *
ï_°
;

2383 
li°_hód
 *
tx_queue
;

2384 
i
, 
tmp
, 
Àn
 = 0;

2386 i‡((!
èrgë
Ë|| (!
buf
))

2389 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2391 
èrgë
->
tgt_¸ed_sz
,

2392 
èrgë
->
avaû_tx_¸edôs
,

2393 
èrgë
->
tgt_¸eds
);

2395 
i
 = 
ENDPOINT_1
; i <
ENDPOINT_5
; i++) {

2396 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üí, "EP-%d\n", 
i
);

2398 
ï
 = &
èrgë
->
ídpoöt
[
i
];

2399 
tx_queue
 = &
ï
->
txq
;

2400 
ï_°
 = &
ï
->ep_st;

2402 
	`•ö_lock_bh
(&
èrgë
->
tx_lock
);

2403 
tmp
 = 
	`gë_queue_dïth
(
tx_queue
);

2404 
	`•ö_u∆ock_bh
(&
èrgë
->
tx_lock
);

2406 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2408 
tmp
, 
ï
->
max_txq_dïth
);

2409 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2411 
ï
->
pùeid_ul
,Ép->
pùeid_dl
);

2412 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2414 
ï
->
£qno
);

2415 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2417 
ï_°
->
¸ed_low_ödiˇã
);

2418 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2420 
ï_°
->
¸ed_Ωt_‰om_rx
);

2421 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2423 
ï_°
->
¸ed_Ωt_‰om_Ÿhî
);

2424 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2426 
ï_°
->
¸ed_Ωt_ï0
);

2427 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2429 
ï_°
->
¸ed_‰om_rx
);

2430 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2432 
ï_°
->
¸ed_‰om_Ÿhî
);

2433 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2435 
ï_°
->
¸ed_‰om_ï0
);

2436 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2438 
ï_°
->
¸ed_cosumd
);

2439 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2441 
ï_°
->
¸ed_ªäd
);

2442 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2444 
ï_°
->
tx_issued
);

2445 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2447 
ï_°
->
tx_dr›≥d
);

2448 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2450 
ï_°
->
tx_¸ed_Ωt
);

2451 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2453 
ï_°
->
rx_pkts
);

2454 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2456 
ï_°
->
rx_lkahds
);

2457 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2459 
ï_°
->
rx_Æloc_thªsh_hô
);

2460 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2462 
ï_°
->
rxÆloc_thªsh_byã
);

2465 i‡(
htc_bundÀ_ªcv
 || 
htc_bundÀ_£nd
) {

2466 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2468 
ï_°
->
tx_pkt_bundÀd
);

2469 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2471 
ï_°
->
tx_bundÀs
);

2472 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2474 
ï_°
->
rx_bundl
);

2475 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2477 
ï_°
->
rx_bundÀ_lkahd
);

2478 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2480 
ï_°
->
rx_bundÀ_‰om_hdr
);

2484  
Àn
;

2485 
	}
}

2487 
	$©h6kl_htc_pùe_°›_√tif_queue_fuŒ
(
htc_èrgë
 *
èrgë
)

2490 
	}
}

2492 
	$©h6kl_htc_pùe_wmm_scheduÀ_ch™ge
(
htc_èrgë
 *
èrgë
,

2493 
boﬁ
 
ch™ge
)

2495 
©h6kl
 *
¨
 = 
èrgë
->
dev
->ar;

2497 i‡(
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6006
)

2501 
	}
}

2503 
	$©h6kl_htc_pùe_ch™ge_¸edô_by∑ss
(
htc_èrgë
 *
èrgë
,

2504 
u8
 
åaffic_˛ass
)

2507 
	}
}

2509 #ifde‡
USB_AUTO_SUSPEND


2510 
boﬁ
 
	$©h6kl_htc_pùe_skù_usb_m¨k_busy
(
©h6kl
 *
¨
, 
sk_buff
 *
skb
)

2512 
htc_‰ame_hdr
 *
htc_hdr
;

2513 
wmi_d©a_hdr
 *
dhdr
;

2514 
boﬁ
 
is_amsdu
, 
ªt
 = 
Ál£
;

2515 
u8
 
dŸ11_hdr
 = 0, 
∑d_bef‹e_d©a_°¨t
;

2516 
u16
 
puŒ_hdr
 = 0;

2518 
htc_hdr
 = (
htc_‰ame_hdr
 *)
skb
->
d©a
;

2520 i‡(
htc_hdr
->
eid
 !
¨
->
˘æ_ï
) {

2521 
puŒ_hdr
 +
HTC_HDR_LENGTH
;

2523 
dhdr
 = (
wmi_d©a_hdr
 *)(
skb
->
d©a
 + 
puŒ_hdr
);

2524 
is_amsdu
 = 
	`wmi_d©a_hdr_is_amsdu
(
dhdr
Ë? 
åue
 : 
Ál£
;

2525 
dŸ11_hdr
 = 
	`wmi_d©a_hdr_gë_dŸ11
(
dhdr
);

2526 
∑d_bef‹e_d©a_°¨t
 = (
	`À16_to_˝u
(
dhdr
->
öfo3
)

2527 >> 
WMI_DATA_HDR_PAD_BEFORE_DATA_SHIFT
)

2528 & 
WMI_DATA_HDR_PAD_BEFORE_DATA_MASK
;

2529 
puŒ_hdr
 +(
wmi_d©a_hdr
);

2530 
puŒ_hdr
 +
∑d_bef‹e_d©a_°¨t
;

2532 i‡(
dŸ11_hdr
) {

2533 
õì80211_hdr_3addr
 
wh
;

2534 
	`mem˝y
((
u8
 *Ë&
wh
, (
skb
->
d©a
 + 
puŒ_hdr
),

2535 (
õì80211_hdr_3addr
));

2537 (
	`À16_to_˝u
(
wh
.
‰ame_c⁄åﬁ
)) &

2538 (
IEEE80211_FCTL_FROMDS
 | 
IEEE80211_FCTL_TODS
)) {

2540 
IEEE80211_FCTL_FROMDS
:

2541 i‡(
	`is_mu…iˇ°_ëhî_addr
(
wh
.
addr1
))

2542 
ªt
 = 
åue
;

2544 
IEEE80211_FCTL_TODS
:

2545 i‡(
	`is_mu…iˇ°_ëhî_addr
(
wh
.
addr3
))

2546 
ªt
 = 
åue
;

2549 } i‡(!
is_amsdu
) {

2550 
ëhhdr
 *
d©≠
 =

2551 (
ëhhdr
 *)(
skb
->
d©a
 + 
puŒ_hdr
);

2552 i‡(
	`is_mu…iˇ°_ëhî_addr
(
d©≠
->
h_de°
))

2553 
ªt
 = 
åue
;

2556  
ªt
;

2557 
	}
}

2560 c⁄° 
©h6kl_htc_›s
 
	g©h6kl_htc_pùe_›s
 = {

2561 .
¸óã
 = 
©h6kl_htc_pùe_¸óã
,

2562 .
	gwaô_èrgë
 = 
©h6kl_htc_pùe_waô_èrgë
,

2563 .
	g°¨t
 = 
©h6kl_htc_pùe_°¨t
,

2564 .
	gc⁄n_£rvi˚
 = 
©h6kl_htc_pùe_c⁄n_£rvi˚
,

2565 .
	gtx
 = 
©h6kl_htc_pùe_tx
,

2566 .
	g°›
 = 
©h6kl_htc_pùe_°›
,

2567 .
	g˛ónup
 = 
©h6kl_htc_pùe_˛ónup
,

2568 .
	gÊush_txï
 = 
©h6kl_htc_pùe_Êush_txï
,

2569 .
	gÊush_rx_buf
 = 
©h6kl_htc_pùe_Êush_rx_buf
,

2570 .
	gödiˇã_a˘ivôy_ch™ge
 = 
©h6kl_htc_pùe_ödiˇã_a˘ivôy_ch™ge
,

2571 .
	ggë_rxbuf_num
 = 
©h6kl_htc_pùe_gë_rxbuf_num
,

2572 .
	gadd_rxbuf_mu…ùÀ
 = 
©h6kl_htc_pùe_add_rxbuf_mu…ùÀ
,

2573 .
	g¸edô_£tup
 = 
©h6kl_htc_pùe_¸edô_£tup
,

2574 .
	ggë_°©
 = 
©h6kl_htc_pùe_°©
,

2575 .
	g°›_√tif_queue_fuŒ
 = 
©h6kl_htc_pùe_°›_√tif_queue_fuŒ
,

2576 .
	gödiˇã_wmm_scheduÀ_ch™ge
 = 
©h6kl_htc_pùe_wmm_scheduÀ_ch™ge
,

2577 .
	gch™ge_¸edô_by∑ss
 = 
©h6kl_htc_pùe_ch™ge_¸edô_by∑ss
,

2578 #ifde‡
USB_AUTO_SUSPEND


2579 .
	gskù_usb_m¨k_busy
 = 
©h6kl_htc_pùe_skù_usb_m¨k_busy
,

2583 
	$©h6kl_htc_pùe_©èch
(
©h6kl
 *
¨
)

2585 
¨
->
htc_›s
 = &
©h6kl_htc_pùe_›s
;

2586 
	}
}

	@htcoex.c

17 
	~"c‹e.h
"

18 
	~"debug.h
"

20 
u8
 *
	$htc€x_gë_ñem
(
ñem_id
, 
u8
 *
°¨t
, 
u16
 
Àn
)

22 
size_t
 
À·
 = 
Àn
;

23 
u8
 *
pos
 = 
°¨t
;

24 
u8
 *
ñem_°¨t
 = 
NULL
;

26 i‡((
°¨t
 =
NULL
Ë|| (
Àn
 == 0))

27  
NULL
;

29 
À·
 >= 2) {

30 
u8
 
id
, 
ñí
;

32 
id
 = *
pos
++;

33 
ñí
 = *
pos
++;

34 
À·
 -= 2;

36 i‡(
ñí
 > 
À·
)

39 i‡(
id
 =
ñem_id
) {

40 
ñem_°¨t
 = (*)
pos
;

44 
À·
 -
ñí
;

45 
pos
 +
ñí
;

48  
ñem_°¨t
;

49 
	}
}

51 
	$htc€x_Êush_bss_öfo
(
htc€x
 *
c€x
)

53 
htc€x_bss_öfo
 *
c€x_bss
, *
tmp
;

55 
	`•ö_lock
(&
c€x
->
bss_öfo_lock
);

57 
	`li°_f‹_óch_íåy_ß„
(
c€x_bss
, 
tmp
, &
c€x
->
bss_öfo_li°
, 
li°
) {

58 
	`li°_dñ
(&
c€x_bss
->
li°
);

59 
	`k‰ì
(
c€x_bss
->
øw_‰ame
);

60 
	`k‰ì
(
c€x_bss
);

63 
	`•ö_u∆ock
(&
c€x
->
bss_öfo_lock
);

66 
	}
}

68 
	$htc€x_gë_c€xöfo
(
htc€x_bss_öfo
 *
c€x_bss
,

69 
htc€x_c€x_öfo
 *
c€x_öfo
)

71 
õì80211_ht_ˇp
 *
htˇp
;

72 
õì80211_mgmt
 *
‰ame
;

73 
u16
 
ˇp_öfo
;

74 
ch™_id
 = 0;

76 
‰ame
 = (
õì80211_mgmt
 *)(
c€x_bss
->
øw_‰ame
);

77 
ch™_id
 = 
	`õì80211_‰equícy_to_ch™√l
(

78 ()(
c€x_bss
->
ch™√l
->
˚¡î_‰eq
));

79 
htˇp
 = (
õì80211_ht_ˇp
 *)
	`htc€x_gë_ñem
(

80 
WLAN_EID_HT_CAPABILITY
, 
‰ame
->
u
.
bóc⁄
.
v¨übÀ
,

81 
c€x_bss
->
‰ame_Àn
 - (24 + 12));

83 i‡(
htˇp
) {

84 
ˇp_öfo
 = 
	`À16_to_˝u
(
htˇp
->cap_info);

86 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
, "htcoex BSSID "

88 
‰ame
->
bssid
[0], frame->bssid[1], frame->bssid[2],

89 
‰ame
->
bssid
[3], frame->bssid[4], frame->bssid[5],

90 
ˇp_öfo
);

92 i‡(
ˇp_öfo
 & 
IEEE80211_HT_CAP_40MHZ_INTOLERANT
)

93 
c€x_öfo
->
ötﬁî™t40
++;

94 } i‡(
c€x_bss
->
ch™√l
->
b™d
 =
IEEE80211_BAND_2GHZ
) {

95 
i
;

97 
i
 = 0; i < 
c€x_öfo
->
num_ch™s
; i++) {

98 i‡(
ch™_id
 =
c€x_öfo
->
ch™s
[
i
])

102 i‡(
i
 =
c€x_öfo
->
num_ch™s
) {

104 
	`BUG_ON
(
c€x_öfo
->
num_ch™s
 >= 14);

105 
c€x_öfo
->
ch™s
[c€x_öfo->
num_ch™s
++] = 
ch™_id
;

110 
	}
}

112 
	$htc€x_sˇn_°¨t
(
¨g
)

114 
htc€x
 *
c€x
 = (htc€x *Ë
¨g
;

115 
©h6kl_vif
 *
vif
 = 
c€x
->vif;

116 
©h6kl
 *
¨
;

117 
ªt
;

119 
	`BUG_ON
(!
vif
);

121 
¨
 = 
vif
->ar;

122 i‡((
vif
->
nw_ty≥
 !
INFRA_NETWORK
) ||

123 !
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) ||

124 
vif
->
sˇn_ªq
 ||

125 
	`ã°_bô
(
EAPOL_HANDSHAKE_PROTECT
, &
¨
->
Êag
))

126 
ªsche
;

128 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

130 
vif
,

131 
c€x
->
num_sˇn
);

133 i‡(!
vif
->
u§_bss_fûãr
) {

134 
	`˛ór_bô
(
CLEAR_BSSFILTER_ON_BEACON
, &
vif
->
Êags
);

135 
ªt
 = 
	`©h6kl_wmi_bssfûãr_cmd
(

136 
¨
->
wmi
,

137 
vif
->
fw_vif_idx
,

138 
ALL_BUT_BSS_FILTER
,

140 i‡(
ªt
) {

141 
	`©h6kl_îr
("couldn't set bss filtering\n");

142 
ªsche
;

147 i‡(
	`ã°_bô
(
ROC_PEND
, &
vif
->
Êags
))

148 
ªsche
;

150 
ªt
 = 
	`©h6kl_wmi_°¨tsˇn_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
WMI_LONG_SCAN
,

151 0, 
Ál£
, 0, 0,

152 
c€x
->
num_sˇn_ch™√ls
,

153 
c€x
->
sˇn_ch™√ls
);

154 i‡(
ªt
)

155 
	`©h6kl_îr
("wmi_startscan_cmd failed\n");

157 
vif
->
sˇn_ªq
 = &
c€x
->
ªque°
;

158 
c€x
->
num_sˇn
++;

161 
ªsche
:

162 i‡((
c€x
->
Êags
 & 
ATH6KL_HTCOEX_FLAGS_START
) &&

163 (
c€x
->
sˇn_öãrvÆ
))

164 
	`mod_timî
(&
c€x
->
sˇn_timî
,

165 
jiffõs
 + 
	`m£cs_to_jiffõs
(
c€x
->
sˇn_öãrvÆ
));

168 
	}
}

170 
	$htc€x_£nd_a˘i⁄
(
©h6kl_vif
 *
vif
,

171 
htc€x_c€x_öfo
 *
c€x_öfo
)

173 
©h6kl
 *
¨
 = 
vif
->ar;

174 
õì80211_mgmt
 *
a˘i⁄_‰ame
;

175 
Àn
 = 0;

177 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

179 
vif
,

180 
c€x_öfo
->
ötﬁî™t40
,

181 
c€x_öfo
->
num_ch™s
,

182 
vif
->
bss_ch
);

184 
Àn
 = 24 +

185 (
õì80211_a˘i⁄_public
) +

186 (
õì80211_bss_c€x_õ
) +

187 (
õì80211_ötﬁî™t_ch™_ªp‹t_õ
) +

188 
c€x_öfo
->
num_ch™s
;

189 
a˘i⁄_‰ame
 = 
	`kzÆloc
(
Àn
, 
GFP_KERNEL
);

190 i‡(
a˘i⁄_‰ame
) {

191 
õì80211_a˘i⁄_public
 *
a˘i⁄_public
;

192 
õì80211_bss_c€x_õ
 *
bss_c€x_õ
;

193 
õì80211_ötﬁî™t_ch™_ªp‹t_õ
 *
öto_ch™_ªp‹t_õ
;

194 
i
;

197 
a˘i⁄_‰ame
->
‰ame_c⁄åﬁ
 = 
	`˝u_to_À16
(
IEEE80211_FTYPE_MGMT
 |

198 
IEEE80211_STYPE_ACTION
);

199 
	`mem˝y
(
a˘i⁄_‰ame
->
da
, 
vif
->
bssid
, 
ETH_ALEN
);

200 
	`mem˝y
(
a˘i⁄_‰ame
->
ß
, 
vif
->
ndev
->
dev_addr
, 
ETH_ALEN
);

201 
	`mem˝y
(
a˘i⁄_‰ame
->
bssid
, 
vif
->bssid, 
ETH_ALEN
);

203 
a˘i⁄_public
 = (
õì80211_a˘i⁄_public
 *)

204 (&
a˘i⁄_‰ame
->
u
.
a˘i⁄
);

205 
a˘i⁄_public
->
ˇãg‹y
 = 
WLAN_CATEGORY_PUBLIC
;

206 
a˘i⁄_public
->
a˘i⁄_code
 = 
WLAN_COEX_ACTION_2040COEX_MGMT
;

208 
bss_c€x_õ
 = (
õì80211_bss_c€x_õ
 *)

209 (
a˘i⁄_public
->
v¨übÀ
);

210 
bss_c€x_õ
->
ñemít_id
 = 
WLAN_EID_BSS_COEX_2040
;

211 
bss_c€x_õ
->
Àn
 = 1;

212 i‡(
c€x_öfo
->
ötﬁî™t40
)

213 
bss_c€x_õ
->
vÆue
 |
IEEE80211_COEX_IE_20_WIDTH_REQ
;

215 
öto_ch™_ªp‹t_õ
 =

216 (
õì80211_ötﬁî™t_ch™_ªp‹t_õ
 *)

217 (++
bss_c€x_õ
);

218 
öto_ch™_ªp‹t_õ
->
ñemít_id
 =

219 
WLAN_EID_INTOLERANT_CHAN_REPORT
;

220 
öto_ch™_ªp‹t_õ
->
Àn
 = 
c€x_öfo
->
num_ch™s
 + 1;

221 
öto_ch™_ªp‹t_õ
->
ªg_˛ass
 = 0;

222 
i
 = 0; i < 
c€x_öfo
->
num_ch™s
; i++)

223 
öto_ch™_ªp‹t_õ
->
ch™_v¨übÀ
[
i
] =

224 
c€x_öfo
->
ch™s
[
i
];

226 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_RAW_BYTES
, 
__func__
, "tx-htcoex ",

227 (
u8
 *)
a˘i⁄_‰ame
, 
Àn
);

229 
	`BUG_ON
(
vif
->
bss_ch
 == 0);

230 
	`©h6kl_wmi_£nd_a˘i⁄_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

231 
vif
->
£nd_a˘i⁄_id
++,

232 
vif
->
bss_ch
, 0,

233 (
u8
 *)
a˘i⁄_‰ame
, 
Àn
);

234 
	`k‰ì
(
a˘i⁄_‰ame
);

236 
	`©h6kl_îr
("failedÅoálloc memory foráction_frame\n");

241 
	}
}

243 
	$htc€x_ht40_øã£t
(
©h6kl_vif
 *
vif
,

244 
htc€x
 *
c€x
,

245 
boﬁ
 
íabÀd
)

247 
©h6kl
 *
¨
 = 
vif
->ar;

248 
u64
 
øãmask
;

250 i‡(
íabÀd
)

251 
øãmask
 = 
ATH6KL_HTCOEX_RATEMASK_HT40
;

253 
øãmask
 = 
ATH6KL_HTCOEX_RATEMASK_HT20
;

255 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

257 
vif
,

258 (
íabÀd
 ? "Enabled" : "Disabled"),

259 
c€x
->
cuºít_øãmask
,

260 
øãmask
);

262 i‡(
c€x
->
cuºít_øãmask
 !
øãmask
)

263 
	`©h6kl_wmi_£t_fix_øãs
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

264 
øãmask
);

266 
c€x
->
cuºít_øãmask
 = 
øãmask
;

269 
	}
}

272 
	$htc€x_˛ór_sˇn_ch™√ls
(
©h6kl_vif
 *
vif
)

274 
htc€x
 *
c€x
 = 
vif
->
htc€x_˘x
;

276 i‡(!
c€x
)

277  -
EINVAL
;

279 
	`k‰ì
(
c€x
->
sˇn_ch™√ls
);

280 
c€x
->
sˇn_ch™√ls
 = 
NULL
;

281 
c€x
->
num_sˇn_ch™√ls
 = 0;

283 
	}
}

286 
	$htc€x_£t_sˇn_ch™√ls
(
©h6kl_vif
 *
vif
)

288 
htc€x
 *
c€x
 = 
vif
->
htc€x_˘x
;

289 
wùhy
 *wùhy = 
c€x
->
ªque°
.wiphy;

290 
i
;

292 i‡(!
wùhy
->
b™ds
[
IEEE80211_BAND_2GHZ
])

293  -
EINVAL
;

298 i‡(
c€x
->
num_sˇn_ch™√ls
 !0 || c€x->
sˇn_ch™√ls
)

299 
	`htc€x_˛ór_sˇn_ch™√ls
(
vif
);

304 
c€x
->
sˇn_ch™√ls
 =

305 
	`kzÆloc
(
wùhy
->
b™ds
[
IEEE80211_BAND_2GHZ
]->
n_ch™√ls
 *

306 (
u16
), 
GFP_KERNEL
);

308 i‡(!
c€x
->
sˇn_ch™√ls
)

309  -
ENOMEM
;

312 
i
 = 0; i < 
wùhy
->
b™ds
[
IEEE80211_BAND_2GHZ
]->
n_ch™√ls
; i++) {

313 
õì80211_ch™√l
 *
ch™
;

315 
ch™
 = &
wùhy
->
b™ds
[
IEEE80211_BAND_2GHZ
]->
ch™√ls
[
i
];

317 i‡(
ch™
->
Êags
 & 
IEEE80211_CHAN_DISABLED
)

320 
c€x
->
sˇn_ch™√ls
[c€x->
num_sˇn_ch™√ls
++] =

321 
ch™
->
˚¡î_‰eq
;

325 
	}
}

327 
htc€x
 *
	$©h6kl_htc€x_öô
(
©h6kl_vif
 *
vif
)

329 
htc€x
 *
c€x
;

331 
c€x
 = 
	`kzÆloc
((
htc€x
), 
GFP_KERNEL
);

332 i‡(!
c€x
) {

333 
	`©h6kl_îr
("failedÅoálloc memory for htcoex\n");

334  
NULL
;

337 
c€x
->
vif
 = vif;

340 
c€x
->
Êags
 &~
ATH6KL_HTCOEX_FLAGS_ENABLED
;

341 
c€x
->
sˇn_öãrvÆ
 = 
ATH6KL_HTCOEX_SCAN_PERIOD
;

342 
c€x
->
øã_rﬁlback_öãrvÆ
 = 
ATH6KL_HTCOEX_RATE_ROLLBACK
;

345 
	`öô_timî
(&
c€x
->
sˇn_timî
);

346 
c€x
->
sˇn_timî
.
fun˘i⁄
 = 
htc€x_sˇn_°¨t
;

347 
c€x
->
sˇn_timî
.
d©a
 = () coex;

349 #ifde‡
CFG80211_NETDEV_REPLACED_BY_WDEV


350 
c€x
->
ªque°
.
wdev
 = &
vif
->wdev;

352 
c€x
->
ªque°
.
dev
 = 
vif
->
ndev
;

354 
c€x
->
ªque°
.
wùhy
 = 
vif
->
¨
->wiphy;

356 
c€x
->
num_sˇn_ch™√ls
 = 0;

357 
c€x
->
sˇn_ch™√ls
 = 
NULL
;

359 
	`•ö_lock_öô
(&
c€x
->
bss_öfo_lock
);

360 
	`INIT_LIST_HEAD
(&
c€x
->
bss_öfo_li°
);

362 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

364 
vif
,

365 
c€x
->
sˇn_öãrvÆ
);

367  
c€x
;

368 
	}
}

370 
	$©h6kl_htc€x_deöô
(
©h6kl_vif
 *
vif
)

372 
htc€x
 *
c€x
 = 
vif
->
htc€x_˘x
;

374 i‡(
c€x
) {

375 i‡(
c€x
->
Êags
 & 
ATH6KL_HTCOEX_FLAGS_START
) {

376 
	`dñ_timî_sync
(&
c€x
->
sˇn_timî
);

377 
	`htc€x_˛ór_sˇn_ch™√ls
(
vif
);

379 
	`htc€x_Êush_bss_öfo
(
c€x
);

381 
	`k‰ì
(
c€x
);

384 
vif
->
htc€x_˘x
 = 
NULL
;

386 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

388 
vif
);

391 
	}
}

393 
	$©h6kl_htc€x_bss_öfo
(
©h6kl_vif
 *
vif
,

394 
õì80211_mgmt
 *
mgmt
,

395 
Àn
,

396 
õì80211_ch™√l
 *
ch™√l
)

398 
htc€x
 *
c€x
 = 
vif
->
htc€x_˘x
;

399 
htc€x_bss_öfo
 *
c€x_bss
, *
tmp
;

400 
m©ch
 = 0;

403 i‡(!(
c€x
->
Êags
 & 
ATH6KL_HTCOEX_FLAGS_START
) ||

404 (
vif
->
nw_ty≥
 !
INFRA_NETWORK
) ||

405 (
	`memcmp
(
mgmt
->
bssid
, 
vif
->bssid, 
ETH_ALEN
) == 0))

408 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

411 
vif
,

412 
mgmt
->
bssid
[0], mgmt->bssid[1], mgmt->bssid[2],

413 
mgmt
->
bssid
[3], mgmt->bssid[4], mgmt->bssid[5]);

415 i‡(!
	`li°_em±y
(&
c€x
->
bss_öfo_li°
)) {

416 
	`li°_f‹_óch_íåy_ß„
(
c€x_bss
, 
tmp
,

417 &
c€x
->
bss_öfo_li°
, 
li°
) {

418 i‡(
	`memcmp
(
c€x_bss
->
bssid
,

419 
mgmt
->
bssid
, 
ETH_ALEN
) == 0) {

420 
m©ch
 = 1;

426 i‡(!
m©ch
) {

427 
c€x_bss
 = 
	`kzÆloc
((
htc€x_bss_öfo
), 
GFP_KERNEL
);

428 i‡(!
c€x_bss
) {

429 
	`©h6kl_îr
("failedÅoálloc memory for coex_bss\n");

433 
c€x_bss
->
øw_‰ame
 = 
	`kmÆloc
(
Àn
, 
GFP_KERNEL
);

434 i‡(!
c€x_bss
->
øw_‰ame
) {

435 
	`k‰ì
(
c€x_bss
);

436 
	`©h6kl_îr
("failedÅoálloc memory for coex_bss->raw_frame\n");

441 
c€x_bss
->
‰ame_Àn
 = 
Àn
;

442 
	`mem˝y
(
c€x_bss
->
øw_‰ame
, 
mgmt
, 
Àn
);

443 
	`mem˝y
(
c€x_bss
->
bssid
, 
mgmt
->bssid, 
ETH_ALEN
);

444 
c€x_bss
->
ch™√l
 = channel;

446 
	`•ö_lock
(&
c€x
->
bss_öfo_lock
);

447 
	`li°_add_èû
(&
c€x_bss
->
li°
, &
c€x
->
bss_öfo_li°
);

448 
	`•ö_u∆ock
(&
c€x
->
bss_öfo_lock
);

452 
	}
}

454 
	$©h6kl_htc€x_sˇn_com∂ëe_evít
(
©h6kl_vif
 *
vif
, 
boﬁ
 
ab‹ãd
)

456 
htc€x
 *
c€x
 = 
vif
->
htc€x_˘x
;

457 
htc€x_bss_öfo
 *
c€x_bss
, *
tmp
;

458 
htc€x_c€x_öfo
 
c€x_öfo
;

459 
ªt
 = 
HTCOEX_PASS_SCAN_DONE
;

462 i‡(!(
c€x
->
Êags
 & 
ATH6KL_HTCOEX_FLAGS_START
) ||

463 (
vif
->
nw_ty≥
 !
INFRA_NETWORK
) ||

464 (!
vif
->
sˇn_ªq
))

465 
d⁄e
;

467 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

469 
vif
,

470 
ab‹ãd
,

471 
c€x
->
Êags
);

473 
	`mem£t
(&
c€x_öfo
, 0, (
htc€x_c€x_öfo
));

476 
	`li°_f‹_óch_íåy_ß„
(
c€x_bss
, 
tmp
, &
c€x
->
bss_öfo_li°
, 
li°
) {

477 
	`htc€x_gë_c€xöfo
(
c€x_bss
, &
c€x_öfo
);

481 i‡(
c€x_öfo
.
ötﬁî™t40
 || c€x_öfo.
num_ch™s
)

482 
	`htc€x_£nd_a˘i⁄
(
vif
, &
c€x_öfo
);

485 i‡(
c€x_öfo
.
ötﬁî™t40
) {

486 
	`htc€x_ht40_øã£t
(
vif
, 
c€x
, 
Ál£
);

487 
c€x
->
tﬁî™t40_˙t
 = 0;

490 i‡(
c€x
->
øã_rﬁlback_öãrvÆ
 &&

491 (++
c€x
->
tﬁî™t40_˙t
 > c€x->
øã_rﬁlback_öãrvÆ
))

492 
	`htc€x_ht40_øã£t
(
vif
, 
c€x
, 
åue
);

496 i‡(
vif
->
sˇn_ªq
 =&
c€x
->
ªque°
) {

497 
vif
->
sˇn_ªq
 = 
NULL
;

498 
ªt
 = 
HTCOEX_PORC_SCAN_DONE
;

501 
d⁄e
:

503 
	`htc€x_Êush_bss_öfo
(
c€x
);

505  
ªt
;

506 
	}
}

508 
	$©h6kl_htc€x_c⁄√˘_evít
(
©h6kl_vif
 *
vif
)

510 
htc€x
 *
c€x
 = 
vif
->
htc€x_˘x
;

511 
cfg80211_bss
 *
bss
;

512 
u8
 *
õs
 = 
NULL
;

513 
u16
 
õs_Àn
 = 0;

515 i‡(
vif
->
nw_ty≥
 !
INFRA_NETWORK
)

518 
bss
 = 
	`©h6kl_bss_gë
(
vif
->
¨
,

519 
NULL
,

520 
vif
->
bssid
,

521 
vif
->
ssid
,

522 
vif
->
ssid_Àn
,

523 
WLAN_CAPABILITY_ESS
,

524 
WLAN_CAPABILITY_ESS
);

525 i‡(!
bss
) {

526 
	`WARN_ON
(1);

530 #ifde‡
CFG80211_SAFE_BSS_INFO_ACCESS


531 
	`rcu_ªad_lock
();

532 i‡(
bss
->
õs
) {

533 
õs
 = (
u8
 *)(
bss
->õs->
d©a
);

534 
õs_Àn
 = 
bss
->
õs
->
Àn
;

537 i‡(
bss
->
öf‹m©i⁄_ñemíts
) {

538 
õs
 = 
bss
->
öf‹m©i⁄_ñemíts
;

539 
õs_Àn
 = 
bss
->
Àn_öf‹m©i⁄_ñemíts
;

544 i‡((
c€x
->
Êags
 & 
ATH6KL_HTCOEX_FLAGS_ENABLED
) &&

545 (
bss
->
ch™√l
->
b™d
 =
IEEE80211_BAND_2GHZ
) &&

546 (
	`htc€x_gë_ñem
(
WLAN_EID_HT_CAPABILITY
,

547 
õs
,

548 
õs_Àn
Ë!
NULL
)){

549 i‡(
c€x
->
Êags
 & 
ATH6KL_HTCOEX_FLAGS_START
)

550 
	`dñ_timî
(&
c€x
->
sˇn_timî
);

552 i‡(
c€x
->
sˇn_öãrvÆ
 < 
ATH6KL_HTCOEX_SCAN_PERIOD
)

553 
c€x
->
sˇn_öãrvÆ
 = 
ATH6KL_HTCOEX_SCAN_PERIOD
;

556 i‡(
	`htc€x_£t_sˇn_ch™√ls
(
vif
) == 0) {

557 
	`mod_timî
(&
c€x
->
sˇn_timî
, 
jiffõs
 +

558 
	`m£cs_to_jiffõs
(
c€x
->
sˇn_öãrvÆ
));

559 
c€x
->
Êags
 |
ATH6KL_HTCOEX_FLAGS_START
;

561 
	`©h6kl_îr
("htcoex set scan channels failed\n");

562 
	`WARN_ON
(1);

566 
c€x
->
Êags
 &~
ATH6KL_HTCOEX_FLAGS_START
;

568 #ifde‡
CFG80211_SAFE_BSS_INFO_ACCESS


569 
	`rcu_ªad_u∆ock
();

572 
c€x
->
num_sˇn
 = 0;

573 
c€x
->
tﬁî™t40_˙t
 = 0;

574 
c€x
->
cuºít_øãmask
 = 
ATH6KL_HTCOEX_RATEMASK_FULL
;

575 
	`htc€x_Êush_bss_öfo
(
c€x
);

577 
	`©h6kl_bss_put
(
vif
->
¨
, 
bss
);

579 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

581 
vif
,

582 
c€x
->
Êags
,

583 
c€x
->
sˇn_öãrvÆ
,

584 
c€x
->
øã_rﬁlback_öãrvÆ
);

587 
	}
}

589 
	$©h6kl_htc€x_disc⁄√˘_evít
(
©h6kl_vif
 *
vif
)

591 
htc€x
 *
c€x
 = 
vif
->
htc€x_˘x
;

593 i‡(
vif
->
nw_ty≥
 !
INFRA_NETWORK
)

596 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

598 
vif
,

599 
c€x
->
Êags
);

601 i‡(
c€x
->
Êags
 & 
ATH6KL_HTCOEX_FLAGS_START
) {

602 
	`dñ_timî
(&
c€x
->
sˇn_timî
);

603 
c€x
->
Êags
 &~
ATH6KL_HTCOEX_FLAGS_START
;

606 
	`©h6kl_wmi_£t_fix_øãs
(
vif
->
¨
->
wmi
, vif->
fw_vif_idx
,

607 
ATH6KL_HTCOEX_RATEMASK_FULL
);

609 
	`htc€x_˛ór_sˇn_ch™√ls
(
vif
);

612 
	`htc€x_Êush_bss_öfo
(
c€x
);

615 
	}
}

617 
	$©h6kl_htc€x_c⁄fig
(
©h6kl_vif
 *
vif
, 
u32
 
öãrvÆ
, 
u8
 
øã_rﬁlback
)

619 
htc€x
 *
c€x
 = 
vif
->
htc€x_˘x
;

620 
ª°¨t
 = 0;

622 
c€x
->
sˇn_öãrvÆ
 = 
öãrvÆ
;

624 i‡(
c€x
->
Êags
 & 
ATH6KL_HTCOEX_FLAGS_START
) {

625 
	`dñ_timî
(&
c€x
->
sˇn_timî
);

626 
	`htc€x_˛ór_sˇn_ch™√ls
(
vif
);

627 
c€x
->
Êags
 &~
ATH6KL_HTCOEX_FLAGS_START
;

628 
ª°¨t
 = 1;

631 i‡(
c€x
->
sˇn_öãrvÆ
 == 0)

632 
c€x
->
Êags
 &~
ATH6KL_HTCOEX_FLAGS_ENABLED
;

634 i‡(
c€x
->
sˇn_öãrvÆ
 < 
ATH6KL_HTCOEX_SCAN_PERIOD
)

635 
c€x
->
sˇn_öãrvÆ
 = 
ATH6KL_HTCOEX_SCAN_PERIOD
;

637 
c€x
->
Êags
 |
ATH6KL_HTCOEX_FLAGS_ENABLED
;

639 i‡(
ª°¨t
) {

640 i‡(
	`htc€x_£t_sˇn_ch™√ls
(
vif
) == 0) {

641 
	`mod_timî
(&
c€x
->
sˇn_timî
, 
jiffõs
 +

642 
	`m£cs_to_jiffõs
(
c€x
->
sˇn_öãrvÆ
));

643 
c€x
->
Êags
 |
ATH6KL_HTCOEX_FLAGS_START
;

645 
	`©h6kl_îr
("htcoex set scan channels failed\n");

646 
	`WARN_ON
(1);

650 
c€x
->
øã_rﬁlback_öãrvÆ
 = 
øã_rﬁlback
;

653 
	`htc€x_Êush_bss_öfo
(
c€x
);

655 
	`©h6kl_dbg
(
ATH6KL_DBG_HTCOEX
,

657 
vif
,

658 
c€x
->
sˇn_öãrvÆ
,

659 (
c€x
->
Êags
 & 
ATH6KL_HTCOEX_FLAGS_ENABLED
) ? "ON" : "OFF",

660 
c€x
->
øã_rﬁlback_öãrvÆ
,

661 
ª°¨t
);

665 
	}
}

	@htcoex.h

17 #i‚de‡
HTCOEX_H


18 
	#HTCOEX_H


	)

20 
	#ATH6KL_HTCOEX_SCAN_PERIOD
 (60 * 1000Ë

	)

23 
	#ATH6KL_HTCOEX_RATE_ROLLBACK
 (0)

	)

26 
	#ATH6KL_HTCOEX_FLAGS_ENABLED
 
	`BIT
(0)

	)

29 
	#ATH6KL_HTCOEX_FLAGS_START
 
	`BIT
(1)

	)

32 
	#ATH6KL_HTCOEX_RATEMASK_FULL
 (0x00000fffffffffffULL)

	)

33 
	#ATH6KL_HTCOEX_RATEMASK_HT20
 (0x000000000fffffffULL)

	)

34 
	#ATH6KL_HTCOEX_RATEMASK_HT40
 (0x00000fffffffffffULL)

	)

36 
	shtc€x_c€x_öfo
 {

37 
u32
 
	mötﬁî™t40
;

38 
	mnum_ch™s
;

39 
u8
 
	mch™s
[14];

42 
	shtc€x_bss_öfo
 {

43 
li°_hód
 
	mli°
;

45 
u8
 *
	møw_‰ame
;

46 
u16
 
	m‰ame_Àn
;

47 
u8
 
	mbssid
[
ETH_ALEN
];

48 
õì80211_ch™√l
 *
	mch™√l
;

51 
	shtc€x
 {

52 
©h6kl_vif
 *
	mvif
;

53 
u32
 
	mÊags
;

54 
u32
 
	msˇn_öãrvÆ
;

55 
u32
 
	mnum_sˇn
;

57 
u8
 
	møã_rﬁlback_öãrvÆ
;

58 
u64
 
	mcuºít_øãmask
;

59 
u32
 
	mtﬁî™t40_˙t
;

61 
timî_li°
 
	msˇn_timî
;

62 
cfg80211_sˇn_ªque°
 
	mªque°
;

64 
•ölock_t
 
	mbss_öfo_lock
;

65 
li°_hód
 
	mbss_öfo_li°
;

67 
s8
 
	mnum_sˇn_ch™√ls
;

68 
u16
 *
	msˇn_ch™√ls
;

72 
	mHTCOEX_PORC_SCAN_DONE
 = 0,

73 
	mHTCOEX_PASS_SCAN_DONE
,

77 
	eõì80211_c€x_a˘i⁄code
 {

78 
	mWLAN_COEX_ACTION_2040COEX_MGMT
 = 0,

82 
	sõì80211_a˘i⁄_public
 {

83 
u8
 
	mˇãg‹y
;

84 
u8
 
	ma˘i⁄_code
;

85 
u8
 
	mv¨übÀ
[0];

86 } 
	g__∑cked
;

89 
	#IEEE80211_COEX_IE_INFO_REQ
 (1 << 0)

	)

90 
	#IEEE80211_COEX_IE_40_INTOLERANT
 (1 << 1)

	)

91 
	#IEEE80211_COEX_IE_20_WIDTH_REQ
 (1 << 2)

	)

92 
	#IEEE80211_COEX_IE_OBSS_SCAN_REQ
 (1 << 3)

	)

93 
	#IEEE80211_COEX_IE_OBSS_SCAN_GRANT
 (1 << 4)

	)

95 
	sõì80211_bss_c€x_õ
 {

96 
u8
 
	mñemít_id
;

97 
u8
 
	mÀn
;

98 
u8
 
	mvÆue
;

99 } 
	g__∑cked
;

102 
	#WLAN_EID_INTOLERANT_CHAN_REPORT
 73

	)

104 
	sõì80211_ötﬁî™t_ch™_ªp‹t_õ
 {

105 
u8
 
	mñemít_id
;

106 
u8
 
	mÀn
;

107 
u8
 
	mªg_˛ass
;

108 
u8
 
	mch™_v¨übÀ
[0];

109 } 
	g__∑cked
;

111 
htc€x
 *
©h6kl_htc€x_öô
(
©h6kl_vif
 *
vif
);

112 
©h6kl_htc€x_deöô
(
©h6kl_vif
 *
vif
);

113 
©h6kl_htc€x_bss_öfo
(
©h6kl_vif
 *
vif
,

114 
õì80211_mgmt
 *
mgmt
,

115 
Àn
,

116 
õì80211_ch™√l
 *
ch™√l
);

117 
©h6kl_htc€x_sˇn_com∂ëe_evít
(
©h6kl_vif
 *
vif
, 
boﬁ
 
ab‹ãd
);

118 
©h6kl_htc€x_c⁄√˘_evít
(
©h6kl_vif
 *
vif
);

119 
©h6kl_htc€x_disc⁄√˘_evít
(
©h6kl_vif
 *
vif
);

120 
©h6kl_htc€x_c⁄fig
(
©h6kl_vif
 *
vif
,

121 
u32
 
öãrvÆ
, 
u8
 
øã_rﬁlback
);

	@init.c

17 
	~<löux/moduÀ∑øm.h
>

18 
	~<löux/î∫o.h
>

19 
	~<löux/vmÆloc.h
>

20 #i‚de‡
CE_OLD_KERNEL_SUPPORT_2_6_23


21 
	~<löux/of.h
>

22 
	~<löux/öãºu±.h
>

23 
	~<löux/mmc/sdio_func.h
>

25 
	~"c‹e.h
"

26 
	~"cfg80211.h
"

27 
	~"èrgë.h
"

28 
	~"debug.h
"

29 
	~"hif-›s.h
"

30 
	~"htc-›s.h
"

31 
	~"πèpi.h
"

32 #ifde‡
ATH6KL_DIAGNOSTIC


33 
	~"dügno£.h
"

35 
	~"pm.h
"

37 
	gdebug_mask
;

38 
	gdebug_mask_ext
;

39 
	ghtc_bundÀ_ªcv
;

40 
	ghtc_bundÀ_£nd
;

41 
	ghtc_bundÀ_£nd_timî
;

42 
	ghtc_bundÀ_£nd_th
 = 6000;

43 
	gã°mode
;

44 
	g©h6kl_wow_ext
 = 1;

45 
	g©h6kl_wow_gpio
 = 9;

46 
	g©h6kl_p2p
 = 
ATH6KL_MODULEP2P_DEF_MODE
;

47 
	g©h6kl_v≠
 = 
ATH6KL_MODULEVAP_DEF_MODE
;

48 
	g©h6kl_sˇn_timeout
;

49 
	g©h6kl_rﬂm_mode
 = 
ATH6KL_MODULEROAM_DEFAULT
;

50 
	gªcovîy_íabÀ_mode
 = 
ATH6KL_RECOVERY_MODE_NONE
;

51 
	g°¨vög_¥evíti⁄
;

52 
	g©h6kl_©h0_«me
;

53 #ifde‡
CE_SUPPORT


54 
	g©h6kl_˚_Êags
 = 1;

56 
	g©h6kl_ªgdb
 = 
ATH6KL_REG_INTERNAL_REGDB
;

57 
	gªg_domaö
 = 
NULL_REG_CODE
;

59 #ifde‡
ATH6KL_DIAGNOSTIC


60 
	gdüg_loˇl_ã°
;

61 
moduÀ_∑øm
(
düg_loˇl_ã°
, 
uöt
, 0644);

66 *
	g©h6kl_wifi_mac
;

70 *
	gfw∑th
 = "android_fw_path_compatible_str";

72 #ifde‡
CONFIG_ANDROID


74 
	g©h6kl_bt_⁄
;

77 
moduÀ_∑øm
(
debug_mask
, 
uöt
, 0644);

78 
moduÀ_∑øm
(
debug_mask_ext
, 
uöt
, 0644);

79 
moduÀ_∑øm
(
htc_bundÀ_ªcv
, 
uöt
, 0644);

80 
moduÀ_∑øm
(
htc_bundÀ_£nd
, 
uöt
, 0644);

81 
moduÀ_∑øm
(
htc_bundÀ_£nd_timî
, 
uöt
, 0644);

82 
moduÀ_∑øm
(
ã°mode
, 
uöt
, 0644);

83 
moduÀ_∑øm
(
©h6kl_wow_ext
, 
uöt
, 0644);

84 
moduÀ_∑øm
(
©h6kl_wow_gpio
, 
uöt
, 0644);

85 
moduÀ_∑øm
(
©h6kl_p2p
, 
uöt
, 0644);

86 
moduÀ_∑øm
(
©h6kl_v≠
, 
uöt
, 0644);

87 
moduÀ_∑øm
(
©h6kl_wifi_mac
, 
ch¨p
, 0000);

88 
moduÀ_∑øm
(
©h6kl_sˇn_timeout
, 
uöt
, 0644);

89 
moduÀ_∑øm
(
©h6kl_rﬂm_mode
, 
uöt
, 0644);

90 
moduÀ_∑øm
(
ªcovîy_íabÀ_mode
, 
uöt
, 0644);

91 
moduÀ_∑øm
(
fw∑th
, 
ch¨p
, 0644);

92 
moduÀ_∑øm
(
©h6kl_©h0_«me
, 
uöt
, 0644);

93 #ifde‡
CE_SUPPORT


94 
moduÀ_∑øm
(
©h6kl_˚_Êags
, 
uöt
, 0644);

95 *
	gbd©≠©h
;

96 
moduÀ_∑øm
(
bd©≠©h
, 
ch¨p
, 0644);

97 *
	gfwd©≠©h
;

98 
moduÀ_∑øm
(
fwd©≠©h
, 
ch¨p
, 0644);

100 
moduÀ_∑øm
(
°¨vög_¥evíti⁄
, 
uöt
, 0644);

101 
moduÀ_∑øm
(
©h6kl_ªgdb
, 
uöt
, 0644);

102 
moduÀ_∑øm
(
ªg_domaö
, 
ush‹t
, 0644);

104 #ifde‡
CONFIG_ANDROID


105 
moduÀ_∑øm
(
©h6kl_bt_⁄
, 
uöt
, 0644);

108 #ifde‡
ATH6KL_HSIC_RECOVER


109 
u8
 
	gˇched_mac
[
ETH_ALEN
];

110 
boﬁ
 
	gˇched_mac_vÆid
;

113 c⁄° 
©h6kl_hw
 
	ghw_li°
[] = {

115 .
id
 = 
AR6003_HW_2_0_VERSION
,

116 .
	g«me
 = "ar6003 hw 2.0",

117 .
	gd©a£t_∑tch_addr
 = 0x57e884,

118 .
	g≠p_lﬂd_addr
 = 0x543180,

119 .
	gbﬂrd_ext_d©a_addr
 = 0x57e500,

120 .
	gª£rved_øm_size
 = 6912,

123 .
	g≠p_°¨t_ovîride_addr
 = 0x944C00,

124 .
	gÊags
 = 0,

126 .
	gfw
 = {

127 .
dú
 = 
AR6003_HW_2_0_FW_DIR
,

128 .
	gŸp
 = 
AR6003_HW_2_0_OTP_FILE
,

129 .
	gfw
 = 
AR6003_HW_2_0_FIRMWARE_FILE
,

130 .
	gtcmd
 = 
AR6003_HW_2_0_TCMD_FIRMWARE_FILE
,

131 .
	g∑tch
 = 
AR6003_HW_2_0_PATCH_FILE
,

132 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

135 .
	gfw_bﬂrd
 = 
AR6003_HW_2_0_BOARD_DATA_FILE
,

136 .
	gfw_deÁu…_bﬂrd
 = 
AR6003_HW_2_0_DEFAULT_BOARD_DATA_FILE
,

139 .
	gid
 = 
AR6003_HW_2_1_1_VERSION
,

140 .
	g«me
 = "ar6003 hw 2.1.1",

141 .
	gd©a£t_∑tch_addr
 = 0x57ff74,

142 .
	g≠p_lﬂd_addr
 = 0x1234,

143 .
	gbﬂrd_ext_d©a_addr
 = 0x542330,

144 .
	gª£rved_øm_size
 = 512,

145 .
	gã°s¸ùt_addr
 = 0x57ef74,

146 .
	gÊags
 = 0,

148 .
	gfw
 = {

149 .
dú
 = 
AR6003_HW_2_1_1_FW_DIR
,

150 .
	gŸp
 = 
AR6003_HW_2_1_1_OTP_FILE
,

151 .
	gfw
 = 
AR6003_HW_2_1_1_FIRMWARE_FILE
,

152 .
	gtcmd
 = 
AR6003_HW_2_1_1_TCMD_FIRMWARE_FILE
,

153 .
	g∑tch
 = 
AR6003_HW_2_1_1_PATCH_FILE
,

154 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

155 .
	gutf
 = 
AR6003_HW_2_1_1_UTF_FIRMWARE_FILE
,

156 .
	gã°s¸ùt
 = 
AR6003_HW_2_1_1_TESTSCRIPT_FILE
,

159 .
	gfw_bﬂrd
 = 
AR6003_HW_2_1_1_BOARD_DATA_FILE
,

160 .
	gfw_deÁu…_bﬂrd
 = 
AR6003_HW_2_1_1_DEFAULT_BOARD_DATA_FILE
,

163 .
	gid
 = 
AR6004_HW_1_0_VERSION
,

164 .
	g«me
 = "ar6004 hw 1.0",

165 .
	gd©a£t_∑tch_addr
 = 0x57e884,

166 .
	g≠p_lﬂd_addr
 = 0x1234,

167 .
	gbﬂrd_ext_d©a_addr
 = 0x437000,

168 .
	gª£rved_øm_size
 = 19456,

169 .
	gbﬂrd_addr
 = 0x433900,

170 .
	gã°s¸ùt_addr
 = 0x432900,

171 .
	gÊags
 = 
ATH6KL_HW_TGT_ALIGN_PADDING
 |

172 
ATH6KL_HW_SINGLE_PIPE_SCHED
,

174 .
	gfw
 = {

175 .
dú
 = 
AR6004_HW_1_0_FW_DIR
,

176 .
	gŸp
 = 
AR6004_HW_1_0_OTP_FILE
,

177 .
	gfw
 = 
AR6004_HW_1_0_FIRMWARE_FILE
,

178 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

181 .
	gfw_bﬂrd
 = 
AR6004_HW_1_0_BOARD_DATA_FILE
,

182 .
	gfw_deÁu…_bﬂrd
 = 
AR6004_HW_1_0_DEFAULT_BOARD_DATA_FILE
,

185 .
	gid
 = 
AR6004_HW_1_1_VERSION
,

186 .
	g«me
 = "ar6004 hw 1.1",

187 .
	gd©a£t_∑tch_addr
 = 0x57e884,

188 .
	g≠p_lﬂd_addr
 = 0x1234,

189 .
	gbﬂrd_ext_d©a_addr
 = 0x437000,

190 .
	gª£rved_øm_size
 = 7168,

191 .
	gbﬂrd_addr
 = 0x436400,

192 .
	gã°s¸ùt_addr
 = 0x435400,

193 .
	gÊags
 = 
ATH6KL_HW_TGT_ALIGN_PADDING
 |

194 
ATH6KL_HW_SINGLE_PIPE_SCHED
,

196 .
	gfw
 = {

197 .
dú
 = 
AR6004_HW_1_1_FW_DIR
,

198 .
	gŸp
 = 
AR6004_HW_1_1_OTP_FILE
,

199 .
	gfw
 = 
AR6004_HW_1_1_FIRMWARE_FILE
,

200 .
	gtcmd
 = 
AR6004_HW_1_1_TCMD_FIRMWARE_FILE
,

201 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

202 .
	gutf
 = 
AR6004_HW_1_1_UTF_FIRMWARE_FILE
,

203 .
	gã°s¸ùt
 = 
AR6004_HW_1_1_TESTSCRIPT_FILE
,

206 .
	gfw_bﬂrd
 = 
AR6004_HW_1_1_BOARD_DATA_FILE
,

207 .
	gfw_deÁu…_bﬂrd
 = 
AR6004_HW_1_1_DEFAULT_BOARD_DATA_FILE
,

208 .
	gfw_ïpög
 = 
AR6004_HW_1_1_EPPING_FILE
,

209 .
	gfw_so·mac
 = 
AR6004_HW_1_1_SOFTMAC_FILE
,

210 .
	gfw_so·mac_2
 = 
AR6004_HW_1_1_SOFTMAC_2_FILE
,

213 .
	gid
 = 
AR6004_HW_1_2_VERSION
,

214 .
	g«me
 = "ar6004 hw 1.2",

215 .
	gd©a£t_∑tch_addr
 = 0x436ecc,

216 .
	g≠p_lﬂd_addr
 = 0x1234,

217 .
	gbﬂrd_ext_d©a_addr
 = 0x437000,

218 .
	gª£rved_øm_size
 = 9216,

219 .
	gbﬂrd_addr
 = 0x435c00,

220 .
	gã°s¸ùt_addr
 = 0x434c00,

221 .
	gÊags
 = 
ATH6KL_HW_TGT_ALIGN_PADDING
 |

222 
ATH6KL_HW_SINGLE_PIPE_SCHED
,

224 .
	gfw
 = {

225 .
dú
 = 
AR6004_HW_1_2_FW_DIR
,

226 .
	gŸp
 = 
AR6004_HW_1_2_OTP_FILE
,

227 .
	gfw
 = 
AR6004_HW_1_2_FIRMWARE_FILE
,

228 .
	gtcmd
 = 
AR6004_HW_1_2_TCMD_FIRMWARE_FILE
,

229 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

230 .
	gutf
 = 
AR6004_HW_1_2_UTF_FIRMWARE_FILE
,

231 .
	gã°s¸ùt
 = 
AR6004_HW_1_2_TESTSCRIPT_FILE
,

234 .
	gfw_bﬂrd
 = 
AR6004_HW_1_2_BOARD_DATA_FILE
,

235 .
	gfw_deÁu…_bﬂrd
 = 
AR6004_HW_1_2_DEFAULT_BOARD_DATA_FILE
,

236 .
	gfw_ïpög
 = 
AR6004_HW_1_2_EPPING_FILE
,

237 .
	gfw_so·mac
 = 
AR6004_HW_1_2_SOFTMAC_FILE
,

238 .
	gfw_so·mac_2
 = 
AR6004_HW_1_2_SOFTMAC_2_FILE
,

241 .
	gid
 = 
AR6004_HW_1_3_VERSION
,

242 .
	g«me
 = "ar6004 hw 1.3",

243 .
	gd©a£t_∑tch_addr
 = 0x437860,

244 .
	g≠p_lﬂd_addr
 = 0x1234,

245 .
	g≠p_lﬂd_ext_addr
 = 0x9a7000,

246 .
	gbﬂrd_ext_d©a_addr
 = 0x437000,

247 .
	gª£rved_øm_size
 = 7168,

248 .
	gbﬂrd_addr
 = 0x436400,

249 .
	gã°s¸ùt_addr
 = 0x434c00,

250 .
	gÊags
 = 
ATH6KL_HW_TGT_ALIGN_PADDING
 |

251 
ATH6KL_HW_SINGLE_PIPE_SCHED
 |

252 
ATH6KL_HW_FIRMWARE_EXT_SUPPORT
,

254 .
	gfw
 = {

255 .
dú
 = 
AR6004_HW_1_3_FW_DIR
,

256 .
	gŸp
 = 
AR6004_HW_1_3_OTP_FILE
,

257 .
	gfw
 = 
AR6004_HW_1_3_FIRMWARE_FILE
,

258 .
	gtcmd
 = 
AR6004_HW_1_3_TCMD_FIRMWARE_FILE
,

259 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

260 .
	gutf
 = 
AR6004_HW_1_3_UTF_FIRMWARE_FILE
,

261 .
	gã°s¸ùt
 = 
AR6004_HW_1_3_TESTSCRIPT_FILE
,

262 .
	gfw_ext
 = 
AR6004_HW_1_3_FIRMWARE_EXT_FILE
,

265 .
	gfw_bﬂrd
 = 
AR6004_HW_1_3_BOARD_DATA_FILE
,

266 .
	gfw_deÁu…_bﬂrd
 = 
AR6004_HW_1_3_DEFAULT_BOARD_DATA_FILE
,

267 .
	gfw_ïpög
 = 
AR6004_HW_1_3_EPPING_FILE
,

268 .
	gfw_so·mac
 = 
AR6004_HW_1_3_SOFTMAC_FILE
,

269 .
	gfw_so·mac_2
 = 
AR6004_HW_1_3_SOFTMAC_2_FILE
,

272 .
	gid
 = 
AR6004_HW_1_3_VERSION
,

273 .
	g«me
 = "ar6004 hw 1.3 96K",

274 .
	gd©a£t_∑tch_addr
 = 0x42f860,

275 .
	g≠p_lﬂd_addr
 = 0x1234,

276 .
	gbﬂrd_ext_d©a_addr
 = 0x42f000,

277 .
	gª£rved_øm_size
 = 7168,

278 .
	gbﬂrd_addr
 = 0x42e400,

279 .
	gã°s¸ùt_addr
 = 0x434c00,

280 .
	gÊags
 = 
ATH6KL_HW_TGT_ALIGN_PADDING
 |

281 
ATH6KL_HW_SINGLE_PIPE_SCHED
,

283 .
	gfw
 = {

284 .
dú
 = 
AR6004_HW_1_3_FW_DIR
,

285 .
	gŸp
 = 
AR6004_HW_1_3_OTP_FILE
,

286 .
	gfw
 = 
AR6004_HW_1_3_FIRMWARE_FILE
,

287 .
	gtcmd
 = 
AR6004_HW_1_3_TCMD_FIRMWARE_FILE
,

288 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

289 .
	gutf
 = 
AR6004_HW_1_3_UTF_FIRMWARE_FILE
,

290 .
	gã°s¸ùt
 = 
AR6004_HW_1_3_TESTSCRIPT_FILE
,

293 .
	gfw_bﬂrd
 = 
AR6004_HW_1_3_BOARD_DATA_FILE
,

294 .
	gfw_deÁu…_bﬂrd
 = 
AR6004_HW_1_3_DEFAULT_BOARD_DATA_FILE
,

295 .
	gfw_ïpög
 = 
AR6004_HW_1_3_EPPING_FILE
,

296 .
	gfw_so·mac
 = 
AR6004_HW_1_3_SOFTMAC_FILE
,

297 .
	gfw_so·mac_2
 = 
AR6004_HW_1_3_SOFTMAC_2_FILE
,

300 .
	gid
 = 
AR6004_HW_2_0_VERSION
,

301 .
	g«me
 = "ar6004 hw 2.0",

302 .
	gd©a£t_∑tch_addr
 = 0,

303 .
	g≠p_lﬂd_addr
 = 0x1234,

304 .
	gbﬂrd_ext_d©a_addr
 = 0,

305 .
	gª£rved_øm_size
 = 7168,

306 .
	gbﬂrd_addr
 = 0x43e400,

307 .
	gã°s¸ùt_addr
 = 0x43d400,

308 .
	gÊags
 = 
ATH6KL_HW_SINGLE_PIPE_SCHED
 |

309 
ATH6KL_HW_USB_FLOWCTRL
,

310 .
	gfw
 = {

311 .
dú
 = 
AR6004_HW_2_0_FW_DIR
,

312 .
	gŸp
 = 
AR6004_HW_2_0_OTP_FILE
,

313 .
	gfw
 = 
AR6004_HW_2_0_FIRMWARE_FILE
,

314 .
	gtcmd
 = 
AR6004_HW_2_0_TCMD_FIRMWARE_FILE
,

315 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

316 .
	gutf
 = 
AR6004_HW_2_0_UTF_FIRMWARE_FILE
,

317 .
	gã°s¸ùt
 = 
AR6004_HW_2_0_TESTSCRIPT_FILE
,

320 .
	gfw_bﬂrd
 = 
AR6004_HW_2_0_BOARD_DATA_FILE
,

321 .
	gfw_deÁu…_bﬂrd
 = 
AR6004_HW_2_0_DEFAULT_BOARD_DATA_FILE
,

322 .
	gfw_ïpög
 = 
AR6004_HW_2_0_EPPING_FILE
,

323 .
	gfw_so·mac
 = 
AR6004_HW_2_0_SOFTMAC_FILE
,

324 .
	gfw_so·mac_2
 = 
AR6004_HW_2_0_SOFTMAC_2_FILE
,

327 .
	gid
 = 
AR6004_HW_3_0_VERSION
,

328 .
	g«me
 = "ar6004 hw 3.0",

329 .
	gd©a£t_∑tch_addr
 = 0,

330 .
	g≠p_lﬂd_addr
 = 0x1234,

331 .
	gbﬂrd_ext_d©a_addr
 = 0,

332 .
	gª£rved_øm_size
 = 7168,

333 .
	gbﬂrd_addr
 = 0x436400,

334 .
	gã°s¸ùt_addr
 = 0,

335 .
	gÊags
 = 
ATH6KL_HW_SINGLE_PIPE_SCHED
 |

336 
ATH6KL_HW_USB_FLOWCTRL
,

338 .
	gfw
 = {

339 .
dú
 = 
AR6004_HW_3_0_FW_DIR
,

340 .
	gfw
 = 
AR6004_HW_3_0_FIRMWARE_FILE
,

341 .
	gtcmd
 = 
AR6004_HW_3_0_TCMD_FIRMWARE_FILE
,

342 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

343 .
	gutf
 = 
AR6004_HW_3_0_UTF_FIRMWARE_FILE
,

346 .
	gfw_bﬂrd
 = 
AR6004_HW_3_0_BOARD_DATA_FILE
,

347 .
	gfw_deÁu…_bﬂrd
 = 
AR6004_HW_3_0_DEFAULT_BOARD_DATA_FILE
,

348 .
	gfw_ïpög
 = 
AR6004_HW_3_0_EPPING_FILE
,

349 .
	gfw_so·mac
 = 
AR6004_HW_3_0_SOFTMAC_FILE
,

350 .
	gfw_so·mac_2
 = 
AR6004_HW_3_0_SOFTMAC_2_FILE
,

353 .
	gid
 = 
AR6006_HW_1_0_VERSION
,

354 .
	g«me
 = "ar6006 hw 1.0",

355 .
	gd©a£t_∑tch_addr
 = 0,

356 .
	g≠p_lﬂd_addr
 = 0x1234,

357 .
	gbﬂrd_ext_d©a_addr
 = 0,

358 .
	gª£rved_øm_size
 = 18432,

359 .
	gbﬂrd_addr
 = 0x46B800,

360 .
	gÊags
 = 
ATH6KL_HW_SINGLE_PIPE_SCHED
|

361 
ATH6KL_HW_USB_FLOWCTRL
|

362 
ATH6KL_HW_XTAL_40MHZ
,

364 .
	gfw
 = {

365 .
dú
 = 
AR6006_HW_1_0_FW_DIR
,

366 .
	gfw
 = 
AR6006_HW_1_0_FIRMWARE_FILE
,

367 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

370 .
	gfw_bﬂrd
 = 
AR6006_HW_1_0_BOARD_DATA_FILE
,

371 .
	gfw_deÁu…_bﬂrd
 = 
AR6006_HW_1_0_DEFAULT_BOARD_DATA_FILE
,

372 .
	gfw_ïpög
 = 
AR6006_HW_1_0_EPPING_FILE
,

373 .
	gfw_so·mac
 = 
AR6006_HW_1_0_SOFTMAC_FILE
,

374 .
	gfw_so·mac_2
 = 
AR6006_HW_1_0_SOFTMAC_2_FILE
,

377 .
	gid
 = 
AR6006_HW_1_1_VERSION
,

378 .
	g«me
 = "ar6006 hw 1.1",

379 .
	gd©a£t_∑tch_addr
 = 0,

380 .
	g≠p_lﬂd_addr
 = 0x1234,

381 .
	gbﬂrd_ext_d©a_addr
 = 0,

382 .
	gª£rved_øm_size
 = 7168,

383 .
	gbﬂrd_addr
 = 0x46e400,

384 .
	gÊags
 = 
ATH6KL_HW_SINGLE_PIPE_SCHED
|

385 
ATH6KL_HW_USB_FLOWCTRL
|

386 
ATH6KL_HW_XTAL_40MHZ
,

388 .
	gfw
 = {

389 .
dú
 = 
AR6006_HW_1_1_FW_DIR
,

390 .
	gfw
 = 
AR6006_HW_1_1_FIRMWARE_FILE
,

391 .
	g≠i2
 = 
ATH6KL_FW_API2_FILE
,

394 .
	gfw_bﬂrd
 = 
AR6006_HW_1_1_BOARD_DATA_FILE
,

395 .
	gfw_deÁu…_bﬂrd
 = 
AR6006_HW_1_1_DEFAULT_BOARD_DATA_FILE
,

396 .
	gfw_ïpög
 = 
AR6006_HW_1_1_EPPING_FILE
,

397 .
	gfw_so·mac
 = 
AR6006_HW_1_1_SOFTMAC_FILE
,

398 .
	gfw_so·mac_2
 = 
AR6006_HW_1_1_SOFTMAC_2_FILE
,

416 
	#WLAN_CONFIG_KEEP_ALIVE_INTERVAL
 60

	)

425 
	#WLAN_CONFIG_DISCONNECT_TIMEOUT
 10

	)

427 
	#CONFIG_AR600x_DEBUG_UART_TX_PIN
 8

	)

428 
	#CONFIG_AR6004_DEBUG_UART_TX_PIN
 11

	)

429 
	#CONFIG_AR6006_DEBUG_UART_TX_PIN
 11

	)

430 
	#CONFIG_AR6006_FPGA_DEBUG_UART_TX_PIN
 24

	)

432 
	#ATH6KL_DATA_OFFSET
 64

	)

433 
sk_buff
 *
	$©h6kl_buf_Æloc
(
size
)

435 
sk_buff
 *
skb
;

436 
u16
 
ª£rved
;

439 
ª£rved
 = (2 * 
L1_CACHE_BYTES
Ë+ 
ATH6KL_DATA_OFFSET
 +

440 (
htc_∑ckë
);

441 
skb
 = 
	`dev_Æloc_skb
(
size
 + 
ª£rved
);

443 i‡(
skb
)

444 
	`skb_ª£rve
(
skb
, 
ª£rved
 - 
L1_CACHE_BYTES
);

445  
skb
;

446 
	}
}

448 
	$©h6kl_öô_¥ofûe_öfo
(
©h6kl_vif
 *
vif
)

450 
vif
->
ssid_Àn
 = 0;

451 
	`mem£t
(
vif
->
ssid
, 0, (vif->ssid));

453 
vif
->
dŸ11_auth_mode
 = 
OPEN_AUTH
;

454 
vif
->
auth_mode
 = 
NONE_AUTH
;

455 
vif
->
¥wi£_¸y±o
 = 
NONE_CRYPT
;

456 
vif
->
¥wi£_¸y±o_Àn
 = 0;

457 
vif
->
gΩ_¸y±o
 = 
NONE_CRYPT
;

458 
vif
->
gΩ_¸y±o_Àn
 = 0;

459 
	`mem£t
(
vif
->
wï_key_li°
, 0, (vif->wep_key_list));

460 
	`mem£t
(
vif
->
ªq_bssid
, 0, (vif->req_bssid));

461 
	`mem£t
(
vif
->
bssid
, 0, (vif->bssid));

462 
vif
->
bss_ch
 = 0;

463 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_UNKNOWN
;

464 
vif
->
ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_NONE
;

465 
	}
}

468 
	$©h6kl_£t_ho°_≠p_¨ó
(
©h6kl
 *
¨
)

470 
u32
 
addªss
, 
d©a
;

471 
ho°_≠p_¨ó
 host_app_area;

475 
addªss
 = 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_≠p_ho°_öãª°
));

476 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
,áddress);

478 i‡(
	`©h6kl_düg_ªad32
(
¨
, 
addªss
, &
d©a
))

479  -
EIO
;

481 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
, 
d©a
);

482 
ho°_≠p_¨ó
.
wmi_¥Ÿocﬁ_vî
 = 
	`˝u_to_À32
(
WMI_PROTOCOL_VERSION
);

483 i‡(
	`©h6kl_düg_wrôe
(
¨
, 
addªss
, (
u8
 *Ë&
ho°_≠p_¨ó
,

484 (
ho°_≠p_¨ó
)))

485  -
EIO
;

488 
	}
}

490 
u32
 
	$©h6kl_gë_ho°_≠p_¨ó
(
©h6kl
 *
¨
)

492 
u32
 
addªss
, 
d©a
;

494 
addªss
 = 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_≠p_ho°_öãª°
));

495 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
,áddress);

497 i‡(
	`©h6kl_düg_ªad32
(
¨
, 
addªss
, &
d©a
))

498  -
EIO
;

500 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
, 
d©a
);

502  
addªss
;

503 
	}
}

505 
ölöe
 
	$£t_ac2_ï_m≠
(
©h6kl
 *
¨
,

506 
u8
 
ac
,

507 
htc_ídpoöt_id
 
ï
)

509 
¨
->
ac2ï_m≠
[
ac
] = 
ï
;

510 
¨
->
ï2ac_m≠
[
ï
] = 
ac
;

511 
	}
}

514 
	$©h6kl_c⁄√˘£rvi˚
(
©h6kl
 *
¨
,

515 
htc_£rvi˚_c⁄√˘_ªq
 *
c⁄_ªq
,

516 *
desc
)

518 
°©us
;

519 
htc_£rvi˚_c⁄√˘_ª•
 
ª•⁄£
;

521 
	`mem£t
(&
ª•⁄£
, 0, (response));

523 
°©us
 = 
	`©h6kl_htc_c⁄n_£rvi˚
(
¨
->
htc_èrgë
, 
c⁄_ªq
, &
ª•⁄£
);

524 i‡(
°©us
) {

525 
	`©h6kl_îr
("failedÅo connectÅo %s service status:%d\n",

526 
desc
, 
°©us
);

527  
°©us
;

530 i‡(
ª•⁄£
.
ídpoöt
 >
ENDPOINT_MAX


531 || 
ª•⁄£
.
ídpoöt
 <
ENDPOINT_UNUSED
) {

532 
	`©h6kl_îr
("InvÆidÉndpoöt: %d\n", 
ª•⁄£
.
ídpoöt
);

533  -
EINVAL
;

536 
c⁄_ªq
->
svc_id
) {

537 
WMI_CONTROL_SVC
:

538 i‡(
	`ã°_bô
(
WMI_ENABLED
, &
¨
->
Êag
))

539 
	`©h6kl_wmi_£t_c⁄åﬁ_ï
(
¨
->
wmi
, 
ª•⁄£
.
ídpoöt
);

540 
¨
->
˘æ_ï
 = 
ª•⁄£
.
ídpoöt
;

542 
WMI_DATA_BE_SVC
:

543 
	`£t_ac2_ï_m≠
(
¨
, 
WMM_AC_BE
, 
ª•⁄£
.
ídpoöt
);

545 
WMI_DATA_BK_SVC
:

546 
	`£t_ac2_ï_m≠
(
¨
, 
WMM_AC_BK
, 
ª•⁄£
.
ídpoöt
);

548 
WMI_DATA_VI_SVC
:

549 
	`£t_ac2_ï_m≠
(
¨
, 
WMM_AC_VI
, 
ª•⁄£
.
ídpoöt
);

551 
WMI_DATA_VO_SVC
:

552 
	`£t_ac2_ï_m≠
(
¨
, 
WMM_AC_VO
, 
ª•⁄£
.
ídpoöt
);

555 
	`©h6kl_îr
("£rvi˚ id i†nŸ m≠≥d %d\n", 
c⁄_ªq
->
svc_id
);

556  -
EINVAL
;

560 
	}
}

562 
	$©h6kl_öô_£rvi˚_ï
(
©h6kl
 *
¨
)

564 
htc_£rvi˚_c⁄√˘_ªq
 
c⁄√˘
;

566 
	`mem£t
(&
c⁄√˘
, 0, (connect));

568 i‡(
¨
->
hw
.
Êags
 & 
ATH6KL_HW_USB_FLOWCTRL
)

569 
c⁄√˘
.
c⁄n_Êags
 |
HTC_CONN_FLGS_DISABLE_CRED_FLOW_CTRL
;

572 
c⁄√˘
.
ï_cb
.
tx_comp_mu…i
 = 
©h6kl_tx_com∂ëe
;

573 
c⁄√˘
.
ï_cb
.
rx
 = 
©h6kl_rx
;

574 
c⁄√˘
.
ï_cb
.
rx_ªfûl
 = 
©h6kl_rx_ªfûl
;

575 
c⁄√˘
.
ï_cb
.
tx_fuŒ
 = 
©h6kl_tx_queue_fuŒ
;

577 
c⁄√˘
.
ï_cb
.
rx_ªfûl_thªsh
 = 
ATH6KL_MAX_RX_BUFFERS
 / 4;

578 i‡(!
c⁄√˘
.
ï_cb
.
rx_ªfûl_thªsh
)

579 
c⁄√˘
.
ï_cb
.
rx_ªfûl_thªsh
++;

582 
c⁄√˘
.
max_txq_dïth
 = 
MAX_DEFAULT_SEND_QUEUE_DEPTH_CTRL
;

583 
c⁄√˘
.
svc_id
 = 
WMI_CONTROL_SVC
;

584 i‡(
	`©h6kl_c⁄√˘£rvi˚
(
¨
, &
c⁄√˘
, "WMI CONTROL"))

585  -
EIO
;

587 
c⁄√˘
.
Êags
 |
HTC_FLGS_TX_BNDL_PAD_EN
;

594 
c⁄√˘
.
max_rxmsg_sz
 = 
WMI_MAX_TX_DATA_FRAME_LENGTH
;

601 
c⁄√˘
.
ï_cb
.
rx_Æloc_thªsh
 = 
ATH6KL_BUFFER_SIZE
;

602 
c⁄√˘
.
ï_cb
.
rx_Ælo˘hªsh
 = 
©h6kl_Æloc_amsdu_rxbuf
;

608 
c⁄√˘
.
c⁄n_Êags
 |
HTC_CONN_FLGS_REDUCE_CRED_DRIB
;

609 
c⁄√˘
.
c⁄n_Êags
 &~
HTC_CONN_FLGS_THRESH_MASK
;

610 
c⁄√˘
.
c⁄n_Êags
 |
HTC_CONN_FLGS_THRESH_LVL_HALF
;

616 
c⁄√˘
.
max_txq_dïth
 = 
MAX_DEFAULT_SEND_QUEUE_DEPTH
;

617 
c⁄√˘
.
svc_id
 = 
WMI_DATA_BE_SVC
;

619 i‡(
	`©h6kl_c⁄√˘£rvi˚
(
¨
, &
c⁄√˘
, "WMI DATA BE"))

620  -
EIO
;

623 
c⁄√˘
.
svc_id
 = 
WMI_DATA_BK_SVC
;

624 i‡(
	`©h6kl_c⁄√˘£rvi˚
(
¨
, &
c⁄√˘
, "WMI DATA BK"))

625  -
EIO
;

628 
c⁄√˘
.
svc_id
 = 
WMI_DATA_VI_SVC
;

629 i‡(
	`©h6kl_c⁄√˘£rvi˚
(
¨
, &
c⁄√˘
, "WMI DATA VI"))

630  -
EIO
;

639 
c⁄√˘
.
svc_id
 = 
WMI_DATA_VO_SVC
;

640 i‡(
	`©h6kl_c⁄√˘£rvi˚
(
¨
, &
c⁄√˘
, "WMI DATA VO"))

641  -
EIO
;

644 
	}
}

646 
	$©h6kl_öô_c⁄åﬁ_öfo
(
©h6kl_vif
 *
vif
)

648 
u8
 
˘r
;

649 
©h6kl
 *
¨
 = 
vif
->ar;

651 
	`©h6kl_öô_¥ofûe_öfo
(
vif
);

652 
vif
->
def_txkey_ödex
 = 0;

653 
	`mem£t
(
vif
->
wï_key_li°
, 0, (vif->wep_key_list));

654 
vif
->
ch_höt
 = 0;

656 
vif
->
öåa_bss
 = 1;

658 
	`mem£t
((
u8
 *)
vif
->
°a_li°
, 0,

659 
AP_MAX_NUM_STA
 * (
©h6kl_°a
));

662 
˘r
 = 0; cå < 
AP_MAX_NUM_STA
; ctr++) {

663 
	`•ö_lock_öô
(&
vif
->
°a_li°
[
˘r
].
lock
);

664 
	`©h6kl_ps_queue_öô
(&
vif
->
°a_li°
[
˘r
].
psq_d©a
,

665 
PS_QUEUE_TYPE_STA_UNICAST
,

666 
ATH6KL_PS_QUEUE_MAX_AGE
,

667 
ATH6KL_PS_QUEUE_MAX_DEPTH
);

668 
	`©h6kl_ps_queue_öô
(&
vif
->
°a_li°
[
˘r
].
psq_mgmt
,

669 
PS_QUEUE_TYPE_STA_MGMT
,

670 
ATH6KL_PS_QUEUE_MAX_AGE
,

671 
ATH6KL_PS_QUEUE_NO_DEPTH
);

672 
vif
->
°a_li°
[
˘r
].
aggr_c⁄n_˙txt
 = 
NULL
;

675 
	`•ö_lock_öô
(&
vif
->
psq_mˇ°_lock
);

676 
	`©h6kl_ps_queue_öô
(&
vif
->
psq_mˇ°
,

677 
PS_QUEUE_TYPE_AP_MULTICAST
,

678 
ATH6KL_PS_QUEUE_NO_AGE
,

679 
ATH6KL_PS_QUEUE_NO_DEPTH
);

681 
	`mem˝y
(
vif
->
≠_cou¡ry_code
, 
DEF_AP_COUNTRY_CODE
, 3);

689 
	`mem£t
(&
vif
->
sc_∑øms
, 0, (vif->sc_params));

690 
vif
->
sc_∑øms
.
sh‹t_sˇn_øtio
 = 3;

691 i‡(
¨
->
rﬂm_mode
 =
ATH6KL_MODULEROAM_DISABLE
 ||

692 (
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_STATION
)) {

693 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
 = (
CONNECT_SCAN_CTRL_FLAGS
 |

694 
SCAN_CONNECTED_CTRL_FLAGS
 |

695 
ACTIVE_SCAN_CTRL_FLAGS
);

697 
vif
->
sc_∑øms
.
fg_°¨t_≥riod
 = 1;

698 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
 = (
CONNECT_SCAN_CTRL_FLAGS
 |

699 
SCAN_CONNECTED_CTRL_FLAGS
 |

700 
ACTIVE_SCAN_CTRL_FLAGS
 |

701 
ENABLE_AUTO_CTRL_FLAGS
);

704 i‡((
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_USB
) &&

705 (
¨
->
p2p_com∑t
) &&

706 (
vif
->
fw_vif_idx
)) {

707 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
 &~
CONNECT_SCAN_CTRL_FLAGS
;

708 
	`©h6kl_öfo
("Disable connect-scan, vif_idx = %d\n",

709 
vif
->
fw_vif_idx
);

712 i‡(
¨
->
rﬂm_mode
 !
ATH6KL_MODULEROAM_DISABLE
 &&

713 (
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_STATION
 ||

714 
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_P2P_CLIENT
))

715 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
 |
ROAM_SCAN_CTRL_FLAGS
;

717 #i‡
	`deföed
(
CE_SUPPORT
Ë|| deföed(
CE_2_SUPPORT
)

719 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
 = 60;

720 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
 = 2;

722 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
 = (2 * 
ATH6KL_SCAN_ACT_DEWELL_TIME
);

725 i‡(!(
¨
->
wùhy
->
Êags
 & 
WIPHY_FLAG_SUPPORTS_FW_ROAM
))

726 
vif
->
sc_∑øms
.
∑s_chdwñl_time
 =

727 
ATH6KL_SCAN_PAS_DEWELL_TIME_WITHOUT_ROAM
;

733 
	`mem˝y
(&
vif
->
sc_∑øms_deÁu…
, &vif->
sc_∑øms
,

734 (
wmi_sˇn_∑øms_cmd
));

740 
vif
->
sˇn_∂™
.
ty≥
 = 
ATH6KL_SCAN_PLAN_IN_ORDER
;

741 
vif
->
sˇn_∂™
.
numCh™
 = 0;

742 
vif
->
d©a_cookõ_cou¡
 = 0;

744 
	}
}

750 
	$©h6kl_£t_htc_∑øms
(
©h6kl
 *
¨
, 
u32
 
mbox_i§_yõld_vÆ
,

751 
u8
 
htc_˘æ_buf
)

753 
°©us
;

754 
u32
 
blk_size
;

756 
blk_size
 = 
¨
->
mbox_öfo
.
block_size
;

758 i‡(
htc_˘æ_buf
)

759 
blk_size
 |((
u32
)
htc_˘æ_buf
) << 16;

762 
°©us
 = 
	`©h6kl_bmi_wrôe
(
¨
,

763 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

764 
	`HI_ITEM
(
hi_mbox_io_block_sz
)),

765 (
u8
 *)&
blk_size
,

767 i‡(
°©us
) {

768 
	`©h6kl_îr
("bmi_write_memory for IO block size failed\n");

769 
out
;

772 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "block size set: %d (targetáddr:0x%X)\n",

773 
blk_size
,

774 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_mbox_io_block_sz
)));

776 i‡(
mbox_i§_yõld_vÆ
) {

778 
°©us
 = 
	`©h6kl_bmi_wrôe
(
¨
,

779 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

780 
	`HI_ITEM
(
hi_mbox_i§_yõld_limô
)),

781 (
u8
 *)&
mbox_i§_yõld_vÆ
,

783 i‡(
°©us
) {

784 
	`©h6kl_îr
("bmi_write_memory for yieldÜimit failed\n");

785 
out
;

789 
out
:

790  
°©us
;

791 
	}
}

793 
	$©h6kl_èrgë_c⁄fig_wœn_∑øms
(
©h6kl
 *
¨
, 
idx
)

795 
°©us
 = 0;

796 
ªt
;

803 i‡(
	`©h6kl_wmi_£t_rx_‰ame_f‹m©_cmd
(
¨
->
wmi
, 
idx
,

804 
¨
->
rx_mëa_vî
, 0, 0)) {

805 
	`©h6kl_îr
("unableÅo setÅheÑx frame format\n");

806 
°©us
 = -
EIO
;

809 i‡(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_IGNORE_PS_FAIL_EVT_IN_SCAN
) {

810 i‡((
	`©h6kl_wmi_pm∑øms_cmd
(
¨
->
wmi
, 
idx
, 0, 1, 0, 0, 1,

811 
IGNORE_POWER_SAVE_FAIL_EVENT_DURING_SCAN
)) != 0) {

812 
	`©h6kl_îr
("unableÅo setÖower save "

814 
°©us
 = -
EIO
;

817 i‡((
	`©h6kl_wmi_pm∑øms_cmd
(

818 
¨
->
wmi
, 
idx
, 0, 3, 3, 1, 1, 0)) != 0) {

819 
	`©h6kl_îr
("unableÅo setÖower saveÖarams\n");

820 
°©us
 = -
EIO
;

824 i‡(!(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_IGNORE_ERP_BARKER
))

825 i‡((
	`©h6kl_wmi_£t_ÕªambÀ_cmd
(
¨
->
wmi
, 
idx
, 0,

826 
WMI_DONOT_IGNORE_BARKER_IN_ERP
)) != 0) {

827 
	`©h6kl_îr
("unableÅo set barkerÖreambleÖolicy\n");

828 
°©us
 = -
EIO
;

831 i‡(
idx
 < 
¨
->
max_n‹m_iÁ˚
 &&

832 
	`©h6kl_wmi_£t_kì∑live_cmd
(
¨
->
wmi
, 
idx
,

833 
WLAN_CONFIG_KEEP_ALIVE_INTERVAL
)) {

834 
	`©h6kl_îr
("unableÅo set keepálive interval\n");

835 
°©us
 = -
EIO
;

838 i‡(
	`©h6kl_wmi_dis˘imeout_cmd
(
¨
->
wmi
, 
idx
,

839 
WLAN_CONFIG_DISCONNECT_TIMEOUT
)) {

840 
	`©h6kl_îr
("unableÅo set disconnectÅimeout\n");

841 
°©us
 = -
EIO
;

844 i‡(!(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_ENABLE_TX_BURST
))

845 i‡(
	`©h6kl_wmi_£t_wmm_tx›
(
¨
->
wmi
, 
idx
, 
WMI_TXOP_DISABLED
)) {

846 
	`©h6kl_îr
("unableÅo setÅxop bursting\n");

847 
°©us
 = -
EIO
;

850 i‡(
¨
->
p2p
 && (¨->
vif_max
 == 1 ||

851 (
idx
 >
¨
->
max_n‹m_iÁ˚
) ||

852 !(
¨
->
p2p_dediˇã
))) {

853 
ªt
 = 
	`©h6kl_wmi_öfo_ªq_cmd
(
¨
->
wmi
, 
idx
,

854 
P2P_FLAG_CAPABILITIES_REQ
 |

855 
P2P_FLAG_MACADDR_REQ
 |

856 
P2P_FLAG_HMODEL_REQ
);

857 i‡(
ªt
) {

858 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "failedÅoÑequest P2P "

860 "suµ‹ãd\n", 
ªt
);

861 
¨
->
p2p
 = 0;

865 i‡(
¨
->
p2p
 && (¨->
vif_max
 == 1 ||

866 (
idx
 >
¨
->
max_n‹m_iÁ˚
) ||

867 !(
¨
->
p2p_dediˇã
))) {

869 
ªt
 = 
	`©h6kl_wmi_¥obe_ªp‹t_ªq_cmd
(
¨
->
wmi
, 
idx
, 
åue
);

870 i‡(
ªt
) {

871 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "failedÅoÉnable Probe "

872 "Reque°Ñï‹tög (%d)\n", 
ªt
);

874 #ifde‡
CE_SUPPORT


875 
ªt
 = 
	`©h6kl_wmi_¥obe_ª•_ªp‹t_ªq_cmd
(
¨
->
wmi
, 
idx
, 
åue
);

876 i‡(
ªt
) {

877 
	`¥ötk
(
KERN_DEBUG
 "ath6l: FailedÅoÉnable Probe Resp "

878 "ªp‹tög (%d)\n", 
ªt
);

881 i‡(
idx
 < 2) {

883 
ªt
 = 
	`©h6kl_wmi_£t_≠_num_°a_cmd
(
¨
->
wmi
, 
idx
, 8);

884 i‡(
ªt
) {

885 
	`¥ötk
(
KERN_DEBUG
 "ath6l: FailedÅo set max connected sta "

886 "(%d)\n", 
ªt
);

891 #ifde‡
CE_SUPPORT


894 
	`©h6kl_wmi_bssfûãr_cmd
(
¨
->
wmi
, 
idx
,

895 
NONE_BSS_FILTER
, 0);

899 i‡((
¨
->
èrgë_subty≥
 & 
TARGET_SUBTYPE_HT40
) &&

900 (!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_2G_HT40
))) {

905 i‡((((
¨
->
vif_max
 =1Ë&& (!¨->
p2p
)) ||

906 (
¨
->
vif_max
 > 1)) &&

907 (
idx
 < 
¨
->
max_n‹m_iÁ˚
)) {

908 i‡(
	`©h6kl_wmi_£t_ht_ˇp_cmd
(
¨
->
wmi
,

909 
idx
,

910 
A_BAND_24GHZ
,

911 
ATH6KL_24GHZ_HT40_DEF_WIDTH
,

912 
ATH6KL_24GHZ_HT40_DEF_SGI
,

913 
ATH6KL_24GHZ_HT40_DEF_INTOLR40
)) {

914 
	`©h6kl_îr
("unableÅo set HT CAP\n");

915 
°©us
 = -
EIO
;

920  
°©us
;

921 
	}
}

923 
	$©h6kl_c⁄figuª_èrgë
(
©h6kl
 *
¨
)

925 
u32
 
∑øm
, 
øm_ª£rved_size
;

926 
u8
 
fw_i·y≥
, 
fw_mode
 = 0, 
fw_submode
 = 0;

927 
i
;

928 
°©us
;

938 
fw_i·y≥
 = 
HI_OPTION_FW_MODE_BSS_STA
;

940 
i
 = 0; i < 
¨
->
vif_max
; i++)

941 
fw_mode
 |
fw_i·y≥
 << (
i
 * 
HI_OPTION_FW_MODE_BITS
);

961 
i
 = 0; i < 
¨
->
max_n‹m_iÁ˚
; i++)

962 
fw_submode
 |
HI_OPTION_FW_SUBMODE_NONE
 <<

963 (
i
 * 
HI_OPTION_FW_SUBMODE_BITS
);

965 i‡(
¨
->
p2p_dediˇã
) {

966 
i
 = 
¨
->
max_n‹m_iÁ˚
; i <ár->
vif_max
; i++)

967 
fw_submode
 |
HI_OPTION_FW_SUBMODE_P2PDEV
 <<

968 (
i
 * 
HI_OPTION_FW_SUBMODE_BITS
);

969 } i‡(
¨
->
p2p
) {

970 
i
 = 0; i < 
¨
->
vif_max
; i++)

971 
fw_submode
 |
HI_OPTION_FW_SUBMODE_P2PDEV
 <<

972 (
i
 * 
HI_OPTION_FW_SUBMODE_BITS
);

975 #ifde‡
ATH6KL_DIAGNOSTIC


976 
∑øm
 = 115200;

977 i‡(
	`©h6kl_bmi_wrôe
(
¨
,

978 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_desúed_baud_øã
)),

979 (
u8
 *)&
∑øm
, 4) != 0) {

980 
	`©h6kl_îr
("%s: failedÅo set hprxÅrafficÑatio inÅarget\n",

981 
__func__
);

982  -
EIO
;

987 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_ENABLE_DIAGNOSTIC
))

988 
∑øm
 = 0;

990 i‡(
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_USB
)

991 
∑øm
 = 2;

993 
∑øm
 = 3;

996 i‡(
	`©h6kl_bmi_wrôe
(
¨
,

997 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_pkéog_num_buf„rs
)),

998 (
u8
 *)&
∑øm
, 4) != 0) {

999 
	`©h6kl_îr
("%s: failedÅo setÖktlog buffers inÅarget\n",

1000 
__func__
);

1001  -
EIO
;

1006 
∑øm
 = 
HTC_PROTOCOL_VERSION
;

1007 i‡(
	`©h6kl_bmi_wrôe
(
¨
,

1008 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

1009 
	`HI_ITEM
(
hi_≠p_ho°_öãª°
)),

1010 (
u8
 *)&
∑øm
, 4) != 0) {

1011 
	`©h6kl_îr
("bmi_write_memory for htc version failed\n");

1012  -
EIO
;

1016 
∑øm
 = 0;

1017 i‡(
	`©h6kl_bmi_ªad
(
¨
,

1018 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

1019 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1020 (
u8
 *)&
∑øm
, 4) != 0) {

1021 
	`©h6kl_îr
("bmi_read_memory for hi_option_flag2 failed\n");

1022  -
EIO
;

1026 i‡(
¨
->
p2p_c⁄cuºít
 && !¨->
p2p_dediˇã
)

1027 
∑øm
 |
HI_OPTION_DISABLE_P2P_DEDICATE
;

1029 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_ENABLE_RTT
))

1030 
∑øm
 |
HI_OPTION_DISABLE_RTT
;

1033 #ifde‡
ATH6KL_SUPPORT_WLAN_HB


1035 
∑øm
 |
HI_OPTION_ENABLE_WLAN_HB
;

1039 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_ENABLE_WOW_SINGLE_CHAIN
))

1040 
∑øm
 |
HI_OPTION_WOW_SINGLE_CHAIN
;

1043 i‡(
¨
->
p2p_c⁄cuºít
)

1044 
∑øm
 |
HI_OPTION_MCC_ENABLE
 ;

1047 
∑øm
 |
HI_OPTION_ONE_SHOT_NOA_ENABLE
 ;

1049 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "Set hi_option_flag2Åo 0x%08x\n",

1050 
∑øm
);

1051 i‡(
	`©h6kl_bmi_wrôe
(
¨
,

1052 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

1053 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1054 (
u8
 *)&
∑øm
, 4) != 0) {

1055 
	`©h6kl_îr
("bmi_write_memory for hi_option_flag2 flag failed\n");

1056  -
EIO
;

1062 
∑øm
 = 0;

1063 i‡(
	`©h6kl_bmi_ªad
(
¨
,

1064 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

1065 
	`HI_ITEM
(
hi_›ti⁄_Êag
)),

1066 (
u8
 *)&
∑øm
, 4) != 0) {

1067 
	`©h6kl_îr
("bmi_read_memory for setting fwmode failed\n");

1068  -
EIO
;

1071 
∑øm
 |(
¨
->
vif_max
 << 
HI_OPTION_NUM_DEV_SHIFT
);

1072 
∑øm
 |
fw_mode
 << 
HI_OPTION_FW_MODE_SHIFT
;

1073 
∑øm
 |
fw_submode
 << 
HI_OPTION_FW_SUBMODE_SHIFT
;

1075 
∑øm
 |(0 << 
HI_OPTION_MAC_ADDR_METHOD_SHIFT
);

1076 
∑øm
 |(0 << 
HI_OPTION_FW_BRIDGE_SHIFT
);

1078 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_ENABLE_FWLOG
))

1079 
∑øm
 |
HI_OPTION_DISABLE_DBGLOG
;

1081 i‡(
	`©h6kl_bmi_wrôe
(
¨
,

1082 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

1083 
	`HI_ITEM
(
hi_›ti⁄_Êag
)),

1084 (
u8
 *)&
∑øm
,

1086 
	`©h6kl_îr
("bmi_write_memory for setting fwmode failed\n");

1087  -
EIO
;

1090 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "firmware mode set\n");

1100 
∑øm
 = 
¨
->
hw
.
bﬂrd_ext_d©a_addr
;

1101 
øm_ª£rved_size
 = 
¨
->
hw
.
ª£rved_øm_size
;

1103 i‡(
	`©h6kl_bmi_wrôe
(
¨
, 
	`©h6kl_gë_hi_ôem_addr
(ar,

1104 
	`HI_ITEM
(
hi_bﬂrd_ext_d©a
)),

1105 (
u8
 *)&
∑øm
, 4) != 0) {

1106 
	`©h6kl_îr
("bmi_write_memory for hi_board_ext_data failed\n");

1107  -
EIO
;

1110 i‡(
	`©h6kl_bmi_wrôe
(
¨
, 
	`©h6kl_gë_hi_ôem_addr
(ar,

1111 
	`HI_ITEM
(
hi_íd_øm_ª£rve_sz
)),

1112 (
u8
 *)&
øm_ª£rved_size
, 4) != 0) {

1113 
	`©h6kl_îr
("bmi_write_memory for "

1115  -
EIO
;

1119 
∑øm
 = 1;

1120 
°©us
 = 
	`©h6kl_bmi_wrôe
(
¨
, 
	`©h6kl_gë_hi_ôem_addr
(ar,

1121 
	`HI_ITEM
(
hi_£rül_íabÀ
)), (
u8
 *)&
∑øm
, 4);

1122 i‡(
°©us
)

1123  
°©us
;

1124 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "serial consoleÖrintsÉnabled\n");

1127 i‡(
	`©h6kl_£t_htc_∑øms
(
¨
, 
MBOX_YIELD_LIMIT
, 0))

1129  -
EIO
;

1132 
	}
}

1134 
	$©h6kl_c‹e_‰ì
(
©h6kl
 *
¨
)

1136 
	`wùhy_‰ì
(
¨
->
wùhy
);

1137 
	}
}

1139 
	$©h6kl_c‹e_˛ónup
(
©h6kl
 *
¨
)

1141 
	`©h6kl_hif_powî_off
(
¨
);

1143 
	`dñ_timî
(&
¨
->
ópﬁ_sh¥Ÿe˘_timî
);

1145 
	`de°roy_w‹kqueue
(
¨
->
©h6kl_wq
);

1147 i‡(
¨
->
p2p_Êow˘æ_˘x
)

1148 
	`©h6kl_p2p_Êow˘æ_c⁄n_li°_˛ónup
(
¨
);

1150 i‡(
¨
->
htc_èrgë
)

1151 
	`©h6kl_htc_˛ónup
(
¨
->
htc_èrgë
);

1153 
	`©h6kl_cookõ_˛ónup
(
¨
);

1155 
	`©h6kl_˛ónup_amsdu_rxbufs
(
¨
);

1157 
	`©h6kl_bmi_˛ónup
(
¨
);

1159 
	`©h6kl_debug_˛ónup
(
¨
);

1161 
	`©h6kl_p2p_Êow˘æ_c⁄n_li°_deöô
(
¨
);

1163 
	`©h6kl_p2p_rc_deöô
(
¨
);

1165 
	`©h6kl_ªg_deöô
(
¨
);

1167 
	`v‰ì
(
¨
->
fw_bﬂrd
);

1168 
	`v‰ì
(
¨
->
fw_Ÿp
);

1169 
	`v‰ì
(
¨
->
fw
);

1170 
	`v‰ì
(
¨
->
fw_ext
);

1171 
	`v‰ì
(
¨
->
fw_∑tch
);

1172 
	`v‰ì
(
¨
->
fw_ã°s¸ùt
);

1173 
	`v‰ì
(
¨
->
fw_so·mac
);

1174 
	`v‰ì
(
¨
->
fw_so·mac_2
);

1176 
	`©h6kl_deöô_õì80211_hw
(
¨
);

1178 
	`πtm_‰ì
();

1179 
	}
}

1182 #ifde‡
CE_SUPPORT


1183 
	~<löux/öô.h
>

1184 
	~<löux/¶ab.h
>

1185 
	~<löux/uni°d.h
>

1186 
	~<löux/sched.h
>

1187 
	~<löux/fs.h
>

1188 
	~<löux/fûe.h
>

1189 
	~<löux/mm.h
>

1190 
	~<löux/uac˚ss.h
>

1192 
mm_£gmít_t
 
	gﬁdfs
;

1194 
fûe
 *
	$›íFûe
(*
∑th
, 
Êag
, 
mode
)

1196 
fûe
 *
Â
;

1197 
Â
 = 
	`fûp_›í
(
∑th
, 
Êag
, 0);

1198 i‡(
	`IS_ERR
(
Â
))

1199  
NULL
;

1200  
Â
;

1201 
	}
}

1203 
	$ªadFûe
(
fûe
 *
Â
, *
buf
, 
ªadÀn
)

1205 i‡(
Â
->
f_›
 && fp->f_›->
ªad
)

1206  
Â
->
f_›
->
	`ªad
(Â, 
buf
, 
ªadÀn
, &Â->
f_pos
);

1209 
	}
}

1211 
	$˛o£Fûe
(
fûe
 *
Â
)

1213 
	`fûp_˛o£
(
Â
, 
NULL
);

1215 
	}
}

1217 
	$öôKî√lEnv
()

1219 
ﬁdfs
 = 
	`gë_fs
();

1220 
	`£t_fs
(
KERNEL_DS
);

1221 
	}
}

1224 
	$©h6kl_gë_fw
(
©h6kl
 *
¨
, c⁄° *
fûíame
,

1225 
u8
 **
fw
, 
size_t
 *
fw_Àn
)

1227 #ifde‡
CE_SUPPORT


1228 
	#MAX_BUFFER_SIZE
 128

	)

1229 
fûe
 *
Â
 = 
NULL
;

1230 
ªt
;

1231 
buf
[
MAX_BUFFER_SIZE
];

1232 
fuŒ_∑tch
[90];

1233 
tŸÆ_Àn
 = 0, 
ãmp_Àn
 = 0;

1234 
u8
 *
ãmp_buf
;

1235 
°©us
 = -1;

1236 
	`öôKî√lEnv
();

1237 i‡(
fûíame
[0] == '/') {

1239 
	`¢¥ötf
(
fuŒ_∑tch
, (fuŒ_∑tch), "%s", 
fûíame
);

1240 
	`©h6kl_öfo
("%s\n\r", 
fuŒ_∑tch
);

1242 
	`¢¥ötf
(
fuŒ_∑tch
, (full_patch),

1243 "/lib/fúmw¨e/%s", 
fûíame
);

1244 
	`©h6kl_öfo
("%s\n\r", 
fuŒ_∑tch
);

1246 
Â
 = 
	`›íFûe
(
fuŒ_∑tch
, 
O_RDONLY
, 0);

1247 i‡(
Â
 !
NULL
) {

1248 
	`mem£t
(
buf
, 0, 
MAX_BUFFER_SIZE
);

1249 
ªt
 = 
	`ªadFûe
(
Â
, 
buf
, 
MAX_BUFFER_SIZE
);

1250 i‡(
ªt
 > 0) {

1251 
tŸÆ_Àn
 = 
ªt
;

1252 (
ªt
 = 
	`ªadFûe
(
Â
, 
buf
, 
MAX_BUFFER_SIZE
)) > 0)

1253 
tŸÆ_Àn
 +
ªt
;

1254 
	`©h6kl_öfo
("tŸÆ_Àn=%d\n", 
tŸÆ_Àn
);

1256 
	`©h6kl_îr
("ªad fûêîr‹ %d\n", 
ªt
);

1257 
	`˛o£Fûe
(
Â
);

1259 
Áû
;

1261 
Â
 = 
	`›íFûe
(
fuŒ_∑tch
, 
O_RDONLY
, 0);

1262 i‡(
Â
 !
NULL
) {

1263 
ãmp_buf
 = 
	`vmÆloc
(
tŸÆ_Àn
);

1264 i‡(
ãmp_buf
 !
NULL
) {

1265 
	`mem£t
(
buf
, 0, 
MAX_BUFFER_SIZE
);

1266 
ªt
 = 
	`ªadFûe
(
Â
, 
buf
, 
MAX_BUFFER_SIZE
);

1267 i‡(
ªt
 > 0) {

1268 
	`mem˝y
(&
ãmp_buf
[
ãmp_Àn
], 
buf
, 
ªt
);

1269 
ãmp_Àn
 = 
ªt
;

1270 (
ªt
 = 
	`ªadFûe
(
Â
, 
buf
,

1271 
MAX_BUFFER_SIZE
)) > 0) {

1272 
	`mem˝y
(&
ãmp_buf
[
ãmp_Àn
], 
buf
, 
ªt
);

1273 
ãmp_Àn
 +
ªt
;

1275 
°©us
 = 0;

1277 
	`©h6kl_îr
("ªad fûêîr‹ %d\n", 
ªt
);

1279 
	`˛o£Fûe
(
Â
);

1281 
Áû
;

1282 i‡(
°©us
 == 0) {

1283 i‡(
ãmp_buf
 !
NULL
) {

1284 *
fw_Àn
 = 
tŸÆ_Àn
;

1285 *
fw
 = 
	`vmÆloc
(
tŸÆ_Àn
);

1287 i‡(*
fw
 =
NULL
)

1288 
°©us
 = -
ENOMEM
;

1290 
	`mem˝y
(*
fw
, 
ãmp_buf
, 
tŸÆ_Àn
);

1293 i‡(
ãmp_buf
 !
NULL
)

1294 
	`v‰ì
(
ãmp_buf
);

1295 
Áû
:

1296 
	`£t_fs
(
ﬁdfs
);

1297 #unde‡
MAX_BUFFER_SIZE


1298  
°©us
;

1300 c⁄° 
fúmw¨e
 *
fw_íåy
;

1301 
ªt
;

1303 
ªt
 = 
	`ªque°_fúmw¨e
(&
fw_íåy
, 
fûíame
, 
¨
->
dev
);

1304 i‡(
ªt
)

1305  
ªt
;

1307 *
fw_Àn
 = 
fw_íåy
->
size
;

1308 *
fw
 = 
	`vmÆloc
(
fw_íåy
->
size
);

1310 i‡(*
fw
 =
NULL
)

1311 
ªt
 = -
ENOMEM
;

1313 
	`mem˝y
(*
fw
, 
fw_íåy
->
d©a
, fw_íåy->
size
);

1315 
	`ªÀa£_fúmw¨e
(
fw_íåy
);

1317  
ªt
;

1319 
	}
}

1321 #ifde‡
CONFIG_OF


1328 
boﬁ
 
	$check_devi˚_åì
(
©h6kl
 *
¨
)

1330 c⁄° *
bﬂrd_id_¥›
 = "atheros,board-id";

1331 
devi˚_node
 *
node
;

1332 
bﬂrd_fûíame
[64];

1333 c⁄° *
bﬂrd_id
;

1334 
ªt
;

1336 
	`f‹_óch_com∑tibÀ_node
(
node
, 
NULL
, "atheros,ath6kl") {

1337 
bﬂrd_id
 = 
	`of_gë_¥›îty
(
node
, 
bﬂrd_id_¥›
, 
NULL
);

1338 i‡(
bﬂrd_id
 =
NULL
) {

1339 
	`©h6kl_w¨n
("No \"%s\"Öroperty on %sÇode.\n",

1340 
bﬂrd_id_¥›
, 
node
->
«me
);

1343 
	`¢¥ötf
(
bﬂrd_fûíame
, (board_filename),

1344 "%s/bd©a.%s.bö", 
¨
->
hw
.
fw
.
dú
, 
bﬂrd_id
);

1346 
ªt
 = 
	`©h6kl_gë_fw
(
¨
, 
bﬂrd_fûíame
, &¨->
fw_bﬂrd
,

1347 &
¨
->
fw_bﬂrd_Àn
);

1348 i‡(
ªt
) {

1349 
	`©h6kl_îr
("FailedÅo get DT board file %s: %d\n",

1350 
bﬂrd_fûíame
, 
ªt
);

1353  
åue
;

1355  
Ál£
;

1356 
	}
}

1358 
boﬁ
 
	$check_devi˚_åì
(
©h6kl
 *
¨
)

1360  
Ál£
;

1361 
	}
}

1364 #ifde‡
CONFIG_ANDROID


1365 
	$©h6kl_ª∂a˚_wôh_so·mac_2
(
©h6kl
 *
¨
)

1367 
	#PREFIX_MAC_LEN
 3

	)

1368 
i
;

1369 
u16
 *
p
;

1370 
u32
 
sum
 = 0;

1371 
u8
 
deÁu…_mac
[
ETH_ALEN
] = {0x00, 0x03, 0x7f, 0x12, 0x34, 0x56};

1372 
size_t
 
ªmaö_mac_Àn
 = 
ETH_ALEN
 - 
PREFIX_MAC_LEN
;

1374 i‡(
¨
->
fw_bﬂrd
 =
NULL
 ||ár->
fw_so·mac_2
 == NULL)

1377 i‡(
¨
->
fw_so·mac_2_Àn
 < 
ªmaö_mac_Àn
) {

1378 
	`©h6kl_w¨n
("softmac_2.binÜessÅhan %d bytes, "

1379 "ign‹êso·mac_2.bö\n", (Ë
ªmaö_mac_Àn
);

1384 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
] = 0;

1385 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
+1] = 0;

1388 
	`mem˝y
(&
¨
->
fw_bﬂrd
[
BDATA_MAC_ADDR_OFFSET
],

1389 
deÁu…_mac
, 
PREFIX_MAC_LEN
);

1390 
	`mem˝y
(&
¨
->
fw_bﬂrd
[
BDATA_MAC_ADDR_OFFSET
+
PREFIX_MAC_LEN
],

1391 
¨
->
fw_so·mac_2
+◊r->
fw_so·mac_2_Àn
-
ªmaö_mac_Àn
),

1392 
ªmaö_mac_Àn
);

1394 
p
 = (
u16
 *Ë
¨
->
fw_bﬂrd
;

1397 
i
 = 0; i < (
¨
->
fw_bﬂrd_Àn
 / 2); i++)

1398 
sum
 ^*
p
++;

1400 
sum
 = ~sum;

1402 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
] = (
sum
 & 0xff);

1403 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
+1] = ((
sum
 >> 8) & 0xff);

1404 
	}
}

1407 
	$©h6kl_ª∂a˚_wôh_so·mac
(
©h6kl
 *
¨
)

1409 
i
, 
ªt
;

1410 
u16
 *
p
;

1411 
u32
 
sum
 = 0;

1412 
u32
 
∑øm
;

1414 i‡(
¨
->
fw_bﬂrd
 =
NULL
 ||ár->
fw_so·mac
 == NULL)

1418 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
] = 0;

1419 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
+1] = 0;

1422 
	`mem˝y
(&
¨
->
fw_bﬂrd
[
BDATA_MAC_ADDR_OFFSET
],ár->
fw_so·mac
, 
ETH_ALEN
);

1424 
p
 = (
u16
 *Ë
¨
->
fw_bﬂrd
;

1427 
i
 = 0; i < (
¨
->
fw_bﬂrd_Àn
 / 2); i++)

1428 
sum
 ^*
p
++;

1430 
sum
 = ~sum;

1432 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
] = (
sum
 & 0xff);

1433 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
+1] = ((
sum
 >> 8) & 0xff);

1435 
ªt
 = 
	`©h6kl_bmi_ªad
(
¨
,

1436 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

1437 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1438 (
u8
 *Ë&
∑øm
, 4);

1440 i‡(
ªt
) {

1441 
	`©h6kl_îr
("ÁûedÅÿdÿbmòªad %d\n", 
ªt
);

1445 
∑øm
 |
HI_OPTION_DISABLE_MAC_OTP
;

1446 
	`©h6kl_bmi_wrôe
(
¨
,

1447 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

1448 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1449 (
u8
 *)&
∑øm
, 4);

1451 
	}
}

1453 
	$©h6kl_ª∂a˚_wôh_moduÀ_∑øm
(
©h6kl
 *
¨
, *
°r_mac
)

1455 
i
, 
ªt
;

1456 
u16
 *
p
;

1457 
u32
 
sum
 = 0;

1458 
u32
 
∑øm
;

1459 
u8
 
maˇddr
[
ETH_ALEN
] = {0,};

1461 i‡(
¨
->
fw_bﬂrd
 =
NULL
 || 
°r_mac
 == NULL)

1462  -
EINVAL
;

1464 i‡(
	`_°rög_to_mac
(
°r_mac
, 
	`°æí
(°r_mac), 
maˇddr
) < 0)

1465  -
EINVAL
;

1468 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
] = 0;

1469 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
+1] = 0;

1472 
	`mem˝y
(&
¨
->
fw_bﬂrd
[
BDATA_MAC_ADDR_OFFSET
], 
maˇddr
, 
ETH_ALEN
);

1474 
p
 = (
u16
 *Ë
¨
->
fw_bﬂrd
;

1477 
i
 = 0; i < (
¨
->
fw_bﬂrd_Àn
 / 2); i++)

1478 
sum
 ^*
p
++;

1481 
sum
 = ~sum;

1483 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
] = (
sum
 & 0xff);

1484 
¨
->
fw_bﬂrd
[
BDATA_CHECKSUM_OFFSET
+1] = ((
sum
 >> 8) & 0xff);

1486 
ªt
 = 
	`©h6kl_bmi_ªad
(
¨
,

1487 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

1488 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1489 (
u8
 *Ë&
∑øm
, 4);

1491 i‡(
ªt
) {

1492 
	`©h6kl_îr
("ÁûedÅÿdÿbmòªad %d\n", 
ªt
);

1493  
ªt
;

1496 
∑øm
 |
HI_OPTION_DISABLE_MAC_OTP
;

1497 
	`©h6kl_bmi_wrôe
(
¨
,

1498 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

1499 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1500 (
u8
 *)&
∑øm
, 4);

1503 
	}
}

1505 
	$©h6kl_„tch_bﬂrd_fûe
(
©h6kl
 *
¨
)

1507 c⁄° *
fûíame
;

1508 
ªt
;

1510 i‡(
¨
->
fw_bﬂrd
 !
NULL
)

1513 i‡(
	`WARN_ON
(
¨
->
hw
.
fw_bﬂrd
 =
NULL
))

1514  -
EINVAL
;

1516 #ifde‡
CE_SUPPORT


1517 i‡(
bd©≠©h
 !
NULL
)

1518 
fûíame
 = 
bd©≠©h
;

1520 
fûíame
 = 
¨
->
hw
.
fw_bﬂrd
;

1522 
fûíame
 = 
¨
->
hw
.
fw_bﬂrd
;

1525 
ªt
 = 
	`©h6kl_gë_fw
(
¨
, 
fûíame
, &¨->
fw_bﬂrd
,

1526 &
¨
->
fw_bﬂrd_Àn
);

1527 i‡(
ªt
 == 0) {

1529 i‡(
	`©h6kl_ª∂a˚_wôh_moduÀ_∑øm
(
¨
, 
©h6kl_wifi_mac
) == 0)

1532 
ªt
 = 
	`©h6kl_gë_fw
(
¨
,ár->
hw
.
fw_so·mac
, &ar->fw_softmac,

1533 &
¨
->
fw_so·mac_Àn
);

1536 i‡(
ªt
 == 0) {

1537 
	`©h6kl_ª∂a˚_wôh_so·mac
(
¨
);

1540 #ifde‡
CONFIG_ANDROID


1541 
ªt
 = 
	`©h6kl_gë_fw
(
¨
,ár->
hw
.
fw_so·mac_2
, &ar->fw_softmac_2,

1542 &
¨
->
fw_so·mac_2_Àn
);

1545 i‡(
ªt
 == 0)

1546 
	`©h6kl_ª∂a˚_wôh_so·mac_2
(
¨
);

1552 i‡(
	`check_devi˚_åì
(
¨
)) {

1558 
	`©h6kl_w¨n
("FailedÅo get board file %s (%d), "

1560 
fûíame
, 
ªt
);

1562 
fûíame
 = 
¨
->
hw
.
fw_deÁu…_bﬂrd
;

1564 
ªt
 = 
	`©h6kl_gë_fw
(
¨
, 
fûíame
, &¨->
fw_bﬂrd
,

1565 &
¨
->
fw_bﬂrd_Àn
);

1566 i‡(
ªt
) {

1567 
	`©h6kl_îr
("FailedÅo get default board file %s: %d\n",

1568 
fûíame
, 
ªt
);

1569  
ªt
;

1572 
	`©h6kl_w¨n
("WARNING! NoÖroper board file wasÇot found, "

1574 
	`©h6kl_w¨n
("MostÜikely your hardware won't workás specified. "

1578 
	}
}

1580 
	$©h6kl_„tch_Ÿp_fûe
(
©h6kl
 *
¨
)

1582 
fûíame
[100];

1583 
ªt
;

1585 i‡((
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6004
Ë&& (¨->
ã°mode
 == 0))

1588 i‡(
¨
->
fw_Ÿp
 !
NULL
)

1591 i‡(
¨
->
hw
.
fw
.
Ÿp
 =
NULL
) {

1592 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

1597 
	`¢¥ötf
(
fûíame
, (filename), "%s/%s",

1598 
¨
->
hw
.
fw
.
dú
,ár->hw.fw.
Ÿp
);

1600 
ªt
 = 
	`©h6kl_gë_fw
(
¨
, 
fûíame
, &¨->
fw_Ÿp
,

1601 &
¨
->
fw_Ÿp_Àn
);

1602 i‡(
ªt
) {

1603 
	`©h6kl_îr
("FailedÅo get OTP file %s: %d\n",

1604 
fûíame
, 
ªt
);

1605  
ªt
;

1609 
	}
}

1611 
	$©h6kl_„tch_ã°mode_fûe
(
©h6kl
 *
¨
)

1613 
fûíame
[100];

1614 
ªt
;

1616 i‡(
¨
->
ã°mode
 == 0)

1619 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "ã°modê%d\n", 
¨
->
ã°mode
);

1621 i‡(
¨
->
ã°mode
 == 2) {

1622 i‡(
¨
->
hw
.
fw
.
utf
 =
NULL
) {

1623 
	`©h6kl_w¨n
("testmode 2Çot supported\n");

1624  -
EOPNOTSUPP
;

1627 
	`¢¥ötf
(
fûíame
, (filename), "%s/%s",

1628 
¨
->
hw
.
fw
.
dú
,ár->hw.fw.
utf
);

1630 i‡(
¨
->
hw
.
fw
.
tcmd
 =
NULL
) {

1631 
	`©h6kl_w¨n
("testmode 1Çot supported\n");

1632  -
EOPNOTSUPP
;

1635 
	`¢¥ötf
(
fûíame
, (filename), "%s/%s",

1636 
¨
->
hw
.
fw
.
dú
,ár->hw.fw.
tcmd
);

1639 
	`£t_bô
(
TESTMODE
, &
¨
->
Êag
);

1641 
ªt
 = 
	`©h6kl_gë_fw
(
¨
, 
fûíame
, &¨->
fw
, &¨->
fw_Àn
);

1642 i‡(
ªt
) {

1643 
	`©h6kl_îr
("FailedÅo getÅestmode %d firmware file %s: %d\n",

1644 
¨
->
ã°mode
, 
fûíame
, 
ªt
);

1645  
ªt
;

1649 
	}
}

1651 
	$©h6kl_„tch_fw_fûe
(
©h6kl
 *
¨
)

1653 
fûíame
[100];

1654 
ªt
;

1656 i‡(
¨
->
fw
 !
NULL
)

1659 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_ENABLE_EPPING
)) {

1660 i‡(
¨
->
hw
.
fw_ïpög
 =
NULL
) {

1661 
	`©h6kl_w¨n
("testmode-eppingÇot supported\n");

1662  -
EOPNOTSUPP
;

1665 
	`¢¥ötf
(
fûíame
, (filename), "%s",

1666 
¨
->
hw
.
fw_ïpög
);

1668 
	`£t_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
);

1670 
gë_fw
;

1674 i‡(
	`WARN_ON
(
¨
->
hw
.
fw
.fw =
NULL
))

1675  -
EINVAL
;

1677 #ifde‡
CE_SUPPORT


1678 i‡(
fwd©≠©h
 !
NULL
)

1679 
	`¢¥ötf
(
fûíame
, (filename), "%s",

1680 
fwd©≠©h
);

1682 
	`¢¥ötf
(
fûíame
, (filename), "%s/%s",

1683 
¨
->
hw
.
fw
.
dú
,ár->hw.fw.fw);

1685 
	`¢¥ötf
(
fûíame
, (filename), "%s/%s",

1686 
¨
->
hw
.
fw
.
dú
,ár->hw.fw.fw);

1689 
gë_fw
:

1690 
ªt
 = 
	`©h6kl_gë_fw
(
¨
, 
fûíame
, &¨->
fw
, &¨->
fw_Àn
);

1691 i‡(
ªt
) {

1692 
	`©h6kl_îr
("FailedÅo get firmware file %s: %d\n",

1693 
fûíame
, 
ªt
);

1694  
ªt
;

1697 i‡(
¨
->
vîsi⁄
.
èrgë_vî
 =
AR6004_HW_1_3_VERSION
 &&

1698 
¨
->
fw_Àn
 > 
AR6004_MAX_64K_FW_SIZE
) {

1699 
¨
->
hw
.
Êags
 &~
ATH6KL_HW_FIRMWARE_EXT_SUPPORT
;

1702 i‡(
¨
->
hw
.
Êags
 & 
ATH6KL_HW_FIRMWARE_EXT_SUPPORT
) {

1703 
	`¢¥ötf
(
fûíame
, (filename), "%s/%s",

1704 
¨
->
hw
.
fw
.
dú
,ár->hw.fw.
fw_ext
);

1705 
ªt
 = 
	`©h6kl_gë_fw
(
¨
, 
fûíame
, &¨->
fw_ext
, &¨->
fw_ext_Àn
);

1706 i‡(
ªt
) {

1711 
	`©h6kl_îr
("Disable firmwareÉxt feature\n");

1712 
gë_fw_d⁄e
;

1715 
	`£t_bô
(
DOWNLOAD_FIRMWARE_EXT
, &
¨
->
Êag
);

1718 
gë_fw_d⁄e
:

1720 
	}
}

1722 
	$©h6kl_„tch_∑tch_fûe
(
©h6kl
 *
¨
)

1724 
fûíame
[100];

1725 
ªt
;

1727 i‡(
¨
->
fw_∑tch
 !
NULL
)

1730 i‡(
¨
->
hw
.
fw
.
∑tch
 =
NULL
)

1733 
	`¢¥ötf
(
fûíame
, (filename), "%s/%s",

1734 
¨
->
hw
.
fw
.
dú
,ár->hw.fw.
∑tch
);

1736 
ªt
 = 
	`©h6kl_gë_fw
(
¨
, 
fûíame
, &¨->
fw_∑tch
,

1737 &
¨
->
fw_∑tch_Àn
);

1738 i‡(
ªt
) {

1739 
	`©h6kl_îr
("FailedÅo getÖatch file %s: %d\n",

1740 
fûíame
, 
ªt
);

1741  
ªt
;

1745 
	}
}

1747 
	$©h6kl_„tch_ã°s¸ùt_fûe
(
©h6kl
 *
¨
)

1749 
fûíame
[100];

1750 
ªt
;

1752 i‡(
¨
->
ã°mode
 != 2)

1755 i‡(
¨
->
fw_ã°s¸ùt
 !
NULL
)

1758 i‡(
¨
->
hw
.
fw
.
ã°s¸ùt
 =
NULL
)

1761 
	`¢¥ötf
(
fûíame
, (filename), "%s/%s",

1762 
¨
->
hw
.
fw
.
dú
,ár->hw.fw.
ã°s¸ùt
);

1764 
ªt
 = 
	`©h6kl_gë_fw
(
¨
, 
fûíame
, &¨->
fw_ã°s¸ùt
,

1765 &
¨
->
fw_ã°s¸ùt_Àn
);

1766 i‡(
ªt
) {

1767 
	`©h6kl_îr
("FailedÅo getÅestscript file %s: %d\n",

1768 
fûíame
, 
ªt
);

1769  
ªt
;

1773 
	}
}

1775 
	$©h6kl_„tch_fw_≠i1
(
©h6kl
 *
¨
)

1777 
ªt
;

1779 
ªt
 = 
	`©h6kl_„tch_Ÿp_fûe
(
¨
);

1780 i‡(
ªt
)

1781  
ªt
;

1783 
ªt
 = 
	`©h6kl_„tch_fw_fûe
(
¨
);

1784 i‡(
ªt
)

1785  
ªt
;

1787 
ªt
 = 
	`©h6kl_„tch_∑tch_fûe
(
¨
);

1788 i‡(
ªt
)

1789  
ªt
;

1791 
ªt
 = 
	`©h6kl_„tch_ã°s¸ùt_fûe
(
¨
);

1792 i‡(
ªt
)

1793  
ªt
;

1796 
	}
}

1798 #ifde‡
CONFIG_ATH6KL_ENABLE_FW_API2


1799 
	$©h6kl_„tch_fw_≠i2
(
©h6kl
 *
¨
)

1801 
size_t
 
magic_Àn
, 
Àn
, 
õ_Àn
;

1802 c⁄° 
fúmw¨e
 *
fw
;

1803 
©h6kl_fw_õ
 *
hdr
;

1804 
fûíame
[100];

1805 c⁄° 
u8
 *
d©a
;

1806 
ªt
, 
õ_id
, 
i
, 
ödex
, 
bô
;

1807 
__À32
 *
vÆ
;

1809 i‡(
¨
->
hw
.
fw
.
≠i2
 =
NULL
)

1810  -
EOPNOTSUPP
;

1812 
	`¢¥ötf
(
fûíame
, (filename), "%s/%s",

1813 
¨
->
hw
.
fw
.
dú
,ár->hw.fw.
≠i2
);

1815 
ªt
 = 
	`ªque°_fúmw¨e
(&
fw
, 
fûíame
, 
¨
->
dev
);

1816 i‡(
ªt
)

1817  
ªt
;

1819 
d©a
 = 
fw
->data;

1820 
Àn
 = 
fw
->
size
;

1823 
magic_Àn
 = 
	`°æí
(
ATH6KL_FIRMWARE_MAGIC
) + 1;

1825 i‡(
Àn
 < 
magic_Àn
) {

1826 
ªt
 = -
EINVAL
;

1827 
out
;

1830 i‡(
	`memcmp
(
d©a
, 
ATH6KL_FIRMWARE_MAGIC
, 
magic_Àn
) != 0) {

1831 
ªt
 = -
EINVAL
;

1832 
out
;

1835 
Àn
 -
magic_Àn
;

1836 
d©a
 +
magic_Àn
;

1839 
Àn
 > (
©h6kl_fw_õ
)) {

1841 
hdr
 = (
©h6kl_fw_õ
 *Ë
d©a
;

1843 
õ_id
 = 
	`À32_to_˝up
(&
hdr
->
id
);

1844 
õ_Àn
 = 
	`À32_to_˝up
(&
hdr
->
Àn
);

1846 
Àn
 -(*
hdr
);

1847 
d©a
 +(*
hdr
);

1849 i‡(
Àn
 < 
õ_Àn
) {

1850 
ªt
 = -
EINVAL
;

1851 
out
;

1854 
õ_id
) {

1855 
ATH6KL_FW_IE_OTP_IMAGE
:

1856 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "found otp image ie "

1857 "(%zd B)\n", 
õ_Àn
);

1859 
¨
->
fw_Ÿp
 = 
	`kmemdup
(
d©a
, 
õ_Àn
, 
GFP_KERNEL
);

1861 i‡(
¨
->
fw_Ÿp
 =
NULL
) {

1862 
ªt
 = -
ENOMEM
;

1863 
out
;

1866 
¨
->
fw_Ÿp_Àn
 = 
õ_Àn
;

1868 
ATH6KL_FW_IE_FW_IMAGE
:

1869 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "found fw image ie "

1870 "(%zd B)\n", 
õ_Àn
);

1873 i‡(
¨
->
fw
 !
NULL
)

1876 
¨
->
fw
 = 
	`kmemdup
(
d©a
, 
õ_Àn
, 
GFP_KERNEL
);

1878 i‡(
¨
->
fw
 =
NULL
) {

1879 
ªt
 = -
ENOMEM
;

1880 
out
;

1883 
¨
->
fw_Àn
 = 
õ_Àn
;

1885 
ATH6KL_FW_IE_PATCH_IMAGE
:

1886 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "foundÖatch image "

1887 "õ (%zd B)\n", 
õ_Àn
);

1889 
¨
->
fw_∑tch
 = 
	`kmemdup
(
d©a
, 
õ_Àn
, 
GFP_KERNEL
);

1891 i‡(
¨
->
fw_∑tch
 =
NULL
) {

1892 
ªt
 = -
ENOMEM
;

1893 
out
;

1896 
¨
->
fw_∑tch_Àn
 = 
õ_Àn
;

1898 
ATH6KL_FW_IE_RESERVED_RAM_SIZE
:

1899 
vÆ
 = (
__À32
 *Ë
d©a
;

1900 
¨
->
hw
.
ª£rved_øm_size
 = 
	`À32_to_˝up
(
vÆ
);

1902 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

1904 
¨
->
hw
.
ª£rved_øm_size
);

1906 
ATH6KL_FW_IE_CAPABILITIES
:

1907 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

1909 
õ_Àn
);

1911 
i
 = 0; i < 
ATH6KL_FW_CAPABILITY_MAX
; i++) {

1912 
ödex
 = 
	`ALIGN
(
i
, 8) / 8;

1913 
bô
 = 
i
 % 8;

1915 i‡(
d©a
[
ödex
] & (1 << 
bô
))

1916 
	`__£t_bô
(
i
, 
¨
->
fw_ˇ∑bûôõs
);

1919 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_BOOT
, "capabilities", "",

1920 
¨
->
fw_ˇ∑bûôõs
,

1921 (
¨
->
fw_ˇ∑bûôõs
));

1923 
ATH6KL_FW_IE_PATCH_ADDR
:

1924 i‡(
õ_Àn
 !(*
vÆ
))

1927 
vÆ
 = (
__À32
 *Ë
d©a
;

1928 
¨
->
hw
.
d©a£t_∑tch_addr
 = 
	`À32_to_˝up
(
vÆ
);

1930 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

1932 
¨
->
hw
.
d©a£t_∑tch_addr
);

1934 
ATH6KL_FW_IE_BOARD_ADDR
:

1935 i‡(
õ_Àn
 !(*
vÆ
))

1938 
vÆ
 = (
__À32
 *Ë
d©a
;

1939 
¨
->
hw
.
bﬂrd_addr
 = 
	`À32_to_˝up
(
vÆ
);

1941 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

1943 
¨
->
hw
.
bﬂrd_addr
);

1945 
ATH6KL_FW_IE_VIF_MAX
:

1946 i‡(
õ_Àn
 !(*
vÆ
))

1949 
vÆ
 = (
__À32
 *Ë
d©a
;

1950 
¨
->
vif_max
 = 
	`mö_t
(, 
	`À32_to_˝up
(
vÆ
),

1951 
ATH6KL_VIF_MAX
);

1953 i‡(
¨
->
vif_max
 > 1 && !¨->
p2p
)

1954 
¨
->
max_n‹m_iÁ˚
 = 2;

1956 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

1957 "found vi‡max iê%d\n", 
¨
->
vif_max
);

1960 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "Unknown fw ie: %u\n",

1961 
	`À32_to_˝up
(&
hdr
->
id
));

1965 
Àn
 -
õ_Àn
;

1966 
d©a
 +
õ_Àn
;

1969 
ªt
 = 0;

1970 
out
:

1971 
	`ªÀa£_fúmw¨e
(
fw
);

1973  
ªt
;

1974 
	}
}

1977 
	$©h6kl_„tch_fúmw¨es
(
©h6kl
 *
¨
)

1979 
ªt
;

1981 
ªt
 = 
	`©h6kl_„tch_bﬂrd_fûe
(
¨
);

1982 i‡(
ªt
)

1983  
ªt
;

1985 
ªt
 = 
	`©h6kl_„tch_ã°mode_fûe
(
¨
);

1986 i‡(
ªt
)

1987  
ªt
;

1988 #ifde‡
CONFIG_ATH6KL_ENABLE_FW_API2


1989 
ªt
 = 
	`©h6kl_„tch_fw_≠i2
(
¨
);

1990 i‡(
ªt
 == 0) {

1991 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "using fwápi 2\n");

1995 
ªt
 = 
	`©h6kl_„tch_fw_≠i1
(
¨
);

1996 i‡(
ªt
)

1997  
ªt
;

1999 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "using fwápi 1\n");

2002 
	}
}

2004 
	$©h6kl_u∂ﬂd_bﬂrd_fûe
(
©h6kl
 *
¨
)

2006 
u32
 
bﬂrd_addªss
, 
bﬂrd_ext_addªss
, 
∑øm
;

2007 
u32
 
bﬂrd_d©a_size
, 
bﬂrd_ext_d©a_size
;

2008 
ªt
;

2015 i‡(
¨
->
hw
.
bﬂrd_addr
 != 0) {

2016 
bﬂrd_addªss
 = 
¨
->
hw
.
bﬂrd_addr
;

2017 
	`©h6kl_bmi_wrôe
(
¨
,

2018 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2019 
	`HI_ITEM
(
hi_bﬂrd_d©a
)),

2020 (
u8
 *Ë&
bﬂrd_addªss
, 4);

2022 
	`©h6kl_bmi_ªad
(
¨
,

2023 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2024 
	`HI_ITEM
(
hi_bﬂrd_d©a
)),

2025 (
u8
 *Ë&
bﬂrd_addªss
, 4);

2029 
	`©h6kl_bmi_ªad
(
¨
,

2030 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2031 
	`HI_ITEM
(
hi_bﬂrd_ext_d©a
)),

2032 (
u8
 *Ë&
bﬂrd_ext_addªss
, 4);

2034 i‡(
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6003
 &&

2035 
bﬂrd_ext_addªss
 == 0) {

2036 
	`©h6kl_îr
("FailedÅo get board fileÅargetáddress.\n");

2037  -
EINVAL
;

2040 
¨
->
èrgë_ty≥
) {

2041 
TARGET_TYPE_AR6003
:

2042 
bﬂrd_d©a_size
 = 
AR6003_BOARD_DATA_SZ
;

2043 
bﬂrd_ext_d©a_size
 = 
AR6003_BOARD_EXT_DATA_SZ
;

2045 
TARGET_TYPE_AR6004
:

2046 
bﬂrd_d©a_size
 = 
AR6004_BOARD_DATA_SZ
;

2047 
bﬂrd_ext_d©a_size
 = 
AR6004_BOARD_EXT_DATA_SZ
;

2049 
TARGET_TYPE_AR6006
:

2050 
bﬂrd_d©a_size
 = 
AR6006_BOARD_DATA_SZ
;

2051 
bﬂrd_ext_d©a_size
 = 
AR6006_BOARD_EXT_DATA_SZ
;

2054 
	`WARN_ON
(1);

2055  -
EINVAL
;

2059 i‡(
bﬂrd_ext_addªss
 &&

2060 
¨
->
fw_bﬂrd_Àn
 =(
bﬂrd_d©a_size
 + 
bﬂrd_ext_d©a_size
)) {

2063 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

2065 
bﬂrd_ext_addªss
, 
bﬂrd_ext_d©a_size
);

2067 
ªt
 = 
	`©h6kl_bmi_wrôe
(
¨
, 
bﬂrd_ext_addªss
,

2068 
¨
->
fw_bﬂrd
 + 
bﬂrd_d©a_size
,

2069 
bﬂrd_ext_d©a_size
);

2070 i‡(
ªt
) {

2071 
	`©h6kl_îr
("FailedÅo writeÉxtended board data: %d\n",

2072 
ªt
);

2073  
ªt
;

2077 
∑øm
 = (
bﬂrd_ext_d©a_size
 << 16) | 1;

2079 
	`©h6kl_bmi_wrôe
(
¨
,

2080 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2081 
	`HI_ITEM
(
hi_bﬂrd_ext_d©a_c⁄fig
)),

2082 (*Ë&
∑øm
, 4);

2085 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "writing board fileÅo 0x%x (%d B)\n",

2086 
bﬂrd_addªss
, 
bﬂrd_d©a_size
);

2088 
ªt
 = 
	`©h6kl_bmi_wrôe
(
¨
, 
bﬂrd_addªss
,ár->
fw_bﬂrd
,

2089 
bﬂrd_d©a_size
);

2091 i‡(
ªt
) {

2092 
	`©h6kl_îr
("Bﬂrd fûêbmòwrôêÁûed: %d\n", 
ªt
);

2093  
ªt
;

2097 
∑øm
 = 
bﬂrd_d©a_size
;

2098 
	`©h6kl_bmi_wrôe
(
¨
,

2099 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2100 
	`HI_ITEM
(
hi_bﬂrd_d©a_öôülized
)),

2101 (
u8
 *)&
∑øm
, 4);

2103  
ªt
;

2104 
	}
}

2106 
	$©h6kl_u∂ﬂd_Ÿp
(
©h6kl
 *
¨
)

2108 
u32
 
addªss
, 
∑øm
;

2109 
boﬁ
 
‰om_hw
 = 
Ál£
;

2110 
ªt
;

2112 i‡(
¨
->
fw_Ÿp
 =
NULL
)

2115 
addªss
 = 
¨
->
hw
.
≠p_lﬂd_addr
;

2117 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "wrôög oçÅÿ0x%x (%zd B)\n", 
addªss
,

2118 
¨
->
fw_Ÿp_Àn
);

2120 
ªt
 = 
	`©h6kl_bmi_Á°_dow∆ﬂd
(
¨
, 
addªss
,ár->
fw_Ÿp
,

2121 
¨
->
fw_Ÿp_Àn
);

2122 i‡(
ªt
) {

2123 
	`©h6kl_îr
("FaûedÅÿu∂ﬂd OTP fûe: %d\n", 
ªt
);

2124  
ªt
;

2128 
ªt
 = 
	`©h6kl_bmi_ªad
(
¨
,

2129 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2130 
	`HI_ITEM
(
hi_≠p_°¨t
)),

2131 (
u8
 *Ë&
addªss
, (address));

2133 i‡(
ªt
) {

2134 
	`©h6kl_îr
("FaûedÅÿªad hi_≠p_°¨t: %d\n", 
ªt
);

2135  
ªt
;

2138 i‡(
¨
->
hw
.
≠p_°¨t_ovîride_addr
 == 0) {

2139 
¨
->
hw
.
≠p_°¨t_ovîride_addr
 = 
addªss
;

2140 
‰om_hw
 = 
åue
;

2143 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "app_start_override_addr%s 0x%x\n",

2144 
‰om_hw
 ? " (from hw)" : "",

2145 
¨
->
hw
.
≠p_°¨t_ovîride_addr
);

2148 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "executing OTPát 0x%x\n",

2149 
¨
->
hw
.
≠p_°¨t_ovîride_addr
);

2150 
∑øm
 = 0;

2151 
	`©h6kl_bmi_execuã
(
¨
,ár->
hw
.
≠p_°¨t_ovîride_addr
, &
∑øm
);

2153  
ªt
;

2154 
	}
}

2156 
	$©h6kl_u∂ﬂd_fúmw¨e
(
©h6kl
 *
¨
)

2158 
u32
 
addªss
;

2159 
ªt
;

2161 i‡(
	`WARN_ON
(
¨
->
fw
 =
NULL
))

2164 
addªss
 = 
¨
->
hw
.
≠p_lﬂd_addr
;

2166 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "writing firmwareÅo 0x%x (%zd B)\n",

2167 
addªss
, 
¨
->
fw_Àn
);

2169 
ªt
 = 
	`©h6kl_bmi_Á°_dow∆ﬂd
(
¨
, 
addªss
,ár->
fw
,ár->
fw_Àn
);

2171 i‡(
ªt
) {

2172 
	`©h6kl_îr
("FaûedÅÿwrôêfúmw¨e: %d\n", 
ªt
);

2173  
ªt
;

2180 i‡(
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6004
 &&

2181 
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6006
) {

2182 
addªss
 = 
¨
->
hw
.
≠p_°¨t_ovîride_addr
;

2183 
	`©h6kl_bmi_£t_≠p_°¨t
(
¨
, 
addªss
);

2185  
ªt
;

2186 
	}
}

2188 
	$©h6kl_u∂ﬂd_fúmw¨e_ext
(
©h6kl
 *
¨
)

2190 
u32
 
addªss
;

2191 
ªt
 = -1;

2192 
u32
 
∑øm
;

2193 
u32
 
fûeSize
 = 0, 
£˘i⁄Addr
 = 0, 
£˘i⁄Lí
 = 0, 
ªadLí
 = 0;

2194 
u32
 
i
;

2195 
u32
 
vÆue
;

2197 i‡(
	`WARN_ON
(
¨
->
fw_ext
 =
NULL
))

2200 
addªss
 = 
¨
->
hw
.
≠p_lﬂd_ext_addr
;

2202 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "writing firmwareÉxtÅo 0x%x (%zd B)\n",

2203 
addªss
, 
¨
->
fw_Àn
);

2205 
fûeSize
 = 
¨
->
fw_ext_Àn
;

2206 
ªadLí
 < 
fûeSize
) {

2207 
£˘i⁄Addr
 = 
¨
->
fw_ext
[
ªadLí
] |

2208 ((
¨
->
fw_ext
[
ªadLí
+1]<<8)&0x0000ff00) |

2209 ((
¨
->
fw_ext
[
ªadLí
+2]<<16)&0x00ff0000) |

2210 ((
¨
->
fw_ext
[
ªadLí
+3]<<24)&0xff000000);

2211 
£˘i⁄Lí
 = 
¨
->
fw_ext
[
ªadLí
+4] |

2212 ((
¨
->
fw_ext
[
ªadLí
+5]<<8)&0x0000ff00) |

2213 ((
¨
->
fw_ext
[
ªadLí
+6]<<16)&0x00ff0000) |

2214 ((
¨
->
fw_ext
[
ªadLí
+7]<<24)&0xff000000);

2216 
i
 = (
ªadLí
+8); i < (ªadLí+8+
£˘i⁄Lí
); i += 4) {

2217 
vÆue
 = 0;

2218 i‡((
ªadLí
+8+
£˘i⁄Lí
-
i
)/4 > 0) {

2219 
vÆue
 = 
¨
->
fw_ext
[
i
]|

2220 ((
¨
->
fw_ext
[
i
+1]<<8)&0x0000ff00) |

2221 ((
¨
->
fw_ext
[
i
+2]<<16)&0x00ff0000) |

2222 ((
¨
->
fw_ext
[
i
+3]<<24)&0xff000000);

2224 
ªadLí
+8+
£˘i⁄Lí
-
i
) {

2226 
vÆue
 = 
¨
->
fw_ext
[
i
];

2229 
vÆue
 = 
¨
->
fw_ext
[
i
] |

2230 ((
¨
->
fw_ext
[
i
+1]<<8)&0x0000ff00);

2233 
vÆue
 = 
¨
->
fw_ext
[
i
] |

2234 ((
¨
->
fw_ext
[
i
+1]<<8)&0x0000ff00) |

2235 ((
¨
->
fw_ext
[
i
+2]<<16)&0x00ff0000);

2242 
ªt
 = 
	`©h6kl_düg_wrôe32
(
¨
, 
£˘i⁄Addr
, 
vÆue
);

2244 i‡(
ªt
)

2247 
£˘i⁄Addr
 += 4;

2250 i‡(
ªt
)

2253 
ªadLí
 +(
£˘i⁄Lí
+8);

2256 i‡(
ªt
) {

2257 
	`©h6kl_îr
("FaûedÅÿwrôêfúmw¨êext: %d\n", 
ªt
);

2258  
ªt
;

2261 
∑øm
 = 0;

2262 i‡(
	`©h6kl_düg_ªad32
(
¨
,

2263 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

2264 (
u32
 *)&
∑øm
) != 0) {

2265 
	`©h6kl_îr
("read_memory for setting fwmode failed\n");

2266  -
EIO
;

2269 
∑øm
 |
HI_OPTION_EXT_FW_DOWNLOAD_DONE
;

2270 i‡(
	`©h6kl_düg_wrôe32
(
¨
,

2271 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

2272 
∑øm
) != 0) {

2273 
	`©h6kl_îr
("write_memory for "

2275  -
EIO
;

2278 
∑øm
 = 0;

2279 i‡(
	`©h6kl_düg_ªad32
(
¨
,

2280 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

2281 (
u32
 *)&
∑øm
) != 0) {

2282 
	`©h6kl_îr
("read_memory for setting fwmode failed\n");

2283  -
EIO
;

2286  
ªt
;

2287 
	}
}

2289 
	$©h6kl_u∂ﬂd_∑tch
(
©h6kl
 *
¨
)

2291 
u32
 
addªss
, 
∑øm
;

2292 
ªt
;

2294 i‡(
¨
->
fw_∑tch
 =
NULL
)

2297 
addªss
 = 
¨
->
hw
.
d©a£t_∑tch_addr
;

2299 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "writingÖatchÅo 0x%x (%zd B)\n",

2300 
addªss
, 
¨
->
fw_∑tch_Àn
);

2302 
ªt
 = 
	`©h6kl_bmi_wrôe
(
¨
, 
addªss
,ár->
fw_∑tch
,ár->
fw_∑tch_Àn
);

2303 i‡(
ªt
) {

2304 
	`©h6kl_îr
("FaûedÅÿwrôê∑tch fûe: %d\n", 
ªt
);

2305  
ªt
;

2308 
∑øm
 = 
addªss
;

2309 
	`©h6kl_bmi_wrôe
(
¨
,

2310 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2311 
	`HI_ITEM
(
hi_d£t_li°_hód
)),

2312 (*Ë&
∑øm
, 4);

2315 
	}
}

2317 
	$©h6kl_u∂ﬂd_ã°s¸ùt
(
©h6kl
 *
¨
)

2319 
u32
 
addªss
, 
∑øm
;

2320 
ªt
;

2322 i‡(
¨
->
ã°mode
 != 2)

2325 i‡(
¨
->
fw_ã°s¸ùt
 =
NULL
)

2328 
addªss
 = 
¨
->
hw
.
ã°s¸ùt_addr
;

2330 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "writingÅestscriptÅo 0x%x (%zd B)\n",

2331 
addªss
, 
¨
->
fw_ã°s¸ùt_Àn
);

2333 
ªt
 = 
	`©h6kl_bmi_wrôe
(
¨
, 
addªss
,ár->
fw_ã°s¸ùt
,

2334 
¨
->
fw_ã°s¸ùt_Àn
);

2335 i‡(
ªt
) {

2336 
	`©h6kl_îr
("FaûedÅÿwrôêã°s¸ùàfûe: %d\n", 
ªt
);

2337  
ªt
;

2340 
∑øm
 = 
addªss
;

2341 
	`©h6kl_bmi_wrôe
(
¨
,

2342 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2343 
	`HI_ITEM
(
hi_Ÿa_ã°s¸ùt
)),

2344 (*Ë&
∑øm
, 4);

2346 i‡(
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6003
) {

2347 
∑øm
 = 4096;

2348 
	`©h6kl_bmi_wrôe
(
¨
,

2349 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2350 
	`HI_ITEM
(
hi_íd_øm_ª£rve_sz
)),

2351 (*Ë&
∑øm
, 4);

2354 
∑øm
 = 1;

2355 
	`©h6kl_bmi_wrôe
(
¨
,

2356 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2357 
	`HI_ITEM
(
hi_ã°_≠ps_ªœãd
)),

2358 (*Ë&
∑øm
, 4);

2361 
	}
}

2363 
	$©h6kl_öô_u∂ﬂd
(
©h6kl
 *
¨
)

2365 
u32
 
∑øm
, 
›ti⁄s
, 
¶ìp
, 
addªss
;

2366 
°©us
 = 0;

2368 i‡(
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6003
 &&

2369 
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6004
 &&

2370 
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6006
)

2371  -
EINVAL
;

2374 
addªss
 = 
MBOX_BASE_ADDRESS
 + 
LOCAL_SCRATCH_ADDRESS
;

2375 
°©us
 = 
	`©h6kl_bmi_ªg_ªad
(
¨
, 
addªss
, &
∑øm
);

2376 i‡(
°©us
)

2377  
°©us
;

2379 
›ti⁄s
 = 
∑øm
;

2381 
∑øm
 |
ATH6KL_OPTION_SLEEP_DISABLE
;

2382 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
∑øm
);

2383 i‡(
°©us
)

2384  
°©us
;

2386 
addªss
 = 
RTC_BASE_ADDRESS
 + 
SYSTEM_SLEEP_ADDRESS
;

2387 
°©us
 = 
	`©h6kl_bmi_ªg_ªad
(
¨
, 
addªss
, &
∑øm
);

2388 i‡(
°©us
)

2389  
°©us
;

2391 
¶ìp
 = 
∑øm
;

2393 
∑øm
 |
	`SM
(
SYSTEM_SLEEP_DISABLE
, 1);

2394 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
∑øm
);

2395 i‡(
°©us
)

2396  
°©us
;

2398 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "old options: %d, old sleep: %d\n",

2399 
›ti⁄s
, 
¶ìp
);

2403 i‡(
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6004
 &&

2404 
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6006
) {

2405 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
ATH6KL_ANALOG_PLL_REGISTER
,

2408 i‡(
°©us
)

2409  
°©us
;

2412 
∑øm
 = 
	`SM
(
CPU_CLOCK_STANDARD
, 1);

2414 
addªss
 = 
RTC_BASE_ADDRESS
 + 
CPU_CLOCK_ADDRESS
;

2415 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
∑øm
);

2416 i‡(
°©us
)

2417  
°©us
;

2420 i‡(
¨
->
hw
.
Êags
 & 
ATH6KL_HW_XTAL_40MHZ
) {

2421 
∑øm
 = 40*1000*1000;

2422 
°©us
 = 
	`©h6kl_bmi_wrôe
(
¨
,

2423 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_ªf˛k_hz
)),

2424 (
u8
 *)&
∑øm
, 4);

2427 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
AT6HKL_MODULE_LPL_ENABLE
)) {

2428 
°©us
 = 
	`©h6kl_bmi_ªg_ªad
(
¨
,

2429 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2430 
	`HI_ITEM
(
hi_pwr_ßve_Êags
)),

2431 &
∑øm
);

2433 i‡(
°©us
) {

2434 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

2436  
°©us
;

2440 
∑øm
 = 
	`À32_to_˝u
(param);

2441 
∑øm
 |
HI_PWR_SAVE_LPL_ENABLED
 |

2442 (
HI_PWR_SAVE_LPL_MODE_RPL
<<
HI_PWR_SAVE_LPL_MODE_LSB
);

2443 
∑øm
 = 
	`˝u_to_À32
(param);

2445 
°©us
 = 
	`©h6kl_bmi_wrôe
(
¨
,

2446 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2447 
	`HI_ITEM
(
hi_pwr_ßve_Êags
)),

2448 (
u8
 *)&
∑øm
, (param));

2450 
	`WARN_ON
(
°©us
);

2451 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "attach LPL module\n");

2454 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_MIMO_PS_ENABLE
)) {

2455 
°©us
 = 
	`©h6kl_bmi_ªg_ªad
(
¨
,

2456 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2457 
	`HI_ITEM
(
hi_smps_›ti⁄s
)),

2458 &
∑øm
);

2460 i‡(
°©us
) {

2461 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

2463  
°©us
;

2467 
∑øm
 = 
	`À32_to_˝u
(param);

2468 
∑øm
 |
HI_SMPS_ALLOW_MASK
;

2469 
∑øm
 = 
	`˝u_to_À32
(param);

2471 
°©us
 = 
	`©h6kl_bmi_wrôe
(
¨
,

2472 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2473 
	`HI_ITEM
(
hi_smps_›ti⁄s
)),

2474 (
u8
 *)&
∑øm
, (param));

2476 
	`WARN_ON
(
°©us
);

2477 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "Enable MIMO PS support\n");

2480 i‡(
©h6kl_wow_ext
) {

2486 
∑øm
 = 0x80000000|(
©h6kl_wow_gpio
<<18);

2488 #ifde‡
CONFIG_ANDROID


2489 i‡(
	`machöe_is_≠q8064_dma
() ||

2490 
	`machöe_is_≠q8064_buñÀr
())

2491 
∑øm
 |= (1<<25);

2494 
°©us
 = 
	`©h6kl_bmi_wrôe
(
¨
,

2495 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2496 
	`HI_ITEM
(
hi_wow_ext_c⁄fig
)),

2497 (
u8
 *)&
∑øm
, 4);

2499 
	`WARN_ON
(
°©us
);

2500 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "Enable wowÉxtension with "

2501 "gpio#%d,Ö¨am: 0x%08x\n", 
©h6kl_wow_gpio
, 
∑øm
);

2505 #ifde‡
CE_SUPPORT


2506 i‡(
©h6kl_˚_Êags
 == 0x1) {

2507 i‡(
	`©h6kl_bmi_ªad
(
¨
,

2508 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2509 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

2510 (
u8
 *)&
∑øm
, 4) != 0) {

2511 
	`©h6kl_îr
("bmi_read_memory for setting fwmode failed\n");

2512  -
EIO
;

2514 
∑øm
 |
HI_OPTION_ENABLE_SB_SPECIFIC
;

2515 
°©us
 = 
	`©h6kl_bmi_wrôe
(
¨
,

2516 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2517 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

2518 (
u8
 *)&
∑øm
, 4);

2520 
	`WARN_ON
(
°©us
);

2521 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "Config customer flags with "

2522 "©h6kl_˚_Êags#%d,Ö¨am: 0x%08x\n", 
©h6kl_˚_Êags
, 
∑øm
);

2526 
∑øm
 = 0;

2527 
addªss
 = 
RTC_BASE_ADDRESS
 + 
LPO_CAL_ADDRESS
;

2528 
∑øm
 = 
	`SM
(
LPO_CAL_ENABLE
, 1);

2529 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
∑øm
);

2530 i‡(
°©us
)

2531  
°©us
;

2534 i‡(
¨
->
vîsi⁄
.
èrgë_vî
 =
AR6003_HW_2_0_VERSION
) {

2535 
	`©h6kl_îr
("temporary warÅoávoid sdio crcÉrror\n");

2537 
∑øm
 = 0x20;

2539 
addªss
 = 
GPIO_BASE_ADDRESS
 + 
GPIO_PIN10_ADDRESS
;

2540 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
∑øm
);

2541 i‡(
°©us
)

2542  
°©us
;

2544 
addªss
 = 
GPIO_BASE_ADDRESS
 + 
GPIO_PIN11_ADDRESS
;

2545 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
∑øm
);

2546 i‡(
°©us
)

2547  
°©us
;

2549 
addªss
 = 
GPIO_BASE_ADDRESS
 + 
GPIO_PIN12_ADDRESS
;

2550 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
∑øm
);

2551 i‡(
°©us
)

2552  
°©us
;

2554 
addªss
 = 
GPIO_BASE_ADDRESS
 + 
GPIO_PIN13_ADDRESS
;

2555 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
∑øm
);

2556 i‡(
°©us
)

2557  
°©us
;

2561 
°©us
 = 
	`©h6kl_u∂ﬂd_bﬂrd_fûe
(
¨
);

2562 i‡(
°©us
)

2563  
°©us
;

2566 
°©us
 = 
	`©h6kl_u∂ﬂd_Ÿp
(
¨
);

2567 i‡(
°©us
)

2568  
°©us
;

2571 
°©us
 = 
	`©h6kl_u∂ﬂd_fúmw¨e
(
¨
);

2572 i‡(
°©us
)

2573  
°©us
;

2575 
°©us
 = 
	`©h6kl_u∂ﬂd_∑tch
(
¨
);

2576 i‡(
°©us
)

2577  
°©us
;

2580 
°©us
 = 
	`©h6kl_u∂ﬂd_ã°s¸ùt
(
¨
);

2581 i‡(
°©us
)

2582  
°©us
;

2585 
addªss
 = 
RTC_BASE_ADDRESS
 + 
SYSTEM_SLEEP_ADDRESS
;

2586 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
¶ìp
);

2587 i‡(
°©us
)

2588  
°©us
;

2590 
addªss
 = 
MBOX_BASE_ADDRESS
 + 
LOCAL_SCRATCH_ADDRESS
;

2591 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULES_ANI_ENABLE
) ||

2592 ((
¨
->
vîsi⁄
.
èrgë_vî
 !
AR6004_HW_1_1_VERSION
) &&

2593 (
¨
->
vîsi⁄
.
èrgë_vî
 !
AR6004_HW_1_3_VERSION
) &&

2594 (
¨
->
vîsi⁄
.
èrgë_vî
 !
AR6004_HW_3_0_VERSION
))) {

2595 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "NO ANI\n");

2596 
∑øm
 = 
›ti⁄s
 | 0x20;

2598 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "ANI Enabled\n");

2599 
∑øm
 = 
›ti⁄s
;

2601 
°©us
 = 
	`©h6kl_bmi_ªg_wrôe
(
¨
, 
addªss
, 
∑øm
);

2602 i‡(
°©us
)

2603  
°©us
;

2606 i‡(
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6004
)

2607 
∑øm
 = 
CONFIG_AR6004_DEBUG_UART_TX_PIN
;

2608 i‡(
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6006
)

2609 
∑øm
 = 
CONFIG_AR6006_DEBUG_UART_TX_PIN
;

2611 
∑øm
 = 
CONFIG_AR600x_DEBUG_UART_TX_PIN
;

2613 
°©us
 = 
	`©h6kl_bmi_wrôe
(
¨
,

2614 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

2615 
	`HI_ITEM
(
hi_dbg_u¨t_txpö
)),

2616 (
u8
 *)&
∑øm
, 4);

2618  
°©us
;

2619 
	}
}

2621 
	$©h6kl_öô_hw_∑øms
(
©h6kl
 *
¨
)

2623 c⁄° 
©h6kl_hw
 *
hw
;

2624 
i
;

2626 
i
 = 0; i < 
	`ARRAY_SIZE
(
hw_li°
); i++) {

2627 
hw
 = &
hw_li°
[
i
];

2629 i‡(
hw
->
id
 =
¨
->
vîsi⁄
.
èrgë_vî
)

2633 i‡(
i
 =
	`ARRAY_SIZE
(
hw_li°
)) {

2634 
	`©h6kl_îr
("Unsupported hardware version: 0x%x\n",

2635 
¨
->
vîsi⁄
.
èrgë_vî
);

2636  -
EINVAL
;

2639 
¨
->
hw
 = *hw;

2641 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

2644 
¨
->
vîsi⁄
.
èrgë_vî
,ár->
èrgë_ty≥
,

2645 
¨
->
hw
.
d©a£t_∑tch_addr
,ár->hw.
≠p_lﬂd_addr
);

2646 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

2649 
¨
->
hw
.
≠p_°¨t_ovîride_addr
,ár->hw.
bﬂrd_ext_d©a_addr
,

2650 
¨
->
hw
.
ª£rved_øm_size
);

2653 
	}
}

2655 
	$©h6kl_ch™ge_hw_∑øms
(
©h6kl
 *
¨
)

2657 c⁄° 
©h6kl_hw
 *
hw
;

2658 
i
;

2661 i‡(
¨
->
vîsi⁄
.
èrgë_vî
 !
AR6004_HW_1_3_VERSION
 ||

2662 
¨
->
fw_Àn
 < 
AR6004_MAX_64K_FW_SIZE
) {

2666 
i
 = 0; i < 
	`ARRAY_SIZE
(
hw_li°
) - 1; i++) {

2667 
hw
 = &
hw_li°
[
i
];

2669 i‡(
hw
->
id
 =
¨
->
vîsi⁄
.
èrgë_vî
)

2673 i‡(
i
 =
	`ARRAY_SIZE
(
hw_li°
) - 1) {

2674 
	`©h6kl_îr
("Unsupported hardware version: 0x%x\n",

2675 
¨
->
vîsi⁄
.
èrgë_vî
);

2676  -
EINVAL
;

2679 
¨
->
hw
 = *(hw+1);

2682 
	}
}

2684 c⁄° *
	$©h6kl_öô_gë_hif_«me
(
©h6kl_hif_ty≥
 
ty≥
)

2686 
ty≥
) {

2687 
ATH6KL_HIF_TYPE_SDIO
:

2689 
ATH6KL_HIF_TYPE_USB
:

2693  
NULL
;

2694 
	}
}

2696 
	$__©h6kl_öô_hw_°¨t
(
©h6kl
 *
¨
)

2698 
timñe·
;

2699 
ªt
, 
i
;

2701 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "hw start\n");

2703 i‡(
ªcovîy_íabÀ_mode
 =
ATH6KL_RECOVERY_MODE_COLD
) {

2705 
	`©h6kl_öfo
("FirmwareÑecovery mode cold\n");

2707 
ªt
 = 
	`©h6kl_fw_w©chdog_íabÀ
(
¨
);

2708 i‡(
ªt
 != 0) {

2709 
	`©h6kl_îr
("FailedÉnable fw watchdog%d\n",

2710 
ªt
);

2711  
ªt
;

2714 
ªt
 = 
	`©h6kl_fw_¸ash_cﬁd_ª£t_íabÀ
(
¨
);

2715 i‡(
ªt
 != 0) {

2716 
	`©h6kl_îr
("FailedÉnable fw codeÑeset %d\n",

2717 
ªt
);

2718  
ªt
;

2722 i‡((
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_USB
) &&

2723 
	`©h6kl_hif_bus_c⁄fig
(
¨
)) {

2724 
	`£t_bô
(
USB_REMOTE_WKUP
, &
¨
->
Êag
);

2726 
	`˛ór_bô
(
USB_REMOTE_WKUP
, &
¨
->
Êag
);

2729 
ªt
 = 
	`©h6kl_hif_powî_⁄
(
¨
);

2730 i‡(
ªt
)

2731  
ªt
;

2733 
ªt
 = 
	`©h6kl_ch™ge_hw_∑øms
(
¨
);

2734 i‡(
ªt
) {

2735 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "change hwÖarams failed\n");

2736 
îr_powî_off
;

2739 
ªt
 = 
	`©h6kl_c⁄figuª_èrgë
(
¨
);

2740 i‡(
ªt
)

2741 
îr_powî_off
;

2743 
ªt
 = 
	`©h6kl_öô_u∂ﬂd
(
¨
);

2744 i‡(
ªt
)

2745 
îr_powî_off
;

2748 i‡(
ªg_domaö
 !
NULL_REG_CODE
) {

2749 
ªt
 = 
	`©h6kl_ªg_£t_rdcode
(
¨
, 
ªg_domaö
);

2750 i‡(
ªt
)

2751 
îr_powî_off
;

2756 i‡(
	`©h6kl_bmi_d⁄e
(
¨
)) {

2757 
ªt
 = -
EIO
;

2758 
îr_powî_off
;

2766 i‡(
	`©h6kl_htc_waô_èrgë
(
¨
->
htc_èrgë
)) {

2767 
ªt
 = -
EIO
;

2768 
îr_powî_off
;

2771 i‡(
	`©h6kl_öô_£rvi˚_ï
(
¨
)) {

2772 
ªt
 = -
EIO
;

2773 
îr_˛ónup_sˇâî
;

2777 
	`©h6kl_htc_¸edô_£tup
(
¨
->
htc_èrgë
, &¨->
¸edô_°©e_öfo
);

2780 
ªt
 = 
	`©h6kl_htc_°¨t
(
¨
->
htc_èrgë
);

2781 i‡(
ªt
) {

2783 
	`©h6kl_cookõ_˛ónup
(
¨
);

2784 
îr_˛ónup_sˇâî
;

2787 i‡(!
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

2789 
timñe·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

2790 
	`ã°_bô
(
WMI_READY
,

2791 &
¨
->
Êag
),

2792 
WMI_TIMEOUT
);

2794 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "firmware booted\n");

2797 i‡(
	`ã°_™d_˛ór_bô
(
FIRST_BOOT
, &
¨
->
Êag
)) {

2798 
	`©h6kl_öfo
("%s %s fw %s%s\n",

2799 
¨
->
hw
.
«me
,

2800 
	`©h6kl_öô_gë_hif_«me
(
¨
->
hif_ty≥
),

2801 
¨
->
wùhy
->
fw_vîsi⁄
,

2802 
	`ã°_bô
(
TESTMODE
, &
¨
->
Êag
) ?

2806 i‡(
¨
->
vîsi⁄
.
abi_vî
 !
ATH6KL_ABI_VERSION
) {

2807 
	`©h6kl_îr
("abi version mismatch: "

2809 
ATH6KL_ABI_VERSION
, 
¨
->
vîsi⁄
.
abi_vî
);

2810 
ªt
 = -
EIO
;

2811 
îr_htc_°›
;

2814 i‡(!
timñe·
 || 
	`sig«l_≥ndög
(
cuºít
)) {

2815 
	`©h6kl_îr
("wmi isÇotÑeady or wait "

2817 
ªt
 = -
EIO
;

2818 
îr_htc_°›
;

2821 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "%s: wmòi†ªady\n", 
__func__
);

2822 i‡(
	`ã°_bô
(
DOWNLOAD_FIRMWARE_EXT
, &
¨
->
Êag
)) {

2823 
ªt
 = 
	`©h6kl_u∂ﬂd_fúmw¨e_ext
(
¨
);

2824 i‡(
ªt
)

2825 
îr_htc_°›
;

2828 
	`πtm_öô
(
¨
);

2831 i‡((
	`©h6kl_£t_ho°_≠p_¨ó
(
¨
)) != 0)

2832 
	`©h6kl_îr
("unableÅo setÅhe hostáppárea\n");

2834 
i
 = 0; i < 
¨
->
vif_max
; i++) {

2835 
ªt
 = 
	`©h6kl_èrgë_c⁄fig_wœn_∑øms
(
¨
, 
i
);

2836 i‡(
ªt
)

2837 
îr_htc_°›
;

2840 i‡(
	`ã°_™d_˛ór_bô
(
FIRST_BOOT
, &
¨
->
Êag
)) {

2841 
	`©h6kl_öfo
("%s %s fw %s%s\n",

2842 
¨
->
hw
.
«me
,

2843 
	`©h6kl_öô_gë_hif_«me
(
¨
->
hif_ty≥
),

2844 
¨
->
wùhy
->
fw_vîsi⁄
,

2845 
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
) ?

2849 
¨
->
mac_addr
[0] = 0x00;

2850 
¨
->
mac_addr
[1] = 0x01;

2851 
¨
->
mac_addr
[2] = 0x02;

2852 
¨
->
mac_addr
[3] = 0x03;

2853 
¨
->
mac_addr
[4] = 0x04;

2854 
¨
->
mac_addr
[5] = 0x05;

2859 
îr_htc_°›
:

2860 
	`©h6kl_htc_°›
(
¨
->
htc_èrgë
);

2861 
îr_˛ónup_sˇâî
:

2862 
	`©h6kl_hif_˛ónup_sˇâî
(
¨
);

2863 
îr_powî_off
:

2864 
	`©h6kl_hif_powî_off
(
¨
);

2866  
ªt
;

2867 
	}
}

2869 
	$©h6kl_öô_hw_°¨t
(
©h6kl
 *
¨
)

2871 
îr
;

2873 
îr
 = 
	`__©h6kl_öô_hw_°¨t
(
¨
);

2874 i‡(
îr
)

2875  
îr
;

2876 
¨
->
°©e
 = 
ATH6KL_STATE_ON
;

2878 
	}
}

2881 
	$__©h6kl_öô_hw_°›
(
©h6kl
 *
¨
)

2883 
ªt
;

2885 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "hw stop\n");

2887 
	`©h6kl_htc_°›
(
¨
->
htc_èrgë
);

2889 
	`©h6kl_hif_°›
(
¨
);

2891 
	`©h6kl_bmi_ª£t
(
¨
);

2893 
ªt
 = 
	`©h6kl_hif_powî_off
(
¨
);

2894 i‡(
ªt
)

2895 
	`©h6kl_w¨n
("ÁûedÅÿpowî of‡hif: %d\n", 
ªt
);

2897 
	`πtm_‰ì
();

2899 
	}
}

2901 
	$©h6kl_öô_hw_°›
(
©h6kl
 *
¨
)

2903 
îr
;

2905 
îr
 = 
	`__©h6kl_öô_hw_°›
(
¨
);

2906 i‡(
îr
)

2907  
îr
;

2909 
¨
->
°©e
 = 
ATH6KL_STATE_OFF
;

2912 
	}
}

2914 
u32
 
	$©h6kl_öô_gë_subty≥
(
©h6kl
 *
¨
)

2917 
u32
 
subty≥
 = 
TARGET_SUBTYPE_HT20_1SS_SING_BAND
;

2918 
is_2ss
, 
is_duÆ_b™d
, 
is_ht40
;

2924 
is_2ss
 = 
is_duÆ_b™d
 = 0;

2925 
is_ht40
 = 1;

2926 i‡(
¨
->
fw_bﬂrd
) {

2927 i‡((
¨
->
fw_bﬂrd
[
BDATA_TXRXMASK_OFFSET
] & 0x03) == 0x03)

2928 
is_2ss
 = 1;

2929 i‡(
¨
->
fw_bﬂrd
[
BDATA_OPFLAGS_OFFSET
] & (1 << 0))

2930 
is_duÆ_b™d
 = 1;

2933 i‡(
¨
->
fw_bﬂrd
[
BDATA_OPFLAGS_OFFSET
] & (1 << 3))

2934 
is_ht40
 = 0;

2936 i‡(
is_ht40
)

2937 
subty≥
 |
TARGET_SUBTYPE_HT40
;

2938 i‡(
is_2ss
)

2939 
subty≥
 |
TARGET_SUBTYPE_2SS
;

2940 i‡(
is_duÆ_b™d
)

2941 
subty≥
 |
TARGET_SUBTYPE_DUAL
;

2943 
	`WARN_ON
(1);

2946 
	`©h6kl_öfo
("target's subtype is 0x%x, %s %s %s\n",

2947 
subty≥
,

2948 (
is_ht40
 ? "HT20/40" : "HT20-only"),

2949 (
is_2ss
 ? "2SS" : "1SS"),

2950 (
is_duÆ_b™d
 ? "Dual-band" : "Single-band"));

2952  
subty≥
;

2953 
	}
}

2955 
	$©h6kl_gë_boŸ°øp_mode
(
©h6kl
 *
¨
)

2957 
u32
 
addªss
 = 
WLAN_BOOTSTRAP_ADDRESS
;

2958 
u32
 
boŸ°øp
;

2961 i‡(
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6004
) {

2962 
¨
->
boŸ°øp_mode
 = 0;

2966 i‡(
	`©h6kl_düg_ªad32
(
¨
, 
addªss
, &
boŸ°øp
))

2967  -
EIO
;

2969 
	`©h6kl_öfo
("èrgë boŸ°øp: 0x%08x\n", 
boŸ°øp
);

2970 
¨
->
boŸ°øp_mode
 = 
boŸ°øp
;

2973 
	}
}

2975 
	$©h6kl_c‹e_öô
(
©h6kl
 *
¨
)

2977 
©h6kl_bmi_èrgë_öfo
 
èrg_öfo
;

2978 
√t_devi˚
 *
ndev
;

2979 
ªt
 = 0, 
i
;

2981 
¨
->
©h6kl_wq
 = 
	`¸óã_sögÀthªad_w‹kqueue
("ath6kl");

2982 i‡(!
¨
->
©h6kl_wq
)

2983  -
ENOMEM
;

2985 
ªt
 = 
	`©h6kl_bmi_öô
(
¨
);

2986 i‡(
ªt
)

2987 
îr_wq
;

2994 
ªt
 = 
	`©h6kl_hif_powî_⁄
(
¨
);

2995 i‡(
ªt
)

2996 
îr_bmi_˛ónup
;

2998 
ªt
 = 
	`©h6kl_bmi_gë_èrgë_öfo
(
¨
, &
èrg_öfo
);

2999 i‡(
ªt
)

3000 
îr_powî_off
;

3002 
¨
->
vîsi⁄
.
èrgë_vî
 = 
	`À32_to_˝u
(
èrg_öfo
.version);

3003 
¨
->
èrgë_ty≥
 = 
	`À32_to_˝u
(
èrg_öfo
.
ty≥
);

3004 
¨
->
wùhy
->
hw_vîsi⁄
 = 
	`À32_to_˝u
(
èrg_öfo
.
vîsi⁄
);

3006 i‡(
	`©h6kl_gë_ho°_≠p_¨ó
(
¨
) != 0) {

3007 
	`©h6kl_îr
("Firmwareálready uploaded,ÑesetÅarget\n");

3008 
	`©h6kl_ª£t_devi˚
(
¨
,ár->
èrgë_ty≥
, 
åue
,Årue);

3009 
ªt
 = -
EAGAIN
;

3010 
îr_powî_off
;

3013 i‡(
	`©h6kl_gë_boŸ°øp_mode
(
¨
) != 0) {

3014 
	`©h6kl_îr
("can't get bootstrap mode\n");

3015 
îr_powî_off
;

3018 
ªt
 = 
	`©h6kl_öô_hw_∑øms
(
¨
);

3019 i‡(
ªt
)

3020 
îr_powî_off
;

3022 
¨
->
htc_èrgë
 = 
	`©h6kl_htc_¸óã
(ar);

3024 i‡(!
¨
->
htc_èrgë
) {

3025 
ªt
 = -
ENOMEM
;

3026 
îr_powî_off
;

3029 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


3030 
¨
->
ktk_a˘ive
 = 
Ál£
;

3033 #ifde‡
ATH6KL_SUPPORT_WIFI_DISC


3034 
¨
->
disc_a˘ive
 = 
Ál£
;

3037 
¨
->
ã°mode
 =Åestmode;

3039 
¨
->
°¨vög_¥evíti⁄
 = starving_prevention;

3041 
ªt
 = 
	`©h6kl_„tch_fúmw¨es
(
¨
);

3042 i‡(
ªt
)

3043 
îr_htc_˛ónup
;

3045 
¨
->
èrgë_subty≥
 = 
	`©h6kl_öô_gë_subty≥
(ar);

3049 i‡(
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

3050 
	`©h6kl_öfo
("%s:ÉndpointÜoopback mode, "

3051 "ign‹êwmòöô!\n", 
__func__
);

3054 
	`£t_bô
(
WMI_ENABLED
, &
¨
->
Êag
);

3055 
¨
->
wmi
 = 
	`©h6kl_wmi_öô
(ar);

3056 i‡(!
¨
->
wmi
) {

3057 
	`©h6kl_îr
("failedÅo initialize wmi\n");

3058 
ªt
 = -
EIO
;

3059 
îr_htc_˛ónup
;

3062 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "%s: got wmi @ 0x%p.\n",

3063 
__func__
, 
¨
->
wmi
);

3066 i‡(
¨
->
rﬂm_mode
 =
ATH6KL_MODULEROAM_DEFAULT
) {

3068 i‡(
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_SDIO
)

3069 
¨
->
rﬂm_mode
 = 
ATH6KL_SDIO_DEFAULT_ROAM_MODE
;

3071 
¨
->
rﬂm_mode
 = 
ATH6KL_USB_DEFAULT_ROAM_MODE
;

3079 i‡(
©h6kl_ªgdb
 =
ATH6KL_REG_INTERNAL_REGDB
)

3080 
	`£t_bô
(
INTERNAL_REGDB
, &
¨
->
Êag
);

3081 i‡(
©h6kl_ªgdb
 =
ATH6KL_REG_CFG80211_REGDB
)

3082 
	`£t_bô
(
CFG80211_REGDB
, &
¨
->
Êag
);

3084 
ªt
 = 
	`©h6kl_ªgi°î_õì80211_hw
(
¨
);

3085 i‡(
ªt
)

3086 
îr_node_˛ónup
;

3088 
ªt
 = 
	`©h6kl_debug_öô
(
¨
);

3089 i‡(
ªt
) {

3090 
	`wùhy_uƒegi°î
(
¨
->
wùhy
);

3091 
îr_node_˛ónup
;

3094 
i
 = 0; i < 
¨
->
vif_max
; i++)

3095 
¨
->
avaû_idx_m≠
 |
	`BIT
(
i
);

3097 i‡(
¨
->
p2p_com∑t
)

3098 
¨
->
avaû_idx_m≠
 = 0x3;

3100 
	`π∆_lock
();

3101 i‡(
©h6kl_©h0_«me
 == 1) {

3103 
ndev
 = 
	`©h6kl_öãrÁ˚_add
(
¨
, "ath%d",

3104 
NL80211_IFTYPE_STATION
, 0,

3105 
INFRA_NETWORK
);

3108 
ndev
 = 
	`©h6kl_öãrÁ˚_add
(
¨
, "wlan%d",

3109 
NL80211_IFTYPE_STATION
, 0,

3110 
INFRA_NETWORK
);

3112 
	`π∆_u∆ock
();

3114 i‡(!
ndev
) {

3115 
	`©h6kl_îr
("FailedÅo instantiateáÇetwork device\n");

3116 
ªt
 = -
ENOMEM
;

3117 
	`wùhy_uƒegi°î
(
¨
->
wùhy
);

3118 
îr_debug_öô
;

3122 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "%s:Çame=%s dev=0x%p,ár=0x%p\n",

3123 
__func__
, 
ndev
->
«me
,Çdev, 
¨
);

3125 
i
 = 0; i < 
WMM_NUM_AC
; i++)

3126 
¨
->
ac_°ªam_a˘ive
[
i
] = 
Ál£
;

3129 
¨
->
ac_°ªam_¥i_m≠
[
WMM_AC_BK
] = 0;

3130 
¨
->
ac_°ªam_¥i_m≠
[
WMM_AC_BE
] = 1;

3131 
¨
->
ac_°ªam_¥i_m≠
[
WMM_AC_VI
] = 2;

3132 
¨
->
ac_°ªam_¥i_m≠
[
WMM_AC_VO
] = 3;

3135 
	`©h6kl_rx_ªfûl
(
¨
->
htc_èrgë
,ár->
˘æ_ï
);

3136 
	`©h6kl_rx_ªfûl
(
¨
->
htc_èrgë
,ár->
ac2ï_m≠
[
WMM_AC_BE
]);

3138 i‡(
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

3139 
	`©h6kl_öfo
("bypass wmi,ándÖostÑeceive buffer "

3141 
	`©h6kl_rx_ªfûl
(
¨
->
htc_èrgë
,ár->
ac2ï_m≠
[
WMM_AC_BK
]);

3142 
	`©h6kl_rx_ªfûl
(
¨
->
htc_èrgë
,ár->
ac2ï_m≠
[
WMM_AC_VI
]);

3143 
	`©h6kl_rx_ªfûl
(
¨
->
htc_èrgë
,ár->
ac2ï_m≠
[
WMM_AC_VO
]);

3147 
	`©h6kl_ªfûl_amsdu_rxbufs
(
¨
, 
ATH6KL_MAX_AMSDU_RX_BUFFERS
);

3149 
ªt
 = 
	`©h6kl_cookõ_öô
(
¨
);

3150 i‡(
ªt
)

3151 
îr_rxbuf_˛ónup
;

3153 
¨
->
c⁄f_Êags
 = 
ATH6KL_CONF_IGNORE_ERP_BARKER
 |

3154 
ATH6KL_CONF_ENABLE_11N
 | 
ATH6KL_CONF_ENABLE_TX_BURST
;

3156 
¨
->
p2p_Êow˘æ_˘x
 = 
	`©h6kl_p2p_Êow˘æ_c⁄n_li°_öô
(ar);

3157 i‡(
¨
->
p2p_mu…ich™_c⁄cuºít
)

3158 
¨
->
c⁄f_Êags
 |
ATH6KL_CONF_ENABLE_FLOWCTRL
;

3160 
	`©h6kl_öfo
("P2P flowctrl %s\n",

3161 
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_ENABLE_FLOWCTRL
 ?

3164 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_SUSPEND_CUTPOWER
))

3165 
¨
->
c⁄f_Êags
 |
ATH6KL_CONF_SUSPEND_CUTPOWER
;

3167 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_RX_AGGR_DROP
))

3168 
¨
->
c⁄f_Êags
 |
ATH6KL_CONF_DISABLE_RX_AGGR_DROP
;

3170 
	`©h6kl_öfo
("RXággregation drop %s\n",

3171 
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_DISABLE_RX_AGGR_DROP
 ?

3174 
¨
->
wùhy
->
Êags
 |
WIPHY_FLAG_HAVE_AP_SME
 |

3175 
WIPHY_FLAG_AP_PROBE_RESP_OFFLOAD
;

3177 
¨
->
wùhy
->
¥obe_ª•_ofÊﬂd
 =

3178 
NL80211_PROBE_RESP_OFFLOAD_SUPPORT_WPS
 |

3179 
NL80211_PROBE_RESP_OFFLOAD_SUPPORT_WPS2
 |

3180 
NL80211_PROBE_RESP_OFFLOAD_SUPPORT_P2P
 |

3181 
NL80211_PROBE_RESP_OFFLOAD_SUPPORT_80211U
;

3183 i‡(
	`ã°_bô
(
INTERNAL_REGDB
, &
¨
->
Êag
) ||

3184 
	`ã°_bô
(
CFG80211_REGDB
, &
¨
->
Êag
)) {

3186 i‡(
	`ã°_bô
(
INTERNAL_REGDB
, &
¨
->
Êag
))

3187 
¨
->
ªg_˘x
 = 
	`©h6kl_ªg_öô
(ar,

3188 
åue
,

3189 
Ál£
,

3190 
¨
->
p2p_ö_∑sv_ch™
);

3192 
¨
->
ªg_˘x
 = 
	`©h6kl_ªg_öô
(ar,

3193 
Ál£
,

3194 
åue
,

3195 
Ál£
);

3198 
¨
->
p2p_rc_öfo_˘x
 = 
	`©h6kl_p2p_rc_öô
(ar);

3200 
¨
->
ªg_˘x
 = 
	`©h6kl_ªg_öô
◊r, 
Ál£
, false, false);

3202 
	`£t_bô
(
FIRST_BOOT
, &
¨
->
Êag
);

3205 
¨
->
gªí_tx_∑øms
.
íabÀ
 = 
åue
;

3206 
¨
->
gªí_tx_∑øms
.
√xt_¥obe_cou¡
 =

3207 
ATH6KL_GTX_NEXT_PROBE_COUNT
;

3208 
¨
->
gªí_tx_∑øms
.
max_back_off
 =

3209 
ATH6KL_GTX_MAX_BACK_OFF
;

3210 
¨
->
gªí_tx_∑øms
.
mö_gtx_rssi
 =

3211 
ATH6KL_GTX_MIN_RSSI
;

3212 
¨
->
gªí_tx_∑øms
.
f‹˚_back_off
 =

3213 
ATH6KL_GTX_FORCE_BACKOFF
;

3216 
¨
->
dtim_ext
 = 1;

3218 
ªt
 = 
	`©h6kl_öô_hw_°¨t
(
¨
);

3219 i‡(
ªt
) {

3220 
	`©h6kl_îr
("FaûedÅÿ°¨àh¨dw¨e: %d\n", 
ªt
);

3221 
îr_rxbuf_˛ónup
;

3228 
	`mem˝y
(
ndev
->
dev_addr
, 
¨
->
mac_addr
, 
ETH_ALEN
);

3230 #ifde‡
ATH6KL_DIAGNOSTIC


3231 i‡(!
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
))

3232 
	`wifi_düg_öô
();

3235 #i‡ 
	`deföed
(
CONFIG_ANDROID
Ë|| deföed(
USB_AUTO_SUSPEND
)

3236 
ªt
 = 
	`©h6kl_™droid_íabÀ_wow_deÁu…
(
¨
);

3237 i‡(
ªt
 != 0)

3238 
îr_rxbuf_˛ónup
;

3241 #i‚de‡
CONFIG_ANDROID


3242 i‡((
¨
->
hif_ty≥
 =
ATH6KL_HIF_TYPE_SDIO
) &&

3243 (!
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)))

3244 i‡(
	`©h6kl_wmi_£t_mcc_¥ofûe_cmd
(
¨
->
wmi
,

3245 
WMI_MCC_PROFILE_STA50
 | 
WMI_MCC_CTS_ENABLE
))

3246 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "failedÅo set mccÖrofile");

3250 i‡(!
ªt
) {

3251 
	`öô_waôqueue_hód
(&
¨
->
öô_de„r_waô_wq
);

3252 
	`INIT_WORK
(&
¨
->
öô_de„r_wk
, 
©h6kl_c‹e_öô_de„r
);

3254 
	`£t_bô
(
INIT_DEFER_PROGRESS
, &
¨
->
Êag
);

3255 
	`scheduÀ_w‹k
(&
¨
->
öô_de„r_wk
);

3258 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
,

3259 
ATH6KL_MODULE_DISABLE_WAIT_DEFER
)) {

3260 
	`©h6kl_öfo
("Wait deferÅasks done...\n");

3261 
	`waô_evít_öãºu±ibÀ_timeout
(

3262 
¨
->
öô_de„r_waô_wq
,

3263 !
	`ã°_bô
(
INIT_DEFER_PROGRESS
, &
¨
->
Êag
),

3264 
INIT_DEFER_WAIT_TIMEOUT
);

3268 #ifde‡
CE_SUPPORT


3273 
©h6kl_vif
 *
vif_fú°
;

3274 
vif_fú°
 = 
	`©h6kl_vif_fú°
(
¨
);

3275 
u8
 
pwr_mode
;

3276 
pwr_mode
 = 
MAX_PERF_POWER
;

3277 i‡(
	`©h6kl_wmi_powîmode_cmd
(
¨
->
wmi
, 
vif_fú°
->
fw_vif_idx
,

3278 
pwr_mode
) != 0)

3279 
vif_fú°
->
wdev
.
ps
 = 
NL80211_PS_ENABLED
;

3281 
vif_fú°
->
wdev
.
ps
 = 
NL80211_PS_DISABLED
;

3284 i‡(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_ENABLE_FW_CRASH_NOTIFY
)) {

3285 
	`©h6kl_öfo
("Enable Firmware crashÇotiry.\n");

3286 
¨
->
fw_¸ash_nŸify
 = 
©h6kl_fw_¸ash_nŸify
;

3289 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_SKB_DUP
))

3290 
¨
->
c⁄f_Êags
 |
ATH6KL_CONF_SKB_DUP
;

3292 
	`©h6kl_öfo
(" skb copy disable\n");

3294  
ªt
;

3296 
îr_rxbuf_˛ónup
:

3297 
	`©h6kl_htc_Êush_rx_buf
(
¨
->
htc_èrgë
);

3298 
	`©h6kl_˛ónup_amsdu_rxbufs
(
¨
);

3299 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

3300 
	`li°_dñ
(&(((
©h6kl_vif
 *)(
	`√tdev_¥iv
(
ndev
)))->
li°
));

3301 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

3302 
	`π∆_lock
();

3303 
	`©h6kl_deöô_if_d©a
(
	`√tdev_¥iv
(
ndev
));

3304 
	`π∆_u∆ock
();

3305 
	`wùhy_uƒegi°î
(
¨
->
wùhy
);

3306 
îr_debug_öô
:

3307 
	`©h6kl_debug_˛ónup
(
¨
);

3308 
îr_node_˛ónup
:

3309 #ifde‡
CONFIG_ANDROID


3310 i‡(
¨
->
wow_úq
) {

3311 i‡(
	`dißbÀ_úq_wake
(
¨
->
wow_úq
))

3312 
	`©h6kl_îr
("Couldn't disable hostwake IRQ wakeup mode\n");

3314 
	`‰ì_úq
(
¨
->
wow_úq
,ár);

3315 
¨
->
wow_úq
 = 0;

3318 #ifde‡
CONFIG_HAS_WAKELOCK


3319 
	`wake_lock_de°roy
(&
¨
->
wake_lock
);

3322 
	`©h6kl_˛ónup_™droid_ªsour˚
(
¨
);

3324 
	`©h6kl_wmi_shutdown
(
¨
->
wmi
);

3325 
	`˛ór_bô
(
WMI_ENABLED
, &
¨
->
Êag
);

3326 
¨
->
wmi
 = 
NULL
;

3327 
îr_htc_˛ónup
:

3328 
	`©h6kl_htc_˛ónup
(
¨
->
htc_èrgë
);

3329 
îr_powî_off
:

3330 
	`©h6kl_hif_powî_off
(
¨
);

3331 
îr_bmi_˛ónup
:

3332 
	`©h6kl_bmi_˛ónup
(
¨
);

3333 
îr_wq
:

3334 
	`de°roy_w‹kqueue
(
¨
->
©h6kl_wq
);

3336  
ªt
;

3337 
	}
}

3339 
	$©h6kl_˛ónup_vif
(
©h6kl_vif
 *
vif
, 
boﬁ
 
wmi_ªady
)

3341 
u8
 
bˇ°_mac
[] = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff};

3342 
boﬁ
 
disc⁄_issued
;

3344 i‡(
vif
->
≥nd_skb
)

3345 
	`©h6kl_Êush_≥nd_skb
(
vif
);

3347 
	`√tif_°›_queue
(
vif
->
ndev
);

3349 
	`˛ór_bô
(
WLAN_ENABLED
, &
vif
->
Êags
);

3351 i‡(
wmi_ªady
) {

3352 
disc⁄_issued
 = 
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) ||

3353 
	`ã°_bô
(
CONNECT_PEND
, &
vif
->
Êags
);

3354 
	`©h6kl_disc⁄√˘
(
vif
);

3355 
	`dñ_timî
(&
vif
->
disc⁄√˘_timî
);

3357 i‡(
disc⁄_issued
)

3358 
	`©h6kl_disc⁄√˘_evít
(
vif
, 
DISCONNECT_CMD
,

3359 (
vif
->
nw_ty≥
 & 
AP_NETWORK
) ?

3360 
bˇ°_mac
 : 
vif
->
bssid
,

3361 0, 
NULL
, 0);

3364 i‡(
vif
->
sˇn_ªq
) {

3365 
	`dñ_timî
(&
vif
->
vifsˇn_timî
);

3366 
	`©h6kl_wmi_ab‹t_sˇn_cmd
(
vif
->
¨
->
wmi
, vif->
fw_vif_idx
);

3367 
	`cfg80211_sˇn_d⁄e
(
vif
->
sˇn_ªq
, 
åue
);

3368 
vif
->
sˇn_ªq
 = 
NULL
;

3369 
	`˛ór_bô
(
SCANNING
, &
vif
->
Êags
);

3371 
vif
->
d©a_cookõ_cou¡
 = 0;

3372 
	}
}

3374 
	$©h6kl_°›_txrx
(
©h6kl
 *
¨
)

3376 
©h6kl_vif
 *
vif
, *
tmp_vif
;

3378 
	`£t_bô
(
DESTROY_IN_PROGRESS
, &
¨
->
Êag
);

3380 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
)) {

3381 
	`©h6kl_îr
("down_interruptible failed\n");

3385 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

3386 
	`li°_f‹_óch_íåy_ß„
(
vif
, 
tmp_vif
, &
¨
->
vif_li°
, 
li°
) {

3387 
	`li°_dñ
(&
vif
->
li°
);

3388 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

3389 
	`©h6kl_˛ónup_vif
(
vif
, 
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
));

3390 
	`π∆_lock
();

3391 
	`©h6kl_deöô_if_d©a
(
vif
);

3392 
	`π∆_u∆ock
();

3393 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

3395 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

3397 
	`˛ór_bô
(
WMI_READY
, &
¨
->
Êag
);

3408 
	`©h6kl_wmi_shutdown
(
¨
->
wmi
);

3410 
	`˛ór_bô
(
WMI_ENABLED
, &
¨
->
Êag
);

3411 i‡(
¨
->
htc_èrgë
) {

3412 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "%s: shuàdow¿htc\n", 
__func__
);

3413 
	`©h6kl_htc_°›
(
¨
->
htc_èrgë
);

3420 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
,

3422 
	`©h6kl_ª£t_devi˚
(
¨
,ár->
èrgë_ty≥
, 
åue
,Årue);

3424 
	`up
(&
¨
->
£m
);

3425 
	}
}

	@main.c

17 
	~"c‹e.h
"

18 
	~"hif-›s.h
"

19 
	~"htc-›s.h
"

20 
	~"cfg80211.h
"

21 
	~"èrgë.h
"

22 
	~"debug.h
"

23 #ifde‡
ATHTST_SUPPORT


24 
	~"õì80211_io˘l.h
"

25 
	~"˚_©ht°.h
"

28 
	$_°rög_to_mac
(*
°rög
, 
Àn
, 
u8
 *
maˇddr
)

30 
i
, 
k
, 
ªt
;

31 
ãmp
[3] = {0};

32 
vÆue
;

35 i‡(!
°rög
 || (
Àn
 < 17))

39 
i
 = 
k
 = 0;

40 
i
 < 
Àn
) {

41 
	`mem˝y
(
ãmp
, 
°rög
 + 
i
, 2);

42 
ªt
 = 
	`k°πoul
(
ãmp
, 16, &
vÆue
);

43 i‡(
ªt
 < 0)

45 
maˇddr
[
k
++] = (
u8
)
vÆue
;

46 
i
 += 3;

50 
	}
}

52 
©h6kl_°a
 *
	$©h6kl_föd_°a
(
©h6kl_vif
 *
vif
, 
u8
 *
node_addr
)

54 
©h6kl_°a
 *
c⁄n
 = 
NULL
;

55 
u8
 
i
, 
max_c⁄n
;

57 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
)

58  &
vif
->
°a_li°
[0];

60 
max_c⁄n
 = (
vif
->
nw_ty≥
 =
AP_NETWORK
Ë? 
AP_MAX_NUM_STA
 : 0;

62 
i
 = 0; i < 
max_c⁄n
; i++) {

63 i‡(
	`memcmp
(
node_addr
, 
vif
->
°a_li°
[
i
].
mac
, 
ETH_ALEN
) == 0) {

64 
c⁄n
 = &
vif
->
°a_li°
[
i
];

69  
c⁄n
;

70 
	}
}

72 
©h6kl_°a
 *
	$©h6kl_föd_°a_by_aid
(
©h6kl_vif
 *
vif
, 
u8
 
aid
)

74 
©h6kl_°a
 *
c⁄n
 = 
NULL
;

75 
u8
 
˘r
;

77 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
) {

78 
c⁄n
 = &
vif
->
°a_li°
[0];

80 
˘r
 = 0; cå < 
AP_MAX_NUM_STA
; ctr++) {

81 i‡(
vif
->
°a_li°
[
˘r
].
aid
 ==áid) {

82 
c⁄n
 = &
vif
->
°a_li°
[
˘r
];

88  
c⁄n
;

89 
	}
}

91 
	$©h6kl_add_√w_°a
(
©h6kl_vif
 *
vif
, 
u8
 *
mac
, u8 
aid
,

92 
u8
 *
w∑õ
, u8 
õÀn
, u8 
keymgmt
, u8 
ucùhî
,

93 
u8
 
auth
, u8 
≠sd_öfo
, 
boﬁ
 
ht_suµ‹t
,

94 
u8
 
phymode
)

96 
©h6kl_°a
 *
°a
;

97 
u8
 
‰ì_¶Ÿ
;

99 
	`BUG_ON
(
aid
 > 
AP_MAX_NUM_STA
);

101 
‰ì_¶Ÿ
 = 
aid
 - 1;

103 
°a
 = &
vif
->
°a_li°
[
‰ì_¶Ÿ
];

105 
	`•ö_lock_bh
(&
°a
->
lock
);

106 
	`mem˝y
(
°a
->
mac
, mac, 
ETH_ALEN
);

107 
	`mem˝y
(
°a
->
w∑_õ
, 
w∑õ
, 
õÀn
);

108 
°a
->
aid
 =áid;

109 
°a
->
keymgmt
 = keymgmt;

110 
°a
->
ucùhî
 = ucipher;

111 
°a
->
auth
 =áuth;

112 
°a
->
≠sd_öfo
 =ápsd_info;

113 
°a
->
phymode
 =Öhymode;

114 
°a
->
vif
 = vif;

115 i‡(!
°a
->
psq_age_a˘ive
) {

116 
	`öô_timî
(&
°a
->
psq_age_timî
);

117 
°a
->
psq_age_timî
.
fun˘i⁄
 = 
©h6kl_ps_queue_age_h™dÀr
;

118 
°a
->
psq_age_timî
.
d©a
 = ()sta;

119 
°a
->
psq_age_a˘ive
 = 1;

121 
	`aggr_ª£t_°©e
(
°a
->
aggr_c⁄n_˙txt
);

122 
°a
->
œ°_txrx_time_tgt
 = 0;

123 
°a
->
œ°_txrx_time
 = 0;

125 
vif
->
°a_li°_ödex
 = vif->°a_li°_ödex | (1 << 
‰ì_¶Ÿ
);

126 
vif
->
≠_°©s
.
°a
[
‰ì_¶Ÿ
].
aid
 =áid;

128 i‡(
ht_suµ‹t
)

129 
°a
->
°a_Êags
 |
STA_HT_SUPPORT
;

131 
vif
->
°a_no_ht_num
++;

132 
	`•ö_u∆ock_bh
(&
°a
->
lock
);

133 
	}
}

135 
	$©h6kl_°a_˛ónup
(
©h6kl_vif
 *
vif
, 
u8
 
i
)

137 
©h6kl_°a
 *
°a
 = &
vif
->
°a_li°
[
i
];

138 
©h6kl
 *
¨
 = 
vif
->ar;

139 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

140 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

141 
li°_hód
 
c⁄èöî
;

142 
ª˛aim
 = 0, 
j
;

144 i‡(
°a
->
psq_age_a˘ive
) {

145 
	`dñ_timî_sync
(&
°a
->
psq_age_timî
);

146 
°a
->
psq_age_a˘ive
 = 0;

148 i‡(
p2p_Êow˘æ
 &&

149 
p2p_Êow˘æ
->
sche_ty≥
 =
P2P_FLOWCTRL_SCHE_TYPE_CONNECTION
) {

151 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

153 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

154 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[0];

155 
j
 = 0; j < 
NUM_CONN
; j++, 
fw_c⁄n
++) {

156 i‡(
fw_c⁄n
->
c⁄nId
 =
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
)

159 i‡(
	`memcmp
(
fw_c⁄n
->
mac_addr
,

160 
°a
->
mac
,

161 
ETH_ALEN
) == 0) {

163 
	`©h6kl_p2p_Êow˘æ_c⁄n_cﬁÀ˘_by_c⁄n
(

164 
fw_c⁄n
, &
c⁄èöî
, &
ª˛aim
);

169 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

170 
	`©h6kl_tx_com∂ëe
(
¨
->
htc_èrgë
, &
c⁄èöî
);

173 
	`•ö_lock_bh
(&
°a
->
lock
);

174 
°a
->
vif
 = 
NULL
;

177 
	`©h6kl_ps_queue_purge
(&
°a
->
psq_d©a
);

178 
	`©h6kl_ps_queue_purge
(&
°a
->
psq_mgmt
);

180 
	`mem£t
(&
vif
->
≠_°©s
.
°a
[°a->
aid
 - 1], 0,

181 (
wmi_≥r_°a_°©
));

182 
	`mem£t
(
°a
->
mac
, 0, 
ETH_ALEN
);

183 
	`mem£t
(
°a
->
w∑_õ
, 0, 
ATH6KL_MAX_IE
);

184 i‡(!(
°a
->
°a_Êags
 & 
STA_HT_SUPPORT
))

185 
vif
->
°a_no_ht_num
--;

186 
°a
->
aid
 = 0;

187 
°a
->
°a_Êags
 = 0;

188 
	`aggr_ª£t_°©e
(
°a
->
aggr_c⁄n_˙txt
);

190 
vif
->
°a_li°_ödex
 = vif->°a_li°_ödex & ~(1 << 
i
);

191 
	`•ö_u∆ock_bh
(&
°a
->
lock
);

192 
	}
}

194 
u8
 
	$©h6kl_ªmove_°a
(
©h6kl_vif
 *
vif
, 
u8
 *
mac
, 
u16
 
ªas⁄
)

196 
u8
 
i
, 
ªmoved
 = 0;

198 i‡(
	`is_zîo_ëhî_addr
(
mac
))

199  
ªmoved
;

201 i‡(
	`is_brﬂdˇ°_ëhî_addr
(
mac
)) {

202 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "deletingáll station\n");

204 
i
 = 0; i < 
AP_MAX_NUM_STA
; i++) {

205 i‡(!
	`is_zîo_ëhî_addr
(
vif
->
°a_li°
[
i
].
mac
)) {

206 
	`©h6kl_°a_˛ónup
(
vif
, 
i
);

207 
ªmoved
 = 1;

211 
i
 = 0; i < 
AP_MAX_NUM_STA
; i++) {

212 i‡(
	`memcmp
(
vif
->
°a_li°
[
i
].
mac
, mac, 
ETH_ALEN
) == 0) {

213 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
,

215 
mac
, 
vif
->
°a_li°
[
i
].
aid
, 
ªas⁄
);

216 
	`©h6kl_°a_˛ónup
(
vif
, 
i
);

217 
ªmoved
 = 1;

223  
ªmoved
;

224 
	}
}

226 
	$©h6kl_ps_queue_öô
(
©h6kl_ps_buf_hód
 *
psq
,

227 
ps_queue_ty≥
 
queue_ty≥
,

228 
u32
 
age_cy˛e
,

229 
u32
 
max_dïth
)

231 
	`INIT_LIST_HEAD
(&
psq
->
li°
);

232 
psq
->
queue_ty≥
 = queue_type;

233 
psq
->
age_cy˛e
 =áge_cycle;

234 
psq
->
max_dïth
 = max_depth;

236 
psq
->
dïth
 = 0;

237 
psq
->
íqueued
 = 0;

238 
psq
->
íqueued_îr
 = 0;

239 
psq
->
dequeued
 = 0;

240 
psq
->
aged
 = 0;

241 
	`•ö_lock_öô
(&
psq
->
lock
);

243 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

245 
psq
,

246 
psq
->
age_cy˛e
);

249 
	}
}

251 
	$©h6kl_ps_queue_purge
(
©h6kl_ps_buf_hód
 *
psq
)

253 
Êags
;

254 
©h6kl_ps_buf_desc
 *
ps_buf
, *
ps_buf_n
;

256 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

258 
psq
,

259 
psq
->
dïth
);

261 
	`WARN_ON
(
psq
->
dïth
 < 0);

263 
	`•ö_lock_úqßve
(&
psq
->
lock
, 
Êags
);

264 i‡(
psq
->
dïth
 == 0) {

265 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

268 
	`li°_f‹_óch_íåy_ß„
(
ps_buf
, 
ps_buf_n
, &
psq
->
li°
,Üist) {

269 
	`li°_dñ
(&
ps_buf
->
li°
);

270 i‡(
ps_buf
->
skb
)

271 
	`dev_k‰ì_skb
(
ps_buf
->
skb
);

272 
	`k‰ì
(
ps_buf
);

273 
psq
->
dïth
--;

274 
psq
->
dequeued
++;

277 
	`WARN_ON
(
psq
->
dïth
 != 0);

278 
	`WARN_ON
(
psq
->
íqueued
 !psq->
dequeued
);

281 
psq
->
dïth
 = 0;

282 
psq
->
íqueued
 = 0;

283 
psq
->
íqueued_îr
 = 0;

284 
psq
->
dequeued
 = 0;

285 
psq
->
aged
 = 0;

287 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

290 
	}
}

292 
	$©h6kl_ps_queue_em±y
(
©h6kl_ps_buf_hód
 *
psq
)

294 
Êags
;

295 
em±y
;

297 
	`WARN_ON
(
psq
->
dïth
 < 0);

299 
	`•ö_lock_úqßve
(&
psq
->
lock
, 
Êags
);

300 
em±y
 = (
psq
->
dïth
 == 0);

301 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

303  
em±y
;

304 
	}
}

306 
	$©h6kl_ps_queue_dïth
(
©h6kl_ps_buf_hód
 *
psq
)

308 
Êags
;

309 
dïth
;

311 
	`WARN_ON
(
psq
->
dïth
 < 0);

313 
	`•ö_lock_úqßve
(&
psq
->
lock
, 
Êags
);

314 
dïth
 = 
psq
->depth;

315 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

317  
dïth
;

318 
	}
}

320 
	$©h6kl_ps_queue_°©
(
©h6kl_ps_buf_hód
 *
psq
,

321 *
dïth
,

322 
u32
 *
íqueued
,

323 
u32
 *
íqueued_îr
,

324 
u32
 *
dequeued
,

325 
u32
 *
aged
)

327 
Êags
;

329 
	`•ö_lock_úqßve
(&
psq
->
lock
, 
Êags
);

330 *
dïth
 = 
psq
->depth;

331 *
íqueued
 = 
psq
->enqueued;

332 *
íqueued_îr
 = 
psq
->enqueued_err;

333 *
dequeued
 = 
psq
->dequeued;

334 *
aged
 = 
psq
->aged;

335 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

337 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

339 
psq
,

340 *
dïth
,

341 *
íqueued
,

342 *
íqueued_îr
,

343 *
dequeued
,

344 *
aged
);

347 
	}
}

349 
©h6kl_ps_buf_desc
 *
	$©h6kl_ps_queue_dequeue
(

350 
©h6kl_ps_buf_hód
 *
psq
)

352 
Êags
;

353 
©h6kl_ps_buf_desc
 *
ps_buf
;

355 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

357 
psq
,

358 
psq
->
dïth
);

360 
	`WARN_ON
(
psq
->
dïth
 < 0);

362 
	`•ö_lock_úqßve
(&
psq
->
lock
, 
Êags
);

363 i‡(
psq
->
dïth
 == 0) {

364 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

365  
NULL
;

368 
ps_buf
 = 
	`li°_fú°_íåy
(&
psq
->
li°
, 
©h6kl_ps_buf_desc
,Üist);

369 
	`li°_dñ
(&
ps_buf
->
li°
);

370 
psq
->
dïth
--;

371 
psq
->
dequeued
++;

372 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

374  
ps_buf
;

375 
	}
}

377 
	$©h6kl_ps_queue_íqueue_mgmt
(
©h6kl_ps_buf_hód
 *
psq
,

378 c⁄° 
u8
 *
buf
,

379 
u16
 
Àn
,

380 
u32
 
id
,

381 
u32
 
‰eq
,

382 
u32
 
waô
,

383 
boﬁ
 
no_cck
,

384 
boﬁ
 
d⁄t_waô_f‹_ack
)

386 
Êags
;

387 
©h6kl_ps_buf_desc
 *
ps_buf
;

388 
mgmt_buf_size
;

390 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

392 
psq
,

393 
psq
->
dïth
,

394 
buf
);

396 i‡((
psq
->
max_dïth
 !
ATH6KL_PS_QUEUE_NO_DEPTH
) &&

397 (
psq
->
dïth
 >Ösq->
max_dïth
)) {

398 
psq
->
íqueued_îr
++;

399  -
EBUSY
;

402 
mgmt_buf_size
 = 
Àn
 + (
©h6kl_ps_buf_desc
) - 1;

403 
ps_buf
 = 
	`kmÆloc
(
mgmt_buf_size
, 
GFP_ATOMIC
);

404 i‡(!
ps_buf
) {

405 
psq
->
íqueued_îr
++;

406  -
ENOMEM
;

409 
	`INIT_LIST_HEAD
(&
ps_buf
->
li°
);

410 
ps_buf
->
id
 = id;

411 
ps_buf
->
‰eq
 = freq;

412 
ps_buf
->
waô
 = wait;

413 
ps_buf
->
no_cck
 =Ço_cck;

414 
ps_buf
->
d⁄t_waô_f‹_ack
 = dont_wait_for_ack;

415 
ps_buf
->
Àn
 =Üen;

416 
ps_buf
->
age
 = 0;

417 
ps_buf
->
skb
 = 
NULL
;

418 
	`mem˝y
(
ps_buf
->
buf
, buf, 
Àn
);

420 
	`•ö_lock_úqßve
(&
psq
->
lock
, 
Êags
);

421 
	`li°_add_èû
(&
ps_buf
->
li°
, &
psq
->list);

422 
psq
->
dïth
++;

423 
psq
->
íqueued
++;

424 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

427 
	}
}

429 
	$©h6kl_ps_queue_íqueue_d©a
(
©h6kl_ps_buf_hód
 *
psq
,

430 
sk_buff
 *
skb
)

432 
Êags
;

433 
©h6kl_ps_buf_desc
 *
ps_buf
;

434 
d©a_buf_size
;

436 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

438 
psq
,

439 
psq
->
dïth
,

440 
skb
);

442 i‡((
psq
->
max_dïth
 !
ATH6KL_PS_QUEUE_NO_DEPTH
) &&

443 (
psq
->
dïth
 >Ösq->
max_dïth
)) {

444 
psq
->
íqueued_îr
++;

445  -
EBUSY
;

448 
d©a_buf_size
 = (
©h6kl_ps_buf_desc
);

449 
ps_buf
 = 
	`kmÆloc
(
d©a_buf_size
, 
GFP_ATOMIC
);

450 i‡(!
ps_buf
) {

451 
psq
->
íqueued_îr
++;

452  -
ENOMEM
;

454 
	`INIT_LIST_HEAD
(&
ps_buf
->
li°
);

455 
ps_buf
->
age
 = 0;

456 
ps_buf
->
skb
 = skb;

457 
ps_buf
->
Àn
 = 
skb
->len;

459 
	`•ö_lock_úqßve
(&
psq
->
lock
, 
Êags
);

460 
	`li°_add_èû
(&
ps_buf
->
li°
, &
psq
->list);

461 
psq
->
dïth
++;

462 
psq
->
íqueued
++;

463 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

466 
	}
}

468 
	$©h6kl_ps_queue_agög
(
©h6kl_ps_buf_hód
 *
psq
)

470 
©h6kl_ps_buf_desc
 *
ps_buf
, *
ps_buf_n
;

471 
Êags
;

472 
u32
 
age
;

473 
is_em±y
 = 1;

475 
	`•ö_lock_úqßve
(&
psq
->
lock
, 
Êags
);

476 i‡(
psq
->
dïth
 == 0) {

477 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

478  
is_em±y
;

480 
	`li°_f‹_óch_íåy_ß„
(
ps_buf
, 
ps_buf_n
, &
psq
->
li°
,Üist) {

481 
age
 = 
	`©h6kl_ps_queue_gë_age
(
ps_buf
);

482 
age
++;

483 i‡((
psq
->
age_cy˛e
 !
ATH6KL_PS_QUEUE_NO_AGE
) &&

484 (
age
 >
psq
->
age_cy˛e
)) {

485 
	`li°_dñ
(&
ps_buf
->
li°
);

486 i‡(
ps_buf
->
skb
)

487 
	`dev_k‰ì_skb
(
ps_buf
->
skb
);

488 
	`k‰ì
(
ps_buf
);

490 
psq
->
aged
++;

491 
psq
->
dequeued
++;

492 
psq
->
dïth
--;

494 
	`©h6kl_ps_queue_£t_age
(
ps_buf
, 
age
);

496 
is_em±y
 = (
psq
->
dïth
 == 0);

497 
	`•ö_u∆ock_úqª°‹e
(&
psq
->
lock
, 
Êags
);

499 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

501 
psq
,

502 
psq
->
dïth
,

503 
psq
->
aged
);

505  
is_em±y
;

506 
	}
}

508 
	$©h6kl_ps_queue_age_h™dÀr
(
±r
)

510 
©h6kl_°a
 *
c⁄n
 = (©h6kl_°®*)
±r
;

511 
©h6kl_vif
 *
vif
 = 
c⁄n
->vif;

513 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

514 i‡(
	`©h6kl_ps_queue_agög
(&
c⁄n
->
psq_d©a
) &&

515 
	`©h6kl_ps_queue_agög
(&
c⁄n
->
psq_mgmt
))

516 
	`©h6kl_wmi_£t_pvb_cmd
(
vif
->
¨
->
wmi
,

517 
vif
->
fw_vif_idx
, 
c⁄n
->
aid
, 0);

518 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

520 i‡(
c⁄n
->
psq_age_a˘ive
)

521 
	`mod_timî
(&
c⁄n
->
psq_age_timî
, 
jiffõs
 +

522 
	`m£cs_to_jiffõs
(
ATH6KL_PS_QUEUE_CHECK_AGE
));

525 
	}
}

527 
	$©h6kl_ps_queue_age_°¨t
(
©h6kl_°a
 *
c⁄n
)

529 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

531 
c⁄n
,

532 
c⁄n
->
aid
);

534 i‡(
c⁄n
->
psq_age_a˘ive
)

535 
	`mod_timî
(&
c⁄n
->
psq_age_timî
, 
jiffõs
 +

536 
	`m£cs_to_jiffõs
(
ATH6KL_PS_QUEUE_CHECK_AGE
));

539 
	}
}

541 
	$©h6kl_ps_queue_age_°›
(
©h6kl_°a
 *
c⁄n
)

543 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

545 
c⁄n
,

546 
c⁄n
->
aid
);

548 i‡(
c⁄n
->
psq_age_a˘ive
)

549 
	`dñ_timî_sync
(&
c⁄n
->
psq_age_timî
);

552 
	}
}

554 
bss_po°_¥oc
 *
	$©h6kl_bss_po°_¥oc_öô
(
©h6kl_vif
 *
vif
)

556 
bss_po°_¥oc
 *
po°_¥oc
;

558 
po°_¥oc
 = 
	`kzÆloc
((
bss_po°_¥oc
), 
GFP_KERNEL
);

559 i‡(!
po°_¥oc
) {

560 
	`©h6kl_îr
("failedÅoálloc memory forÖost_proc\n");

561  
NULL
;

564 
po°_¥oc
->
vif
 = vif;

565 
po°_¥oc
->
Êags
 = 0;

566 
	`•ö_lock_öô
(&
po°_¥oc
->
bss_öfo_lock
);

567 
	`INIT_LIST_HEAD
(&
po°_¥oc
->
bss_öfo_li°
);

569 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

571 
vif
->
fw_vif_idx
);

573  
po°_¥oc
;

574 
	}
}

576 
	$bss_¥oc_po°_Êush
(
bss_po°_¥oc
 *
po°_¥oc
)

578 
bss_öfo_íåy
 *
bss_öfo
, *
tmp
;

580 
	`•ö_lock
(&
po°_¥oc
->
bss_öfo_lock
);

582 
	`li°_f‹_óch_íåy_ß„
(
bss_öfo
,

583 
tmp
,

584 &
po°_¥oc
->
bss_öfo_li°
,

585 
li°
) {

586 
	`li°_dñ
(&
bss_öfo
->
li°
);

587 
	`k‰ì
(
bss_öfo
->
mgmt
);

588 
	`k‰ì
(
bss_öfo
);

591 
	`•ö_u∆ock
(&
po°_¥oc
->
bss_öfo_lock
);

594 
	}
}

596 
	$©h6kl_bss_po°_¥oc_deöô
(
©h6kl_vif
 *
vif
)

598 
bss_po°_¥oc
 *
po°_¥oc
 = 
vif
->
bss_po°_¥oc_˘x
;

600 i‡(
po°_¥oc
) {

601 
	`bss_¥oc_po°_Êush
(
po°_¥oc
);

603 
	`k‰ì
(
po°_¥oc
);

606 
vif
->
bss_po°_¥oc_˘x
 = 
NULL
;

608 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

610 
vif
->
fw_vif_idx
);

613 
	}
}

615 
	$©h6kl_bss_po°_¥oc_bss_sˇn_°¨t
(
©h6kl_vif
 *
vif
)

617 
bss_po°_¥oc
 *
po°_¥oc
 = 
vif
->
bss_po°_¥oc_˘x
;

619 i‡(!
po°_¥oc
)

623 
	`bss_¥oc_po°_Êush
(
po°_¥oc
);

624 
po°_¥oc
->
Êags
 |
ATH6KL_BSS_POST_PROC_SCAN_ONGOING
;

626 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

630 
	}
}

632 
	$©h6kl_bss_po°_¥oc_bss_com∂ëe_evít
(
©h6kl_vif
 *
vif
)

634 
bss_po°_¥oc
 *
po°_¥oc
 = 
vif
->
bss_po°_¥oc_˘x
;

635 
bss_öfo_íåy
 *
bss_öfo
, *
tmp
;

636 
cfg80211_bss
 *
bss
;

637 
˙t
 = 0;

639 i‡(!
po°_¥oc
)

642 
po°_¥oc
->
Êags
 &~
ATH6KL_BSS_POST_PROC_SCAN_ONGOING
;

644 
	`li°_f‹_óch_íåy_ß„
(
bss_öfo
,

645 
tmp
,

646 &
po°_¥oc
->
bss_öfo_li°
,

647 
li°
) {

648 
˙t
++;

649 
bss
 = 
	`cfg80211_öf‹m_bss_‰ame
(
vif
->
¨
->
wùhy
,

650 
bss_öfo
->
ch™√l
,

651 
bss_öfo
->
mgmt
,

652 
bss_öfo
->
Àn
,

653 
bss_öfo
->
sig«l
,

654 
GFP_ATOMIC
);

655 i‡(
bss
)

656 
	`©h6kl_bss_put
(
vif
->
¨
, 
bss
);

659 
	`bss_¥oc_po°_Êush
(
po°_¥oc
);

661 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

662 "bss_¥o¯sˇn_comp, c¡ %d\n", 
˙t
);

665 
	}
}

667 
	$©h6kl_bss_po°_¥oc_bss_öfo
(
©h6kl_vif
 *
vif
,

668 
õì80211_mgmt
 *
mgmt
,

669 
Àn
,

670 
s32
 
¢r
,

671 
õì80211_ch™√l
 *
ch™√l
)

673 
bss_po°_¥oc
 *
po°_¥oc
 = 
vif
->
bss_po°_¥oc_˘x
;

674 
bss_öfo_íåy
 *
bss_öfo
;

676 i‡(!
po°_¥oc
)

679 i‡(!(
po°_¥oc
->
Êags
 & 
ATH6KL_BSS_POST_PROC_SCAN_ONGOING
))

682 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
,

685 
vif
->
fw_vif_idx
,

686 
mgmt
->
bssid
[0], mgmt->bssid[1], mgmt->bssid[2],

687 
mgmt
->
bssid
[3], mgmt->bssid[4], mgmt->bssid[5],

688 
mgmt
->
‰ame_c⁄åﬁ
);

690 
bss_öfo
 = 
	`kzÆloc
((
bss_öfo_íåy
), 
GFP_KERNEL
);

691 i‡(!
bss_öfo
) {

692 
	`©h6kl_îr
("failedÅoálloc memory for bss_info\n");

696 
bss_öfo
->
mgmt
 = 
	`kmÆloc
(
Àn
, 
GFP_KERNEL
);

697 i‡(!
bss_öfo
->
mgmt
) {

698 
	`k‰ì
(
bss_öfo
);

699 
	`©h6kl_îr
("failedÅoálloc memory for bss_info->mgmt\n");

704 
bss_öfo
->
ch™√l
 = channel;

705 
bss_öfo
->
sig«l
 = 
¢r
;

706 
	`mem˝y
((
u8
 *)(
bss_öfo
->
mgmt
), (u8 *)mgmt, 
Àn
);

707 
bss_öfo
->
Àn
 =Üen;

709 
	`•ö_lock
(&
po°_¥oc
->
bss_öfo_lock
);

710 
	`li°_add_èû
(&
bss_öfo
->
li°
, &
po°_¥oc
->
bss_öfo_li°
);

711 
	`•ö_u∆ock
(&
po°_¥oc
->
bss_öfo_lock
);

715 
	}
}

717 
htc_ídpoöt_id
 
	$©h6kl_ac2_ídpoöt_id
(*
devt
, 
u8
 
ac
)

719 
©h6kl
 *
¨
 = 
devt
;

720  
¨
->
ac2ï_m≠
[
ac
];

721 
	}
}

723 
	$©h6kl_cookõ_poﬁ_öô
(
©h6kl
 *
¨
,

724 
©h6kl_cookõ_poﬁ
 *
cookõ_poﬁ
,

725 
cookõ_ty≥
 cookie_type,

726 
u32
 
cookõ_num
)

728 
u32
 
i
, 
j
, 
mem_size
;

730 
	`WARN_ON
(!
cookõ_num
);

732 
cookõ_poﬁ
->
cookõ_num
 = cookie_num;

733 
cookõ_poﬁ
->
cookõ_ty≥
 = cookie_type;

735 
cookõ_poﬁ
->
cookõ_li°
 = 
NULL
;

736 
cookõ_poﬁ
->
cookõ_cou¡
 = 0;

738 
mem_size
 = (
©h6kl_cookõ
Ë* 
cookõ_num
;

739 
cookõ_poﬁ
->
cookõ_mem
 = 
	`kzÆloc
(
mem_size
, 
GFP_ATOMIC
);

740 i‡(!
cookõ_poﬁ
->
cookõ_mem
) {

741 
	`©h6kl_îr
("unableÅoállocate cookie,Åype %dÇum %d\n",

742 
cookõ_ty≥
,

743 
cookõ_num
);

744  -
ENOMEM
;

747 
i
 = 0; i < 
cookõ_num
; i++) {

749 
cookõ_poﬁ
->
cookõ_mem
[
i
].cookie_pool = cookie_pool;

750 
cookõ_poﬁ
->
cookõ_mem
[
i
].
htc_pkt
 =

751 
	`kzÆloc
((
htc_∑ckë
), 
GFP_ATOMIC
);

752 i‡(
cookõ_poﬁ
->
cookõ_mem
[
i
].
htc_pkt
)

753 
	`©h6kl_‰ì_cookõ
(
¨
, &
cookõ_poﬁ
->
cookõ_mem
[
i
]);

755 
	`©h6kl_îr
("unableÅoállocate htc_pkt\n");

757 
j
 = 0 ; j < 
i
 ; j++)

758 
	`k‰ì
(
cookõ_poﬁ
->
cookõ_mem
[
j
].
htc_pkt
);

759 
	`k‰ì
(
cookõ_poﬁ
->
cookõ_mem
);

760  -
ENOMEM
;

765 
cookõ_poﬁ
->
cookõ_Æloc_˙t
 = 0;

766 
cookõ_poﬁ
->
cookõ_Æloc_Áû_˙t
 = 0;

767 
cookõ_poﬁ
->
cookõ_‰ì_˙t
 = 0;

768 
cookõ_poﬁ
->
cookõ_≥ak_˙t
 = 0;

770 
	`©h6kl_öfo
("Create HTC cookie,Åype %dÇum %d\n",

771 
cookõ_ty≥
,

772 
cookõ_num
);

774 
	}
}

776 
	$©h6kl_cookõ_poﬁ_˛ónup
(
©h6kl
 *
¨
,

777 
©h6kl_cookõ_poﬁ
 *
cookõ_poﬁ
)

779 
i
;

781 i‡(
cookõ_poﬁ
->
cookõ_num
 !cookõ_poﬁ->
cookõ_cou¡
)

782 
	`©h6kl_îr
("Cookie unmber unsync,Åype %dÇum %d, %d\n",

783 
cookõ_poﬁ
->
cookõ_ty≥
,

784 
cookõ_poﬁ
->
cookõ_num
,

785 
cookõ_poﬁ
->
cookõ_cou¡
);

787 
	`©h6kl_öfo
("Free HTC cookie,Åype %d curr_num %d\n",

788 
cookõ_poﬁ
->
cookõ_ty≥
,

789 
cookõ_poﬁ
->
cookõ_cou¡
);

791 
cookõ_poﬁ
->
cookõ_li°
 = 
NULL
;

792 
cookõ_poﬁ
->
cookõ_cou¡
 = 0;

794 
i
 = 0; i < 
cookõ_poﬁ
->
cookõ_num
; i++)

795 
	`k‰ì
(
cookõ_poﬁ
->
cookõ_mem
[
i
].
htc_pkt
);

797 
	`k‰ì
(
cookõ_poﬁ
->
cookõ_mem
);

798 
cookõ_poﬁ
->
cookõ_mem
 = 
NULL
;

800 
cookõ_poﬁ
->
cookõ_Æloc_˙t
 = 0;

801 
cookõ_poﬁ
->
cookõ_Æloc_Áû_˙t
 = 0;

802 
cookõ_poﬁ
->
cookõ_‰ì_˙t
 = 0;

803 
cookõ_poﬁ
->
cookõ_≥ak_˙t
 = 0;

806 
	}
}

808 
©h6kl_cookõ
 *
	$©h6kl_Æloc_cookõ
(
©h6kl
 *
¨
,

809 
cookõ_ty≥
 cookie_type)

811 
©h6kl_cookõ_poﬁ
 *
cookõ_poﬁ
;

812 
©h6kl_cookõ
 *
cookõ
;

813 
u32
 
Ælo˚d
;

815 i‡(
cookõ_ty≥
 =
COOKIE_TYPE_DATA
)

816 
cookõ_poﬁ
 = &
¨
->
cookõ_d©a
;

817 i‡(
cookõ_ty≥
 =
COOKIE_TYPE_CTRL
)

818 
cookõ_poﬁ
 = &
¨
->
cookõ_˘æ
;

820 
	`BUG_ON
(1);

822 
cookõ
 = 
cookõ_poﬁ
->
cookõ_li°
;

823 i‡(
cookõ
 !
NULL
) {

824 
cookõ_poﬁ
->
cookõ_li°
 = 
cookõ
->
¨c_li°_√xt
;

825 
cookõ_poﬁ
->
cookõ_cou¡
--;

827 
Ælo˚d
 = 
cookõ_poﬁ
->
cookõ_num
 - cookõ_poﬁ->
cookõ_cou¡
;

828 
cookõ_poﬁ
->
cookõ_Æloc_˙t
++;

829 i‡(
Ælo˚d
 > 
cookõ_poﬁ
->
cookõ_≥ak_˙t
)

830 
cookõ_poﬁ
->
cookõ_≥ak_˙t
 = 
Ælo˚d
;

832 
cookõ_poﬁ
->
cookõ_Æloc_Áû_˙t
++;

834  
cookõ
;

835 
	}
}

837 
	$©h6kl_cookõ_öô
(
©h6kl
 *
¨
)

840 i‡(
	`©h6kl_cookõ_poﬁ_öô
(
¨
,

841 &
¨
->
cookõ_d©a
,

842 
COOKIE_TYPE_DATA
,

843 
MAX_COOKIE_DATA_NUM
))

844 
Áû
;

847 i‡(
	`©h6kl_cookõ_poﬁ_öô
(
¨
,

848 &
¨
->
cookõ_˘æ
,

849 
COOKIE_TYPE_CTRL
,

850 
MAX_COOKIE_CTRL_NUM
))

851 
Áû
;

855 
Áû
:

856 
	`©h6kl_cookõ_˛ónup
(
¨
);

858  -
ENOMEM
;

859 
	}
}

861 
	$©h6kl_cookõ_˛ónup
(
©h6kl
 *
¨
)

863 
	`©h6kl_cookõ_poﬁ_˛ónup
(
¨
,

864 &
¨
->
cookõ_d©a
);

865 
	`©h6kl_cookõ_poﬁ_˛ónup
(
¨
,

866 &
¨
->
cookõ_˘æ
);

869 
	}
}

871 
	$©h6kl_‰ì_cookõ
(
©h6kl
 *
¨
, 
©h6kl_cookõ
 *
cookõ
)

873 
©h6kl_cookõ_poﬁ
 *
cookõ_poﬁ
;

875 i‡(!
¨
 || !
cookõ
)

878 
cookõ_poﬁ
 = 
cookõ
->cookie_pool;

879 
	`BUG_ON
(!
cookõ_poﬁ
);

881 
cookõ
->
¨c_li°_√xt
 = 
cookõ_poﬁ
->
cookõ_li°
;

882 
cookõ_poﬁ
->
cookõ_li°
 = 
cookõ
;

883 
cookõ_poﬁ
->
cookõ_cou¡
++;

885 
cookõ_poﬁ
->
cookõ_‰ì_˙t
++;

888 
	}
}

890 
	$©h6kl_düg_w¨m_ª£t
(
©h6kl
 *
¨
)

892 
ªt
;

894 
ªt
 = 
	`©h6kl_hif_düg_w¨m_ª£t
(
¨
);

896 i‡(
ªt
) {

897 
	`©h6kl_îr
("failedÅo issue warmÑeset command\n");

898  
ªt
;

902 
	}
}

908 
	$©h6kl_düg_ªad32
(
©h6kl
 *
¨
, 
u32
 
addªss
, u32 *
vÆue
)

910 
ªt
;

912 
ªt
 = 
	`©h6kl_hif_düg_ªad32
(
¨
, 
addªss
, 
vÆue
);

913 i‡(
ªt
) {

914 
	`©h6kl_w¨n
("failedÅoÑead32Åhrough diagnose window: %d\n",

915 
ªt
);

916  
ªt
;

920 
	}
}

926 
	$©h6kl_düg_wrôe32
(
©h6kl
 *
¨
, 
u32
 
addªss
, 
__À32
 
vÆue
)

928 
ªt
;

930 
ªt
 = 
	`©h6kl_hif_düg_wrôe32
(
¨
, 
addªss
, 
vÆue
);

932 i‡(
ªt
) {

933 
	`©h6kl_îr
("failedÅo write 0x%x during diagnose windowÅo 0x%d\n",

934 
addªss
, 
vÆue
);

935  
ªt
;

939 
	}
}

941 
	$©h6kl_düg_ªad
(
©h6kl
 *
¨
, 
u32
 
addªss
, *
d©a
, u32 
Àngth
)

943 
u32
 
cou¡
, *
buf
 = 
d©a
;

944 
ªt
;

946 i‡(
	`WARN_ON
(
Àngth
 % 4))

947  -
EINVAL
;

949 
cou¡
 = 0; cou¡ < 
Àngth
 / 4; cou¡++, 
addªss
 += 4) {

950 
ªt
 = 
	`©h6kl_düg_ªad32
(
¨
, 
addªss
, &
buf
[
cou¡
]);

951 i‡(
ªt
)

952  
ªt
;

956 
	}
}

958 
	$©h6kl_düg_wrôe
(
©h6kl
 *
¨
, 
u32
 
addªss
, *
d©a
, u32 
Àngth
)

960 
u32
 
cou¡
;

961 
__À32
 *
buf
 = 
d©a
;

962 
ªt
;

964 i‡(
	`WARN_ON
(
Àngth
 % 4))

965  -
EINVAL
;

967 
cou¡
 = 0; cou¡ < 
Àngth
 / 4; cou¡++, 
addªss
 += 4) {

968 
ªt
 = 
	`©h6kl_düg_wrôe32
(
¨
, 
addªss
, 
buf
[
cou¡
]);

969 i‡(
ªt
)

970  
ªt
;

974 
	}
}

976 
	$©h6kl_ªad_fwlogs
(
©h6kl
 *
¨
)

978 
©h6kl_dbglog_hdr
 
debug_hdr
;

979 
©h6kl_dbglog_buf
 
debug_buf
;

980 
u32
 
addªss
, 
Àngth
, 
dr›≥d
, 
fú°buf
, 
debug_hdr_addr
;

981 
ªt
 = 0, 
lo›
;

982 
u8
 *
buf
;

984 
buf
 = 
	`kmÆloc
(
ATH6KL_FWLOG_PAYLOAD_SIZE
, 
GFP_KERNEL
);

985 i‡(!
buf
)

986  -
ENOMEM
;

988 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
,

989 
	`©h6kl_gë_hi_ôem_addr
(
¨
,

990 
	`HI_ITEM
(
hi_dbglog_hdr
)));

992 
ªt
 = 
	`©h6kl_düg_ªad32
(
¨
, 
addªss
, &
debug_hdr_addr
);

993 i‡(
ªt
)

994 
out
;

997 i‡(
debug_hdr_addr
 == 0) {

998 
	`©h6kl_w¨n
("Invalidáddress for debug_hdr_addr\n");

999 
ªt
 = -
EINVAL
;

1000 
out
;

1003 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
, 
debug_hdr_addr
);

1004 
	`©h6kl_düg_ªad
(
¨
, 
addªss
, &
debug_hdr
, (debug_hdr));

1006 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
,

1007 
	`À32_to_˝u
(
debug_hdr
.
dbuf_addr
));

1008 
fú°buf
 = 
addªss
;

1009 
dr›≥d
 = 
	`À32_to_˝u
(
debug_hdr
.dropped);

1010 
	`©h6kl_düg_ªad
(
¨
, 
addªss
, &
debug_buf
, (debug_buf));

1012 
lo›
 = 100;

1015 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
,

1016 
	`À32_to_˝u
(
debug_buf
.
buf„r_addr
));

1017 
Àngth
 = 
	`À32_to_˝u
(
debug_buf
.length);

1019 i‡(
Àngth
 !0 && (
	`À32_to_˝u
(
debug_buf
.length) <=

1020 
	`À32_to_˝u
(
debug_buf
.
bufsize
))) {

1021 
Àngth
 = 
	`ALIGN
(length, 4);

1023 
ªt
 = 
	`©h6kl_düg_ªad
(
¨
, 
addªss
,

1024 
buf
, 
Àngth
);

1025 i‡(
ªt
)

1026 
out
;

1028 
	`©h6kl_debug_fwlog_evít
(
¨
, 
buf
, 
Àngth
);

1031 
addªss
 = 
	`TARG_VTOP
(
¨
->
èrgë_ty≥
,

1032 
	`À32_to_˝u
(
debug_buf
.
√xt
));

1033 
ªt
 = 
	`©h6kl_düg_ªad
(
¨
, 
addªss
, &
debug_buf
,

1034 (
debug_buf
));

1035 i‡(
ªt
)

1036 
out
;

1038 
lo›
--;

1040 i‡(
	`WARN_ON
(
lo›
 == 0)) {

1041 
ªt
 = -
ETIMEDOUT
;

1042 
out
;

1044 } 
addªss
 !
fú°buf
);

1046 
out
:

1047 
	`k‰ì
(
buf
);

1049  
ªt
;

1050 
	}
}

1053 
	#AR6003_RESET_CONTROL_ADDRESS
 0x00004000

	)

1054 
	#AR6004_RESET_CONTROL_ADDRESS
 0x00004000

	)

1055 
	#AR6006_RESET_CONTROL_ADDRESS
 0x00004000

	)

1057 
	$©h6kl_ª£t_devi˚
(
©h6kl
 *
¨
, 
u32
 
èrgë_ty≥
,

1058 
boﬁ
 
waô_fŸ_com∂ä
, boﬁ 
cﬁd_ª£t
)

1060 
°©us
 = 0;

1061 
u32
 
addªss
;

1062 
__À32
 
d©a
;

1064 i‡(
èrgë_ty≥
 !
TARGET_TYPE_AR6003
 &&

1065 
èrgë_ty≥
 !
TARGET_TYPE_AR6004
 &&

1066 
èrgë_ty≥
 !
TARGET_TYPE_AR6006
)

1069 
d©a
 = 
cﬁd_ª£t
 ? 
	`˝u_to_À32
(
RESET_CONTROL_COLD_RST
) :

1070 
	`˝u_to_À32
(
RESET_CONTROL_MBOX_RST
);

1072 
èrgë_ty≥
) {

1073 
TARGET_TYPE_AR6004
:

1074 
addªss
 = 
AR6004_RESET_CONTROL_ADDRESS
;

1076 
TARGET_TYPE_AR6006
:

1077 
addªss
 = 
AR6006_RESET_CONTROL_ADDRESS
;

1080 
addªss
 = 
AR6003_RESET_CONTROL_ADDRESS
;

1085 i‡(
	`BOOTSTRAP_IS_HSIC
(
¨
->
boŸ°øp_mode
)) {

1086 
°©us
 = 
	`©h6kl_düg_w¨m_ª£t
(
¨
);

1087 
	`©h6kl_öfo
("%s: w¨mÑe£t\n", 
__func__
);

1089 
°©us
 = 
	`©h6kl_düg_wrôe32
(
¨
, 
addªss
, 
d©a
);

1092 i‡(
°©us
)

1093 
	`©h6kl_îr
("failedÅoÑesetÅarget\n");

1094 
	}
}

1096 
	$©h6kl_fw_¸ash_nŸify
(
©h6kl
 *
¨
)

1098 
©h6kl_vif
 *
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

1100 
	`BUG_ON
(!
vif
);

1102 
	`©h6kl_öfo
("nŸify fúmw¨ê¸ashÅÿu£∏%p\n", 
¨
);

1105 #ifde‡
ATH6KL_HSIC_RECOVER


1106 i‡(
	`BOOTSTRAP_IS_HSIC
(
¨
->
boŸ°øp_mode
))

1107 
	`©h6kl_hif_sw_ªcovî
(
¨
);

1111 
	}
}

1113 
	$©h6kl_fw_w©chdog_íabÀ
(
©h6kl
 *
¨
)

1115 
u32
 
∑øm
;

1116 
ªt
;

1118 
ªt
 = 
	`©h6kl_düg_ªad32
(
¨
,

1119 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1120 (
u32
 *)&
∑øm
);

1122 i‡(
ªt
 != 0)

1123  
ªt
;

1125 
∑øm
 |
HI_OPTION_FW_WATCHDOG_ENABLE
;

1127 
ªt
 = 
	`©h6kl_düg_wrôe32
(
¨
,

1128 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1129 
∑øm
);

1131  
ªt
;

1132 
	}
}

1134 
	$©h6kl_fw_¸ash_cﬁd_ª£t_íabÀ
(
©h6kl
 *
¨
)

1136 
u32
 
∑øm
;

1137 
ªt
;

1139 
ªt
 = 
	`©h6kl_düg_ªad32
(
¨
,

1140 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1141 (
u32
 *)&
∑øm
);

1143 i‡(
ªt
 != 0)

1144  
ªt
;

1146 
∑øm
 |
HI_OPTION_FW_CRASH_COLD_RESET
;

1148 
ªt
 = 
	`©h6kl_düg_wrôe32
(
¨
,

1149 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_›ti⁄_Êag2
)),

1150 
∑øm
);

1152  
ªt
;

1153 
	}
}

1155 
	$©h6kl_ö°Æl_°©ic_wï_keys
(
©h6kl_vif
 *
vif
)

1157 
u8
 
ödex
;

1158 
u8
 
keyußge
;

1160 
ödex
 = 
WMI_MIN_KEY_INDEX
; index <
WMI_MAX_KEY_INDEX
; index++) {

1161 i‡(
vif
->
wï_key_li°
[
ödex
].
key_Àn
) {

1162 
keyußge
 = 
GROUP_USAGE
;

1163 i‡(
ödex
 =
vif
->
def_txkey_ödex
)

1164 
keyußge
 |
TX_USAGE
;

1166 
	`©h6kl_wmi_addkey_cmd
(
vif
->
¨
->
wmi
, vif->
fw_vif_idx
,

1167 
ödex
,

1168 
WEP_CRYPT
,

1169 
keyußge
,

1170 
vif
->
wï_key_li°
[
ödex
].
key_Àn
,

1171 
NULL
, 0,

1172 
vif
->
wï_key_li°
[
ödex
].
key
,

1173 
KEY_OP_INIT_VAL
, 
NULL
,

1174 
NO_SYNC_WMIFLAG
);

1177 
	}
}

1179 
	$©h6kl_c⁄√˘_≠_mode_bss
(
©h6kl_vif
 *
vif
, 
u16
 
ch™√l
,

1180 
u8
 *
bóc⁄
, u8 
bóc⁄_Àn
)

1182 
©h6kl
 *
¨
 = 
vif
->ar;

1183 
©h6kl_ªq_key
 *
ik
;

1184 
ªs
;

1185 
u8
 
key_rsc
[
ATH6KL_KEY_SEQ_LEN
];

1187 
ik
 = &
vif
->
≠_mode_bkey
;

1189 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "AP modê°¨ãd o¿%u MHz\n", 
ch™√l
);

1191 
vif
->
bss_ch
 = 
ch™√l
;

1192 
	`©h6kl_≠_bóc⁄_öfo
(
vif
, 
bóc⁄
, 
bóc⁄_Àn
);

1194 
vif
->
auth_mode
) {

1195 
NONE_AUTH
:

1196 i‡(
vif
->
¥wi£_¸y±o
 =
WEP_CRYPT
)

1197 
	`©h6kl_ö°Æl_°©ic_wï_keys
(
vif
);

1199 
WPA_PSK_AUTH
:

1200 
WPA2_PSK_AUTH
:

1201 (
WPA_PSK_AUTH
 | 
WPA2_PSK_AUTH
):

1202 i‡(!
ik
->
vÆid
)

1205 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "Delayedáddkey for "

1207 
	`mem£t
(
key_rsc
, 0, (key_rsc));

1208 
ªs
 = 
	`©h6kl_wmi_addkey_cmd
(

1209 
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
ik
->
key_ödex
, ik->
key_ty≥
,

1210 
GROUP_USAGE
, 
ik
->
key_Àn
, 
key_rsc
, 
ATH6KL_KEY_SEQ_LEN
,

1211 
ik
->
key
,

1212 
KEY_OP_INIT_VAL
, 
NULL
, 
SYNC_BOTH_WMIFLAG
);

1213 i‡(
ªs
) {

1214 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "Delayed "

1215 "addkey faûed: %d\n", 
ªs
);

1220 
	`©h6kl_wmi_bssfûãr_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
NONE_BSS_FILTER
, 0);

1222 
	`£t_bô
(
CONNECTED
, &
vif
->
Êags
);

1223 
	`©h6kl_judge_rﬂm_∑ømëî
(
vif
, 
Ál£
);

1224 i‡(
	`©h6kl_wmi_£t_øã_˘æ_cmd
(
¨
->
wmi
,

1225 
vif
->
fw_vif_idx
, 
RATECTRL_MODE_PERONLY
))

1226 
	`©h6kl_îr
("setÑate_ctrl failed\n");

1227 
	`©h6kl_swôch_∑ømëî_ba£d_⁄_c⁄√˘i⁄
(
vif
, 
Ál£
);

1228 
	`√tif_ˇºõr_⁄
(
vif
->
ndev
);

1229 
	}
}

1231 
	$©h6kl_c⁄√˘_≠_mode_°a
(
©h6kl_vif
 *
vif
, 
u8
 
aid
, u8 *
mac_addr
,

1232 
u8
 
keymgmt
, u8 
ucùhî
, u8 
auth
,

1233 
u16
 
assoc_ªq_Àn
, 
u8
 *
assoc_öfo
,

1234 
u8
 
≠sd_öfo
, u8 
phymode
)

1236 
u8
 *
õs
 = 
NULL
, *
w∑_õ
 = NULL, *
pos
;

1237 
size_t
 
õs_Àn
 = 0;

1238 
°©i⁄_öfo
 
söfo
;

1239 
boﬁ
 
is_ht_°a
 = 
Ál£
;

1241 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "√w sèti⁄ %pMáid=%d\n", 
mac_addr
, 
aid
);

1243 i‡(
assoc_ªq_Àn
 > (
õì80211_hdr_3addr
)) {

1244 
õì80211_mgmt
 *
mgmt
 =

1245 (
õì80211_mgmt
 *Ë
assoc_öfo
;

1246 i‡(
	`õì80211_is_assoc_ªq
(
mgmt
->
‰ame_c⁄åﬁ
) &&

1247 
assoc_ªq_Àn
 >(
õì80211_hdr_3addr
) +

1248 (
mgmt
->
u
.
assoc_ªq
)) {

1249 
õs
 = 
mgmt
->
u
.
assoc_ªq
.
v¨übÀ
;

1250 
õs_Àn
 = 
assoc_öfo
 + 
assoc_ªq_Àn
 - 
õs
;

1251 } i‡(
	`õì80211_is_ªassoc_ªq
(
mgmt
->
‰ame_c⁄åﬁ
) &&

1252 
assoc_ªq_Àn
 >(
õì80211_hdr_3addr
)

1253 + (
mgmt
->
u
.
ªassoc_ªq
)) {

1254 
õs
 = 
mgmt
->
u
.
ªassoc_ªq
.
v¨übÀ
;

1255 
õs_Àn
 = 
assoc_öfo
 + 
assoc_ªq_Àn
 - 
õs
;

1259 
pos
 = 
õs
;

1260 
pos
 &&Öo†+ 1 < 
õs
 + 
õs_Àn
) {

1261 i‡(
pos
 + 2 +Öos[1] > 
õs
 + 
õs_Àn
)

1263 i‡(
pos
[0] =
WLAN_EID_RSN
)

1264 
w∑_õ
 = 
pos
;

1265 i‡(
pos
[0] =
WLAN_EID_VENDOR_SPECIFIC
 &&

1266 
pos
[1] >= 4 &&

1267 
pos
[2] == 0x00 &&Öos[3] == 0x50 &&Öos[4] == 0xf2) {

1268 i‡(
pos
[5] == 0x01)

1269 
w∑_õ
 = 
pos
;

1270 i‡(
pos
[5] == 0x04) {

1271 
w∑_õ
 = 
pos
;

1274 } i‡(
pos
[0] =
WLAN_EID_HT_CAPABILITY
 &&

1275 
pos
[1] >= 22)

1276 
is_ht_°a
 = 
åue
;

1277 i‡(
pos
[0] =0x44 && 
w∑_õ
 =
NULL
) {

1287 
w∑_õ
 = 
pos
;

1290 
pos
 += 2 +Öos[1];

1293 
	`©h6kl_add_√w_°a
(
vif
, 
mac_addr
, 
aid
, 
w∑_õ
,

1294 
w∑_õ
 ? 2 + wpa_ie[1] : 0,

1295 
keymgmt
, 
ucùhî
, 
auth
, 
≠sd_öfo
,

1296 
is_ht_°a
, 
phymode
);

1299 
	`mem£t
(&
söfo
, 0, (sinfo));

1303 
söfo
.
assoc_ªq_õs
 = 
õs
;

1304 
söfo
.
assoc_ªq_õs_Àn
 = 
õs_Àn
;

1305 
söfo
.
fûÀd
 |
STATION_INFO_ASSOC_REQ_IES
;

1307 
	`cfg80211_√w_°a
(
vif
->
ndev
, 
mac_addr
, &
söfo
, 
GFP_KERNEL
);

1309 
	`√tif_wake_queue
(
vif
->
ndev
);

1310 
	}
}

1312 
	$disc⁄√˘_timî_h™dÀr
(
±r
)

1314 
√t_devi˚
 *
dev
 = (√t_devi˚ *)
±r
;

1315 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

1317 
	`©h6kl_öô_¥ofûe_öfo
(
vif
);

1318 
	`©h6kl_disc⁄√˘
(
vif
);

1319 
	}
}

1321 
	$©h6kl_disc⁄√˘
(
©h6kl_vif
 *
vif
)

1323 
ªt
 = 0;

1325 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) ||

1326 
	`ã°_bô
(
CONNECT_PEND
, &
vif
->
Êags
)) {

1327 
ªt
 = 
	`©h6kl_wmi_disc⁄√˘_cmd
(
vif
->
¨
->
wmi
, vif->
fw_vif_idx
);

1333 
	`˛ór_bô
(
CONNECT_PEND
, &
vif
->
Êags
);

1336  
ªt
;

1337 
	}
}

1341 
	$©h6kl_ªady_evít
(*
devt
, 
u8
 *
d©≠
, 
u32
 
sw_vî
, u32 
abi_vî
)

1343 
©h6kl
 *
¨
 = 
devt
;

1345 
	`mem˝y
(
¨
->
mac_addr
, 
d©≠
, 
ETH_ALEN
);

1346 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "%s: macáddr = %pM\n",

1347 
__func__
, 
¨
->
mac_addr
);

1349 
¨
->
vîsi⁄
.
wœn_vî
 = 
sw_vî
;

1350 
¨
->
vîsi⁄
.
abi_vî
 =ábi_ver;

1352 
	`¢¥ötf
(
¨
->
wùhy
->
fw_vîsi⁄
,

1353 (
¨
->
wùhy
->
fw_vîsi⁄
),

1355 (
¨
->
vîsi⁄
.
wœn_vî
 & 0xf0000000) >> 28,

1356 (
¨
->
vîsi⁄
.
wœn_vî
 & 0x0f000000) >> 24,

1357 (
¨
->
vîsi⁄
.
wœn_vî
 & 0x00ff0000) >> 16,

1358 (
¨
->
vîsi⁄
.
wœn_vî
 & 0x0000ffff));

1360 #ifde‡
ATH6KL_HSIC_RECOVER


1361 
	`mem˝y
(
ˇched_mac
, 
¨
->
mac_addr
, 
ETH_ALEN
);

1362 
ˇched_mac_vÆid
 = 
åue
;

1366 
	`£t_bô
(
WMI_READY
, &
¨
->
Êag
);

1367 
	`wake_up
(&
¨
->
evít_wq
);

1368 
	}
}

1370 
	$©h6kl_sˇn_com∂ëe_evt
(
©h6kl_vif
 *
vif
, 
°©us
)

1372 
©h6kl
 *
¨
 = 
vif
->ar;

1373 
boﬁ
 
ab‹ãd
 = 
Ál£
;

1375 i‡(
°©us
 !
WMI_SCAN_STATUS_SUCCESS
)

1376 
ab‹ãd
 = 
åue
;

1377 #ifde‡
ACS_SUPPORT


1379 
	`©h6kl_acs_sˇn_com∂ëe_evít
(
vif
, 
ab‹ãd
);

1382 
	`©h6kl_bss_po°_¥oc_bss_com∂ëe_evít
(
vif
);

1383 
	`©h6kl_p2p_rc_sˇn_com∂ëe_evít
(
vif
, 
ab‹ãd
);

1385 i‡(
	`©h6kl_htc€x_sˇn_com∂ëe_evít
(
vif
, 
ab‹ãd
) ==

1386 
HTCOEX_PASS_SCAN_DONE
)

1387 
	`©h6kl_cfg80211_sˇn_com∂ëe_evít
(
vif
, 
ab‹ãd
);

1389 i‡(!
vif
->
u§_bss_fûãr
) {

1390 
	`˛ór_bô
(
CLEAR_BSSFILTER_ON_BEACON
, &
vif
->
Êags
);

1391 
	`©h6kl_wmi_bssfûãr_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1392 
NONE_BSS_FILTER
, 0);

1395 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
 | 
ATH6KL_DBG_EXT_INFO1
, "scan complete: %d\n",

1396 
°©us
);

1397 
	}
}

1399 
	$©h6kl_c⁄√˘_evít
(
©h6kl_vif
 *
vif
, 
u16
 
ch™√l
, 
u8
 *
bssid
,

1400 
u16
 
li°í_öt
, u16 
bóc⁄_öt
,

1401 
√tw‹k_ty≥
 
√t_ty≥
, 
u8
 
bóc⁄_õ_Àn
,

1402 
u8
 
assoc_ªq_Àn
, u8 
assoc_ª•_Àn
,

1403 
u8
 *
assoc_öfo
)

1405 
©h6kl
 *
¨
 = 
vif
->ar;

1407 
	`©h6kl_cfg80211_c⁄√˘_evít
(
vif
, 
ch™√l
, 
bssid
,

1408 
li°í_öt
, 
bóc⁄_öt
,

1409 
√t_ty≥
, 
bóc⁄_õ_Àn
,

1410 
assoc_ªq_Àn
, 
assoc_ª•_Àn
,

1411 
assoc_öfo
);

1413 
	`mem˝y
(
vif
->
bssid
, bssid, (vif->bssid));

1414 
vif
->
bss_ch
 = 
ch™√l
;

1416 i‡((
vif
->
nw_ty≥
 =
INFRA_NETWORK
)) {

1417 i‡(
¨
->
wùhy
->
Êags
 & 
WIPHY_FLAG_SUPPORTS_FW_ROAM
 &&

1418 
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_STATION
) {

1419 
	`©h6kl_wmi_dis˘imeout_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1420 
ATH6KL_SEAMLESS_ROAMING_DISCONNECT_TIMEOUT
);

1422 #ifde‡
CE_SUPPORT


1423 
	`©h6kl_wmi_dis˘imeout_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1426 
	`©h6kl_wmi_dis˘imeout_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1427 
ATH6KL_DISCONNECT_TIMEOUT
);

1430 
	`©h6kl_wmi_li°íöãrvÆ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1431 
¨
->
li°í_ötvl_t
,

1432 
¨
->
li°í_ötvl_b
);

1435 
	`√tif_wake_queue
(
vif
->
ndev
);

1438 
	`•ö_lock_bh
(&
vif
->
if_lock
);

1439 
	`£t_bô
(
CONNECTED
, &
vif
->
Êags
);

1440 
	`˛ór_bô
(
CONNECT_PEND
, &
vif
->
Êags
);

1441 
	`√tif_ˇºõr_⁄
(
vif
->
ndev
);

1442 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

1444 
	`aggr_ª£t_°©e
(
vif
->
°a_li°
[0].
aggr_c⁄n_˙txt
);

1445 
vif
->
ªc⁄√˘_Êag
 = 0;

1447 i‡((
vif
->
nw_ty≥
 =
ADHOC_NETWORK
Ë&& 
¨
->
ibss_ps_íabÀ
) {

1448 
	`mem£t
(
¨
->
node_m≠
, 0, (ar->node_map));

1449 
¨
->
node_num
 = 0;

1450 
¨
->
√xt_ï_id
 = 
ENDPOINT_2
;

1453 i‡(!
vif
->
u§_bss_fûãr
) {

1454 
	`£t_bô
(
CLEAR_BSSFILTER_ON_BEACON
, &
vif
->
Êags
);

1455 
	`©h6kl_wmi_bssfûãr_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1456 
CURRENT_BSS_FILTER
, 0);

1460 
	`©h6kl_htc€x_c⁄√˘_evít
(
vif
);

1461 
	`©h6kl_p2p_c⁄√˘_evít
(
vif
,

1462 
bóc⁄_õ_Àn
,

1463 
assoc_ªq_Àn
,

1464 
assoc_ª•_Àn
,

1465 
assoc_öfo
);

1466 
	`©h6kl_swôch_∑ømëî_ba£d_⁄_c⁄√˘i⁄
(
vif
, 
Ál£
);

1467 
	}
}

1469 
	$©h6kl_tkù_mi˚º_evít
(
©h6kl_vif
 *
vif
, 
u8
 
keyid
, 
boﬁ
 
ismˇ°
)

1471 
©h6kl_°a
 *
°a
;

1472 
u8
 
tsc
[6];

1478 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

1479 
°a
 = 
	`©h6kl_föd_°a_by_aid
(
vif
, (
keyid
 >> 2));

1480 i‡(!
°a
)

1483 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
,

1484 "≠Åkù mi¯îr‹Ñe˚ived fromáid=%d\n", 
keyid
);

1486 
	`mem£t
(
tsc
, 0, (tsc));

1487 
	`cfg80211_mich´l_mic_Áûuª
(
vif
->
ndev
, 
°a
->
mac
,

1488 
NL80211_KEYTYPE_PAIRWISE
, 
keyid
,

1489 
tsc
, 
GFP_KERNEL
);

1491 
	`©h6kl_cfg80211_tkù_mi˚º_evít
(
vif
, 
keyid
, 
ismˇ°
);

1493 
	}
}

1495 
	$©h6kl_upd©e_èrgë_°©s
(
©h6kl_vif
 *
vif
, 
u8
 *
±r
, 
u32
 
Àn
)

1497 
wmi_èrgë_°©s
 *
tgt_°©s
 =

1498 (
wmi_èrgë_°©s
 *Ë
±r
;

1499 
©h6kl
 *
¨
 = 
vif
->ar;

1500 
èrgë_°©s
 *
°©s
 = &
vif
->target_stats;

1501 
tkù_ccmp_°©s
 *
ccmp_°©s
;

1502 
u8
 
ac
;

1504 i‡(
Àn
 < (*
tgt_°©s
))

1507 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
, "updatingÅarget stats\n");

1509 
°©s
->
tx_pkt
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
pkt
);

1510 
°©s
->
tx_byã
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
byã
);

1511 
°©s
->
tx_uˇ°_pkt
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
uˇ°_pkt
);

1512 
°©s
->
tx_uˇ°_byã
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
uˇ°_byã
);

1513 
°©s
->
tx_mˇ°_pkt
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
mˇ°_pkt
);

1514 
°©s
->
tx_mˇ°_byã
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
mˇ°_byã
);

1515 
°©s
->
tx_bˇ°_pkt
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
bˇ°_pkt
);

1516 
°©s
->
tx_bˇ°_byã
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
bˇ°_byã
);

1517 
°©s
->
tx_πs_suc˚ss_˙t
 +=

1518 
	`À32_to_˝u
(
tgt_°©s
->
°©s
.
tx
.
πs_suc˚ss_˙t
);

1520 
ac
 = 0;á¯< 
WMM_NUM_AC
;ác++)

1521 
°©s
->
tx_pkt_≥r_ac
[
ac
] +=

1522 
	`À32_to_˝u
(
tgt_°©s
->
°©s
.
tx
.
pkt_≥r_ac
[
ac
]);

1524 
°©s
->
tx_îr
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
îr
);

1525 
°©s
->
tx_Áû_˙t
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
Áû_˙t
);

1526 
°©s
->
tx_ªåy_˙t
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
tx
.
ªåy_˙t
);

1527 
°©s
->
tx_mu…_ªåy_˙t
 +=

1528 
	`À32_to_˝u
(
tgt_°©s
->
°©s
.
tx
.
mu…_ªåy_˙t
);

1529 
°©s
->
tx_πs_Áû_˙t
 +=

1530 
	`À32_to_˝u
(
tgt_°©s
->
°©s
.
tx
.
πs_Áû_˙t
);

1531 i‡(
¨
->
èrgë_ty≥
 =
TARGET_TYPE_AR6004
) {

1532 
°©s
->
tx_uˇ°_øã
 =

1533 
	`©h6kl_wmi_gë_øã_¨6004
(

1534 
	`a_¶e32_to_˝u
(
tgt_°©s
->
°©s
.
tx
.
uˇ°_øã
));

1535 
°©s
->
tx_øã_ödex
 = 
tgt_°©s
->°©s.
tx
.
uˇ°_øã
;

1537 
°©s
->
tx_uˇ°_øã
 =

1538 
	`©h6kl_wmi_gë_øã
(

1539 
	`a_¶e32_to_˝u
(
tgt_°©s
->
°©s
.
tx
.
uˇ°_øã
));

1542 
°©s
->
rx_pkt
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
pkt
);

1543 
°©s
->
rx_byã
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
byã
);

1544 
°©s
->
rx_uˇ°_pkt
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
uˇ°_pkt
);

1545 
°©s
->
rx_uˇ°_byã
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
uˇ°_byã
);

1546 
°©s
->
rx_mˇ°_pkt
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
mˇ°_pkt
);

1547 
°©s
->
rx_mˇ°_byã
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
mˇ°_byã
);

1548 
°©s
->
rx_bˇ°_pkt
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
bˇ°_pkt
);

1549 
°©s
->
rx_bˇ°_byã
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
bˇ°_byã
);

1550 
°©s
->
rx_‰gmít_pkt
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
‰gmít_pkt
);

1551 
°©s
->
rx_îr
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
îr
);

1552 
°©s
->
rx_¸c_îr
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
¸c_îr
);

1553 
°©s
->
rx_key_ˇche_miss
 +=

1554 
	`À32_to_˝u
(
tgt_°©s
->
°©s
.
rx
.
key_ˇche_miss
);

1555 
°©s
->
rx_de¸y±_îr
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
de¸y±_îr
);

1556 
°©s
->
rx_du∂_‰ame
 +
	`À32_to_˝u
(
tgt_°©s
->°©s.
rx
.
du∂_‰ame
);

1557 
°©s
->
rx_uˇ°_øã
 =

1558 
	`©h6kl_wmi_gë_øã
(
	`a_¶e32_to_˝u
(
tgt_°©s
->
°©s
.
rx
.
uˇ°_øã
));

1560 
ccmp_°©s
 = &
tgt_°©s
->
°©s
.
tkù_ccmp_°©s
;

1562 
°©s
->
tkù_loˇl_mic_Áû
 +=

1563 
	`À32_to_˝u
(
ccmp_°©s
->
tkù_loˇl_mic_Áû
);

1564 
°©s
->
tkù_˙ãr_mósuªs_övoked
 +=

1565 
	`À32_to_˝u
(
ccmp_°©s
->
tkù_˙ãr_mósuªs_övoked
);

1566 
°©s
->
tkù_fmt_îr
 +
	`À32_to_˝u
(
ccmp_°©s
->tkip_fmt_err);

1568 
°©s
->
ccmp_fmt_îr
 +
	`À32_to_˝u
(
ccmp_°©s
->ccmp_fmt_err);

1569 
°©s
->
ccmp_ª∂ays
 +
	`À32_to_˝u
(
ccmp_°©s
->ccmp_replays);

1571 
°©s
->
pwr_ßve_Áû_˙t
 +=

1572 
	`À32_to_˝u
(
tgt_°©s
->
pm_°©s
.
pwr_ßve_Áûuª_˙t
);

1573 
°©s
->
noi£_Êo‹_ˇlib
 =

1574 
	`a_¶e32_to_˝u
(
tgt_°©s
->
noi£_Êo‹_ˇlib
);

1576 
°©s
->
cs_bmiss_˙t
 +=

1577 
	`À32_to_˝u
(
tgt_°©s
->
c£rv_°©s
.
cs_bmiss_˙t
);

1578 
°©s
->
cs_low_rssi_˙t
 +=

1579 
	`À32_to_˝u
(
tgt_°©s
->
c£rv_°©s
.
cs_low_rssi_˙t
);

1580 
°©s
->
cs_c⁄√˘_˙t
 +=

1581 
	`À16_to_˝u
(
tgt_°©s
->
c£rv_°©s
.
cs_c⁄√˘_˙t
);

1582 
°©s
->
cs_disc⁄_˙t
 +=

1583 
	`À16_to_˝u
(
tgt_°©s
->
c£rv_°©s
.
cs_disc⁄_˙t
);

1585 
°©s
->
cs_ave_bóc⁄_rssi
 =

1586 
	`a_¶e16_to_˝u
(
tgt_°©s
->
c£rv_°©s
.
cs_ave_bóc⁄_rssi
);

1588 
°©s
->
cs_œ°_rﬂm_m£c
 =

1589 
tgt_°©s
->
c£rv_°©s
.
cs_œ°_rﬂm_m£c
;

1590 
°©s
->
cs_¢r
 = 
tgt_°©s
->
c£rv_°©s
.cs_snr;

1591 
°©s
->
cs_rssi
 = 
	`a_¶e16_to_˝u
(
tgt_°©s
->
c£rv_°©s
.cs_rssi);

1593 
°©s
->
lq_vÆ
 = 
	`À32_to_˝u
(
tgt_°©s
->lq_val);

1595 
°©s
->
wow_pkt_dr›≥d
 +=

1596 
	`À32_to_˝u
(
tgt_°©s
->
wow_°©s
.
wow_pkt_dr›≥d
);

1597 
°©s
->
wow_ho°_pkt_wakeups
 +=

1598 
tgt_°©s
->
wow_°©s
.
wow_ho°_pkt_wakeups
;

1599 
°©s
->
wow_ho°_evt_wakeups
 +=

1600 
tgt_°©s
->
wow_°©s
.
wow_ho°_evt_wakeups
;

1601 
°©s
->
wow_evt_disˇrded
 +=

1602 
	`À16_to_˝u
(
tgt_°©s
->
wow_°©s
.
wow_evt_disˇrded
);

1604 
	`do_gëtimeofday
(&
°©s
->
upd©e_time
);

1605 
	}
}

1607 
	$©h6kl_add_À32
(
__À32
 *
v¨
, __À32 
vÆ
)

1609 *
v¨
 = 
	`˝u_to_À32
(
	`À32_to_˝u
(*v¨Ë+Üe32_to_˝u(
vÆ
));

1610 
	}
}

1612 
	$©h6kl_tgt_°©s_evít
(
©h6kl_vif
 *
vif
, 
u8
 *
±r
, 
u32
 
Àn
)

1614 
wmi_≠_mode_°©
 *
p
 = (wmi_≠_mode_°© *Ë
±r
;

1615 
wmi_≠_mode_°©
 *
≠
 = &
vif
->
≠_°©s
;

1616 
wmi_≥r_°a_°©
 *
°_≠
, *
°_p
;

1617 
u8
 
ac
, 
¶Ÿ
;

1618 
u16
 
upd©ed
 = 0;

1620 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

1621 i‡((
Àn
 + 4Ë>(*
p
)) {

1622 
ac
 = 0;á¯< 
AP_MAX_NUM_STA
;ác++) {

1623 
°_p
 = &
p
->
°a
[
ac
];

1629 i‡((
°_p
->
aid
 == 0) ||

1630 (
°_p
->
aid
 > 
AP_MAX_NUM_STA
))

1633 
°_≠
 = &
≠
->
°a
[
°_p
->
aid
 - 1];

1634 
¶Ÿ
 = (1 << (
°_p
->
aid
 - 1));

1635 i‡((
vif
->
°a_li°_ödex
 & 
¶Ÿ
) &&

1636 (!(
upd©ed
 & 
¶Ÿ
))) {

1637 
	`WARN_ON
(
°_≠
->
aid
 !
°_p
->aid);

1638 
upd©ed
 |
¶Ÿ
;

1639 
	`©h6kl_add_À32
(&
°_≠
->
tx_byãs
,

1640 
°_p
->
tx_byãs
);

1641 
	`©h6kl_add_À32
(&
°_≠
->
tx_pkts
,

1642 
°_p
->
tx_pkts
);

1643 
	`©h6kl_add_À32
(&
°_≠
->
tx_îr‹
,

1644 
°_p
->
tx_îr‹
);

1645 
	`©h6kl_add_À32
(&
°_≠
->
tx_disˇrd
,

1646 
°_p
->
tx_disˇrd
);

1647 
	`©h6kl_add_À32
(&
°_≠
->
rx_byãs
,

1648 
°_p
->
rx_byãs
);

1649 
	`©h6kl_add_À32
(&
°_≠
->
rx_pkts
,

1650 
°_p
->
rx_pkts
);

1651 
	`©h6kl_add_À32
(&
°_≠
->
rx_îr‹
,

1652 
°_p
->
rx_îr‹
);

1653 
	`©h6kl_add_À32
(&
°_≠
->
rx_disˇrd
,

1654 
°_p
->
rx_disˇrd
);

1655 
°_≠
->
tx_uˇ°_øã
 =

1656 
°_p
->
tx_uˇ°_øã
;

1657 
°_≠
->
œ°_txrx_time
 =

1658 
	`À16_to_˝u
(
°_p
->
œ°_txrx_time
);

1663 
	`©h6kl_upd©e_èrgë_°©s
(
vif
, 
±r
, 
Àn
);

1666 i‡(
	`ã°_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
)) {

1667 
	`˛ór_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
);

1668 
	`wake_up
(&
vif
->
¨
->
evít_wq
);

1670 
	}
}

1672 
	$©h6kl_wakeup_evít
(*
dev
)

1674 
©h6kl
 *
¨
 = (©h6k»*Ë
dev
;

1676 
	`wake_up
(&
¨
->
evít_wq
);

1677 
	}
}

1679 
	$©h6kl_txpwr_rx_evt
(*
devt
, 
u8
 
tx_pwr
)

1681 
©h6kl
 *
¨
 = (©h6k»*Ë
devt
;

1683 
¨
->
tx_pwr
 =Åx_pwr;

1684 
	`wake_up
(&
¨
->
evít_wq
);

1685 
	}
}

1687 
	$©h6kl_p•ﬁl_evít
(
©h6kl_vif
 *
vif
, 
u8
 
aid
)

1689 
©h6kl_°a
 *
c⁄n
;

1690 
boﬁ
 
psq_em±y
 = 
Ál£
;

1691 
boﬁ
 
is_d©a_psq_em±y
, 
is_mgmt_psq_em±y
;

1692 
©h6kl
 *
¨
 = 
vif
->ar;

1693 
©h6kl_ps_buf_desc
 *
ps_buf
;

1695 
c⁄n
 = 
	`©h6kl_föd_°a_by_aid
(
vif
, 
aid
);

1697 i‡(!
c⁄n
)

1703 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

1704 
is_d©a_psq_em±y
 = 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
);

1705 
is_mgmt_psq_em±y
 = 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
);

1706 
psq_em±y
 = 
is_d©a_psq_em±y
 && 
is_mgmt_psq_em±y
;

1708 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

1710 
__func__
, 
c⁄n
->
aid
, c⁄n->
°a_Êags
, !
is_d©a_psq_em±y
,

1711 !
is_mgmt_psq_em±y
);

1713 i‡(
psq_em±y
) {

1714 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

1718 i‡(!
is_mgmt_psq_em±y
) {

1719 
õì80211_mgmt
 *
mgmt
;

1721 
ps_buf
 = 
	`©h6kl_ps_queue_dequeue
(&
c⁄n
->
psq_mgmt
);

1722 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

1724 
	`WARN_ON
(!
ps_buf
);

1725 
c⁄n
->
°a_Êags
 |
STA_PS_POLLED
;

1727 
mgmt
 = (
õì80211_mgmt
 *Ë
ps_buf
->
buf
;

1728 i‡(
ps_buf
->
buf
 +Ös_buf->
Àn
 >
mgmt
->
u
.
¥obe_ª•
.
v¨übÀ
 &&

1729 
	`õì80211_is_¥obe_ª•
(
mgmt
->
‰ame_c⁄åﬁ
))

1730 
	`©h6kl_wmi_£nd_go_¥obe_ª•⁄£_cmd
(
¨
->
wmi
,

1731 
vif
,

1732 
ps_buf
->
buf
,

1733 
ps_buf
->
Àn
,

1734 
ps_buf
->
‰eq
);

1736 
	`©h6kl_wmi_£nd_a˘i⁄_cmd
(
¨
->
wmi
,

1737 
vif
->
fw_vif_idx
,

1738 
ps_buf
->
id
,

1739 
ps_buf
->
‰eq
,

1740 
ps_buf
->
waô
,

1741 
ps_buf
->
buf
,

1742 
ps_buf
->
Àn
);

1744 
c⁄n
->
°a_Êags
 &~
STA_PS_POLLED
;

1745 
	`k‰ì
(
ps_buf
);

1747 
ps_buf
 = 
	`©h6kl_ps_queue_dequeue
(&
c⁄n
->
psq_d©a
);

1748 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

1750 i‡(
ps_buf
) {

1751 
	`WARN_ON
(!
ps_buf
->
skb
);

1752 i‡(
ps_buf
->
skb
) {

1753 
c⁄n
->
°a_Êags
 |
STA_PS_POLLED
;

1754 
	`©h6kl_d©a_tx
(
ps_buf
->
skb
, 
vif
->
ndev
, 
åue
);

1755 
c⁄n
->
°a_Êags
 &~
STA_PS_POLLED
;

1757 
	`k‰ì
(
ps_buf
);

1761 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

1762 
psq_em±y
 = 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
) &&

1763 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
);

1764 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

1766 i‡(
psq_em±y
)

1767 
	`©h6kl_wmi_£t_pvb_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
c⁄n
->
aid
, 0);

1768 
	}
}

1770 
	$©h6kl_dtimexpúy_evít
(
©h6kl_vif
 *
vif
)

1772 
©h6kl
 *
¨
 = 
vif
->ar;

1773 
©h6kl_ps_buf_desc
 *
ps_buf
;

1784 i‡(!
vif
->
°a_li°_ödex
)

1787 
	`•ö_lock_bh
(&
vif
->
psq_mˇ°_lock
);

1788 i‡(
	`©h6kl_ps_queue_em±y
(&
vif
->
psq_mˇ°
)) {

1789 
	`•ö_u∆ock_bh
(&
vif
->
psq_mˇ°_lock
);

1792 
	`•ö_u∆ock_bh
(&
vif
->
psq_mˇ°_lock
);

1795 
	`£t_bô
(
DTIM_EXPIRED
, &
vif
->
Êags
);

1797 
	`•ö_lock_bh
(&
vif
->
psq_mˇ°_lock
);

1798 (
ps_buf
 = 
	`©h6kl_ps_queue_dequeue
(&
vif
->
psq_mˇ°
)Ë!
NULL
) {

1799 
	`•ö_u∆ock_bh
(&
vif
->
psq_mˇ°_lock
);

1800 
	`©h6kl_d©a_tx
(
ps_buf
->
skb
, 
vif
->
ndev
, 
åue
);

1801 
	`k‰ì
(
ps_buf
);

1803 
	`•ö_lock_bh
(&
vif
->
psq_mˇ°_lock
);

1805 
	`•ö_u∆ock_bh
(&
vif
->
psq_mˇ°_lock
);

1807 
	`˛ór_bô
(
DTIM_EXPIRED
, &
vif
->
Êags
);

1810 
	`©h6kl_wmi_£t_pvb_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 
MCAST_AID
, 0);

1811 
	}
}

1813 
	$©h6kl_disc⁄√˘_evít
(
©h6kl_vif
 *
vif
, 
u8
 
ªas⁄
, u8 *
bssid
,

1814 
u8
 
assoc_ª•_Àn
, u8 *
assoc_öfo
,

1815 
u16
 
¥Ÿ_ªas⁄_°©us
)

1817 
©h6kl
 *
¨
 = 
vif
->ar;

1819 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

1820 i‡(!
	`©h6kl_ªmove_°a
(
vif
, 
bssid
, 
¥Ÿ_ªas⁄_°©us
))

1823 
	`©h6kl_≠_ht_upd©e_õs
(
vif
);

1826 i‡(
vif
->
°a_li°_ödex
 == 0) {

1827 
	`©h6kl_ps_queue_purge
(&
vif
->
psq_mˇ°
);

1830 i‡(
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
))

1831 
	`©h6kl_wmi_£t_pvb_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1832 
MCAST_AID
, 0);

1835 i‡(!
	`is_brﬂdˇ°_ëhî_addr
(
bssid
)) {

1837 
	`cfg80211_dñ_°a
(
vif
->
ndev
, 
bssid
, 
GFP_KERNEL
);

1840 i‡(
	`memcmp
(
vif
->
ndev
->
dev_addr
, 
bssid
, 
ETH_ALEN
) == 0) {

1841 
vif
->
bss_ch
 = 0;

1842 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_UNKNOWN
;

1843 
vif
->
ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_NONE
;

1844 
	`mem£t
(
vif
->
wï_key_li°
, 0, (vif->wep_key_list));

1845 
	`˛ór_bô
(
CONNECTED
, &
vif
->
Êags
);

1846 
	`√tif_ˇºõr_off
(
vif
->
ndev
);

1847 
	`√tif_°›_queue
(
vif
->
ndev
);

1848 
	`©h6kl_tx_d©a_˛ónup_by_if
(
vif
);

1849 
	`©h6kl_judge_rﬂm_∑ømëî
(
vif
, 
åue
);

1850 
	`©h6kl_swôch_∑ømëî_ba£d_⁄_c⁄√˘i⁄
(
vif
, 
åue
);

1853 } i‡(
vif
->
nw_ty≥
 =
INFRA_NETWORK
) {

1854 
	`©h6kl_wmi_dis˘imeout_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1855 
ATH6KL_DISCONNECT_TIMEOUT
);

1858 i‡(!
	`is_vÆid_ëhî_addr
(
bssid
) &&

1859 
	`is_vÆid_ëhî_addr
(
vif
->
ªq_bssid
))

1860 
bssid
 = 
vif
->
ªq_bssid
;

1863 
	`©h6kl_cfg80211_disc⁄√˘_evít
(
vif
, 
ªas⁄
, 
bssid
,

1864 
assoc_ª•_Àn
, 
assoc_öfo
,

1865 
¥Ÿ_ªas⁄_°©us
);

1867 
	`aggr_ª£t_°©e
(
vif
->
°a_li°
[0].
aggr_c⁄n_˙txt
);

1869 
	`dñ_timî
(&
vif
->
disc⁄√˘_timî
);

1871 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_CFG
, "disc⁄√˘Ñós⁄ i†%d\n", 
ªas⁄
);

1878 i‡(
ªas⁄
 =
DISCONNECT_CMD
) {

1879 i‡(!
vif
->
u§_bss_fûãr
 && 
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
))

1880 
	`©h6kl_wmi_bssfûãr_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1881 
NONE_BSS_FILTER
, 0);

1883 
	`£t_bô
(
CONNECT_PEND
, &
vif
->
Êags
);

1884 i‡(((
ªas⁄
 =
ASSOC_FAILED
) &&

1885 (
¥Ÿ_ªas⁄_°©us
 == 0x11)) ||

1886 ((
ªas⁄
 =
ASSOC_FAILED
Ë&& (
¥Ÿ_ªas⁄_°©us
 == 0x0)

1887 && (
vif
->
ªc⁄√˘_Êag
 == 1))) {

1888 
	`£t_bô
(
CONNECTED
, &
vif
->
Êags
);

1889 
	`©h6kl_judge_rﬂm_∑ømëî
(
vif
, 
Ál£
);

1890 
	`©h6kl_swôch_∑ømëî_ba£d_⁄_c⁄√˘i⁄
(
vif
, 
Ál£
);

1896 
	`•ö_lock_bh
(&
vif
->
if_lock
);

1897 
	`˛ór_bô
(
CONNECTED
, &
vif
->
Êags
);

1898 
	`˛ór_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
);

1899 
	`˛ór_bô
(
PS_STICK
, &
vif
->
Êags
);

1900 
	`dñ_timî
(&
vif
->
sh¥Ÿe˘_timî
);

1901 
	`√tif_ˇºõr_off
(
vif
->
ndev
);

1902 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

1904 i‡((
ªas⁄
 !
CSERV_DISCONNECT
Ë|| (
vif
->
ªc⁄√˘_Êag
 != 1))

1905 
vif
->
ªc⁄√˘_Êag
 = 0;

1907 i‡(
ªas⁄
 !
CSERV_DISCONNECT
)

1908 
¨
->
u£r_key_˘æ
 = 0;

1910 
	`√tif_°›_queue
(
vif
->
ndev
);

1911 
	`mem£t
(
vif
->
bssid
, 0, (vif->bssid));

1912 
vif
->
bss_ch
 = 0;

1913 
vif
->
phymode
 = 
ATH6KL_PHY_MODE_UNKNOWN
;

1914 
vif
->
ch™_ty≥
 = 
ATH6KL_CHAN_TYPE_NONE
;

1916 
	`©h6kl_tx_d©a_˛ónup_by_if
(
vif
);

1919 
	`©h6kl_htc€x_disc⁄√˘_evít
(
vif
);

1920 
	`©h6kl_judge_rﬂm_∑ømëî
(
vif
, 
åue
);

1921 
	`©h6kl_swôch_∑ømëî_ba£d_⁄_c⁄√˘i⁄
(
vif
, 
åue
);

1922 
	}
}

1924 
©h6kl_vif
 *
	$©h6kl_vif_fú°
(
©h6kl
 *
¨
)

1926 
©h6kl_vif
 *
vif
;

1928 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

1929 i‡(
	`li°_em±y
(&
¨
->
vif_li°
)) {

1930 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

1931  
NULL
;

1934 
vif
 = 
	`li°_fú°_íåy
(&
¨
->
vif_li°
, 
©h6kl_vif
, 
li°
);

1936 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

1938  
vif
;

1939 
	}
}

1941 
	$©h6kl_›í
(
√t_devi˚
 *
dev
)

1943 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

1944 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

1946 
	`£t_bô
(
WLAN_ENABLED
, &
vif
->
Êags
);

1948 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) ||

1949 
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

1950 
	`√tif_ˇºõr_⁄
(
dev
);

1951 
	`√tif_wake_queue
(
dev
);

1953 
	`√tif_ˇºõr_off
(
dev
);

1956 
	}
}

1958 
	$©h6kl_˛o£
(
√t_devi˚
 *
dev
)

1960 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

1961 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

1963 
	`√tif_°›_queue
(
dev
);

1965 
vif
->
sme_°©e
) {

1966 
SME_CONNECTING
:

1967 
	`©h6kl_cfg80211_c⁄√˘_ªsu…
(
vif
, vif->
bssid
, 
NULL
, 0,

1968 
NULL
, 0,

1969 
WLAN_STATUS_UNSPECIFIED_FAILURE
,

1970 
GFP_KERNEL
);

1972 
SME_CONNECTED
:

1973 
	`©h6kl_cfg80211_disc⁄√˘ed
(
vif
, 0, 
NULL
, 0, 
GFP_KERNEL
);

1975 
SME_DISCONNECTED
:

1981 
	`©h6kl_≠_kì∑live_°›
(
vif
);

1984 
	`©h6kl_≠_a˛_°›
(
vif
);

1987 
	`©h6kl_≠_admc_°›
(
vif
);

1989 
	`©h6kl_disc⁄√˘
(
vif
);

1991 
vif
->
sme_°©e
 = 
SME_DISCONNECTED
;

1992 
	`˛ór_bô
(
CONNECTED
, &
vif
->
Êags
);

1993 
	`˛ór_bô
(
CONNECT_PEND
, &
vif
->
Êags
);

1994 
	`˛ór_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
);

1995 
	`˛ór_bô
(
PS_STICK
, &
vif
->
Êags
);

1996 
	`dñ_timî
(&
vif
->
sh¥Ÿe˘_timî
);

1998 i‡(
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
)) {

1999 i‡(
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
, 0xFFFF,

2001  -
EIO
;

2005 
	`©h6kl_cfg80211_sˇn_com∂ëe_evít
(
vif
, 
åue
);

2007 
	`˛ór_bô
(
WLAN_ENABLED
, &
vif
->
Êags
);

2010 
	}
}

2012 
√t_devi˚_°©s
 *
	$©h6kl_gë_°©s
(
√t_devi˚
 *
dev
)

2014 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

2016  &
vif
->
√t_°©s
;

2017 
	}
}

2019 
	$©h6kl_io˘l_p2p_£t_ps
(
©h6kl_vif
 *
vif
,

2020 *
u£r_cmd
,

2021 
Àn
)

2023 
ªt
 = 0;

2024 
u8
 
pwr_mode
;

2027 i‡(
Àn
 > 1) {

2028 i‡(
	`down_öãºu±ibÀ
(&
vif
->
¨
->
£m
)) {

2029 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2030  -
EIO
;

2033 
ªt
 = 0;

2034 
pwr_mode
 = (
u£r_cmd
[0] != '0' ?

2035 
REC_POWER
 : 
MAX_PERF_POWER
);

2037 i‡(
	`©h6kl_wmi_powîmode_cmd
(
vif
->
¨
->
wmi
,

2038 
vif
->
fw_vif_idx
,

2039 
pwr_mode
))

2040 
ªt
 = -
EIO
;

2042 
	`up
(&
vif
->
¨
->
£m
);

2044 
ªt
 = -
EFAULT
;

2046  
ªt
;

2047 
	}
}

2049 
	$©h6kl_io˘l_£tb™d
(
©h6kl_vif
 *
vif
,

2050 *
u£r_cmd
,

2051 
Àn
)

2053 
ªt
 = 0, 
sˇnb™d_ty≥
 = 0;

2054 
i
, 
f
 = 0;

2055 
u8
 
nŸ_Ælow_ch
;

2058 i‡(
Àn
 > 1) {

2059 
ªt
 = 0;

2060 
	`ssˇnf
(
u£r_cmd
, "%d %d", &
sˇnb™d_ty≥
, &
f
);

2062 i‡(
sˇnb™d_ty≥
 =
ANDROID_SETBAND_ALL
)

2063 
vif
->
sˇnb™d_ty≥
 = 
SCANBAND_TYPE_ALL
;

2064 i‡(
sˇnb™d_ty≥
 =
ANDROID_SETBAND_5G
)

2065 
vif
->
sˇnb™d_ty≥
 = 
SCANBAND_TYPE_5G
;

2066 i‡(
sˇnb™d_ty≥
 =
ANDROID_SETBAND_2G
)

2067 
vif
->
sˇnb™d_ty≥
 = 
SCANBAND_TYPE_2G
;

2068 i‡(
sˇnb™d_ty≥
 =
ANDROID_SETBAND_NO_DFS
)

2069 
vif
->
sˇnb™d_ty≥
 = 
SCANBAND_TYPE_IGNORE_DFS
;

2070 i‡(
sˇnb™d_ty≥
 =
ANDROID_SETBAND_NO_CH
) {

2071 
vif
->
sˇnb™d_ty≥
 = 
SCANBAND_TYPE_IGNORE_CH
;

2072 i‡(
f
 == 1) {

2073 
	`mem£t
(
vif
->
sˇnb™d_ign‹e_ch™
,

2075 (
u16
) * 64);

2077 
i
 = 0; i < 64; i++) {

2078 i‡(
vif
->
sˇnb™d_ign‹e_ch™
[
i
] =
f
)

2080 i‡(!
vif
->
sˇnb™d_ign‹e_ch™
[
i
])

2084 i‡(
i
 < 64)

2085 
vif
->
sˇnb™d_ign‹e_ch™
[
i
] = 
f
;

2087 } i‡((
sˇnb™d_ty≥
 >= 2412) && (scanband_type <= 5825)) {

2088 
vif
->
sˇnb™d_ty≥
 = 
SCANBAND_TYPE_CHAN_ONLY
;

2089 
vif
->
sˇnb™d_ch™
 = 
sˇnb™d_ty≥
;

2091 
ªt
 = -
ENOTSUPP
;

2094 
nŸ_Ælow_ch
 = 0;

2095 i‡((
vif
->
bss_ch
) &&

2096 (
vif
->
sˇnb™d_ty≥
 !
SCANBAND_TYPE_ALL
) &&

2097 (((
vif
->
sˇnb™d_ty≥
 =
SCANBAND_TYPE_5G
) &&

2098 (
vif
->
bss_ch
 < 2484)) ||

2099 ((
vif
->
sˇnb™d_ty≥
 =
SCANBAND_TYPE_2G
) &&

2100 (
vif
->
bss_ch
 > 2484))))

2101 
nŸ_Ælow_ch
 = 1;

2103 i‡((!
ªt
) &&

2104 (
vif
->
nw_ty≥
 =
INFRA_NETWORK
) &&

2105 (
nŸ_Ælow_ch
) &&

2106 (
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))) {

2107 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

2109 
vif
->
ªc⁄√˘_Êag
 = 0;

2110 
ªt
 = 
	`©h6kl_disc⁄√˘
(
vif
);

2111 
	`mem£t
(
vif
->
ssid
, 0, (vif->ssid));

2112 
vif
->
ssid_Àn
 = 0;

2115 
ªt
 = -
EFAULT
;

2117  
ªt
;

2118 
	}
}

2120 
	$©h6kl_io˘l_£åts
(
©h6kl_vif
 *
vif
,

2121 *
u£r_cmd
,

2122 
Àn
)

2124 
ªt
 = 0, 
πs_thªshﬁd
 = 0;

2127 i‡(
Àn
 > 1) {

2128 
ªt
 = 0;

2129 
	`ssˇnf
(
u£r_cmd
, "%d", &
πs_thªshﬁd
);

2131 i‡(
πs_thªshﬁd
 < 0 ||Ñts_threshold > 2347)

2132  -
EINVAL
;

2134 
	`©h6kl_wmi_£t_πs_cmd
(
vif
->
¨
->
wmi
,

2135 
vif
->
fw_vif_idx
,

2136 
πs_thªshﬁd
);

2138 
ªt
 = -
EFAULT
;

2140  
ªt
;

2141 
	}
}

2143 
	$©h6kl_io˘l_p2p_dev_addr
(
©h6kl_vif
 *
vif
,

2144 *
u£r_cmd
,

2145 
u8
 *
buf
)

2147 
ªt
 = 0;

2148 
©h6kl_vif
 *
p2p_vif
;

2152 
p2p_vif
 = 
	`©h6kl_gë_vif_by_ödex
(
vif
->
¨
, (vif->¨->
vif_max
 - 1));

2153 i‡(
p2p_vif
) {

2154 i‡(
	`c›y_to_u£r
(
buf
, 
p2p_vif
->
ndev
->
dev_addr
, 
ETH_ALEN
))

2155 
ªt
 = -
EFAULT
;

2157 
ªt
 = 0;

2159 
ªt
 = -
EFAULT
;

2161  
ªt
;

2162 
	}
}

2164 
	$©h6kl_io˘l_p2p_be°_ch™
(
©h6kl_vif
 *
vif
,

2165 *
u£r_cmd
,

2166 
u8
 *
buf
,

2167 
Àn
)

2169 
ªsu…
[20];

2170 
©h6kl_rc_ªp‹t
 
rc_ªp‹t
;

2171 
ªt
 = 0;

2175 i‡((
	`°æí
(
buf
) > 16) &&

2176 
	`°r°r
(
buf
, "0"))

2177 
d⁄e
;

2183 
	`mem£t
(&
rc_ªp‹t
, 0, (
©h6kl_rc_ªp‹t
));

2184 
ªt
 = 
	`©h6kl_p2p_rc_gë
(
vif
->
¨
, &
rc_ªp‹t
);

2186 
d⁄e
:

2187 i‡(
ªt
 == 0) {

2188 
	`mem£t
(
ªsu…
, 0, 20);

2189 
	`¢¥ötf
(
ªsu…
, 20,

2191 
rc_ªp‹t
.
rc_p2p_2g
,

2192 
rc_ªp‹t
.
rc_p2p_5g
,

2193 
rc_ªp‹t
.
rc_p2p_Æl
);

2194 
ªsu…
[
	`°æí
(result)] = '\0';

2195 i‡(
	`c›y_to_u£r
(
buf
, 
ªsu…
, 
	`°æí
(result)))

2196 
ªt
 = -
EFAULT
;

2198 
ªt
 = 0;

2201  
ªt
;

2202 
	}
}

2204 
	$©h6kl_io˘l_≠_a˛
(
©h6kl_vif
 *
vif
,

2205 *
u£r_cmd
,

2206 
u8
 *
buf
,

2207 
Àn
)

2209 
ªt
 = 0;

2211 #ifde‡
NL80211_CMD_SET_AP_MAC_ACL


2213 i‡(
vif
->
¨
->
wùhy
->
max_a˛_mac_addrs
)

2214  -
EINVAL
;

2218 i‡(
Àn
 > 1) {

2219 
i
, 
pﬁicy
, 
addr
[
ETH_ALEN
];

2220 
u8
 
mac_addr
[
ETH_ALEN
];

2222 i‡(
	`°r°r
(
u£r_cmd
, "MACCMD ")) {

2223 
u£r_cmd
 += 7;

2224 
	`ssˇnf
(
u£r_cmd
, "%d", &
pﬁicy
);

2225 
ªt
 = 
	`©h6kl_≠_a˛_c⁄fig_pﬁicy
(
vif
, 
pﬁicy
);

2226 } i‡(
	`°r°r
(
u£r_cmd
, "ADDMAC ")) {

2227 
u£r_cmd
 += 7;

2228 i‡(
	`ssˇnf
(
u£r_cmd
, "%02x:%02x:%02x:%02x:%02x:%02x",

2229 &
addr
[0], &addr[1], &addr[2],

2230 &
addr
[3], &addr[4], &addr[5]Ë!
ETH_ALEN
)

2231  -
EFAULT
;

2233 
i
 = 0; i < 
ETH_ALEN
; i++)

2234 
mac_addr
[
i
] = (
u8
)
addr
[i];

2236 
ªt
 = 
	`©h6kl_≠_a˛_c⁄fig_mac_li°
(
vif
,

2237 
mac_addr
,

2238 
Ál£
);

2239 } i‡(
	`°r°r
(
u£r_cmd
, "DELMAC ")) {

2240 
u£r_cmd
 += 7;

2241 i‡(
	`ssˇnf
(
u£r_cmd
, "%02x:%02x:%02x:%02x:%02x:%02x",

2242 &
addr
[0], &addr[1], &addr[2],

2243 &
addr
[3], &addr[4], &addr[5]Ë!
ETH_ALEN
)

2244  -
EFAULT
;

2246 
i
 = 0; i < 
ETH_ALEN
; i++)

2247 
mac_addr
[
i
] = (
u8
)
addr
[i];

2249 
ªt
 = 
	`©h6kl_≠_a˛_c⁄fig_mac_li°
(
vif
,

2250 
mac_addr
,

2251 
åue
);

2253 
ªt
 = -
EFAULT
;

2255 
ªt
 = -
EFAULT
;

2257  
ªt
;

2258 
	}
}

2260 
boﬁ
 
	$©h6kl_io˘l_ªady
(
©h6kl_vif
 *
vif
)

2262 
©h6kl
 *
¨
 = 
vif
->ar;

2263 i‡(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
)) {

2264 
	`©h6kl_îr
("wmi isÇotÑeady\n");

2265  
Ál£
;

2267 i‡(!
	`ã°_bô
(
WLAN_ENABLED
, &
vif
->
Êags
)) {

2268 
	`©h6kl_îr
("wlan disabled\n");

2269  
Ál£
;

2271  
åue
;

2272 
	}
}

2274 
	$©h6kl_io˘l_°™d¨d
(
√t_devi˚
 *
dev
,

2275 
i‰eq
 *
rq
, 
cmd
)

2277 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

2278 *
d©a
 = (*)(
rq
->
i‰_d©a
);

2279 
ªt
 = 0;

2281 
cmd
) {

2282 
ATH6KL_IOCTL_STANDARD01
:

2284 
©h6kl_™droid_wifi_¥iv_cmd
 
™droid_cmd
;

2285 *
u£r_cmd
;

2287 i‡(
	`c›y_‰om_u£r
(&
™droid_cmd
,

2288 
d©a
,

2289 (
©h6kl_™droid_wifi_¥iv_cmd
)))

2290 
ªt
 = -
EIO
;

2292 
u£r_cmd
 = 
	`kzÆloc
(
™droid_cmd
.
tŸÆ_Àn
, 
GFP_KERNEL
);

2293 i‡(!
u£r_cmd
) {

2294 
ªt
 = -
ENOMEM
;

2298 i‡(
	`c›y_‰om_u£r
(
u£r_cmd
,

2299 
™droid_cmd
.
buf
,

2300 
™droid_cmd
.
u£d_Àn
))

2301 
ªt
 = -
EIO
;

2303 i‡(
	`°r°r
(
u£r_cmd
, "P2P_SET_PS "))

2304 
ªt
 = 
	`©h6kl_io˘l_p2p_£t_ps
(
vif
,

2305 (
u£r_cmd
 + 11),

2306 (
™droid_cmd
.
u£d_Àn
 - 11));

2307 i‡(
	`°r°r
(
u£r_cmd
, "SETBAND "))

2308 
ªt
 = 
	`©h6kl_io˘l_£tb™d
(
vif
,

2309 (
u£r_cmd
 + 8),

2310 (
™droid_cmd
.
u£d_Àn
 - 8));

2311 i‡(
	`°r°r
(
u£r_cmd
, "SETRTS "))

2312 
ªt
 = 
	`©h6kl_io˘l_£åts
(
vif
,

2313 (
u£r_cmd
 + 7),

2314 (
™droid_cmd
.
u£d_Àn
 - 7));

2315 i‡(
	`°r°r
(
u£r_cmd
, "P2P_DEV_ADDR"))

2316 
ªt
 = 
	`©h6kl_io˘l_p2p_dev_addr
(
vif
,

2317 
u£r_cmd
,

2318 
™droid_cmd
.
buf
);

2319 i‡(
	`°r°r
(
u£r_cmd
, "P2P_BEST_CHANNEL"))

2320 
ªt
 = 
	`©h6kl_io˘l_p2p_be°_ch™
(
vif
,

2321 
u£r_cmd
,

2322 
™droid_cmd
.
buf
,

2323 
™droid_cmd
.
u£d_Àn
);

2324 i‡(
	`°r°r
(
u£r_cmd
, "ACL "))

2325 
ªt
 = 
	`©h6kl_io˘l_≠_a˛
(
vif
,

2326 (
u£r_cmd
 + 4),

2327 
NULL
,

2328 (
™droid_cmd
.
u£d_Àn
 - 4));

2329 i‡(
	`°r°r
(
u£r_cmd
, "SET_AP_WPS_P2P_IE"))

2330 
ªt
 = 0;

2331 #ifde‡
CONFIG_ANDROID


2332 i‡(
	`°r°r
(
u£r_cmd
, "SET_BT_ON ")) {

2333 
©h6kl_bt_⁄
 =

2334 (
u£r_cmd
[10] == '1') ? 1 : 0;

2335 
ªt
 = 0;

2339 
	`©h6kl_dbg
(
ATH6KL_DBG_TRC
,

2341 
u£r_cmd
);

2343 
ªt
 = -
EOPNOTSUPP
;

2347 
	`k‰ì
(
u£r_cmd
);

2351 
ATH6KL_IOCTL_STANDARD02
:

2353 
©h6kl_io˘l_cmd
 
io˘l_cmd
;

2355 i‡(
	`c›y_‰om_u£r
(&
io˘l_cmd
,

2356 
d©a
,

2357 (
©h6kl_io˘l_cmd
)))

2358 
ªt
 = -
EIO
;

2360 
io˘l_cmd
.
subcmd
) {

2361 
ATH6KL_IOCTL_AP_APSD
:

2362 
	`©h6kl_wmi_≠_£t_≠sd
(
vif
->
¨
->
wmi
,

2363 
vif
->
fw_vif_idx
,

2364 
io˘l_cmd
.
›ti⁄s
);

2366 
ATH6KL_IOCTL_AP_INTRABSS
:

2367 
vif
->
öåa_bss
 = 
io˘l_cmd
.
›ti⁄s
;

2370 
ªt
 = -
EOPNOTSUPP
;

2376 
ATH6KL_IOCTL_STANDARD03
:

2378 
btc€x_io˘l
 
btc€x_cmd
;

2379 *
u£r_cmd
;

2381 i‡(
	`c›y_‰om_u£r
(&
btc€x_cmd
,

2382 
d©a
,

2383 (
btc€x_io˘l
)))

2384 
ªt
 = -
EIO
;

2386 
u£r_cmd
 = 
	`kzÆloc
(
btc€x_cmd
.
cmd_Àn
, 
GFP_KERNEL
);

2387 i‡(!
u£r_cmd
) {

2388 
ªt
 = -
ENOMEM
;

2391 i‡(
	`c›y_‰om_u£r
(
u£r_cmd
,

2392 
btc€x_cmd
.
cmd
,

2393 
btc€x_cmd
.
cmd_Àn
))

2394 
ªt
 = -
EIO
;

2396 i‡(!
	`©h6kl_io˘l_ªady
(
vif
))

2397  -
EIO
;

2399 i‡(
	`down_öãºu±ibÀ
(&
vif
->
¨
->
£m
)) {

2400 
	`©h6kl_îr
("busy, couldn't getáccess\n");

2401  -
ERESTARTSYS
;

2404 
ªt
 = 
	`©h6kl_wmi_£nd_btc€x_cmd
(
vif
->
¨
,

2405 (
u8
 *)
u£r_cmd
, 
btc€x_cmd
.
cmd_Àn
);

2407 
	`up
(&
vif
->
¨
->
£m
);

2409 
	`k‰ì
(
u£r_cmd
);

2414 #i‡
	`deföed
(
ATHTST_SUPPORT
Ë|| deföed(
ACL_SUPPORT
)

2415  
	`©h6kl_˚_io˘l
(
dev
, 
rq
, 
cmd
);

2417 
ªt
 = -
EOPNOTSUPP
;

2422  
ªt
;

2423 
	}
}

2425 
	$©h6kl_io˘l_lök•ìd
(
√t_devi˚
 *
dev
,

2426 
i‰eq
 *
rq
,

2427 
cmd
)

2429 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

2430 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

2431 
iwªq
 *
ªq
 = (iwªq *)(
rq
);

2432 
u£r_cmd
[32];

2433 
u8
 
maˇddr
[6];

2434 
À·
;

2435 
s32
 
øã
 = 0;

2438 i‡(
¨
->
èrgë_ty≥
 !
TARGET_TYPE_AR6004
)

2439  -
EOPNOTSUPP
;

2441 i‡((!
ªq
->
u
.
d©a
.
poöãr
Ë|| (!ªq->u.d©a.
Àngth
))

2442  -
EFAULT
;

2444 
	`mem£t
(
u£r_cmd
, 0, 32);

2445 i‡(
	`c›y_‰om_u£r
(
u£r_cmd
,

2446 
ªq
->
u
.
d©a
.
poöãr
,

2447 
ªq
->
u
.
d©a
.
Àngth
))

2448  -
EFAULT
;

2450 i‡(
	`_°rög_to_mac
(
u£r_cmd
, 
ªq
->
u
.
d©a
.
Àngth
, 
maˇddr
))

2451  -
EFAULT
;

2453 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
))

2454  -
EBUSY
;

2456 #ifde‡
CONFIG_ANDROID


2461 i‡((
¨
->
p2p
) &&

2462 (!
¨
->
p2p_com∑t
) &&

2463 (
¨
->
p2p_c⁄cuºít
) &&

2464 (
¨
->
p2p_dediˇã
)) {

2465 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
,ár->
vif_max
 - 2);

2466 i‡(!
vif
) {

2467 
	`up
(&
¨
->
£m
);

2468  -
EFAULT
;

2473 
	`£t_bô
(
STATS_UPDATE_PEND
, &
vif
->
Êags
);

2475 i‡(
	`©h6kl_wmi_gë_°©s_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
) != 0) {

2476 
	`up
(&
¨
->
£m
);

2477  -
EIO
;

2480 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

2481 !
	`ã°_bô
(
STATS_UPDATE_PEND
,

2482 &
vif
->
Êags
),

2483 
WMI_TIMEOUT
);

2485 
	`up
(&
¨
->
£m
);

2487 i‡(
À·
 == 0)

2488  -
ETIMEDOUT
;

2489 i‡(
À·
 < 0)

2490  
À·
;

2492 
	`mem£t
(
u£r_cmd
, 0, 32);

2493 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

2494 
wmi_≠_mode_°©
 *
≠
 = &
vif
->
≠_°©s
;

2495 
©h6kl_°a
 *
c⁄n
;

2497 
c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, 
maˇddr
);

2498 i‡(
c⁄n
) {

2499 
À·
 = 0;Üe· < 
AP_MAX_NUM_STA
;Üeft++) {

2500 i‡(
c⁄n
->
aid
 =
≠
->
°a
[
À·
].aid) {

2501 
øã
 = 
	`©h6kl_wmi_gë_øã_¨6004
(

2502 
≠
->
°a
[
À·
].
tx_uˇ°_øã
);

2507 
	`WARN_ON
(
À·
 =
AP_MAX_NUM_STA
);

2510 
øã
 = 
vif
->
èrgë_°©s
.
tx_uˇ°_øã
;

2512 
	`¢¥ötf
(
u£r_cmd
, 32, "%u", 
øã
 / 1000);

2513 
ªq
->
u
.
d©a
.
Àngth
 = 
	`°æí
(
u£r_cmd
);

2514 
u£r_cmd
[
ªq
->
u
.
d©a
.
Àngth
] = '\0';

2516  
	`c›y_to_u£r
(
ªq
->
u
.
d©a
.
poöãr
,

2517 
u£r_cmd
,

2518 
ªq
->
u
.
d©a
.
Àngth
 + 1Ë? -
EFAULT
 : 0;

2519 
	}
}

2521 
	$©h6kl_io˘l_gë_if_‰eq
(
√t_devi˚
 *
dev
,

2522 
i‰eq
 *
rq
,

2523 
cmd
)

2525 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

2526 
iwªq
 *
ªq
 = (iwªq *)(
rq
);

2527 
u16
 
‰eq
;

2529 i‡(
vif
->
bss_ch
 == 0) {

2530  -
EINVAL
;

2532 
‰eq
 = 
vif
->
bss_ch
;

2533  
	`c›y_to_u£r
(
ªq
->
u
.
d©a
.
poöãr
, &
‰eq
, (freq));

2535 
	}
}

2537 
	$©h6kl_io˘l
(
√t_devi˚
 *
dev
, 
i‰eq
 *
rq
, 
cmd
)

2539 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

2540 
ªt
 = 
åue
;

2541 
s8
 *
u£rd©a
;

2548 
	`dev_hﬁd
(
dev
);

2549 
	`π∆_u∆ock
();

2551 
cmd
) {

2552 
ATH6KL_IOCTL_STANDARD01
:

2553 
ATH6KL_IOCTL_STANDARD02
:

2555 
ATH6KL_IOCTL_STANDARD03
:

2556 
ATH6KL_IOCTL_STANDARD12
:

2557 #ifde‡
ATHTST_SUPPORT


2558 
ATHCFG_WCMD_IOCTL
:

2560 
ATH6KL_IOCTL_STANDARD15
:

2562 #ifde‡
CE_SUPPORT


2563 
IEEE80211_IOCTL_KICKMAC
:

2565 #ifde‡
ACL_SUPPORT


2566 
IEEE80211_IOCTL_SETPARAM
:

2567 
IEEE80211_IOCTL_GETPARAM
:

2568 
IEEE80211_IOCTL_SETMLME
:

2569 
IEEE80211_IOCTL_ADDMAC
:

2570 
IEEE80211_IOCTL_DELMAC
:

2571 
IEEE80211_IOCTL_GET_MACADDR
:

2573 #ifde‡
TX99_SUPPORT


2574 
SIOCIOCTLTX99
:

2576 
ATH6KL_IOCTL_STANDARD13
:

2578 
ªt
 = 
	`©h6kl_io˘l_°™d¨d
(
dev
, 
rq
, 
cmd
);

2580 #i‚de‡
CE_SUPPORT


2581 
ATH6KL_IOCTL_WEXT_PRIV6
:

2582 
ªt
 = 
	`©h6kl_io˘l_gë_if_‰eq
(
dev
, 
rq
, 
cmd
);

2585 
ATH6KL_IOCTL_WEXT_PRIV26
:

2586 
	`gë_u£r
(
cmd
, (*)
rq
->
i‰_d©a
);

2587 
u£rd©a
 = (*)(((*)
rq
->
i‰_d©a
)+1);

2589 
cmd
) {

2590 
ATH6KL_XIOCTL_TRAFFIC_ACTIVITY_CHANGE
:

2591 i‡(
¨
->
htc_èrgë
 !
NULL
) {

2592 
©h6kl_åaffic_a˘ivôy_ch™ge
 
d©a
;

2593 i‡(
	`c›y_‰om_u£r
(&
d©a
,

2594 
u£rd©a
,

2595 (
d©a
))) {

2596 
ªt
 = -
EFAULT
;

2597 
io˘l_d⁄e
;

2599 
	`©h6kl_htc_ödiˇã_a˘ivôy_ch™ge
(

2600 
¨
->
htc_èrgë
,

2601 (
u8
)
d©a
.
°ªam_id
,

2602 
d©a
.
a˘ive
 ?

2603 
åue
 : 
Ál£
);

2608 
ATH6KL_IOCTL_WEXT_PRIV27
:

2609 
ATH6KL_IOCTL_WEXT_PRIV31
:

2610 
ªt
 = 
	`©h6kl_io˘l_lök•ìd
(
dev
, 
rq
, 
cmd
);

2613 
ªt
 = -
EOPNOTSUPP
;

2614 
io˘l_d⁄e
;

2617 
io˘l_d⁄e
:

2618 
	`π∆_lock
();

2619 
	`dev_put
(
dev
);

2621  
ªt
;

2622 
	}
}

2624 
√t_devi˚_›s
 
	g©h6kl_√tdev_›s
 = {

2625 .
ndo_›í
 = 
©h6kl_›í
,

2626 .
	gndo_°›
 = 
©h6kl_˛o£
,

2627 .
	gndo_°¨t_xmô
 = 
©h6kl_°¨t_tx
,

2628 .
	gndo_gë_°©s
 = 
©h6kl_gë_°©s
,

2629 .
	gndo_do_io˘l
 = 
©h6kl_io˘l
,

2632 
	$öô_√tdev
(
√t_devi˚
 *
dev
)

2634 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

2636 
vif
->
√eded_hódroom
 = 
ETH_HLEN
 +

2637 (
©h6kl_Œc_¢≠_hdr
) +

2638 (
wmi_d©a_hdr
) +

2639 
HTC_HDR_LENGTH
 +

2640 
WMI_MAX_TX_META_SZ
 +

2641 
ATH6KL_HTC_ALIGN_BYTES
;

2643 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


2644 
dev
->
›í
 = 
©h6kl_›í
;

2645 
dev
->
°›
 = 
©h6kl_˛o£
;

2646 
dev
->
h¨d_°¨t_xmô
 = 
©h6kl_°¨t_tx
;

2647 
dev
->
gë_°©s
 = 
©h6kl_gë_°©s
;

2648 
dev
->
do_io˘l
 = 
©h6kl_io˘l
;

2650 
dev
->
√tdev_›s
 = &
©h6kl_√tdev_›s
;

2651 
dev
->
√eded_hódroom
 = 
vif
->needed_headroom;

2654 
dev
->
de°ru˘‹
 = 
‰ì_√tdev
;

2655 
dev
->
w©chdog_timeo
 = 
ATH6KL_TX_TIMEOUT
;

2658 
	}
}

	@msm.c

16 #ifde‡
CONFIG_ANDROID_8960_SDIO


17 
	~"c‹e.h
"

20 #ifde‡
CONFIG_MMC_MSM_SDC3_POLLING


21 
	#MMC_MSM_DEV
 "msm_sdcc.3"

	)

23 
	#MMC_MSM_DEV
 "msm_sdcc.4"

	)

28 
	~"c‹e.h
"

29 
	~"debug.h
"

30 
	~<löux/moduÀ.h
>

31 
	~<löux/devi˚.h
>

32 
	~<löux/∂©f‹m_devi˚.h
>

33 
	~<löux/wœn_∂©.h
>

34 
	~<mach/msm_bus.h
>

35 
	~<löux/gpio.h
>

36 
	~<löux/of.h
>

37 
	~<löux/of_gpio.h
>

38 
	~<löux/ªguœt‹/c⁄sumî.h
>

39 
	~<löux/ªguœt‹/drivî.h
>

41 
	#GET_INODE_FROM_FILEP
(
fûp
Ë((fûp)->
f_∑th
.
díåy
->
d_öode
)

	)

43 
	$™droid_ªadwrôe_fûe
(c⁄° *
fûíame
, *
rbuf
,

44 c⁄° *
wbuf
, 
size_t
 
Àngth
)

46 
ªt
 = 0;

47 
fûe
 *
fûp
 = (fûê*)-
ENOENT
;

48 
mm_£gmít_t
 
ﬁdfs
;

49 
ﬁdfs
 = 
	`gë_fs
();

50 
	`£t_fs
(
KERNEL_DS
);

53 
mode
 = (
wbuf
Ë? 
O_WRONLY
 : 
O_RDONLY
;

54 
fûp
 = 
	`fûp_›í
(
fûíame
, 
mode
, 
S_IRUSR
);

56 i‡(
	`IS_ERR
(
fûp
Ë|| !fûp->
f_›
) {

57 
ªt
 = -
ENOENT
;

61 i‡(!
fûp
->
f_›
->
wrôe
 || !fûp->f_›->
ªad
) {

62 
	`fûp_˛o£
(
fûp
, 
NULL
);

63 
ªt
 = -
ENOENT
;

67 i‡(
Àngth
 == 0) {

69 
öode
 *inode;

71 
öode
 = 
	`GET_INODE_FROM_FILEP
(
fûp
);

72 i‡(!
öode
) {

73 
	`¥ötk
(
KERN_ERR


75 
ªt
 = -
ENOENT
;

78 
ªt
 = 
	`i_size_ªad
(
öode
->
i_m≠pög
->
ho°
);

82 i‡(
wbuf
) {

83 
ªt
 = 
fûp
->
f_›
->
	`wrôe
(

84 
fûp
, 
wbuf
, 
Àngth
, &fûp->
f_pos
);

85 i‡(
ªt
 < 0) {

86 
	`¥ötk
(
KERN_ERR


91 
ªt
 = 
fûp
->
f_›
->
	`ªad
(

92 
fûp
, 
rbuf
, 
Àngth
, &fûp->
f_pos
);

93 i‡(
ªt
 < 0) {

94 
	`¥ötk
(
KERN_ERR


101 i‡(!
	`IS_ERR
(
fûp
))

102 
	`fûp_˛o£
(
fûp
, 
NULL
);

104 
	`£t_fs
(
ﬁdfs
);

105 
	`¥ötk
(
KERN_ERR
 "™droid_ªadwrôe_fûe:Ñë=%d\n", 
ªt
);

107  
ªt
;

108 
	}
}

110 #ifde‡
CONFIG_ANDROID_8960_SDIO


111 
wifi_∂©f‹m_d©a
 *
	gwifi_c⁄åﬁ_d©a
;

112 
£m≠h‹e
 
	gwifi_c⁄åﬁ_£m
;

114 
	$wifi_£t_powî
(
⁄
, 
m£c
)

116 i‡(
wifi_c⁄åﬁ_d©a
 && wifi_c⁄åﬁ_d©a->
£t_powî
)

117 
wifi_c⁄åﬁ_d©a
->
	`£t_powî
(
⁄
);

119 i‡(
m£c
)

120 
	`mdñay
(
m£c
);

122 
	}
}

124 
	$wifi_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

126 
wifi_∂©f‹m_d©a
 *
wifi_˘æ
 =

127 (
wifi_∂©f‹m_d©a
 *)(
pdev
->
dev
.
∂©f‹m_d©a
);

129 
wifi_c⁄åﬁ_d©a
 = 
wifi_˘æ
;

131 
	`wifi_£t_powî
(1, 0);

133 
	`up
(&
wifi_c⁄åﬁ_£m
);

135 
	}
}

137 
	$wifi_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

139 
wifi_∂©f‹m_d©a
 *
wifi_˘æ
 =

140 (
wifi_∂©f‹m_d©a
 *)(
pdev
->
dev
.
∂©f‹m_d©a
);

142 
wifi_c⁄åﬁ_d©a
 = 
wifi_˘æ
;

144 
	`wifi_£t_powî
(0, 0);

146 
	`up
(&
wifi_c⁄åﬁ_£m
);

148 
	}
}

150 
∂©f‹m_drivî
 
	gwifi_devi˚
 = {

151 .
¥obe
 = 
wifi_¥obe
,

152 .
	gªmove
 = 
wifi_ªmove
,

153 .
	gdrivî
 = {

154 .
«me
 = "ath6kl_power",

158 
__öô
 
	$©h6kl_sdio_öô_msm
()

160 
buf
[3];

161 
Àngth
;

162 
ªt
;

164 
	`£ma_öô
(&
wifi_c⁄åﬁ_£m
, 1);

165 
	`down
(&
wifi_c⁄åﬁ_£m
);

167 
ªt
 = 
	`∂©f‹m_drivî_¥obe
(&
wifi_devi˚
, 
wifi_¥obe
);

168 i‡(
ªt
) {

169 
	`¥ötk
(
KERN_INFO
 "platform_driver_register failed\n");

174 i‡(
	`down_timeout
(&
wifi_c⁄åﬁ_£m
, 
	`m£cs_to_jiffõs
(5000)) != 0) {

175 
ªt
 = -
EINVAL
;

176 
	`¥ötk
(
KERN_INFO
 "platform_driver_registerÅimeout\n");

180 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%d\n", 1 ? 1 : 0);

181 
	`™droid_ªadwrôe_fûe
("/sys/devi˚s/∂©f‹m/" 
MMC_MSM_DEV


182 "/pﬁlög", 
NULL
, 
buf
, 
Àngth
);

183 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%d\n", 0 ? 1 : 0);

184 
	`™droid_ªadwrôe_fûe
("/sys/devi˚s/∂©f‹m/" 
MMC_MSM_DEV


185 "/pﬁlög", 
NULL
, 
buf
, 
Àngth
);

187 
	`mdñay
(500);

188 
	}
}

190 
__exô
 
	$©h6kl_sdio_exô_msm
()

192 
buf
[3];

193 
Àngth
;

194 
ªt
;

196 
	`∂©f‹m_drivî_uƒegi°î
(&
wifi_devi˚
);

199 i‡(
	`down_timeout
(&
wifi_c⁄åﬁ_£m
, 
	`m£cs_to_jiffõs
(5000)) != 0) {

200 
ªt
 = -
EINVAL
;

201 
	`¥ötk
(
KERN_INFO
 "platform_driver_unregisterÅimeout\n");

205 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%d\n", 1 ? 1 : 0);

207 
	`™droid_ªadwrôe_fûe
("/sys/devi˚s/∂©f‹m/" 
MMC_MSM_DEV


208 "/pﬁlög", 
NULL
, 
buf
, 
Àngth
);

209 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%d\n", 0 ? 1 : 0);

211 
	`™droid_ªadwrôe_fûe
("/sys/devi˚s/∂©f‹m/" 
MMC_MSM_DEV


212 "/pﬁlög", 
NULL
, 
buf
, 
Àngth
);

213 
	`mdñay
(1000);

215 
	}
}

218 #ifde‡
ATH6KL_BUS_VOTE


219 
u32
 
	gbus_≥rf_˛õ¡
;

220 
msm_bus_sˇÀ_pd©a
 *
	g©h6kl_bus_sˇÀ_pd©a
;

222 
u8
 *
	g∂©f‹m_has_vªg
;

225 
	#VDD_PA_MAX_VOLTAGE
 3300000

	)

226 
	#VDD_PA_MIN_VOLTAGE
 3000000

	)

227 
	#VDD_IO_MAX_VOLTAGE
 1800000

	)

228 
	#VDD_IO_MIN_VOLTAGE
 1800000

	)

230 
	s©h6kl_powî_vªg_d©a
 {

232 
ªguœt‹
 *
	mªg
;

235 c⁄° *
	m«me
;

238 
	mlow_vﬁ_Àvñ
;

239 
	mhigh_vﬁ_Àvñ
;

251 
boﬁ
 
	m£t_vﬁège_sup
;

254 
boﬁ
 
	mis_íabÀd
;

257 
	s©h6kl_ªg_d©a
 {

259 c⁄° *
	m«me
;

262 
u32
 
	mlow_vﬁ_Àvñ
;

263 
u32
 
	mhigh_vﬁ_Àvñ
;

266 
ªguœt‹
 *
	mªg
;

269 
	s©h6kl_∂©f‹m_d©a
 {

270 
∂©f‹m_devi˚
 *
	mpdev
;

271 
©h6kl_powî_vªg_d©a
 *
	mwifi_chù_pwd
;

272 
©h6kl_powî_vªg_d©a
 *
	mwifi_vdd∑
;

273 
©h6kl_powî_vªg_d©a
 *
	mwifi_vddio
;

276 
©h6kl_∂©f‹m_d©a
 *
	ggpd©a
;

278 
	#MAX_PROP_SIZE
 32

	)

279 
	$©h6kl_dt_∑r£_vªg_öfo
(
devi˚
 *
dev
,

280 
©h6kl_powî_vªg_d©a
 **
vªg_d©a
, c⁄° *
vªg_«me
)

282 
Àn
, 
ªt
 = 0;

283 c⁄° 
__be32
 *
¥›
;

284 
¥›_«me
[
MAX_PROP_SIZE
];

285 
©h6kl_powî_vªg_d©a
 *
vªg
;

286 
devi˚_node
 *
≈
 = 
dev
->
of_node
;

288 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "vªg devÅªê∑r£ f‹ %s\n", 
vªg_«me
);

290 
	`¢¥ötf
(
¥›_«me
, 
MAX_PROP_SIZE
, "%s-suµly", 
vªg_«me
);

291 i‡(
	`of_∑r£_ph™dÀ
(
≈
, 
¥›_«me
, 0)) {

292 
vªg
 = 
	`devm_kzÆloc
(
dev
, (*vªg), 
GFP_KERNEL
);

293 i‡(!
vªg
) {

294 
	`©h6kl_îr
("Nÿmem‹y f‹ vªg: %s\n", 
vªg_«me
);

295 
ªt
 = -
ENOMEM
;

296 
îr
;

299 
vªg
->
«me
 = 
vªg_«me
;

301 
	`¢¥ötf
(
¥›_«me
, 
MAX_PROP_SIZE
,

302 "%s-vﬁège-Àvñ", 
vªg_«me
);

303 
¥›
 = 
	`of_gë_¥›îty
(
≈
, 
¥›_«me
, &
Àn
);

304 i‡(!
¥›
 || (
Àn
 !(2 * (
__be32
)))) {

305 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "%s %sÖroperty\n",

306 
¥›
 ? "övÆid f‹m©" : "no", 
¥›_«me
);

308 
vªg
->
low_vﬁ_Àvñ
 = 
	`be32_to_˝up
(&
¥›
[0]);

309 
vªg
->
high_vﬁ_Àvñ
 = 
	`be32_to_˝up
(&
¥›
[1]);

312 *
vªg_d©a
 = 
vªg
;

313 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "%s: vol=[%d %d]uV\n",

314 
vªg
->
«me
, vªg->
low_vﬁ_Àvñ
,

315 
vªg
->
high_vﬁ_Àvñ
);

317 
	`©h6kl_öfo
("%s: i†nŸÖrovided i¿devi˚Åªe\n", 
vªg_«me
);

319 
îr
:

320  
ªt
;

321 
	}
}

323 
	$©h6kl_vªg_dißbÀ
(
©h6kl_powî_vªg_d©a
 *
vªg
)

325 
rc
 = 0;

327 i‡(!
vªg
)

328  
rc
;

330 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "vªg_dißbÀ f‹ : %s\n", 
vªg
->
«me
);

332 i‡(
vªg
->
is_íabÀd
) {

333 
rc
 = 
	`ªguœt‹_dißbÀ
(
vªg
->
ªg
);

334 i‡(
rc
) {

335 
	`©h6kl_îr
("regulator_disable(%s) failed.Ñc=%d\n",

336 
vªg
->
«me
, 
rc
);

337 
out
;

339 
vªg
->
is_íabÀd
 = 
Ál£
;

341 i‡(
vªg
->
£t_vﬁège_sup
) {

343 
rc
 = 
	`ªguœt‹_£t_vﬁège
(
vªg
->
ªg
,

345 
vªg
->
high_vﬁ_Àvñ
);

346 i‡(
rc
) {

347 
	`©h6kl_îr
("vreg_set_vol(%s) failedÑc=%d\n",

348 
vªg
->
«me
, 
rc
);

349 
out
;

355 
out
:

356  
rc
;

357 
	}
}

359 
	$©h6kl_vªg_öô
(
©h6kl_powî_vªg_d©a
 *
vªg
)

361 
rc
 = 0;

362 
devi˚
 *
dev
 = &(
gpd©a
->
pdev
->dev);

364 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "vªg_gë f‹ : %s\n", 
vªg
->
«me
);

367 
vªg
->
ªg
 = 
	`ªguœt‹_gë
(
dev
, vªg->
«me
);

368 i‡(
	`IS_ERR
(
vªg
->
ªg
)) {

369 
rc
 = 
	`PTR_ERR
(
vªg
->
ªg
);

370 
	`©h6kl_îr
("%s:Ñegulator_get(%s) failed.Ñc=%d\n",

371 
__func__
, 
vªg
->
«me
, 
rc
);

372 
out
;

375 i‡((
	`ªguœt‹_cou¡_vﬁèges
(
vªg
->
ªg
) > 0)

376 && (
vªg
->
low_vﬁ_Àvñ
Ë&& (vªg->
high_vﬁ_Àvñ
))

377 
vªg
->
£t_vﬁège_sup
 = 1;

379 
out
:

380  
rc
;

381 
	}
}

383 
	$©h6kl_vªg_íabÀ
(
©h6kl_powî_vªg_d©a
 *
vªg
)

385 
rc
 = 0;

387 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "vªg_í f‹ : %s\n", 
vªg
->
«me
);

389 i‡(!
vªg
->
is_íabÀd
) {

390 i‡(
vªg
->
£t_vﬁège_sup
) {

391 
rc
 = 
	`ªguœt‹_£t_vﬁège
(
vªg
->
ªg
,

392 
vªg
->
low_vﬁ_Àvñ
,

393 
vªg
->
high_vﬁ_Àvñ
);

394 i‡(
rc
) {

395 
	`©h6kl_îr
("vreg_set_vol(%s) failedÑc=%d\n",

396 
vªg
->
«me
, 
rc
);

397 
out
;

401 
rc
 = 
	`ªguœt‹_íabÀ
(
vªg
->
ªg
);

402 i‡(
rc
) {

403 
	`©h6kl_îr
("regulator_enable(%s) failed.Ñc=%d\n",

404 
vªg
->
«me
, 
rc
);

405 
out
;

407 
vªg
->
is_íabÀd
 = 
åue
;

409 
out
:

410  
rc
;

411 
	}
}

413 
	$©h6kl_c⁄figuª_vªg
(
©h6kl_powî_vªg_d©a
 *
vªg
)

415 
rc
 = 0;

417 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "c⁄fig %s\n", 
vªg
->
«me
);

420 i‡(!(
vªg
->
ªg
)) {

421 
rc
 = 
	`©h6kl_vªg_öô
(
vªg
);

422 i‡(
rc
 < 0)

423  
rc
;

426 
rc
 = 
	`©h6kl_vªg_íabÀ
(
vªg
);

427 i‡(
rc
 < 0)

428  
rc
;

430  
rc
;

431 
	}
}

433 
	$©h6kl_∂©f‹m_powî
(
©h6kl_∂©f‹m_d©a
 *
pd©a
, 
⁄
)

435 
rc
 = 0;

437 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "%†⁄: %d\n", 
__func__
, 
⁄
);

439 i‡(
⁄
) {

440 i‡(
pd©a
->
wifi_vdd∑
 !
NULL
) {

442 
rc
 = 
	`©h6kl_c⁄figuª_vªg
(
pd©a
->
wifi_vdd∑
);

443 i‡(
rc
 < 0) {

444 
	`©h6kl_îr
("power on wifi_vddpaÉrror\n");

445 
chù_pwd_Áû
;

448 
	`ªguœt‹_£t_vﬁège
(
pd©a
->
wifi_vdd∑
->
ªg
,

449 
VDD_PA_MAX_VOLTAGE
, VDD_PA_MAX_VOLTAGE);

452 i‡(
pd©a
->
wifi_vddio
 !
NULL
) {

454 
rc
 = 
	`©h6kl_c⁄figuª_vªg
(
pd©a
->
wifi_vddio
);

455 i‡(
rc
 < 0) {

456 
	`©h6kl_îr
("power on wifi_vddioÉrror\n");

457 
chù_pwd_Áû
;

460 
	`ªguœt‹_£t_vﬁège
(
pd©a
->
wifi_vddio
->
ªg
,

461 
VDD_IO_MAX_VOLTAGE
, VDD_IO_MAX_VOLTAGE);

465 
	`mdñay
(100);

467 
rc
 = 
	`©h6kl_c⁄figuª_vªg
(
pd©a
->
wifi_chù_pwd
);

468 i‡(
rc
 < 0) {

469 
	`©h6kl_îr
("power on chip_pwdÉrror\n");

470 
chù_pwd_Áû
;

474 
rc
 = 
	`©h6kl_vªg_dißbÀ
(
pd©a
->
wifi_chù_pwd
);

477 i‡(
pd©a
->
wifi_vdd∑
 !
NULL
 &&

478 !
	`IS_ERR
(
pd©a
->
wifi_vdd∑
->
ªg
)) {

479 
	`ªguœt‹_£t_vﬁège
(
pd©a
->
wifi_vdd∑
->
ªg
,

480 
VDD_PA_MIN_VOLTAGE
, 
VDD_PA_MAX_VOLTAGE
);

481 
rc
 = 
	`©h6kl_vªg_dißbÀ
(
pd©a
->
wifi_vdd∑
);

485 i‡(
pd©a
->
wifi_vddio
 !
NULL
 &&

486 !
	`IS_ERR
(
pd©a
->
wifi_vddio
->
ªg
)) {

487 
	`ªguœt‹_£t_vﬁège
(
pd©a
->
wifi_vddio
->
ªg
,

488 
VDD_IO_MIN_VOLTAGE
, 
VDD_IO_MAX_VOLTAGE
);

489 
rc
 = 
	`©h6kl_vªg_dißbÀ
(
pd©a
->
wifi_vddio
);

493  
rc
;

495 
chù_pwd_Áû
:

496 
	`©h6kl_vªg_dißbÀ
(
pd©a
->
wifi_chù_pwd
);

498  
rc
;

499 
	}
}

501 #ifde‡
ATH6KL_HSIC_RECOVER


502 
	$©h6kl_hsic_ªdiscovîy
()

504 #ifde‡
ATH6KL_BUS_VOTE


505 
	`mdñay
(100);

506 
	`©h6kl_hsic_böd
(0);

509 
	`mdñay
(1000);

510 
	`©h6kl_hsic_böd
(1);

512 
	}
}

516 #ifde‡
ATH6KL_BUS_VOTE


518 
boﬁ
 
	g¥evious
;

519 
	$©h6kl_toggÀ_ødio
(*
d©a
, 
⁄
)

521 
ªt
 = 0;

522 (*
powî_c⁄åﬁ
)(
íabÀ
);

524 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "%sÅoggleÑatio %s\n",

525 
__func__
, 
⁄
 ? "on" : "off");

527 
powî_c⁄åﬁ
 = 
d©a
;

528 i‡(
¥evious
 !
⁄
)

529 
ªt
 = (*
powî_c⁄åﬁ
)(
⁄
);

530 i‡(!
ªt
)

531 
¥evious
 = 
⁄
;

532  
ªt
;

533 
	}
}

535 
	$©h6kl_hsic_böd
(
böd
)

537 
buf
[16];

538 
Àngth
;

540 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "%s, böd: %d\n", 
__func__
, 
böd
);

542 i‡(
böd
) {

543 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%s\n", "msm_hsic_host");

545 
	`™droid_ªadwrôe_fûe
(

547 
NULL
, 
buf
, 
Àngth
);

549 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%s\n", "msm_hsic_host");

551 
	`™droid_ªadwrôe_fûe
(

553 
NULL
, 
buf
, 
Àngth
);

557 
	}
}

559 
	$©h6kl_hsic_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

561 
©h6kl_∂©f‹m_d©a
 *
pd©a
 = 
NULL
;

562 
devi˚
 *
dev
 = &
pdev
->dev;

563 
ªt
 = 0;

565 i‡(
	`machöe_is_≠q8064_dma
()) {

566 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "%s\n", 
__func__
);

567 
¥evious
 = 0;

568 
	`©h6kl_toggÀ_ødio
(
pdev
->
dev
.
∂©f‹m_d©a
, 1);

571 
©h6kl_bus_sˇÀ_pd©a
 = 
	`msm_bus_˛_gë_pd©a
(
pdev
);

572 
bus_≥rf_˛õ¡
 =

573 
	`msm_bus_sˇÀ_ªgi°î_˛õ¡
(

574 
©h6kl_bus_sˇÀ_pd©a
);

575 
	`msm_bus_sˇÀ_˛õ¡_upd©e_ªque°
(
bus_≥rf_˛õ¡
, 4);

577 
pd©a
 = 
	`devm_kzÆloc
(
dev
, (*pd©a), 
GFP_KERNEL
);

579 i‡(!
pd©a
) {

580 
	`©h6kl_îr
("%s: CouldÇotállocate memory forÖlatform data\n",

581 
__func__
);

582  -
ENOMEM
;

585 i‡(
	`©h6kl_dt_∑r£_vªg_öfo
(
dev
, &
pd©a
->
wifi_chù_pwd
,

587 
	`©h6kl_îr
("%s:Öarse vreg info for %sÉrror\n",

588 "chù_pwd", 
__func__
);

589 
îr
;

592 i‡(
	`©h6kl_dt_∑r£_vªg_öfo
(
dev
, &
pd©a
->
wifi_vdd∑
,

594 
	`©h6kl_îr
("%s:Öarse vreg info for %sÉrror\n",

595 "vdd∑", 
__func__
);

596 
îr
;

599 i‡(
	`©h6kl_dt_∑r£_vªg_öfo
(
dev
, &
pd©a
->
wifi_vddio
,

601 
	`©h6kl_îr
("%s:Öarse vreg info for %sÉrror\n",

602 "vddio", 
__func__
);

603 
îr
;

606 
pd©a
->
pdev
 =Ödev;

607 
	`∂©f‹m_£t_drvd©a
(
pdev
, 
pd©a
);

608 
gpd©a
 = 
pd©a
;

610 i‡(
pd©a
->
wifi_chù_pwd
 !
NULL
) {

611 
ªt
 = 
	`©h6kl_∂©f‹m_powî
(
pd©a
, 1);

613 i‡(
ªt
 =0 && 
©h6kl_bt_⁄
 == 0)

614 
	`©h6kl_hsic_böd
(1);

616 *
∂©f‹m_has_vªg
 = 1;

620  
ªt
;

622 
îr
:

623 i‡(
pd©a
 !
NULL
)

624 
	`devm_k‰ì
(
dev
, 
pd©a
);

626  -
EINVAL
;

627 
	}
}

629 
	$©h6kl_hsic_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

631 
©h6kl_∂©f‹m_d©a
 *
pd©a
 = 
	`∂©f‹m_gë_drvd©a
(
pdev
);

633 i‡(
	`machöe_is_≠q8064_dma
()) {

634 
	`©h6kl_toggÀ_ødio
(
pdev
->
dev
.
∂©f‹m_d©a
, 0);

636 
	`msm_bus_sˇÀ_˛õ¡_upd©e_ªque°
(
bus_≥rf_˛õ¡
, 1);

637 i‡(
bus_≥rf_˛õ¡
)

638 
	`msm_bus_sˇÀ_uƒegi°î_˛õ¡
(
bus_≥rf_˛õ¡
);

640 i‡(
pd©a
->
wifi_chù_pwd
 !
NULL
) {

641 
ªt
;

643 
ªt
 = 
	`©h6kl_∂©f‹m_powî
(
pd©a
, 0);

645 i‡(
pd©a
->
wifi_chù_pwd
->
ªg
)

646 
	`ªguœt‹_put
(
pd©a
->
wifi_chù_pwd
->
ªg
);

648 i‡(
pd©a
->
wifi_vdd∑
 !
NULL
 &&Öd©a->wifi_vdd∑->
ªg
)

649 
	`ªguœt‹_put
(
pd©a
->
wifi_vdd∑
->
ªg
);

651 i‡(
pd©a
->
wifi_vddio
 !
NULL
 &&Öd©a->wifi_vddio->
ªg
)

652 
	`ªguœt‹_put
(
pd©a
->
wifi_vddio
->
ªg
);

654 i‡(
ªt
 =0 && 
©h6kl_bt_⁄
 == 0)

655 
	`©h6kl_hsic_böd
(0);

660 
	}
}

662 c⁄° 
of_devi˚_id
 
	g©h6kl_hsic_dt_m©ch
[] = {

663 { .
com∑tibÀ
 = "qca,ar6004-hsic",},

667 
MODULE_DEVICE_TABLE
(
of
, 
©h6kl_hsic_dt_m©ch
);

669 
∂©f‹m_drivî
 
	g©h6kl_hsic_devi˚
 = {

670 .
¥obe
 = 
©h6kl_hsic_¥obe
,

671 .
	gªmove
 = 
©h6kl_hsic_ªmove
,

672 .
	gdrivî
 = {

673 .
«me
 = "ath6kl_hsic",

674 .
	gof_m©ch_èbÀ
 = 
©h6kl_hsic_dt_m©ch
,

678 
	$©h6kl_hsic_öô_msm
(
u8
 *
has_vªg
)

680 
ªt
;

682 
∂©f‹m_has_vªg
 = 
has_vªg
;

683 
ªt
 = 
	`∂©f‹m_drivî_ªgi°î
(&
©h6kl_hsic_devi˚
);

685  
ªt
;

686 
	}
}

688 
	$©h6kl_hsic_exô_msm
()

690 
	`∂©f‹m_drivî_uƒegi°î
(&
©h6kl_hsic_devi˚
);

691 
	}
}

694 
£m≠h‹e
 
	gwifi_c⁄åﬁ_£m
;

696 
	$©h6kl_sdio_¥obe
(
∂©f‹m_devi˚
 *
pdev
)

698 
©h6kl_∂©f‹m_d©a
 *
pd©a
 = 
NULL
;

699 
devi˚
 *
dev
 = &
pdev
->dev;

700 
ªt
 = 0;

701 
Àngth
;

702 
buf
[3];

704 
pd©a
 = 
	`devm_kzÆloc
(
dev
, (*pd©a), 
GFP_KERNEL
);

706 i‡(!
pd©a
) {

707 
	`©h6kl_îr
("%s: CouldÇotállocate memory forÖlatform data\n",

708 
__func__
);

709 
	`up
(&
wifi_c⁄åﬁ_£m
);

710  -
ENOMEM
;

713 i‡(
	`©h6kl_dt_∑r£_vªg_öfo
(
dev
, &
pd©a
->
wifi_chù_pwd
,

715 
	`©h6kl_îr
("%s:Ö¨£ vªg infÿîr‹\n", 
__func__
);

716 
îr
;

719 i‡(
	`©h6kl_dt_∑r£_vªg_öfo
(
dev
, &
pd©a
->
wifi_vdd∑
,

721 
	`©h6kl_îr
("%s:Öarse vreg info for %sÉrror\n",

722 "vdd∑", 
__func__
);

723 
îr
;

726 i‡(
	`©h6kl_dt_∑r£_vªg_öfo
(
dev
, &
pd©a
->
wifi_vddio
,

728 
	`©h6kl_îr
("%s:Öarse vreg info for %sÉrror\n",

729 "vddio", 
__func__
);

730 
îr
;

733 
pd©a
->
pdev
 =Ödev;

734 
	`∂©f‹m_£t_drvd©a
(
pdev
, 
pd©a
);

735 
gpd©a
 = 
pd©a
;

737 i‡(
pd©a
->
wifi_chù_pwd
 !
NULL
) {

738 
ªt
 = 
	`©h6kl_∂©f‹m_powî
(
pd©a
, 1);

739 i‡(
ªt
 == 0) {

740 
	`mdñay
(50);

741 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%d\n", 1 ? 1 : 0);

742 
	`™droid_ªadwrôe_fûe
(

744 
NULL
, 
buf
, 
Àngth
);

745 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%d\n", 0 ? 1 : 0);

746 
	`™droid_ªadwrôe_fûe
(

748 
NULL
, 
buf
, 
Àngth
);

749 
	`mdñay
(500);

753 
	`up
(&
wifi_c⁄åﬁ_£m
);

754  
ªt
;

756 
îr
:

757 i‡(
pd©a
 !
NULL
)

758 
	`devm_k‰ì
(
dev
, 
pd©a
);

760 
	`up
(&
wifi_c⁄åﬁ_£m
);

761  -
EINVAL
;

762 
	}
}

764 
	$©h6kl_sdio_ªmove
(
∂©f‹m_devi˚
 *
pdev
)

766 
buf
[3];

767 
Àngth
;

768 
©h6kl_∂©f‹m_d©a
 *
pd©a
 = 
	`∂©f‹m_gë_drvd©a
(
pdev
);

770 i‡(
pd©a
->
wifi_chù_pwd
 !
NULL
 &&

771 !
	`IS_ERR
(
pd©a
->
wifi_chù_pwd
->
ªg
)) {

773 
	`©h6kl_∂©f‹m_powî
(
pd©a
, 0);

774 
	`ªguœt‹_put
(
pd©a
->
wifi_chù_pwd
->
ªg
);

776 i‡(
pd©a
->
wifi_vdd∑
 !
NULL
 &&

777 
pd©a
->
wifi_vdd∑
->
ªg
)

778 
	`ªguœt‹_put
(
pd©a
->
wifi_vdd∑
->
ªg
);

780 i‡(
pd©a
->
wifi_vddio
 !
NULL
 &&

781 
pd©a
->
wifi_vddio
->
ªg
)

782 
	`ªguœt‹_put
(
pd©a
->
wifi_vddio
->
ªg
);

784 
	`mdñay
(50);

785 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%d\n", 1 ? 1 : 0);

786 
	`™droid_ªadwrôe_fûe
("/sys/devices/msm_sdcc.3/polling",

787 
NULL
, 
buf
, 
Àngth
);

788 
Àngth
 = 
	`¢¥ötf
(
buf
, (buf), "%d\n", 0 ? 1 : 0);

789 
	`™droid_ªadwrôe_fûe
("/sys/devices/msm_sdcc.3/polling",

790 
NULL
, 
buf
, 
Àngth
);

791 
	`mdñay
(500);

796 
	`up
(&
wifi_c⁄åﬁ_£m
);

798 
	}
}

800 c⁄° 
of_devi˚_id
 
	g©h6kl_sdio_dt_m©ch
[] = {

801 { .
com∑tibÀ
 = "qca,ar6004-sdio",},

805 
MODULE_DEVICE_TABLE
(
of
, 
©h6kl_sdio_dt_m©ch
);

807 
∂©f‹m_drivî
 
	g©h6kl_sdio_devi˚
 = {

808 .
¥obe
 = 
©h6kl_sdio_¥obe
,

809 .
	gªmove
 = 
©h6kl_sdio_ªmove
,

810 .
	gdrivî
 = {

811 .
«me
 = "ath6kl_sdio",

812 .
	gof_m©ch_èbÀ
 = 
©h6kl_sdio_dt_m©ch
,

816 
	$©h6kl_sdio_öô_msm
()

818 
ªt
;

820 
	`£ma_öô
(&
wifi_c⁄åﬁ_£m
, 1);

821 
	`down
(&
wifi_c⁄åﬁ_£m
);

823 
ªt
 = 
	`∂©f‹m_drivî_ªgi°î
(&
©h6kl_sdio_devi˚
);

826 i‡(
	`down_timeout
(&
wifi_c⁄åﬁ_£m
, 
	`m£cs_to_jiffõs
(5000)) != 0) {

827 
ªt
 = -
EINVAL
;

828 
	`¥ötk
(
KERN_INFO
 "platform_driver_registerÅimeout\n");

833 
	}
}

835 
	$©h6kl_sdio_exô_msm
()

837 
	`∂©f‹m_drivî_uƒegi°î
(&
©h6kl_sdio_devi˚
);

840 i‡(
	`down_timeout
(&
wifi_c⁄åﬁ_£m
, 
	`m£cs_to_jiffõs
(5000)) != 0) {

841 
	`¥ötk
(
KERN_INFO
 "platform_driver_unregisterÅimeout\n");

844 
	}
}

	@p2p.c

17 
	~"c‹e.h
"

18 
	~"htc-›s.h
"

19 
	~"debug.h
"

21 
p2p_ps_öfo
 *
	$©h6kl_p2p_ps_öô
(
©h6kl_vif
 *
vif
)

23 
p2p_ps_öfo
 *
p2p_ps
;

25 
p2p_ps
 = 
	`kzÆloc
((
p2p_ps_öfo
), 
GFP_KERNEL
);

26 i‡(!
p2p_ps
) {

27 
	`©h6kl_îr
("failedÅoálloc memory forÖ2p_ps\n");

28  
NULL
;

31 
p2p_ps
->
vif
 = vif;

32 
	`•ö_lock_öô
(&
p2p_ps
->
p2p_ps_lock
);

34 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

36 
vif
,

37 
vif
->
wdev
.
i·y≥
);

39  
p2p_ps
;

40 
	}
}

42 
	$©h6kl_p2p_ps_deöô
(
©h6kl_vif
 *
vif
)

44 
p2p_ps_öfo
 *
p2p_ps
 = 
vif
->
p2p_ps_öfo_˘x
;

46 i‡(
p2p_ps
) {

47 
	`•ö_lock
(&
p2p_ps
->
p2p_ps_lock
);

48 i‡(
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
 !
NULL
)

49 
	`k‰ì
(
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
);

51 i‡(
p2p_ps
->
go_œ°_nﬂ_õ
 !
NULL
)

52 
	`k‰ì
(
p2p_ps
->
go_œ°_nﬂ_õ
);

54 i‡(
p2p_ps
->
go_w‹kög_buf„r
 !
NULL
)

55 
	`k‰ì
(
p2p_ps
->
go_w‹kög_buf„r
);

56 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

58 
	`k‰ì
(
p2p_ps
);

61 
vif
->
p2p_ps_öfo_˘x
 = 
NULL
;

63 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

65 
vif
);

68 
	}
}

70 
	$©h6kl_p2p_ps_ª£t_nﬂ
(
p2p_ps_öfo
 *
p2p_ps
)

72 i‡(!
p2p_ps
)

79 i‡(
p2p_ps
->
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_P2P_GO
) {

85 i‡(!
p2p_ps
->
vif
->
¨
->
p2p_com∑t
) {

86 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

87 "ÁûedÅÿª£àP2P-GOÇﬂ, %p\n", 
p2p_ps
);

93 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

95 
p2p_ps
->
vif
,

96 
p2p_ps
->
go_nﬂ
.
ödex
);

98 
	`•ö_lock
(&
p2p_ps
->
p2p_ps_lock
);

99 
p2p_ps
->
go_Êags
 &~
ATH6KL_P2P_PS_FLAGS_NOA_ENABLED
;

100 
p2p_ps
->
go_nﬂ
.
ödex
++;

101 
p2p_ps
->
go_nﬂ_íabÀ_idx
 = 0;

102 
	`mem£t
(
p2p_ps
->
go_nﬂ
.
nﬂs
,

104 (
õì80211_p2p_nﬂ_des¸ùt‹
) *

105 
ATH6KL_P2P_PS_MAX_NOA_DESCRIPTORS
);

106 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

109 
	}
}

111 
	$©h6kl_p2p_ps_£tup_nﬂ
(
p2p_ps_öfo
 *
p2p_ps
,

112 
nﬂ_id
,

113 
u8
 
cou¡_ty≥
,

114 
u32
 
öãrvÆ
,

115 
u32
 
°¨t_off£t
,

116 
u32
 
duøti⁄
)

118 
õì80211_p2p_nﬂ_des¸ùt‹
 *
nﬂ_des¸ùt‹
;

120 i‡((!
p2p_ps
) ||

121 (
p2p_ps
->
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_P2P_GO
)) {

122 
	`©h6kl_îr
("failedÅo setup P2P-GOÇoa\n");

126 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

128 
p2p_ps
->
vif
,

129 
nﬂ_id
,

130 
cou¡_ty≥
,

131 
öãrvÆ
,

132 
°¨t_off£t
,

133 
duøti⁄
);

135 
	`•ö_lock
(&
p2p_ps
->
p2p_ps_lock
);

136 i‡(
nﬂ_id
 < 
ATH6KL_P2P_PS_MAX_NOA_DESCRIPTORS
) {

137 
nﬂ_des¸ùt‹
 = &
p2p_ps
->
go_nﬂ
.
nﬂs
[
nﬂ_id
];

139 
nﬂ_des¸ùt‹
->
cou¡_‹_ty≥
 = 
cou¡_ty≥
;

140 
nﬂ_des¸ùt‹
->
öãrvÆ
 = interval;

141 
nﬂ_des¸ùt‹
->
°¨t_‹_off£t
 = 
°¨t_off£t
;

142 
nﬂ_des¸ùt‹
->
duøti⁄
 = duration;

144 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

145 
	`©h6kl_îr
("wr⁄g NoA index %d\n", 
nﬂ_id
);

150 
p2p_ps
->
go_nﬂ_íabÀ_idx
 |(1 << 
nﬂ_id
);

151 
p2p_ps
->
go_Êags
 |
ATH6KL_P2P_PS_FLAGS_NOA_ENABLED
;

152 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

155 
	}
}

157 
	$©h6kl_p2p_ps_ª£t_›ps
(
p2p_ps_öfo
 *
p2p_ps
)

159 i‡((!
p2p_ps
) ||

160 (
p2p_ps
->
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_P2P_GO
)) {

161 
	`©h6kl_îr
("failedÅoÑeset P2P-GO OppPS\n");

165 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

167 
p2p_ps
->
vif
,

168 
p2p_ps
->
go_nﬂ
.
ödex
);

170 
	`•ö_lock
(&
p2p_ps
->
p2p_ps_lock
);

171 
p2p_ps
->
go_Êags
 &~
ATH6KL_P2P_PS_FLAGS_OPPPS_ENABLED
;

172 
p2p_ps
->
go_nﬂ
.
ödex
++;

173 
p2p_ps
->
go_nﬂ
.
˘wödow_›ps_∑øm
 = 0;

174 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

177 
	}
}

179 
	$©h6kl_p2p_ps_£tup_›ps
(
p2p_ps_öfo
 *
p2p_ps
,

180 
u8
 
íabÀd
,

181 
u8
 
˘wödows
)

183 i‡((!
p2p_ps
) ||

184 (
p2p_ps
->
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_P2P_GO
)) {

185 
	`©h6kl_îr
("failedÅo setup P2P-GOÇoa\n");

189 
	`WARN_ON
(
íabÀd
 && (!(
˘wödows
 & 0x7f)));

191 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

193 
p2p_ps
->
vif
,

194 
íabÀd
,

195 
˘wödows
);

197 
	`•ö_lock
(&
p2p_ps
->
p2p_ps_lock
);

198 i‡(
íabÀd
)

199 
p2p_ps
->
go_nﬂ
.
˘wödow_›ps_∑øm
 = (0x80 |

200 (
˘wödows
 & 0x7f));

202 
p2p_ps
->
go_nﬂ
.
˘wödow_›ps_∑øm
 = 0;

203 
p2p_ps
->
go_Êags
 |
ATH6KL_P2P_PS_FLAGS_OPPPS_ENABLED
;

204 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

207 
	}
}

209 
	$©h6kl_p2p_ps_upd©e_nŸif
(
p2p_ps_öfo
 *
p2p_ps
)

211 
©h6kl_vif
 *
vif
;

212 
õì80211_p2p_nﬂ_õ
 *
nﬂ_õ
;

213 
õì80211_p2p_nﬂ_des¸ùt‹
 *
nﬂ_des¸ùt‹
;

214 
i
, 
idx
, 
Àn
, 
ªt
 = 0;

215 
u8
 *
buf
;

217 
	`WARN_ON
(!
p2p_ps
);

219 
vif
 = 
p2p_ps
->vif;

221 
p2p_ps
->
go_nﬂ_nŸif_˙t
++;

223 
	`•ö_lock
(&
p2p_ps
->
p2p_ps_lock
);

224 i‡((
p2p_ps
->
go_Êags
 & 
ATH6KL_P2P_PS_FLAGS_NOA_ENABLED
) ||

225 (
p2p_ps
->
go_Êags
 & 
ATH6KL_P2P_PS_FLAGS_OPPPS_ENABLED
)) {

226 
	`WARN_ON
((
p2p_ps
->
go_Êags
 & 
ATH6KL_P2P_PS_FLAGS_NOA_ENABLED
) &&

227 (!
p2p_ps
->
go_nﬂ_íabÀ_idx
));

229 
Àn
 = 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
 +

230 (
õì80211_p2p_nﬂ_õ
);

232 
buf
 = 
	`kmÆloc
(
Àn
, 
GFP_ATOMIC
);

233 i‡(
buf
 =
NULL
) {

234 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

236  -
ENOMEM
;

240 
	`mem˝y
(
buf
,

241 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
,

242 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
);

244 
nﬂ_õ
 = (
õì80211_p2p_nﬂ_õ
 *)

245 (
buf
 + 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
);

246 
nﬂ_õ
->
ñemít_id
 = 
WLAN_EID_VENDOR_SPECIFIC
;

247 
nﬂ_õ
->
oui
 = 
	`˝u_to_be32
((
WLAN_OUI_WFA
 << 8) |

248 (
WLAN_OUI_TYPE_WFA_P2P
));

249 
nﬂ_õ
->
©å
 = 
IEEE80211_P2P_ATTR_NOTICE_OF_ABSENCE
;

250 
nﬂ_õ
->
nﬂ_öfo
.
ödex
 = 
p2p_ps
->
go_nﬂ
.index;

251 
nﬂ_õ
->
nﬂ_öfo
.
˘wödow_›ps_∑øm
 =

252 
p2p_ps
->
go_nﬂ
.
˘wödow_›ps_∑øm
;

254 
idx
 = 0;

255 
i
 = 0; i < 
ATH6KL_P2P_PS_MAX_NOA_DESCRIPTORS
; i++) {

256 i‡(
p2p_ps
->
go_nﬂ_íabÀ_idx
 & (1 << 
i
)) {

257 
nﬂ_des¸ùt‹
 =

258 &
nﬂ_õ
->
nﬂ_öfo
.
nﬂs
[
idx
++];

259 
nﬂ_des¸ùt‹
->
cou¡_‹_ty≥
 =

260 
p2p_ps
->
go_nﬂ
.
nﬂs
[
i
].
cou¡_‹_ty≥
;

261 
nﬂ_des¸ùt‹
->
duøti⁄
 =

262 
	`˝u_to_À32
(

263 
p2p_ps
->
go_nﬂ
.
nﬂs
[
i
].
duøti⁄
);

264 
nﬂ_des¸ùt‹
->
öãrvÆ
 =

265 
	`˝u_to_À32
(

266 
p2p_ps
->
go_nﬂ
.
nﬂs
[
i
].
öãrvÆ
);

267 
nﬂ_des¸ùt‹
->
°¨t_‹_off£t
 =

268 
	`˝u_to_À32
(

269 
p2p_ps
->
go_nﬂ
.
nﬂs
[
i
].
°¨t_‹_off£t
);

275 
nﬂ_õ
->
©å_Àn
 = 
	`˝u_to_À16
(2 +

276 ((
õì80211_p2p_nﬂ_des¸ùt‹
Ë* 
idx
));

277 
nﬂ_õ
->
Àn
 =Çﬂ_õ->
©å_Àn
 + 4 + 1 + 2;

278 
Àn
 = 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
 + (
nﬂ_õ
->len + 2);

281 
p2p_ps
->
go_œ°_nﬂ_õ_Àn
 = 0;

283 i‡(
p2p_ps
->
go_œ°_nﬂ_õ
 !
NULL
)

284 
	`k‰ì
(
p2p_ps
->
go_œ°_nﬂ_õ
);

285 
p2p_ps
->
go_œ°_nﬂ_õ
 = 
	`kmÆloc
(
nﬂ_õ
->
Àn
 + 2, 
GFP_ATOMIC
);

286 i‡(
p2p_ps
->
go_œ°_nﬂ_õ
) {

287 
p2p_ps
->
go_œ°_nﬂ_õ_Àn
 = 
nﬂ_õ
->
Àn
 + 2;

288 
	`mem˝y
(
p2p_ps
->
go_œ°_nﬂ_õ
,

289 
nﬂ_õ
,

290 
p2p_ps
->
go_œ°_nﬂ_õ_Àn
);

293 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

295 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

297 
vif
,

298 
p2p_ps
->
go_Êags
,

299 
idx
,

300 
nﬂ_õ
->
Àn
,

301 
Àn
);

307 i‡(
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
 == 0) {

308 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

310  
ªt
;

314 
p2p_ps
->
go_œ°_nﬂ_õ_Àn
 = 0;

316 i‡(
p2p_ps
->
go_œ°_nﬂ_õ
 !
NULL
) {

317 
	`k‰ì
(
p2p_ps
->
go_œ°_nﬂ_õ
);

318 
p2p_ps
->
go_œ°_nﬂ_õ
 = 
NULL
;

321 
buf
 = 
	`kmÆloc
(
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
, 
GFP_ATOMIC
);

322 i‡(
buf
 =
NULL
) {

323 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

325  -
ENOMEM
;

329 
Àn
 = 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
;

330 
	`mem˝y
(
buf
,

331 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
,

332 
Àn
);

334 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

336 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

338 
vif
,

339 
p2p_ps
->
go_Êags
,

340 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
,

341 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
);

348 
ªt
 = 
	`©h6kl_wmi_£t_≠põ_cmd
(
vif
->
¨
->
wmi
,

349 
vif
->
fw_vif_idx
,

350 
WMI_FRAME_BEACON
,

351 
buf
,

352 
Àn
);

354 
	`k‰ì
(
buf
);

356  
ªt
;

357 
	}
}

359 
	$©h6kl_p2p_ps_u£r_≠p_õ
(
p2p_ps_öfo
 *
p2p_ps
,

360 
u8
 
mgmt_‰m_ty≥
,

361 
u8
 **
õ
,

362 *
Àn
)

364 i‡((!
p2p_ps
Ë|| (p2p_ps->
vif
->
wdev
.
i·y≥
 !
NL80211_IFTYPE_P2P_GO
))

367 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

369 
p2p_ps
->
vif
,

370 
p2p_ps
->
go_Êags
,

371 
mgmt_‰m_ty≥
,

372 *
Àn
);

374 i‡(
mgmt_‰m_ty≥
 =
WMI_FRAME_BEACON
) {

375 
	`WARN_ON
((*
Àn
) == 0);

377 
	`•ö_lock
(&
p2p_ps
->
p2p_ps_lock
);

378 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
 = 0;

380 i‡(
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
 !
NULL
)

381 
	`k‰ì
(
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
);

383 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
 = 
	`kmÆloc
(*
Àn
, 
GFP_ATOMIC
);

384 i‡(
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
 =
NULL
) {

385 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

390 
p2p_ps
->
go_œ°_bóc⁄_≠p_õ_Àn
 = *
Àn
;

391 
	`mem˝y
(
p2p_ps
->
go_œ°_bóc⁄_≠p_õ
, *
õ
, *
Àn
);

393 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

394 } i‡(
mgmt_‰m_ty≥
 =
WMI_FRAME_PROBE_RESP
) {

396 i‡((*
Àn
) == 0)

401 
	`•ö_lock
(&
p2p_ps
->
p2p_ps_lock
);

402 i‡((
p2p_ps
->
go_Êags
 & 
ATH6KL_P2P_PS_FLAGS_NOA_ENABLED
) ||

403 (
p2p_ps
->
go_Êags
 & 
ATH6KL_P2P_PS_FLAGS_OPPPS_ENABLED
)) {

409 
	`WARN_ON
(!
p2p_ps
->
go_œ°_nﬂ_õ
);

411 i‡(
p2p_ps
->
go_w‹kög_buf„r
 !
NULL
)

412 
	`k‰ì
(
p2p_ps
->
go_w‹kög_buf„r
);

414 
p2p_ps
->
go_w‹kög_buf„r
 =

415 
	`kmÆloc
((
p2p_ps
->
go_œ°_nﬂ_õ_Àn
 + *
Àn
),

416 
GFP_ATOMIC
);

418 i‡(
p2p_ps
->
go_w‹kög_buf„r
) {

419 i‡(*
Àn
)

420 
	`mem˝y
(
p2p_ps
->
go_w‹kög_buf„r
, *
õ
, *
Àn
);

421 
	`mem˝y
(
p2p_ps
->
go_w‹kög_buf„r
 + (*
Àn
),

422 
p2p_ps
->
go_œ°_nﬂ_õ
,

423 
p2p_ps
->
go_œ°_nﬂ_õ_Àn
);

425 i‡(
mgmt_‰m_ty≥
 =
WMI_FRAME_PROBE_RESP
) {

427 
	`k‰ì
(*
õ
);

428 *
õ
 = 
p2p_ps
->
go_w‹kög_buf„r
;

429 
p2p_ps
->
go_w‹kög_buf„r
 = 
NULL
;

431 *
õ
 = 
p2p_ps
->
go_w‹kög_buf„r
;

432 *
Àn
 +
p2p_ps
->
go_œ°_nﬂ_õ_Àn
;

435 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

437 *
Àn
);

439 
	`•ö_u∆ock
(&
p2p_ps
->
p2p_ps_lock
);

442 
	}
}

444 
	$©h6kl_p2p_utûs_å™s_p‹ây≥
(
∆80211_i·y≥
 
ty≥
,

445 
u8
 *
›mode
,

446 
u8
 *
sub›mode
)

448 
ªt
 = 0;

456 i‡(
ty≥
 =
NL80211_IFTYPE_P2P_DEVICE_QCA
) {

457 *
›mode
 = 
HI_OPTION_FW_MODE_BSS_STA
;

458 *
sub›mode
 = 
HI_OPTION_FW_SUBMODE_P2PDEV
;

460 
ty≥
) {

461 
NL80211_IFTYPE_AP
:

462 *
›mode
 = 
HI_OPTION_FW_MODE_AP
;

463 *
sub›mode
 = 
HI_OPTION_FW_SUBMODE_NONE
;

465 
NL80211_IFTYPE_STATION
:

466 *
›mode
 = 
HI_OPTION_FW_MODE_BSS_STA
;

467 *
sub›mode
 = 
HI_OPTION_FW_SUBMODE_NONE
;

469 
NL80211_IFTYPE_P2P_CLIENT
:

470 *
›mode
 = 
HI_OPTION_FW_MODE_BSS_STA
;

471 *
sub›mode
 = 
HI_OPTION_FW_SUBMODE_P2PCLIENT
;

473 
NL80211_IFTYPE_P2P_GO
:

474 *
›mode
 = 
HI_OPTION_FW_MODE_BSS_STA
;

475 *
sub›mode
 = 
HI_OPTION_FW_SUBMODE_P2PGO
;

477 
NL80211_IFTYPE_UNSPECIFIED
:

478 
NL80211_IFTYPE_ADHOC
:

479 
NL80211_IFTYPE_AP_VLAN
:

480 
NL80211_IFTYPE_WDS
:

481 
NL80211_IFTYPE_MONITOR
:

482 
NL80211_IFTYPE_MESH_POINT
:

484 
	`©h6kl_îr
("îr‹ i¡îÁ˚Åy≥ %d\n", 
ty≥
);

485 
ªt
 = -1;

490  
ªt
;

491 
	}
}

493 
ölöe
 
	$_ªvît_ht_ˇp
(
©h6kl_vif
 *
vif
)

495 
©h6kl
 *
¨
 = 
vif
->ar;

496 #ifde‡
CONFIG_ATH6KL_DEBUG


497 
ht_ˇp_∑øm
 *
htC≠P¨am
;

499 
htC≠P¨am
 = &
¨
->
debug
.
ht_ˇp_∑øm
[
IEEE80211_BAND_5GHZ
];

500 i‡(
htC≠P¨am
->
isC⁄fig
)

501 
	`©h6kl_wmi_£t_ht_ˇp_cmd
(
¨
->
wmi
,

502 
vif
->
fw_vif_idx
,

503 
htC≠P¨am
->
b™d
,

504 
htC≠P¨am
->
ch™_width_40M_suµ‹ãd
,

505 
htC≠P¨am
->
sh‹t_GI
,

506 
htC≠P¨am
->
ötﬁî™˚_40MHz
);

509 
	`©h6kl_wmi_£t_ht_ˇp_cmd
(
¨
->
wmi
,

510 
vif
->
fw_vif_idx
,

511 
A_BAND_5GHZ
,

512 
ATH6KL_5GHZ_HT40_DEF_WIDTH
,

513 
ATH6KL_5GHZ_HT40_DEF_SGI
,

514 
ATH6KL_5GHZ_HT40_DEF_INTOLR40
);

517 
	}
}

519 
	$©h6kl_p2p_utûs_öô_p‹t
(
©h6kl_vif
 *
vif
,

520 
∆80211_i·y≥
 
ty≥
)

522 
©h6kl
 *
¨
 = 
vif
->ar;

523 
u8
 
fw_vif_idx
 = 
vif
->fw_vif_idx;

524 
u8
 
›mode
, 
sub›mode
;

525 
À·
;

526 
u8
 
skù_vif
 = 1;

528 i‡(
¨
->
p2p_com∑t
)

542 i‡(
¨
->
p2p_dediˇã
)

543 
skù_vif
 = 2;

545 i‡((
¨
->
vif_max
 > 
skù_vif
Ë&& 
fw_vif_idx
) {

546 i‡(
¨
->
p2p_dediˇã
 && (
fw_vif_idx
 =◊r->
vif_max
 - 1)))

547 
ty≥
 = 
NL80211_IFTYPE_P2P_DEVICE_QCA
;

549 i‡(
	`©h6kl_p2p_utûs_å™s_p‹ây≥
(
ty≥
,

550 &
›mode
,

551 &
sub›mode
) == 0) {

553 i‡(
ty≥
 !
NL80211_IFTYPE_P2P_DEVICE_QCA
) {

554 
	`£t_bô
(
PORT_STATUS_PEND
, &
vif
->
Êags
);

555 i‡(
	`©h6kl_wmi_dñ_p‹t_cmd
(
¨
->
wmi
,

556 
fw_vif_idx
,

557 
fw_vif_idx
))

558  -
EIO
;

560 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(

561 
¨
->
evít_wq
,

562 !
	`ã°_bô
(
PORT_STATUS_PEND
,

563 &
vif
->
Êags
),

564 
WMI_TIMEOUT
/2);

565 
	`WARN_ON
(
À·
 <= 0);

569 
	`£t_bô
(
PORT_STATUS_PEND
, &
vif
->
Êags
);

570 i‡(
	`©h6kl_wmi_add_p‹t_cmd
(
¨
->
wmi
,

571 
vif
,

572 
›mode
,

573 
sub›mode
))

574  -
EIO
;

576 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(

577 
¨
->
evít_wq
,

578 !
	`ã°_bô
(
PORT_STATUS_PEND
,

579 &
vif
->
Êags
),

580 
WMI_TIMEOUT
);

581 
	`WARN_ON
(
À·
 <= 0);

583 i‡(
ty≥
 =
NL80211_IFTYPE_P2P_CLIENT
) {

590 
	`©h6kl_wmi_£t_bmiss_time
(
¨
->
wmi
,

591 
vif
->
fw_vif_idx
,

592 
ATH6KL_P2P_BMISS_TIME
);

595 i‡(
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
 &

596 
ROAM_SCAN_CTRL_FLAGS
)

597 
	`©h6kl_wmi_£t_rﬂm_˘æ_cmd
(

598 
¨
->
wmi
, 
vif
->
fw_vif_idx
,

603 i‡((
ty≥
 =
NL80211_IFTYPE_AP
) ||

604 (
ty≥
 =
NL80211_IFTYPE_P2P_GO
))

605 
	`_ªvît_ht_ˇp
(
vif
);

607  -
ENOTSUPP
;

611 
	}
}

613 
	$©h6kl_p2p_utûs_check_p‹t
(
©h6kl_vif
 *
vif
,

614 
u8
 
p‹t_id
)

616 i‡(
	`ã°_bô
(
PORT_STATUS_PEND
, &
vif
->
Êags
)) {

617 
	`WARN_ON
(
vif
->
fw_vif_idx
 !
p‹t_id
);

619 
	`˛ór_bô
(
PORT_STATUS_PEND
, &
vif
->
Êags
);

620 
	`wake_up
(&
vif
->
¨
->
evít_wq
);

624 
	}
}

626 
©h6kl_p2p_Êow˘æ
 *
	$©h6kl_p2p_Êow˘æ_c⁄n_li°_öô
(

627 
©h6kl
 *
¨
)

629 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
;

630 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

631 
i
;

633 
p2p_Êow˘æ
 = 
	`kzÆloc
((
©h6kl_p2p_Êow˘æ
), 
GFP_KERNEL
);

634 i‡(!
p2p_Êow˘æ
) {

635 
	`©h6kl_îr
("failedÅoálloc memory forÖ2p_flowctrl\n");

636  
NULL
;

639 
p2p_Êow˘æ
->
¨
 =ár;

640 
	`•ö_lock_öô
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

641 
p2p_Êow˘æ
->
sche_ty≥
 = 
P2P_FLOWCTRL_SCHE_TYPE_CONNECTION
;

643 
i
 = 0; i < 
NUM_CONN
; i++) {

644 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
i
];

645 
	`INIT_LIST_HEAD
(&
fw_c⁄n
->
c⁄n_queue
);

646 
	`INIT_LIST_HEAD
(&
fw_c⁄n
->
ª_queue
);

647 
fw_c⁄n
->
c⁄√˘_°©us
 = 0;

648 
fw_c⁄n
->
¥evious_ˇn_£nd
 = 
åue
;

649 
fw_c⁄n
->
c⁄nId
 = 
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
;

650 
fw_c⁄n
->
∑ª¡_c⁄nId
 = 
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
;

651 
	`mem£t
(
fw_c⁄n
->
mac_addr
, 0, 
ETH_ALEN
);

653 
fw_c⁄n
->
sche_tx
 = 0;

654 
fw_c⁄n
->
sche_ª_tx
 = 0;

655 
fw_c⁄n
->
sche_ª_tx_agög
 = 0;

656 
fw_c⁄n
->
sche_tx_queued
 = 0;

659 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

661 
¨
,

662 
NUM_CONN
,

663 
p2p_Êow˘æ
->
sche_ty≥
);

665  
p2p_Êow˘æ
;

666 
	}
}

668 
	$©h6kl_p2p_Êow˘æ_c⁄n_li°_deöô
(
©h6kl
 *
¨
)

670 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

671 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

672 
i
;

674 i‡(
p2p_Êow˘æ
) {

676 
i
 = 0; i < 
NUM_CONN
; i++) {

677 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

678 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
i
];

679 i‡(
fw_c⁄n
->
sche_tx_queued
 != 0) {

680 
	`©h6kl_îr
("memoryÜeakage? %d,%d,%d,%d,%d\n",

681 
i
,

682 
fw_c⁄n
->
sche_tx
,

683 
fw_c⁄n
->
sche_ª_tx
,

684 
fw_c⁄n
->
sche_ª_tx_agög
,

685 
fw_c⁄n
->
sche_tx_queued
);

686 
	`WARN_ON
(1);

688 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

691 
	`k‰ì
(
p2p_Êow˘æ
);

694 
¨
->
p2p_Êow˘æ_˘x
 = 
NULL
;

696 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

698 
¨
);

701 
	}
}

706 
	$©h6kl_p2p_Êow˘æ_c⁄n_cﬁÀ˘_by_c⁄n
(

707 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
,

708 
li°_hód
 *
pc⁄èöî
,

709 *
¥e˛aim
)

711 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

713 i‡(!
	`li°_em±y
(&
fw_c⁄n
->
ª_queue
)) {

714 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
,

715 
tmp_pkt
,

716 &
fw_c⁄n
->
ª_queue
,

717 
li°
) {

718 
	`li°_dñ
(&
∑ckë
->
li°
);

719 
∑ckë
->
°©us
 = 0;

720 
	`li°_add_èû
(&
∑ckë
->
li°
, 
pc⁄èöî
);

721 
fw_c⁄n
->
sche_tx_queued
--;

722 *
¥e˛aim
 += 1;

726 i‡(!
	`li°_em±y
(&
fw_c⁄n
->
c⁄n_queue
)) {

727 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
,

728 
tmp_pkt
,

729 &
fw_c⁄n
->
c⁄n_queue
,

730 
li°
) {

731 
	`li°_dñ
(&
∑ckë
->
li°
);

732 
∑ckë
->
°©us
 = 0;

733 
	`li°_add_èû
(&
∑ckë
->
li°
, 
pc⁄èöî
);

734 
fw_c⁄n
->
sche_tx_queued
--;

735 *
¥e˛aim
 += 1;

738 
	}
}

740 
	$©h6kl_p2p_Êow˘æ_c⁄n_li°_˛ónup
(
©h6kl
 *
¨
)

742 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

743 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

744 
li°_hód
 
c⁄èöî
;

745 
i
, 
ª˛aim
 = 0;

747 
	`WARN_ON
(!
p2p_Êow˘æ
);

749 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

751 
i
 = 0; i < 
NUM_CONN
; i++) {

752 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

753 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
i
];

754 
	`©h6kl_p2p_Êow˘æ_c⁄n_cﬁÀ˘_by_c⁄n
(
fw_c⁄n
,

755 &
c⁄èöî
,

756 &
ª˛aim
);

757 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

760 
	`©h6kl_tx_com∂ëe
(
¨
->
htc_èrgë
, &
c⁄èöî
);

762 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

764 
¨
,

765 
ª˛aim
);

768 
	}
}

770 
u8
 
	$_föd_∑ª¡_c⁄n_id
(
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
,

771 
©h6kl_vif
 *
höt_vif
)

773 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

774 
u8
 
c⁄nId
 = 
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
;

775 
i
;

778 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[0];

779 
i
 = 0; i < 
NUM_CONN
; i++, 
fw_c⁄n
++) {

780 i‡(
fw_c⁄n
->
c⁄nId
 =
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
)

783 i‡((
fw_c⁄n
->
vif
 =
höt_vif
) &&

784 (
fw_c⁄n
->
∑ª¡_c⁄nId
 =fw_c⁄n->
c⁄nId
)) {

785 
c⁄nId
 = 
fw_c⁄n
->connId;

790  
c⁄nId
;

791 
	}
}

793 
	$©h6kl_p2p_Êow˘æ_c⁄n_li°_˛ónup_by_if
(

794 
©h6kl_vif
 *
vif
)

796 
©h6kl
 *
¨
 = 
vif
->ar;

797 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

798 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

799 
li°_hód
 
c⁄èöî
;

800 
i
, 
ª˛aim
 = 0;

801 
u8
 
vif_c⁄n_id
 = 
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
;

803 i‡(!
p2p_Êow˘æ
)

806 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

808 
vif_c⁄n_id
 = 
	`_föd_∑ª¡_c⁄n_id
(
p2p_Êow˘æ
, 
vif
);

810 i‡(
vif_c⁄n_id
 =
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
)

813 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

814 
i
 = 0; i < 
NUM_CONN
; i++) {

815 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
i
];

817 i‡(
fw_c⁄n
->
∑ª¡_c⁄nId
 !
vif_c⁄n_id
)

820 
	`©h6kl_p2p_Êow˘æ_c⁄n_cﬁÀ˘_by_c⁄n
(
fw_c⁄n
,

821 &
c⁄èöî
,

822 &
ª˛aim
);

824 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

826 
	`©h6kl_tx_com∂ëe
(
¨
->
htc_èrgë
, &
c⁄èöî
);

828 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

830 
¨
,

831 
ª˛aim
);

834 
	}
}

836 
ölöe
 
boﬁ
 
	$_check_ˇn_£nd
(
©h6kl
 *
¨
,

837 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
)

839 
boﬁ
 
ˇn_£nd
 = 
Ál£
;

842 i‡((
fw_c⁄n
->
ocs
Ë&& !
	`ã°_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
))

845 
ˇn_£nd
 = 
åue
;

846 } 
Ál£
);

848  
ˇn_£nd
;

849 
	}
}

851 
	$©h6kl_p2p_Êow˘æ_√tif_å™sôi⁄
(

852 
©h6kl
 *
¨
, 
u8
 
√w_°©e
)

854 
©h6kl_vif
 *
vif
;

856 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

857 
	`li°_f‹_óch_íåy
(
vif
, &
¨
->
vif_li°
, 
li°
) {

858 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

860 i‡(
√w_°©e
 =
ATH6KL_P2P_FLOWCTRL_NETIF_STOP
 &&

861 
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))

862 
	`√tif_°›_queue
(
vif
->
ndev
);

863 i‡(
√w_°©e
 =
ATH6KL_P2P_FLOWCTRL_NETIF_WAKE
 &&

864 (
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) ||

865 
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)))

866 
	`√tif_wake_queue
(
vif
->
ndev
);

868 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

870 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

873 
	}
}

875 
	$©h6kl_p2p_Êow˘æ_tx_scheduÀ
(
©h6kl
 *
¨
)

877 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

878 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

879 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

880 
i
;

882 
	`WARN_ON
(!
p2p_Êow˘æ
);

884 
i
 = 0; i < 
NUM_CONN
; i++) {

885 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

887 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
i
];

889 i‡(
fw_c⁄n
->
c⁄nId
 =
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
) {

890 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

894 i‡(
	`_check_ˇn_£nd
(
¨
, 
fw_c⁄n
)) {

895 i‡(!
	`li°_em±y
(&
fw_c⁄n
->
ª_queue
)) {

896 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
,

897 
tmp_pkt
,

898 &
fw_c⁄n
->
ª_queue
,

899 
li°
) {

900 i‡(
∑ckë
 =
NULL
)

903 
	`li°_dñ
(&
∑ckë
->
li°
);

905 i‡(
∑ckë
->
ídpoöt
 >
ENDPOINT_MAX
)

908 
fw_c⁄n
->
sche_ª_tx
--;

909 
fw_c⁄n
->
sche_tx_queued
--;

911 
	`©h6kl_htc_tx
(
¨
->
htc_èrgë
, 
∑ckë
);

915 i‡(!
	`li°_em±y
(&
fw_c⁄n
->
c⁄n_queue
)) {

916 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
,

917 
tmp_pkt
,

918 &
fw_c⁄n
->
c⁄n_queue
,

919 
li°
) {

920 i‡(
∑ckë
 =
NULL
)

923 
	`li°_dñ
(&
∑ckë
->
li°
);

925 i‡(
∑ckë
->
ídpoöt
 >
ENDPOINT_MAX
)

928 
fw_c⁄n
->
sche_tx
++;

929 
fw_c⁄n
->
sche_tx_queued
--;

931 
	`©h6kl_htc_tx
(
¨
->
htc_èrgë
, 
∑ckë
);

935 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

937 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

939 
¨
,

940 
i
,

941 
fw_c⁄n
->
sche_tx
,

942 
fw_c⁄n
->
sche_ª_tx
);

946 
	}
}

948 
	$©h6kl_p2p_Êow˘æ_tx_scheduÀ_pkt
(
©h6kl
 *
¨
,

949 *
pkt
)

951 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

952 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

953 
©h6kl_cookõ
 *
cookõ
 = (©h6kl_cookõ *)
pkt
;

954 
c⁄nId
 = 
cookõ
->
htc_pkt
->
c⁄nid
;

955 
ªt
 = 0;

957 
	`WARN_ON
(!
p2p_Êow˘æ
);

959 i‡(
c⁄nId
 =
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
) {

960 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

967 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

968 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
c⁄nId
];

969 i‡(!
	`_check_ˇn_£nd
(
¨
, 
fw_c⁄n
)) {

970 i‡(
cookõ
->
htc_pkt
->
öfo
.
tx
.
èg
 !=

971 
ATH6KL_PRI_DATA_PKT_TAG
) {

972 
	`li°_add_èû
(&
cookõ
->
htc_pkt
->
li°
,

973 &
fw_c⁄n
->
c⁄n_queue
);

975 
	`li°_add
(&
cookõ
->
htc_pkt
->
li°
,

976 &
fw_c⁄n
->
ª_queue
);

977 
fw_c⁄n
->
sche_ª_tx
++;

979 
fw_c⁄n
->
sche_tx_queued
++;

980 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

982 
ªsu…
;

983 } i‡(!
	`li°_em±y
(&
fw_c⁄n
->
c⁄n_queue
) ||

984 !
	`li°_em±y
(&
fw_c⁄n
->
ª_queue
)) {

985 i‡(
cookõ
->
htc_pkt
->
öfo
.
tx
.
èg
 !=

986 
ATH6KL_PRI_DATA_PKT_TAG
) {

987 
	`li°_add_èû
(&
cookõ
->
htc_pkt
->
li°
,

988 &
fw_c⁄n
->
c⁄n_queue
);

990 
	`li°_add
(&
cookõ
->
htc_pkt
->
li°
, &
fw_c⁄n
->
ª_queue
);

991 
fw_c⁄n
->
sche_ª_tx
++;

994 
fw_c⁄n
->
sche_tx_queued
++;

995 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

997 
	`©h6kl_p2p_Êow˘æ_tx_scheduÀ
(
¨
);

999 
ªsu…
;

1001 
ªt
 = 1;

1002 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1004 
ªsu…
:

1005 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

1007 
¨
,

1008 ((
ªt
 == 0) ? "queue" : "send"));

1010  
ªt
;

1011 
	}
}

1013 
	$©h6kl_p2p_Êow˘æ_°©e_ch™ge
(
©h6kl
 *
¨
)

1015 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

1016 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

1017 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

1018 
htc_ídpoöt
 *
ídpoöt
;

1019 
li°_hód
 *
tx_queue
, 
c⁄èöî
;

1020 
i
, 
eid
;

1021 
boﬁ
 
Êow˘æ_Ælowed
;

1023 
	`WARN_ON
(!
p2p_Êow˘æ
);

1025 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

1027 
i
 = 0; i < 
NUM_CONN
; i++) {

1028 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1029 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
i
];

1030 
Êow˘æ_Ælowed
 = 
	`_check_ˇn_£nd
(
¨
, 
fw_c⁄n
);

1031 i‡(!
Êow˘æ_Ælowed
 && 
fw_c⁄n
->
¥evious_ˇn_£nd
) {

1032 
	`•ö_lock_bh
(&
¨
->
htc_èrgë
->
tx_lock
);

1033 
eid
 = 
ENDPOINT_5
;Éid >
ENDPOINT_2
;Éid--) {

1034 
ídpoöt
 = &
¨
->
htc_èrgë
->ídpoöt[
eid
];

1035 
tx_queue
 = &
ídpoöt
->
txq
;

1036 i‡(
	`li°_em±y
(
tx_queue
))

1039 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
,

1040 
tmp_pkt
,

1041 
tx_queue
,

1042 
li°
) {

1043 i‡(
∑ckë
->
c⁄nid
 !
i
)

1046 
	`li°_dñ
(&
∑ckë
->
li°
);

1047 i‡(
∑ckë
->
ªcy˛e_cou¡
 >

1048 
ATH6KL_P2P_FLOWCTRL_RECYCLE_LIMIT
) {

1049 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

1052 
∑ckë
->
°©us
 = 0;

1053 
	`li°_add_èû
(

1054 &
∑ckë
->
li°
,

1055 &
c⁄èöî
);

1057 
fw_c⁄n
->
sche_ª_tx_agög
++;

1059 
∑ckë
->
ªcy˛e_cou¡
++;

1060 
	`li°_add_èû
(

1061 &
∑ckë
->
li°
,

1062 &
fw_c⁄n
->
ª_queue
);

1064 
fw_c⁄n
->
sche_ª_tx
++;

1065 
fw_c⁄n
->
sche_tx_queued
++;

1069 
	`•ö_u∆ock_bh
(&
¨
->
htc_èrgë
->
tx_lock
);

1071 
fw_c⁄n
->
¥evious_ˇn_£nd
 = 
Êow˘æ_Ælowed
;

1072 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1075 
	`©h6kl_p2p_Êow˘æ_√tif_å™sôi⁄
(

1076 
¨
, 
ATH6KL_P2P_FLOWCTRL_NETIF_WAKE
);

1078 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

1080 
¨
,

1081 
fw_c⁄n
->
sche_ª_tx
,

1082 
fw_c⁄n
->
sche_ª_tx_agög
);

1084 
	`©h6kl_tx_com∂ëe
(
¨
->
htc_èrgë
, &
c⁄èöî
);

1087 
	}
}

1089 
	$©h6kl_p2p_Êow˘æ_°©e_upd©e
(
©h6kl
 *
¨
,

1090 
u8
 
numC⁄n
,

1091 
u8
 
ac_m≠
[],

1092 
u8
 
ac_queue_dïth
[])

1094 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

1095 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

1096 
i
;

1098 
	`WARN_ON
(!
p2p_Êow˘æ
);

1099 
	`WARN_ON
(
numC⁄n
 > 
NUM_CONN
);

1101 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1102 
p2p_Êow˘æ
->
p2p_Êow˘æ_evít_˙t
++;

1103 
i
 = 0; i < 
numC⁄n
; i++) {

1104 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
i
];

1105 
fw_c⁄n
->
c⁄√˘_°©us
 = 
ac_m≠
[
i
];

1107 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1109 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

1111 
¨
,

1112 
ac_m≠
[0],ác_map[1],ác_map[2],ác_map[3]);

1115 
	}
}

1117 
	$©h6kl_p2p_Êow˘æ_£t_c⁄n_id
(
©h6kl_vif
 *
vif
,

1118 
u8
 
mac_addr
[],

1119 
u8
 
c⁄nId
)

1121 
©h6kl
 *
¨
 = 
vif
->ar;

1122 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

1123 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

1124 
li°_hód
 
c⁄èöî
;

1125 
ª˛aim
 = 0;

1127 
	`WARN_ON
(!
p2p_Êow˘æ
);

1129 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

1131 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1132 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
c⁄nId
];

1133 i‡(
mac_addr
) {

1134 i‡(
fw_c⁄n
->
sche_tx_queued
 != 0) {

1135 
	`©h6kl_p2p_Êow˘æ_c⁄n_cﬁÀ˘_by_c⁄n
(
fw_c⁄n
,

1136 &
c⁄èöî
,

1137 &
ª˛aim
);

1138 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1139 
	`©h6kl_tx_com∂ëe
(
¨
->
htc_èrgë
, &
c⁄èöî
);

1140 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1143 
fw_c⁄n
->
vif
 = vif;

1144 
fw_c⁄n
->
c⁄nId
 = connId;

1145 
	`mem˝y
(
fw_c⁄n
->
mac_addr
, mac_addr, 
ETH_ALEN
);

1151 i‡((
vif
->
nw_ty≥
 =
AP_NETWORK
) &&

1152 (
	`memcmp
(
vif
->
ndev
->
dev_addr
, 
mac_addr
, 
ETH_ALEN
))) {

1154 
fw_c⁄n
->
∑ª¡_c⁄nId
 =

1155 
	`_föd_∑ª¡_c⁄n_id
(
p2p_Êow˘æ
, 
vif
);

1158 
fw_c⁄n
->
∑ª¡_c⁄nId
 = fw_c⁄n->
c⁄nId
;

1161 
fw_c⁄n
->
c⁄nId
 = 
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
;

1162 
fw_c⁄n
->
∑ª¡_c⁄nId
 = 
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
;

1163 
fw_c⁄n
->
c⁄√˘_°©us
 = 0;

1164 
fw_c⁄n
->
¥evious_ˇn_£nd
 = 
åue
;

1165 
	`mem£t
(
fw_c⁄n
->
mac_addr
, 0, 
ETH_ALEN
);

1168 
fw_c⁄n
->
sche_tx
 = 0;

1169 
fw_c⁄n
->
sche_ª_tx
 = 0;

1170 
fw_c⁄n
->
sche_ª_tx_agög
 = 0;

1171 
fw_c⁄n
->
sche_tx_queued
 = 0;

1172 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1174 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

1176 
¨
,

1177 
vif
->
nw_ty≥
,

1178 
c⁄nId
,

1179 
fw_c⁄n
->
∑ª¡_c⁄nId
);

1182 
	}
}

1184 
u8
 
	$©h6kl_p2p_Êow˘æ_gë_c⁄n_id
(
©h6kl_vif
 *
vif
,

1185 
sk_buff
 *
skb
)

1187 
©h6kl
 *
¨
 = 
vif
->ar;

1188 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

1189 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

1190 
ëhhdr
 *ethhdr;

1191 
u8
 *
höt
;

1192 
u8
 
c⁄nId
 = 
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
;

1193 
i
;

1195 i‡(!
p2p_Êow˘æ
)

1196  
c⁄nId
;

1198 
ëhhdr
 = (ëhhd∏*)(
skb
->
d©a
 + (
wmi_d©a_hdr
));

1200 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
)

1201 
höt
 = 
ëhhdr
->
h_sour˚
;

1203 i‡(
	`is_mu…iˇ°_ëhî_addr
(
ëhhdr
->
h_de°
))

1204 
höt
 = 
ëhhdr
->
h_sour˚
;

1206 
höt
 = 
ëhhdr
->
h_de°
;

1209 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1210 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[0];

1211 
i
 = 0; i < 
NUM_CONN
; i++, 
fw_c⁄n
++) {

1212 i‡(
fw_c⁄n
->
c⁄nId
 =
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
)

1215 i‡(
	`memcmp
(
fw_c⁄n
->
mac_addr
, 
höt
, 
ETH_ALEN
) == 0) {

1216 
c⁄nId
 = 
fw_c⁄n
->connId;

1222 i‡(
p2p_Êow˘æ
->
sche_ty≥
 =
P2P_FLOWCTRL_SCHE_TYPE_INTERFACE
)

1223 
c⁄nId
 = 
fw_c⁄n
->
∑ª¡_c⁄nId
;

1224 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1226 
	`©h6kl_dbg
(
ATH6KL_DBG_FLOWCTRL
,

1228 
c⁄nId
,

1229 
höt
[0], hint[1], hint[2], hint[3], hint[4], hint[5]);

1231  
c⁄nId
;

1232 
	}
}

1234 
	$©h6kl_p2p_Êow˘æ_°©
(
©h6kl
 *
¨
,

1235 
u8
 *
buf
, 
buf_Àn
)

1237 
©h6kl_p2p_Êow˘æ
 *
p2p_Êow˘æ
 = 
¨
->
p2p_Êow˘æ_˘x
;

1238 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
;

1239 
i
, 
Àn
 = 0;

1241 i‡((!
p2p_Êow˘æ
Ë|| (!
buf
))

1244 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n NUM_CONN : %d",

1245 
NUM_CONN
);

1246 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n SCHE_TYPE : %s",

1247 (
p2p_Êow˘æ
->
sche_ty≥
 =
P2P_FLOWCTRL_SCHE_TYPE_CONNECTION
 ?

1249 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n EVENT_CNT : %d",

1250 
p2p_Êow˘æ
->
p2p_Êow˘æ_evít_˙t
);

1252 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n NOA_UPDATE :");

1253 
i
 = 0; i < 
¨
->
vif_max
; i++) {

1254 
©h6kl_vif
 *
vif
;

1255 
p2p_ps_öfo
 *
p2p_ps
;

1257 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

1258 i‡(
vif
) {

1259 
p2p_ps
 = 
vif
->
p2p_ps_öfo_˘x
;

1260 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1261 " %d", 
p2p_ps
->
go_nﬂ_nŸif_˙t
);

1264 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen, "\n");

1266 
	`•ö_lock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1267 
i
 = 0; i < 
NUM_CONN
; i++) {

1268 
fw_c⁄n
 = &
p2p_Êow˘æ
->
fw_c⁄n_li°
[
i
];

1270 i‡(
fw_c⁄n
->
c⁄nId
 =
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
)

1273 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1274 "\n[%d]===============================\n", 
i
);

1275 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1276 " vi‡ : %p\n", 
fw_c⁄n
->
vif
);

1277 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1278 " c⁄nId : %d\n", 
fw_c⁄n
->
c⁄nId
);

1279 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1280 "Ö¨ít_c⁄nId: %d\n", 
fw_c⁄n
->
∑ª¡_c⁄nId
);

1281 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1283 
fw_c⁄n
->
mac_addr
[0],

1284 
fw_c⁄n
->
mac_addr
[1],

1285 
fw_c⁄n
->
mac_addr
[2],

1286 
fw_c⁄n
->
mac_addr
[3],

1287 
fw_c⁄n
->
mac_addr
[4],

1288 
fw_c⁄n
->
mac_addr
[5]);

1289 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1290 " sètu† : %02x\n", 
fw_c⁄n
->
c⁄√˘_°©us
);

1291 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1292 "ÖªC™Síd : %d\n", 
fw_c⁄n
->
¥evious_ˇn_£nd
);

1293 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1294 "Åx_queued : %d\n", 
fw_c⁄n
->
sche_tx_queued
);

1295 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1296 "Åx : %d\n", 
fw_c⁄n
->
sche_tx
);

1297 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1298 "Ñx_tx : %d\n", 
fw_c⁄n
->
sche_ª_tx
);

1299 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

1300 "Ñe_tx_agög : %d\n", 
fw_c⁄n
->
sche_ª_tx_agög
);

1302 
	`•ö_u∆ock_bh
(&
p2p_Êow˘æ
->
p2p_Êow˘æ_lock
);

1304  
Àn
;

1305 
	}
}

1307 
©h6kl_p2p_rc_öfo
 *
	$©h6kl_p2p_rc_öô
(
©h6kl
 *
¨
)

1309 
©h6kl_p2p_rc_öfo
 *
p2p_rc
;

1311 
p2p_rc
 = 
	`kzÆloc
((
©h6kl_p2p_rc_öfo
), 
GFP_KERNEL
);

1312 i‡(!
p2p_rc
) {

1313 
	`©h6kl_îr
("failedÅoálloc memory forÖ2p_rc\n");

1314  
NULL
;

1317 
p2p_rc
->
¨
 =ár;

1318 
p2p_rc
->
Êags
 = 
ATH6KL_RC_FLAGS_DONE
;

1319 
p2p_rc
->
u£r_ch™_ty≥
 = 
P2P_RC_USER_BLACK_CHAN
;

1320 
	`•ö_lock_öô
(&
p2p_rc
->
p2p_rc_lock
);

1321 
p2p_rc
->
¢r_com≥nßti⁄
 = 
P2P_RC_DEF_SNR_COMP
;

1323 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
, "p2p_rc init, flags %x\n",

1324 
p2p_rc
->
Êags
);

1326  
p2p_rc
;

1327 
	}
}

1329 
	$©h6kl_p2p_rc_deöô
(
©h6kl
 *
¨
)

1331 
©h6kl_p2p_rc_öfo
 *
p2p_rc
 = 
¨
->
p2p_rc_öfo_˘x
;

1333 
	`k‰ì
(
p2p_rc
);

1335 
¨
->
p2p_rc_öfo_˘x
 = 
NULL
;

1337 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
, "p2p_rc deinit\n");

1340 
	}
}

1342 
ölöe
 
	$__p2p_rc_gë_ch™_¶Ÿ
(
õì80211_ch™√l
 *
ch™√l
)

1344 
	#_MIN_5G_CHAN_ID
 34

	)

1345 
chid
 = 
	`õì80211_‰equícy_to_ch™√l
(
ch™√l
->
˚¡î_‰eq
);

1347 i‡(
ch™√l
->
b™d
 =(
u32
)
NL80211_BAND_2GHZ
)

1348  
chid
 - 1;

1349 i‡(
ch™√l
->
b™d
 =(
u32
)
NL80211_BAND_5GHZ
)

1350  
ATH6KL_RC_MAX_2G_CHAN_RECORD
 +

1351 ((
chid
 - 
_MIN_5G_CHAN_ID
) / 2);

1353 
	`©h6kl_îr
("p2p_r¯¶Ÿ faû chid %d!\n", 
chid
);

1354 
	`BUG_ON
(1);

1357 #unde‡
_MIN_5G_CHAN_ID


1358 
	}
}

1360 
	$©h6kl_p2p_rc_„tch_ch™
(
©h6kl
 *
¨
)

1362 
©h6kl_p2p_rc_öfo
 *
p2p_rc
 = 
¨
->
p2p_rc_öfo_˘x
;

1363 
õì80211_b™d
 
b™d
;

1364 
wùhy
 *wùhy = 
NULL
;

1365 
i
, 
¶Ÿ
;

1367 i‡(!
p2p_rc
)

1370 
wùhy
 = 
p2p_rc
->
¨
->wiphy;

1371 
	`•ö_lock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1372 
p2p_rc
->
ch™_ªc‹d_˙t
 = 0;

1373 
i
 = 0; i < 
ATH6KL_RC_MAX_CHAN_RECORD
; i++) {

1374 
p2p_rc
->
ch™_ªc‹d
[
i
].
ch™√l
 = 
NULL
;

1375 
p2p_rc
->
ch™_ªc‹d
[
i
].
be°_¢r
 = 
P2P_RC_NULL_SNR
;

1376 
p2p_rc
->
ch™_ªc‹d
[
i
].
avî_¢r
 = 
P2P_RC_NULL_SNR
;

1380 
b™d
 = 0; b™d < 
IEEE80211_NUM_BANDS
; band++) {

1381 
õì80211_suµ‹ãd_b™d
 *
sb™d
 = 
wùhy
->
b™ds
[
b™d
];

1383 i‡(!
sb™d
)

1386 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

1387 
õì80211_ch™√l
 *
ch™
 = &
sb™d
->
ch™√ls
[
i
];

1389 i‡(
ch™
->
Êags
 & 
IEEE80211_CHAN_DISABLED
)

1392 
¶Ÿ
 = 
	`__p2p_rc_gë_ch™_¶Ÿ
(
ch™
);

1393 i‡((
¶Ÿ
 >0Ë&& (¶Ÿ < 
ATH6KL_RC_MAX_CHAN_RECORD
)) {

1394 
p2p_rc
->
ch™_ªc‹d
[
¶Ÿ
].
ch™√l
 = 
ch™
;

1395 
p2p_rc
->
ch™_ªc‹d_˙t
++;

1397 
	`©h6kl_îr
("p2p_rc fetch fail, f %d s %d!\n",

1398 
ch™
->
˚¡î_‰eq
,

1399 
¶Ÿ
);

1403 
p2p_rc
->
Êags
 |
ATH6KL_RC_FLAGS_CHAN_RECORD_FETCHED
;

1404 
	`•ö_u∆ock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1406 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

1408 
p2p_rc
->
ch™_ªc‹d_˙t
);

1411 
	}
}

1413 
	$_p2p_rc_ª£t_ch™_ªc‹d
(
©h6kl_p2p_rc_öfo
 *
p2p_rc
)

1415 
i
;

1418 
	`•ö_lock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1419 
i
 = 0; i < 
ATH6KL_RC_MAX_CHAN_RECORD
; i++) {

1420 
p2p_rc
->
ch™_ªc‹d
[
i
].
be°_¢r
 = 
P2P_RC_NULL_SNR
;

1421 
p2p_rc
->
ch™_ªc‹d
[
i
].
avî_¢r
 = 
P2P_RC_NULL_SNR
;

1424 i‡(
p2p_rc
->
Êags
 & 
ATH6KL_RC_FLAGS_CHAN_RECORD_FETCHED
) {

1425 
	`•ö_u∆ock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1427 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

1429 
p2p_rc
->
ch™_ªc‹d_˙t
);

1433 
	`•ö_u∆ock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1435 
	`©h6kl_p2p_rc_„tch_ch™
(
p2p_rc
->
¨
);

1438 
	}
}

1440 
	$©h6kl_p2p_rc_sˇn_°¨t
(
©h6kl_vif
 *
vif
, 
boﬁ
 
loˇl_sˇn
)

1442 
©h6kl_p2p_rc_öfo
 *
p2p_rc
 = 
vif
->
¨
->
p2p_rc_öfo_˘x
;

1444 i‡(!
p2p_rc
)

1455 i‡((
loˇl_sˇn
) ||

1456 (
	`ã°_bô
(
SCANNING
, &
vif
->
Êags
) &&

1457 (
vif
->
sˇnb™d_ty≥
 =
SCANBAND_TYPE_ALL
))) {

1459 
	`_p2p_rc_ª£t_ch™_ªc‹d
(
p2p_rc
);

1461 
p2p_rc
->
Êags
 |
ATH6KL_RC_FLAGS_NEED_UPDATED
;

1462 
p2p_rc
->
œ°_upd©e
 = 
jiffõs
;

1465 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

1467 (
p2p_rc
->
Êags
 & 
ATH6KL_RC_FLAGS_NEED_UPDATED
 ?

1469 (
vif
->
sˇn_ªq
 ?

1470 
vif
->
sˇn_ªq
->
n_ch™√ls
 : -1),

1471 (
loˇl_sˇn
 ? "local-scan" : ""),

1472 
vif
->
sˇnb™d_ty≥
,

1473 
p2p_rc
->
ch™_ªc‹d_˙t
);

1476 
	}
}

1478 
	$©h6kl_p2p_rc_sˇn_com∂ëe_evít
(
©h6kl_vif
 *
vif
, 
boﬁ
 
ab‹ãd
)

1480 
©h6kl_p2p_rc_öfo
 *
p2p_rc
 = 
vif
->
¨
->
p2p_rc_öfo_˘x
;

1481 
i
;

1483 i‡(!
p2p_rc
)

1486 
p2p_rc
->
Êags
 &~
ATH6KL_RC_FLAGS_NEED_UPDATED
;

1489 
	`•ö_lock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1490 i‡(!
ab‹ãd
) {

1491 
p2p_rc
->
Êags
 &~
ATH6KL_RC_FLAGS_DONE
;

1492 
i
 = 0; i < 
P2P_RC_TYPE_MAX
; i++)

1493 
p2p_rc
->
œ°_p2p_rc
[
i
] = 
NULL
;

1495 
	`•ö_u∆ock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1497 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

1499 (
ab‹ãd
 ? "aborted" : ""));

1502 
	}
}

1504 
ölöe
 
	$_p2p_rc_bss_upd©e
(
©h6kl_p2p_rc_öfo
 *
p2p_rc
,

1505 
õì80211_ch™√l
 *
ch™√l
,

1506 
u8
 
¢r
)

1508 
¶Ÿ
;

1510 
¶Ÿ
 = 
	`__p2p_rc_gë_ch™_¶Ÿ
(
ch™√l
);

1511 i‡((
¶Ÿ
 >0Ë&& (¶Ÿ < 
ATH6KL_RC_MAX_CHAN_RECORD
)) {

1512 
p2p_rc_ch™_ªc‹d
 *
p2p_rc_ch™
;

1514 
	`•ö_lock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1515 
p2p_rc_ch™
 = &(
p2p_rc
->
ch™_ªc‹d
[
¶Ÿ
]);

1517 i‡(
ch™√l
 !
p2p_rc_ch™
->channel) {

1518 
	`•ö_u∆ock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1519 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

1521 
ch™√l
->
˚¡î_‰eq
,

1522 
p2p_rc_ch™
->
ch™√l
->
˚¡î_‰eq
);

1526 
	`BUG_ON
(!
p2p_rc_ch™
->
ch™√l
);

1528 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

1530 ((
p2p_rc_ch™
->
be°_¢r
 !
P2P_RC_NULL_SNR
) ?

1532 
ch™√l
->
˚¡î_‰eq
,

1533 
¢r
,

1534 
¶Ÿ
);

1536 i‡(
¢r
 > 
P2P_RC_MAX_SNR
)

1537 
¢r
 = 
P2P_RC_MAX_SNR
;

1540 i‡(
p2p_rc_ch™
->
be°_¢r
 !
P2P_RC_NULL_SNR
) {

1541 i‡(
¢r
 > 
p2p_rc_ch™
->
be°_¢r
)

1542 
p2p_rc_ch™
->
be°_¢r
 = 
¢r
;

1544 
p2p_rc_ch™
->
be°_¢r
 = 
¢r
;

1545 
	`•ö_u∆ock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1547 
	`©h6kl_îr
("p2p_rc bssinfo invalid frequency %d!\n",

1548 
ch™√l
->
˚¡î_‰eq
);

1551 
	}
}

1553 
	$©h6kl_p2p_rc_bss_öfo
(
©h6kl_vif
 *
vif
,

1554 
u8
 
¢r
,

1555 
õì80211_ch™√l
 *
ch™√l
)

1557 
©h6kl_p2p_rc_öfo
 *
p2p_rc
 = 
vif
->
¨
->
p2p_rc_öfo_˘x
;

1559 i‡(!
p2p_rc
)

1562 i‡(
p2p_rc
->
Êags
 & 
ATH6KL_RC_FLAGS_NEED_UPDATED
)

1563 
	`_p2p_rc_bss_upd©e
(
p2p_rc
, 
ch™√l
, 
¢r
);

1566 
	}
}

1568 
ölöe
 
u8
 
	$__p2p_rc_avîage_¢r
(
p2p_rc_ch™_ªc‹d
 *
ch™
[],

1569 
cou¡
)

1571 
p2p_rc_ch™_ªc‹d
 *
p2p_rc_ch™
;

1572 
i
, 
avî_¢r
 = 0, 
com≥nßã
 = 0;

1574 
i
 = 0; i < 
ATH6KL_RC_AVERAGE_CHAN_CNT
; i++) {

1575 
p2p_rc_ch™
 = 
ch™
[
i
];

1576 i‡((
i
 < 
cou¡
) &&

1577 (
p2p_rc_ch™
->
ch™√l
))

1578 
avî_¢r
 +
p2p_rc_ch™
->
be°_¢r
;

1580 
avî_¢r
 +
P2P_RC_NULL_SNR
;

1584 i‡((
avî_¢r
 % 
ATH6KL_RC_AVERAGE_CHAN_CNT
) >

1585 (
ATH6KL_RC_AVERAGE_CHAN_CNT
 >> 1))

1586 
com≥nßã
++;

1588 
avî_¢r
 = (avî_¢∏/ 
ATH6KL_RC_AVERAGE_CHAN_CNT
Ë+ 
com≥nßã
;

1590 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

1592 (
ch™
[0]->
ch™√l
 ? ch™[0]->ch™√l->
˚¡î_‰eq
 : 0),

1593 
avî_¢r
,

1594 
cou¡
,

1595 
ATH6KL_RC_AVERAGE_CHAN_CNT
);

1597  
avî_¢r
;

1598 
	}
}

1600 
boﬁ
 
	$__p2p_rc_is_u£r_ch™√l
(
©h6kl_p2p_rc_öfo
 *
p2p_rc
,

1601 
õì80211_ch™√l
 *
ch™
)

1603 
p2p_rc_u£r_ch™_ty≥
 
u£r_ch™_ty≥
 = 
p2p_rc
->user_chan_type;

1604 
i
;

1606 
i
 = 0; i < 
ATH6KL_RC_MAX_CHAN_RECORD
; i++) {

1607 i‡((
p2p_rc
->
u£r_ch™_li°
[
i
]) &&

1608 (
ch™
->
˚¡î_‰eq
 =
p2p_rc
->
u£r_ch™_li°
[
i
])) {

1609 i‡(
u£r_ch™_ty≥
 =
P2P_RC_USER_WHITE_CHAN
)

1610  
åue
;

1612  
Ál£
;

1616 i‡(
u£r_ch™_ty≥
 =
P2P_RC_USER_WHITE_CHAN
)

1617  
Ál£
;

1619  
åue
;

1620 
	}
}

1622 
p2p_rc_ch™_ªc‹d
 *
	$_p2p_rc_gë_2g_ch™
(

1623 
©h6kl_p2p_rc_öfo
 *
p2p_rc
,

1624 
boﬁ
 
⁄ly_p2p_socül
,

1625 
boﬁ
 
⁄ly_p2p
,

1626 
boﬁ
 
u£r_ch™
,

1627 
boﬁ
 
no_…e
)

1629 
p2p_rc_ch™_ªc‹d
 *
p2p_rc_ch™
, *
be°_p2p_rc_ch™
 = 
NULL
;

1630 
p2p_rc_ch™_ªc‹d
 *
adj_ch™
[
ATH6KL_RC_AVERAGE_CHAN_CNT
];

1631 
õì80211_ch™√l
 *
ch™
;

1632 
i
, 
j
, 
cou¡
;

1633 
u8
 
avîage_h
;

1635 
	`BUG_ON
((
⁄ly_p2p_socül
 && 
⁄ly_p2p
));

1638 
p2p_rc_ch™
 = &(
p2p_rc
->
ch™_ªc‹d
[0]);

1640 
i
 = 0; i < 
ATH6KL_RC_MAX_2G_CHAN_RECORD
; i++, 
p2p_rc_ch™
++) {

1641 
ch™
 = 
p2p_rc_ch™
->
ch™√l
;

1642 i‡(
ch™
) {

1643 i‡((
u£r_ch™
) &&

1644 !
	`__p2p_rc_is_u£r_ch™√l
(
p2p_rc
, 
ch™
))

1646 i‡((
⁄ly_p2p_socül
) &&

1647 !
	`©h6kl_p2p_is_socül_ch™√l
(
ch™
->
˚¡î_‰eq
))

1649 i‡((
⁄ly_p2p
) &&

1650 (
ch™
->
Êags
 & (
IEEE80211_CHAN_RADAR
 |

1651 
IEEE80211_CHAN_PASSIVE_SCAN
 |

1652 
IEEE80211_CHAN_NO_IBSS
)) &&

1653 !
	`©h6kl_p2p_is_p2p_ch™√l
(
ch™
->
˚¡î_‰eq
))

1655 i‡((
no_…e
) &&

1656 
	`©h6kl_ªg_is_…e_ch™√l
(
p2p_rc
->
¨
,

1657 
ch™
->
˚¡î_‰eq
))

1661 
cou¡
 = 0;

1662 
adj_ch™
[
cou¡
++] = 
p2p_rc_ch™
;

1663 
j
 = 1; j <
ATH6KL_RC_AVERAGE_CHAN_OFFSET
; j++) {

1664 i‡(
ch™
->
˚¡î_‰eq
 - (
j
 * 5) >=

1665 
ATH6KL_RC_AVERAGE_CHAN_START
)

1666 
adj_ch™
[
cou¡
++] = 
p2p_rc_ch™
 - 
j
;

1667 i‡(
ch™
->
˚¡î_‰eq
 + (
j
 * 5) <=

1668 
ATH6KL_RC_AVERAGE_CHAN_END
)

1669 
adj_ch™
[
cou¡
++] = 
p2p_rc_ch™
 + 
j
;

1672 i‡((
cou¡
) &&

1673 (
ch™
->
˚¡î_‰eq
 <
ATH6KL_RC_AVERAGE_CHAN_END
))

1674 
p2p_rc_ch™
->
avî_¢r
 = 
	`__p2p_rc_avîage_¢r
(

1675 
adj_ch™
,

1676 
cou¡
);

1678 
p2p_rc_ch™
->
avî_¢r
 =Ö2p_rc_ch™->
be°_¢r
;

1680 i‡(
be°_p2p_rc_ch™
) {

1681 
avîage_h
 = 
p2p_rc_ch™
->
avî_¢r
;

1682 i‡(
p2p_rc
->
Êags
 & 
ATH6KL_RC_FLAGS_HIGH_CHAN
)

1683 
avîage_h
++;

1685 i‡(
avîage_h
 > 
be°_p2p_rc_ch™
->
avî_¢r
)

1686 
be°_p2p_rc_ch™
 = 
p2p_rc_ch™
;

1688 
be°_p2p_rc_ch™
 = 
p2p_rc_ch™
;

1692 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

1694 (
be°_p2p_rc_ch™
 ?

1695 
be°_p2p_rc_ch™
->
ch™√l
->
˚¡î_‰eq
 : 0),

1696 (
be°_p2p_rc_ch™
 ?

1697 
be°_p2p_rc_ch™
->
be°_¢r
 : 0));

1699  
be°_p2p_rc_ch™
;

1700 
	}
}

1702 
p2p_rc_ch™_ªc‹d
 *
	$_p2p_rc_gë_5g_ch™
(

1703 
©h6kl_p2p_rc_öfo
 *
p2p_rc
,

1704 
boﬁ
 
⁄ly_p2p
,

1705 
boﬁ
 
no_dfs
,

1706 
boﬁ
 
u£r_ch™
)

1708 
p2p_rc_ch™_ªc‹d
 *
p2p_rc_ch™
, *
be°_p2p_rc_ch™
 = 
NULL
;

1709 
õì80211_ch™√l
 *
ch™
;

1710 
i
, 
¢r_h
;

1713 
p2p_rc_ch™
 = &(
p2p_rc
->
ch™_ªc‹d
[
ATH6KL_RC_MAX_2G_CHAN_RECORD
]);

1715 
i
 = 0; i < 
ATH6KL_RC_MAX_5G_CHAN_RECORD
; i++, 
p2p_rc_ch™
++) {

1716 
ch™
 = 
p2p_rc_ch™
->
ch™√l
;

1717 i‡(
ch™
) {

1718 i‡((
u£r_ch™
) &&

1719 !
	`__p2p_rc_is_u£r_ch™√l
(
p2p_rc
, 
ch™
))

1721 i‡((
⁄ly_p2p
) &&

1722 (
ch™
->
Êags
 & (
IEEE80211_CHAN_RADAR
 |

1723 
IEEE80211_CHAN_PASSIVE_SCAN
 |

1724 
IEEE80211_CHAN_NO_IBSS
)) &&

1725 !
	`©h6kl_p2p_is_p2p_ch™√l
(
ch™
->
˚¡î_‰eq
))

1727 i‡((
no_dfs
) &&

1728 (
ch™
->
Êags
 & 
IEEE80211_CHAN_RADAR
) &&

1729 (
p2p_rc_ch™
->
be°_¢r
 =
P2P_RC_NULL_SNR
))

1734 i‡(
be°_p2p_rc_ch™
) {

1735 
¢r_h
 = ()
p2p_rc_ch™
->
be°_¢r
;

1736 i‡(
p2p_rc
->
Êags
 & 
ATH6KL_RC_FLAGS_HIGH_CHAN
)

1737 
¢r_h
++;

1739 i‡(
¢r_h
 > ()
be°_p2p_rc_ch™
->
be°_¢r
)

1740 
be°_p2p_rc_ch™
 = 
p2p_rc_ch™
;

1742 
be°_p2p_rc_ch™
 = 
p2p_rc_ch™
;

1746 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

1748 (
be°_p2p_rc_ch™
 ?

1749 
be°_p2p_rc_ch™
->
ch™√l
->
˚¡î_‰eq
 : 0),

1750 (
be°_p2p_rc_ch™
 ?

1751 
be°_p2p_rc_ch™
->
be°_¢r
 : 0));

1753  
be°_p2p_rc_ch™
;

1754 
	}
}

1756 
	$©h6kl_p2p_rc_gë
(
©h6kl
 *
¨
, 
©h6kl_rc_ªp‹t
 *
rc_ªp‹t
)

1758 
©h6kl_p2p_rc_öfo
 *
p2p_rc
 = 
¨
->
p2p_rc_öfo_˘x
;

1759 
p2p_rc_ch™_ªc‹d
 **
p2p_rc_ch™
;

1760 
p2p_rc_ch™_ªc‹d
 *
u£r_ch™_2g
, *
u£r_ch™_5g
;

1762 i‡(!
p2p_rc
)

1763  -
ENOTSUPP
;

1766 i‡(
p2p_rc
->
Êags
 & 
ATH6KL_RC_FLAGS_NEED_UPDATED
)

1767  -
EINPROGRESS
;

1769 i‡((
p2p_rc
->
Êags
 & 
ATH6KL_RC_FLAGS_ALWAYS_FRESH
) &&

1770 
	`time_a·î
(
jiffõs
, 
p2p_rc
->
œ°_upd©e
 + 
ATH6KL_RC_FRESH_TIME
))

1771  -
EAGAIN
;

1773 
	`•ö_lock_bh
(&
p2p_rc
->
p2p_rc_lock
);

1775 
p2p_rc_ch™
 = &(
p2p_rc
->
œ°_p2p_rc
[0]);

1781 i‡(
p2p_rc
->
Êags
 & 
ATH6KL_RC_FLAGS_DONE
)

1782 
d⁄e
;

1785 
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
] = 
	`_p2p_rc_gë_2g_ch™
(
p2p_rc
,

1786 
Ál£
,

1787 
Ál£
,

1788 
Ál£
,

1789 
Ál£
);

1791 
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
] = 
	`_p2p_rc_gë_5g_ch™
(
p2p_rc
,

1792 
Ál£
,

1793 
Ál£
,

1794 
Ál£
);

1797 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
]) {

1798 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
]) {

1799 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
]->
avî_¢r
 >

1800 (
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
]->
be°_¢r
 +

1801 
p2p_rc
->
¢r_com≥nßti⁄
))

1802 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALL
] =

1803 
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
];

1805 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALL
] =

1806 
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
];

1808 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALL
] =

1809 
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
];

1810 } i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
])

1811 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALL
] =

1812 
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
];

1815 
p2p_rc_ch™
[
P2P_RC_TYPE_SOCAIL
] = 
	`_p2p_rc_gë_2g_ch™
(
p2p_rc
,

1816 
åue
,

1817 
Ál£
,

1818 
Ál£
,

1819 
Ál£
);

1822 
p2p_rc_ch™
[
P2P_RC_TYPE_2GP2P
] = 
	`_p2p_rc_gë_2g_ch™
(
p2p_rc
,

1823 
Ál£
,

1824 
åue
,

1825 
Ál£
,

1826 
Ál£
);

1829 
p2p_rc_ch™
[
P2P_RC_TYPE_5GP2P
] = 
	`_p2p_rc_gë_5g_ch™
(
p2p_rc
,

1830 
åue
,

1831 
åue
,

1832 
Ál£
);

1835 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GP2P
]) {

1836 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GP2P
]) {

1837 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GP2P
]->
avî_¢r
 >

1838 (
p2p_rc_ch™
[
P2P_RC_TYPE_5GP2P
]->
be°_¢r
 +

1839 
p2p_rc
->
¢r_com≥nßti⁄
))

1840 
p2p_rc_ch™
[
P2P_RC_TYPE_ALLP2P
] =

1841 
p2p_rc_ch™
[
P2P_RC_TYPE_2GP2P
];

1843 
p2p_rc_ch™
[
P2P_RC_TYPE_ALLP2P
] =

1844 
p2p_rc_ch™
[
P2P_RC_TYPE_5GP2P
];

1846 
p2p_rc_ch™
[
P2P_RC_TYPE_ALLP2P
] =

1847 
p2p_rc_ch™
[
P2P_RC_TYPE_2GP2P
];

1848 } i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GP2P
])

1849 
p2p_rc_ch™
[
P2P_RC_TYPE_ALLP2P
] =

1850 
p2p_rc_ch™
[
P2P_RC_TYPE_5GP2P
];

1853 
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
] = 
	`_p2p_rc_gë_5g_ch™
(
p2p_rc
,

1854 
Ál£
,

1855 
åue
,

1856 
Ál£
);

1859 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
]) {

1860 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
]) {

1861 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
]->
avî_¢r
 >

1862 (
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
]->
be°_¢r
 +

1863 
p2p_rc
->
¢r_com≥nßti⁄
))

1864 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNODFS
] =

1865 
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
];

1867 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNODFS
] =

1868 
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
];

1870 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNODFS
] =

1871 
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
];

1872 } i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
])

1873 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNODFS
] =

1874 
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
];

1877 
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
] = 
	`_p2p_rc_gë_2g_ch™
(
p2p_rc
,

1878 
Ál£
,

1879 
Ál£
,

1880 
Ál£
,

1881 
åue
);

1884 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
]) {

1885 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
]) {

1886 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
]->
avî_¢r
 >

1887 (
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
]->
be°_¢r
 +

1888 
p2p_rc
->
¢r_com≥nßti⁄
))

1889 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTE
] =

1890 
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
];

1892 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTE
] =

1893 
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
];

1895 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTE
] =

1896 
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
];

1897 } i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
])

1898 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTE
] =

1899 
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
];

1902 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
]) {

1903 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
]) {

1904 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
]->
avî_¢r
 >

1905 (
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
]->
be°_¢r
 +

1906 
p2p_rc
->
¢r_com≥nßti⁄
))

1907 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTEDFS
] =

1908 
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
];

1910 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTEDFS
] =

1911 
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
];

1913 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTEDFS
] =

1914 
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
];

1915 } i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
])

1916 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTEDFS
] =

1917 
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
];

1920 
u£r_ch™_2g
 = 
	`_p2p_rc_gë_2g_ch™
(
p2p_rc
,

1921 
Ál£
,

1922 
Ál£
,

1923 
åue
,

1924 
Ál£
);

1926 
u£r_ch™_5g
 = 
	`_p2p_rc_gë_5g_ch™
(
p2p_rc
,

1927 
Ál£
,

1928 
Ál£
,

1929 
åue
);

1931 i‡(
u£r_ch™_2g
) {

1932 i‡(
u£r_ch™_5g
) {

1933 i‡(
u£r_ch™_2g
->
avî_¢r
 >

1934 (
u£r_ch™_5g
->
be°_¢r
 + 
p2p_rc
->
¢r_com≥nßti⁄
))

1935 
p2p_rc_ch™
[
P2P_RC_TYPE_USER_CHAN
] =

1936 
u£r_ch™_2g
;

1938 
p2p_rc_ch™
[
P2P_RC_TYPE_USER_CHAN
] =

1939 
u£r_ch™_5g
;

1941 
p2p_rc_ch™
[
P2P_RC_TYPE_USER_CHAN
] = 
u£r_ch™_2g
;

1942 } i‡(
u£r_ch™_5g
)

1943 
p2p_rc_ch™
[
P2P_RC_TYPE_USER_CHAN
] = 
u£r_ch™_5g
;

1945 
p2p_rc
->
Êags
 |
ATH6KL_RC_FLAGS_DONE
;

1947 
d⁄e
:

1949 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
])

1950 
rc_ªp‹t
->
rc_2g
 =

1951 
p2p_rc_ch™
[
P2P_RC_TYPE_2GALL
]->
ch™√l
->
˚¡î_‰eq
;

1953 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
])

1954 
rc_ªp‹t
->
rc_5g
 =

1955 
p2p_rc_ch™
[
P2P_RC_TYPE_5GALL
]->
ch™√l
->
˚¡î_‰eq
;

1957 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALL
])

1958 
rc_ªp‹t
->
rc_Æl
 =

1959 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALL
]->
ch™√l
->
˚¡î_‰eq
;

1961 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_SOCAIL
])

1962 
rc_ªp‹t
->
rc_p2p_so
 =

1963 
p2p_rc_ch™
[
P2P_RC_TYPE_SOCAIL
]->
ch™√l
->
˚¡î_‰eq
;

1965 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GP2P
])

1966 
rc_ªp‹t
->
rc_p2p_2g
 =

1967 
p2p_rc_ch™
[
P2P_RC_TYPE_2GP2P
]->
ch™√l
->
˚¡î_‰eq
;

1969 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GP2P
])

1970 
rc_ªp‹t
->
rc_p2p_5g
 =

1971 
p2p_rc_ch™
[
P2P_RC_TYPE_5GP2P
]->
ch™√l
->
˚¡î_‰eq
;

1973 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_ALLP2P
])

1974 
rc_ªp‹t
->
rc_p2p_Æl
 =

1975 
p2p_rc_ch™
[
P2P_RC_TYPE_ALLP2P
]->
ch™√l
->
˚¡î_‰eq
;

1977 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
])

1978 
rc_ªp‹t
->
rc_5g_nodfs
 =

1979 
p2p_rc_ch™
[
P2P_RC_TYPE_5GNODFS
]->
ch™√l
->
˚¡î_‰eq
;

1981 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNODFS
])

1982 
rc_ªp‹t
->
rc_Æl_nodfs
 =

1983 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNODFS
]->
ch™√l
->
˚¡î_‰eq
;

1985 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
])

1986 
rc_ªp‹t
->
rc_2g_nﬁã
 =

1987 
p2p_rc_ch™
[
P2P_RC_TYPE_2GNOLTE
]->
ch™√l
->
˚¡î_‰eq
;

1989 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTE
])

1990 
rc_ªp‹t
->
rc_Æl_nﬁã
 =

1991 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTE
]->
ch™√l
->
˚¡î_‰eq
;

1993 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTEDFS
])

1994 
rc_ªp‹t
->
rc_Æl_nﬁãdfs
 =

1995 
p2p_rc_ch™
[
P2P_RC_TYPE_OVERALLNOLTEDFS
]->
ch™√l
->
˚¡î_‰eq
;

1997 i‡(
p2p_rc_ch™
[
P2P_RC_TYPE_USER_CHAN
])

1998 
rc_ªp‹t
->
rc_u£r_ch™
 =

1999 
p2p_rc_ch™
[
P2P_RC_TYPE_USER_CHAN
]->
ch™√l
->
˚¡î_‰eq
;

2001 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

2004 
	`•ö_u∆ock_bh
(&
p2p_rc
->
p2p_rc_lock
);

2007 
	}
}

2009 
	$©h6kl_p2p_rc_dump
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
)

2011 
©h6kl_p2p_rc_öfo
 *
p2p_rc
 = 
¨
->
p2p_rc_öfo_˘x
;

2012 
p2p_rc_ch™_ªc‹d
 *
p2p_rc_ch™
;

2013 
©h6kl_rc_ªp‹t
 
rc_ªp‹t
;

2014 
i
, 
idx
 = 0, 
Àn
 = 0;

2016 i‡((!
p2p_rc
Ë|| (!
buf
))

2019 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2021 
p2p_rc
->
Êags
,

2022 
p2p_rc
->
¢r_com≥nßti⁄
,

2023 ()
p2p_rc
->
œ°_upd©e
,

2024 ()
jiffõs
);

2026 
	`mem£t
(&
rc_ªp‹t
, 0, (
©h6kl_rc_ªp‹t
));

2027 i‡(
	`©h6kl_p2p_rc_gë
(
¨
, &
rc_ªp‹t
) != 0)

2030 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2032 
rc_ªp‹t
.
rc_2g
,

2033 
rc_ªp‹t
.
rc_5g
,

2034 
rc_ªp‹t
.
rc_Æl
);

2036 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2038 
rc_ªp‹t
.
rc_p2p_so
,

2039 
rc_ªp‹t
.
rc_p2p_2g
,

2040 
rc_ªp‹t
.
rc_p2p_5g
,

2041 
rc_ªp‹t
.
rc_p2p_Æl
);

2043 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2045 
rc_ªp‹t
.
rc_5g_nodfs
,

2046 
rc_ªp‹t
.
rc_Æl_nodfs
);

2048 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2050 
rc_ªp‹t
.
rc_2g_nﬁã
,

2051 
rc_ªp‹t
.
rc_Æl_nﬁã
);

2053 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2055 
rc_ªp‹t
.
rc_Æl_nﬁãdfs
);

2057 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2059 
rc_ªp‹t
.
rc_u£r_ch™
);

2061 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2063 (
p2p_rc
->
u£r_ch™_ty≥
 =
P2P_RC_USER_BLACK_CHAN
) ?

2066 
i
 = 0; i < 
ATH6KL_RC_MAX_CHAN_RECORD
; i++) {

2067 i‡(
p2p_rc
->
u£r_ch™_li°
[
i
])

2068 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2070 
p2p_rc
->
u£r_ch™_li°
[
i
]);

2073 
	`•ö_lock_bh
(&
p2p_rc
->
p2p_rc_lock
);

2074 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2076 
p2p_rc
->
ch™_ªc‹d_˙t
);

2077 
i
 = 0, 
p2p_rc_ch™
 = 
p2p_rc
->
ch™_ªc‹d
;

2078 
i
 < 
ATH6KL_RC_MAX_CHAN_RECORD
;

2079 
i
++, 
p2p_rc_ch™
++) {

2080 i‡(
p2p_rc_ch™
->
ch™√l
)

2081 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2083 
idx
,

2084 
p2p_rc_ch™
->
ch™√l
->
˚¡î_‰eq
,

2085 (
p2p_rc_ch™
->
be°_¢r
 ==

2086 
P2P_RC_NULL_SNR
) ?

2087 -1 : 
p2p_rc_ch™
->
be°_¢r
,

2088 (
p2p_rc_ch™
->
avî_¢r
 ==

2089 
P2P_RC_NULL_SNR
) ?

2090 -1 : 
p2p_rc_ch™
->
avî_¢r
);

2091 
idx
++;

2093 
	`•ö_u∆ock_bh
(&
p2p_rc
->
p2p_rc_lock
);

2095  
Àn
;

2096 
	}
}

2098 
	$©h6kl_p2p_rc_c⁄fig
(
©h6kl
 *
¨
, 
u16
 
‰eq
, 
ty≥
)

2100 
©h6kl_p2p_rc_öfo
 *
p2p_rc
 = 
¨
->
p2p_rc_öfo_˘x
;

2101 
i
 = -1, 
j
;

2102 
boﬁ
 
√ed_upd©e
 = 
Ál£
;

2104 i‡(
‰eq
) {

2105 
i
 = 0; i < 
ATH6KL_RC_MAX_CHAN_RECORD
; i++) {

2106 i‡(
p2p_rc
->
u£r_ch™_li°
[
i
]) {

2107 i‡(
p2p_rc
->
u£r_ch™_li°
[
i
] =
‰eq
)

2110 
√ed_upd©e
 = 
åue
;

2111 
p2p_rc
->
u£r_ch™_li°
[
i
] = 
‰eq
;

2116 i‡(
i
 =
ATH6KL_RC_MAX_CHAN_RECORD
)

2117 
	`©h6kl_îr
("p2p_rc user chanÜist full!\n");

2120 i‡(
p2p_rc
->
u£r_ch™_ty≥
 !
ty≥
) {

2121 
√ed_upd©e
 = 
åue
;

2122 
p2p_rc
->
u£r_ch™_ty≥
 = 
ty≥
;

2125 
	`mem£t
(
p2p_rc
->
u£r_ch™_li°
,

2127 ((
u16
Ë* 
ATH6KL_RC_MAX_CHAN_RECORD
));

2132 i‡(
√ed_upd©e
) {

2133 
p2p_rc
->
Êags
 &~
ATH6KL_RC_FLAGS_DONE
;

2134 
j
 = 0; j < 
P2P_RC_TYPE_MAX
; j++)

2135 
p2p_rc
->
œ°_p2p_rc
[
j
] = 
NULL
;

2138 
	`©h6kl_dbg
(
ATH6KL_DBG_RC
,

2140 
‰eq
,

2141 
ty≥
,

2142 
i
,

2143 (
√ed_upd©e
 ? "UPDATED" : ""));

2146 
	}
}

2148 
boﬁ
 
	$©h6kl_p2p_‰ame_ªåy
(
©h6kl
 *
¨
, 
u8
 *
‰m
, 
Àn
)

2150 
õì80211_p2p_a˘i⁄_public
 *
a˘i⁄_‰ame
 =

2151 (
õì80211_p2p_a˘i⁄_public
 *)
‰m
;

2153 i‡(!
¨
->
p2p_‰ame_ªåy
)

2154  
Ál£
;

2160 i‡(
Àn
 < 8)

2161  
Ál£
;

2163  ((
a˘i⁄_‰ame
->
ˇãg‹y
 =
WLAN_CATEGORY_PUBLIC
) &&

2164 (
a˘i⁄_‰ame
->
a˘i⁄_code
 ==

2165 
WLAN_PUB_ACTION_VENDER_SPECIFIC
) &&

2166 (
a˘i⁄_‰ame
->
oui
 =
	`˝u_to_be32
((
WLAN_OUI_WFA
 << 8) |

2167 (
WLAN_OUI_TYPE_WFA_P2P
))) &&

2168 (
a˘i⁄_‰ame
->
a˘i⁄_subty≥
 =
WLAN_P2P_GO_NEG_CONF
));

2169 
	}
}

2171 
boﬁ
 
	$©h6kl_p2p_is_p2p_‰ame
(
©h6kl
 *
¨
, c⁄° 
u8
 *
‰m
, 
size_t
 
Àn
)

2173 
õì80211_mgmt
 *
a˘i⁄
 = (õì80211_mgmà*)
‰m
;

2174 
õì80211_p2p_a˘i⁄_public
 *
a˘i⁄_public
;

2175 
õì80211_p2p_a˘i⁄_víd‹
 *
a˘i⁄_víd‹
;

2176 
u8
 *
a˘i⁄_°¨t
 = (u8 *)(&
a˘i⁄
->
u
.action);

2178 i‡(
Àn
 < (
õì80211_p2p_a˘i⁄_víd‹
))

2179  
Ál£
;

2181 
a˘i⁄_public
 = (
õì80211_p2p_a˘i⁄_public
 *)
a˘i⁄_°¨t
;

2182 i‡((
a˘i⁄_public
->
ˇãg‹y
 =
WLAN_CATEGORY_PUBLIC
) &&

2183 (
a˘i⁄_public
->
a˘i⁄_code
 ==

2184 
WLAN_PUB_ACTION_VENDER_SPECIFIC
) &&

2185 (
a˘i⁄_public
->
oui
 =
	`˝u_to_be32
((
WLAN_OUI_WFA
 << 8) |

2186 (
WLAN_OUI_TYPE_WFA_P2P
))))

2187  
åue
;

2189 
a˘i⁄_víd‹
 = (
õì80211_p2p_a˘i⁄_víd‹
 *)
a˘i⁄_°¨t
;

2190 i‡((
a˘i⁄_víd‹
->
ˇãg‹y
 =
WLAN_CATEGORY_VENDOR_SPECIFIC
) &&

2191 (
a˘i⁄_víd‹
->
oui
 =
	`˝u_to_be32
((
WLAN_OUI_WFA
 << 8) |

2192 (
WLAN_OUI_TYPE_WFA_P2P
))))

2193  
åue
;

2195  
Ál£
;

2196 
	}
}

2198 
	$©h6kl_p2p_c⁄√˘_evít
(
©h6kl_vif
 *
vif
,

2199 
u8
 
bóc⁄_õ_Àn
,

2200 
u8
 
assoc_ªq_Àn
,

2201 
u8
 
assoc_ª•_Àn
,

2202 
u8
 *
assoc_öfo
)

2204 
u8
 *
põ
, *
≥õ
;

2205 
õì80211_ht_ˇp
 *
ht_ˇp_õ
 = 
NULL
;

2206 
boﬁ
 
víd‹_•ec_õ_öãl
 = 
Ál£
;

2208 i‡(
vif
->
nw_ty≥
 !
INFRA_NETWORK
)

2213 i‡(!
vif
->
¨
->
p2p_w¨_bad_öãl_go
)

2217 
põ
 = 
assoc_öfo
 + 
bóc⁄_õ_Àn
 + 
assoc_ªq_Àn
 +

2218 ((
u16
) * 3);

2219 
≥õ
 = 
assoc_öfo
 + 
bóc⁄_õ_Àn
 + 
assoc_ªq_Àn
 + 
assoc_ª•_Àn
;

2221 
põ
 < 
≥õ
) {

2222 *
põ
) {

2223 
WLAN_EID_HT_CAPABILITY
:

2224 i‡(
põ
[1] >(
õì80211_ht_ˇp
))

2225 
ht_ˇp_õ
 =

2226 (
õì80211_ht_ˇp
 *)(
põ
 + 2);

2228 
WLAN_EID_VENDOR_SPECIFIC
:

2229 i‡(
põ
[1] > 0) {

2230 i‡(
põ
[1] == 0x0b &&

2231 
põ
[2] == 0x00 &&

2232 
põ
[3] == 0x17 &&

2233 
põ
[4] == 0x35 &&

2234 
põ
[5] == 0x01)

2235 
víd‹_•ec_õ_öãl
 = 
åue
;

2239 
põ
 +=Öie[1] + 2;

2243 i‡(
ht_ˇp_õ
 &&

2244 
víd‹_•ec_õ_öãl
 &&

2245 (
vif
->
¨
->
èrgë_subty≥
 & 
TARGET_SUBTYPE_2SS
)) {

2246 i‡(((
ht_ˇp_õ
->
ˇp_öfo
 & 
IEEE80211_HT_CAP_SM_PS
) ==

2247 (
WLAN_HT_CAP_SM_PS_DYNAMIC
 <<

2248 
IEEE80211_HT_CAP_SM_PS_SHIFT
)) &&

2249 (
ht_ˇp_õ
->
mcs
.
rx_mask
[1])) {

2250 
	`©h6kl_öfo
("Enable Intel-GO compatibility.\n");

2251 
	`©h6kl_wmi_£t_fix_øãs
(
vif
->
¨
->
wmi
,

2252 
vif
->
fw_vif_idx
,

2255 
	`£t_bô
(
PS_STICK
, &
vif
->
Êags
);

2256 
	`©h6kl_wmi_powîmode_cmd
(
vif
->
¨
->
wmi
,

2257 
vif
->
fw_vif_idx
,

2258 
MAX_PERF_POWER
);

2263 
	}
}

2266 
	$©h6kl_p2p_ªc⁄fig_ps
(
©h6kl
 *
¨
,

2267 
boﬁ
 
mcc
,

2268 
boﬁ
 
ˇŒ_⁄_disc⁄√˘
)

2270 
©h6kl_vif
 *
vif
;

2271 
u8
 
pwr_mode
 = 
REC_POWER
;

2272 
c⁄√˘ed
 = 0;

2276 
	`li°_f‹_óch_íåy
(
vif
, &
¨
->
vif_li°
, 
li°
) {

2277 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)) {

2278 i‡(
mcc
) {

2280 
	`£t_bô
(
PS_STICK
, &
vif
->
Êags
);

2281 
pwr_mode
 = 
MAX_PERF_POWER
;

2282 } i‡(
vif
->
wdev
.
i·y≥
 ==

2283 
NL80211_IFTYPE_P2P_GO
) {

2285 
	`£t_bô
(
PS_STICK
, &
vif
->
Êags
);

2286 
pwr_mode
 = 
MAX_PERF_POWER
;

2287 } i‡(
vif
->
wdev
.
i·y≥
 ==

2288 
NL80211_IFTYPE_P2P_CLIENT
) {

2290 i‡((
¨
->
p2p_w¨_p2p_˛õ¡_awake
) &&

2291 
c⁄√˘ed
) {

2292 
	`£t_bô
(
PS_STICK
, &
vif
->
Êags
);

2293 
pwr_mode
 = 
MAX_PERF_POWER
;

2296 
	`˛ór_bô
(
PS_STICK
, &
vif
->
Êags
);

2297 i‡(
vif
->
wdev
.
ps
 =
NL80211_PS_ENABLED
)

2298 
pwr_mode
 = 
REC_POWER
;

2300 
pwr_mode
 = 
MAX_PERF_POWER
;

2304 
	`˛ór_bô
(
PS_STICK
, &
vif
->
Êags
);

2305 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
)

2306 
pwr_mode
 = 
MAX_PERF_POWER
;

2308 i‡(
vif
->
wdev
.
ps
 =
NL80211_PS_ENABLED
)

2309 
pwr_mode
 = 
REC_POWER
;

2311 
pwr_mode
 = 
MAX_PERF_POWER
;

2314 
c⁄√˘ed
++;

2316 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

2318 
vif
->
fw_vif_idx
,

2319 
vif
->
œ°_pwr_mode
,

2320 
vif
->
wdev
.
ps
,

2321 
c⁄√˘ed
,

2322 (
mcc
 ? "MCC" : "SCC"),

2323 (
ˇŒ_⁄_disc⁄√˘
 ? "DISCONN" : "CONN"),

2324 (
pwr_mode
 =
REC_POWER
 ? "ON" : "OFF"));

2326 
	`©h6kl_wmi_powîmode_cmd
(
¨
->
wmi
,

2327 
vif
->
fw_vif_idx
,

2328 
pwr_mode
);

2333 
	}
}

2335 
	$_p2p_≥ndög_c⁄√˘_w‹k
(
w‹k_°ru˘
 *
w‹k
)

2337 
©h6kl_vif
 *
vif
 = 
NULL
;

2338 
p2p_≥ndög_c⁄√˘_öfo
 *
≥ndög_c⁄√˘_öfo
 = 
NULL
;

2339 c⁄° 
u8
 *
bssid
, *
ªq_õ
, *
ª•_õ
;

2341 i‡(!
w‹k
)

2342 
îr
;

2344 
vif
 = 
	`c⁄èöî_of
(
w‹k
, 
©h6kl_vif
,

2345 
w‹k_≥ndög_c⁄√˘
.
w‹k
);

2346 i‡(!
vif
)

2347 
îr
;

2349 
≥ndög_c⁄√˘_öfo
 = 
vif
->pending_connect_info;

2350 i‡(!
vif
->
≥ndög_c⁄√˘_öfo
)

2351 
îr
;

2353 
bssid
 = 
ªq_õ
 = 
ª•_õ
 = 
NULL
;

2354 i‡(!
	`is_zîo_ëhî_addr
(
≥ndög_c⁄√˘_öfo
->
bssid
))

2355 
bssid
 = 
≥ndög_c⁄√˘_öfo
->bssid;

2356 i‡(
≥ndög_c⁄√˘_öfo
->
ªq_õ_Àn
)

2357 
ªq_õ
 = 
≥ndög_c⁄√˘_öfo
->req_ie;

2358 i‡(
≥ndög_c⁄√˘_öfo
->
ª•_õ_Àn
)

2359 
ª•_õ
 = 
≥ndög_c⁄√˘_öfo
->resp_ie;

2362 
	`cfg80211_c⁄√˘_ªsu…
(
vif
->
ndev
,

2363 
bssid
,

2364 
ªq_õ
,

2365 
≥ndög_c⁄√˘_öfo
->
ªq_õ_Àn
,

2366 
ª•_õ
,

2367 
≥ndög_c⁄√˘_öfo
->
ª•_õ_Àn
,

2368 
≥ndög_c⁄√˘_öfo
->
°©us
,

2369 
≥ndög_c⁄√˘_öfo
->
gÂ
);

2371 
	`k‰ì
(
vif
->
≥ndög_c⁄√˘_öfo
);

2372 
vif
->
≥ndög_c⁄√˘_öfo
 = 
NULL
;

2375 
îr
:

2376 
	`©h6kl_îr
("P2PÖending connect work fail! vif %p work %p info %p\n",

2377 
vif
, 
w‹k
, 
≥ndög_c⁄√˘_öfo
);

2380 
	}
}

2382 
ölöe
 
boﬁ
 
	$_p2p_√ed_≥ndög_c⁄√˘
(
©h6kl_vif
 *
vif
,

2383 c⁄° 
u8
 *
bssid
)

2385 
boﬁ
 
√ed_≥ndög
 = 
Ál£
;

2388 i‡((
vif
->
¨
->
p2p_w¨_bad_brﬂdcom_go
) &&

2389 (
vif
->
sme_°©e
 =
SME_CONNECTED
) &&

2390 (
vif
->
c⁄√˘_˘æ_Êags
 & 
CONNECT_WPS_FLAG
) &&

2391 (
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_P2P_CLIENT
)) {

2392 
cfg80211_bss
 *
bss
;

2394 
bss
 = 
	`©h6kl_bss_gë
(
vif
->
¨
,

2395 
NULL
,

2396 
vif
->
bssid
,

2397 
vif
->
ssid
,

2398 
vif
->
ssid_Àn
,

2399 
WLAN_CAPABILITY_ESS
,

2400 
WLAN_CAPABILITY_ESS
);

2401 i‡(
bss
) {

2402 
u8
 *
põ
, *
≥õ
;

2404 
põ
 = 
≥õ
 = 
NULL
;

2406 #ifde‡
CFG80211_SAFE_BSS_INFO_ACCESS


2407 
	`rcu_ªad_lock
();

2408 i‡(
bss
->
õs
) {

2409 
põ
 = (
u8
 *)(
bss
->
õs
->
d©a
);

2410 
≥õ
 = 
põ
 + 
bss
->
õs
->
Àn
;

2413 i‡(
bss
->
öf‹m©i⁄_ñemíts
) {

2414 
põ
 = 
bss
->
öf‹m©i⁄_ñemíts
;

2415 
≥õ
 = 
põ
 + 
bss
->
Àn_öf‹m©i⁄_ñemíts
;

2419 
põ
 < 
≥õ
) {

2420 i‡(*
põ
 =
WLAN_EID_VENDOR_SPECIFIC
) {

2421 i‡((
põ
[1] > 0) &&

2422 (
põ
[2] == 0x00 &&

2423 
põ
[3] == 0x10 &&

2424 
põ
[4] == 0x18))

2425 
√ed_≥ndög
 = 
åue
;

2427 
põ
 +=Öie[1] + 2;

2430 #ifde‡
CFG80211_SAFE_BSS_INFO_ACCESS


2431 
	`rcu_ªad_u∆ock
();

2433 
	`©h6kl_bss_put
(
vif
->
¨
, 
bss
);

2437  
√ed_≥ndög
;

2438 
	}
}

2440 
ölöe
 
boﬁ
 
	$_p2p_Êush_≥ndög_c⁄√˘
(
©h6kl_vif
 *
vif
)

2442 i‡((
vif
->
¨
->
p2p_w¨_bad_brﬂdcom_go
) &&

2443 (
vif
->
sme_°©e
 =
SME_CONNECTED
) &&

2444 (
vif
->
wdev
.
i·y≥
 =
NL80211_IFTYPE_P2P_CLIENT
) &&

2445 (
vif
->
≥ndög_c⁄√˘_öfo
)) {

2446 
	`©h6kl_öfo
("FlushÖending connect work first.\n");

2447 
	`©h6kl_Êush_≥nd_skb
(
vif
);

2450  
Ál£
;

2451 
	}
}

2453 
boﬁ
 
	$©h6kl_p2p_≥ndög_c⁄√˘_evít
(
©h6kl_vif
 *
vif
,

2454 c⁄° 
u8
 *
bssid
,

2455 c⁄° 
u8
 *
ªq_õ
,

2456 
size_t
 
ªq_õ_Àn
,

2457 c⁄° 
u8
 *
ª•_õ
,

2458 
size_t
 
ª•_õ_Àn
,

2459 
u16
 
°©us
,

2460 
gÂ_t
 
gÂ
)

2462 
	#_P2P_PENDING_CONNECT_TIME
 800

	)

2463 
p2p_≥ndög_c⁄√˘_öfo
 *
≥ndög_c⁄√˘_öfo
;

2465 i‡(
	`_p2p_√ed_≥ndög_c⁄√˘
(
vif
, 
bssid
)) {

2466 i‡((
ªq_õ_Àn
 > 
ATH6KL_P2P_MAX_PENDING_INFO_IELEN
) ||

2467 (
ª•_õ_Àn
 > 
ATH6KL_P2P_MAX_PENDING_INFO_IELEN
))

2468  
Ál£
;

2470 
vif
->
≥ndög_c⁄√˘_öfo
 =

2471 
	`kzÆloc
((
p2p_≥ndög_c⁄√˘_öfo
),

2472 
GFP_ATOMIC
);

2473 i‡(
vif
->
≥ndög_c⁄√˘_öfo
 =
NULL
)

2474  
Ál£
;

2476 
≥ndög_c⁄√˘_öfo
 = 
vif
->pending_connect_info;

2477 i‡(
bssid
)

2478 
	`mem˝y
(
≥ndög_c⁄√˘_öfo
->
bssid
, bssid, 
ETH_ALEN
);

2479 i‡(
ªq_õ
) {

2480 
	`mem˝y
(
≥ndög_c⁄√˘_öfo
->
ªq_õ
,

2481 
ªq_õ
,

2482 
ªq_õ_Àn
);

2483 
≥ndög_c⁄√˘_öfo
->
ªq_õ_Àn
 =Ñeq_ie_len;

2485 i‡(
ª•_õ
) {

2486 
	`mem˝y
(
≥ndög_c⁄√˘_öfo
->
ª•_õ
,

2487 
ª•_õ
,

2488 
ª•_õ_Àn
);

2489 
≥ndög_c⁄√˘_öfo
->
ª•_õ_Àn
 =Ñesp_ie_len;

2491 
≥ndög_c⁄√˘_öfo
->
°©us
 = status;

2492 
≥ndög_c⁄√˘_öfo
->
gÂ
 = gfp;

2494 
	`INIT_DELAYED_WORK
(&
vif
->
w‹k_≥ndög_c⁄√˘
,

2495 
_p2p_≥ndög_c⁄√˘_w‹k
);

2496 
	`scheduÀ_dñayed_w‹k
(&
vif
->
w‹k_≥ndög_c⁄√˘
,

2497 (
	`m£cs_to_jiffõs
(
_P2P_PENDING_CONNECT_TIME
)));

2499 
	`©h6kl_öfo
("Enable Broadcom-GO compatibility, delay %d ms.\n",

2500 
_P2P_PENDING_CONNECT_TIME
);

2502  
åue
;

2504  
Ál£
;

2505 #unde‡
_P2P_PENDING_CONNECT_TIME


2506 
	}
}

2508 
	$©h6kl_p2p_≥ndög_disc⁄√˘_evít
(
©h6kl_vif
 *
vif
,

2509 
u16
 
ªas⁄
,

2510 
u8
 *
õ
,

2511 
size_t
 
õ_Àn
,

2512 
gÂ_t
 
gÂ
)

2515 
	`_p2p_Êush_≥ndög_c⁄√˘
(
vif
);

2518 
	}
}

2520 
boﬁ
 
	$©h6kl_p2p_õ_≠≥nd
(
©h6kl_vif
 *
vif
, 
u8
 
mgmt_‰ame_ty≥
)

2522 
©h6kl
 *
¨
 = 
vif
->ar;

2529 i‡(
¨
->
p2p_c⁄cuºít
 &&

2530 
¨
->
p2p_dediˇã
 &&

2531 (
vif
->
fw_vif_idx
 == 0) &&

2532 (
vif
->
nw_ty≥
 =
INFRA_NETWORK
) &&

2533 (
¨
->
p2p_õ_nŸ_≠≥nd
 & 
mgmt_‰ame_ty≥
))

2534  
Ál£
;

2536  
åue
;

2537 
	}
}

2540 
p2p_›î_ch™
 
	g©h6kl_p2p_›î_ch™
[] = {

2541 { 81, 2412, 2472, 5, 
P2P_OPER_CHAN_BW_HT20
},

2542 { 115, 5180, 5240, 20, 
P2P_OPER_CHAN_BW_HT20
},

2543 { 116, 5180, 5220, 20, 
P2P_OPER_CHAN_BW_HT40_PLUS
},

2544 { 117, 5200, 5240, 20, 
P2P_OPER_CHAN_BW_HT40_MINUS
},

2545 { 124, 5745, 5805, 20, 
P2P_OPER_CHAN_BW_HT20
},

2546 { 125, 5745, 5825, 20, 
P2P_OPER_CHAN_BW_HT20
},

2547 { 126, 5745, 5785, 20, 
P2P_OPER_CHAN_BW_HT40_PLUS
},

2548 { 127, 5765, 5805, 20, 
P2P_OPER_CHAN_BW_HT40_MINUS
},

2549 { 0, 0, 0, 0, 
P2P_OPER_CHAN_BW_NULL
},

2552 
boﬁ
 
	$©h6kl_p2p_is_p2p_ch™√l
(
u32
 
‰eq
)

2554 
p2p_›î_ch™
 *
p2p_›î_ch™_m≠
, *p2p_oper_chan;

2555 
u32
 
›_˛ass
, 
p2p_‰eq
;

2557 
p2p_›î_ch™_m≠
 = 
©h6kl_p2p_›î_ch™
;

2559 
›_˛ass
 = 0; 
p2p_›î_ch™_m≠
[›_˛ass].
›î_˛ass
; op_class++) {

2560 
p2p_›î_ch™
 = &
p2p_›î_ch™_m≠
[
›_˛ass
];

2561 
p2p_‰eq
 = 
p2p_›î_ch™
->
mö_ch™_‰eq
;

2562 
p2p_‰eq
 <
p2p_›î_ch™
->
max_ch™_‰eq
;

2563 
p2p_‰eq
 +
p2p_›î_ch™
->
öc_‰eq
) {

2564 i‡(
‰eq
 =
p2p_‰eq
) {

2566  
åue
;

2571  
Ál£
;

2572 
	}
}

2574 
boﬁ
 
	$©h6kl_p2p_is_socül_ch™√l
(
u32
 
‰eq
)

2576 i‡((
‰eq
 == 2412) ||

2577 (
‰eq
 == 2437) ||

2578 (
‰eq
 == 2462))

2579  
åue
;

2581  
Ál£
;

2582 
	}
}

	@p2p.h

17 #i‚de‡
P2P_H


18 
	#P2P_H


	)

20 
	#ATH6KL_P2P_BMISS_TIME
 (50)

	)

22 
	#ATH6KL_P2P_PS_MAX_NOA_DESCRIPTORS
 4

	)

24 
	#ATH6KL_P2P_PS_FLAGS_NOA_ENABLED
 
	`BIT
(0)

	)

25 
	#ATH6KL_P2P_PS_FLAGS_OPPPS_ENABLED
 
	`BIT
(1)

	)

27 
	#NL80211_IFTYPE_P2P_DEVICE_QCA
 (0xff)

	)

30 
	mIEEE80211_P2P_ATTR_NOTICE_OF_ABSENCE
 = 12,

34 
	mWLAN_PUB_ACTION_VENDER_SPECIFIC
 = 9,

38 
	mWLAN_P2P_GO_NEG_REG
 = 0,

39 
	mWLAN_P2P_GO_NEG_RESP
 = 1,

40 
	mWLAN_P2P_GO_NEG_CONF
 = 2,

41 
	mWLAN_P2P_INVITATION_REQ
 = 3,

42 
	mWLAN_P2P_INVITATION_RESP
 = 4,

43 
	mWLAN_P2P_DEV_DISC_REQ
 = 5,

44 
	mWLAN_P2P_DEV_DISC_RESP
 = 6,

45 
	mWLAN_P2P_PROV_DISC_REQ
 = 7,

46 
	mWLAN_P2P_PROV_DISC_RESP
 = 8

49 
	sõì80211_p2p_a˘i⁄_public
 {

50 
u8
 
	mˇãg‹y
;

51 
u8
 
	ma˘i⁄_code
;

52 
u32
 
	moui
;

53 
u8
 
	ma˘i⁄_subty≥
;

54 
u8
 
	mv¨übÀ
[0];

55 } 
	g__∑cked
;

57 
	sõì80211_p2p_a˘i⁄_víd‹
 {

58 
u8
 
	mˇãg‹y
;

59 
u32
 
	moui
;

60 
u8
 
	ma˘i⁄_subty≥
;

61 
u8
 
	mv¨übÀ
[0];

62 } 
	g__∑cked
;

64 
	sõì80211_p2p_nﬂ_des¸ùt‹
 {

65 
u8
 
	mcou¡_‹_ty≥
;

66 
__À32
 
	mduøti⁄
;

67 
__À32
 
	möãrvÆ
;

68 
__À32
 
	m°¨t_‹_off£t
;

69 } 
	g__∑cked
;

71 
	sõì80211_p2p_nﬂ_öfo
 {

72 
u8
 
	mödex
;

73 
u8
 
	m˘wödow_›ps_∑øm
;

74 
õì80211_p2p_nﬂ_des¸ùt‹


75 
	mnﬂs
[
ATH6KL_P2P_PS_MAX_NOA_DESCRIPTORS
];

76 } 
	g__∑cked
;

78 
	sõì80211_p2p_nﬂ_õ
 {

79 
u8
 
	mñemít_id
;

80 
u8
 
	mÀn
;

81 
u32
 
	moui
;

82 
u8
 
	m©å
;

83 
u16
 
	m©å_Àn
;

84 
õì80211_p2p_nﬂ_öfo
 
	mnﬂ_öfo
;

85 } 
	g__∑cked
;

87 
	sp2p_ps_öfo
 {

88 
©h6kl_vif
 *
	mvif
;

89 
•ölock_t
 
	mp2p_ps_lock
;

92 
u32
 
	mgo_Êags
;

93 
u8
 
	mgo_nﬂ_íabÀ_idx
;

94 
õì80211_p2p_nﬂ_öfo
 
	mgo_nﬂ
;

97 
u8
 *
	mgo_œ°_bóc⁄_≠p_õ
;

98 
u16
 
	mgo_œ°_bóc⁄_≠p_õ_Àn
;

99 
u8
 *
	mgo_œ°_nﬂ_õ
;

100 
u16
 
	mgo_œ°_nﬂ_õ_Àn
;

101 
u8
 *
	mgo_w‹kög_buf„r
;

104 
u32
 
	mgo_nﬂ_nŸif_˙t
;

108 
	#ATH6KL_P2P_FLOWCTRL_NULL_CONNID
 (0xff)

	)

109 
	#ATH6KL_P2P_FLOWCTRL_RECYCLE_LIMIT
 (10)

	)

111 
	#ATH6KL_P2P_FLOWCTRL_NETIF_STOP
 (0x00)

	)

112 
	#ATH6KL_P2P_FLOWCTRL_NETIF_WAKE
 (0x01)

	)

114 
	#ATH6KL_P2P_FLOWCTRL_REQ_STEP
 (30)

	)

115 
	#ATH6KL_P2P_FLOWCTRL_TXQ_LIMIT
 (50)

	)

117 
	s©h6kl_fw_c⁄n_li°
 {

118 
li°_hód
 
	mc⁄n_queue
;

119 
li°_hód
 
	mª_queue
;

121 
u8
 
	mc⁄nId
;

122 
u8
 
	m∑ª¡_c⁄nId
;

123 
u8
 
	mmac_addr
[
ETH_ALEN
];

124 
©h6kl_vif
 *
	mvif
;

128 
u8
 
	mbk_u≠sd
:1;

129 
u8
 
	mbe_u≠sd
:1;

130 
u8
 
	mvi_u≠sd
:1;

131 
u8
 
	mvo_u≠sd
:1;

132 
u8
 
	mps
:1;

133 
u8
 
	mocs
:1;

134 
u8
 
	mªs
:2;

136 
u8
 
	mc⁄√˘_°©us
;

139 
boﬁ
 
	m¥evious_ˇn_£nd
;

142 
	msche_tx_queued
;

143 
u32
 
	msche_tx
;

144 
u32
 
	msche_ª_tx
;

145 
u32
 
	msche_ª_tx_agög
;

148 
	ep2p_Êow˘æ_sche_ty≥
 {

149 
	mP2P_FLOWCTRL_SCHE_TYPE_CONNECTION
,

150 
	mP2P_FLOWCTRL_SCHE_TYPE_INTERFACE
,

153 
	s©h6kl_p2p_Êow˘æ
 {

154 
©h6kl
 *
	m¨
;

155 
•ölock_t
 
	mp2p_Êow˘æ_lock
;

157 
p2p_Êow˘æ_sche_ty≥
 
	msche_ty≥
;

158 
©h6kl_fw_c⁄n_li°
 
	mfw_c⁄n_li°
[
NUM_CONN
];

160 
u32
 
	mp2p_Êow˘æ_evít_˙t
;

164 
	#ATH6KL_RC_FLAGS_NEED_UPDATED
 (1 << 0)

	)

165 
	#ATH6KL_RC_FLAGS_DONE
 (1 << 1)

	)

166 
	#ATH6KL_RC_FLAGS_HIGH_CHAN
 (1 << 2)

	)

167 
	#ATH6KL_RC_FLAGS_ALWAYS_FRESH
 (1 << 3)

	)

168 
	#ATH6KL_RC_FLAGS_CHAN_RECORD_FETCHED
 (1 << 4)

	)

170 
	#ATH6KL_RC_MAX_2G_CHAN_RECORD
 (14)

	)

171 
	#ATH6KL_RC_MAX_5G_CHAN_RECORD
 (66)

	)

172 
	#ATH6KL_RC_MAX_CHAN_RECORD
 (
ATH6KL_RC_MAX_2G_CHAN_RECORD
 + \

173 
ATH6KL_RC_MAX_5G_CHAN_RECORD
)

	)

175 
	#ATH6KL_RC_AVERAGE_CHAN_CNT
 (5Ë

	)

176 
	#ATH6KL_RC_AVERAGE_CHAN_OFFSET
 (2Ë

	)

177 
	#ATH6KL_RC_AVERAGE_CHAN_START
 (2412Ë

	)

178 
	#ATH6KL_RC_AVERAGE_CHAN_END
 (2472Ë

	)

180 
	#ATH6KL_RC_FRESH_TIME
 
	`m£cs_to_jiffõs
(5 * 60 * 1000)

	)

182 
	ep2p_rc_u£r_ch™_ty≥
 {

183 
	mP2P_RC_USER_BLACK_CHAN
,

184 
	mP2P_RC_USER_WHITE_CHAN
,

187 
	ep2p_rc_ty≥
 {

188 
	mP2P_RC_TYPE_2GALL
,

189 
	mP2P_RC_TYPE_5GALL
,

190 
	mP2P_RC_TYPE_OVERALL
,

191 
	mP2P_RC_TYPE_SOCAIL
,

192 
	mP2P_RC_TYPE_2GP2P
,

193 
	mP2P_RC_TYPE_5GP2P
,

194 
	mP2P_RC_TYPE_ALLP2P
,

195 
	mP2P_RC_TYPE_5GNODFS
,

196 
	mP2P_RC_TYPE_OVERALLNODFS
,

197 
	mP2P_RC_TYPE_2GNOLTE
,

198 
	mP2P_RC_TYPE_OVERALLNOLTE
,

199 
	mP2P_RC_TYPE_OVERALLNOLTEDFS
,

200 
	mP2P_RC_TYPE_USER_CHAN
,

202 
	mP2P_RC_TYPE_MAX
,

205 
	sp2p_rc_bss_öfo
 {

206 
li°_hód
 
	mli°
;

207 
õì80211_ch™√l
 *
	mch™√l
;

208 
u8
 
	mrssi
;

211 
	sp2p_rc_ch™_ªc‹d
 {

212 
õì80211_ch™√l
 *
	mch™√l
;

214 
	#P2P_RC_MAX_SNR
 (96)

	)

215 
	#P2P_RC_NULL_SNR
 (
P2P_RC_MAX_SNR
 + 1)

	)

216 
u8
 
	mbe°_¢r
;

217 
u8
 
	mavî_¢r
;

220 
	s©h6kl_p2p_rc_öfo
 {

221 
©h6kl
 *
	m¨
;

222 
u32
 
	mÊags
;

223 
•ölock_t
 
	mp2p_rc_lock
;

224 
	mch™_ªc‹d_˙t
;

225 
p2p_rc_ch™_ªc‹d
 
	mch™_ªc‹d
[
ATH6KL_RC_MAX_CHAN_RECORD
];

226 
	mœ°_upd©e
;

228 
	#P2P_RC_DEF_SNR_COMP
 (0)

	)

229 
	m¢r_com≥nßti⁄
;

231 
p2p_rc_u£r_ch™_ty≥
 
	mu£r_ch™_ty≥
;

232 
u16
 
	mu£r_ch™_li°
[
ATH6KL_RC_MAX_CHAN_RECORD
];

235 
p2p_rc_ch™_ªc‹d
 *
	mœ°_p2p_rc
[
P2P_RC_TYPE_MAX
];

238 
	s©h6kl_rc_ªp‹t
 {

239 
u16
 
	mrc_2g
;

240 
u16
 
	mrc_5g
;

241 
u16
 
	mrc_Æl
;

242 
u16
 
	mrc_p2p_so
;

243 
u16
 
	mrc_p2p_2g
;

244 
u16
 
	mrc_p2p_5g
;

245 
u16
 
	mrc_p2p_Æl
;

246 
u16
 
	mrc_5g_nodfs
;

247 
u16
 
	mrc_Æl_nodfs
;

248 
u16
 
	mrc_2g_nﬁã
;

249 
u16
 
	mrc_Æl_nﬁã
;

250 
u16
 
	mrc_u£r_ch™
;

251 
u16
 
	mrc_Æl_nﬁãdfs
;

254 
	sp2p_›î_ch™
 {

255 
u16
 
	m›î_˛ass
;

256 
u32
 
	mmö_ch™_‰eq
;

257 
u32
 
	mmax_ch™_‰eq
;

258 
u32
 
	möc_‰eq
;

260 
	#P2P_OPER_CHAN_BW_NULL
 0

	)

261 
	#P2P_OPER_CHAN_BW_HT20
 1

	)

262 
	#P2P_OPER_CHAN_BW_HT40_PLUS
 2

	)

263 
	#P2P_OPER_CHAN_BW_HT40_MINUS
 3

	)

264 
u8
 
	mbw
;

267 
	sp2p_≥ndög_c⁄√˘_öfo
 {

268 
	#ATH6KL_P2P_MAX_PENDING_INFO_IELEN
 512

	)

269 
u8
 
	mbssid
[
ETH_ALEN
];

270 
u8
 
	mªq_õ
[
ATH6KL_P2P_MAX_PENDING_INFO_IELEN
];

271 
size_t
 
	mªq_õ_Àn
;

272 
u8
 
	mª•_õ
[
ATH6KL_P2P_MAX_PENDING_INFO_IELEN
];

273 
size_t
 
	mª•_õ_Àn
;

274 
u16
 
	m°©us
;

275 
gÂ_t
 
	mgÂ
;

278 
p2p_ps_öfo
 *
©h6kl_p2p_ps_öô
(
©h6kl_vif
 *
vif
);

279 
©h6kl_p2p_ps_deöô
(
©h6kl_vif
 *
vif
);

281 
©h6kl_p2p_ps_ª£t_nﬂ
(
p2p_ps_öfo
 *
p2p_ps
);

282 
©h6kl_p2p_ps_£tup_nﬂ
(
p2p_ps_öfo
 *
p2p_ps
,

283 
nﬂ_id
,

284 
u8
 
cou¡_ty≥
,

285 
u32
 
öãrvÆ
,

286 
u32
 
°¨t_off£t
,

287 
u32
 
duøti⁄
);

289 
©h6kl_p2p_ps_ª£t_›ps
(
p2p_ps_öfo
 *
p2p_ps
);

290 
©h6kl_p2p_ps_£tup_›ps
(
p2p_ps_öfo
 *
p2p_ps
,

291 
u8
 
íabÀd
,

292 
u8
 
˘wödows
);

294 
©h6kl_p2p_ps_upd©e_nŸif
(
p2p_ps_öfo
 *
p2p_ps
);

295 
©h6kl_p2p_ps_u£r_≠p_õ
(
p2p_ps_öfo
 *
p2p_ps
, 
u8
 
mgmt_‰m_ty≥
,

296 
u8
 **
õ
, *
Àn
);

298 
©h6kl_p2p_utûs_å™s_p‹ây≥
(
∆80211_i·y≥
 
ty≥
,

299 
u8
 *
›mode
,

300 
u8
 *
sub›mode
);

301 
©h6kl_p2p_utûs_öô_p‹t
(
©h6kl_vif
 *
vif
,

302 
∆80211_i·y≥
 
ty≥
);

303 
©h6kl_p2p_utûs_check_p‹t
(
©h6kl_vif
 *
vif
,

304 
u8
 
p‹t_id
);

306 
©h6kl_p2p_Êow˘æ
 *
©h6kl_p2p_Êow˘æ_c⁄n_li°_öô
(

307 
©h6kl
 *
¨
);

308 
©h6kl_p2p_Êow˘æ_c⁄n_cﬁÀ˘_by_c⁄n
(

309 
©h6kl_fw_c⁄n_li°
 *
fw_c⁄n
, 
li°_hód
 *
pc⁄èöî
,

310 *
¥e˛aim
);

311 
©h6kl_p2p_Êow˘æ_c⁄n_li°_deöô
(
©h6kl
 *
¨
);

312 
©h6kl_p2p_Êow˘æ_c⁄n_li°_˛ónup
(
©h6kl
 *
¨
);

313 
©h6kl_p2p_Êow˘æ_c⁄n_li°_˛ónup_by_if
(
©h6kl_vif
 *
vif
);

314 
©h6kl_p2p_Êow˘æ_√tif_å™sôi⁄
(
©h6kl
 *
¨
,

315 
u8
 
√w_°©e
);

316 
©h6kl_p2p_Êow˘æ_tx_scheduÀ
(
©h6kl
 *
¨
);

317 
©h6kl_p2p_Êow˘æ_tx_scheduÀ_pkt
(
©h6kl
 *
¨
, *
pkt
);

318 
©h6kl_p2p_Êow˘æ_°©e_ch™ge
(
©h6kl
 *
¨
);

319 
©h6kl_p2p_Êow˘æ_°©e_upd©e
(
©h6kl
 *
¨
,

320 
u8
 
numC⁄n
,

321 
u8
 
ac_m≠
[],

322 
u8
 
ac_queue_dïth
[]);

323 
©h6kl_p2p_Êow˘æ_£t_c⁄n_id
(
©h6kl_vif
 *
vif
,

324 
u8
 
mac_addr
[],

325 
u8
 
c⁄nId
);

326 
u8
 
©h6kl_p2p_Êow˘æ_gë_c⁄n_id
(
©h6kl_vif
 *
vif
,

327 
sk_buff
 *
skb
);

328 
©h6kl_p2p_Êow˘æ_°©
(
©h6kl
 *
¨
,

329 
u8
 *
buf
, 
buf_Àn
);

332 
©h6kl_p2p_rc_öfo
 *
©h6kl_p2p_rc_öô
(
©h6kl
 *
¨
);

333 
©h6kl_p2p_rc_deöô
(
©h6kl
 *
¨
);

334 
©h6kl_p2p_rc_„tch_ch™
(
©h6kl
 *
¨
);

335 
©h6kl_p2p_rc_bss_öfo
(
©h6kl_vif
 *
vif
,

336 
u8
 
¢r
,

337 
õì80211_ch™√l
 *
ch™√l
);

338 
©h6kl_p2p_rc_sˇn_°¨t
(
©h6kl_vif
 *
vif
, 
boﬁ
 
loˇl_sˇn
);

339 
©h6kl_p2p_rc_sˇn_com∂ëe_evít
(
©h6kl_vif
 *
vif
, 
boﬁ
 
ab‹ãd
);

340 
©h6kl_p2p_rc_gë
(
©h6kl
 *
¨
, 
©h6kl_rc_ªp‹t
 *
rc_ªp‹t
);

341 
©h6kl_p2p_rc_dump
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
);

342 
©h6kl_p2p_rc_c⁄fig
(
©h6kl
 *
¨
, 
u16
 
‰eq
, 
ty≥
);

344 
boﬁ
 
©h6kl_p2p_‰ame_ªåy
(
©h6kl
 *
¨
, 
u8
 *
‰m
, 
Àn
);

345 
boﬁ
 
©h6kl_p2p_is_p2p_‰ame
(
©h6kl
 *
¨
, c⁄° 
u8
 *
‰m
, 
size_t
 
Àn
);

346 
©h6kl_p2p_c⁄√˘_evít
(
©h6kl_vif
 *
vif
,

347 
u8
 
bóc⁄_õ_Àn
,

348 
u8
 
assoc_ªq_Àn
,

349 
u8
 
assoc_ª•_Àn
,

350 
u8
 *
assoc_öfo
);

351 
©h6kl_p2p_ªc⁄fig_ps
(
©h6kl
 *
¨
,

352 
boﬁ
 
mcc
,

353 
boﬁ
 
ˇŒ_⁄_disc⁄√˘
);

354 
boﬁ
 
©h6kl_p2p_≥ndög_c⁄√˘_evít
(
©h6kl_vif
 *
vif
,

355 c⁄° 
u8
 *
bssid
,

356 c⁄° 
u8
 *
ªq_õ
,

357 
size_t
 
ªq_õ_Àn
,

358 c⁄° 
u8
 *
ª•_õ
,

359 
size_t
 
ª•_õ_Àn
,

360 
u16
 
°©us
,

361 
gÂ_t
 
gÂ
);

362 
©h6kl_p2p_≥ndög_disc⁄√˘_evít
(
©h6kl_vif
 *
vif
,

363 
u16
 
ªas⁄
,

364 
u8
 *
õ
,

365 
size_t
 
õ_Àn
,

366 
gÂ_t
 
gÂ
);

367 
boﬁ
 
©h6kl_p2p_õ_≠≥nd
(
©h6kl_vif
 *
vif
, 
u8
 
mgmt_‰ame_ty≥
);

368 
boﬁ
 
©h6kl_p2p_is_p2p_ch™√l
(
u32
 
‰eq
);

369 
boﬁ
 
©h6kl_p2p_is_socül_ch™√l
(
u32
 
‰eq
);

	@pm.c

17 
	~"c‹e.h
"

18 
	~"hif-›s.h
"

20 #ifde‡
CONFIG_HAS_EARLYSUSPEND


21 
	$©h6kl_óæy_su•íd
(
óæy_su•íd
 *
h™dÀr
)

23 
©h6kl
 *
¨
 = 
	`c⁄èöî_of
(
h™dÀr
, ©h6kl, 
óæy_su•íd
);

25 i‡(
¨
)

26 
	`©h6kl_hif_óæy_su•íd
(
¨
);

27 
	}
}

29 
	$©h6kl_œã_ªsume
(
óæy_su•íd
 *
h™dÀr
)

31 
©h6kl
 *
¨
 = 
	`c⁄èöî_of
(
h™dÀr
, ©h6kl, 
óæy_su•íd
);

33 i‡(
¨
)

34 
	`©h6kl_hif_œã_ªsume
(
¨
);

35 
	}
}

38 #ifde‡
CONFIG_ANDROID


39 
	$©h6kl_£tup_™droid_ªsour˚
(
©h6kl
 *
¨
)

41 #ifde‡
CONFIG_HAS_EARLYSUSPEND


42 
¨
->
óæy_su•íd
.
su•íd
 = 
©h6kl_óæy_su•íd
;

43 
¨
->
óæy_su•íd
.
ªsume
 = 
©h6kl_œã_ªsume
;

44 
¨
->
óæy_su•íd
.
Àvñ
 = 
EARLY_SUSPEND_LEVEL_BLANK_SCREEN
;

45 
	`ªgi°î_óæy_su•íd
(&
¨
->
óæy_su•íd
);

47 
	}
}

49 
	$©h6kl_˛ónup_™droid_ªsour˚
(
©h6kl
 *
¨
)

51 #ifde‡
CONFIG_HAS_EARLYSUSPEND


52 
	`uƒegi°î_óæy_su•íd
(&
¨
->
óæy_su•íd
);

54 
	}
}

	@pm.h

16 #ifde‡
CONFIG_ANDROID


17 
©h6kl_£tup_™droid_ªsour˚
(
©h6kl
 *
¨
);

18 
©h6kl_˛ónup_™droid_ªsour˚
(
©h6kl
 *
¨
);

	@reg.c

17 
	~"c‹e.h
"

18 
	~"debug.h
"

21 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_NA
 = {

22 .
n_ªg_ruÀs
 = 1,

23 .
	gÆpha2
 = "NA",

24 .
	gªg_ruÀs
 = {

25 
REG_RULE
(2412 - 10, 2462 + 10, 20, 3, 20, 0),

32 c⁄° 
ªg_code_to_is⁄ame
 
	g©h6kl_cou¡ry_code_to_iso_«me
[] = {

34 {
COUNTRY_ALBANIA
, "AL", 
NULL
},

35 {
COUNTRY_ALGERIA
, "DZ", 
NULL
},

36 {
COUNTRY_ARGENTINA
, "AR", 
NULL
},

37 {
COUNTRY_ARMENIA
, "AM", 
NULL
},

38 {
COUNTRY_ARUBA
, "AW", 
NULL
},

39 {
COUNTRY_AUSTRALIA
, "AU", 
NULL
},

40 {
COUNTRY_AUSTRALIA_AP
, "A2", 
NULL
},

41 {
COUNTRY_AUSTRIA
, "AT", 
NULL
},

42 {
COUNTRY_AZERBAIJAN
, "AZ", 
NULL
},

43 {
COUNTRY_BAHRAIN
, "BH", 
NULL
},

44 {
COUNTRY_BANGLADESH
, "BD", 
NULL
},

45 {
COUNTRY_BARBADOS
, "BB", 
NULL
},

46 {
COUNTRY_BELARUS
, "BY", 
NULL
},

47 {
COUNTRY_BELGIUM
, "BE", 
NULL
},

48 {
COUNTRY_BELIZE
, "BZ", 
NULL
},

49 {
COUNTRY_BOLIVIA
, "BO", 
NULL
},

50 {
COUNTRY_BOSNIA_HERZEGOWANIA
, "BA", 
NULL
},

51 {
COUNTRY_BRAZIL
, "BR", 
NULL
},

52 {
COUNTRY_BRUNEI_DARUSSALAM
, "BN", 
NULL
},

53 {
COUNTRY_BULGARIA
, "BG", 
NULL
},

54 {
COUNTRY_CAMBODIA
, "KH", 
NULL
},

55 {
COUNTRY_CANADA
, "CA", 
NULL
},

56 {
COUNTRY_CANADA_AP
, "C2", 
NULL
},

57 {
COUNTRY_CHILE
, "CL", 
NULL
},

58 {
COUNTRY_CHINA
, "CN", 
NULL
},

59 {
COUNTRY_COLOMBIA
, "CO", 
NULL
},

60 {
COUNTRY_COSTA_RICA
, "CR", 
NULL
},

61 {
COUNTRY_CROATIA
, "HR", 
NULL
},

62 {
COUNTRY_CYPRUS
, "CY", 
NULL
},

63 {
COUNTRY_CZECH
, "CZ", 
NULL
},

64 {
COUNTRY_DENMARK
, "DK", 
NULL
},

65 {
COUNTRY_DOMINICAN_REPUBLIC
, "DO", 
NULL
},

66 {
COUNTRY_ECUADOR
, "EC", 
NULL
},

67 {
COUNTRY_EGYPT
, "EG", 
NULL
},

68 {
COUNTRY_EL_SALVADOR
, "SV", 
NULL
},

69 {
COUNTRY_ESTONIA
, "EE", 
NULL
},

70 {
COUNTRY_FAEROE_ISLANDS
, "FO", 
NULL
},

71 {
COUNTRY_FINLAND
, "FI", 
NULL
},

72 {
COUNTRY_FRANCE
, "FR", 
NULL
},

73 {
COUNTRY_FRANCE2
, "F2", 
NULL
},

74 {
COUNTRY_GEORGIA
, "GE", 
NULL
},

75 {
COUNTRY_GERMANY
, "DE", 
NULL
},

76 {
COUNTRY_GREECE
, "GR", 
NULL
},

77 {
COUNTRY_GREENLAND
, "GL", 
NULL
},

78 {
COUNTRY_GRENADA
, "GD", 
NULL
},

79 {
COUNTRY_GUAM
, "GU", 
NULL
},

80 {
COUNTRY_GUATEMALA
, "GT", 
NULL
},

81 {
COUNTRY_HAITI
, "HT", 
NULL
},

82 {
COUNTRY_HONDURAS
, "HN", 
NULL
},

83 {
COUNTRY_HONG_KONG
, "KH", 
NULL
},

84 {
COUNTRY_HUNGARY
, "HU", 
NULL
},

85 {
COUNTRY_ICELAND
, "IS", 
NULL
},

86 {
COUNTRY_INDIA
, "IN", 
NULL
},

87 {
COUNTRY_INDONESIA
, "ID", 
NULL
},

88 {
COUNTRY_IRAN
, "IR", 
NULL
},

89 {
COUNTRY_IRAQ
, "IQ", 
NULL
},

90 {
COUNTRY_IRELAND
, "IE", 
NULL
},

91 {
COUNTRY_ISRAEL
, "IL", 
NULL
},

92 {
COUNTRY_ITALY
, "IT", 
NULL
},

93 {
COUNTRY_JAMAICA
, "JM", 
NULL
},

94 {
COUNTRY_JAPAN
, "JP", 
NULL
},

95 {
COUNTRY_JAPAN1
, "J2", 
NULL
},

96 {
COUNTRY_JAPAN2
, "J3", 
NULL
},

97 {
COUNTRY_JAPAN3
, "J4", 
NULL
},

98 {
COUNTRY_JAPAN4
, "J5", 
NULL
},

99 {
COUNTRY_JAPAN5
, "J6", 
NULL
},

100 {
COUNTRY_JAPAN6
, "J7", 
NULL
},

101 {
COUNTRY_JORDAN
, "JO", 
NULL
},

102 {
COUNTRY_KAZAKHSTAN
, "KZ", 
NULL
},

103 {
COUNTRY_KENYA
, "KE", 
NULL
},

104 {
COUNTRY_KOREA_NORTH
, "KP", 
NULL
},

105 {
COUNTRY_KOREA_ROC
, "KR", 
NULL
},

106 {
COUNTRY_KOREA_ROC2
, "K2", 
NULL
},

107 {
COUNTRY_KOREA_ROC3
, "K3", 
NULL
},

108 {
COUNTRY_KUWAIT
, "KW", 
NULL
},

109 {
COUNTRY_LATVIA
, "LV", 
NULL
},

110 {
COUNTRY_LEBANON
, "LE", 
NULL
},

111 {
COUNTRY_LIBYA
, "LY", 
NULL
},

112 {
COUNTRY_LIECHTENSTEIN
, "LI", 
NULL
},

113 {
COUNTRY_LITHUANIA
, "LT", 
NULL
},

114 {
COUNTRY_LUXEMBOURG
, "LU", 
NULL
},

115 {
COUNTRY_MACAU
, "MO", 
NULL
},

116 {
COUNTRY_MACEDONIA
, "MK", 
NULL
},

117 {
COUNTRY_MALAYSIA
, "MY", 
NULL
},

118 {
COUNTRY_MALTA
, "MT", 
NULL
},

119 {
COUNTRY_MEXICO
, "MX", 
NULL
},

120 {
COUNTRY_MONACO
, "MC", 
NULL
},

121 {
COUNTRY_MOROCCO
, "MA", 
NULL
},

122 {
COUNTRY_NEPAL
, "NP", 
NULL
},

123 {
COUNTRY_NETHERLANDS
, "NL", 
NULL
},

124 {
COUNTRY_NETHERLAND_ANTILLES
, "AN", 
NULL
},

125 {
COUNTRY_NEW_ZEALAND
, "NZ", 
NULL
},

126 {
COUNTRY_NICARAGUA
, "NI", 
NULL
},

127 {
COUNTRY_NORWAY
, "NO", 
NULL
},

128 {
COUNTRY_OMAN
, "OM", 
NULL
},

129 {
COUNTRY_PAKISTAN
, "PK", 
NULL
},

130 {
COUNTRY_PANAMA
, "PA", 
NULL
},

131 {
COUNTRY_PARAGUAY
, "PY", 
NULL
},

132 {
COUNTRY_PERU
, "PE", 
NULL
},

133 {
COUNTRY_PHILIPPINES
, "PH", 
NULL
},

134 {
COUNTRY_POLAND
, "PL", 
NULL
},

135 {
COUNTRY_PORTUGAL
, "PT", 
NULL
},

136 {
COUNTRY_PUERTO_RICO
, "PR", 
NULL
},

137 {
COUNTRY_QATAR
, "QA", 
NULL
},

138 {
COUNTRY_ROMANIA
, "RO", 
NULL
},

139 {
COUNTRY_RUSSIA
, "RU", 
NULL
},

140 {
COUNTRY_RWANDA
, "RW", 
NULL
},

141 {
COUNTRY_SAUDI_ARABIA
, "SA", 
NULL
},

142 {
COUNTRY_SERBIA
, "RS", 
NULL
},

143 {
COUNTRY_MONTENEGRO
, "ME", 
NULL
},

144 {
COUNTRY_SINGAPORE
, "SG", 
NULL
},

145 {
COUNTRY_SLOVAKIA
, "SK", 
NULL
},

146 {
COUNTRY_SLOVENIA
, "SI", 
NULL
},

147 {
COUNTRY_SOUTH_AFRICA
, "ZA", 
NULL
},

148 {
COUNTRY_SPAIN
, "ES", 
NULL
},

149 {
COUNTRY_SRILANKA
, "LK", 
NULL
},

150 {
COUNTRY_SWEDEN
, "SE", 
NULL
},

151 {
COUNTRY_SWITZERLAND
, "CH", 
NULL
},

152 {
COUNTRY_SYRIA
, "SY", 
NULL
},

153 {
COUNTRY_TAIWAN
, "TW", 
NULL
},

154 {
COUNTRY_THAILAND
, "TH", 
NULL
},

155 {
COUNTRY_TRINIDAD_Y_TOBAGO
, "TT", 
NULL
},

156 {
COUNTRY_TUNISIA
, "TN", 
NULL
},

157 {
COUNTRY_TURKEY
, "TR", 
NULL
},

158 {
COUNTRY_UAE
, "AE", 
NULL
},

159 {
COUNTRY_UGANDA
, "UG", 
NULL
},

160 {
COUNTRY_UKRAINE
, "UA", 
NULL
},

161 {
COUNTRY_UNITED_KINGDOM
, "GB", 
NULL
},

162 {
COUNTRY_UNITED_STATES
, "US", 
NULL
},

163 {
COUNTRY_UNITED_STATES_AP
, "U2", 
NULL
},

164 {
COUNTRY_UNITED_STATES_PS
, "PS", 
NULL
},

165 {
COUNTRY_URUGUAY
, "UY", 
NULL
},

166 {
COUNTRY_UZBEKISTAN
, "UZ", 
NULL
},

167 {
COUNTRY_VENEZUELA
, "VE", 
NULL
},

168 {
COUNTRY_VIET_NAM
, "VN", 
NULL
},

169 {
COUNTRY_YEMEN
, "YE", 
NULL
},

170 {
COUNTRY_ZIMBABWE
, "ZW", 
NULL
},

172 {
NULL_REG_CODE
, 
NULL
},

175 c⁄° 
ªg_code_to_is⁄ame
 
	g©h6kl_ªgi⁄_code_to_«me
[] = {

177 {
REGION_NO_ENUMRD
, "00", 
NULL
},

178 {
REGION_NULL1_WORLD
, "03", "AL"},

179 {
REGION_NULL1_ETSIB
, "07", 
NULL
},

180 {
REGION_NULL1_ETSIC
, "08", 
NULL
},

181 {
REGION_FCC1_FCCA
, "10", "CO"},

182 {
REGION_FCC1_WORLD
, "11", "CR"},

183 {
REGION_FCC2_FCCA
, "20", 
NULL
},

184 {
REGION_FCC2_WORLD
, "21", "BB"},

185 {
REGION_FCC2_ETSIC
, "22", 
NULL
},

186 {
REGION_FCC3_FCCA
, "3a", "CA"},

187 {
REGION_FCC3_WORLD
, "3b", "AR"},

188 {
REGION_FCC3_ETSIC
, "3f", "NZ"},

189 {
REGION_FCC4_FCCA
, "12", "PS"},

190 {
REGION_FCC5_FCCA
, "13", 
NULL
},

191 {
REGION_FCC5_WORLD
, "16", 
NULL
},

192 {
REGION_FCC6_FCCA
, "14", "CA"},

193 {
REGION_FCC6_WORLD
, "23", "AU"},

194 {
REGION_ETSI1_WORLD
, "37", "AW"},

195 {
REGION_ETSI2_WORLD
, "35", "JO"},

196 {
REGION_ETSI3_WORLD
, "36", "CY"},

197 {
REGION_ETSI4_WORLD
, "30", "AM"},

198 {
REGION_ETSI4_ETSIC
, "38", 
NULL
},

199 {
REGION_ETSI5_WORLD
, "39", 
NULL
},

200 {
REGION_ETSI6_WORLD
, "34", 
NULL
},

201 {
REGION_ETSI8_WORLD
, "3d", "RU"},

202 {
REGION_ETSI9_WORLD
, "3e", "UA"},

203 {
REGION_ETSI_RESERVED
, "33", 
NULL
},

204 {
REGION_FRANCE_RES
, "31", 
NULL
},

205 {
REGION_APL6_WORLD
, "5b", "BH"},

206 {
REGION_APL4_WORLD
, "42", "MA"},

207 {
REGION_APL3_FCCA
, "50", 
NULL
},

208 {
REGION_APL_RESERVED
, "44", 
NULL
},

209 {
REGION_APL2_WORLD
, "45", "ID"},

210 {
REGION_APL2_APLC
, "46", 
NULL
},

211 {
REGION_APL3_WORLD
, "47", 
NULL
},

212 {
REGION_APL2_APLD
, "49", "KR"},

213 {
REGION_APL2_FCCA
, "4d", 
NULL
},

214 {
REGION_APL1_WORLD
, "52", "CN"},

215 {
REGION_APL1_FCCA
, "53", 
NULL
},

216 {
REGION_APL1_ETSIC
, "55", "BZ"},

217 {
REGION_APL2_ETSIC
, "56", 
NULL
},

218 {
REGION_APL5_WORLD
, "58", 
NULL
},

219 {
REGION_APL7_FCCA
, "5c", "TW"},

220 {
REGION_APL8_WORLD
, "5d", 
NULL
},

221 {
REGION_APL9_WORLD
, "5e", "KP"},

222 {
REGION_APL10_WORLD
, "5f", "KR"},

223 {
REGION_MKK5_MKKA
, "99", 
NULL
},

224 {
REGION_MKK5_FCCA
, "9a", 
NULL
},

225 {
REGION_MKK5_MKKC
, "88", "JP"},

226 {
REGION_MKK11_MKKA
, "d4", 
NULL
},

227 {
REGION_MKK11_FCCA
, "d5", 
NULL
},

228 {
REGION_MKK11_MKKC
, "d7", 
NULL
},

229 {
REGION_WOR0_WORLD
, "60", "00"},

230 {
REGION_WOR1_WORLD
, "61", "00"},

231 {
REGION_WOR2_WORLD
, "62", "00"},

232 {
REGION_WOR3_WORLD
, "63", "00"},

233 {
REGION_WOR4_WORLD
, "64", "00"},

234 {
REGION_WOR5_ETSIC
, "65", "00"},

235 {
REGION_WOR01_WORLD
, "66", "00"},

236 {
REGION_WOR02_WORLD
, "67", "00"},

237 {
REGION_EU1_WORLD
, "68", "00"},

238 {
REGION_WOR9_WORLD
, "69", "00"},

239 {
REGION_WORA_WORLD
, "6a", "00"},

240 {
REGION_WORB_WORLD
, "6b", "00"},

241 {
REGION_WORC_WORLD
, "6c", "00"},

244 {
NULL_REG_CODE
, 
NULL
},

247 
ölöe
 
boﬁ
 
	$__is_ht40_nŸ_Ælowed
(
õì80211_ch™√l
 *
ch™
)

249 i‡(!
ch™
)

250  
åue
;

253 i‡((
ch™
->
˚¡î_‰eq
 == 2467) ||

254 (
ch™
->
˚¡î_‰eq
 == 2472) ||

255 (
ch™
->
˚¡î_‰eq
 == 2484))

256  
åue
;

258 i‡(
ch™
->
Êags
 & 
IEEE80211_CHAN_DISABLED
)

259  
åue
;

261 i‡(
IEEE80211_CHAN_NO_HT40
 =(
ch™
->
Êags
 & (IEEE80211_CHAN_NO_HT40)))

262  
åue
;

264  
Ál£
;

265 
	}
}

267 
	$_ªg_¥o˚ss_ch™
(
õì80211_suµ‹ãd_b™d
 *
sb™d
,

268 
ch™_idx
)

270 
õì80211_ch™√l
 *
ch™√l
;

271 
õì80211_ch™√l
 *
ch™√l_bef‹e
 = 
NULL
, *
ch™√l_a·î
 = NULL;

272 
i
;

273 
u16
 
°¨t_‰eq
 = 0;

275 
ch™√l
 = &
sb™d
->
ch™√ls
[
ch™_idx
];

277 i‡(
	`__is_ht40_nŸ_Ælowed
(
ch™√l
)) {

278 
ch™√l
->
Êags
 |
IEEE80211_CHAN_NO_HT40
;

282 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

283 
õì80211_ch™√l
 *
c
 = &
sb™d
->
ch™√ls
[
i
];

285 i‡(
c
->
˚¡î_‰eq
 =(
ch™√l
->center_freq - 20))

286 
ch™√l_bef‹e
 = 
c
;

287 i‡(
c
->
˚¡î_‰eq
 =(
ch™√l
->center_freq + 20))

288 
ch™√l_a·î
 = 
c
;

292 i‡(
ch™√l
->
˚¡î_‰eq
 < 4000) {

293 i‡(!(
ch™√l
->
Êags
 & 
IEEE80211_CHAN_NO_HT40MINUS
)) {

294 i‡(
	`__is_ht40_nŸ_Ælowed
(
ch™√l_bef‹e
))

295 
ch™√l
->
Êags
 |
IEEE80211_CHAN_NO_HT40MINUS
;

297 
ch™√l
->
Êags
 &~
IEEE80211_CHAN_NO_HT40MINUS
;

300 i‡(!(
ch™√l
->
Êags
 & 
IEEE80211_CHAN_NO_HT40PLUS
)) {

301 i‡(
	`__is_ht40_nŸ_Ælowed
(
ch™√l_a·î
))

302 
ch™√l
->
Êags
 |
IEEE80211_CHAN_NO_HT40PLUS
;

304 
ch™√l
->
Êags
 &~
IEEE80211_CHAN_NO_HT40PLUS
;

311 i‡(
ch™√l
->
˚¡î_‰eq
 >= 5745)

312 
°¨t_‰eq
 = 5745;

314 
°¨t_‰eq
 = 5180;

316 i‡(((
ch™√l
->
˚¡î_‰eq
 - 
°¨t_‰eq
) % 40) == 0) {

318 
ch™√l
->
Êags
 |
IEEE80211_CHAN_NO_HT40MINUS
;

320 i‡(!(
ch™√l
->
Êags
 & 
IEEE80211_CHAN_NO_HT40PLUS
)) {

321 i‡(
	`__is_ht40_nŸ_Ælowed
(
ch™√l_a·î
))

322 
ch™√l
->
Êags
 |=

323 
IEEE80211_CHAN_NO_HT40PLUS
;

325 
ch™√l
->
Êags
 &=

326 ~
IEEE80211_CHAN_NO_HT40PLUS
;

330 
ch™√l
->
Êags
 |
IEEE80211_CHAN_NO_HT40PLUS
;

332 i‡(!(
ch™√l
->
Êags
 & 
IEEE80211_CHAN_NO_HT40MINUS
)) {

333 i‡(
	`__is_ht40_nŸ_Ælowed
(
ch™√l_bef‹e
))

334 
ch™√l
->
Êags
 |=

335 
IEEE80211_CHAN_NO_HT40MINUS
;

337 
ch™√l
->
Êags
 &=

338 ~
IEEE80211_CHAN_NO_HT40MINUS
;

344 
	}
}

346 
	$©h6kl_ªg_ch™_Êags_upd©e
(
ªg_öfo
 *
ªg
)

348 
wùhy
 *wùhy = 
ªg
->wiphy;

349 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

350 
õì80211_b™d
 
b™d
;

351 
i
;

353 
b™d
 = 0; b™d < 
IEEE80211_NUM_BANDS
; band++) {

354 i‡(
wùhy
->
b™ds
[
b™d
]) {

355 
sb™d
 = 
wùhy
->
b™ds
[
b™d
];

356 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++)

357 
	`_ªg_¥o˚ss_ch™
(
sb™d
, 
i
);

362 
	}
}

364 c⁄° *
	$_ªg_föd_iso_«me
(
u16
 
ªg_code
,

365 
boﬁ
 
isCou¡ry
,

366 
boﬁ
 
ªg2Cåy
)

368 c⁄° 
ªg_code_to_is⁄ame
 *
«me
;

370 i‡(
isCou¡ry
)

371 
ªg2Cåy
 = 
Ál£
;

373 i‡(
isCou¡ry
)

374 
«me
 = &
©h6kl_cou¡ry_code_to_iso_«me
[0];

376 
«me
 = &
©h6kl_ªgi⁄_code_to_«me
[0];

377 
«me
) {

378 i‡((
«me
->
ªg_code
 ==Ñeg_code) &&

379 (
«me
->
iso_«me
)) {

380 i‡(
ªg2Cåy
)

381  
«me
->
ªg_to_˘ry_iso_«me
;

383  
«me
->
iso_«me
;

386 
«me
++;

389 
	`©h6kl_îr
("ªg io¢amê£¨ch faû! codêi†0x%x\n", 
ªg_code
);

391  
NULL
;

392 
	}
}

394 
õì80211_ªgdomaö
 *
	$_ªg_föd_ªgd
(
u16
 
code
,

395 
boﬁ
 
isCou¡ry
)

397 
õì80211_ªgdomaö
 *
ªgd
;

398 
õì80211_ªgdomaö
 **
ªg_ªgdb
;

399 c⁄° *
Æpha2
 = 
	`_ªg_föd_iso_«me
(
code
, 
isCou¡ry
, 
Ál£
);

401 i‡(
Æpha2
 =
NULL
)

402  
NULL
;

404 i‡(
isCou¡ry
)

405 
ªg_ªgdb
 = (
õì80211_ªgdomaö
 **)

406 
©h6kl_ªg_ªgdb_cou¡ry
;

408 
ªg_ªgdb
 = (
õì80211_ªgdomaö
 **)

409 
©h6kl_ªg_ªgdb_ªgi⁄
;

411 *
ªg_ªgdb
) {

412 
ªgd
 = *
ªg_ªgdb
;

413 i‡((
ªgd
->
Æpha2
[0] ==álpha2[0]) &&

414 (
ªgd
->
Æpha2
[1] ==álpha2[1]))

415  
ªgd
;

417 
ªg_ªgdb
++;

420 
	`©h6kl_îr
("ªgÑegd sórch faû! codêi†0x%x\n", 
code
);

422  
NULL
;

423 
	}
}

425 
õì80211_ªgdomaö
 *
	$©h6kl_ªg_gë_ªgd
(
ªg_öfo
 *
ªg
,

426 
u32
 
ªg_code
)

428 
õì80211_ªgdomaö
 *
ªgd
 = 
NULL
;

429 
u16
 
code
, 
code_ty≥
;

436 
code
 = (
u16
)(
ªg_code
 & 
ATH6KL_REG_CODE_MASK
);

437 
code_ty≥
 = (
u16
)(
ªg_code
 >> 
ATH6KL_COUNTRY_RD_SHIFT
);

438 i‡(
code_ty≥
 & 
ATH6KL_COUNTRY_ERD_FLAG
)

439 
ªgd
 = 
	`_ªg_föd_ªgd
(
code
, 
åue
);

441 
ªgd
 = 
	`_ªg_föd_ªgd
(
code
, 
Ál£
);

443 i‡(
ªgd
 =
NULL
) {

444 
ªgd
 = &
©h6kl_ªgd_NA
;

446 
	`©h6kl_îr
("reg getÑegd fail, using default NA.\n");

449 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

451 
ªg_code
,

452 (
code_ty≥
 & 
ATH6KL_COUNTRY_ERD_FLAG
) ?

454 (
code_ty≥
 & 
ATH6KL_WORLDWIDE_ROAMING_FLAG
) ?

456 
ªgd
->
Æpha2
[0],Ñegd->alpha2[1],

457 
ªgd
->
n_ªg_ruÀs
);

459  
ªgd
;

460 
	}
}

462 
	$__ªg_‰eq_ªg_öfo_ªgd
(
u32
 
˚¡î_‰eq
,

463 
u32
 
desúed_bw_khz
,

464 c⁄° 
õì80211_ªg_ruÀ
 **
ªg_ruÀ
,

465 c⁄° 
õì80211_ªgdomaö
 *
cu°om_ªgd
,

466 
boﬁ
 *
is_‰eq_°¨t
,

467 
boﬁ
 *
is_‰eq_íd
)

469 
	#ONE_GHZ_IN_KHZ
 1000000

	)

470 
i
;

471 
boﬁ
 
b™d_ruÀ_found
 = 
Ál£
;

472 
boﬁ
 
bw_fôs
 = 
Ál£
;

473 
u32
 
°¨t_‰eq_khz
, 
íd_‰eq_khz
;

475 i‡(!
desúed_bw_khz
)

476 
desúed_bw_khz
 = 
	`MHZ_TO_KHZ
(20);

478 i‡(!
cu°om_ªgd
)

479  -
EINVAL
;

481 
i
 = 0; i < 
cu°om_ªgd
->
n_ªg_ruÀs
; i++) {

482 c⁄° 
õì80211_ªg_ruÀ
 *
º
;

483 c⁄° 
õì80211_‰eq_ønge
 *
‰
 = 
NULL
;

485 
º
 = &
cu°om_ªgd
->
ªg_ruÀs
[
i
];

486 
‰
 = &
º
->
‰eq_ønge
;

488 i‡(!
b™d_ruÀ_found
) {

489 i‡(
	`abs
(
˚¡î_‰eq
 - 
‰
->
°¨t_‰eq_khz
) <=

490 (2 * 
ONE_GHZ_IN_KHZ
))

491 
b™d_ruÀ_found
 = 
åue
;

492 i‡(
	`abs
(
˚¡î_‰eq
 - 
‰
->
íd_‰eq_khz
) <=

493 (2 * 
ONE_GHZ_IN_KHZ
))

494 
b™d_ruÀ_found
 = 
åue
;

497 
°¨t_‰eq_khz
 = 
˚¡î_‰eq
 - (
desúed_bw_khz
/2);

498 
íd_‰eq_khz
 = 
˚¡î_‰eq
 + (
desúed_bw_khz
/2);

500 i‡(
b™d_ruÀ_found
 &&

501 
‰
->
°¨t_‰eq_khz
 > 
	`MHZ_TO_KHZ
(4000) &&

502 
°¨t_‰eq_khz
 >
‰
->start_freq_khz &&

503 
íd_‰eq_khz
 <
‰
->end_freq_khz &&

504 ((
˚¡î_‰eq
 - 
‰
->
°¨t_‰eq_khz
Ë% 
	`MHZ_TO_KHZ
(20)) == 0)

505  -
ERANGE
;

507 i‡(
°¨t_‰eq_khz
 >
‰
->start_freq_khz &&

508 
íd_‰eq_khz
 <
‰
->end_freq_khz)

509 
bw_fôs
 = 
åue
;

511 
bw_fôs
 = 
Ál£
;

513 i‡(
b™d_ruÀ_found
 && 
bw_fôs
) {

514 i‡(
˚¡î_‰eq
 > 
	`MHZ_TO_KHZ
(4000)) {

515 i‡(
°¨t_‰eq_khz
 =
‰
->start_freq_khz)

516 *
is_‰eq_°¨t
 = 
åue
;

517 i‡(
íd_‰eq_khz
 =
‰
->end_freq_khz)

518 *
is_‰eq_íd
 = 
åue
;

520 *
ªg_ruÀ
 = 
º
;

525 i‡(!
b™d_ruÀ_found
)

526  -
ERANGE
;

528  -
EINVAL
;

529 #unde‡
ONE_GHZ_IN_KHZ


530 
	}
}

532 
	$_ªg_h™dÀ_ch™√l
(
õì80211_ch™√l
 *
ch™
,

533 c⁄° 
õì80211_ªgdomaö
 *
ªgd
)

535 
r
;

536 
u32
 
desúed_bw_khz
 = 
	`MHZ_TO_KHZ
(20);

537 
u32
 
bw_Êags
 = 0;

538 
u32
 
ch™√l_Êags
 = 0;

539 c⁄° 
õì80211_ªg_ruÀ
 *
ªg_ruÀ
 = 
NULL
;

540 c⁄° 
õì80211_powî_ruÀ
 *
powî_ruÀ
 = 
NULL
;

541 c⁄° 
õì80211_‰eq_ønge
 *
‰eq_ønge
 = 
NULL
;

542 
boﬁ
 
is_‰eq_°¨t
 = 
Ál£
, 
is_‰eq_íd
 = false;

544 
r
 = 
	`__ªg_‰eq_ªg_öfo_ªgd
(
	`MHZ_TO_KHZ
(
ch™
->
˚¡î_‰eq
),

545 
desúed_bw_khz
,

546 &
ªg_ruÀ
,

547 
ªgd
,

548 &
is_‰eq_°¨t
,

549 &
is_‰eq_íd
);

551 i‡(
r
) {

552 
ch™
->
Êags
 =

553 
ch™
->
‹ig_Êags
 = 
IEEE80211_CHAN_DISABLED
;

557 
powî_ruÀ
 = &
ªg_ruÀ
->power_rule;

558 
‰eq_ønge
 = &
ªg_ruÀ
->freq_range;

560 i‡(
‰eq_ønge
->
max_b™dwidth_khz
 < 
	`MHZ_TO_KHZ
(40))

561 
bw_Êags
 = 
IEEE80211_CHAN_NO_HT40
;

567 i‡(
is_‰eq_°¨t
)

568 
bw_Êags
 |
IEEE80211_CHAN_NO_HT40MINUS
;

570 i‡(
is_‰eq_íd
)

571 
bw_Êags
 |
IEEE80211_CHAN_NO_HT40PLUS
;

574 i‡(
ªg_ruÀ
->
Êags
 & 
NL80211_RRF_PASSIVE_SCAN
)

575 
ch™√l_Êags
 |
IEEE80211_CHAN_PASSIVE_SCAN
;

576 i‡(
ªg_ruÀ
->
Êags
 & 
NL80211_RRF_NO_IBSS
)

577 
ch™√l_Êags
 |
IEEE80211_CHAN_NO_IBSS
;

578 i‡(
ªg_ruÀ
->
Êags
 & 
NL80211_RRF_DFS
)

579 
ch™√l_Êags
 |
IEEE80211_CHAN_RADAR
;

581 
ch™
->
Êags
 = (
ch™√l_Êags
 | 
bw_Êags
);

582 
ch™
->
‹ig_Êags
 = ch™->
Êags
;

583 
ch™
->
max_™ã¬a_gaö
 = (Ë
	`MBI_TO_DBI
(
powî_ruÀ
->max_antenna_gain);

584 
ch™
->
max_powî
 = (Ë
	`MBM_TO_DBM
(
powî_ruÀ
->
max_eúp
);

587 
	}
}

589 
	$©h6kl_ªg_≠∂y_ªguœt‹y
(
ªg_öfo
 *
ªg
,

590 c⁄° 
õì80211_ªgdomaö
 *
ªgd
)

592 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

593 
õì80211_ch™√l
 *
ch™
;

594 
õì80211_b™d
 
b™d
;

595 
i
;

597 
b™d
 = 0; b™d < 
IEEE80211_NUM_BANDS
; band++) {

598 i‡(!
ªg
->
wùhy
->
b™ds
[
b™d
])

601 
sb™d
 = 
ªg
->
wùhy
->
b™ds
[
b™d
];

602 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

603 
ch™
 = &
sb™d
->
ch™√ls
[
i
];

604 
	`_ªg_h™dÀ_ch™√l
(
ch™
, 
ªgd
);

610 i‡((
ªg
->
Êags
 & 
ATH6KL_REG_FALGS_P2P_IN_PASV_CHAN
) &&

611 (!(
ch™
->
Êags
 & 
IEEE80211_CHAN_RADAR
)) &&

612 
	`©h6kl_p2p_is_p2p_ch™√l
(
ch™
->
˚¡î_‰eq
)) {

613 
ch™
->
Êags
 &~
IEEE80211_CHAN_PASSIVE_SCAN
;

614 
ch™
->
Êags
 &~
IEEE80211_CHAN_NO_IBSS
;

618 
	}
}

620 
	$_ªg_upd©e_ªp‹t
(
wùhy
 *wùhy, c⁄° *
Æpha2
)

622 
ªm≠_Æpha2
[2];

623 
u32
 
Êù
;

625 #ifde‡
CONFIG_ATH6KL_REGDB_AS_CFG80211_REGDB


630 
ªm≠_Æpha2
[0] = 
Æpha2
[0];

631 
ªm≠_Æpha2
[1] = 
Æpha2
[1];

637 i‡(
Êù
++ & 0x1) {

638 
ªm≠_Æpha2
[0] = 'U';

639 
ªm≠_Æpha2
[1] = 'S';

641 
ªm≠_Æpha2
[0] = '0';

642 
ªm≠_Æpha2
[1] = '0';

647 
	`ªguœt‹y_höt
(
wùhy
, 
ªm≠_Æpha2
);

650 
	}
}

652 
õì80211_ªgdomaö
 *
	$©h6kl_ªg_upd©e
(
ªg_öfo
 *
ªg
,

653 
u32
 
ªg_code
,

654 
boﬁ
 
èrgë_upd©e
)

656 
õì80211_ªgdomaö
 *
ªgd
;

658 
	`BUG_ON
(!
ªg
);

660 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

662 
ªg_code
,

663 
èrgë_upd©e
 ? "" : "not ");

667 
ªgd
 = 
	`©h6kl_ªg_gë_ªgd
(
ªg
, 
ªg_code
);

670 
	`©h6kl_ªg_≠∂y_ªguœt‹y
(
ªg
, 
ªgd
);

673 
	`©h6kl_ªg_ch™_Êags_upd©e
(
ªg
);

675 i‡(
èrgë_upd©e
 && 
ªgd
)

676 
	`_ªg_upd©e_ªp‹t
(
ªg
->
wùhy
, 
ªgd
->
Æpha2
);

679 
	`©h6kl_p2p_rc_„tch_ch™
(
ªg
->
¨
);

681  
ªgd
;

682 
	}
}

684 
	$©h6kl_ªg_cfg80211_upd©e
(
ªg_öfo
 *
ªg
,

685 
u32
 
ªg_code
,

686 
boﬁ
 
èrgë_upd©e
)

688 
u16
 
code
;

689 c⁄° *
iso_«me
;

690 
Æpha2
[2];

692 
	`BUG_ON
(!
ªg
);

694 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

696 
ªg_code
,

697 
èrgë_upd©e
 ? "" : "not ");

699 
code
 = (
u16
)(
ªg_code
 & 
ATH6KL_REG_CODE_MASK
);

700 i‡((
ªg_code
 >> 
ATH6KL_COUNTRY_RD_SHIFT
) &

701 
ATH6KL_COUNTRY_ERD_FLAG
)

702 
iso_«me
 = 
	`_ªg_föd_iso_«me
(
ªg_code
, 
åue
, 
Ál£
);

704 
iso_«me
 = 
	`_ªg_föd_iso_«me
(
ªg_code
, 
Ál£
, 
åue
);

706 i‡(
iso_«me
) {

707 
Æpha2
[0] = 
iso_«me
[0];

708 
Æpha2
[1] = 
iso_«me
[1];

710 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

712 
Æpha2
[0],álpha2[1]);

715 
	`ªguœt‹y_höt
(
ªg
->
wùhy
, 
Æpha2
);

719 
	`©h6kl_p2p_rc_„tch_ch™
(
ªg
->
¨
);

722 
	}
}

724 
	$_ªg_cfg80211_nŸify
(
wùhy
 *wiphy,

725 
ªguœt‹y_ªque°
 *
ªque°
)

727 
öôüt‹Såög
[4][16] = {

733 
©h6kl
 *
¨
 = 
	`wùhy_¥iv
(
wùhy
);

734 
ªt
 = 0;

736 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

738 
ªque°
->
Æpha2
[0],Ñequest->alpha2[1],

739 
ªque°
->
öãr£˘
 ? " intersect" : "",

740 
ªque°
->
¥o˚s£d
 ? "Örocessed" : "",

741 
öôüt‹Såög
[
ªque°
->
öôüt‹
]);

743 
ªt
 = 
	`©h6kl_ªg_£t_cou¡ry
(
¨
, 
ªque°
->
Æpha2
);

745  
ªt
;

746 
	}
}

748 
	$_ªg_nŸifõr
(
wùhy
 *wiphy,

749 
ªguœt‹y_ªque°
 *
ªque°
)

751 
öôüt‹Såög
[4][16] = {

757 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

758 
ªg_öfo
 *
ªg
 = 
¨
->
ªg_˘x
;

759 
õì80211_ªgdomaö
 *
ªgd
 = 
NULL
;

761 
ªque°
->
öôüt‹
) {

762 
NL80211_REGDOM_SET_BY_DRIVER
:

763 
NL80211_REGDOM_SET_BY_CORE
:

764 
NL80211_REGDOM_SET_BY_USER
:

765 
NL80211_REGDOM_SET_BY_COUNTRY_IE
:

766 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

768 
öôüt‹Såög
[
ªque°
->
öôüt‹
],

769 
ªque°
->
Æpha2
[0],

770 
ªque°
->
Æpha2
[1]);

773 
ªgd
 = 
	`©h6kl_ªg_upd©e
(
ªg
,Ñeg->
cuºít_ªg_code
, 
Ál£
);

774 i‡(
ªgd
 !
ªg
->
cuºít_ªgd
) {

775 
	`©h6kl_îr
("regÇotifier fail, %x %p %p\n",

776 
ªg
->
cuºít_ªg_code
,

777 
ªg
->
cuºít_ªgd
,

778 
ªgd
);

779 
	`WARN_ON
(1);

785 
	}
}

787 
	$©h6kl_ªg_nŸifõr
(
wùhy
 *wiphy,

788 
ªguœt‹y_ªque°
 *
ªque°
)

790 
©h6kl
 *
¨
 = (©h6k»*)
	`wùhy_¥iv
(
wùhy
);

791 
ªg_öfo
 *
ªg
 = 
¨
->
ªg_˘x
;

793 i‡(
ªg
 =
NULL
)

796 i‡(
ªg
->
Êags
 & 
ATH6KL_REG_FALGS_INTERNAL_REGDB
)

797 
	`_ªg_nŸifõr
(
wùhy
, 
ªque°
);

798 i‡(
ªg
->
Êags
 & 
ATH6KL_REG_FALGS_CFG80211_REGDB
)

799 
	`_ªg_cfg80211_nŸify
(
wùhy
, 
ªque°
);

802 
	}
}

804 
	$©h6kl_ªg_nŸifõr2
(
wùhy
 *wiphy,

805 
ªguœt‹y_ªque°
 *
ªque°
)

807 
	`©h6kl_ªg_nŸifõr
(
wùhy
, 
ªque°
);

810 
	}
}

812 
	$©h6kl_ªg_èrgë_nŸify
(
©h6kl
 *
¨
, 
u32
 
ªg_code
)

814 
ªg_öfo
 *
ªg
 = 
¨
->
ªg_˘x
;

815 
õì80211_ªgdomaö
 *
ªgd
 = 
NULL
;

817 
	`BUG_ON
(!
ªg
);

819 i‡((
ªg_code
 & 
ATH6KL_REG_CODE_MASK
Ë=
NULL_REG_CODE
) {

820 
	`©h6kl_îr
("ªg unknow¿codê0x%x, ign‹êô\n", 
ªg_code
);

823 i‡(((
ªg
->
Êags
 & 
ATH6KL_REG_FALGS_INTERNAL_REGDB
) ||

824 (
ªg
->
Êags
 & 
ATH6KL_REG_FALGS_CFG80211_REGDB
)) &&

825 
	`ã°_bô
(
REG_COUNTRY_UPDATE
, &
¨
->
Êag
)) {

826 
	`˛ór_bô
(
REG_COUNTRY_UPDATE
, &
¨
->
Êag
);

827 
	`wake_up
(&
¨
->
evít_wq
);

830  -
EINVAL
;

833 i‡(
ªg
->
Êags
 & 
ATH6KL_REG_FALGS_INTERNAL_REGDB
)

834 
ªgd
 = 
	`©h6kl_ªg_upd©e
(
ªg
, 
ªg_code
, 
åue
);

835 i‡(
ªg
->
Êags
 & 
ATH6KL_REG_FALGS_CFG80211_REGDB
)

836 
	`©h6kl_ªg_cfg80211_upd©e
(
ªg
, 
ªg_code
, 
åue
);

838 
u16
 
code
;

839 c⁄° *
iso_«me
;

840 
Æpha2
[2];

842 
code
 = (
u16
)(
ªg_code
 & 
ATH6KL_REG_CODE_MASK
);

843 i‡((
ªg_code
 >> 
ATH6KL_COUNTRY_RD_SHIFT
) &

844 
ATH6KL_COUNTRY_ERD_FLAG
)

845 
iso_«me
 = 
	`_ªg_föd_iso_«me
(
ªg_code
, 
åue
, 
Ál£
);

847 
iso_«me
 = 
	`_ªg_föd_iso_«me
(
ªg_code
, 
Ál£
, 
åue
);

849 i‡(
iso_«me
) {

850 
Æpha2
[0] = 
iso_«me
[0];

851 
Æpha2
[1] = 
iso_«me
[1];

853 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

855 
Æpha2
[0],álpha2[1]);

858 
	`ªguœt‹y_höt
(
¨
->
wùhy
, 
Æpha2
);

863 
ªg
->
cuºít_ªgd
 = 
ªgd
;

864 
ªg
->
cuºít_ªg_code
 = 
ªg_code
;

867 
	}
}

869 
boﬁ
 
	$©h6kl_ªg_is_öô_d⁄e
(
©h6kl
 *
¨
)

871 
ªg_öfo
 *
ªg
 = 
¨
->
ªg_˘x
;

873 i‡(!((
ªg
->
cuºít_ªg_code
 >> 
ATH6KL_COUNTRY_RD_SHIFT
) &

874 
ATH6KL_WORLDWIDE_ROAMING_FLAG
))

875  
åue
;

877  
Ál£
;

878 
	}
}

880 
boﬁ
 
	$©h6kl_ªg_is_p2p_ch™√l
(
©h6kl
 *
¨
, 
u32
 
‰eq
)

882 
	#_REG_CHAN_P2P_NOT_ALLOWED
 ( \

883 
IEEE80211_CHAN_RADAR
 | \

884 
IEEE80211_CHAN_PASSIVE_SCAN
 | \

885 
IEEE80211_CHAN_NO_IBSS
)

	)

886 i‡(
	`©h6kl_p2p_is_p2p_ch™√l
(
‰eq
)) {

887 
wùhy
 *wùhy = 
¨
->wiphy;

888 
õì80211_b™d
 
b™d
 = 
NL80211_BAND_2GHZ
;

889 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

890 
õì80211_ch™√l
 *
ch™
;

891 
i
;

893 i‡(
‰eq
 > 4000)

894 
b™d
 = 
NL80211_BAND_5GHZ
;

896 
sb™d
 = 
wùhy
->
b™ds
[
b™d
];

897 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

898 
ch™
 = &
sb™d
->
ch™√ls
[
i
];

899 i‡(
ch™
->
˚¡î_‰eq
 =
‰eq
) {

900 i‡(
ch™
->
Êags
 & 
_REG_CHAN_P2P_NOT_ALLOWED
)

901  
Ál£
;

903  
åue
;

906  
Ál£
;

908  
Ál£
;

909 #unde‡
_REG_CHAN_P2P_NOT_ALLOWED


910 
	}
}

912 
boﬁ
 
	$©h6kl_ªg_is_dfs_ch™√l
(
©h6kl
 *
¨
, 
u32
 
‰eq
)

914 
wùhy
 *wùhy = 
¨
->wiphy;

915 
õì80211_suµ‹ãd_b™d
 *
sb™d
;

916 
õì80211_ch™√l
 *
ch™
;

917 
i
;

919 i‡(
‰eq
 < 4000)

920  
Ál£
;

922 
sb™d
 = 
wùhy
->
b™ds
[
NL80211_BAND_5GHZ
];

923 
i
 = 0; i < 
sb™d
->
n_ch™√ls
; i++) {

924 
ch™
 = &
sb™d
->
ch™√ls
[
i
];

925 i‡(
ch™
->
˚¡î_‰eq
 =
‰eq
) {

926 i‡(
ch™
->
Êags
 & 
IEEE80211_CHAN_RADAR
)

927  
åue
;

929  
Ál£
;

933  
Ál£
;

934 
	}
}

936 
boﬁ
 
	$©h6kl_ªg_is_…e_ch™√l
(
©h6kl
 *
¨
, 
u32
 
‰eq
)

938 
	#_LTE_BAND7_START_FREQ
 (2457Ë

	)

945 i‡(
‰eq
 >
_LTE_BAND7_START_FREQ
)

946  
åue
;

948  
Ál£
;

949 #unde‡
_LTE_BAND7_START_FREQ


950 
	}
}

952 
ªg_öfo
 *
	$©h6kl_ªg_öô
(
©h6kl
 *
¨
,

953 
boﬁ
 
ötRegdb
,

954 
boﬁ
 
cfgRegdb
,

955 
boﬁ
 
p2pInPasvCh
)

957 
ªg_öfo
 *
ªg
;

959 
ªg
 = 
	`kzÆloc
((
ªg_öfo
), 
GFP_KERNEL
);

960 i‡(!
ªg
) {

961 
	`©h6kl_îr
("failedÅoálloc memory forÑeg\n");

962  
NULL
;

965 
	`BUG_ON
((
ötRegdb
 && 
cfgRegdb
));

967 
ªg
->
¨
 =ár;

968 
ªg
->
wùhy
 = 
¨
->wiphy;

969 i‡(
ötRegdb
) {

970 
ªg
->
Êags
 |
ATH6KL_REG_FALGS_INTERNAL_REGDB
;

971 i‡(
p2pInPasvCh
)

972 
ªg
->
Êags
 |
ATH6KL_REG_FALGS_P2P_IN_PASV_CHAN
;

974 
	`©h6kl_öfo
("Using driver'sÑegdb%s.\n",

975 (
p2pInPasvCh
 ? " &Ö2p-in-passive-chan" : ""));

976 } i‡(
cfgRegdb
) {

977 
ªg
->
Êags
 |
ATH6KL_REG_FALGS_CFG80211_REGDB
;

979 
	`©h6kl_öfo
("Using cfg80211'sÑegdb.\n");

982 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

984 
ªg
->
Êags
);

986  
ªg
;

987 
	}
}

989 
	$©h6kl_ªg_deöô
(
©h6kl
 *
¨
)

991 
	`k‰ì
(
¨
->
ªg_˘x
);

992 
¨
->
ªg_˘x
 = 
NULL
;

994 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

998 
	}
}

1000 
boﬁ
 
	$_ªg_dump_cou¡ry_õ
(
u8
 *
õs
, 
õs_Àn
, u8 *
Æpha2
)

1002 
u8
 *
pos
;

1003 
boﬁ
 
found
 = 
Ál£
;

1005 
pos
 = 
õs
;

1006 i‡(
õs
 && 
õs_Àn
) {

1007 
pos
 + 1 < 
õs
 + 
õs_Àn
) {

1008 i‡(
pos
 + 2 +Öos[1] > 
õs
 + 
õs_Àn
)

1010 i‡(
pos
[0] =
WLAN_EID_COUNTRY
) {

1011 
found
 = 
åue
;

1012 
	`mem˝y
(
Æpha2
, (
pos
 + 2), 2);

1015 
pos
 += 2 +Öos[1];

1019  
found
;

1020 
	}
}

1022 
	$©h6kl_ªg_bss_öfo
(
©h6kl
 *
¨
,

1023 
õì80211_mgmt
 *
mgmt
,

1024 
Àn
,

1025 
u8
 
¢r
,

1026 
õì80211_ch™√l
 *
ch™√l
)

1028 i‡(!
	`©h6kl_ªg_is_öô_d⁄e
(
¨
)) {

1029 
Æpha
[2];

1030 
boﬁ
 
found
 = 
Ál£
;

1032 i‡((
mgmt
->
‰ame_c⁄åﬁ
 =
IEEE80211_STYPE_BEACON
) ||

1033 (
mgmt
->
‰ame_c⁄åﬁ
 =
IEEE80211_STYPE_PROBE_RESP
))

1034 
found
 = 
	`_ªg_dump_cou¡ry_õ
(
mgmt
->
u
.
bóc⁄
.
v¨übÀ
,

1035 (
Àn
 - 36),

1036 (
u8
 *)
Æpha
);

1038 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

1041 
mgmt
->
bssid
[0], mgmt->bssid[1], mgmt->bssid[2],

1042 
mgmt
->
bssid
[3], mgmt->bssid[4], mgmt->bssid[5],

1043 
mgmt
->
‰ame_c⁄åﬁ
,

1044 (
ch™√l
 ? ch™√l->
˚¡î_‰eq
 : 0),

1045 
¢r
,

1046 (
found
 ? 
Æpha
[0] : ' '),

1047 (
found
 ? 
Æpha
[1] : ' '));

1051 
	}
}

1053 
	$_ªg_£t_cou¡ry
(
©h6kl
 *
¨
)

1055 
©h6kl_vif
 *
vif
;

1057 
u16
 
ch_li°
[11] = {2412, 2417, 2422, 2427,

1060 
boﬁ
 
sˇn_⁄_goög
 = 
Ál£
;

1061 
i
;

1064 
i
 = 0; i < 
¨
->
vif_max
; i++) {

1065 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

1066 i‡(
vif
 && vif->
sˇn_ªq
)

1067 
sˇn_⁄_goög
 = 
åue
;

1071 i‡(
sˇn_⁄_goög
 =
Ál£
)

1072 
	`©h6kl_wmi_°¨tsˇn_cmd
(
¨
->
wmi
,

1073 0, 
WMI_LONG_SCAN
,

1074 
åue
, 
Ál£
, 0, 0,

1076 
ch_li°
);

1078 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

1080 
sˇn_⁄_goög
);

1083 
	}
}

1085 
	$©h6kl_ªg_£t_cou¡ry
(
©h6kl
 *
¨
, *
isoName
)

1087 
	#WAIT_REG_RESULT
 (
HZ
 / 5Ë

	)

1088 
©h6kl_vif
 *
vif
;

1089 
ªg_öfo
 *
ªg
 = 
¨
->
ªg_˘x
;

1090 
À·
;

1091 
i
;

1093 
	`BUG_ON
(!
ªg
);

1095 i‡(!(
ªg
->
Êags
 & (
ATH6KL_REG_FALGS_INTERNAL_REGDB
 |

1096 
ATH6KL_REG_FALGS_CFG80211_REGDB
)))

1097  -
EPERM
;

1099 
i
 = 0; i < 
¨
->
vif_max
; i++) {

1100 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

1101 i‡((
vif
) &&

1102 (
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) ||

1103 
	`ã°_bô
(
CONNECT_PEND
, &
vif
->
Êags
))) {

1104 
	`©h6kl_îr
("regÇotállowÅo changeÇow\n");

1106  -
EPERM
;

1110 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
))

1111  -
EBUSY
;

1113 
	`£t_bô
(
REG_COUNTRY_UPDATE
, &
¨
->
Êag
);

1115 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

1117 
isoName
[0], isoName[1]);

1119 i‡(
	`©h6kl_wmi_£t_ªgdomaö_cmd
(
¨
->
wmi
, 
isoName
)) {

1120 
	`˛ór_bô
(
REG_COUNTRY_UPDATE
, &
¨
->
Êag
);

1121 
	`up
(&
¨
->
£m
);

1123  -
EIO
;

1126 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

1127 !
	`ã°_bô
(
REG_COUNTRY_UPDATE
,

1128 &
¨
->
Êag
),

1129 
WAIT_REG_RESULT
);

1130 
	`up
(&
¨
->
£m
);

1132 i‡(
	`ã°_bô
(
REG_COUNTRY_UPDATE
, &
¨
->
Êag
)) {

1133 
	`˛ór_bô
(
REG_COUNTRY_UPDATE
, &
¨
->
Êag
);

1134 
	`_ªg_£t_cou¡ry
(
¨
);

1136 
	`©h6kl_îr
("reg set country failed\n");

1138  -
EINVAL
;

1142 #unde‡
WAIT_REG_RESULT


1143 
	}
}

1145 
	#AR6004_BOARD_DATA_ADDR
 0x00400854

	)

1146 
	#AR6004_BOARD_DATA_OFFSET
 4

	)

1147 
	#AR6004_RD_OFFSET
 20

	)

1149 
	#AR6006_BOARD_DATA_ADDR
 0x00428854

	)

1150 
	#AR6006_BOARD_DATA_OFFSET
 4

	)

1151 
	#AR6006_RD_OFFSET
 20

	)

1153 
	$©h6kl_ªg_£t_rdcode
(
©h6kl
 *
¨
, 
rdcode
)

1155 
u8
 
buf
[32];

1156 
u16
 
o_sum
, 
o_vî
, 
o_rd
, 
o_rd_√xt
;

1157 
u32
 
n_rd
, 
n_sum
;

1158 
u32
 
bd_addr
 = 0;

1159 
ªt
;

1160 
u32
 
rd_off£t
, 
bd_off£t
;

1163 i‡(
rdcode
 =
NULL_REG_CODE
)

1164  -
EINVAL
;

1166 
¨
->
èrgë_ty≥
) {

1167 
TARGET_TYPE_AR6004
:

1168 
rd_off£t
 = 
AR6004_RD_OFFSET
;

1169 
bd_off£t
 = 
AR6004_BOARD_DATA_OFFSET
;

1170 
ªt
 = 
	`©h6kl_bmi_ªad
(
¨
,

1171 
AR6004_BOARD_DATA_ADDR
,

1172 (
u8
 *)&
bd_addr
,

1175 
TARGET_TYPE_AR6006
:

1176 
rd_off£t
 = 
AR6006_RD_OFFSET
;

1177 
bd_off£t
 = 
AR6006_BOARD_DATA_OFFSET
;

1178 
ªt
 = 
	`©h6kl_bmi_ªad
(
¨
,

1179 
AR6006_BOARD_DATA_ADDR
,

1180 (
u8
 *)&
bd_addr
,

1184 
	`©h6kl_îr
("No supportÑdcode overwrite!Åarget_type %d\n",

1185 
¨
->
èrgë_ty≥
);

1186  -
EOPNOTSUPP
;

1189 i‡(
ªt
)

1190  
ªt
;

1192 
	`mem£t
(
buf
, 0, (buf));

1193 
ªt
 = 
	`©h6kl_bmi_ªad
(
¨
, 
bd_addr
, 
buf
, (buf));

1194 i‡(
ªt
)

1195  
ªt
;

1197 
	`mem˝y
((
u8
 *)&
o_sum
, 
buf
 + 
bd_off£t
, 2);

1198 
	`mem˝y
((
u8
 *)&
o_vî
, 
buf
 + 
bd_off£t
 + 2, 2);

1199 
	`mem˝y
((
u8
 *)&
o_rd
, 
buf
 + 
rd_off£t
, 2);

1200 
	`mem˝y
((
u8
 *)&
o_rd_√xt
, 
buf
 + 
rd_off£t
 + 2, 2);

1202 
	`©h6kl_dbg
(
ATH6KL_DBG_REGDB
,

1204 
rdcode
,

1205 
o_vî
,

1206 
o_rd_√xt
,

1207 
o_rd
);

1209 
n_rd
 = (
o_rd_√xt
 << 16Ë+ 
rdcode
;

1210 
ªt
 = 
	`©h6kl_bmi_wrôe
(
¨
,

1211 
bd_addr
 + 
rd_off£t
,

1212 (
u8
 *)&
n_rd
,

1214 i‡(
ªt
)

1215  
ªt
;

1217 
n_sum
 = (
o_vî
 << 16Ë+ (
o_sum
 ^ 
o_rd
 ^ 
rdcode
);

1218 
ªt
 = 
	`©h6kl_bmi_wrôe
(
¨
,

1219 
bd_addr
 + 
bd_off£t
,

1220 (
u8
 *)&
n_sum
,

1223  
ªt
;

1224 
	}
}

	@reg.h

17 #i‚de‡
REG_H


18 
	#REG_H


	)

28 
	e©h6kl_Cou¡ryCode
 {

29 
	mCOUNTRY_ALBANIA
 = 8,

30 
	mCOUNTRY_ALGERIA
 = 12,

31 
	mCOUNTRY_ARGENTINA
 = 32,

32 
	mCOUNTRY_ARMENIA
 = 51,

33 
	mCOUNTRY_ARUBA
 = 533,

34 
	mCOUNTRY_AUSTRALIA
 = 36,

35 
	mCOUNTRY_AUSTRALIA_AP
 = 5000,

36 
	mCOUNTRY_AUSTRIA
 = 40,

37 
	mCOUNTRY_AZERBAIJAN
 = 31,

38 
	mCOUNTRY_BAHRAIN
 = 48,

39 
	mCOUNTRY_BANGLADESH
 = 50,

40 
	mCOUNTRY_BARBADOS
 = 52,

41 
	mCOUNTRY_BELARUS
 = 112,

42 
	mCOUNTRY_BELGIUM
 = 56,

43 
	mCOUNTRY_BELIZE
 = 84,

44 
	mCOUNTRY_BOLIVIA
 = 68,

45 
	mCOUNTRY_BOSNIA_HERZEGOWANIA
 = 70,

46 
	mCOUNTRY_BRAZIL
 = 76,

47 
	mCOUNTRY_BRUNEI_DARUSSALAM
 = 96,

48 
	mCOUNTRY_BULGARIA
 = 100,

49 
	mCOUNTRY_CAMBODIA
 = 116,

50 
	mCOUNTRY_CANADA
 = 124,

51 
	mCOUNTRY_CANADA_AP
 = 5001,

52 
	mCOUNTRY_CHILE
 = 152,

53 
	mCOUNTRY_CHINA
 = 156,

54 
	mCOUNTRY_COLOMBIA
 = 170,

55 
	mCOUNTRY_COSTA_RICA
 = 188,

56 
	mCOUNTRY_CROATIA
 = 191,

57 
	mCOUNTRY_CYPRUS
 = 196,

58 
	mCOUNTRY_CZECH
 = 203,

59 
	mCOUNTRY_DENMARK
 = 208,

60 
	mCOUNTRY_DOMINICAN_REPUBLIC
 = 214,

61 
	mCOUNTRY_ECUADOR
 = 218,

62 
	mCOUNTRY_EGYPT
 = 818,

63 
	mCOUNTRY_EL_SALVADOR
 = 222,

64 
	mCOUNTRY_ESTONIA
 = 233,

65 
	mCOUNTRY_FAEROE_ISLANDS
 = 234,

66 
	mCOUNTRY_FINLAND
 = 246,

67 
	mCOUNTRY_FRANCE
 = 250,

68 
	mCOUNTRY_FRANCE2
 = 255,

69 
	mCOUNTRY_GEORGIA
 = 268,

70 
	mCOUNTRY_GERMANY
 = 276,

71 
	mCOUNTRY_GREECE
 = 300,

72 
	mCOUNTRY_GREENLAND
 = 304,

73 
	mCOUNTRY_GRENADA
 = 308,

74 
	mCOUNTRY_GUAM
 = 316,

75 
	mCOUNTRY_GUATEMALA
 = 320,

76 
	mCOUNTRY_HAITI
 = 332,

77 
	mCOUNTRY_HONDURAS
 = 340,

78 
	mCOUNTRY_HONG_KONG
 = 344,

79 
	mCOUNTRY_HUNGARY
 = 348,

80 
	mCOUNTRY_ICELAND
 = 352,

81 
	mCOUNTRY_INDIA
 = 356,

82 
	mCOUNTRY_INDONESIA
 = 360,

83 
	mCOUNTRY_IRAN
 = 364,

84 
	mCOUNTRY_IRAQ
 = 368,

85 
	mCOUNTRY_IRELAND
 = 372,

86 
	mCOUNTRY_ISRAEL
 = 376,

87 
	mCOUNTRY_ITALY
 = 380,

88 
	mCOUNTRY_JAMAICA
 = 388,

89 
	mCOUNTRY_JAPAN
 = 392,

90 
	mCOUNTRY_JAPAN1
 = 393,

91 
	mCOUNTRY_JAPAN2
 = 394,

92 
	mCOUNTRY_JAPAN3
 = 395,

93 
	mCOUNTRY_JAPAN4
 = 396,

94 
	mCOUNTRY_JAPAN5
 = 397,

95 
	mCOUNTRY_JAPAN6
 = 399,

96 
	mCOUNTRY_JORDAN
 = 400,

97 
	mCOUNTRY_KAZAKHSTAN
 = 398,

98 
	mCOUNTRY_KENYA
 = 404,

99 
	mCOUNTRY_KOREA_NORTH
 = 408,

100 
	mCOUNTRY_KOREA_ROC
 = 410,

101 
	mCOUNTRY_KOREA_ROC2
 = 411,

102 
	mCOUNTRY_KOREA_ROC3
 = 412,

103 
	mCOUNTRY_KUWAIT
 = 414,

104 
	mCOUNTRY_LATVIA
 = 428,

105 
	mCOUNTRY_LEBANON
 = 422,

106 
	mCOUNTRY_LIBYA
 = 434,

107 
	mCOUNTRY_LIECHTENSTEIN
 = 438,

108 
	mCOUNTRY_LITHUANIA
 = 440,

109 
	mCOUNTRY_LUXEMBOURG
 = 442,

110 
	mCOUNTRY_MACAU
 = 446,

111 
	mCOUNTRY_MACEDONIA
 = 807,

112 
	mCOUNTRY_MALAYSIA
 = 458,

113 
	mCOUNTRY_MALTA
 = 470,

114 
	mCOUNTRY_MEXICO
 = 484,

115 
	mCOUNTRY_MONACO
 = 492,

116 
	mCOUNTRY_MOROCCO
 = 504,

117 
	mCOUNTRY_NEPAL
 = 524,

118 
	mCOUNTRY_NETHERLANDS
 = 528,

119 
	mCOUNTRY_NETHERLAND_ANTILLES
 = 530,

120 
	mCOUNTRY_NEW_ZEALAND
 = 554,

121 
	mCOUNTRY_NICARAGUA
 = 558,

122 
	mCOUNTRY_NORWAY
 = 578,

123 
	mCOUNTRY_OMAN
 = 512,

124 
	mCOUNTRY_PAKISTAN
 = 586,

125 
	mCOUNTRY_PANAMA
 = 591,

126 
	mCOUNTRY_PARAGUAY
 = 600,

127 
	mCOUNTRY_PERU
 = 604,

128 
	mCOUNTRY_PHILIPPINES
 = 608,

129 
	mCOUNTRY_POLAND
 = 616,

130 
	mCOUNTRY_PORTUGAL
 = 620,

131 
	mCOUNTRY_PUERTO_RICO
 = 630,

132 
	mCOUNTRY_QATAR
 = 634,

133 
	mCOUNTRY_ROMANIA
 = 642,

134 
	mCOUNTRY_RUSSIA
 = 643,

135 
	mCOUNTRY_RWANDA
 = 646,

136 
	mCOUNTRY_SAUDI_ARABIA
 = 682,

137 
	mCOUNTRY_SERBIA
 = 688,

138 
	mCOUNTRY_MONTENEGRO
 = 499,

139 
	mCOUNTRY_SINGAPORE
 = 702,

140 
	mCOUNTRY_SLOVAKIA
 = 703,

141 
	mCOUNTRY_SLOVENIA
 = 705,

142 
	mCOUNTRY_SOUTH_AFRICA
 = 710,

143 
	mCOUNTRY_SPAIN
 = 724,

144 
	mCOUNTRY_SRILANKA
 = 144,

145 
	mCOUNTRY_SWEDEN
 = 752,

146 
	mCOUNTRY_SWITZERLAND
 = 756,

147 
	mCOUNTRY_SYRIA
 = 760,

148 
	mCOUNTRY_TAIWAN
 = 158,

149 
	mCOUNTRY_THAILAND
 = 764,

150 
	mCOUNTRY_TRINIDAD_Y_TOBAGO
 = 780,

151 
	mCOUNTRY_TUNISIA
 = 788,

152 
	mCOUNTRY_TURKEY
 = 792,

153 
	mCOUNTRY_UAE
 = 784,

154 
	mCOUNTRY_UGANDA
 = 800,

155 
	mCOUNTRY_UKRAINE
 = 804,

156 
	mCOUNTRY_UNITED_KINGDOM
 = 826,

157 
	mCOUNTRY_UNITED_STATES
 = 840,

158 
	mCOUNTRY_UNITED_STATES_AP
 = 841,

159 
	mCOUNTRY_UNITED_STATES_PS
 = 842,

160 
	mCOUNTRY_URUGUAY
 = 858,

161 
	mCOUNTRY_UZBEKISTAN
 = 860,

162 
	mCOUNTRY_VENEZUELA
 = 862,

163 
	mCOUNTRY_VIET_NAM
 = 704,

164 
	mCOUNTRY_YEMEN
 = 887,

165 
	mCOUNTRY_ZIMBABWE
 = 716

168 
	e©h6kl_Regi⁄Code
 {

169 
	mREGION_NO_ENUMRD
 = 0x00,

170 
	mREGION_NULL1_WORLD
 = 0x03,

172 
	mREGION_NULL1_ETSIB
 = 0x07,

173 
	mREGION_NULL1_ETSIC
 = 0x08,

175 
	mREGION_FCC1_FCCA
 = 0x10,

176 
	mREGION_FCC1_WORLD
 = 0x11,

177 
	mREGION_FCC2_FCCA
 = 0x20,

178 
	mREGION_FCC2_WORLD
 = 0x21,

179 
	mREGION_FCC2_ETSIC
 = 0x22,

180 
	mREGION_FCC3_FCCA
 = 0x3A,

182 
	mREGION_FCC3_WORLD
 = 0x3B,

184 
	mREGION_FCC3_ETSIC
 = 0x3F,

185 
	mREGION_FCC4_FCCA
 = 0x12,

186 
	mREGION_FCC5_FCCA
 = 0x13,

187 
	mREGION_FCC5_WORLD
 = 0x16,

188 
	mREGION_FCC6_FCCA
 = 0x14,

191 
	mREGION_FCC6_WORLD
 = 0x23,

195 
	mREGION_ETSI1_WORLD
 = 0x37,

197 
	mREGION_ETSI2_WORLD
 = 0x35,

198 
	mREGION_ETSI3_WORLD
 = 0x36,

199 
	mREGION_ETSI4_WORLD
 = 0x30,

200 
	mREGION_ETSI4_ETSIC
 = 0x38,

201 
	mREGION_ETSI5_WORLD
 = 0x39,

202 
	mREGION_ETSI6_WORLD
 = 0x34,

203 
	mREGION_ETSI8_WORLD
 = 0x3D,

204 
	mREGION_ETSI9_WORLD
 = 0x3E,

205 
	mREGION_ETSI_RESERVED
 = 0x33,

206 
	mREGION_FRANCE_RES
 = 0x31,

208 
	mREGION_APL6_WORLD
 = 0x5B,

209 
	mREGION_APL4_WORLD
 = 0x42,

210 
	mREGION_APL3_FCCA
 = 0x50,

211 
	mREGION_APL_RESERVED
 = 0x44,

212 
	mREGION_APL2_WORLD
 = 0x45,

213 
	mREGION_APL2_APLC
 = 0x46,

214 
	mREGION_APL3_WORLD
 = 0x47,

215 
	mREGION_APL2_APLD
 = 0x49,

216 
	mREGION_APL2_FCCA
 = 0x4D,

217 
	mREGION_APL1_WORLD
 = 0x52,

218 
	mREGION_APL1_FCCA
 = 0x53,

219 
	mREGION_APL1_ETSIC
 = 0x55,

220 
	mREGION_APL2_ETSIC
 = 0x56,

221 
	mREGION_APL5_WORLD
 = 0x58,

222 
	mREGION_APL7_FCCA
 = 0x5C,

223 
	mREGION_APL8_WORLD
 = 0x5D,

224 
	mREGION_APL9_WORLD
 = 0x5E,

225 
	mREGION_APL10_WORLD
 = 0x5F,

228 
	mREGION_MKK5_MKKA
 = 0x99,

230 
	mREGION_MKK5_FCCA
 = 0x9A,

232 
	mREGION_MKK5_MKKC
 = 0x88,

233 
	mREGION_MKK11_MKKA
 = 0xD4,

234 
	mREGION_MKK11_FCCA
 = 0xD5,

235 
	mREGION_MKK11_MKKC
 = 0xD7,

240 
	mREGION_WOR0_WORLD
 = 0x60,

241 
	mREGION_WOR1_WORLD
 = 0x61,

242 
	mREGION_WOR2_WORLD
 = 0x62,

243 
	mREGION_WOR3_WORLD
 = 0x63,

244 
	mREGION_WOR4_WORLD
 = 0x64,

245 
	mREGION_WOR5_ETSIC
 = 0x65,

247 
	mREGION_WOR01_WORLD
 = 0x66,

248 
	mREGION_WOR02_WORLD
 = 0x67,

249 
	mREGION_EU1_WORLD
 = 0x68,

252 
	mREGION_WOR9_WORLD
 = 0x69,

253 
	mREGION_WORA_WORLD
 = 0x6A,

254 
	mREGION_WORB_WORLD
 = 0x6B,

255 
	mREGION_WORC_WORLD
 = 0x6C,

264 
	mREGION_APL1
 = 0x0150,

265 
	mREGION_APL2
 = 0x0250,

266 
	mREGION_APL3
 = 0x0350,

267 
	mREGION_APL4
 = 0x0450,

268 
	mREGION_APL5
 = 0x0550,

269 
	mREGION_APL6
 = 0x0650,

270 
	mREGION_APL7
 = 0x0750,

271 
	mREGION_APL8
 = 0x0850,

272 
	mREGION_APL9
 = 0x0950,

273 
	mREGION_APL10
 = 0x1050,

275 
	mREGION_ETSI1
 = 0x0130,

276 
	mREGION_ETSI2
 = 0x0230,

277 
	mREGION_ETSI3
 = 0x0330,

278 
	mREGION_ETSI4
 = 0x0430,

279 
	mREGION_ETSI5
 = 0x0530,

280 
	mREGION_ETSI6
 = 0x0630,

281 
	mREGION_ETSI8
 = 0x0830,

282 
	mREGION_ETSI9
 = 0x0930,

283 
	mREGION_ETSIB
 = 0x0B30,

284 
	mREGION_ETSIC
 = 0x0C30,

286 
	mREGION_FCC1
 = 0x0110,

287 
	mREGION_FCC2
 = 0x0120,

288 
	mREGION_FCC3
 = 0x0160,

289 
	mREGION_FCC4
 = 0x0165,

290 
	mREGION_FCC5
 = 0x0180,

291 
	mREGION_FCC6
 = 0x0610,

292 
	mREGION_FCCA
 = 0x0A10,

294 
	mREGION_APLD
 = 0x0D50,

296 
	mREGION_MKK1
 = 0x0140,

297 
	mREGION_MKK2
 = 0x0240,

298 
	mREGION_MKK3
 = 0x0340,

299 
	mREGION_MKK4
 = 0x0440,

300 
	mREGION_MKK5
 = 0x0540,

301 
	mREGION_MKK6
 = 0x0640,

302 
	mREGION_MKK7
 = 0x0740,

303 
	mREGION_MKK8
 = 0x0840,

304 
	mREGION_MKK9
 = 0x0940,

305 
	mREGION_MKK10
 = 0x1040,

306 
	mREGION_MKK11
 = 0x1140,

307 
	mREGION_MKK12
 = 0x1240,

309 
	mREGION_MKKA
 = 0x0A40,

310 
	mREGION_MKKC
 = 0x0A50,

312 
	mREGION_NULL1
 = 0x0198,

313 
	mREGION_WORLD
 = 0x0199,

314 
	mREGION_DEBUG_REG_DMN
 = 0x01ff,

315 
	mREGION_UNINIT_REG_DMN
 = 0x0fff,

318 
	#ATH6KL_COUNTRY_ERD_FLAG
 0x8000

	)

319 
	#ATH6KL_WORLDWIDE_ROAMING_FLAG
 0x4000

	)

321 
	#ATH6KL_REG_CODE_MASK
 (0xffff)

	)

323 
	#NULL_REG_CODE
 (0xFFFF)

	)

325 
	#ATH6KL_REG_UNSUPPORT_REGDB
 (0Ë

	)

326 
	#ATH6KL_REG_INTERNAL_REGDB
 (1Ë

	)

327 
	#ATH6KL_REG_CFG80211_REGDB
 (2Ë

	)

329 
	sªg_code_to_is⁄ame
 {

330 
u16
 
	mªg_code
;

331 *
	miso_«me
;

347 *
	mªg_to_˘ry_iso_«me
;

350 
	sªg_öfo
 {

351 
	#ATH6KL_REG_FALGS_INTERNAL_REGDB
 (1 << 0)

	)

352 
	#ATH6KL_REG_FALGS_CFG80211_REGDB
 (1 << 1)

	)

353 
	#ATH6KL_REG_FALGS_P2P_IN_PASV_CHAN
 (1 << 2)

	)

354 
u32
 
	mÊags
;

355 
©h6kl
 *
	m¨
;

356 
wùhy
 *
	mwùhy
;

357 
õì80211_ªgdomaö
 *
	mcuºít_ªgd
;

358 
u32
 
	mcuºít_ªg_code
;

361 c⁄° 
õì80211_ªgdomaö
 *
©h6kl_ªg_ªgdb_cou¡ry
[];

362 c⁄° 
õì80211_ªgdomaö
 *
©h6kl_ªg_ªgdb_ªgi⁄
[];

364 
©h6kl_ªg_nŸifõr
(
wùhy
 *wiphy,

365 
ªguœt‹y_ªque°
 *
ªque°
);

366 
©h6kl_ªg_nŸifõr2
(
wùhy
 *wiphy,

367 
ªguœt‹y_ªque°
 *
ªque°
);

368 
©h6kl_ªg_èrgë_nŸify
(
©h6kl
 *
¨
, 
u32
 
ªg_code
);

369 
boﬁ
 
©h6kl_ªg_is_öô_d⁄e
(
©h6kl
 *
¨
);

370 
boﬁ
 
©h6kl_ªg_is_p2p_ch™√l
(
©h6kl
 *
¨
, 
u32
 
‰eq
);

371 
boﬁ
 
©h6kl_ªg_is_dfs_ch™√l
(
©h6kl
 *
¨
, 
u32
 
‰eq
);

372 
boﬁ
 
©h6kl_ªg_is_…e_ch™√l
(
©h6kl
 *
¨
, 
u32
 
‰eq
);

373 
ªg_öfo
 *
©h6kl_ªg_öô
(
©h6kl
 *
¨
,

374 
boﬁ
 
ötRegdb
,

375 
boﬁ
 
cfgRegdb
,

376 
boﬁ
 
p2pInPasvCh
);

377 
©h6kl_ªg_deöô
(
©h6kl
 *
¨
);

378 
©h6kl_ªg_bss_öfo
(
©h6kl
 *
¨
,

379 
õì80211_mgmt
 *
mgmt
,

380 
Àn
,

381 
u8
 
¢r
,

382 
õì80211_ch™√l
 *
ch™√l
);

383 
©h6kl_ªg_£t_cou¡ry
(
©h6kl
 *
¨
, *
isoName
);

384 
©h6kl_ªg_£t_rdcode
(
©h6kl
 *
¨
, 
rdcode
);

	@regdb.c

16 
	~<löux/∆80211.h
>

17 
	~<√t/cfg80211.h
>

27 #ifde‡
CONFIG_ATH6KL_REGDB_AS_CFG80211_REGDB


28 #unde‡
CONFIG_ATH6KL_REGDB_AS_CFG80211_REGDB


31 #ifde‡
CONFIG_ATH6KL_REGDB_AS_CFG80211_REGDB


32 
	~"ªgdb.h
"

43 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_AL
 = {

44 .
n_ªg_ruÀs
 = 4,

45 .
	gÆpha2
 = "AL",

46 .
	gªg_ruÀs
 = {

47 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

48 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

49 | 
NL80211_RRF_NO_IBSS
),

50 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

51 | 
NL80211_RRF_DFS


52 | 
NL80211_RRF_PASSIVE_SCAN


53 | 
NL80211_RRF_NO_IBSS
),

54 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

55 | 
NL80211_RRF_DFS


56 | 
NL80211_RRF_PASSIVE_SCAN


57 | 
NL80211_RRF_NO_IBSS
),

61 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_DZ
 = {

62 .
n_ªg_ruÀs
 = 4,

63 .
	gÆpha2
 = "DZ",

64 .
	gªg_ruÀs
 = {

65 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

66 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

67 | 
NL80211_RRF_NO_IBSS
),

68 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

69 | 
NL80211_RRF_DFS


70 | 
NL80211_RRF_PASSIVE_SCAN


71 | 
NL80211_RRF_NO_IBSS
),

72 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

73 | 
NL80211_RRF_DFS


74 | 
NL80211_RRF_PASSIVE_SCAN


75 | 
NL80211_RRF_NO_IBSS
),

79 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_AR
 = {

80 .
n_ªg_ruÀs
 = 5,

81 .
	gÆpha2
 = "AR",

82 .
	gªg_ruÀs
 = {

83 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

84 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

85 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

86 | 
NL80211_RRF_DFS


87 | 
NL80211_RRF_PASSIVE_SCAN
),

88 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

89 | 
NL80211_RRF_DFS


90 | 
NL80211_RRF_PASSIVE_SCAN
),

91 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

95 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_AM
 = {

96 .
n_ªg_ruÀs
 = 3,

97 .
	gÆpha2
 = "AM",

98 .
	gªg_ruÀs
 = {

99 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

100 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 18, 0

101 | 
NL80211_RRF_NO_IBSS
),

102 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

103 | 
NL80211_RRF_DFS


104 | 
NL80211_RRF_PASSIVE_SCAN


105 | 
NL80211_RRF_NO_IBSS
),

109 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_AW
 = {

110 .
n_ªg_ruÀs
 = 4,

111 .
	gÆpha2
 = "AW",

112 .
	gªg_ruÀs
 = {

113 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

114 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

115 | 
NL80211_RRF_NO_IBSS
),

116 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

117 | 
NL80211_RRF_DFS


118 | 
NL80211_RRF_PASSIVE_SCAN


119 | 
NL80211_RRF_NO_IBSS
),

120 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

121 | 
NL80211_RRF_DFS


122 | 
NL80211_RRF_PASSIVE_SCAN


123 | 
NL80211_RRF_NO_IBSS
),

127 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_AU
 = {

128 .
n_ªg_ruÀs
 = 5,

129 .
	gÆpha2
 = "AU",

130 .
	gªg_ruÀs
 = {

131 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

132 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

133 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

134 | 
NL80211_RRF_DFS


135 | 
NL80211_RRF_PASSIVE_SCAN
),

136 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

137 | 
NL80211_RRF_DFS


138 | 
NL80211_RRF_PASSIVE_SCAN
),

139 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

143 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_A2
 = {

144 .
n_ªg_ruÀs
 = 6,

145 .
	gÆpha2
 = "A2",

146 .
	gªg_ruÀs
 = {

147 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

148 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

149 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

150 | 
NL80211_RRF_DFS


151 | 
NL80211_RRF_PASSIVE_SCAN
),

152 
REG_RULE
(5500 - 10, 5580 + 10, 40, 3, 23, 0

153 | 
NL80211_RRF_DFS


154 | 
NL80211_RRF_PASSIVE_SCAN
),

155 
REG_RULE
(5660 - 10, 5700 + 10, 40, 3, 23, 0

156 | 
NL80211_RRF_DFS


157 | 
NL80211_RRF_PASSIVE_SCAN
),

158 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

162 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_AT
 = {

163 .
n_ªg_ruÀs
 = 4,

164 .
	gÆpha2
 = "AT",

165 .
	gªg_ruÀs
 = {

166 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

167 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

168 | 
NL80211_RRF_NO_IBSS
),

169 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

170 | 
NL80211_RRF_DFS


171 | 
NL80211_RRF_PASSIVE_SCAN


172 | 
NL80211_RRF_NO_IBSS
),

173 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

174 | 
NL80211_RRF_DFS


175 | 
NL80211_RRF_PASSIVE_SCAN


176 | 
NL80211_RRF_NO_IBSS
),

180 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_AZ
 = {

181 .
n_ªg_ruÀs
 = 3,

182 .
	gÆpha2
 = "AZ",

183 .
	gªg_ruÀs
 = {

184 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

185 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 18, 0

186 | 
NL80211_RRF_NO_IBSS
),

187 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

188 | 
NL80211_RRF_DFS


189 | 
NL80211_RRF_PASSIVE_SCAN


190 | 
NL80211_RRF_NO_IBSS
),

194 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BH
 = {

195 .
n_ªg_ruÀs
 = 4,

196 .
	gÆpha2
 = "BH",

197 .
	gªg_ruÀs
 = {

198 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

199 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 20, 0),

200 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

201 | 
NL80211_RRF_DFS


202 | 
NL80211_RRF_PASSIVE_SCAN
),

203 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0),

207 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BD
 = {

208 .
n_ªg_ruÀs
 = 1,

209 .
	gÆpha2
 = "BD",

210 .
	gªg_ruÀs
 = {

211 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

215 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BB
 = {

216 .
n_ªg_ruÀs
 = 4,

217 .
	gÆpha2
 = "BB",

218 .
	gªg_ruÀs
 = {

219 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

220 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

221 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

222 | 
NL80211_RRF_DFS


223 | 
NL80211_RRF_PASSIVE_SCAN
),

224 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

228 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BY
 = {

229 .
n_ªg_ruÀs
 = 4,

230 .
	gÆpha2
 = "BY",

231 .
	gªg_ruÀs
 = {

232 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

233 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

234 | 
NL80211_RRF_NO_IBSS
),

235 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

236 | 
NL80211_RRF_DFS


237 | 
NL80211_RRF_PASSIVE_SCAN


238 | 
NL80211_RRF_NO_IBSS
),

239 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

240 | 
NL80211_RRF_DFS


241 | 
NL80211_RRF_PASSIVE_SCAN


242 | 
NL80211_RRF_NO_IBSS
),

246 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BE
 = {

247 .
n_ªg_ruÀs
 = 4,

248 .
	gÆpha2
 = "BE",

249 .
	gªg_ruÀs
 = {

250 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

251 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

252 | 
NL80211_RRF_NO_IBSS
),

253 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

254 | 
NL80211_RRF_DFS


255 | 
NL80211_RRF_PASSIVE_SCAN


256 | 
NL80211_RRF_NO_IBSS
),

257 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

258 | 
NL80211_RRF_DFS


259 | 
NL80211_RRF_PASSIVE_SCAN


260 | 
NL80211_RRF_NO_IBSS
),

264 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BZ
 = {

265 .
n_ªg_ruÀs
 = 2,

266 .
	gÆpha2
 = "BZ",

267 .
	gªg_ruÀs
 = {

268 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 30, 0),

269 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

273 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BO
 = {

274 .
n_ªg_ruÀs
 = 2,

275 .
	gÆpha2
 = "BO",

276 .
	gªg_ruÀs
 = {

277 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 30, 0),

278 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

282 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BA
 = {

283 .
n_ªg_ruÀs
 = 4,

284 .
	gÆpha2
 = "BA",

285 .
	gªg_ruÀs
 = {

286 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

287 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

288 | 
NL80211_RRF_NO_IBSS
),

289 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

290 | 
NL80211_RRF_DFS


291 | 
NL80211_RRF_PASSIVE_SCAN


292 | 
NL80211_RRF_NO_IBSS
),

293 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

294 | 
NL80211_RRF_DFS


295 | 
NL80211_RRF_PASSIVE_SCAN


296 | 
NL80211_RRF_NO_IBSS
),

300 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BR
 = {

301 .
n_ªg_ruÀs
 = 5,

302 .
	gÆpha2
 = "BR",

303 .
	gªg_ruÀs
 = {

304 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

305 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

306 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

307 | 
NL80211_RRF_DFS


308 | 
NL80211_RRF_PASSIVE_SCAN
),

309 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

310 | 
NL80211_RRF_DFS


311 | 
NL80211_RRF_PASSIVE_SCAN
),

312 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

316 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BN
 = {

317 .
n_ªg_ruÀs
 = 4,

318 .
	gÆpha2
 = "BN",

319 .
	gªg_ruÀs
 = {

320 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

321 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

322 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

323 | 
NL80211_RRF_DFS


324 | 
NL80211_RRF_PASSIVE_SCAN
),

325 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 20, 0),

329 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_BG
 = {

330 .
n_ªg_ruÀs
 = 4,

331 .
	gÆpha2
 = "BG",

332 .
	gªg_ruÀs
 = {

333 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

334 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

335 | 
NL80211_RRF_NO_IBSS
),

336 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

337 | 
NL80211_RRF_DFS


338 | 
NL80211_RRF_PASSIVE_SCAN


339 | 
NL80211_RRF_NO_IBSS
),

340 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

341 | 
NL80211_RRF_DFS


342 | 
NL80211_RRF_PASSIVE_SCAN


343 | 
NL80211_RRF_NO_IBSS
),

347 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_KH
 = {

348 .
n_ªg_ruÀs
 = 4,

349 .
	gÆpha2
 = "KH",

350 .
	gªg_ruÀs
 = {

351 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

352 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

353 | 
NL80211_RRF_NO_IBSS
),

354 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

355 | 
NL80211_RRF_DFS


356 | 
NL80211_RRF_PASSIVE_SCAN


357 | 
NL80211_RRF_NO_IBSS
),

358 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

359 | 
NL80211_RRF_DFS


360 | 
NL80211_RRF_PASSIVE_SCAN


361 | 
NL80211_RRF_NO_IBSS
),

365 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_CA
 = {

366 .
n_ªg_ruÀs
 = 5,

367 .
	gÆpha2
 = "CA",

368 .
	gªg_ruÀs
 = {

369 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

370 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

371 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

372 | 
NL80211_RRF_DFS


373 | 
NL80211_RRF_PASSIVE_SCAN
),

374 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

375 | 
NL80211_RRF_DFS


376 | 
NL80211_RRF_PASSIVE_SCAN
),

377 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

381 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_C2
 = {

382 .
n_ªg_ruÀs
 = 6,

383 .
	gÆpha2
 = "C2",

384 .
	gªg_ruÀs
 = {

385 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

386 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

387 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

388 | 
NL80211_RRF_DFS


389 | 
NL80211_RRF_PASSIVE_SCAN
),

390 
REG_RULE
(5500 - 10, 5580 + 10, 40, 3, 23, 0

391 | 
NL80211_RRF_DFS


392 | 
NL80211_RRF_PASSIVE_SCAN
),

393 
REG_RULE
(5660 - 10, 5700 + 10, 40, 3, 23, 0

394 | 
NL80211_RRF_DFS


395 | 
NL80211_RRF_PASSIVE_SCAN
),

396 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

400 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_CL
 = {

401 .
n_ªg_ruÀs
 = 4,

402 .
	gÆpha2
 = "CL",

403 .
	gªg_ruÀs
 = {

404 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

405 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

406 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

407 | 
NL80211_RRF_DFS


408 | 
NL80211_RRF_PASSIVE_SCAN
),

409 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 20, 0),

413 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_CN
 = {

414 .
n_ªg_ruÀs
 = 2,

415 .
	gÆpha2
 = "CN",

416 .
	gªg_ruÀs
 = {

417 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

418 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

422 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_CO
 = {

423 .
n_ªg_ruÀs
 = 5,

424 .
	gÆpha2
 = "CO",

425 .
	gªg_ruÀs
 = {

426 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

427 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

428 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

429 | 
NL80211_RRF_DFS


430 | 
NL80211_RRF_PASSIVE_SCAN
),

431 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

432 | 
NL80211_RRF_DFS


433 | 
NL80211_RRF_PASSIVE_SCAN
),

434 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

438 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_CR
 = {

439 .
n_ªg_ruÀs
 = 4,

440 .
	gÆpha2
 = "CR",

441 .
	gªg_ruÀs
 = {

442 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

443 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 17, 0),

444 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 23, 0

445 | 
NL80211_RRF_DFS


446 | 
NL80211_RRF_PASSIVE_SCAN
),

447 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 30, 0),

451 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_HR
 = {

452 .
n_ªg_ruÀs
 = 4,

453 .
	gÆpha2
 = "HR",

454 .
	gªg_ruÀs
 = {

455 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

456 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

457 | 
NL80211_RRF_NO_IBSS
),

458 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

459 | 
NL80211_RRF_DFS


460 | 
NL80211_RRF_PASSIVE_SCAN


461 | 
NL80211_RRF_NO_IBSS
),

462 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

463 | 
NL80211_RRF_DFS


464 | 
NL80211_RRF_PASSIVE_SCAN


465 | 
NL80211_RRF_NO_IBSS
),

469 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_CY
 = {

470 .
n_ªg_ruÀs
 = 3,

471 .
	gÆpha2
 = "CY",

472 .
	gªg_ruÀs
 = {

473 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

474 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

475 | 
NL80211_RRF_NO_IBSS
),

476 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

477 | 
NL80211_RRF_DFS


478 | 
NL80211_RRF_PASSIVE_SCAN


479 | 
NL80211_RRF_NO_IBSS
),

483 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_CZ
 = {

484 .
n_ªg_ruÀs
 = 4,

485 .
	gÆpha2
 = "CZ",

486 .
	gªg_ruÀs
 = {

487 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

488 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

489 | 
NL80211_RRF_NO_IBSS
),

490 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

491 | 
NL80211_RRF_DFS


492 | 
NL80211_RRF_PASSIVE_SCAN


493 | 
NL80211_RRF_NO_IBSS
),

494 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

495 | 
NL80211_RRF_DFS


496 | 
NL80211_RRF_PASSIVE_SCAN


497 | 
NL80211_RRF_NO_IBSS
),

501 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_DK
 = {

502 .
n_ªg_ruÀs
 = 4,

503 .
	gÆpha2
 = "DK",

504 .
	gªg_ruÀs
 = {

505 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

506 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

507 | 
NL80211_RRF_NO_IBSS
),

508 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

509 | 
NL80211_RRF_DFS


510 | 
NL80211_RRF_PASSIVE_SCAN


511 | 
NL80211_RRF_NO_IBSS
),

512 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

513 | 
NL80211_RRF_DFS


514 | 
NL80211_RRF_PASSIVE_SCAN


515 | 
NL80211_RRF_NO_IBSS
),

519 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_DO
 = {

520 .
n_ªg_ruÀs
 = 4,

521 .
	gÆpha2
 = "DO",

522 .
	gªg_ruÀs
 = {

523 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

524 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

525 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

526 | 
NL80211_RRF_DFS


527 | 
NL80211_RRF_PASSIVE_SCAN
),

528 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

532 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_EC
 = {

533 .
n_ªg_ruÀs
 = 4,

534 .
	gÆpha2
 = "EC",

535 .
	gªg_ruÀs
 = {

536 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

537 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 17, 0),

538 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 23, 0

539 | 
NL80211_RRF_DFS


540 | 
NL80211_RRF_PASSIVE_SCAN
),

541 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 30, 0),

545 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_EG
 = {

546 .
n_ªg_ruÀs
 = 3,

547 .
	gÆpha2
 = "EG",

548 .
	gªg_ruÀs
 = {

549 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

550 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 20, 0

551 | 
NL80211_RRF_NO_IBSS
),

552 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

553 | 
NL80211_RRF_DFS


554 | 
NL80211_RRF_PASSIVE_SCAN


555 | 
NL80211_RRF_NO_IBSS
),

559 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_SV
 = {

560 .
n_ªg_ruÀs
 = 4,

561 .
	gÆpha2
 = "SV",

562 .
	gªg_ruÀs
 = {

563 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

564 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 17, 0),

565 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 23, 0

566 | 
NL80211_RRF_DFS


567 | 
NL80211_RRF_PASSIVE_SCAN
),

568 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 30, 0),

572 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_EE
 = {

573 .
n_ªg_ruÀs
 = 4,

574 .
	gÆpha2
 = "EE",

575 .
	gªg_ruÀs
 = {

576 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

577 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

578 | 
NL80211_RRF_NO_IBSS
),

579 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

580 | 
NL80211_RRF_DFS


581 | 
NL80211_RRF_PASSIVE_SCAN


582 | 
NL80211_RRF_NO_IBSS
),

583 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

584 | 
NL80211_RRF_DFS


585 | 
NL80211_RRF_PASSIVE_SCAN


586 | 
NL80211_RRF_NO_IBSS
),

590 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_FI
 = {

591 .
n_ªg_ruÀs
 = 4,

592 .
	gÆpha2
 = "FI",

593 .
	gªg_ruÀs
 = {

594 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

595 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

596 | 
NL80211_RRF_NO_IBSS
),

597 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

598 | 
NL80211_RRF_DFS


599 | 
NL80211_RRF_PASSIVE_SCAN


600 | 
NL80211_RRF_NO_IBSS
),

601 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

602 | 
NL80211_RRF_DFS


603 | 
NL80211_RRF_PASSIVE_SCAN


604 | 
NL80211_RRF_NO_IBSS
),

608 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_FR
 = {

609 .
n_ªg_ruÀs
 = 4,

610 .
	gÆpha2
 = "FR",

611 .
	gªg_ruÀs
 = {

612 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

613 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

614 | 
NL80211_RRF_NO_IBSS
),

615 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

616 | 
NL80211_RRF_DFS


617 | 
NL80211_RRF_PASSIVE_SCAN


618 | 
NL80211_RRF_NO_IBSS
),

619 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

620 | 
NL80211_RRF_DFS


621 | 
NL80211_RRF_PASSIVE_SCAN


622 | 
NL80211_RRF_NO_IBSS
),

626 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_F2
 = {

627 .
n_ªg_ruÀs
 = 3,

628 .
	gÆpha2
 = "F2",

629 .
	gªg_ruÀs
 = {

630 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

631 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

632 | 
NL80211_RRF_NO_IBSS
),

633 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

634 | 
NL80211_RRF_DFS


635 | 
NL80211_RRF_PASSIVE_SCAN


636 | 
NL80211_RRF_NO_IBSS
),

640 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_GE
 = {

641 .
n_ªg_ruÀs
 = 3,

642 .
	gÆpha2
 = "GE",

643 .
	gªg_ruÀs
 = {

644 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

645 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 18, 0

646 | 
NL80211_RRF_NO_IBSS
),

647 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

648 | 
NL80211_RRF_DFS


649 | 
NL80211_RRF_PASSIVE_SCAN


650 | 
NL80211_RRF_NO_IBSS
),

654 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_DE
 = {

655 .
n_ªg_ruÀs
 = 4,

656 .
	gÆpha2
 = "DE",

657 .
	gªg_ruÀs
 = {

658 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

659 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

660 | 
NL80211_RRF_NO_IBSS
),

661 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

662 | 
NL80211_RRF_DFS


663 | 
NL80211_RRF_PASSIVE_SCAN


664 | 
NL80211_RRF_NO_IBSS
),

665 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

666 | 
NL80211_RRF_DFS


667 | 
NL80211_RRF_PASSIVE_SCAN


668 | 
NL80211_RRF_NO_IBSS
),

672 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_GR
 = {

673 .
n_ªg_ruÀs
 = 4,

674 .
	gÆpha2
 = "GR",

675 .
	gªg_ruÀs
 = {

676 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

677 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

678 | 
NL80211_RRF_NO_IBSS
),

679 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

680 | 
NL80211_RRF_DFS


681 | 
NL80211_RRF_PASSIVE_SCAN


682 | 
NL80211_RRF_NO_IBSS
),

683 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

684 | 
NL80211_RRF_DFS


685 | 
NL80211_RRF_PASSIVE_SCAN


686 | 
NL80211_RRF_NO_IBSS
),

690 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_GL
 = {

691 .
n_ªg_ruÀs
 = 4,

692 .
	gÆpha2
 = "GL",

693 .
	gªg_ruÀs
 = {

694 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

695 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 20, 0

696 | 
NL80211_RRF_NO_IBSS
),

697 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

698 | 
NL80211_RRF_DFS


699 | 
NL80211_RRF_PASSIVE_SCAN


700 | 
NL80211_RRF_NO_IBSS
),

701 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 27, 0

702 | 
NL80211_RRF_DFS


703 | 
NL80211_RRF_PASSIVE_SCAN


704 | 
NL80211_RRF_NO_IBSS
),

708 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_GD
 = {

709 .
n_ªg_ruÀs
 = 5,

710 .
	gÆpha2
 = "GD",

711 .
	gªg_ruÀs
 = {

712 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

713 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

714 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

715 | 
NL80211_RRF_DFS


716 | 
NL80211_RRF_PASSIVE_SCAN
),

717 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

718 | 
NL80211_RRF_DFS


719 | 
NL80211_RRF_PASSIVE_SCAN
),

720 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

724 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_GU
 = {

725 .
n_ªg_ruÀs
 = 4,

726 .
	gÆpha2
 = "GU",

727 .
	gªg_ruÀs
 = {

728 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

729 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 17, 0),

730 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 23, 0

731 | 
NL80211_RRF_DFS


732 | 
NL80211_RRF_PASSIVE_SCAN
),

733 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 30, 0),

737 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_GT
 = {

738 .
n_ªg_ruÀs
 = 4,

739 .
	gÆpha2
 = "GT",

740 .
	gªg_ruÀs
 = {

741 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

742 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

743 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

744 | 
NL80211_RRF_DFS


745 | 
NL80211_RRF_PASSIVE_SCAN
),

746 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

750 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_HT
 = {

751 .
n_ªg_ruÀs
 = 4,

752 .
	gÆpha2
 = "HT",

753 .
	gªg_ruÀs
 = {

754 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

755 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

756 | 
NL80211_RRF_NO_IBSS
),

757 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

758 | 
NL80211_RRF_DFS


759 | 
NL80211_RRF_PASSIVE_SCAN


760 | 
NL80211_RRF_NO_IBSS
),

761 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

762 | 
NL80211_RRF_DFS


763 | 
NL80211_RRF_PASSIVE_SCAN


764 | 
NL80211_RRF_NO_IBSS
),

768 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_HN
 = {

769 .
n_ªg_ruÀs
 = 5,

770 .
	gÆpha2
 = "HN",

771 .
	gªg_ruÀs
 = {

772 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

773 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

774 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

775 | 
NL80211_RRF_DFS


776 | 
NL80211_RRF_PASSIVE_SCAN
),

777 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

778 | 
NL80211_RRF_DFS


779 | 
NL80211_RRF_PASSIVE_SCAN
),

780 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

784 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_HK
 = {

785 .
n_ªg_ruÀs
 = 5,

786 .
	gÆpha2
 = "HK",

787 .
	gªg_ruÀs
 = {

788 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

789 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

790 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

791 | 
NL80211_RRF_DFS


792 | 
NL80211_RRF_PASSIVE_SCAN
),

793 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

794 | 
NL80211_RRF_DFS


795 | 
NL80211_RRF_PASSIVE_SCAN
),

796 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

800 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_HU
 = {

801 .
n_ªg_ruÀs
 = 4,

802 .
	gÆpha2
 = "HU",

803 .
	gªg_ruÀs
 = {

804 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

805 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

806 | 
NL80211_RRF_NO_IBSS
),

807 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

808 | 
NL80211_RRF_DFS


809 | 
NL80211_RRF_PASSIVE_SCAN


810 | 
NL80211_RRF_NO_IBSS
),

811 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

812 | 
NL80211_RRF_DFS


813 | 
NL80211_RRF_PASSIVE_SCAN


814 | 
NL80211_RRF_NO_IBSS
),

818 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_IS
 = {

819 .
n_ªg_ruÀs
 = 4,

820 .
	gÆpha2
 = "IS",

821 .
	gªg_ruÀs
 = {

822 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

823 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

824 | 
NL80211_RRF_NO_IBSS
),

825 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

826 | 
NL80211_RRF_DFS


827 | 
NL80211_RRF_PASSIVE_SCAN


828 | 
NL80211_RRF_NO_IBSS
),

829 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

830 | 
NL80211_RRF_DFS


831 | 
NL80211_RRF_PASSIVE_SCAN


832 | 
NL80211_RRF_NO_IBSS
),

836 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_IN
 = {

837 .
n_ªg_ruÀs
 = 4,

838 .
	gÆpha2
 = "IN",

839 .
	gªg_ruÀs
 = {

840 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

841 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

842 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

843 | 
NL80211_RRF_DFS


844 | 
NL80211_RRF_PASSIVE_SCAN
),

845 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 20, 0),

849 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_ID
 = {

850 .
n_ªg_ruÀs
 = 2,

851 .
	gÆpha2
 = "ID",

852 .
	gªg_ruÀs
 = {

853 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

854 
REG_RULE
(5745 - 10, 5805 + 10, 20, 3, 23, 0),

858 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_IR
 = {

859 .
n_ªg_ruÀs
 = 2,

860 .
	gÆpha2
 = "IR",

861 .
	gªg_ruÀs
 = {

862 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

863 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

867 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_IE
 = {

868 .
n_ªg_ruÀs
 = 4,

869 .
	gÆpha2
 = "IE",

870 .
	gªg_ruÀs
 = {

871 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

872 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

873 | 
NL80211_RRF_NO_IBSS
),

874 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

875 | 
NL80211_RRF_DFS


876 | 
NL80211_RRF_PASSIVE_SCAN


877 | 
NL80211_RRF_NO_IBSS
),

878 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

879 | 
NL80211_RRF_DFS


880 | 
NL80211_RRF_PASSIVE_SCAN


881 | 
NL80211_RRF_NO_IBSS
),

885 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_IL
 = {

886 .
n_ªg_ruÀs
 = 3,

887 .
	gÆpha2
 = "IL",

888 .
	gªg_ruÀs
 = {

889 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

890 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

891 | 
NL80211_RRF_NO_IBSS
),

892 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

893 | 
NL80211_RRF_DFS


894 | 
NL80211_RRF_PASSIVE_SCAN


895 | 
NL80211_RRF_NO_IBSS
),

899 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_IT
 = {

900 .
n_ªg_ruÀs
 = 4,

901 .
	gÆpha2
 = "IT",

902 .
	gªg_ruÀs
 = {

903 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

904 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

905 | 
NL80211_RRF_NO_IBSS
),

906 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

907 | 
NL80211_RRF_DFS


908 | 
NL80211_RRF_PASSIVE_SCAN


909 | 
NL80211_RRF_NO_IBSS
),

910 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

911 | 
NL80211_RRF_DFS


912 | 
NL80211_RRF_PASSIVE_SCAN


913 | 
NL80211_RRF_NO_IBSS
),

917 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_JM
 = {

918 .
n_ªg_ruÀs
 = 5,

919 .
	gÆpha2
 = "JM",

920 .
	gªg_ruÀs
 = {

921 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

922 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

923 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

924 | 
NL80211_RRF_DFS


925 | 
NL80211_RRF_PASSIVE_SCAN
),

926 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

927 | 
NL80211_RRF_DFS


928 | 
NL80211_RRF_PASSIVE_SCAN
),

929 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

933 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_JP
 = {

934 .
n_ªg_ruÀs
 = 6,

935 .
	gÆpha2
 = "JP",

936 .
	gªg_ruÀs
 = {

937 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 20, 0),

938 
REG_RULE
(2467 - 10, 2472 + 10, 20, 3, 20, 0),

939 
REG_RULE
(2484 - 10, 2484 + 10, 20, 3, 20, 0),

940 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

941 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

942 | 
NL80211_RRF_DFS


943 | 
NL80211_RRF_PASSIVE_SCAN
),

944 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 20, 0

945 | 
NL80211_RRF_DFS


946 | 
NL80211_RRF_PASSIVE_SCAN
),

950 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_JO
 = {

951 .
n_ªg_ruÀs
 = 3,

952 .
	gÆpha2
 = "JO",

953 .
	gªg_ruÀs
 = {

954 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

955 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

956 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 23, 0),

960 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_KZ
 = {

961 .
n_ªg_ruÀs
 = 1,

962 .
	gÆpha2
 = "KZ",

963 .
	gªg_ruÀs
 = {

964 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

968 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_KE
 = {

969 .
n_ªg_ruÀs
 = 4,

970 .
	gÆpha2
 = "KE",

971 .
	gªg_ruÀs
 = {

972 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

973 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

974 
REG_RULE
(5500 - 10, 5560 + 10, 40, 3, 30, 0

975 | 
NL80211_RRF_DFS


976 | 
NL80211_RRF_PASSIVE_SCAN
),

977 
REG_RULE
(5745 - 10, 5765 + 10, 40, 3, 23, 0),

981 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_KP
 = {

982 .
n_ªg_ruÀs
 = 5,

983 .
	gÆpha2
 = "KP",

984 .
	gªg_ruÀs
 = {

985 
REG_RULE
(2412 - 10, 2472 + 10, 20, 3, 20, 0),

986 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 20, 0),

987 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

988 | 
NL80211_RRF_DFS


989 | 
NL80211_RRF_PASSIVE_SCAN
),

990 
REG_RULE
(5500 - 10, 5620 + 10, 20, 3, 30, 0

991 | 
NL80211_RRF_DFS


992 | 
NL80211_RRF_PASSIVE_SCAN
),

993 
REG_RULE
(5745 - 10, 5805 + 10, 20, 3, 30, 0),

997 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_KR
 = {

998 .
n_ªg_ruÀs
 = 5,

999 .
	gÆpha2
 = "KR",

1000 .
	gªg_ruÀs
 = {

1001 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1002 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

1003 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1004 | 
NL80211_RRF_DFS


1005 | 
NL80211_RRF_PASSIVE_SCAN
),

1006 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 30, 0

1007 | 
NL80211_RRF_DFS


1008 | 
NL80211_RRF_PASSIVE_SCAN
),

1009 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 30, 0),

1013 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_K2
 = {

1014 .
n_ªg_ruÀs
 = 3,

1015 .
	gÆpha2
 = "K2",

1016 .
	gªg_ruÀs
 = {

1017 
REG_RULE
(2312 - 10, 2372 + 10, 20, 3, 20, 0),

1018 
REG_RULE
(2412 - 10, 2472 + 10, 20, 3, 20, 0),

1019 
REG_RULE
(5745 - 10, 5805 + 10, 20, 3, 23, 0),

1023 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_K3
 = {

1024 .
n_ªg_ruÀs
 = 5,

1025 .
	gÆpha2
 = "K3",

1026 .
	gªg_ruÀs
 = {

1027 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1028 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

1029 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

1030 | 
NL80211_RRF_DFS


1031 | 
NL80211_RRF_PASSIVE_SCAN
),

1032 
REG_RULE
(5500 - 10, 5620 + 10, 20, 3, 30, 0

1033 | 
NL80211_RRF_DFS


1034 | 
NL80211_RRF_PASSIVE_SCAN
),

1035 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 30, 0),

1039 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_KW
 = {

1040 .
n_ªg_ruÀs
 = 3,

1041 .
	gÆpha2
 = "KW",

1042 .
	gªg_ruÀs
 = {

1043 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1044 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1045 | 
NL80211_RRF_NO_IBSS
),

1046 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

1047 | 
NL80211_RRF_DFS


1048 | 
NL80211_RRF_PASSIVE_SCAN


1049 | 
NL80211_RRF_NO_IBSS
),

1053 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_LV
 = {

1054 .
n_ªg_ruÀs
 = 4,

1055 .
	gÆpha2
 = "LV",

1056 .
	gªg_ruÀs
 = {

1057 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1058 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1059 | 
NL80211_RRF_NO_IBSS
),

1060 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1061 | 
NL80211_RRF_DFS


1062 | 
NL80211_RRF_PASSIVE_SCAN


1063 | 
NL80211_RRF_NO_IBSS
),

1064 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1065 | 
NL80211_RRF_DFS


1066 | 
NL80211_RRF_PASSIVE_SCAN


1067 | 
NL80211_RRF_NO_IBSS
),

1071 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_LB
 = {

1072 .
n_ªg_ruÀs
 = 5,

1073 .
	gÆpha2
 = "LB",

1074 .
	gªg_ruÀs
 = {

1075 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1076 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1077 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1078 | 
NL80211_RRF_DFS


1079 | 
NL80211_RRF_PASSIVE_SCAN
),

1080 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1081 | 
NL80211_RRF_DFS


1082 | 
NL80211_RRF_PASSIVE_SCAN
),

1083 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1087 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_LI
 = {

1088 .
n_ªg_ruÀs
 = 4,

1089 .
	gÆpha2
 = "LI",

1090 .
	gªg_ruÀs
 = {

1091 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1092 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1093 | 
NL80211_RRF_NO_IBSS
),

1094 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1095 | 
NL80211_RRF_DFS


1096 | 
NL80211_RRF_PASSIVE_SCAN


1097 | 
NL80211_RRF_NO_IBSS
),

1098 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1099 | 
NL80211_RRF_DFS


1100 | 
NL80211_RRF_PASSIVE_SCAN


1101 | 
NL80211_RRF_NO_IBSS
),

1105 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_LT
 = {

1106 .
n_ªg_ruÀs
 = 4,

1107 .
	gÆpha2
 = "LT",

1108 .
	gªg_ruÀs
 = {

1109 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1110 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1111 | 
NL80211_RRF_NO_IBSS
),

1112 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1113 | 
NL80211_RRF_DFS


1114 | 
NL80211_RRF_PASSIVE_SCAN


1115 | 
NL80211_RRF_NO_IBSS
),

1116 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1117 | 
NL80211_RRF_DFS


1118 | 
NL80211_RRF_PASSIVE_SCAN


1119 | 
NL80211_RRF_NO_IBSS
),

1123 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_LU
 = {

1124 .
n_ªg_ruÀs
 = 4,

1125 .
	gÆpha2
 = "LU",

1126 .
	gªg_ruÀs
 = {

1127 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1128 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1129 | 
NL80211_RRF_NO_IBSS
),

1130 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1131 | 
NL80211_RRF_DFS


1132 | 
NL80211_RRF_PASSIVE_SCAN


1133 | 
NL80211_RRF_NO_IBSS
),

1134 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1135 | 
NL80211_RRF_DFS


1136 | 
NL80211_RRF_PASSIVE_SCAN


1137 | 
NL80211_RRF_NO_IBSS
),

1141 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_MO
 = {

1142 .
n_ªg_ruÀs
 = 2,

1143 .
	gÆpha2
 = "MO",

1144 .
	gªg_ruÀs
 = {

1145 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1146 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1150 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_MK
 = {

1151 .
n_ªg_ruÀs
 = 4,

1152 .
	gÆpha2
 = "MK",

1153 .
	gªg_ruÀs
 = {

1154 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1155 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1156 | 
NL80211_RRF_NO_IBSS
),

1157 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1158 | 
NL80211_RRF_DFS


1159 | 
NL80211_RRF_PASSIVE_SCAN


1160 | 
NL80211_RRF_NO_IBSS
),

1161 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1162 | 
NL80211_RRF_DFS


1163 | 
NL80211_RRF_PASSIVE_SCAN


1164 | 
NL80211_RRF_NO_IBSS
),

1168 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_MW
 = {

1169 .
n_ªg_ruÀs
 = 4,

1170 .
	gÆpha2
 = "MW",

1171 .
	gªg_ruÀs
 = {

1172 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1173 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1174 | 
NL80211_RRF_NO_IBSS
),

1175 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1176 | 
NL80211_RRF_DFS


1177 | 
NL80211_RRF_PASSIVE_SCAN


1178 | 
NL80211_RRF_NO_IBSS
),

1179 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1180 | 
NL80211_RRF_DFS


1181 | 
NL80211_RRF_PASSIVE_SCAN


1182 | 
NL80211_RRF_NO_IBSS
),

1186 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_MY
 = {

1187 .
n_ªg_ruÀs
 = 4,

1188 .
	gÆpha2
 = "MY",

1189 .
	gªg_ruÀs
 = {

1190 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1191 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1192 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

1193 | 
NL80211_RRF_DFS


1194 | 
NL80211_RRF_PASSIVE_SCAN
),

1195 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1199 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_MT
 = {

1200 .
n_ªg_ruÀs
 = 4,

1201 .
	gÆpha2
 = "MT",

1202 .
	gªg_ruÀs
 = {

1203 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1204 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1205 | 
NL80211_RRF_NO_IBSS
),

1206 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1207 | 
NL80211_RRF_DFS


1208 | 
NL80211_RRF_PASSIVE_SCAN


1209 | 
NL80211_RRF_NO_IBSS
),

1210 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1211 | 
NL80211_RRF_DFS


1212 | 
NL80211_RRF_PASSIVE_SCAN


1213 | 
NL80211_RRF_NO_IBSS
),

1217 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_MX
 = {

1218 .
n_ªg_ruÀs
 = 4,

1219 .
	gÆpha2
 = "MX",

1220 .
	gªg_ruÀs
 = {

1221 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1222 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1223 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

1224 | 
NL80211_RRF_DFS


1225 | 
NL80211_RRF_PASSIVE_SCAN
),

1226 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1230 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_MC
 = {

1231 .
n_ªg_ruÀs
 = 3,

1232 .
	gÆpha2
 = "MC",

1233 .
	gªg_ruÀs
 = {

1234 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1235 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 18, 0

1236 | 
NL80211_RRF_NO_IBSS
),

1237 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

1238 | 
NL80211_RRF_DFS


1239 | 
NL80211_RRF_PASSIVE_SCAN


1240 | 
NL80211_RRF_NO_IBSS
),

1244 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_MA
 = {

1245 .
n_ªg_ruÀs
 = 3,

1246 .
	gÆpha2
 = "MA",

1247 .
	gªg_ruÀs
 = {

1248 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1249 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

1250 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 23, 0),

1254 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_NP
 = {

1255 .
n_ªg_ruÀs
 = 4,

1256 .
	gÆpha2
 = "NP",

1257 .
	gªg_ruÀs
 = {

1258 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1259 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

1260 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1261 | 
NL80211_RRF_DFS


1262 | 
NL80211_RRF_PASSIVE_SCAN
),

1263 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 20, 0),

1267 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_NZ
 = {

1268 .
n_ªg_ruÀs
 = 5,

1269 .
	gÆpha2
 = "NZ",

1270 .
	gªg_ruÀs
 = {

1271 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 30, 0),

1272 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1273 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1274 | 
NL80211_RRF_DFS


1275 | 
NL80211_RRF_PASSIVE_SCAN
),

1276 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1277 | 
NL80211_RRF_DFS


1278 | 
NL80211_RRF_PASSIVE_SCAN
),

1279 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1283 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_NL
 = {

1284 .
n_ªg_ruÀs
 = 4,

1285 .
	gÆpha2
 = "NL",

1286 .
	gªg_ruÀs
 = {

1287 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1288 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1289 | 
NL80211_RRF_NO_IBSS
),

1290 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1291 | 
NL80211_RRF_DFS


1292 | 
NL80211_RRF_PASSIVE_SCAN


1293 | 
NL80211_RRF_NO_IBSS
),

1294 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1295 | 
NL80211_RRF_DFS


1296 | 
NL80211_RRF_PASSIVE_SCAN


1297 | 
NL80211_RRF_NO_IBSS
),

1301 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_AN
 = {

1302 .
n_ªg_ruÀs
 = 4,

1303 .
	gÆpha2
 = "AN",

1304 .
	gªg_ruÀs
 = {

1305 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1306 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1307 | 
NL80211_RRF_NO_IBSS
),

1308 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1309 | 
NL80211_RRF_DFS


1310 | 
NL80211_RRF_PASSIVE_SCAN


1311 | 
NL80211_RRF_NO_IBSS
),

1312 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1313 | 
NL80211_RRF_DFS


1314 | 
NL80211_RRF_PASSIVE_SCAN


1315 | 
NL80211_RRF_NO_IBSS
),

1319 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_NO
 = {

1320 .
n_ªg_ruÀs
 = 4,

1321 .
	gÆpha2
 = "NO",

1322 .
	gªg_ruÀs
 = {

1323 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1324 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1325 | 
NL80211_RRF_NO_IBSS
),

1326 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1327 | 
NL80211_RRF_DFS


1328 | 
NL80211_RRF_PASSIVE_SCAN


1329 | 
NL80211_RRF_NO_IBSS
),

1330 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1331 | 
NL80211_RRF_DFS


1332 | 
NL80211_RRF_PASSIVE_SCAN


1333 | 
NL80211_RRF_NO_IBSS
),

1337 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_OM
 = {

1338 .
n_ªg_ruÀs
 = 5,

1339 .
	gÆpha2
 = "OM",

1340 .
	gªg_ruÀs
 = {

1341 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1342 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1343 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1344 | 
NL80211_RRF_DFS


1345 | 
NL80211_RRF_PASSIVE_SCAN
),

1346 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1347 | 
NL80211_RRF_DFS


1348 | 
NL80211_RRF_PASSIVE_SCAN
),

1349 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1353 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_PK
 = {

1354 .
n_ªg_ruÀs
 = 2,

1355 .
	gÆpha2
 = "PK",

1356 .
	gªg_ruÀs
 = {

1357 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1358 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1362 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_PA
 = {

1363 .
n_ªg_ruÀs
 = 4,

1364 .
	gÆpha2
 = "PA",

1365 .
	gªg_ruÀs
 = {

1366 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

1367 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1368 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

1369 | 
NL80211_RRF_DFS


1370 | 
NL80211_RRF_PASSIVE_SCAN
),

1371 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1375 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_PE
 = {

1376 .
n_ªg_ruÀs
 = 5,

1377 .
	gÆpha2
 = "PE",

1378 .
	gªg_ruÀs
 = {

1379 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1380 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1381 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1382 | 
NL80211_RRF_DFS


1383 | 
NL80211_RRF_PASSIVE_SCAN
),

1384 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1385 | 
NL80211_RRF_DFS


1386 | 
NL80211_RRF_PASSIVE_SCAN
),

1387 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1391 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_PH
 = {

1392 .
n_ªg_ruÀs
 = 5,

1393 .
	gÆpha2
 = "PH",

1394 .
	gªg_ruÀs
 = {

1395 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1396 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1397 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1398 | 
NL80211_RRF_DFS


1399 | 
NL80211_RRF_PASSIVE_SCAN
),

1400 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1401 | 
NL80211_RRF_DFS


1402 | 
NL80211_RRF_PASSIVE_SCAN
),

1403 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1407 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_PL
 = {

1408 .
n_ªg_ruÀs
 = 4,

1409 .
	gÆpha2
 = "PL",

1410 .
	gªg_ruÀs
 = {

1411 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1412 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1413 | 
NL80211_RRF_NO_IBSS
),

1414 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1415 | 
NL80211_RRF_DFS


1416 | 
NL80211_RRF_PASSIVE_SCAN


1417 | 
NL80211_RRF_NO_IBSS
),

1418 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1419 | 
NL80211_RRF_DFS


1420 | 
NL80211_RRF_PASSIVE_SCAN


1421 | 
NL80211_RRF_NO_IBSS
),

1425 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_PT
 = {

1426 .
n_ªg_ruÀs
 = 4,

1427 .
	gÆpha2
 = "PT",

1428 .
	gªg_ruÀs
 = {

1429 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1430 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1431 | 
NL80211_RRF_NO_IBSS
),

1432 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1433 | 
NL80211_RRF_DFS


1434 | 
NL80211_RRF_PASSIVE_SCAN


1435 | 
NL80211_RRF_NO_IBSS
),

1436 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1437 | 
NL80211_RRF_DFS


1438 | 
NL80211_RRF_PASSIVE_SCAN


1439 | 
NL80211_RRF_NO_IBSS
),

1443 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_PR
 = {

1444 .
n_ªg_ruÀs
 = 5,

1445 .
	gÆpha2
 = "PR",

1446 .
	gªg_ruÀs
 = {

1447 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

1448 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1449 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1450 | 
NL80211_RRF_DFS


1451 | 
NL80211_RRF_PASSIVE_SCAN
),

1452 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1453 | 
NL80211_RRF_DFS


1454 | 
NL80211_RRF_PASSIVE_SCAN
),

1455 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1459 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_QA
 = {

1460 .
n_ªg_ruÀs
 = 2,

1461 .
	gÆpha2
 = "QA",

1462 .
	gªg_ruÀs
 = {

1463 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1464 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1468 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_RO
 = {

1469 .
n_ªg_ruÀs
 = 4,

1470 .
	gÆpha2
 = "RO",

1471 .
	gªg_ruÀs
 = {

1472 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1473 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1474 | 
NL80211_RRF_NO_IBSS
),

1475 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1476 | 
NL80211_RRF_DFS


1477 | 
NL80211_RRF_PASSIVE_SCAN


1478 | 
NL80211_RRF_NO_IBSS
),

1479 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1480 | 
NL80211_RRF_DFS


1481 | 
NL80211_RRF_PASSIVE_SCAN


1482 | 
NL80211_RRF_NO_IBSS
),

1486 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_RU
 = {

1487 .
n_ªg_ruÀs
 = 5,

1488 .
	gÆpha2
 = "RU",

1489 .
	gªg_ruÀs
 = {

1490 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1491 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1492 | 
NL80211_RRF_NO_IBSS
),

1493 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1494 | 
NL80211_RRF_DFS


1495 | 
NL80211_RRF_PASSIVE_SCAN


1496 | 
NL80211_RRF_NO_IBSS
),

1497 
REG_RULE
(5660 - 10, 5700 + 10, 40, 3, 20, 0

1498 | 
NL80211_RRF_DFS


1499 | 
NL80211_RRF_PASSIVE_SCAN


1500 | 
NL80211_RRF_NO_IBSS
),

1501 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 20, 0

1502 | 
NL80211_RRF_NO_IBSS
),

1506 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_RW
 = {

1507 .
n_ªg_ruÀs
 = 5,

1508 .
	gÆpha2
 = "RW",

1509 .
	gªg_ruÀs
 = {

1510 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1511 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1512 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1513 | 
NL80211_RRF_DFS


1514 | 
NL80211_RRF_PASSIVE_SCAN
),

1515 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1516 | 
NL80211_RRF_DFS


1517 | 
NL80211_RRF_PASSIVE_SCAN
),

1518 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1522 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_SA
 = {

1523 .
n_ªg_ruÀs
 = 5,

1524 .
	gÆpha2
 = "SA",

1525 .
	gªg_ruÀs
 = {

1526 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1527 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1528 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1529 | 
NL80211_RRF_DFS


1530 | 
NL80211_RRF_PASSIVE_SCAN
),

1531 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1532 | 
NL80211_RRF_DFS


1533 | 
NL80211_RRF_PASSIVE_SCAN
),

1534 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1538 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_ME
 = {

1539 .
n_ªg_ruÀs
 = 4,

1540 .
	gÆpha2
 = "ME",

1541 .
	gªg_ruÀs
 = {

1542 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1543 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1544 | 
NL80211_RRF_NO_IBSS
),

1545 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1546 | 
NL80211_RRF_DFS


1547 | 
NL80211_RRF_PASSIVE_SCAN


1548 | 
NL80211_RRF_NO_IBSS
),

1549 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1550 | 
NL80211_RRF_DFS


1551 | 
NL80211_RRF_PASSIVE_SCAN


1552 | 
NL80211_RRF_NO_IBSS
),

1556 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_RS
 = {

1557 .
n_ªg_ruÀs
 = 4,

1558 .
	gÆpha2
 = "RS",

1559 .
	gªg_ruÀs
 = {

1560 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1561 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1562 | 
NL80211_RRF_NO_IBSS
),

1563 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1564 | 
NL80211_RRF_DFS


1565 | 
NL80211_RRF_PASSIVE_SCAN


1566 | 
NL80211_RRF_NO_IBSS
),

1567 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1568 | 
NL80211_RRF_DFS


1569 | 
NL80211_RRF_PASSIVE_SCAN


1570 | 
NL80211_RRF_NO_IBSS
),

1574 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_SG
 = {

1575 .
n_ªg_ruÀs
 = 5,

1576 .
	gÆpha2
 = "SG",

1577 .
	gªg_ruÀs
 = {

1578 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1579 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1580 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1581 | 
NL80211_RRF_DFS


1582 | 
NL80211_RRF_PASSIVE_SCAN
),

1583 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1584 | 
NL80211_RRF_DFS


1585 | 
NL80211_RRF_PASSIVE_SCAN
),

1586 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1590 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_SK
 = {

1591 .
n_ªg_ruÀs
 = 4,

1592 .
	gÆpha2
 = "SK",

1593 .
	gªg_ruÀs
 = {

1594 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1595 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1596 | 
NL80211_RRF_NO_IBSS
),

1597 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1598 | 
NL80211_RRF_DFS


1599 | 
NL80211_RRF_PASSIVE_SCAN


1600 | 
NL80211_RRF_NO_IBSS
),

1601 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1602 | 
NL80211_RRF_DFS


1603 | 
NL80211_RRF_PASSIVE_SCAN


1604 | 
NL80211_RRF_NO_IBSS
),

1608 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_SI
 = {

1609 .
n_ªg_ruÀs
 = 4,

1610 .
	gÆpha2
 = "SI",

1611 .
	gªg_ruÀs
 = {

1612 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1613 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1614 | 
NL80211_RRF_NO_IBSS
),

1615 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1616 | 
NL80211_RRF_DFS


1617 | 
NL80211_RRF_PASSIVE_SCAN


1618 | 
NL80211_RRF_NO_IBSS
),

1619 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1620 | 
NL80211_RRF_DFS


1621 | 
NL80211_RRF_PASSIVE_SCAN


1622 | 
NL80211_RRF_NO_IBSS
),

1626 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_ZA
 = {

1627 .
n_ªg_ruÀs
 = 5,

1628 .
	gÆpha2
 = "ZA",

1629 .
	gªg_ruÀs
 = {

1630 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1631 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1632 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1633 | 
NL80211_RRF_DFS


1634 | 
NL80211_RRF_PASSIVE_SCAN
),

1635 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1636 | 
NL80211_RRF_DFS


1637 | 
NL80211_RRF_PASSIVE_SCAN
),

1638 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1642 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_ES
 = {

1643 .
n_ªg_ruÀs
 = 4,

1644 .
	gÆpha2
 = "ES",

1645 .
	gªg_ruÀs
 = {

1646 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1647 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1648 | 
NL80211_RRF_NO_IBSS
),

1649 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1650 | 
NL80211_RRF_DFS


1651 | 
NL80211_RRF_PASSIVE_SCAN


1652 | 
NL80211_RRF_NO_IBSS
),

1653 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1654 | 
NL80211_RRF_DFS


1655 | 
NL80211_RRF_PASSIVE_SCAN


1656 | 
NL80211_RRF_NO_IBSS
),

1660 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_LK
 = {

1661 .
n_ªg_ruÀs
 = 5,

1662 .
	gÆpha2
 = "LK",

1663 .
	gªg_ruÀs
 = {

1664 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1665 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 17, 0),

1666 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 24, 0

1667 | 
NL80211_RRF_DFS


1668 | 
NL80211_RRF_PASSIVE_SCAN
),

1669 
REG_RULE
(5500 - 10, 5720 + 10, 20, 3, 24, 0

1670 | 
NL80211_RRF_DFS


1671 | 
NL80211_RRF_PASSIVE_SCAN
),

1672 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 30, 0),

1676 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_SE
 = {

1677 .
n_ªg_ruÀs
 = 4,

1678 .
	gÆpha2
 = "SE",

1679 .
	gªg_ruÀs
 = {

1680 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1681 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1682 | 
NL80211_RRF_NO_IBSS
),

1683 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1684 | 
NL80211_RRF_DFS


1685 | 
NL80211_RRF_PASSIVE_SCAN


1686 | 
NL80211_RRF_NO_IBSS
),

1687 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1688 | 
NL80211_RRF_DFS


1689 | 
NL80211_RRF_PASSIVE_SCAN


1690 | 
NL80211_RRF_NO_IBSS
),

1694 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_CH
 = {

1695 .
n_ªg_ruÀs
 = 4,

1696 .
	gÆpha2
 = "CH",

1697 .
	gªg_ruÀs
 = {

1698 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1699 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1700 | 
NL80211_RRF_NO_IBSS
),

1701 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1702 | 
NL80211_RRF_DFS


1703 | 
NL80211_RRF_PASSIVE_SCAN


1704 | 
NL80211_RRF_NO_IBSS
),

1705 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1706 | 
NL80211_RRF_DFS


1707 | 
NL80211_RRF_PASSIVE_SCAN


1708 | 
NL80211_RRF_NO_IBSS
),

1712 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_SY
 = {

1713 .
n_ªg_ruÀs
 = 1,

1714 .
	gÆpha2
 = "SY",

1715 .
	gªg_ruÀs
 = {

1716 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1720 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_TW
 = {

1721 .
n_ªg_ruÀs
 = 5,

1722 .
	gÆpha2
 = "TW",

1723 .
	gªg_ruÀs
 = {

1724 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

1725 
REG_RULE
(5280 - 10, 5320 + 10, 40, 3, 17, 0

1726 | 
NL80211_RRF_DFS


1727 | 
NL80211_RRF_PASSIVE_SCAN
),

1728 
REG_RULE
(5500 - 10, 5580 + 10, 40, 3, 30, 0

1729 | 
NL80211_RRF_DFS


1730 | 
NL80211_RRF_PASSIVE_SCAN
),

1731 
REG_RULE
(5660 - 10, 5700 + 10, 40, 3, 30, 0

1732 | 
NL80211_RRF_DFS


1733 | 
NL80211_RRF_PASSIVE_SCAN
),

1734 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1738 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_TH
 = {

1739 .
n_ªg_ruÀs
 = 5,

1740 .
	gÆpha2
 = "TH",

1741 .
	gªg_ruÀs
 = {

1742 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1743 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1744 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1745 | 
NL80211_RRF_DFS


1746 | 
NL80211_RRF_PASSIVE_SCAN
),

1747 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1748 | 
NL80211_RRF_DFS


1749 | 
NL80211_RRF_PASSIVE_SCAN
),

1750 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1754 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_TT
 = {

1755 .
n_ªg_ruÀs
 = 5,

1756 .
	gÆpha2
 = "TT",

1757 .
	gªg_ruÀs
 = {

1758 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1759 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1760 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1761 | 
NL80211_RRF_DFS


1762 | 
NL80211_RRF_PASSIVE_SCAN
),

1763 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1764 | 
NL80211_RRF_DFS


1765 | 
NL80211_RRF_PASSIVE_SCAN
),

1766 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1770 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_TN
 = {

1771 .
n_ªg_ruÀs
 = 3,

1772 .
	gÆpha2
 = "TN",

1773 .
	gªg_ruÀs
 = {

1774 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1775 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 20, 0

1776 | 
NL80211_RRF_NO_IBSS
),

1777 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

1778 | 
NL80211_RRF_DFS


1779 | 
NL80211_RRF_PASSIVE_SCAN


1780 | 
NL80211_RRF_NO_IBSS
),

1784 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_TR
 = {

1785 .
n_ªg_ruÀs
 = 4,

1786 .
	gÆpha2
 = "TR",

1787 .
	gªg_ruÀs
 = {

1788 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1789 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1790 | 
NL80211_RRF_NO_IBSS
),

1791 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1792 | 
NL80211_RRF_DFS


1793 | 
NL80211_RRF_PASSIVE_SCAN


1794 | 
NL80211_RRF_NO_IBSS
),

1795 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1796 | 
NL80211_RRF_DFS


1797 | 
NL80211_RRF_PASSIVE_SCAN


1798 | 
NL80211_RRF_NO_IBSS
),

1802 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_UG
 = {

1803 .
n_ªg_ruÀs
 = 5,

1804 .
	gÆpha2
 = "UG",

1805 .
	gªg_ruÀs
 = {

1806 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1807 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

1808 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1809 | 
NL80211_RRF_DFS


1810 | 
NL80211_RRF_PASSIVE_SCAN
),

1811 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 30, 0

1812 | 
NL80211_RRF_DFS


1813 | 
NL80211_RRF_PASSIVE_SCAN
),

1814 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 30, 0),

1818 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_UA
 = {

1819 .
n_ªg_ruÀs
 = 5,

1820 .
	gÆpha2
 = "UA",

1821 .
	gªg_ruÀs
 = {

1822 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1823 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1824 | 
NL80211_RRF_NO_IBSS
),

1825 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1826 | 
NL80211_RRF_DFS


1827 | 
NL80211_RRF_PASSIVE_SCAN


1828 | 
NL80211_RRF_NO_IBSS
),

1829 
REG_RULE
(5500 - 10, 5660 + 10, 40, 3, 20, 0

1830 | 
NL80211_RRF_DFS


1831 | 
NL80211_RRF_PASSIVE_SCAN


1832 | 
NL80211_RRF_NO_IBSS
),

1833 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 20, 0

1834 | 
NL80211_RRF_NO_IBSS
),

1838 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_AE
 = {

1839 .
n_ªg_ruÀs
 = 5,

1840 .
	gÆpha2
 = "AE",

1841 .
	gªg_ruÀs
 = {

1842 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1843 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1844 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1845 | 
NL80211_RRF_DFS


1846 | 
NL80211_RRF_PASSIVE_SCAN
),

1847 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1848 | 
NL80211_RRF_DFS


1849 | 
NL80211_RRF_PASSIVE_SCAN
),

1850 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1854 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_GB
 = {

1855 .
n_ªg_ruÀs
 = 4,

1856 .
	gÆpha2
 = "GB",

1857 .
	gªg_ruÀs
 = {

1858 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1859 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1860 | 
NL80211_RRF_NO_IBSS
),

1861 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1862 | 
NL80211_RRF_DFS


1863 | 
NL80211_RRF_PASSIVE_SCAN


1864 | 
NL80211_RRF_NO_IBSS
),

1865 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

1866 | 
NL80211_RRF_DFS


1867 | 
NL80211_RRF_PASSIVE_SCAN


1868 | 
NL80211_RRF_NO_IBSS
),

1872 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_US
 = {

1873 .
n_ªg_ruÀs
 = 5,

1874 .
	gÆpha2
 = "US",

1875 .
	gªg_ruÀs
 = {

1876 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

1877 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1878 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1879 | 
NL80211_RRF_DFS


1880 | 
NL80211_RRF_PASSIVE_SCAN
),

1881 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1882 | 
NL80211_RRF_DFS


1883 | 
NL80211_RRF_PASSIVE_SCAN
),

1884 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1888 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_U2
 = {

1889 .
n_ªg_ruÀs
 = 6,

1890 .
	gÆpha2
 = "U2",

1891 .
	gªg_ruÀs
 = {

1892 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

1893 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

1894 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

1895 | 
NL80211_RRF_DFS


1896 | 
NL80211_RRF_PASSIVE_SCAN
),

1897 
REG_RULE
(5500 - 10, 5580 + 10, 40, 3, 23, 0

1898 | 
NL80211_RRF_DFS


1899 | 
NL80211_RRF_PASSIVE_SCAN
),

1900 
REG_RULE
(5660 - 10, 5700 + 10, 40, 3, 23, 0

1901 | 
NL80211_RRF_DFS


1902 | 
NL80211_RRF_PASSIVE_SCAN
),

1903 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1907 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_PS
 = {

1908 .
n_ªg_ruÀs
 = 4,

1909 .
	gÆpha2
 = "PS",

1910 .
	gªg_ruÀs
 = {

1911 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

1912 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 17, 0),

1913 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 23, 0

1914 | 
NL80211_RRF_DFS
),

1915 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 30, 0),

1919 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_UY
 = {

1920 .
n_ªg_ruÀs
 = 5,

1921 .
	gÆpha2
 = "UY",

1922 .
	gªg_ruÀs
 = {

1923 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1924 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1925 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1926 | 
NL80211_RRF_DFS


1927 | 
NL80211_RRF_PASSIVE_SCAN
),

1928 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1929 | 
NL80211_RRF_DFS


1930 | 
NL80211_RRF_PASSIVE_SCAN
),

1931 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1935 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_UZ
 = {

1936 .
n_ªg_ruÀs
 = 5,

1937 .
	gÆpha2
 = "UZ",

1938 .
	gªg_ruÀs
 = {

1939 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

1940 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1941 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1942 | 
NL80211_RRF_DFS


1943 | 
NL80211_RRF_PASSIVE_SCAN
),

1944 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1945 | 
NL80211_RRF_DFS


1946 | 
NL80211_RRF_PASSIVE_SCAN
),

1947 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1951 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_VE
 = {

1952 .
n_ªg_ruÀs
 = 4,

1953 .
	gÆpha2
 = "VE",

1954 .
	gªg_ruÀs
 = {

1955 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1956 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1957 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

1958 | 
NL80211_RRF_DFS


1959 | 
NL80211_RRF_PASSIVE_SCAN
),

1960 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1964 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_VN
 = {

1965 .
n_ªg_ruÀs
 = 5,

1966 .
	gÆpha2
 = "VN",

1967 .
	gªg_ruÀs
 = {

1968 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1969 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

1970 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

1971 | 
NL80211_RRF_DFS


1972 | 
NL80211_RRF_PASSIVE_SCAN
),

1973 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

1974 | 
NL80211_RRF_DFS


1975 | 
NL80211_RRF_PASSIVE_SCAN
),

1976 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

1980 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_YE
 = {

1981 .
n_ªg_ruÀs
 = 1,

1982 .
	gÆpha2
 = "YE",

1983 .
	gªg_ruÀs
 = {

1984 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1988 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_ZW
 = {

1989 .
n_ªg_ruÀs
 = 4,

1990 .
	gÆpha2
 = "ZW",

1991 .
	gªg_ruÀs
 = {

1992 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

1993 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

1994 | 
NL80211_RRF_NO_IBSS
),

1995 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

1996 | 
NL80211_RRF_DFS


1997 | 
NL80211_RRF_PASSIVE_SCAN


1998 | 
NL80211_RRF_NO_IBSS
),

1999 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

2000 | 
NL80211_RRF_DFS


2001 | 
NL80211_RRF_PASSIVE_SCAN


2002 | 
NL80211_RRF_NO_IBSS
),

2006 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_00
 = {

2007 .
n_ªg_ruÀs
 = 6,

2008 .
	gÆpha2
 = "00",

2009 .
	gªg_ruÀs
 = {

2010 
REG_RULE
(2312 - 10, 2372 + 10, 20, 3, 5, 0),

2011 
REG_RULE
(2412 - 10, 2472 + 10, 20, 3, 5, 0),

2012 
REG_RULE
(2484 - 10, 2484 + 10, 20, 3, 5, 0),

2013 
REG_RULE
(5120 - 10, 5240 + 10, 20, 3, 5, 0),

2014 
REG_RULE
(5260 - 10, 5700 + 10, 20, 3, 5, 0

2015 | 
NL80211_RRF_DFS
),

2016 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 5, 0),

2020 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_03
 = {

2021 .
n_ªg_ruÀs
 = 1,

2022 .
	gÆpha2
 = "03",

2023 .
	gªg_ruÀs
 = {

2024 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2028 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_07
 = {

2029 .
n_ªg_ruÀs
 = 1,

2030 .
	gÆpha2
 = "07",

2031 .
	gªg_ruÀs
 = {

2032 
REG_RULE
(2432 - 10, 2442 + 10, 20, 3, 20, 0),

2036 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_08
 = {

2037 .
n_ªg_ruÀs
 = 1,

2038 .
	gÆpha2
 = "08",

2039 .
	gªg_ruÀs
 = {

2040 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 30, 0),

2044 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_20
 = {

2045 .
n_ªg_ruÀs
 = 4,

2046 .
	gÆpha2
 = "20",

2047 .
	gªg_ruÀs
 = {

2048 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2049 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

2050 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

2051 | 
NL80211_RRF_DFS


2052 | 
NL80211_RRF_PASSIVE_SCAN
),

2053 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2057 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_21
 = {

2058 .
n_ªg_ruÀs
 = 4,

2059 .
	gÆpha2
 = "21",

2060 .
	gªg_ruÀs
 = {

2061 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2062 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

2063 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

2064 | 
NL80211_RRF_DFS


2065 | 
NL80211_RRF_PASSIVE_SCAN
),

2066 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2070 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_22
 = {

2071 .
n_ªg_ruÀs
 = 4,

2072 .
	gÆpha2
 = "22",

2073 .
	gªg_ruÀs
 = {

2074 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 30, 0),

2075 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

2076 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

2077 | 
NL80211_RRF_DFS


2078 | 
NL80211_RRF_PASSIVE_SCAN
),

2079 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2083 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_3a
 = {

2084 .
n_ªg_ruÀs
 = 5,

2085 .
	gÆpha2
 = "3a",

2086 .
	gªg_ruÀs
 = {

2087 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2088 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

2089 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

2090 | 
NL80211_RRF_DFS


2091 | 
NL80211_RRF_PASSIVE_SCAN
),

2092 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

2093 | 
NL80211_RRF_DFS


2094 | 
NL80211_RRF_PASSIVE_SCAN
),

2095 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2099 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_3b
 = {

2100 .
n_ªg_ruÀs
 = 5,

2101 .
	gÆpha2
 = "3b",

2102 .
	gªg_ruÀs
 = {

2103 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2104 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

2105 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

2106 | 
NL80211_RRF_DFS


2107 | 
NL80211_RRF_PASSIVE_SCAN
),

2108 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

2109 | 
NL80211_RRF_DFS


2110 | 
NL80211_RRF_PASSIVE_SCAN
),

2111 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2115 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_3f
 = {

2116 .
n_ªg_ruÀs
 = 5,

2117 .
	gÆpha2
 = "3f",

2118 .
	gªg_ruÀs
 = {

2119 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 30, 0),

2120 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

2121 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 24, 0

2122 | 
NL80211_RRF_DFS


2123 | 
NL80211_RRF_PASSIVE_SCAN
),

2124 
REG_RULE
(5500 - 10, 5720 + 10, 40, 3, 24, 0

2125 | 
NL80211_RRF_DFS


2126 | 
NL80211_RRF_PASSIVE_SCAN
),

2127 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2131 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_12
 = {

2132 .
n_ªg_ruÀs
 = 4,

2133 .
	gÆpha2
 = "12",

2134 .
	gªg_ruÀs
 = {

2135 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2136 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 17, 0),

2137 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 23, 0

2138 | 
NL80211_RRF_DFS
),

2139 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 30, 0),

2143 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_13
 = {

2144 .
n_ªg_ruÀs
 = 2,

2145 .
	gÆpha2
 = "13",

2146 .
	gªg_ruÀs
 = {

2147 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2148 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

2152 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_16
 = {

2153 .
n_ªg_ruÀs
 = 2,

2154 .
	gÆpha2
 = "16",

2155 .
	gªg_ruÀs
 = {

2156 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2157 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

2161 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_14
 = {

2162 .
n_ªg_ruÀs
 = 6,

2163 .
	gÆpha2
 = "14",

2164 .
	gªg_ruÀs
 = {

2165 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2166 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

2167 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

2168 | 
NL80211_RRF_DFS


2169 | 
NL80211_RRF_PASSIVE_SCAN
),

2170 
REG_RULE
(5500 - 10, 5580 + 10, 40, 3, 23, 0

2171 | 
NL80211_RRF_DFS


2172 | 
NL80211_RRF_PASSIVE_SCAN
),

2173 
REG_RULE
(5660 - 10, 5700 + 10, 40, 3, 23, 0

2174 | 
NL80211_RRF_DFS


2175 | 
NL80211_RRF_PASSIVE_SCAN
),

2176 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2180 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_23
 = {

2181 .
n_ªg_ruÀs
 = 6,

2182 .
	gÆpha2
 = "23",

2183 .
	gªg_ruÀs
 = {

2184 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2185 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

2186 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

2187 | 
NL80211_RRF_DFS


2188 | 
NL80211_RRF_PASSIVE_SCAN
),

2189 
REG_RULE
(5500 - 10, 5580 + 10, 40, 3, 23, 0

2190 | 
NL80211_RRF_DFS


2191 | 
NL80211_RRF_PASSIVE_SCAN
),

2192 
REG_RULE
(5660 - 10, 5700 + 10, 40, 3, 23, 0

2193 | 
NL80211_RRF_DFS


2194 | 
NL80211_RRF_PASSIVE_SCAN
),

2195 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2199 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_37
 = {

2200 .
n_ªg_ruÀs
 = 4,

2201 .
	gÆpha2
 = "37",

2202 .
	gªg_ruÀs
 = {

2203 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2204 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

2205 | 
NL80211_RRF_NO_IBSS
),

2206 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2207 | 
NL80211_RRF_DFS


2208 | 
NL80211_RRF_PASSIVE_SCAN


2209 | 
NL80211_RRF_NO_IBSS
),

2210 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 27, 0

2211 | 
NL80211_RRF_DFS


2212 | 
NL80211_RRF_PASSIVE_SCAN


2213 | 
NL80211_RRF_NO_IBSS
),

2217 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_35
 = {

2218 .
n_ªg_ruÀs
 = 2,

2219 .
	gÆpha2
 = "35",

2220 .
	gªg_ruÀs
 = {

2221 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2222 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 18, 0

2223 | 
NL80211_RRF_NO_IBSS
),

2227 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_36
 = {

2228 .
n_ªg_ruÀs
 = 3,

2229 .
	gÆpha2
 = "36",

2230 .
	gªg_ruÀs
 = {

2231 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2232 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

2233 | 
NL80211_RRF_NO_IBSS
),

2234 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

2235 | 
NL80211_RRF_DFS


2236 | 
NL80211_RRF_PASSIVE_SCAN


2237 | 
NL80211_RRF_NO_IBSS
),

2241 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_30
 = {

2242 .
n_ªg_ruÀs
 = 3,

2243 .
	gÆpha2
 = "30",

2244 .
	gªg_ruÀs
 = {

2245 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2246 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 18, 0

2247 | 
NL80211_RRF_NO_IBSS
),

2248 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2249 | 
NL80211_RRF_DFS


2250 | 
NL80211_RRF_PASSIVE_SCAN


2251 | 
NL80211_RRF_NO_IBSS
),

2255 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_39
 = {

2256 .
n_ªg_ruÀs
 = 2,

2257 .
	gÆpha2
 = "39",

2258 .
	gªg_ruÀs
 = {

2259 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2260 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 15, 0

2261 | 
NL80211_RRF_DFS


2262 | 
NL80211_RRF_PASSIVE_SCAN


2263 | 
NL80211_RRF_NO_IBSS
),

2267 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_34
 = {

2268 .
n_ªg_ruÀs
 = 4,

2269 .
	gÆpha2
 = "34",

2270 .
	gªg_ruÀs
 = {

2271 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2272 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0

2273 | 
NL80211_RRF_NO_IBSS
),

2274 
REG_RULE
(5260 - 10, 5280 + 10, 20, 3, 23, 0

2275 | 
NL80211_RRF_DFS


2276 | 
NL80211_RRF_PASSIVE_SCAN


2277 | 
NL80211_RRF_NO_IBSS
),

2278 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 30, 0

2279 | 
NL80211_RRF_DFS


2280 | 
NL80211_RRF_PASSIVE_SCAN


2281 | 
NL80211_RRF_NO_IBSS
),

2285 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_3d
 = {

2286 .
n_ªg_ruÀs
 = 5,

2287 .
	gÆpha2
 = "3d",

2288 .
	gªg_ruÀs
 = {

2289 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2290 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

2291 | 
NL80211_RRF_NO_IBSS
),

2292 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2293 | 
NL80211_RRF_DFS


2294 | 
NL80211_RRF_PASSIVE_SCAN


2295 | 
NL80211_RRF_NO_IBSS
),

2296 
REG_RULE
(5660 - 10, 5700 + 10, 40, 3, 20, 0

2297 | 
NL80211_RRF_DFS


2298 | 
NL80211_RRF_PASSIVE_SCAN


2299 | 
NL80211_RRF_NO_IBSS
),

2300 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 20, 0

2301 | 
NL80211_RRF_NO_IBSS
),

2305 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_3e
 = {

2306 .
n_ªg_ruÀs
 = 5,

2307 .
	gÆpha2
 = "3e",

2308 .
	gªg_ruÀs
 = {

2309 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2310 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

2311 | 
NL80211_RRF_NO_IBSS
),

2312 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2313 | 
NL80211_RRF_DFS


2314 | 
NL80211_RRF_PASSIVE_SCAN


2315 | 
NL80211_RRF_NO_IBSS
),

2316 
REG_RULE
(5500 - 10, 5660 + 10, 40, 3, 20, 0

2317 | 
NL80211_RRF_DFS


2318 | 
NL80211_RRF_PASSIVE_SCAN


2319 | 
NL80211_RRF_NO_IBSS
),

2320 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 20, 0

2321 | 
NL80211_RRF_NO_IBSS
),

2325 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_31
 = {

2326 .
n_ªg_ruÀs
 = 3,

2327 .
	gÆpha2
 = "31",

2328 .
	gªg_ruÀs
 = {

2329 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2330 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0

2331 | 
NL80211_RRF_NO_IBSS
),

2332 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

2333 | 
NL80211_RRF_DFS


2334 | 
NL80211_RRF_PASSIVE_SCAN


2335 | 
NL80211_RRF_NO_IBSS
),

2339 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_11
 = {

2340 .
n_ªg_ruÀs
 = 4,

2341 .
	gÆpha2
 = "11",

2342 .
	gªg_ruÀs
 = {

2343 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2344 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

2345 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

2346 | 
NL80211_RRF_DFS


2347 | 
NL80211_RRF_PASSIVE_SCAN
),

2348 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2352 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_10
 = {

2353 .
n_ªg_ruÀs
 = 4,

2354 .
	gÆpha2
 = "10",

2355 .
	gªg_ruÀs
 = {

2356 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2357 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 17, 0),

2358 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 23, 0

2359 | 
NL80211_RRF_DFS


2360 | 
NL80211_RRF_PASSIVE_SCAN
),

2361 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2365 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_52
 = {

2366 .
n_ªg_ruÀs
 = 2,

2367 .
	gÆpha2
 = "52",

2368 .
	gªg_ruÀs
 = {

2369 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2370 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2374 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_45
 = {

2375 .
n_ªg_ruÀs
 = 2,

2376 .
	gÆpha2
 = "45",

2377 .
	gªg_ruÀs
 = {

2378 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2379 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 23, 0),

2383 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_4d
 = {

2384 .
n_ªg_ruÀs
 = 2,

2385 .
	gÆpha2
 = "4d",

2386 .
	gªg_ruÀs
 = {

2387 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2388 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 23, 0),

2392 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_47
 = {

2393 .
n_ªg_ruÀs
 = 3,

2394 .
	gÆpha2
 = "47",

2395 .
	gªg_ruÀs
 = {

2396 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2397 
REG_RULE
(5280 - 10, 5320 + 10, 40, 3, 17, 0),

2398 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 17, 0),

2402 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_50
 = {

2403 .
n_ªg_ruÀs
 = 3,

2404 .
	gÆpha2
 = "50",

2405 .
	gªg_ruÀs
 = {

2406 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2407 
REG_RULE
(5280 - 10, 5320 + 10, 40, 3, 17, 0),

2408 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 17, 0),

2412 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_42
 = {

2413 .
n_ªg_ruÀs
 = 3,

2414 .
	gÆpha2
 = "42",

2415 .
	gªg_ruÀs
 = {

2416 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2417 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

2418 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 23, 0),

2422 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_58
 = {

2423 .
n_ªg_ruÀs
 = 2,

2424 .
	gÆpha2
 = "58",

2425 .
	gªg_ruÀs
 = {

2426 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2427 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 17, 0),

2431 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_5b
 = {

2432 .
n_ªg_ruÀs
 = 4,

2433 .
	gÆpha2
 = "5b",

2434 .
	gªg_ruÀs
 = {

2435 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2436 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2437 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2438 | 
NL80211_RRF_DFS


2439 | 
NL80211_RRF_PASSIVE_SCAN
),

2440 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 20, 0),

2444 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_5c
 = {

2445 .
n_ªg_ruÀs
 = 5,

2446 .
	gÆpha2
 = "5c",

2447 .
	gªg_ruÀs
 = {

2448 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2449 
REG_RULE
(5280 - 10, 5320 + 10, 40, 3, 17, 0

2450 | 
NL80211_RRF_DFS


2451 | 
NL80211_RRF_PASSIVE_SCAN
),

2452 
REG_RULE
(5500 - 10, 5580 + 10, 40, 3, 30, 0

2453 | 
NL80211_RRF_DFS


2454 | 
NL80211_RRF_PASSIVE_SCAN
),

2455 
REG_RULE
(5660 - 10, 5700 + 10, 40, 3, 30, 0

2456 | 
NL80211_RRF_DFS


2457 | 
NL80211_RRF_PASSIVE_SCAN
),

2458 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2462 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_5d
 = {

2463 .
n_ªg_ruÀs
 = 3,

2464 .
	gÆpha2
 = "5d",

2465 .
	gªg_ruÀs
 = {

2466 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2467 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 30, 0

2468 | 
NL80211_RRF_DFS


2469 | 
NL80211_RRF_PASSIVE_SCAN
),

2470 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2474 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_5e
 = {

2475 .
n_ªg_ruÀs
 = 5,

2476 .
	gÆpha2
 = "5e",

2477 .
	gªg_ruÀs
 = {

2478 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2479 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2480 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 20, 0

2481 | 
NL80211_RRF_DFS


2482 | 
NL80211_RRF_PASSIVE_SCAN
),

2483 
REG_RULE
(5500 - 10, 5620 + 10, 20, 3, 30, 0

2484 | 
NL80211_RRF_DFS


2485 | 
NL80211_RRF_PASSIVE_SCAN
),

2486 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 30, 0),

2490 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_5f
 = {

2491 .
n_ªg_ruÀs
 = 5,

2492 .
	gÆpha2
 = "5f",

2493 .
	gªg_ruÀs
 = {

2494 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2495 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2496 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2497 | 
NL80211_RRF_DFS


2498 | 
NL80211_RRF_PASSIVE_SCAN
),

2499 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 30, 0

2500 | 
NL80211_RRF_DFS


2501 | 
NL80211_RRF_PASSIVE_SCAN
),

2502 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 30, 0),

2506 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_51
 = {

2507 .
n_ªg_ruÀs
 = 4,

2508 .
	gÆpha2
 = "51",

2509 .
	gªg_ruÀs
 = {

2510 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2511 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 23, 0),

2512 
REG_RULE
(5500 - 10, 5560 + 10, 40, 3, 30, 0

2513 | 
NL80211_RRF_DFS


2514 | 
NL80211_RRF_PASSIVE_SCAN
),

2515 
REG_RULE
(5745 - 10, 5765 + 10, 40, 3, 23, 0),

2519 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_55
 = {

2520 .
n_ªg_ruÀs
 = 2,

2521 .
	gÆpha2
 = "55",

2522 .
	gªg_ruÀs
 = {

2523 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 30, 0),

2524 
REG_RULE
(5745 - 10, 5825 + 10, 40, 3, 30, 0),

2528 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_56
 = {

2529 .
n_ªg_ruÀs
 = 2,

2530 .
	gÆpha2
 = "56",

2531 .
	gªg_ruÀs
 = {

2532 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 30, 0),

2533 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 23, 0),

2537 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_49
 = {

2538 .
n_ªg_ruÀs
 = 3,

2539 .
	gÆpha2
 = "49",

2540 .
	gªg_ruÀs
 = {

2541 
REG_RULE
(2312 - 10, 2372 + 10, 20, 3, 20, 0),

2542 
REG_RULE
(2412 - 10, 2472 + 10, 20, 3, 20, 0),

2543 
REG_RULE
(5745 - 10, 5805 + 10, 40, 3, 23, 0),

2547 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_99
 = {

2548 .
n_ªg_ruÀs
 = 6,

2549 .
	gÆpha2
 = "99",

2550 .
	gªg_ruÀs
 = {

2551 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 20, 0),

2552 
REG_RULE
(2467 - 10, 2472 + 10, 20, 3, 20, 0),

2553 
REG_RULE
(2484 - 10, 2484 + 10, 20, 3, 20, 0),

2554 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2555 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2556 | 
NL80211_RRF_DFS


2557 | 
NL80211_RRF_PASSIVE_SCAN
),

2558 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 20, 0

2559 | 
NL80211_RRF_DFS


2560 | 
NL80211_RRF_PASSIVE_SCAN
),

2564 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_9a
 = {

2565 .
n_ªg_ruÀs
 = 4,

2566 .
	gÆpha2
 = "9a",

2567 .
	gªg_ruÀs
 = {

2568 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2569 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2570 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2571 | 
NL80211_RRF_DFS


2572 | 
NL80211_RRF_PASSIVE_SCAN
),

2573 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 20, 0

2574 | 
NL80211_RRF_DFS


2575 | 
NL80211_RRF_PASSIVE_SCAN
),

2579 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_88
 = {

2580 .
n_ªg_ruÀs
 = 4,

2581 .
	gÆpha2
 = "88",

2582 .
	gªg_ruÀs
 = {

2583 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2584 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2585 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2586 | 
NL80211_RRF_DFS


2587 | 
NL80211_RRF_PASSIVE_SCAN
),

2588 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 20, 0

2589 | 
NL80211_RRF_DFS


2590 | 
NL80211_RRF_PASSIVE_SCAN
),

2594 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_d4
 = {

2595 .
n_ªg_ruÀs
 = 8,

2596 .
	gÆpha2
 = "d4",

2597 .
	gªg_ruÀs
 = {

2598 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 20, 0),

2599 
REG_RULE
(2467 - 10, 2472 + 10, 20, 3, 20, 0),

2600 
REG_RULE
(2484 - 10, 2484 + 10, 20, 3, 20, 0),

2601 
REG_RULE
(4920 - 10, 4980 + 10, 20, 3, 23, 0),

2602 
REG_RULE
(5040 - 10, 5080 + 10, 20, 3, 23, 0),

2603 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2604 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2605 | 
NL80211_RRF_DFS


2606 | 
NL80211_RRF_PASSIVE_SCAN
),

2607 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 20, 0

2608 | 
NL80211_RRF_DFS


2609 | 
NL80211_RRF_PASSIVE_SCAN
),

2613 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_d5
 = {

2614 .
n_ªg_ruÀs
 = 6,

2615 .
	gÆpha2
 = "d5",

2616 .
	gªg_ruÀs
 = {

2617 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 30, 0),

2618 
REG_RULE
(4920 - 10, 4980 + 10, 20, 3, 23, 0),

2619 
REG_RULE
(5040 - 10, 5080 + 10, 20, 3, 23, 0),

2620 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2621 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2622 | 
NL80211_RRF_DFS


2623 | 
NL80211_RRF_PASSIVE_SCAN
),

2624 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 20, 0

2625 | 
NL80211_RRF_DFS


2626 | 
NL80211_RRF_PASSIVE_SCAN
),

2630 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_d7
 = {

2631 .
n_ªg_ruÀs
 = 6,

2632 .
	gÆpha2
 = "d7",

2633 .
	gªg_ruÀs
 = {

2634 
REG_RULE
(2412 - 10, 2472 + 10, 40, 3, 20, 0),

2635 
REG_RULE
(4920 - 10, 4980 + 10, 20, 3, 23, 0),

2636 
REG_RULE
(5040 - 10, 5080 + 10, 20, 3, 23, 0),

2637 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2638 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2639 | 
NL80211_RRF_DFS


2640 | 
NL80211_RRF_PASSIVE_SCAN
),

2641 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 20, 0

2642 | 
NL80211_RRF_DFS


2643 | 
NL80211_RRF_PASSIVE_SCAN
),

2647 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_87
 = {

2648 .
n_ªg_ruÀs
 = 6,

2649 .
	gÆpha2
 = "87",

2650 .
	gªg_ruÀs
 = {

2651 
REG_RULE
(2412 - 10, 2462 + 10, 40, 3, 20, 0),

2652 
REG_RULE
(2467 - 10, 2472 + 10, 20, 3, 20, 0),

2653 
REG_RULE
(2484 - 10, 2484 + 10, 20, 3, 20, 0),

2654 
REG_RULE
(5180 - 10, 5240 + 10, 40, 3, 20, 0),

2655 
REG_RULE
(5260 - 10, 5320 + 10, 40, 3, 20, 0

2656 | 
NL80211_RRF_DFS


2657 | 
NL80211_RRF_PASSIVE_SCAN
),

2658 
REG_RULE
(5500 - 10, 5700 + 10, 40, 3, 20, 0

2659 | 
NL80211_RRF_DFS


2660 | 
NL80211_RRF_PASSIVE_SCAN
),

2664 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_60
 = {

2665 .
n_ªg_ruÀs
 = 13,

2666 .
	gÆpha2
 = "60",

2667 .
	gªg_ruÀs
 = {

2668 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2669 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2670 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2671 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2672 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2673 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0

2674 | 
NL80211_RRF_PASSIVE_SCAN
),

2675 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0

2676 | 
NL80211_RRF_PASSIVE_SCAN
),

2677 
REG_RULE
(2484 - 10, 2484 + 10, 20, 3, 18, 0

2678 | 
NL80211_RRF_PASSIVE_SCAN
),

2679 
REG_RULE
(5170 - 10, 5230 + 10, 20, 3, 30, 0

2680 | 
NL80211_RRF_DFS


2681 | 
NL80211_RRF_PASSIVE_SCAN
),

2682 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2683 | 
NL80211_RRF_DFS


2684 | 
NL80211_RRF_PASSIVE_SCAN
),

2685 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2686 | 
NL80211_RRF_DFS


2687 | 
NL80211_RRF_PASSIVE_SCAN
),

2688 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2689 | 
NL80211_RRF_PASSIVE_SCAN
),

2690 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

2691 | 
NL80211_RRF_DFS


2692 | 
NL80211_RRF_PASSIVE_SCAN
),

2696 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_61
 = {

2697 .
n_ªg_ruÀs
 = 13,

2698 .
	gÆpha2
 = "61",

2699 .
	gªg_ruÀs
 = {

2700 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2701 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2702 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2703 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2704 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2705 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0

2706 | 
NL80211_RRF_PASSIVE_SCAN
),

2707 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0

2708 | 
NL80211_RRF_PASSIVE_SCAN
),

2709 
REG_RULE
(2484 - 10, 2484 + 10, 20, 3, 18, 0

2710 | 
NL80211_RRF_PASSIVE_SCAN
),

2711 
REG_RULE
(5170 - 10, 5230 + 10, 20, 3, 30, 0

2712 | 
NL80211_RRF_DFS


2713 | 
NL80211_RRF_PASSIVE_SCAN


2714 | 
NL80211_RRF_NO_IBSS
),

2715 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2716 | 
NL80211_RRF_DFS


2717 | 
NL80211_RRF_PASSIVE_SCAN


2718 | 
NL80211_RRF_NO_IBSS
),

2719 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2720 | 
NL80211_RRF_DFS


2721 | 
NL80211_RRF_PASSIVE_SCAN


2722 | 
NL80211_RRF_NO_IBSS
),

2723 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2724 | 
NL80211_RRF_PASSIVE_SCAN


2725 | 
NL80211_RRF_NO_IBSS
),

2726 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

2727 | 
NL80211_RRF_DFS


2728 | 
NL80211_RRF_PASSIVE_SCAN


2729 | 
NL80211_RRF_NO_IBSS
),

2733 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_62
 = {

2734 .
n_ªg_ruÀs
 = 13,

2735 .
	gÆpha2
 = "62",

2736 .
	gªg_ruÀs
 = {

2737 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2738 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2739 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2740 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2741 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2742 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0),

2743 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0),

2744 
REG_RULE
(2484 - 10, 2484 + 10, 20, 3, 18, 0),

2745 
REG_RULE
(5170 - 10, 5230 + 10, 20, 3, 30, 0

2746 | 
NL80211_RRF_DFS


2747 | 
NL80211_RRF_PASSIVE_SCAN


2748 | 
NL80211_RRF_NO_IBSS
),

2749 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2750 | 
NL80211_RRF_DFS


2751 | 
NL80211_RRF_PASSIVE_SCAN


2752 | 
NL80211_RRF_NO_IBSS
),

2753 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2754 | 
NL80211_RRF_DFS


2755 | 
NL80211_RRF_PASSIVE_SCAN


2756 | 
NL80211_RRF_NO_IBSS
),

2757 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2758 | 
NL80211_RRF_PASSIVE_SCAN


2759 | 
NL80211_RRF_NO_IBSS
),

2760 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

2761 | 
NL80211_RRF_DFS


2762 | 
NL80211_RRF_PASSIVE_SCAN


2763 | 
NL80211_RRF_NO_IBSS
),

2767 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_63
 = {

2768 .
n_ªg_ruÀs
 = 11,

2769 .
	gÆpha2
 = "63",

2770 .
	gªg_ruÀs
 = {

2771 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2772 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2773 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2774 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2775 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2776 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0),

2777 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0),

2778 
REG_RULE
(5170 - 10, 5230 + 10, 20, 3, 30, 0

2779 | 
NL80211_RRF_DFS


2780 | 
NL80211_RRF_PASSIVE_SCAN
),

2781 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2782 | 
NL80211_RRF_DFS


2783 | 
NL80211_RRF_PASSIVE_SCAN
),

2784 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2785 | 
NL80211_RRF_DFS


2786 | 
NL80211_RRF_PASSIVE_SCAN
),

2787 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2788 | 
NL80211_RRF_PASSIVE_SCAN
),

2792 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_64
 = {

2793 .
n_ªg_ruÀs
 = 8,

2794 .
	gÆpha2
 = "64",

2795 .
	gªg_ruÀs
 = {

2796 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2797 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2798 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2799 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2800 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2801 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2802 | 
NL80211_RRF_DFS


2803 | 
NL80211_RRF_PASSIVE_SCAN


2804 | 
NL80211_RRF_NO_IBSS
),

2805 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2806 | 
NL80211_RRF_DFS


2807 | 
NL80211_RRF_PASSIVE_SCAN


2808 | 
NL80211_RRF_NO_IBSS
),

2809 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2810 | 
NL80211_RRF_PASSIVE_SCAN


2811 | 
NL80211_RRF_NO_IBSS
),

2815 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_65
 = {

2816 .
n_ªg_ruÀs
 = 10,

2817 .
	gÆpha2
 = "65",

2818 .
	gªg_ruÀs
 = {

2819 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2820 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2821 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2822 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2823 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2824 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0

2825 | 
NL80211_RRF_PASSIVE_SCAN
),

2826 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0

2827 | 
NL80211_RRF_PASSIVE_SCAN
),

2828 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2829 | 
NL80211_RRF_DFS


2830 | 
NL80211_RRF_PASSIVE_SCAN


2831 | 
NL80211_RRF_NO_IBSS
),

2832 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2833 | 
NL80211_RRF_DFS


2834 | 
NL80211_RRF_PASSIVE_SCAN


2835 | 
NL80211_RRF_NO_IBSS
),

2836 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2837 | 
NL80211_RRF_PASSIVE_SCAN


2838 | 
NL80211_RRF_NO_IBSS
),

2842 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_66
 = {

2843 .
n_ªg_ruÀs
 = 10,

2844 .
	gÆpha2
 = "66",

2845 .
	gªg_ruÀs
 = {

2846 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2847 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2848 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2849 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2850 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2851 
REG_RULE
(5170 - 10, 5230 + 10, 20, 3, 30, 0

2852 | 
NL80211_RRF_DFS


2853 | 
NL80211_RRF_PASSIVE_SCAN
),

2854 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2855 | 
NL80211_RRF_DFS


2856 | 
NL80211_RRF_PASSIVE_SCAN
),

2857 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2858 | 
NL80211_RRF_DFS


2859 | 
NL80211_RRF_PASSIVE_SCAN
),

2860 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2861 | 
NL80211_RRF_PASSIVE_SCAN
),

2862 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

2863 | 
NL80211_RRF_DFS


2864 | 
NL80211_RRF_PASSIVE_SCAN
),

2868 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_67
 = {

2869 .
n_ªg_ruÀs
 = 12,

2870 .
	gÆpha2
 = "67",

2871 .
	gªg_ruÀs
 = {

2872 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2873 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2874 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2875 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2876 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2877 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0

2878 | 
NL80211_RRF_PASSIVE_SCAN
),

2879 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0

2880 | 
NL80211_RRF_PASSIVE_SCAN
),

2881 
REG_RULE
(5170 - 10, 5230 + 10, 20, 3, 30, 0

2882 | 
NL80211_RRF_DFS


2883 | 
NL80211_RRF_PASSIVE_SCAN
),

2884 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2885 | 
NL80211_RRF_DFS


2886 | 
NL80211_RRF_PASSIVE_SCAN
),

2887 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2888 | 
NL80211_RRF_DFS


2889 | 
NL80211_RRF_PASSIVE_SCAN
),

2890 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2891 | 
NL80211_RRF_PASSIVE_SCAN
),

2892 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

2893 | 
NL80211_RRF_DFS


2894 | 
NL80211_RRF_PASSIVE_SCAN
),

2898 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_68
 = {

2899 .
n_ªg_ruÀs
 = 12,

2900 .
	gÆpha2
 = "68",

2901 .
	gªg_ruÀs
 = {

2902 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2903 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2904 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2905 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2906 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2907 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0),

2908 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0),

2909 
REG_RULE
(5170 - 10, 5230 + 10, 20, 3, 30, 0

2910 | 
NL80211_RRF_DFS


2911 | 
NL80211_RRF_PASSIVE_SCAN
),

2912 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2913 | 
NL80211_RRF_DFS


2914 | 
NL80211_RRF_PASSIVE_SCAN
),

2915 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2916 | 
NL80211_RRF_DFS


2917 | 
NL80211_RRF_PASSIVE_SCAN
),

2918 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2919 | 
NL80211_RRF_PASSIVE_SCAN
),

2920 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

2921 | 
NL80211_RRF_DFS


2922 | 
NL80211_RRF_PASSIVE_SCAN
),

2926 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_69
 = {

2927 .
n_ªg_ruÀs
 = 9,

2928 .
	gÆpha2
 = "69",

2929 .
	gªg_ruÀs
 = {

2930 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2931 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2932 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2933 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2934 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2935 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2936 | 
NL80211_RRF_DFS


2937 | 
NL80211_RRF_PASSIVE_SCAN


2938 | 
NL80211_RRF_NO_IBSS
),

2939 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2940 | 
NL80211_RRF_DFS


2941 | 
NL80211_RRF_PASSIVE_SCAN


2942 | 
NL80211_RRF_NO_IBSS
),

2943 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2944 | 
NL80211_RRF_PASSIVE_SCAN


2945 | 
NL80211_RRF_NO_IBSS
),

2946 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

2947 | 
NL80211_RRF_DFS


2948 | 
NL80211_RRF_PASSIVE_SCAN


2949 | 
NL80211_RRF_NO_IBSS
),

2953 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_6a
 = {

2954 .
n_ªg_ruÀs
 = 11,

2955 .
	gÆpha2
 = "6a",

2956 .
	gªg_ruÀs
 = {

2957 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2958 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2959 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2960 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2961 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2962 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0

2963 | 
NL80211_RRF_PASSIVE_SCAN
),

2964 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0

2965 | 
NL80211_RRF_PASSIVE_SCAN
),

2966 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2967 | 
NL80211_RRF_DFS


2968 | 
NL80211_RRF_PASSIVE_SCAN


2969 | 
NL80211_RRF_NO_IBSS
),

2970 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

2971 | 
NL80211_RRF_DFS


2972 | 
NL80211_RRF_PASSIVE_SCAN


2973 | 
NL80211_RRF_NO_IBSS
),

2974 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

2975 | 
NL80211_RRF_PASSIVE_SCAN


2976 | 
NL80211_RRF_NO_IBSS
),

2977 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

2978 | 
NL80211_RRF_DFS


2979 | 
NL80211_RRF_PASSIVE_SCAN


2980 | 
NL80211_RRF_NO_IBSS
),

2984 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_6b
 = {

2985 .
n_ªg_ruÀs
 = 10,

2986 .
	gÆpha2
 = "6b",

2987 .
	gªg_ruÀs
 = {

2988 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

2989 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

2990 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

2991 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

2992 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

2993 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0

2994 | 
NL80211_RRF_PASSIVE_SCAN
),

2995 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0

2996 | 
NL80211_RRF_PASSIVE_SCAN
),

2997 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

2998 | 
NL80211_RRF_DFS


2999 | 
NL80211_RRF_PASSIVE_SCAN


3000 | 
NL80211_RRF_NO_IBSS
),

3001 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

3002 | 
NL80211_RRF_DFS


3003 | 
NL80211_RRF_PASSIVE_SCAN


3004 | 
NL80211_RRF_NO_IBSS
),

3005 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

3006 | 
NL80211_RRF_DFS


3007 | 
NL80211_RRF_PASSIVE_SCAN


3008 | 
NL80211_RRF_NO_IBSS
),

3012 c⁄° 
õì80211_ªgdomaö
 
	g©h6kl_ªgd_6c
 = {

3013 .
n_ªg_ruÀs
 = 11,

3014 .
	gÆpha2
 = "6c",

3015 .
	gªg_ruÀs
 = {

3016 
REG_RULE
(2412 - 10, 2412 + 10, 20, 3, 18, 0),

3017 
REG_RULE
(2417 - 10, 2432 + 10, 20, 3, 18, 0),

3018 
REG_RULE
(2437 - 10, 2442 + 10, 20, 3, 18, 0),

3019 
REG_RULE
(2447 - 10, 2457 + 10, 20, 3, 18, 0),

3020 
REG_RULE
(2462 - 10, 2462 + 10, 20, 3, 18, 0),

3021 
REG_RULE
(2467 - 10, 2467 + 10, 20, 3, 18, 0

3022 | 
NL80211_RRF_PASSIVE_SCAN
),

3023 
REG_RULE
(2472 - 10, 2472 + 10, 20, 3, 18, 0

3024 | 
NL80211_RRF_PASSIVE_SCAN
),

3025 
REG_RULE
(5180 - 10, 5240 + 10, 20, 3, 30, 0

3026 | 
NL80211_RRF_DFS


3027 | 
NL80211_RRF_PASSIVE_SCAN


3028 | 
NL80211_RRF_NO_IBSS
),

3029 
REG_RULE
(5260 - 10, 5320 + 10, 20, 3, 18, 0

3030 | 
NL80211_RRF_DFS


3031 | 
NL80211_RRF_PASSIVE_SCAN


3032 | 
NL80211_RRF_NO_IBSS
),

3033 
REG_RULE
(5745 - 10, 5825 + 10, 20, 3, 20, 0

3034 | 
NL80211_RRF_PASSIVE_SCAN


3035 | 
NL80211_RRF_NO_IBSS
),

3036 
REG_RULE
(5500 - 10, 5700 + 10, 20, 3, 20, 0

3037 | 
NL80211_RRF_DFS


3038 | 
NL80211_RRF_PASSIVE_SCAN


3039 | 
NL80211_RRF_NO_IBSS
),

3043 #i‚de‡
CONFIG_ATH6KL_REGDB_AS_CFG80211_REGDB


3044 c⁄° 
õì80211_ªgdomaö
 *
	g©h6kl_ªg_ªgdb_cou¡ry
[] = {

3045 &
©h6kl_ªgd_AL
,

3046 &
©h6kl_ªgd_DZ
,

3047 &
©h6kl_ªgd_AR
,

3048 &
©h6kl_ªgd_AM
,

3049 &
©h6kl_ªgd_AW
,

3050 &
©h6kl_ªgd_AU
,

3051 &
©h6kl_ªgd_A2
,

3052 &
©h6kl_ªgd_AT
,

3053 &
©h6kl_ªgd_AZ
,

3054 &
©h6kl_ªgd_BH
,

3055 &
©h6kl_ªgd_BD
,

3056 &
©h6kl_ªgd_BB
,

3057 &
©h6kl_ªgd_BY
,

3058 &
©h6kl_ªgd_BE
,

3059 &
©h6kl_ªgd_BZ
,

3060 &
©h6kl_ªgd_BO
,

3061 &
©h6kl_ªgd_BA
,

3062 &
©h6kl_ªgd_BR
,

3063 &
©h6kl_ªgd_BN
,

3064 &
©h6kl_ªgd_BG
,

3065 &
©h6kl_ªgd_KH
,

3066 &
©h6kl_ªgd_CA
,

3067 &
©h6kl_ªgd_C2
,

3068 &
©h6kl_ªgd_CL
,

3069 &
©h6kl_ªgd_CN
,

3070 &
©h6kl_ªgd_CO
,

3071 &
©h6kl_ªgd_CR
,

3072 &
©h6kl_ªgd_HR
,

3073 &
©h6kl_ªgd_CY
,

3074 &
©h6kl_ªgd_CZ
,

3075 &
©h6kl_ªgd_DK
,

3076 &
©h6kl_ªgd_DO
,

3077 &
©h6kl_ªgd_EC
,

3078 &
©h6kl_ªgd_EG
,

3079 &
©h6kl_ªgd_SV
,

3080 &
©h6kl_ªgd_EE
,

3081 &
©h6kl_ªgd_FI
,

3082 &
©h6kl_ªgd_FR
,

3083 &
©h6kl_ªgd_F2
,

3084 &
©h6kl_ªgd_GE
,

3085 &
©h6kl_ªgd_DE
,

3086 &
©h6kl_ªgd_GR
,

3087 &
©h6kl_ªgd_GL
,

3088 &
©h6kl_ªgd_GD
,

3089 &
©h6kl_ªgd_GU
,

3090 &
©h6kl_ªgd_GT
,

3091 &
©h6kl_ªgd_HT
,

3092 &
©h6kl_ªgd_HN
,

3093 &
©h6kl_ªgd_HK
,

3094 &
©h6kl_ªgd_HU
,

3095 &
©h6kl_ªgd_IS
,

3096 &
©h6kl_ªgd_IN
,

3097 &
©h6kl_ªgd_ID
,

3098 &
©h6kl_ªgd_IR
,

3099 &
©h6kl_ªgd_IE
,

3100 &
©h6kl_ªgd_IL
,

3101 &
©h6kl_ªgd_IT
,

3102 &
©h6kl_ªgd_JM
,

3103 &
©h6kl_ªgd_JP
,

3104 &
©h6kl_ªgd_JO
,

3105 &
©h6kl_ªgd_KZ
,

3106 &
©h6kl_ªgd_KE
,

3107 &
©h6kl_ªgd_KP
,

3108 &
©h6kl_ªgd_KR
,

3109 &
©h6kl_ªgd_K2
,

3110 &
©h6kl_ªgd_K3
,

3111 &
©h6kl_ªgd_KW
,

3112 &
©h6kl_ªgd_LV
,

3113 &
©h6kl_ªgd_LB
,

3114 &
©h6kl_ªgd_LI
,

3115 &
©h6kl_ªgd_LT
,

3116 &
©h6kl_ªgd_LU
,

3117 &
©h6kl_ªgd_MO
,

3118 &
©h6kl_ªgd_MK
,

3119 &
©h6kl_ªgd_MW
,

3120 &
©h6kl_ªgd_MY
,

3121 &
©h6kl_ªgd_MT
,

3122 &
©h6kl_ªgd_MX
,

3123 &
©h6kl_ªgd_MC
,

3124 &
©h6kl_ªgd_MA
,

3125 &
©h6kl_ªgd_NP
,

3126 &
©h6kl_ªgd_NZ
,

3127 &
©h6kl_ªgd_NL
,

3128 &
©h6kl_ªgd_AN
,

3129 &
©h6kl_ªgd_NO
,

3130 &
©h6kl_ªgd_OM
,

3131 &
©h6kl_ªgd_PK
,

3132 &
©h6kl_ªgd_PA
,

3133 &
©h6kl_ªgd_PE
,

3134 &
©h6kl_ªgd_PH
,

3135 &
©h6kl_ªgd_PL
,

3136 &
©h6kl_ªgd_PT
,

3137 &
©h6kl_ªgd_PR
,

3138 &
©h6kl_ªgd_QA
,

3139 &
©h6kl_ªgd_RO
,

3140 &
©h6kl_ªgd_RU
,

3141 &
©h6kl_ªgd_RW
,

3142 &
©h6kl_ªgd_SA
,

3143 &
©h6kl_ªgd_ME
,

3144 &
©h6kl_ªgd_RS
,

3145 &
©h6kl_ªgd_SG
,

3146 &
©h6kl_ªgd_SK
,

3147 &
©h6kl_ªgd_SI
,

3148 &
©h6kl_ªgd_ZA
,

3149 &
©h6kl_ªgd_ES
,

3150 &
©h6kl_ªgd_LK
,

3151 &
©h6kl_ªgd_SE
,

3152 &
©h6kl_ªgd_CH
,

3153 &
©h6kl_ªgd_SY
,

3154 &
©h6kl_ªgd_TW
,

3155 &
©h6kl_ªgd_TH
,

3156 &
©h6kl_ªgd_TT
,

3157 &
©h6kl_ªgd_TN
,

3158 &
©h6kl_ªgd_TR
,

3159 &
©h6kl_ªgd_UG
,

3160 &
©h6kl_ªgd_UA
,

3161 &
©h6kl_ªgd_AE
,

3162 &
©h6kl_ªgd_GB
,

3163 &
©h6kl_ªgd_US
,

3164 &
©h6kl_ªgd_U2
,

3165 &
©h6kl_ªgd_PS
,

3166 &
©h6kl_ªgd_UY
,

3167 &
©h6kl_ªgd_UZ
,

3168 &
©h6kl_ªgd_VE
,

3169 &
©h6kl_ªgd_VN
,

3170 &
©h6kl_ªgd_YE
,

3171 &
©h6kl_ªgd_ZW
,

3172 
NULL
,

3175 c⁄° 
õì80211_ªgdomaö
 *
	g©h6kl_ªg_ªgdb_ªgi⁄
[] = {

3176 &
©h6kl_ªgd_00
,

3177 &
©h6kl_ªgd_03
,

3178 &
©h6kl_ªgd_07
,

3179 &
©h6kl_ªgd_08
,

3180 &
©h6kl_ªgd_20
,

3181 &
©h6kl_ªgd_21
,

3182 &
©h6kl_ªgd_22
,

3183 &
©h6kl_ªgd_3a
,

3184 &
©h6kl_ªgd_3b
,

3185 &
©h6kl_ªgd_3f
,

3186 &
©h6kl_ªgd_12
,

3187 &
©h6kl_ªgd_13
,

3188 &
©h6kl_ªgd_16
,

3189 &
©h6kl_ªgd_14
,

3190 &
©h6kl_ªgd_23
,

3191 &
©h6kl_ªgd_37
,

3192 &
©h6kl_ªgd_35
,

3193 &
©h6kl_ªgd_36
,

3194 &
©h6kl_ªgd_30
,

3195 &
©h6kl_ªgd_39
,

3196 &
©h6kl_ªgd_34
,

3197 &
©h6kl_ªgd_3d
,

3198 &
©h6kl_ªgd_3e
,

3199 &
©h6kl_ªgd_31
,

3200 &
©h6kl_ªgd_11
,

3201 &
©h6kl_ªgd_10
,

3202 &
©h6kl_ªgd_52
,

3203 &
©h6kl_ªgd_45
,

3204 &
©h6kl_ªgd_4d
,

3205 &
©h6kl_ªgd_47
,

3206 &
©h6kl_ªgd_50
,

3207 &
©h6kl_ªgd_42
,

3208 &
©h6kl_ªgd_58
,

3209 &
©h6kl_ªgd_5b
,

3210 &
©h6kl_ªgd_5c
,

3211 &
©h6kl_ªgd_5d
,

3212 &
©h6kl_ªgd_5e
,

3213 &
©h6kl_ªgd_5f
,

3214 &
©h6kl_ªgd_51
,

3215 &
©h6kl_ªgd_55
,

3216 &
©h6kl_ªgd_56
,

3217 &
©h6kl_ªgd_49
,

3218 &
©h6kl_ªgd_99
,

3219 &
©h6kl_ªgd_9a
,

3220 &
©h6kl_ªgd_88
,

3221 &
©h6kl_ªgd_d4
,

3222 &
©h6kl_ªgd_d5
,

3223 &
©h6kl_ªgd_d7
,

3224 &
©h6kl_ªgd_87
,

3225 &
©h6kl_ªgd_60
,

3226 &
©h6kl_ªgd_61
,

3227 &
©h6kl_ªgd_62
,

3228 &
©h6kl_ªgd_63
,

3229 &
©h6kl_ªgd_64
,

3230 &
©h6kl_ªgd_65
,

3231 &
©h6kl_ªgd_66
,

3232 &
©h6kl_ªgd_67
,

3233 &
©h6kl_ªgd_68
,

3234 &
©h6kl_ªgd_69
,

3235 &
©h6kl_ªgd_6a
,

3236 &
©h6kl_ªgd_6b
,

3237 &
©h6kl_ªgd_6c
,

3238 
NULL
,

3241 c⁄° 
õì80211_ªgdomaö
 *
	gªg_ªgdb
[] = {

3242 &
©h6kl_ªgd_AL
,

3243 &
©h6kl_ªgd_DZ
,

3244 &
©h6kl_ªgd_AR
,

3245 &
©h6kl_ªgd_AM
,

3246 &
©h6kl_ªgd_AW
,

3247 &
©h6kl_ªgd_AU
,

3248 &
©h6kl_ªgd_A2
,

3249 &
©h6kl_ªgd_AT
,

3250 &
©h6kl_ªgd_AZ
,

3251 &
©h6kl_ªgd_BH
,

3252 &
©h6kl_ªgd_BD
,

3253 &
©h6kl_ªgd_BB
,

3254 &
©h6kl_ªgd_BY
,

3255 &
©h6kl_ªgd_BE
,

3256 &
©h6kl_ªgd_BZ
,

3257 &
©h6kl_ªgd_BO
,

3258 &
©h6kl_ªgd_BA
,

3259 &
©h6kl_ªgd_BR
,

3260 &
©h6kl_ªgd_BN
,

3261 &
©h6kl_ªgd_BG
,

3262 &
©h6kl_ªgd_KH
,

3263 &
©h6kl_ªgd_CA
,

3264 &
©h6kl_ªgd_C2
,

3265 &
©h6kl_ªgd_CL
,

3266 &
©h6kl_ªgd_CN
,

3267 &
©h6kl_ªgd_CO
,

3268 &
©h6kl_ªgd_CR
,

3269 &
©h6kl_ªgd_HR
,

3270 &
©h6kl_ªgd_CY
,

3271 &
©h6kl_ªgd_CZ
,

3272 &
©h6kl_ªgd_DK
,

3273 &
©h6kl_ªgd_DO
,

3274 &
©h6kl_ªgd_EC
,

3275 &
©h6kl_ªgd_EG
,

3276 &
©h6kl_ªgd_SV
,

3277 &
©h6kl_ªgd_EE
,

3278 &
©h6kl_ªgd_FI
,

3279 &
©h6kl_ªgd_FR
,

3280 &
©h6kl_ªgd_F2
,

3281 &
©h6kl_ªgd_GE
,

3282 &
©h6kl_ªgd_DE
,

3283 &
©h6kl_ªgd_GR
,

3284 &
©h6kl_ªgd_GL
,

3285 &
©h6kl_ªgd_GD
,

3286 &
©h6kl_ªgd_GU
,

3287 &
©h6kl_ªgd_GT
,

3288 &
©h6kl_ªgd_HT
,

3289 &
©h6kl_ªgd_HN
,

3290 &
©h6kl_ªgd_HK
,

3291 &
©h6kl_ªgd_HU
,

3292 &
©h6kl_ªgd_IS
,

3293 &
©h6kl_ªgd_IN
,

3294 &
©h6kl_ªgd_ID
,

3295 &
©h6kl_ªgd_IR
,

3296 &
©h6kl_ªgd_IE
,

3297 &
©h6kl_ªgd_IL
,

3298 &
©h6kl_ªgd_IT
,

3299 &
©h6kl_ªgd_JM
,

3300 &
©h6kl_ªgd_JP
,

3301 &
©h6kl_ªgd_JO
,

3302 &
©h6kl_ªgd_KZ
,

3303 &
©h6kl_ªgd_KE
,

3304 &
©h6kl_ªgd_KP
,

3305 &
©h6kl_ªgd_KR
,

3306 &
©h6kl_ªgd_K2
,

3307 &
©h6kl_ªgd_K3
,

3308 &
©h6kl_ªgd_KW
,

3309 &
©h6kl_ªgd_LV
,

3310 &
©h6kl_ªgd_LB
,

3311 &
©h6kl_ªgd_LI
,

3312 &
©h6kl_ªgd_LT
,

3313 &
©h6kl_ªgd_LU
,

3314 &
©h6kl_ªgd_MO
,

3315 &
©h6kl_ªgd_MK
,

3316 &
©h6kl_ªgd_MW
,

3317 &
©h6kl_ªgd_MY
,

3318 &
©h6kl_ªgd_MT
,

3319 &
©h6kl_ªgd_MX
,

3320 &
©h6kl_ªgd_MC
,

3321 &
©h6kl_ªgd_MA
,

3322 &
©h6kl_ªgd_NP
,

3323 &
©h6kl_ªgd_NZ
,

3324 &
©h6kl_ªgd_NL
,

3325 &
©h6kl_ªgd_AN
,

3326 &
©h6kl_ªgd_NO
,

3327 &
©h6kl_ªgd_OM
,

3328 &
©h6kl_ªgd_PK
,

3329 &
©h6kl_ªgd_PA
,

3330 &
©h6kl_ªgd_PE
,

3331 &
©h6kl_ªgd_PH
,

3332 &
©h6kl_ªgd_PL
,

3333 &
©h6kl_ªgd_PT
,

3334 &
©h6kl_ªgd_PR
,

3335 &
©h6kl_ªgd_QA
,

3336 &
©h6kl_ªgd_RO
,

3337 &
©h6kl_ªgd_RU
,

3338 &
©h6kl_ªgd_RW
,

3339 &
©h6kl_ªgd_SA
,

3340 &
©h6kl_ªgd_ME
,

3341 &
©h6kl_ªgd_RS
,

3342 &
©h6kl_ªgd_SG
,

3343 &
©h6kl_ªgd_SK
,

3344 &
©h6kl_ªgd_SI
,

3345 &
©h6kl_ªgd_ZA
,

3346 &
©h6kl_ªgd_ES
,

3347 &
©h6kl_ªgd_LK
,

3348 &
©h6kl_ªgd_SE
,

3349 &
©h6kl_ªgd_CH
,

3350 &
©h6kl_ªgd_SY
,

3351 &
©h6kl_ªgd_TW
,

3352 &
©h6kl_ªgd_TH
,

3353 &
©h6kl_ªgd_TT
,

3354 &
©h6kl_ªgd_TN
,

3355 &
©h6kl_ªgd_TR
,

3356 &
©h6kl_ªgd_UG
,

3357 &
©h6kl_ªgd_UA
,

3358 &
©h6kl_ªgd_AE
,

3359 &
©h6kl_ªgd_GB
,

3360 &
©h6kl_ªgd_US
,

3361 &
©h6kl_ªgd_U2
,

3362 &
©h6kl_ªgd_PS
,

3363 &
©h6kl_ªgd_UY
,

3364 &
©h6kl_ªgd_UZ
,

3365 &
©h6kl_ªgd_VE
,

3366 &
©h6kl_ªgd_VN
,

3367 &
©h6kl_ªgd_YE
,

3368 &
©h6kl_ªgd_ZW
,

3369 &
©h6kl_ªgd_00
,

3370 &
©h6kl_ªgd_03
,

3371 &
©h6kl_ªgd_07
,

3372 &
©h6kl_ªgd_08
,

3373 &
©h6kl_ªgd_20
,

3374 &
©h6kl_ªgd_21
,

3375 &
©h6kl_ªgd_22
,

3376 &
©h6kl_ªgd_3a
,

3377 &
©h6kl_ªgd_3b
,

3378 &
©h6kl_ªgd_3f
,

3379 &
©h6kl_ªgd_12
,

3380 &
©h6kl_ªgd_13
,

3381 &
©h6kl_ªgd_16
,

3382 &
©h6kl_ªgd_14
,

3383 &
©h6kl_ªgd_23
,

3384 &
©h6kl_ªgd_37
,

3385 &
©h6kl_ªgd_35
,

3386 &
©h6kl_ªgd_36
,

3387 &
©h6kl_ªgd_30
,

3388 &
©h6kl_ªgd_39
,

3389 &
©h6kl_ªgd_34
,

3390 &
©h6kl_ªgd_3d
,

3391 &
©h6kl_ªgd_3e
,

3392 &
©h6kl_ªgd_31
,

3393 &
©h6kl_ªgd_11
,

3394 &
©h6kl_ªgd_10
,

3395 &
©h6kl_ªgd_52
,

3396 &
©h6kl_ªgd_45
,

3397 &
©h6kl_ªgd_4d
,

3398 &
©h6kl_ªgd_47
,

3399 &
©h6kl_ªgd_50
,

3400 &
©h6kl_ªgd_42
,

3401 &
©h6kl_ªgd_58
,

3402 &
©h6kl_ªgd_5b
,

3403 &
©h6kl_ªgd_5c
,

3404 &
©h6kl_ªgd_5d
,

3405 &
©h6kl_ªgd_5e
,

3406 &
©h6kl_ªgd_5f
,

3407 &
©h6kl_ªgd_51
,

3408 &
©h6kl_ªgd_55
,

3409 &
©h6kl_ªgd_56
,

3410 &
©h6kl_ªgd_49
,

3411 &
©h6kl_ªgd_99
,

3412 &
©h6kl_ªgd_9a
,

3413 &
©h6kl_ªgd_88
,

3414 &
©h6kl_ªgd_d4
,

3415 &
©h6kl_ªgd_d5
,

3416 &
©h6kl_ªgd_d7
,

3417 &
©h6kl_ªgd_87
,

3418 &
©h6kl_ªgd_60
,

3419 &
©h6kl_ªgd_61
,

3420 &
©h6kl_ªgd_62
,

3421 &
©h6kl_ªgd_63
,

3422 &
©h6kl_ªgd_64
,

3423 &
©h6kl_ªgd_65
,

3424 &
©h6kl_ªgd_66
,

3425 &
©h6kl_ªgd_67
,

3426 &
©h6kl_ªgd_68
,

3427 &
©h6kl_ªgd_69
,

3428 &
©h6kl_ªgd_6a
,

3429 &
©h6kl_ªgd_6b
,

3430 &
©h6kl_ªgd_6c
,

3433 
	gªg_ªgdb_size
 = 
ARRAY_SIZE
(
ªg_ªgdb
);

	@rttapi.h

17 #i‚de‡
_HOST_RTT_API_H_


18 
	#_HOST_RTT_API_H_


	)

21 
πtm_öô
(*);

23 
πtm_gëbuf
(**
buf
, 
u32
 *
Àn
);

25 
πtm_ªcv
(*
buf
, 
u32
 
Àn
);

27 
πtm_‰ì
();

29 
πtm_issue_ªque°
(*
buf
, 
u32
 
Àn
);

	@rttm.c

17 
	~<löux/ù.h
>

18 
	~"c‹e.h
"

19 
	~"debug.h
"

20 
	~"wœn_loˇti⁄_defs.h
"

21 
	~"πtm.h
"

22 
	~"©h_√éök.h
"

24 
πtm_c⁄ãxt
 *
	gg_pRâmC⁄ãxt
;

26 
	$DumpRâRe•
(*
d©a
)

28 
i
 = 0, 
j
 = 0;

29 
n•_mª•hdr
 *
¥e•hdr
 = (n•_mª•hd∏*)
d©a
;

30 
n•_cú_ª•
 *
pcúª•
;

31 
ex∂í
;

32 i‡(
¥e•hdr
)

33 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "NSP Response ReqId : %x "

35 
¥e•hdr
->
ªque°_id
,Öª•hdr->
ª•⁄£_ty≥
,

36 
¥e•hdr
->
no_of_ª•⁄£s
,Öª•hdr->
ªsu…
);

40 
ex∂í
 = (
¥e•hdr
->
no_of_ª•⁄£s
 * (
n•_cú_ª•
)) +

41 (
n•_mª•hdr
);

42 
pcúª•
 =

43 (
n•_cú_ª•
 *)((
u8
 *)
d©a
 + (
n•_mª•hdr
));

45 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "RTT Re•⁄£ SizêEx≥˘ed : %d ", 
ex∂í
);

47 
pcúª•
->
no_of_chaös
 = 2;

48 
i
 = 0; i < 
¥e•hdr
->
no_of_ª•⁄£s
; i++) {

49 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "TOD : %x\n", 
pcúª•
->
tod
);

50 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "TOA : %x\n", 
pcúª•
->
tﬂ
);

51 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "TotalChains : %x\n",

52 
pcúª•
->
no_of_chaös
);

53 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "RSSI0 : %x RSSI1 : %x ",

54 
pcúª•
->
rssi
[0],Öcirresp->rssi[1]);

55 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "SendRate : %x\n",

56 
pcúª•
->
£ndøã
);

57 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "RecvRate : %x\n",

58 
pcúª•
->
ªcvøã
);

59 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "ChannelDump :\n");

60 
j
 = 0; j < 
	`RTTM_CDUMP_SIZE
(
pcúª•
->
no_of_chaös
,

61 
pcúª•
->
isht40
); 
j
++) {

62 
u8
 
k
 = 0;

63 
k
++;

64 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "%x ",

65 
pcúª•
->
ch™√l_dump
[
j
]);

66 i‡(
k
 > 15)

67 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, ("\n"));

69 
pcúª•
++;

71 
	}
}

73 
	$πtm_öô
(*
¨
)

75 
πtm_c⁄ãxt
 *
¥âm
 = 
NULL
;

76 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "rttm init ");

77 
¥âm
 = 
	`kmÆloc
((
πtm_c⁄ãxt
), 
GFP_KERNEL
);

78 i‡(
NULL
 =
¥âm
)

79  -
ENOMEM
;

80 
	`mem£t
(
¥âm
, 0, (
πtm_c⁄ãxt
));

81 
¥âm
->
¨
 =ár;

82 
	`DEV_SETRTT_HDL
(
¥âm
);

84 i‡(0 !
	`©h_√éök_öô
()) {

85 
	`©h6kl_îr
("RTT Init FailedÅo Initialize NetLink Interface\n");

86  -
ENODEV
;

89 
	}
}

91 
	$πtm_ªcv
(*
buf
, 
u32
 
Àn
)

93 
	#RTTM_CONTEXT_PREFIX_OFFSET
 \

94 ((
u32
Ë+ (u32Ë+ (
©h6kl
 *))

	)

96 
πtm_c⁄ãxt
 *
¥âm
 = 
NULL
;

97 
n•_mª•hdr
 *
¥e•hdr
 = (n•_mª•hd∏*)
buf
;

98 
ª•ty≥
 = 
¥e•hdr
->
ª•⁄£_ty≥
;

99 
¥âm
 = 
	`DEV_GETRTT_HDL
();

102 i‡((
ª•ty≥
 =
MRESP_CLKOFFSETCAL_START
) ||

103 (
ª•ty≥
 =
MRESP_CLKOFFSETCAL_END
)) {

104 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
,

105 "RTT ClkCÆ Reque° %d\n", 
ª•ty≥
);

106 i‡(
ª•ty≥
 =
MRESP_CLKOFFSETCAL_START
) {

107 
¥âm
->
πtdh˛kˇl_a˘ive
 = 1;

108 
¥âm
->
dh˛kˇl_ödex
 = 0;

109 } i‡(
ª•ty≥
 =
MRESP_CLKOFFSETCAL_END
) {

110 
¥âm
->
πtdh˛kˇl_a˘ive
 = 0;

111 
¥âm
->
dh˛kˇl_ödex
 = 0;

113 
¥âm
->
mª•hdr
.
‰ame_ty≥
 = 
NSP_RTTCLKCAL_INFO
;

114 
	`πtm_issue_ªque°
(

115 (*)
¥âm
 + 
RTTM_CONTEXT_PREFIX_OFFSET
,

116 
NSP_HDR_LEN
 + (
n•_πt_˛koff£t
));

120 i‡(
buf
 && 
Àn
) {

123 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "NLSíd Lí : %d ", 
Àn
);

124 
	`©h_√éök_£nd
(
buf
, 
Àn
);

128 
	}
}

130 
	$πtm_‰ì
()

132 
πtm_c⁄ãxt
 *
¥âm
 = 
NULL
;

133 
¥âm
 = 
	`DEV_GETRTT_HDL
();

134 i‡(
¥âm
 !
NULL
)

135 
	`k‰ì
(
¥âm
);

136 
	`©h_√éök_‰ì
();

137 
	}
}

140 
	$πtm_issue_ªque°
(*
buf
, 
u32
 
Àn
)

142 
πtm_c⁄ãxt
 *
¥âm
 = 
NULL
;

143 
n•_hódî
 
hdr
;

144 
u32
 
·y≥
;

145 
©h6kl
 *
¨
 = 
NULL
;

146 
wmi_cmd_id
 
cmd_id
 = 
WMI_RTT_MEASREQ_CMDID
;

147 
¥âm
 = 
	`DEV_GETRTT_HDL
();

149 
¨
 = 
¥âm
->ar;

150 
	`mem˝y
(&
hdr
, 
buf
, 
NSP_HDR_LEN
);

151 
·y≥
 = 
hdr
.
‰ame_ty≥
;

152 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "RTT Req Ty≥ : %d Lí : %d ", 
·y≥
, 
Àn
);

153 i‡(
·y≥
 =
NSP_MRQST
) {

154 
n•_mrq°
 *
p°mrq°
 =

155 (
n•_mrq°
 *)(
buf
 + 
NSP_HDR_LEN
);

156 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "NSP Request ID:%d mode:%d "

158 
p°mrq°
->
ªque°_id
,Ö°mrq°->
mode
,

159 
p°mrq°
->
ch™√l
,Ö°mrq°->
no_of_mósuªmíts
,

160 
p°mrq°
->
å™smô_øã
);

161 i‡(
p°mrq°
->
no_of_mósuªmíts
 > 10) {

162 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
,

164 
p°mrq°
->
no_of_mósuªmíts
);

165  -
EINVAL
;

167 
cmd_id
 = 
WMI_RTT_MEASREQ_CMDID
;

168 } i‡(
·y≥
 =
NSP_RTTCONFIG
) {

169 
n•_πt_c⁄fig
 *
p°πtcfg
 =

170 (
n•_πt_c⁄fig
 *)(
buf
 + 
NSP_HDR_LEN
);

171 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "NSP RTTCFG 2gCal%d 5gCal:%d "

174 
p°πtcfg
->
ClkCÆ
[0],Östrttcfg->ClkCal[1],

175 
p°πtcfg
->
FFTSˇÀ
,Ö°πtcfg->
R™geSˇÀ
,

176 
p°πtcfg
->
ClkS≥ed
[0],Östrttcfg->ClkSpeed[1]);

177 
cmd_id
 = 
WMI_RTT_CONFIG_CMDID
;

178 } i‡(
·y≥
 =
NSP_RTTCLKCAL_INFO
) {

179 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "NSP CLK CALINFO CMD\n");

180 
cmd_id
 = 
WMI_RTT_CLKCALINFO_CMDID
;

183 i‡(
	`wmi_πt_ªq
(
¨
->
wmi
, 
cmd_id
, 
buf
 + 
NSP_HDR_LEN
,

184 
Àn
 - 
NSP_HDR_LEN
)) {

185 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "RTT Req Fail ");

186  -
EIO
;

189 
	}
}

	@rttm.h

17 #i‚de‡
_RTTM_H_


18 
	#_RTTM_H_


	)

19 
	~"wœn_loˇti⁄_defs.h
"

20 
	~"πèpi.h
"

21 
	#MAX_NSPMRESP_CIR
 10

	)

23 
	sπt_¥iv_hdr
 {

24 
u8
 
	md⁄e
;

27 
	#MAX_RTT_CIRRESP_RECORDS
 100

	)

28 
	#RTTM_CIR_BUF_SIZE
 (
MAX_RTT_CIRRESP_RECORDS
 * \

29 ((
πt_¥iv_hdr
) + \

30 
MRES_LEN
 + 
CIR_RES_LEN
))

	)

32 
	sπtm_c⁄ãxt
 {

33 
u32
 
	mts1
;

34 
u32
 
	mts2
;

35 
©h6kl
 *
	m¨
;

36 
n•_hódî
 
	mmª•hdr
 ;

37 
n•_πtd2h2_˛koff£t
 
	mπtd2h2_˛k
;

38 
u8
 
	mπtdh˛kˇl_a˘ive
;

39 
u8
 
	mdh˛kˇl_ödex
;

42 
πtm_c⁄ãxt
 *
g_pRâmC⁄ãxt
;

43 
	#DEV_GETRTT_HDL
(Ë
g_pRâmC⁄ãxt


	)

44 
	#DEV_SETRTT_HDL
(
πt
Ë(
g_pRâmC⁄ãxt
 =Ñâ)

	)

	@sdio.c

17 
	~<löux/moduÀ.h
>

18 
	~<löux/gpio.h
>

19 
	~<löux/öãºu±.h
>

20 
	~<löux/mmc/ˇrd.h
>

21 
	~<löux/mmc/mmc.h
>

22 
	~<löux/mmc/ho°.h
>

23 
	~<löux/mmc/sdio_func.h
>

24 
	~<löux/mmc/sdio_ids.h
>

25 
	~<löux/mmc/sdio.h
>

26 
	~<löux/mmc/sd.h
>

27 
	~"hif.h
"

28 
	~"hif-›s.h
"

29 
	~"èrgë.h
"

30 
	~"debug.h
"

31 
	~"cfg80211.h
"

37 #ifde‡
CONFIG_ANDROID


38 
	#PLAT_WOW_GPIO_PIN
 26

	)

41 
	s©h6kl_sdio
 {

42 
sdio_func
 *
	mfunc
;

44 
•ölock_t
 
	mlock
;

47 
li°_hód
 
	mbus_ªq_‰ìq
;

50 
bus_ªque°
 
	mbus_ªq
[
BUS_REQUEST_MAX_NUM
];

52 
©h6kl
 *
	m¨
;

54 
u8
 *
	mdma_buf„r
;

57 
muãx
 
	mdma_buf„r_muãx
;

60 
li°_hód
 
	msˇt_ªq
;

62 
•ölock_t
 
	msˇt_lock
;

63 
boﬁ
 
	msˇâî_íabÀd
;

65 
boﬁ
 
	mis_dißbÀd
;

66 
©omic_t
 
	múq_h™dlög
;

67 c⁄° 
sdio_devi˚_id
 *
	mid
;

68 
w‹k_°ru˘
 
	mwr_async_w‹k
;

69 
li°_hód
 
	mwr_asyncq
;

70 
•ölock_t
 
	mwr_async_lock
;

73 
	#CMD53_ARG_READ
 0

	)

74 
	#CMD53_ARG_WRITE
 1

	)

75 
	#CMD53_ARG_BLOCK_BASIS
 1

	)

76 
	#CMD53_ARG_FIXED_ADDRESS
 0

	)

77 
	#CMD53_ARG_INCR_ADDRESS
 1

	)

79 
ölöe
 
©h6kl_sdio
 *
	$©h6kl_sdio_¥iv
(
©h6kl
 *
¨
)

81  
¨
->
hif_¥iv
;

82 
	}
}

90 
ölöe
 
boﬁ
 
	$buf_√eds_boun˚
(
u8
 *
buf
)

92  ((Ë
buf
 & 0x3Ë|| !
	`vút_addr_vÆid
(buf);

93 
	}
}

95 
	$©h6kl_sdio_£t_mbox_öfo
(
©h6kl
 *
¨
)

97 
©h6kl_mbox_öfo
 *
mbox_öfo
 = &
¨
->mbox_info;

100 
mbox_öfo
->
htc_addr
 = 
HIF_MBOX_BASE_ADDR
;

101 
mbox_öfo
->
htc_ext_addr
 = 
HIF_MBOX0_EXT_BASE_ADDR
;

102 
mbox_öfo
->
htc_ext_sz
 = 
HIF_MBOX0_EXT_WIDTH
;

103 
mbox_öfo
->
block_size
 = 
HIF_MBOX_BLOCK_SIZE
;

104 
mbox_öfo
->
gmbox_addr
 = 
HIF_GMBOX_BASE_ADDR
;

105 
mbox_öfo
->
gmbox_sz
 = 
HIF_GMBOX_WIDTH
;

106 
	}
}

108 
ölöe
 
	$©h6kl_sdio_£t_cmd53_¨g
(
u32
 *
¨g
, 
u8
 
rw
, u8 
func
,

109 
u8
 
mode
, u8 
›code
, 
u32
 
addr
,

110 
u16
 
blksz
)

112 *
¨g
 = (((
rw
 & 1) << 31) |

113 ((
func
 & 0x7) << 28) |

114 ((
mode
 & 1) << 27) |

115 ((
›code
 & 1) << 26) |

116 ((
addr
 & 0x1FFFF) << 9) |

117 (
blksz
 & 0x1FF));

118 
	}
}

120 
ölöe
 
	$©h6kl_sdio_£t_cmd52_¨g
(
u32
 *
¨g
, 
u8
 
wrôe
, u8 
øw
,

121 
addªss
,

122 
vÆ
)

124 c⁄° 
u8
 
func
 = 0;

126 *
¨g
 = ((
wrôe
 & 1) << 31) |

127 ((
func
 & 0x7) << 28) |

128 ((
øw
 & 1) << 27) |

130 ((
addªss
 & 0x1FFFF) << 9) |

132 (
vÆ
 & 0xFF);

133 
	}
}

135 
	$©h6kl_sdio_func0_cmd52_wr_byã
(
mmc_ˇrd
 *
ˇrd
,

136 
addªss
,

137 
byã
)

139 
mmc_comm™d
 
io_cmd
;

141 
	`mem£t
(&
io_cmd
, 0, (io_cmd));

142 
	`©h6kl_sdio_£t_cmd52_¨g
(&
io_cmd
.
¨g
, 1, 0, 
addªss
, 
byã
);

143 
io_cmd
.
›code
 = 
SD_IO_RW_DIRECT
;

144 
io_cmd
.
Êags
 = 
MMC_RSP_R5
 | 
MMC_CMD_AC
;

146  
	`mmc_waô_f‹_cmd
(
ˇrd
->
ho°
, &
io_cmd
, 0);

147 
	}
}

149 
	$©h6kl_sdio_func0_cmd52_rd_byã
(
mmc_ˇrd
 *
ˇrd
,

150 
addªss
,

151 *
byã
)

153 
mmc_comm™d
 
io_cmd
;

154 
u32
 
îr
;

156 *
byã
 = 0;

157 
	`mem£t
(&
io_cmd
, 0, (io_cmd));

158 
	`©h6kl_sdio_£t_cmd52_¨g
(&
io_cmd
.
¨g
, 0, 0, 
addªss
, *
byã
);

159 
io_cmd
.
›code
 = 
SD_IO_RW_DIRECT
;

160 
io_cmd
.
Êags
 = 
MMC_RSP_R5
 | 
MMC_CMD_AC
;

162 
îr
 = 
	`mmc_waô_f‹_cmd
(
ˇrd
->
ho°
, &
io_cmd
, 0);

163 i‡(!
îr
)

164 *
byã
 = 
io_cmd
.
ª•
[0] & 0xff;

166  
îr
;

167 
	}
}

169 
	$©h6kl_sdio_io
(
sdio_func
 *
func
, 
u32
 
ªque°
, u32 
addr
,

170 
u8
 *
buf
, 
u32
 
Àn
)

172 
ªt
 = 0;

174 
	`sdio_˛aim_ho°
(
func
);

176 i‡(
ªque°
 & 
HIF_WRITE
) {

178 i‡(
addr
 >
HIF_MBOX_BASE_ADDR
 &&

179 
addr
 <
HIF_MBOX_END_ADDR
)

180 
addr
 +(
HIF_MBOX_WIDTH
 - 
Àn
);

183 i‡(
addr
 =
HIF_MBOX0_EXT_BASE_ADDR
)

184 
addr
 +
HIF_MBOX0_EXT_WIDTH
 - 
Àn
;

186 i‡(
ªque°
 & 
HIF_FIXED_ADDRESS
)

187 
ªt
 = 
	`sdio_wrôesb
(
func
, 
addr
, 
buf
, 
Àn
);

189 
ªt
 = 
	`sdio_mem˝y_toio
(
func
, 
addr
, 
buf
, 
Àn
);

191 i‡(
ªque°
 & 
HIF_FIXED_ADDRESS
)

192 
ªt
 = 
	`sdio_ªadsb
(
func
, 
buf
, 
addr
, 
Àn
);

194 
ªt
 = 
	`sdio_mem˝y_‰omio
(
func
, 
buf
, 
addr
, 
Àn
);

197 
	`sdio_ªÀa£_ho°
(
func
);

199 
	`©h6kl_dbg
(
ATH6KL_DBG_SDIO
, "%sáddr 0x%x%s buf 0x%pÜen %d\n",

200 
ªque°
 & 
HIF_WRITE
 ? "wr" : "rd", 
addr
,

201 
ªque°
 & 
HIF_FIXED_ADDRESS
 ? " (fixed)" : "", 
buf
, 
Àn
);

202 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_SDIO_DUMP
, 
NULL
, "sdiÿ", 
buf
, 
Àn
);

204  
ªt
;

205 
	}
}

207 
bus_ªque°
 *
	$©h6kl_sdio_Æloc_bu§eq
(
©h6kl_sdio
 *
¨_sdio
)

209 
bus_ªque°
 *
bus_ªq
;

211 
	`•ö_lock_bh
(&
¨_sdio
->
lock
);

213 i‡(
	`li°_em±y
(&
¨_sdio
->
bus_ªq_‰ìq
)) {

214 
	`•ö_u∆ock_bh
(&
¨_sdio
->
lock
);

215  
NULL
;

218 
bus_ªq
 = 
	`li°_fú°_íåy
(&
¨_sdio
->
bus_ªq_‰ìq
,

219 
bus_ªque°
, 
li°
);

220 
	`li°_dñ
(&
bus_ªq
->
li°
);

222 
	`•ö_u∆ock_bh
(&
¨_sdio
->
lock
);

223 
	`©h6kl_dbg
(
ATH6KL_DBG_SCATTER
, "%s: busÑequest 0x%p\n",

224 
__func__
, 
bus_ªq
);

226  
bus_ªq
;

227 
	}
}

229 
	$©h6kl_sdio_‰ì_bus_ªq
(
©h6kl_sdio
 *
¨_sdio
,

230 
bus_ªque°
 *
bus_ªq
)

232 
	`©h6kl_dbg
(
ATH6KL_DBG_SCATTER
, "%s: busÑequest 0x%p\n",

233 
__func__
, 
bus_ªq
);

235 
	`•ö_lock_bh
(&
¨_sdio
->
lock
);

236 
	`li°_add_èû
(&
bus_ªq
->
li°
, &
¨_sdio
->
bus_ªq_‰ìq
);

237 
	`•ö_u∆ock_bh
(&
¨_sdio
->
lock
);

238 
	}
}

240 
	$©h6kl_sdio_£tup_sˇt_d©a
(
hif_sˇâî_ªq
 *
sˇt_ªq
,

241 
mmc_d©a
 *
d©a
)

243 
sˇâîli°
 *
sg
;

244 
i
;

246 
d©a
->
blksz
 = 
HIF_MBOX_BLOCK_SIZE
;

247 
d©a
->
blocks
 = 
sˇt_ªq
->
Àn
 / 
HIF_MBOX_BLOCK_SIZE
;

249 
	`©h6kl_dbg
(
ATH6KL_DBG_SCATTER
,

251 (
sˇt_ªq
->
ªq
 & 
HIF_WRITE
Ë? "WR" : "RD", sˇt_ªq->
addr
,

252 
d©a
->
blksz
, d©a->
blocks
, 
sˇt_ªq
->
Àn
,

253 
sˇt_ªq
->
sˇt_íåõs
);

255 
d©a
->
Êags
 = (
sˇt_ªq
->
ªq
 & 
HIF_WRITE
Ë? 
MMC_DATA_WRITE
 :

256 
MMC_DATA_READ
;

259 
sg
 = 
sˇt_ªq
->
sgíåõs
;

260 
	`sg_öô_èbÀ
(
sg
, 
sˇt_ªq
->
sˇt_íåõs
);

263 
i
 = 0; i < 
sˇt_ªq
->
sˇt_íåõs
; i++, 
sg
++) {

264 
	`©h6kl_dbg
(
ATH6KL_DBG_SCATTER
, "%d:áddr:0x%p,Üen:%d\n",

265 
i
, 
sˇt_ªq
->
sˇt_li°
[i].
buf
,

266 
sˇt_ªq
->
sˇt_li°
[
i
].
Àn
);

268 
	`sg_£t_buf
(
sg
, 
sˇt_ªq
->
sˇt_li°
[
i
].
buf
,

269 
sˇt_ªq
->
sˇt_li°
[
i
].
Àn
);

273 
d©a
->
sg
 = 
sˇt_ªq
->
sgíåõs
;

274 
d©a
->
sg_Àn
 = 
sˇt_ªq
->
sˇt_íåõs
;

275 
	}
}

277 
	$©h6kl_sdio_sˇt_rw
(
©h6kl_sdio
 *
¨_sdio
,

278 
bus_ªque°
 *
ªq
)

280 
mmc_ªque°
 
mmc_ªq
;

281 
mmc_comm™d
 
cmd
;

282 
mmc_d©a
 
d©a
;

283 
hif_sˇâî_ªq
 *
sˇt_ªq
;

284 
u8
 
›code
, 
rw
;

285 
°©us
, 
Àn
;

287 
sˇt_ªq
 = 
ªq
->scat_req;

289 i‡(
sˇt_ªq
->
vút_sˇt
) {

290 
Àn
 = 
sˇt_ªq
->len;

291 i‡(
sˇt_ªq
->
ªq
 & 
HIF_BLOCK_BASIS
)

292 
Àn
 = 
	`round_down
÷í, 
HIF_MBOX_BLOCK_SIZE
);

294 
°©us
 = 
	`©h6kl_sdio_io
(
¨_sdio
->
func
, 
sˇt_ªq
->
ªq
,

295 
sˇt_ªq
->
addr
, sˇt_ªq->
vút_dma_buf
,

296 
Àn
);

297 
sˇt_com∂ëe
;

300 
	`mem£t
(&
mmc_ªq
, 0, (
mmc_ªque°
));

301 
	`mem£t
(&
cmd
, 0, (
mmc_comm™d
));

302 
	`mem£t
(&
d©a
, 0, (
mmc_d©a
));

304 
	`©h6kl_sdio_£tup_sˇt_d©a
(
sˇt_ªq
, &
d©a
);

306 
›code
 = (
sˇt_ªq
->
ªq
 & 
HIF_FIXED_ADDRESS
) ?

307 
CMD53_ARG_FIXED_ADDRESS
 : 
CMD53_ARG_INCR_ADDRESS
;

309 
rw
 = (
sˇt_ªq
->
ªq
 & 
HIF_WRITE
Ë? 
CMD53_ARG_WRITE
 : 
CMD53_ARG_READ
;

312 i‡(
sˇt_ªq
->
ªq
 & 
HIF_WRITE
) {

313 i‡(
sˇt_ªq
->
addr
 =
HIF_MBOX_BASE_ADDR
)

314 
sˇt_ªq
->
addr
 +
HIF_MBOX_WIDTH
 - sˇt_ªq->
Àn
;

317 
sˇt_ªq
->
addr
 +
HIF_MBOX0_EXT_WIDTH
 - sˇt_ªq->
Àn
;

321 
	`©h6kl_sdio_£t_cmd53_¨g
(&
cmd
.
¨g
, 
rw
, 
¨_sdio
->
func
->
num
,

322 
CMD53_ARG_BLOCK_BASIS
, 
›code
, 
sˇt_ªq
->
addr
,

323 
d©a
.
blocks
);

325 
cmd
.
›code
 = 
SD_IO_RW_EXTENDED
;

326 
cmd
.
Êags
 = 
MMC_RSP_SPI_R5
 | 
MMC_RSP_R5
 | 
MMC_CMD_ADTC
;

328 
mmc_ªq
.
cmd
 = &cmd;

329 
mmc_ªq
.
d©a
 = &data;

331 
	`sdio_˛aim_ho°
(
¨_sdio
->
func
);

333 
	`mmc_£t_d©a_timeout
(&
d©a
, 
¨_sdio
->
func
->
ˇrd
);

335 
	`mmc_waô_f‹_ªq
(
¨_sdio
->
func
->
ˇrd
->
ho°
, &
mmc_ªq
);

337 
	`sdio_ªÀa£_ho°
(
¨_sdio
->
func
);

339 
°©us
 = 
cmd
.
îr‹
 ? cmd.îr‹ : 
d©a
.error;

341 
sˇt_com∂ëe
:

342 
sˇt_ªq
->
°©us
 = status;

344 i‡(
sˇt_ªq
->
°©us
)

345 
	`©h6kl_îr
("Scatter writeÑequest failed:%d\n",

346 
sˇt_ªq
->
°©us
);

348 i‡(
sˇt_ªq
->
ªq
 & 
HIF_ASYNCHRONOUS
)

349 
sˇt_ªq
->
	`com∂ëe
(
¨_sdio
->
¨
->
htc_èrgë
, scat_req);

351  
°©us
;

352 
	}
}

354 
	$©h6kl_sdio_Æloc_¥ï_sˇt_ªq
(
©h6kl_sdio
 *
¨_sdio
,

355 
n_sˇt_íåy
, 
n_sˇt_ªq
,

356 
boﬁ
 
vút_sˇt
)

358 
hif_sˇâî_ªq
 *
s_ªq
;

359 
bus_ªque°
 *
bus_ªq
;

360 
i
, 
sˇt_ªq_sz
, 
sˇt_li°_sz
, 
sg_sz
, 
buf_sz
;

361 
u8
 *
vút_buf
;

363 
sˇt_li°_sz
 = (
n_sˇt_íåy
 - 1Ë* (
hif_sˇâî_ôem
);

364 
sˇt_ªq_sz
 = (*
s_ªq
Ë+ 
sˇt_li°_sz
;

366 i‡(!
vút_sˇt
)

367 
sg_sz
 = (
sˇâîli°
Ë* 
n_sˇt_íåy
;

369 
buf_sz
 = 2 * 
L1_CACHE_BYTES
 +

370 
ATH6KL_MAX_TRANSFER_SIZE_PER_SCATTER
;

372 
i
 = 0; i < 
n_sˇt_ªq
; i++) {

374 
s_ªq
 = 
	`kzÆloc
(
sˇt_ªq_sz
, 
GFP_KERNEL
);

375 i‡(!
s_ªq
)

376  -
ENOMEM
;

378 i‡(
vút_sˇt
) {

379 
vút_buf
 = 
	`kzÆloc
(
buf_sz
, 
GFP_KERNEL
);

380 i‡(!
vút_buf
) {

381 
	`k‰ì
(
s_ªq
);

382  -
ENOMEM
;

385 
s_ªq
->
vút_dma_buf
 =

386 (
u8
 *)
	`L1_CACHE_ALIGN
(()
vút_buf
);

389 
s_ªq
->
sgíåõs
 = 
	`kzÆloc
(
sg_sz
, 
GFP_KERNEL
);

391 i‡(!
s_ªq
->
sgíåõs
) {

392 
	`k‰ì
(
s_ªq
);

393  -
ENOMEM
;

398 
bus_ªq
 = 
	`©h6kl_sdio_Æloc_bu§eq
(
¨_sdio
);

399 i‡(!
bus_ªq
) {

400 
	`k‰ì
(
s_ªq
->
sgíåõs
);

401 
	`k‰ì
(
s_ªq
->
vút_dma_buf
);

402 
	`k‰ì
(
s_ªq
);

403  -
ENOMEM
;

407 
bus_ªq
->
sˇt_ªq
 = 
s_ªq
;

408 
s_ªq
->
bu§eque°
 = 
bus_ªq
;

410 
s_ªq
->
vút_sˇt
 = virt_scat;

413 
	`hif_sˇâî_ªq_add
(
¨_sdio
->
¨
, 
s_ªq
);

417 
	}
}

419 
	$©h6kl_sdio_ªad_wrôe_sync
(
©h6kl
 *
¨
, 
u32
 
addr
, 
u8
 *
buf
,

420 
u32
 
Àn
, u32 
ªque°
)

422 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

423 
u8
 *
tbuf
 = 
NULL
;

424 
ªt
;

425 
boﬁ
 
boun˚d
 = 
Ál£
;

427 i‡(
ªque°
 & 
HIF_BLOCK_BASIS
)

428 
Àn
 = 
	`round_down
÷í, 
HIF_MBOX_BLOCK_SIZE
);

430 i‡(
	`buf_√eds_boun˚
(
buf
)) {

431 i‡(!
¨_sdio
->
dma_buf„r
)

432  -
ENOMEM
;

433 
	`muãx_lock
(&
¨_sdio
->
dma_buf„r_muãx
);

434 
tbuf
 = 
¨_sdio
->
dma_buf„r
;

435 
	`mem˝y
(
tbuf
, 
buf
, 
Àn
);

436 
boun˚d
 = 
åue
;

438 
tbuf
 = 
buf
;

440 
ªt
 = 
	`©h6kl_sdio_io
(
¨_sdio
->
func
, 
ªque°
, 
addr
, 
tbuf
, 
Àn
);

441 i‡((
ªque°
 & 
HIF_READ
Ë&& 
boun˚d
)

442 
	`mem˝y
(
buf
, 
tbuf
, 
Àn
);

444 i‡(
boun˚d
)

445 
	`muãx_u∆ock
(&
¨_sdio
->
dma_buf„r_muãx
);

447  
ªt
;

448 
	}
}

450 
	$__©h6kl_sdio_wrôe_async
(
©h6kl_sdio
 *
¨_sdio
,

451 
bus_ªque°
 *
ªq
)

453 i‡(
ªq
->
sˇt_ªq
)

454 
	`©h6kl_sdio_sˇt_rw
(
¨_sdio
, 
ªq
);

456 *
c⁄ãxt
;

457 
°©us
;

459 
°©us
 = 
	`©h6kl_sdio_ªad_wrôe_sync
(
¨_sdio
->
¨
, 
ªq
->
addªss
,

460 
ªq
->
buf„r
,Ñeq->
Àngth
,

461 
ªq
->
ªque°
);

462 
c⁄ãxt
 = 
ªq
->
∑ckë
;

463 
	`©h6kl_sdio_‰ì_bus_ªq
(
¨_sdio
, 
ªq
);

464 
	`©h6kl_hif_rw_comp_h™dÀr
(
c⁄ãxt
, 
°©us
);

466 
	}
}

468 
	$©h6kl_sdio_wrôe_async_w‹k
(
w‹k_°ru˘
 *
w‹k
)

470 
©h6kl_sdio
 *
¨_sdio
;

471 
bus_ªque°
 *
ªq
, *
tmp_ªq
;

473 
¨_sdio
 = 
	`c⁄èöî_of
(
w‹k
, 
©h6kl_sdio
, 
wr_async_w‹k
);

475 
	`•ö_lock_bh
(&
¨_sdio
->
wr_async_lock
);

476 
	`li°_f‹_óch_íåy_ß„
(
ªq
, 
tmp_ªq
, &
¨_sdio
->
wr_asyncq
, 
li°
) {

477 
	`li°_dñ
(&
ªq
->
li°
);

478 
	`•ö_u∆ock_bh
(&
¨_sdio
->
wr_async_lock
);

479 
	`__©h6kl_sdio_wrôe_async
(
¨_sdio
, 
ªq
);

480 
	`•ö_lock_bh
(&
¨_sdio
->
wr_async_lock
);

482 
	`•ö_u∆ock_bh
(&
¨_sdio
->
wr_async_lock
);

483 
	}
}

485 
	$©h6kl_sdio_úq_h™dÀr
(
sdio_func
 *
func
)

487 
°©us
;

488 
©h6kl_sdio
 *
¨_sdio
;

490 
	`©h6kl_dbg
(
ATH6KL_DBG_SDIO
, "irq\n");

492 
¨_sdio
 = 
	`sdio_gë_drvd©a
(
func
);

493 
	`©omic_£t
(&
¨_sdio
->
úq_h™dlög
, 1);

499 
	`sdio_ªÀa£_ho°
(
¨_sdio
->
func
);

501 
°©us
 = 
	`©h6kl_hif_öå_bh_h™dÀr
(
¨_sdio
->
¨
);

502 
	`sdio_˛aim_ho°
(
¨_sdio
->
func
);

503 
	`©omic_£t
(&
¨_sdio
->
úq_h™dlög
, 0);

504 
	`WARN_ON
(
°©us
 && sètu†!-
ECANCELED
);

505 
	}
}

507 
	$©h6kl_sdio_powî_⁄
(
©h6kl
 *
¨
)

509 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

510 
sdio_func
 *
func
 = 
¨_sdio
->func;

511 
ªt
 = 0;

513 i‡(!
¨_sdio
->
is_dißbÀd
)

516 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "sdioÖower on\n");

518 
	`sdio_˛aim_ho°
(
func
);

520 
ªt
 = 
	`sdio_íabÀ_func
(
func
);

521 i‡(
ªt
) {

522 
	`©h6kl_îr
("U«bÀÅÿíabÀ sdiÿfunc: %d)\n", 
ªt
);

523 
	`sdio_ªÀa£_ho°
(
func
);

524  
ªt
;

527 
	`sdio_ªÀa£_ho°
(
func
);

533 
	`u¶ìp_ønge
(10000, 10000);

535 
¨_sdio
->
is_dißbÀd
 = 
Ál£
;

537  
ªt
;

538 
	}
}

540 
	$©h6kl_sdio_powî_off
(
©h6kl
 *
¨
)

542 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

543 
ªt
;

544 
num
;

546 i‡(
¨_sdio
->
is_dißbÀd
)

549 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "sdioÖower off\n");

552 
	`sdio_˛aim_ho°
(
¨_sdio
->
func
);

554 
num
 = 
¨_sdio
->
func
->num;

555 
¨_sdio
->
func
->
num
 = 0;

556 
	`sdio_wrôeb
(
¨_sdio
->
func
, 0x05, 0xf0, &
ªt
);

557 
¨_sdio
->
func
->
num
 =Çum;

559 
ªt
 = 
	`sdio_dißbÀ_func
(
¨_sdio
->
func
);

560 
	`sdio_ªÀa£_ho°
(
¨_sdio
->
func
);

562 i‡(
ªt
)

563  
ªt
;

565 
¨_sdio
->
is_dißbÀd
 = 
åue
;

567  
ªt
;

568 
	}
}

570 
	$©h6kl_sdio_wrôe_async
(
©h6kl
 *
¨
, 
u32
 
addªss
, 
u8
 *
buf„r
,

571 
u32
 
Àngth
, u32 
ªque°
,

572 
htc_∑ckë
 *
∑ckë
)

574 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

575 
bus_ªque°
 *
bus_ªq
;

577 
bus_ªq
 = 
	`©h6kl_sdio_Æloc_bu§eq
(
¨_sdio
);

579 i‡(!
bus_ªq
)

580  -
ENOMEM
;

582 
bus_ªq
->
addªss
 =áddress;

583 
bus_ªq
->
buf„r
 = buffer;

584 
bus_ªq
->
Àngth
 =Üength;

585 
bus_ªq
->
ªque°
 =Ñequest;

586 
bus_ªq
->
∑ckë
 =Öacket;

588 
	`•ö_lock_bh
(&
¨_sdio
->
wr_async_lock
);

589 
	`li°_add_èû
(&
bus_ªq
->
li°
, &
¨_sdio
->
wr_asyncq
);

590 
	`•ö_u∆ock_bh
(&
¨_sdio
->
wr_async_lock
);

591 
	`queue_w‹k
(
¨
->
©h6kl_wq
, &
¨_sdio
->
wr_async_w‹k
);

594 
	}
}

596 
	$©h6kl_sdio_úq_íabÀ
(
©h6kl
 *
¨
)

598 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

599 
ªt
;

601 
	`sdio_˛aim_ho°
(
¨_sdio
->
func
);

604 
ªt
 = 
	`sdio_˛aim_úq
(
¨_sdio
->
func
, 
©h6kl_sdio_úq_h™dÀr
);

605 i‡(
ªt
)

606 
	`©h6kl_îr
("FaûedÅÿ˛aim sdiÿúq: %d\n", 
ªt
);

608 
	`sdio_ªÀa£_ho°
(
¨_sdio
->
func
);

609 
	}
}

611 
	$©h6kl_sdio_úq_dißbÀ
(
©h6kl
 *
¨
)

613 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

614 
ªt
;

616 
	`sdio_˛aim_ho°
(
¨_sdio
->
func
);

619 
	`©omic_ªad
(&
¨_sdio
->
úq_h™dlög
)) {

620 
	`sdio_ªÀa£_ho°
(
¨_sdio
->
func
);

621 
	`scheduÀ_timeout
(
HZ
 / 10);

622 
	`sdio_˛aim_ho°
(
¨_sdio
->
func
);

625 
ªt
 = 
	`sdio_ªÀa£_úq
(
¨_sdio
->
func
);

626 i‡(
ªt
)

627 
	`©h6kl_îr
("FaûedÅÿªÀa£ sdiÿúq: %d\n", 
ªt
);

629 
	`sdio_ªÀa£_ho°
(
¨_sdio
->
func
);

630 
	}
}

632 
hif_sˇâî_ªq
 *
	$©h6kl_sdio_sˇâî_ªq_gë
(
©h6kl
 *
¨
)

634 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

635 
hif_sˇâî_ªq
 *
node
 = 
NULL
;

637 
	`•ö_lock_bh
(&
¨_sdio
->
sˇt_lock
);

639 i‡(!
	`li°_em±y
(&
¨_sdio
->
sˇt_ªq
)) {

640 
node
 = 
	`li°_fú°_íåy
(&
¨_sdio
->
sˇt_ªq
,

641 
hif_sˇâî_ªq
, 
li°
);

642 
	`li°_dñ
(&
node
->
li°
);

644 
node
->
sˇt_q_dïth
 = 
	`gë_queue_dïth
(&
¨_sdio
->
sˇt_ªq
);

647 
	`•ö_u∆ock_bh
(&
¨_sdio
->
sˇt_lock
);

649  
node
;

650 
	}
}

652 
	$©h6kl_sdio_sˇâî_ªq_add
(
©h6kl
 *
¨
,

653 
hif_sˇâî_ªq
 *
s_ªq
)

655 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

657 
	`•ö_lock_bh
(&
¨_sdio
->
sˇt_lock
);

659 
	`li°_add_èû
(&
s_ªq
->
li°
, &
¨_sdio
->
sˇt_ªq
);

661 
	`•ö_u∆ock_bh
(&
¨_sdio
->
sˇt_lock
);

663 
	}
}

666 
	$©h6kl_sdio_async_rw_sˇâî
(
©h6kl
 *
¨
,

667 
hif_sˇâî_ªq
 *
sˇt_ªq
)

669 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

670 
u32
 
ªque°
 = 
sˇt_ªq
->
ªq
;

671 
°©us
 = 0;

673 i‡(!
sˇt_ªq
->
Àn
)

674  -
EINVAL
;

676 
	`©h6kl_dbg
(
ATH6KL_DBG_SCATTER
,

678 
sˇt_ªq
->
Àn
, sˇt_ªq->
sˇt_íåõs
);

680 i‡(
ªque°
 & 
HIF_SYNCHRONOUS
)

681 
°©us
 = 
	`©h6kl_sdio_sˇt_rw
(
¨_sdio
, 
sˇt_ªq
->
bu§eque°
);

683 
	`•ö_lock_bh
(&
¨_sdio
->
wr_async_lock
);

684 
	`li°_add_èû
(&
sˇt_ªq
->
bu§eque°
->
li°
, &
¨_sdio
->
wr_asyncq
);

685 
	`•ö_u∆ock_bh
(&
¨_sdio
->
wr_async_lock
);

686 
	`queue_w‹k
(
¨
->
©h6kl_wq
, &
¨_sdio
->
wr_async_w‹k
);

689  
°©us
;

690 
	}
}

693 
	$©h6kl_sdio_˛ónup_sˇâî
(
©h6kl
 *
¨
)

695 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

696 
hif_sˇâî_ªq
 *
s_ªq
, *
tmp_ªq
;

699 
	`•ö_lock_bh
(&
¨_sdio
->
sˇt_lock
);

700 
	`li°_f‹_óch_íåy_ß„
(
s_ªq
, 
tmp_ªq
, &
¨_sdio
->
sˇt_ªq
, 
li°
) {

701 
	`li°_dñ
(&
s_ªq
->
li°
);

702 
	`•ö_u∆ock_bh
(&
¨_sdio
->
sˇt_lock
);

709 i‡(
s_ªq
->
bu§eque°
)

710 
	`©h6kl_sdio_‰ì_bus_ªq
(
¨_sdio
, 
s_ªq
->
bu§eque°
);

711 
	`k‰ì
(
s_ªq
->
vút_dma_buf
);

712 
	`k‰ì
(
s_ªq
->
sgíåõs
);

713 
	`k‰ì
(
s_ªq
);

715 
	`•ö_lock_bh
(&
¨_sdio
->
sˇt_lock
);

717 
	`•ö_u∆ock_bh
(&
¨_sdio
->
sˇt_lock
);

718 
	}
}

721 
	$©h6kl_sdio_íabÀ_sˇâî
(
©h6kl
 *
¨
)

723 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

724 
htc_èrgë
 *
èrgë
 = 
¨
->htc_target;

725 
ªt
;

726 
boﬁ
 
vút_sˇt
 = 
Ál£
;

728 i‡(
¨_sdio
->
sˇâî_íabÀd
)

731 
¨_sdio
->
sˇâî_íabÀd
 = 
åue
;

734 i‡(
¨_sdio
->
func
->
ˇrd
->
ho°
->
max_£gs
 < 
MAX_SCATTER_ENTRIES_PER_REQ
) {

735 
	`©h6kl_îr
("host only supports scatter of :%dÉntries,Çeed: %d\n",

736 
¨_sdio
->
func
->
ˇrd
->
ho°
->
max_£gs
,

737 
MAX_SCATTER_ENTRIES_PER_REQ
);

738 
vút_sˇt
 = 
åue
;

741 i‡(!
vút_sˇt
) {

742 
ªt
 = 
	`©h6kl_sdio_Æloc_¥ï_sˇt_ªq
(
¨_sdio
,

743 
MAX_SCATTER_ENTRIES_PER_REQ
,

744 
MAX_SCATTER_REQUESTS
, 
vút_sˇt
);

746 i‡(!
ªt
) {

747 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

749 
MAX_SCATTER_REQUESTS
,

750 
MAX_SCATTER_ENTRIES_PER_REQ
);

752 
èrgë
->
max_sˇt_íåõs
 = 
MAX_SCATTER_ENTRIES_PER_REQ
;

753 
èrgë
->
max_x„r_sz≥r_sˇåeq
 =

754 
MAX_SCATTER_REQ_TRANSFER_SIZE
;

756 
	`©h6kl_sdio_˛ónup_sˇâî
(
¨
);

757 
	`©h6kl_w¨n
("hif scatterÑesource setup failed,Årying virtual scatter method\n");

761 i‡(
vút_sˇt
 || 
ªt
) {

762 
ªt
 = 
	`©h6kl_sdio_Æloc_¥ï_sˇt_ªq
(
¨_sdio
,

763 
ATH6KL_SCATTER_ENTRIES_PER_REQ
,

764 
ATH6KL_SCATTER_REQS
, 
vút_sˇt
);

766 i‡(
ªt
) {

767 
	`©h6kl_îr
("failedÅoálloc virtual scatterÑesources !\n");

768 
	`©h6kl_sdio_˛ónup_sˇâî
(
¨
);

769  
ªt
;

772 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

774 
ATH6KL_SCATTER_REQS
, 
ATH6KL_SCATTER_ENTRIES_PER_REQ
);

776 
èrgë
->
max_sˇt_íåõs
 = 
ATH6KL_SCATTER_ENTRIES_PER_REQ
;

777 
èrgë
->
max_x„r_sz≥r_sˇåeq
 =

778 
ATH6KL_MAX_TRANSFER_SIZE_PER_SCATTER
;

782 
	}
}

784 
	$©h6kl_sdio_c⁄fig
(
©h6kl
 *
¨
)

786 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

787 
sdio_func
 *
func
 = 
¨_sdio
->func;

788 
ªt
;

790 
	`sdio_˛aim_ho°
(
func
);

792 i‡((
¨_sdio
->
id
->
devi˚
 & 
MANUFACTURER_ID_ATH6KL_BASE_MASK
) >=

793 
MANUFACTURER_ID_AR6003_BASE
) {

794 
sdio_úq_mode
;

796 
ªt
 = 
	`©h6kl_sdio_func0_cmd52_rd_byã
(
func
->
ˇrd
,

797 
CCCR_SDIO_IRQ_MODE_REG
,

798 &
sdio_úq_mode
);

799 i‡(
ªt
) {

800 
	`©h6kl_îr
("FailedÅoÑead CCCR SDIO IRQ modeÑeg %d\n",

801 
ªt
);

802 
out
;

803 } i‡(!(
sdio_úq_mode
 & 
SDIO_IRQ_MODE_ASYNC_4BIT_IRQ
)) {

805 
ªt
 = 
	`©h6kl_sdio_func0_cmd52_wr_byã
(
func
->
ˇrd
,

806 
CCCR_SDIO_IRQ_MODE_REG
,

807 (
sdio_úq_mode
 | 
SDIO_IRQ_MODE_ASYNC_4BIT_IRQ
));

808 i‡(
ªt
) {

809 
	`©h6kl_îr
("FailedÅoÉnable 4-bitásync irq mode %d\n",

810 
ªt
);

811 
out
;

814 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "4-bitásync irq modeÉnabled\n");

819 
func
->
íabÀ_timeout
 = 100;

821 
ªt
 = 
	`sdio_£t_block_size
(
func
, 
HIF_MBOX_BLOCK_SIZE
);

822 i‡(
ªt
) {

823 
	`©h6kl_îr
("Set sdio block size %d failed: %d)\n",

824 
HIF_MBOX_BLOCK_SIZE
, 
ªt
);

825 
	`sdio_ªÀa£_ho°
(
func
);

826 
out
;

829 
out
:

830 
	`sdio_ªÀa£_ho°
(
func
);

832  
ªt
;

833 
	}
}

835 
	$©h6kl_sdio_su•íd
(
©h6kl
 *
¨
, 
cfg80211_wowœn
 *
wow
)

837 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

838 
sdio_func
 *
func
 = 
¨_sdio
->func;

839 
mmc_pm_Êag_t
 
Êags
;

840 
ªt
;

842 
Êags
 = 
	`sdio_gë_ho°_pm_ˇps
(
func
);

844 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
 | 
ATH6KL_DBG_EXT_INFO1
,

846 
Êags
);

848 i‡(!(
Êags
 & 
MMC_PM_KEEP_POWER
) ||

849 (
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_SUSPEND_CUTPOWER
)) {

851  
	`©h6kl_cfg80211_su•íd
(
¨
, 
ATH6KL_CFG_SUSPEND_CUTPOWER
,

852 
NULL
);

855 
ªt
 = 
	`sdio_£t_ho°_pm_Êags
(
func
, 
MMC_PM_KEEP_POWER
);

856 i‡(
ªt
) {

857 
	`¥ötk
(
KERN_ERR
 "ath6kl: set sdioÖm flags failed: %d\n",

858 
ªt
);

859  
ªt
;

861 #ifde‡
CONFIG_ANDROID


862 i‡((
Êags
 & 
MMC_PM_WAKE_SDIO_IRQ
)

863 && 
	`©h6kl_™droid_√ed_wow_su•íd
(
¨
)) {

865 i‡((
Êags
 & 
MMC_PM_WAKE_SDIO_IRQ
Ë&& 
wow
) {

872 
ªt
 = 
	`©h6kl_cfg80211_su•íd
(
¨
, 
ATH6KL_CFG_SUSPEND_WOW
, 
wow
);

873 i‡(
ªt
)

874  
ªt
;

876 
ªt
 = 
	`sdio_£t_ho°_pm_Êags
(
func
, 
MMC_PM_WAKE_SDIO_IRQ
);

877 i‡(
ªt
)

878 
	`©h6kl_îr
("£àsdiÿwakêúq fœg faûed: %d\n", 
ªt
);

880  
ªt
;

883  
	`©h6kl_cfg80211_su•íd
(
¨
, 
ATH6KL_CFG_SUSPEND_DEEPSLEEP
, 
NULL
);

884 
	}
}

886 
	$©h6kl_sdio_ªsume
(
©h6kl
 *
¨
)

888 
	`©h6kl_dbg
(
ATH6KL_DBG_EXT_INFO1
, "sdiÿªsume: sèã %d\n", 
¨
->
°©e
);

890 
¨
->
°©e
) {

891 
ATH6KL_STATE_OFF
:

892 
ATH6KL_STATE_CUTPOWER
:

893 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
,

897 
	`©h6kl_sdio_c⁄fig
(
¨
);

900 
ATH6KL_STATE_ON
:

903 
ATH6KL_STATE_DEEPSLEEP
:

906 
ATH6KL_STATE_WOW
:

909 
ATH6KL_STATE_PRE_SUSPEND
:

912 
ATH6KL_STATE_PRE_SUSPEND_DEEPSLEEP
:

916 
	`©h6kl_cfg80211_ªsume
(
¨
);

919 
	}
}

922 
	$©h6kl_£t_addrwö_ªg
(
©h6kl
 *
¨
, 
u32
 
ªg_addr
, u32 
addr
)

924 
°©us
;

925 
u8
 
addr_vÆ
[4];

926 
s32
 
i
;

933 
i
 = 1; i <= 3; i++) {

938 
	`mem£t
(
addr_vÆ
, ((
u8
 *)&
addr
)[
i
], 4);

945 
°©us
 = 
	`©h6kl_sdio_ªad_wrôe_sync
(
¨
, 
ªg_addr
 + 
i
, 
addr_vÆ
,

946 4, 
HIF_WR_SYNC_BYTE_FIX
);

947 i‡(
°©us
)

951 i‡(
°©us
) {

952 
	`©h6kl_îr
("%s: failedÅo write initial bytes of 0x%x "

953 "tÿwödowÑeg: 0x%X\n", 
__func__
,

954 
addr
, 
ªg_addr
);

955  
°©us
;

964 
°©us
 = 
	`©h6kl_sdio_ªad_wrôe_sync
(
¨
, 
ªg_addr
, (
u8
 *)(&
addr
),

965 4, 
HIF_WR_SYNC_BYTE_INC
);

967 i‡(
°©us
) {

968 
	`©h6kl_îr
("%s: failedÅo write 0x%xÅo windowÑeg: 0x%X\n",

969 
__func__
, 
addr
, 
ªg_addr
);

970  
°©us
;

974 
	}
}

976 
	$©h6kl_sdio_düg_ªad32
(
©h6kl
 *
¨
, 
u32
 
addªss
, u32 *
d©a
)

978 
°©us
;

981 
°©us
 = 
	`©h6kl_£t_addrwö_ªg
(
¨
, 
WINDOW_READ_ADDR_ADDRESS
,

982 
addªss
);

984 i‡(
°©us
)

985  
°©us
;

988 
°©us
 = 
	`©h6kl_sdio_ªad_wrôe_sync
(
¨
, 
WINDOW_DATA_ADDRESS
,

989 (
u8
 *)
d©a
, (
u32
), 
HIF_RD_SYNC_BYTE_INC
);

990 i‡(
°©us
) {

991 
	`©h6kl_îr
("%s: failedÅoÑead from window dataáddr\n",

992 
__func__
);

993  
°©us
;

996  
°©us
;

997 
	}
}

999 
	$©h6kl_sdio_düg_wrôe32
(
©h6kl
 *
¨
, 
u32
 
addªss
,

1000 
__À32
 
d©a
)

1002 
°©us
;

1003 
u32
 
vÆ
 = (
__f‹˚
 u32Ë
d©a
;

1006 
°©us
 = 
	`©h6kl_sdio_ªad_wrôe_sync
(
¨
, 
WINDOW_DATA_ADDRESS
,

1007 (
u8
 *Ë&
vÆ
, (
u32
), 
HIF_WR_SYNC_BYTE_INC
);

1008 i‡(
°©us
) {

1009 
	`©h6kl_îr
("%s: failedÅo write 0x%xÅo window dataáddr\n",

1010 
__func__
, 
d©a
);

1011  
°©us
;

1015  
	`©h6kl_£t_addrwö_ªg
(
¨
, 
WINDOW_WRITE_ADDR_ADDRESS
,

1016 
addªss
);

1017 
	}
}

1019 
	$©h6kl_sdio_bmi_¸edôs
(
©h6kl
 *
¨
)

1021 
u32
 
addr
;

1022 
timeout
;

1023 
ªt
;

1025 
¨
->
bmi
.
cmd_¸edôs
 = 0;

1028 
addr
 = 
COUNT_DEC_ADDRESS
 + (
HTC_MAILBOX_NUM_MAX
 + 
ENDPOINT1
) * 4;

1030 
timeout
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
BMI_COMMUNICATION_TIMEOUT
);

1031 
	`time_bef‹e
(
jiffõs
, 
timeout
Ë&& !
¨
->
bmi
.
cmd_¸edôs
) {

1039 
ªt
 = 
	`©h6kl_sdio_ªad_wrôe_sync
(
¨
, 
addr
,

1040 (
u8
 *)&
¨
->
bmi
.
cmd_¸edôs
, 4,

1041 
HIF_RD_SYNC_BYTE_INC
);

1042 i‡(
ªt
) {

1043 
	`©h6kl_îr
("UnableÅo decrementÅhe command credit "

1044 "cou¡Ñegi°î: %d\n", 
ªt
);

1045  
ªt
;

1051 
¨
->
bmi
.
cmd_¸edôs
 &= 0xFF;

1054 i‡(!
¨
->
bmi
.
cmd_¸edôs
) {

1055 
	`©h6kl_îr
("bmi communicationÅimeout\n");

1056  -
ETIMEDOUT
;

1060 
	}
}

1062 
	$©h6kl_bmi_gë_rx_lkahd
(
©h6kl
 *
¨
)

1064 
timeout
;

1065 
u32
 
rx_w‹d
 = 0;

1066 
ªt
 = 0;

1068 
timeout
 = 
jiffõs
 + 
	`m£cs_to_jiffõs
(
BMI_COMMUNICATION_TIMEOUT
);

1069 (
	`time_bef‹e
(
jiffõs
, 
timeout
)Ë&& !
rx_w‹d
) {

1070 
ªt
 = 
	`©h6kl_sdio_ªad_wrôe_sync
(
¨
,

1071 
RX_LOOKAHEAD_VALID_ADDRESS
,

1072 (
u8
 *)&
rx_w‹d
, (rx_word),

1073 
HIF_RD_SYNC_BYTE_INC
);

1074 i‡(
ªt
) {

1075 
	`©h6kl_îr
("unableÅoÑead RX_LOOKAHEAD_VALID\n");

1076  
ªt
;

1080 
rx_w‹d
 &(1 << 
ENDPOINT1
);

1083 i‡(!
rx_w‹d
) {

1084 
	`©h6kl_îr
("bmi_recv_buf FIFOÉmpty\n");

1085  -
EINVAL
;

1088  
ªt
;

1089 
	}
}

1091 
	$©h6kl_sdio_bmi_wrôe
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
u32
 
Àn
)

1093 
ªt
;

1094 
u32
 
addr
;

1096 
ªt
 = 
	`©h6kl_sdio_bmi_¸edôs
(
¨
);

1097 i‡(
ªt
)

1098  
ªt
;

1100 
addr
 = 
¨
->
mbox_öfo
.
htc_addr
;

1102 
ªt
 = 
	`©h6kl_sdio_ªad_wrôe_sync
(
¨
, 
addr
, 
buf
, 
Àn
,

1103 
HIF_WR_SYNC_BYTE_INC
);

1104 i‡(
ªt
)

1105 
	`©h6kl_îr
("unableÅo sendÅhe bmi dataÅoÅhe device\n");

1107  
ªt
;

1108 
	}
}

1110 
	$©h6kl_sdio_bmi_ªad
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
u32
 
Àn
)

1112 
ªt
;

1113 
u32
 
addr
;

1161 i‡(
Àn
 >= 4) {

1162 
ªt
 = 
	`©h6kl_bmi_gë_rx_lkahd
(
¨
);

1163 i‡(
ªt
)

1164  
ªt
;

1167 
addr
 = 
¨
->
mbox_öfo
.
htc_addr
;

1168 
ªt
 = 
	`©h6kl_sdio_ªad_wrôe_sync
(
¨
, 
addr
, 
buf
, 
Àn
,

1169 
HIF_RD_SYNC_BYTE_INC
);

1170 i‡(
ªt
) {

1171 
	`©h6kl_îr
("UnableÅoÑeadÅhe bmi data fromÅhe device: %d\n",

1172 
ªt
);

1173  
ªt
;

1177 
	}
}

1179 
	$©h6kl_sdio_°›
(
©h6kl
 *
¨
)

1181 
©h6kl_sdio
 *
¨_sdio
 = 
	`©h6kl_sdio_¥iv
(
¨
);

1182 
bus_ªque°
 *
ªq
, *
tmp_ªq
;

1183 *
c⁄ãxt
;

1187 
	`ˇn˚l_w‹k_sync
(&
¨_sdio
->
wr_async_w‹k
);

1189 
	`•ö_lock_bh
(&
¨_sdio
->
wr_async_lock
);

1191 
	`li°_f‹_óch_íåy_ß„
(
ªq
, 
tmp_ªq
, &
¨_sdio
->
wr_asyncq
, 
li°
) {

1192 
	`li°_dñ
(&
ªq
->
li°
);

1194 i‡(
ªq
->
sˇt_ªq
) {

1196 
ªq
->
sˇt_ªq
->
°©us
 = -
ECANCELED
;

1197 
ªq
->
sˇt_ªq
->
	`com∂ëe
(
¨_sdio
->
¨
->
htc_èrgë
,

1198 
ªq
->
sˇt_ªq
);

1200 
c⁄ãxt
 = 
ªq
->
∑ckë
;

1201 
	`©h6kl_sdio_‰ì_bus_ªq
(
¨_sdio
, 
ªq
);

1202 
	`©h6kl_hif_rw_comp_h™dÀr
(
c⁄ãxt
, -
ECANCELED
);

1206 
	`•ö_u∆ock_bh
(&
¨_sdio
->
wr_async_lock
);

1208 
	`WARN_ON
(
	`gë_queue_dïth
(&
¨_sdio
->
sˇt_ªq
) != 4);

1209 
	}
}

1211 
	$©h6kl_sdio_°©
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
)

1216 
	}
}

1218 #ifde‡
CONFIG_HAS_EARLYSUSPEND


1219 
	$©h6kl_sdio_óæy_su•íd
(
©h6kl
 *
¨
)

1222 
	}
}

1224 
	$©h6kl_sdio_œã_ªsume
(
©h6kl
 *
¨
)

1227 
	}
}

1230 
	$©h6kl_sdio_bus_c⁄fig
(
©h6kl
 *
¨
)

1233 
	}
}

1235 
	$©h6kl_sdio_düg_w¨m_ª£t
(
©h6kl
 *
¨
)

1238 
	}
}

1240 #ifde‡
USB_AUTO_SUSPEND


1241 
	$sdio_auto_pm_dißbÀ
(
©h6kl
 *
¨
)

1244 
	}
}

1246 
	$sdio_auto_pm_íabÀ
(
©h6kl
 *
¨
)

1249 
	}
}

1251 
	$sdio_auto_pm_tu∫⁄
(
©h6kl
 *
¨
)

1254 
	}
}

1257 
	$sdio_auto_pm_tu∫off
(
©h6kl
 *
¨
)

1260 
	}
}

1262 
	$sdio_debugfs_gë_pm_ußge_˙t
(
©h6kl
 *
¨
)

1265 
	}
}

1268 c⁄° 
©h6kl_hif_›s
 
	g©h6kl_sdio_›s
 = {

1269 .
ªad_wrôe_sync
 = 
©h6kl_sdio_ªad_wrôe_sync
,

1270 .
	gwrôe_async
 = 
©h6kl_sdio_wrôe_async
,

1271 .
	gúq_íabÀ
 = 
©h6kl_sdio_úq_íabÀ
,

1272 .
	gúq_dißbÀ
 = 
©h6kl_sdio_úq_dißbÀ
,

1273 .
	gsˇâî_ªq_gë
 = 
©h6kl_sdio_sˇâî_ªq_gë
,

1274 .
	gsˇâî_ªq_add
 = 
©h6kl_sdio_sˇâî_ªq_add
,

1275 .
	gíabÀ_sˇâî
 = 
©h6kl_sdio_íabÀ_sˇâî
,

1276 .
	gsˇt_ªq_rw
 = 
©h6kl_sdio_async_rw_sˇâî
,

1277 .
	g˛ónup_sˇâî
 = 
©h6kl_sdio_˛ónup_sˇâî
,

1278 .
	gsu•íd
 = 
©h6kl_sdio_su•íd
,

1279 .
	gªsume
 = 
©h6kl_sdio_ªsume
,

1280 .
	gdüg_ªad32
 = 
©h6kl_sdio_düg_ªad32
,

1281 .
	gdüg_wrôe32
 = 
©h6kl_sdio_düg_wrôe32
,

1282 .
	gbmi_ªad
 = 
©h6kl_sdio_bmi_ªad
,

1283 .
	gbmi_wrôe
 = 
©h6kl_sdio_bmi_wrôe
,

1284 .
	gpowî_⁄
 = 
©h6kl_sdio_powî_⁄
,

1285 .
	gpowî_off
 = 
©h6kl_sdio_powî_off
,

1286 .
	g°›
 = 
©h6kl_sdio_°›
,

1287 .
	ggë_°©
 = 
©h6kl_sdio_°©
,

1288 .
	gdüg_w¨m_ª£t
 = 
©h6kl_sdio_düg_w¨m_ª£t
,

1289 #ifde‡
CONFIG_HAS_EARLYSUSPEND


1290 .
	góæy_su•íd
 = 
©h6kl_sdio_óæy_su•íd
,

1291 .
	gœã_ªsume
 = 
©h6kl_sdio_œã_ªsume
,

1293 .
	gbus_c⁄fig
 = 
©h6kl_sdio_bus_c⁄fig
,

1294 #ifde‡
USB_AUTO_SUSPEND


1295 .
	gauto_pm_dißbÀ
 = 
sdio_auto_pm_dißbÀ
,

1296 .
	gauto_pm_íabÀ
 = 
sdio_auto_pm_íabÀ
,

1297 .
	gauto_pm_tu∫⁄
 = 
sdio_auto_pm_tu∫⁄
,

1298 .
	gauto_pm_tu∫off
 = 
sdio_auto_pm_tu∫off
,

1299 .
	gauto_pm_gë_ußge_˙t
 = 
sdio_debugfs_gë_pm_ußge_˙t
,

1303 #ifde‡
CONFIG_PM_SLEEP


1309 
	$©h6kl_sdio_pm_su•íd
(
devi˚
 *device)

1311 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
, "sdioÖm suspend\n");

1314 
	}
}

1316 
	$©h6kl_sdio_pm_ªsume
(
devi˚
 *device)

1318 
	`©h6kl_dbg
(
ATH6KL_DBG_SUSPEND
, "sdioÖmÑesume\n");

1321 
	}
}

1323 
SIMPLE_DEV_PM_OPS
(
©h6kl_sdio_pm_›s
, 
©h6kl_sdio_pm_su•íd
,

1324 
©h6kl_sdio_pm_ªsume
);

1326 
	#ATH6KL_SDIO_PM_OPS
 (&
©h6kl_sdio_pm_›s
)

	)

1330 
	#ATH6KL_SDIO_PM_OPS
 
NULL


	)

1334 
	$©h6kl_sdio_¥obe
(
sdio_func
 *
func
,

1335 c⁄° 
sdio_devi˚_id
 *
id
)

1337 
ªt
;

1338 
©h6kl_sdio
 *
¨_sdio
;

1339 
©h6kl
 *
¨
;

1340 
cou¡
;

1342 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

1344 
func
->
num
, func->
víd‹
, func->
devi˚
,

1345 
func
->
max_blksize
, func->
cur_blksize
);

1347 
¨_sdio
 = 
	`kzÆloc
((
©h6kl_sdio
), 
GFP_KERNEL
);

1348 i‡(!
¨_sdio
)

1349  -
ENOMEM
;

1351 
¨_sdio
->
dma_buf„r
 = 
	`kzÆloc
(
HIF_DMA_BUFFER_SIZE
, 
GFP_KERNEL
);

1352 i‡(!
¨_sdio
->
dma_buf„r
) {

1353 
ªt
 = -
ENOMEM
;

1354 
îr_hif
;

1357 
¨_sdio
->
func
 = func;

1358 
	`sdio_£t_drvd©a
(
func
, 
¨_sdio
);

1360 
¨_sdio
->
id
 = id;

1361 
¨_sdio
->
is_dißbÀd
 = 
åue
;

1363 
	`•ö_lock_öô
(&
¨_sdio
->
lock
);

1364 
	`•ö_lock_öô
(&
¨_sdio
->
sˇt_lock
);

1365 
	`•ö_lock_öô
(&
¨_sdio
->
wr_async_lock
);

1366 
	`muãx_öô
(&
¨_sdio
->
dma_buf„r_muãx
);

1368 
	`INIT_LIST_HEAD
(&
¨_sdio
->
sˇt_ªq
);

1369 
	`INIT_LIST_HEAD
(&
¨_sdio
->
bus_ªq_‰ìq
);

1370 
	`INIT_LIST_HEAD
(&
¨_sdio
->
wr_asyncq
);

1372 
	`INIT_WORK
(&
¨_sdio
->
wr_async_w‹k
, 
©h6kl_sdio_wrôe_async_w‹k
);

1374 
cou¡
 = 0; cou¡ < 
BUS_REQUEST_MAX_NUM
; count++)

1375 
	`©h6kl_sdio_‰ì_bus_ªq
(
¨_sdio
, &¨_sdio->
bus_ªq
[
cou¡
]);

1377 
¨
 = 
	`©h6kl_c‹e_Æloc
(&
¨_sdio
->
func
->
dev
);

1378 i‡(!
¨
) {

1379 
	`©h6kl_îr
("FailedÅoállocáth6kl core\n");

1380 
ªt
 = -
ENOMEM
;

1381 
îr_dma
;

1384 
¨_sdio
->
¨
 =ár;

1385 
¨
->
hif_ty≥
 = 
ATH6KL_HIF_TYPE_SDIO
;

1386 
¨
->
hif_¥iv
 = 
¨_sdio
;

1387 
¨
->
hif_›s
 = &
©h6kl_sdio_›s
;

1388 
¨
->
bmi
.
max_d©a_size
 = 256;

1389 #ifde‡
CONFIG_ANDROID


1390 i‡(
PLAT_WOW_GPIO_PIN
)

1391 
¨
->
wow_úq
 = 
	`gpio_to_úq
(
PLAT_WOW_GPIO_PIN
);

1394 
	`©h6kl_sdio_£t_mbox_öfo
(
¨
);

1396 
ªt
 = 
	`©h6kl_sdio_c⁄fig
(
¨
);

1397 i‡(
ªt
) {

1398 
	`©h6kl_îr
("FaûedÅÿc⁄fig sdio: %d\n", 
ªt
);

1399 
îr_c‹e_Æloc
;

1402 
	`©h6kl_htc_mbox_©èch
(
¨
);

1403 
ªt
 = 
	`©h6kl_c‹e_öô
(
¨
);

1404 i‡(
ªt
) {

1405 
	`©h6kl_îr
("FailedÅo initáth6kl core\n");

1406 
îr_c‹e_Æloc
;

1409  
ªt
;

1411 
îr_c‹e_Æloc
:

1412 
	`©h6kl_c‹e_‰ì
(
¨_sdio
->
¨
);

1413 
îr_dma
:

1414 
	`k‰ì
(
¨_sdio
->
dma_buf„r
);

1415 
îr_hif
:

1416 
	`k‰ì
(
¨_sdio
);

1418  
ªt
;

1419 
	}
}

1421 
	$©h6kl_sdio_ªmove
(
sdio_func
 *
func
)

1423 
©h6kl_sdio
 *
¨_sdio
;

1425 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

1427 
func
->
num
, func->
víd‹
, func->
devi˚
);

1429 
¨_sdio
 = 
	`sdio_gë_drvd©a
(
func
);

1431 
	`©h6kl_°›_txrx
(
¨_sdio
->
¨
);

1432 
	`ˇn˚l_w‹k_sync
(&
¨_sdio
->
wr_async_w‹k
);

1434 
	`©h6kl_c‹e_˛ónup
(
¨_sdio
->
¨
);

1436 
	`k‰ì
(
¨_sdio
->
dma_buf„r
);

1437 
	`k‰ì
(
¨_sdio
);

1438 
	}
}

1440 c⁄° 
sdio_devi˚_id
 
	g©h6kl_sdio_devi˚s
[] = {

1441 {
SDIO_DEVICE
(
MANUFACTURER_CODE
, (
MANUFACTURER_ID_AR6003_BASE
 | 0x0))},

1442 {
SDIO_DEVICE
(
MANUFACTURER_CODE
, (
MANUFACTURER_ID_AR6003_BASE
 | 0x1))},

1443 {
SDIO_DEVICE
(
MANUFACTURER_CODE
, (
MANUFACTURER_ID_AR6004_BASE
 | 0x0))},

1444 {
SDIO_DEVICE
(
MANUFACTURER_CODE
, (
MANUFACTURER_ID_AR6004_BASE
 | 0x1))},

1445 {
SDIO_DEVICE
(
MANUFACTURER_CODE
, (
MANUFACTURER_ID_AR6004_BASE
 | 0x2))},

1446 {
SDIO_DEVICE
(
MANUFACTURER_CODE
, (
MANUFACTURER_ID_AR6006_BASE
 | 0x0))},

1447 {
SDIO_DEVICE
(
MANUFACTURER_CODE
, (
MANUFACTURER_ID_AR6006_BASE
 | 0x1))},

1451 
MODULE_DEVICE_TABLE
(
sdio
, 
©h6kl_sdio_devi˚s
);

1453 
sdio_drivî
 
	g©h6kl_sdio_drivî
 = {

1454 .
«me
 = "ath6kl_sdio",

1455 .
	gid_èbÀ
 = 
©h6kl_sdio_devi˚s
,

1456 .
	g¥obe
 = 
©h6kl_sdio_¥obe
,

1457 .
	gªmove
 = 
©h6kl_sdio_ªmove
,

1458 .
	gdrv
.
	gpm
 = 
ATH6KL_SDIO_PM_OPS
,

1461 
__öô
 
	$©h6kl_sdio_öô
()

1463 
ªt
;

1465 #ifde‡
CONFIG_ANDROID


1466 
	`©h6kl_sdio_öô_msm
();

1468 
ªt
 = 
	`sdio_ªgi°î_drivî
(&
©h6kl_sdio_drivî
);

1469 i‡(
ªt
)

1470 
	`©h6kl_îr
("sdiÿdrivîÑegi°øti⁄ faûed: %d\n", 
ªt
);

1472  
ªt
;

1473 
	}
}

1475 
__exô
 
	$©h6kl_sdio_exô
()

1477 
	`sdio_uƒegi°î_drivî
(&
©h6kl_sdio_drivî
);

1478 #ifde‡
CONFIG_ANDROID


1479 
	`©h6kl_sdio_exô_msm
();

1481 
	}
}

1483 
moduÀ_öô
(
©h6kl_sdio_öô
);

1484 
moduÀ_exô
(
©h6kl_sdio_exô
);

1486 
MODULE_AUTHOR
("Atheros Communications, Inc.");

1487 
MODULE_DESCRIPTION
("Driver support for Atheros AR600x SDIO devices");

1488 
MODULE_LICENSE
("Dual BSD/GPL");

1489 
MODULE_VERSION
(
DRV_VERSION
);

1490 
MODULE_FIRMWARE
(
AR6003_HW_2_0_FW_DIR
 "/" 
AR6003_HW_2_0_OTP_FILE
);

1491 
MODULE_FIRMWARE
(
AR6003_HW_2_0_FW_DIR
 "/" 
AR6003_HW_2_0_FIRMWARE_FILE
);

1492 
MODULE_FIRMWARE
(
AR6003_HW_2_0_FW_DIR
 "/" 
AR6003_HW_2_0_PATCH_FILE
);

1493 
MODULE_FIRMWARE
(
AR6003_HW_2_0_BOARD_DATA_FILE
);

1494 
MODULE_FIRMWARE
(
AR6003_HW_2_0_DEFAULT_BOARD_DATA_FILE
);

1495 
MODULE_FIRMWARE
(
AR6003_HW_2_1_1_FW_DIR
 "/" 
AR6003_HW_2_1_1_OTP_FILE
);

1496 
MODULE_FIRMWARE
(
AR6003_HW_2_1_1_FW_DIR
 "/" 
AR6003_HW_2_1_1_FIRMWARE_FILE
);

1497 
MODULE_FIRMWARE
(
AR6003_HW_2_1_1_FW_DIR
 "/" 
AR6003_HW_2_1_1_PATCH_FILE
);

1498 
MODULE_FIRMWARE
(
AR6003_HW_2_1_1_BOARD_DATA_FILE
);

1499 
MODULE_FIRMWARE
(
AR6003_HW_2_1_1_DEFAULT_BOARD_DATA_FILE
);

1500 
MODULE_FIRMWARE
(
AR6004_HW_1_0_FW_DIR
 "/" 
AR6004_HW_1_0_FIRMWARE_FILE
);

1501 
MODULE_FIRMWARE
(
AR6004_HW_1_0_FW_DIR
 "/" 
AR6004_HW_1_0_OTP_FILE
);

1502 
MODULE_FIRMWARE
(
AR6004_HW_1_0_BOARD_DATA_FILE
);

1503 
MODULE_FIRMWARE
(
AR6004_HW_1_0_DEFAULT_BOARD_DATA_FILE
);

1504 
MODULE_FIRMWARE
(
AR6004_HW_1_1_FW_DIR
 "/" 
AR6004_HW_1_1_FIRMWARE_FILE
);

1505 
MODULE_FIRMWARE
(
AR6004_HW_1_1_FW_DIR
 "/" 
AR6004_HW_1_1_OTP_FILE
);

1506 
MODULE_FIRMWARE
(
AR6004_HW_1_1_BOARD_DATA_FILE
);

1507 
MODULE_FIRMWARE
(
AR6004_HW_1_1_DEFAULT_BOARD_DATA_FILE
);

1508 
MODULE_FIRMWARE
(
AR6004_HW_1_2_FW_DIR
 "/" 
AR6004_HW_1_2_FIRMWARE_FILE
);

1509 
MODULE_FIRMWARE
(
AR6004_HW_1_2_FW_DIR
 "/" 
AR6004_HW_1_2_OTP_FILE
);

1510 
MODULE_FIRMWARE
(
AR6004_HW_1_2_BOARD_DATA_FILE
);

1511 
MODULE_FIRMWARE
(
AR6004_HW_1_2_DEFAULT_BOARD_DATA_FILE
);

1512 
MODULE_FIRMWARE
(
AR6004_HW_1_3_FW_DIR
 "/" 
AR6004_HW_1_3_FIRMWARE_FILE
);

1513 
MODULE_FIRMWARE
(
AR6004_HW_1_3_FW_DIR
 "/" 
AR6004_HW_1_3_OTP_FILE
);

1514 
MODULE_FIRMWARE
(
AR6004_HW_1_3_BOARD_DATA_FILE
);

1515 
MODULE_FIRMWARE
(
AR6004_HW_1_3_DEFAULT_BOARD_DATA_FILE
);

1516 
MODULE_FIRMWARE
(
AR6004_HW_2_0_FW_DIR
 "/" 
AR6004_HW_2_0_FIRMWARE_FILE
);

1517 
MODULE_FIRMWARE
(
AR6004_HW_2_0_FW_DIR
 "/" 
AR6004_HW_2_0_OTP_FILE
);

1518 
MODULE_FIRMWARE
(
AR6004_HW_2_0_BOARD_DATA_FILE
);

1519 
MODULE_FIRMWARE
(
AR6004_HW_2_0_DEFAULT_BOARD_DATA_FILE
);

1520 
MODULE_FIRMWARE
(
AR6006_HW_1_0_FW_DIR
 "/" 
AR6006_HW_1_0_FIRMWARE_FILE
);

1521 
MODULE_FIRMWARE
(
AR6006_HW_1_0_BOARD_DATA_FILE
);

1522 
MODULE_FIRMWARE
(
AR6006_HW_1_0_DEFAULT_BOARD_DATA_FILE
);

	@target.h

17 #i‚de‡
TARGET_H


18 
	#TARGET_H


	)

20 
	#AR6003_BOARD_DATA_SZ
 1024

	)

21 
	#AR6003_BOARD_EXT_DATA_SZ
 768

	)

23 
	#AR6004_BOARD_DATA_SZ
 6144

	)

24 
	#AR6004_BOARD_EXT_DATA_SZ
 0

	)

26 
	#AR6006_BOARD_DATA_SZ
 6144

	)

27 
	#AR6006_BOARD_EXT_DATA_SZ
 0

	)

29 
	#RESET_CONTROL_ADDRESS
 0x00000000

	)

30 
	#RESET_CONTROL_COLD_RST
 0x00000100

	)

31 
	#RESET_CONTROL_MBOX_RST
 0x00000004

	)

33 
	#CPU_CLOCK_STANDARD_S
 0

	)

34 
	#CPU_CLOCK_STANDARD
 0x00000003

	)

35 
	#CPU_CLOCK_ADDRESS
 0x00000020

	)

37 
	#CLOCK_CONTROL_ADDRESS
 0x00000028

	)

38 
	#CLOCK_CONTROL_LF_CLK32_S
 2

	)

39 
	#CLOCK_CONTROL_LF_CLK32
 0x00000004

	)

41 
	#SYSTEM_SLEEP_ADDRESS
 0x000000c4

	)

42 
	#SYSTEM_SLEEP_DISABLE_S
 0

	)

43 
	#SYSTEM_SLEEP_DISABLE
 0x00000001

	)

45 
	#LPO_CAL_ADDRESS
 0x000000e0

	)

46 
	#LPO_CAL_ENABLE_S
 20

	)

47 
	#LPO_CAL_ENABLE
 0x00100000

	)

49 
	#GPIO_PIN10_ADDRESS
 0x00000050

	)

50 
	#GPIO_PIN11_ADDRESS
 0x00000054

	)

51 
	#GPIO_PIN12_ADDRESS
 0x00000058

	)

52 
	#GPIO_PIN13_ADDRESS
 0x0000005c

	)

54 
	#HOST_INT_STATUS_ADDRESS
 0x00000400

	)

55 
	#HOST_INT_STATUS_ERROR_S
 7

	)

56 
	#HOST_INT_STATUS_ERROR
 0x00000080

	)

58 
	#HOST_INT_STATUS_CPU_S
 6

	)

59 
	#HOST_INT_STATUS_CPU
 0x00000040

	)

61 
	#HOST_INT_STATUS_COUNTER_S
 4

	)

62 
	#HOST_INT_STATUS_COUNTER
 0x00000010

	)

64 
	#CPU_INT_STATUS_ADDRESS
 0x00000401

	)

66 
	#ERROR_INT_STATUS_ADDRESS
 0x00000402

	)

67 
	#ERROR_INT_STATUS_WAKEUP_S
 2

	)

68 
	#ERROR_INT_STATUS_WAKEUP
 0x00000004

	)

70 
	#ERROR_INT_STATUS_RX_UNDERFLOW_S
 1

	)

71 
	#ERROR_INT_STATUS_RX_UNDERFLOW
 0x00000002

	)

73 
	#ERROR_INT_STATUS_TX_OVERFLOW_S
 0

	)

74 
	#ERROR_INT_STATUS_TX_OVERFLOW
 0x00000001

	)

76 
	#COUNTER_INT_STATUS_ADDRESS
 0x00000403

	)

77 
	#COUNTER_INT_STATUS_COUNTER_S
 0

	)

78 
	#COUNTER_INT_STATUS_COUNTER
 0x000000ff

	)

80 
	#RX_LOOKAHEAD_VALID_ADDRESS
 0x00000405

	)

82 
	#INT_STATUS_ENABLE_ADDRESS
 0x00000418

	)

83 
	#INT_STATUS_ENABLE_ERROR_S
 7

	)

84 
	#INT_STATUS_ENABLE_ERROR
 0x00000080

	)

86 
	#INT_STATUS_ENABLE_CPU_S
 6

	)

87 
	#INT_STATUS_ENABLE_CPU
 0x00000040

	)

89 
	#INT_STATUS_ENABLE_INT_S
 5

	)

90 
	#INT_STATUS_ENABLE_INT
 0x00000020

	)

91 
	#INT_STATUS_ENABLE_COUNTER_S
 4

	)

92 
	#INT_STATUS_ENABLE_COUNTER
 0x00000010

	)

94 
	#INT_STATUS_ENABLE_MBOX_DATA_S
 0

	)

95 
	#INT_STATUS_ENABLE_MBOX_DATA
 0x0000000f

	)

97 
	#CPU_INT_STATUS_ENABLE_ADDRESS
 0x00000419

	)

98 
	#CPU_INT_STATUS_ENABLE_BIT_S
 0

	)

99 
	#CPU_INT_STATUS_ENABLE_BIT
 0x000000ff

	)

101 
	#ERROR_STATUS_ENABLE_ADDRESS
 0x0000041a

	)

102 
	#ERROR_STATUS_ENABLE_RX_UNDERFLOW_S
 1

	)

103 
	#ERROR_STATUS_ENABLE_RX_UNDERFLOW
 0x00000002

	)

105 
	#ERROR_STATUS_ENABLE_TX_OVERFLOW_S
 0

	)

106 
	#ERROR_STATUS_ENABLE_TX_OVERFLOW
 0x00000001

	)

108 
	#COUNTER_INT_STATUS_ENABLE_ADDRESS
 0x0000041b

	)

109 
	#COUNTER_INT_STATUS_ENABLE_BIT_S
 0

	)

110 
	#COUNTER_INT_STATUS_ENABLE_BIT
 0x000000ff

	)

112 
	#COUNT_ADDRESS
 0x00000420

	)

114 
	#COUNT_DEC_ADDRESS
 0x00000440

	)

116 
	#WINDOW_DATA_ADDRESS
 0x00000474

	)

117 
	#WINDOW_WRITE_ADDR_ADDRESS
 0x00000478

	)

118 
	#WINDOW_READ_ADDR_ADDRESS
 0x0000047c

	)

119 
	#CPU_DBG_SEL_ADDRESS
 0x00000483

	)

120 
	#CPU_DBG_ADDRESS
 0x00000484

	)

122 
	#LOCAL_SCRATCH_ADDRESS
 0x000000c0

	)

123 
	#ATH6KL_OPTION_SLEEP_DISABLE
 0x08

	)

125 
	#RTC_BASE_ADDRESS
 0x00004000

	)

126 
	#GPIO_BASE_ADDRESS
 0x00014000

	)

127 
	#MBOX_BASE_ADDRESS
 0x00018000

	)

128 
	#ANALOG_INTF_BASE_ADDRESS
 0x0001c000

	)

129 
	#WLAN_BOOTSTRAP_ADDRESS
 0x00014140

	)

131 
	#BOOTSTRAP_IS_HSIC
(
v
Ë((vË& (1 << 10))

	)

132 
	#BOOTSTRAP_IS_USB
(
v
Ë((vË& (1 << 11))

	)

135 
	#ATH6KL_ANALOG_PLL_REGISTER
 (
ANALOG_INTF_BASE_ADDRESS
 + 0x284)

	)

137 
	#SM
(
f
, 
v
Ë(((vË<< f##
_S
Ë& f)

	)

138 
	#MS
(
f
, 
v
Ë(((vË& fË>> f##
_S
)

	)

148 
	#ATH6KL_AR6003_HI_START_ADDR
 0x00540600

	)

149 
	#ATH6KL_AR6004_HI_START_ADDR
 0x00400800

	)

150 
	#ATH6KL_AR6006_HI_START_ADDR
 0x00428800

	)

164 
	sho°_öãª°
 {

169 
u32
 
	mhi_≠p_ho°_öãª°
;

172 
u32
 
	mhi_Áûuª_°©e
;

175 
u32
 
	mhi_dbglog_hdr
;

177 
u32
 
	mhi_unu£d1
;

183 
u32
 
	mhi_›ti⁄_Êag
;

189 
u32
 
	mhi_£rül_íabÀ
;

192 
u32
 
	mhi_d£t_li°_hód
;

195 
u32
 
	mhi_≠p_°¨t
;

198 
u32
 
	mhi_skù_˛ock_öô
;

199 
u32
 
	mhi_c‹e_˛ock_£âög
;

200 
u32
 
	mhi_˝u_˛ock_£âög
;

201 
u32
 
	mhi_sy°em_¶ìp_£âög
;

202 
u32
 
	mhi_xèl_c⁄åﬁ_£âög
;

203 
u32
 
	mhi_∂l_˘æ_£âög_24ghz
;

204 
u32
 
	mhi_∂l_˘æ_£âög_5ghz
;

205 
u32
 
	mhi_ªf_vﬁège_åim_£âög
;

206 
u32
 
	mhi_˛ock_öfo
;

214 
u32
 
	mhi_b™k0_addr_vÆue
;

215 
u32
 
	mhi_b™k0_ªad_vÆue
;

216 
u32
 
	mhi_b™k0_wrôe_vÆue
;

217 
u32
 
	mhi_b™k0_c⁄fig_vÆue
;

220 
u32
 
	mhi_bﬂrd_d©a
;

221 
u32
 
	mhi_bﬂrd_d©a_öôülized
;

223 
u32
 
	mhi_d£t_øm_ödex_tbl
;

225 
u32
 
	mhi_desúed_baud_øã
;

226 
u32
 
	mhi_dbglog_c⁄fig
;

227 
u32
 
	mhi_íd_øm_ª£rve_sz
;

228 
u32
 
	mhi_mbox_io_block_sz
;

230 
u32
 
	mhi_num_b∑tch_°ªams
;

231 
u32
 
	mhi_mbox_i§_yõld_limô
;

233 
u32
 
	mhi_ªf˛k_hz
;

234 
u32
 
	mhi_ext_˛k_dëe˘ed
;

235 
u32
 
	mhi_dbg_u¨t_txpö
;

236 
u32
 
	mhi_dbg_u¨t_rxpö
;

237 
u32
 
	mhi_hci_u¨t_baud
;

238 
u32
 
	mhi_hci_u¨t_pö_assignmíts
;

243 
u32
 
	mhi_hci_u¨t_baud_sˇÀ_vÆ
;

244 
u32
 
	mhi_hci_u¨t_baud_°ï_vÆ
;

246 
u32
 
	mhi_Ælo¸am_°¨t
;

247 
u32
 
	mhi_Ælo¸am_sz
;

248 
u32
 
	mhi_hci_bridge_Êags
;

249 
u32
 
	mhi_hci_u¨t_suµ‹t_pös
;

254 
u32
 
	mhi_hci_u¨t_pwr_mgmt_∑øms
;

261 
u32
 
	mhi_bﬂrd_ext_d©a
;

262 
u32
 
	mhi_bﬂrd_ext_d©a_c⁄fig
;

273 
u32
 
	mhi_ª£t_Êag
;

275 
u32
 
	mhi_ª£t_Êag_vÆid
;

276 
u32
 
	mhi_hci_u¨t_pwr_mgmt_∑øms_ext
;

281 
u32
 
	mhi_acs_Êags
;

282 
u32
 
	mhi_c⁄sﬁe_Êags
;

283 
u32
 
	mhi_nvøm_°©e
;

284 
u32
 
	mhi_›ti⁄_Êag2
;

287 
u32
 
	mhi_sw_vîsi⁄_ovîride
;

288 
u32
 
	mhi_abi_vîsi⁄_ovîride
;

294 
u32
 
	mhi_hp_rx_åaffic_øtio
;

297 
u32
 
	mhi_ã°_≠ps_ªœãd
 ;

299 
u32
 
	mhi_Ÿa_ã°s¸ùt
;

301 
u32
 
	mhi_ˇl_d©a
;

303 
u32
 
	mhi_pkéog_num_buf„rs
;

305 
u32
 
	mhi_wow_ext_c⁄fig
;

307 
u32
 
	mhi_pwr_ßve_Êags
;

309 
u32
 
	mhi_smps_›ti⁄s
;

311 } 
	g__∑cked
;

313 
	#HI_ITEM
(
ôem
Ë
	`off£tof
(
ho°_öãª°
, iãm)

	)

315 
	#HI_OPTION_MAC_ADDR_METHOD_SHIFT
 3

	)

317 
	#HI_OPTION_FW_MODE_IBSS
 0x0

	)

318 
	#HI_OPTION_FW_MODE_BSS_STA
 0x1

	)

319 
	#HI_OPTION_FW_MODE_AP
 0x2

	)

321 
	#HI_OPTION_FW_SUBMODE_NONE
 0x0

	)

322 
	#HI_OPTION_FW_SUBMODE_P2PDEV
 0x1

	)

323 
	#HI_OPTION_FW_SUBMODE_P2PCLIENT
 0x2

	)

324 
	#HI_OPTION_FW_SUBMODE_P2PGO
 0x3

	)

326 
	#HI_OPTION_DISABLE_DBGLOG
 0x40

	)

329 
	#HI_OPTION_DISABLE_MAC_OTP
 0x40

	)

331 
	#HI_OPTION_NUM_DEV_SHIFT
 0x9

	)

333 
	#HI_OPTION_FW_BRIDGE_SHIFT
 0x04

	)

336 
	#HI_OPTION_DISABLE_RTT
 0x20

	)

339 
	#HI_OPTION_DISABLE_P2P_DEDICATE
 0x100

	)

342 
	#HI_OPTION_EXT_FW_DOWNLOAD_DONE
 0x80000

	)

345 
	#HI_OPTION_FW_CRASH_COLD_RESET
 0x100000

	)

348 
	#HI_OPTION_FW_WATCHDOG_ENABLE
 0x200000

	)

351 
	#HI_OPTION_ENABLE_PANASONIC_WAR
 0x1000000

	)

354 
	#HI_OPTION_ONE_SHOT_NOA_ENABLE
 0x2000000

	)

357 
	#HI_OPTION_ENABLE_SB_SPECIFIC
 0x4000000

	)

360 
	#HI_OPTION_WOW_SINGLE_CHAIN
 0x8000000

	)

363 
	#HI_OPTION_ENABLE_WLAN_HB
 0x10000000

	)

366 
	#HI_OPTION_MCC_ENABLE
 0x80000000

	)

375 
	#HI_OPTION_FW_MODE_BITS
 0x2

	)

376 
	#HI_OPTION_FW_MODE_SHIFT
 0xC

	)

378 
	#HI_OPTION_FW_SUBMODE_BITS
 0x2

	)

379 
	#HI_OPTION_FW_SUBMODE_SHIFT
 0x14

	)

382 
	#HI_PWR_SAVE_LPL_ENABLED
 0x1

	)

385 
	#HI_PWR_SAVE_LPL_MODE_RPL
 2

	)

386 
	#HI_PWR_SAVE_LPL_MODE_LSB
 4

	)

389 
	#HI_SMPS_ALLOW_MASK
 0x1

	)

392 
	#AR6003_VTOP
(
vaddr
Ë((vaddrË& 0x001fffff)

	)

393 
	#AR6004_VTOP
(
vaddr
Ë(vaddr)

	)

394 
	#AR6006_VTOP
(
vaddr
Ë(vaddr)

	)

396 
	#TARG_VTOP
(
èrgë_ty≥
, 
vaddr
) \

397 (((
èrgë_ty≥
Ë=
TARGET_TYPE_AR6003
Ë? 
	`AR6003_VTOP
(
vaddr
) : \

398 (((
èrgë_ty≥
Ë=
TARGET_TYPE_AR6004
Ë? 
	`AR6004_VTOP
(
vaddr
) : \

399 (((
èrgë_ty≥
Ë=
TARGET_TYPE_AR6006
Ë? 
	`AR6006_VTOP
(
vaddr
Ë: 0)))

	)

401 
	#ATH6KL_FWLOG_PAYLOAD_SIZE
 1500

	)

403 
	s©h6kl_dbglog_buf
 {

404 
__À32
 
	m√xt
;

405 
__À32
 
	mbuf„r_addr
;

406 
__À32
 
	mbufsize
;

407 
__À32
 
	mÀngth
;

408 
__À32
 
	mcou¡
;

409 
__À32
 
	m‰ì
;

410 } 
	g__∑cked
;

412 
	s©h6kl_dbglog_hdr
 {

413 
__À32
 
	mdbuf_addr
;

414 
__À32
 
	mdr›≥d
;

415 } 
	g__∑cked
;

	@testmode.c

17 
	~"ã°mode.h
"

19 
	~<√t/√éök.h
>

21 
	~"c‹e.h
"

27 #i‚de‡
NLA_PUT


28 
	#NLA_PUT_U32
 
∆a_put_u32


	)

29 
	#NLA_PUT
 
∆a_put


	)

31 
	#_NLA_PUT_ERR_RTN


	)

34 
	e©h6kl_tm_©å
 {

35 
	m__ATH6KL_TM_ATTR_INVALID
 = 0,

36 
	mATH6KL_TM_ATTR_CMD
 = 1,

37 
	mATH6KL_TM_ATTR_DATA
 = 2,

38 
	mATH6KL_TM_ATTR_TYPE
 = 3,

41 
	m__ATH6KL_TM_ATTR_AFTER_LAST
,

42 
	mATH6KL_TM_ATTR_MAX
 = 
__ATH6KL_TM_ATTR_AFTER_LAST
 - 1,

45 
	e©h6kl_tm_cmd
 {

46 
	mATH6KL_TM_CMD_TCMD
 = 0,

47 
	mATH6KL_TM_CMD_WLAN_HB
 = 1,

48 
	mATH6KL_TM_CMD_WIFI_DISC
 = 2,

49 
	mATH6KL_TM_CMD_WIFI_KTK
 = 3,

50 
	mATH6KL_TM_CMD_DFS_SKIP
 = 4,

53 
	#ATH6KL_TM_DATA_MAX_LEN
 5000

	)

55 c⁄° 
∆a_pﬁicy
 
	g©h6kl_tm_pﬁicy
[
ATH6KL_TM_ATTR_MAX
 + 1] = {

56 [
ATH6KL_TM_ATTR_CMD
] = { .
ty≥
 = 
NLA_U32
 },

57 [
ATH6KL_TM_ATTR_DATA
] = { .
ty≥
 = 
NLA_BINARY
,

58 .
	gÀn
 = 
ATH6KL_TM_DATA_MAX_LEN
 },

61 #ifde‡
CONFIG_NL80211_TESTMODE


63 
	$©h6kl_tm_rx_ªp‹t_evít
(
©h6kl
 *
¨
, *
buf
, 
size_t
 
buf_Àn
)

65 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
))

68 
	`k‰ì
(
¨
->
tm
.
rx_ªp‹t
);

70 
¨
->
tm
.
rx_ªp‹t
 = 
	`kmemdup
(
buf
, 
buf_Àn
, 
GFP_KERNEL
);

71 
¨
->
tm
.
rx_ªp‹t_Àn
 = 
buf_Àn
;

73 
	`up
(&
¨
->
£m
);

75 
	`wake_up
(&
¨
->
evít_wq
);

76 
	}
}

78 
	$©h6kl_tm_rx_evít
(
©h6kl
 *
¨
, *
buf
, 
size_t
 
buf_Àn
)

80 
sk_buff
 *
skb
;

82 i‡(!
buf
 || 
buf_Àn
 == 0) {

83 
	`¥ötk
(
KERN_ERR
 "buf buflen isÉmpty\n");

87 
skb
 = 
	`cfg80211_ã°mode_Æloc_evít_skb
(
¨
->
wùhy
, 
buf_Àn
, 
GFP_ATOMIC
);

89 i‡(!
skb
) {

90 
	`¥ötk
(
KERN_ERR
 "failedÅoállocateÅestmodeÑx skb!\n");

94 
	`NLA_PUT_U32
(
skb
, 
ATH6KL_TM_ATTR_CMD
, 
ATH6KL_TM_CMD_TCMD
);

95 
	`NLA_PUT
(
skb
, 
ATH6KL_TM_ATTR_DATA
, 
buf_Àn
, 
buf
);

96 
	`cfg80211_ã°mode_evít
(
skb
, 
GFP_ATOMIC
);

99 #ifde‡
_NLA_PUT_ERR_RTN


100 
∆a_put_Áûuª
:

101 
	`k‰ì_skb
(
skb
);

102 
	`¥ötk
(
KERN_ERR
 "nla_put failed onÅestmodeÑx skb!\n");

105 
	}
}

107 #ifde‡
ATH6KL_SUPPORT_WLAN_HB


108 
	$©h6kl_wœn_hb_evít
(
©h6kl
 *
¨
, 
u8
 
vÆue
,

109 *
buf
, 
size_t
 
buf_Àn
)

111 
sk_buff
 *
skb
;

113 i‡(!
buf
 || 
buf_Àn
 == 0) {

114 
	`¥ötk
(
KERN_ERR
 "buf buflen isÉmpty\n");

118 
skb
 = 
	`cfg80211_ã°mode_Æloc_evít_skb
(
¨
->
wùhy
, 
buf_Àn
, 
GFP_ATOMIC
);

120 i‡(!
skb
) {

121 
	`¥ötk
(
KERN_ERR
 "failedÅoállocateÅestmodeÉvent skb!\n");

125 
	`NLA_PUT_U32
(
skb
, 
ATH6KL_TM_ATTR_CMD
, 
ATH6KL_TM_CMD_WLAN_HB
);

126 
	`NLA_PUT_U32
(
skb
, 
ATH6KL_TM_ATTR_TYPE
, 
vÆue
);

127 
	`NLA_PUT
(
skb
, 
ATH6KL_TM_ATTR_DATA
, 
buf_Àn
, 
buf
);

128 
	`cfg80211_ã°mode_evít
(
skb
, 
GFP_ATOMIC
);

131 #ifde‡
_NLA_PUT_ERR_RTN


132 
∆a_put_Áûuª
:

133 
	`k‰ì_skb
(
skb
);

134 
	`¥ötk
(
KERN_ERR
 "nla_put failed onÅestmodeÉvent skb!\n");

136 
	}
}

139 #ifde‡
ATH6KL_SUPPORT_WIFI_DISC


140 
	$©h6kl_tm_disc_evít
(
©h6kl
 *
¨
, *
buf
, 
size_t
 
buf_Àn
)

142 
sk_buff
 *
skb
;

144 i‡(!
buf
 || 
buf_Àn
 == 0) {

145 
	`¥ötk
(
KERN_ERR
 "buf buflen isÉmpty\n");

149 
skb
 = 
	`cfg80211_ã°mode_Æloc_evít_skb
(
¨
->
wùhy
, 
buf_Àn
, 
GFP_ATOMIC
);

151 i‡(!
skb
) {

152 
	`¥ötk
(
KERN_ERR
 "failedÅoállocateÅestmodeÉvent skb!\n");

156 
	`NLA_PUT_U32
(
skb
, 
ATH6KL_TM_ATTR_CMD
, 
ATH6KL_TM_CMD_WIFI_DISC
);

157 
	`NLA_PUT
(
skb
, 
ATH6KL_TM_ATTR_DATA
, 
buf_Àn
, 
buf
);

158 
	`cfg80211_ã°mode_evít
(
skb
, 
GFP_ATOMIC
);

161 #ifde‡
_NLA_PUT_ERR_RTN


162 
∆a_put_Áûuª
:

163 
	`k‰ì_skb
(
skb
);

164 
	`¥ötk
(
KERN_ERR
 "nla_put failed onÅestmodeÉvent skb!\n");

166 
	}
}

169 
	$©h6kl_tm_rx_ªp‹t
(
©h6kl
 *
¨
, *
buf
, 
size_t
 
buf_Àn
,

170 
sk_buff
 *
skb
)

172 
ªt
 = 0;

173 
À·
;

175 i‡(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
)) {

176 
ªt
 = -
EIO
;

177 
out
;

180 i‡(
	`ã°_bô
(
DESTROY_IN_PROGRESS
, &
¨
->
Êag
)) {

181 
ªt
 = -
EBUSY
;

182 
out
;

184 i‡(
	`down_öãºu±ibÀ
(&
¨
->
£m
))

185  -
EIO
;

187 i‡(
	`©h6kl_wmi_ã°_cmd
(
¨
->
wmi
, 
buf
, 
buf_Àn
) < 0) {

188 
	`up
(&
¨
->
£m
);

189  -
EIO
;

192 
À·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
¨
->
evít_wq
,

193 
¨
->
tm
.
rx_ªp‹t
 !
NULL
,

194 
WMI_TIMEOUT
);

198 i‡(
À·
 == 0) {

199 
ªt
 = -
ETIMEDOUT
;

200 
out
;

201 } i‡(
À·
 < 0) {

202 
ªt
 = 
À·
;

203 
out
;

206 i‡(
¨
->
tm
.
rx_ªp‹t
 =
NULL
 ||ár->tm.
rx_ªp‹t_Àn
 == 0) {

207 
ªt
 = -
EINVAL
;

208 
out
;

211 
	`NLA_PUT
(
skb
, 
ATH6KL_TM_ATTR_DATA
, 
¨
->
tm
.
rx_ªp‹t_Àn
,

212 
¨
->
tm
.
rx_ªp‹t
);

214 
	`k‰ì
(
¨
->
tm
.
rx_ªp‹t
);

215 
¨
->
tm
.
rx_ªp‹t
 = 
NULL
;

217 
out
:

218 
	`up
(&
¨
->
£m
);

220  
ªt
;

222 #ifde‡
_NLA_PUT_ERR_RTN


223 
∆a_put_Áûuª
:

224 
ªt
 = -
ENOBUFS
;

225 
out
;

227 
	}
}

228 
EXPORT_SYMBOL
(
©h6kl_tm_rx_ªp‹t
);

230 #ifde‡
ATH6KL_SUPPORT_WLAN_HB


231 
	e∆80211_wœn_hb_cmd
 {

232 
	mNL80211_WLAN_HB_ENABLE
 = 0,

233 
	mNL80211_WLAN_TCP_PARAMS
 = 1,

234 
	mNL80211_WLAN_TCP_FILTER
 = 2,

235 
	mNL80211_WLAN_UDP_PARAMS
 = 3,

236 
	mNL80211_WLAN_UDP_FILTER
 = 4,

239 
	#WLAN_HB_UDP
 0x1

	)

240 
	#WLAN_HB_TCP
 0x2

	)

242 
	swœn_hb_∑øms
 {

243 
u16
 
	mcmd
;

244 
u16
 
	mdummy
;

248 
u8
 
	míabÀ
;

249 
u8
 
	môem
;

250 
u8
 
	m£ssi⁄
;

251 } 
	mhb_∑øms
;

254 
u32
 
	m§v_ù
;

255 
u32
 
	mdev_ù
;

256 
u16
 
	m§c_p‹t
;

257 
u16
 
	md°_p‹t
;

258 
u16
 
	mtimeout
;

259 
u8
 
	m£ssi⁄
;

260 
u8
 
	mg©eway_mac
[
ETH_ALEN
];

261 } 
	mt˝_∑øms
;

264 
u16
 
	mÀngth
;

265 
u8
 
	moff£t
;

266 
u8
 
	m£ssi⁄
;

267 
u8
 
	mfûãr
[64];

268 } 
	mt˝_fûãr
;

271 
u32
 
	m§v_ù
;

272 
u32
 
	mdev_ù
;

273 
u16
 
	m§c_p‹t
;

274 
u16
 
	md°_p‹t
;

275 
u16
 
	möãrvÆ
;

276 
u16
 
	mtimeout
;

277 
u8
 
	m£ssi⁄
;

278 
u8
 
	mg©eway_mac
[
ETH_ALEN
];

279 } 
	mudp_∑øms
;

282 
u16
 
	mÀngth
;

283 
u8
 
	moff£t
;

284 
u8
 
	m£ssi⁄
;

285 
u8
 
	mfûãr
[64];

286 } 
	mudp_fûãr
;

288 } 
	m∑øms
;

292 #ifde‡
ATH6KL_SUPPORT_WIFI_DISC


293 
	#WLAN_WIFI_DISC_MAX_IE_SIZE
 200

	)

295 
	e∆80211_wifi_disc_cmd
 {

296 
	mNL80211_WIFI_DISC_IE
 = 0,

297 
	mNL80211_WIFI_DISC_IE_FILTER
 = 1,

298 
	mNL80211_WIFI_DISC_START
 = 2,

299 
	mNL80211_WIFI_DISC_STOP
 = 3,

302 
	swifi_disc_∑øms
 {

303 
u16
 
	mcmd
;

307 
u16
 
	mÀngth
;

308 
u8
 
	mõ
[
WLAN_WIFI_DISC_MAX_IE_SIZE
];

309 } 
	mõ_∑øms
;

312 
u16
 
	míabÀ
;

313 
u16
 
	m°¨tPos
;

314 
u16
 
	mÀngth
;

315 
u8
 
	mfûãr
[
WLAN_WIFI_DISC_MAX_IE_SIZE
];

316 } 
	mõ_fûãr_∑øms
;

319 
u16
 
	mch™√l
;

320 
u16
 
	mdwñlTime
;

321 
u16
 
	m¶ìpTime
;

322 
u16
 
	møndom
;

323 
u16
 
	mnumPìrs
;

324 
u16
 
	m≥îTimeout
;

325 
u16
 
	mtxPowî
;

326 } 
	m°¨t_∑øms
;

327 } 
	m∑øms
;

331 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


332 
	#WLAN_WIFI_KTK_MAX_IE_SIZE
 200

	)

334 
	e∆80211_wifi_ktk_cmd
 {

335 
	mNL80211_WIFI_KTK_IE
 = 0,

336 
	mNL80211_WIFI_KTK_IE_FILTER
 = 1,

337 
	mNL80211_WIFI_KTK_START
 = 2,

338 
	mNL80211_WIFI_KTK_STOP
 = 3,

341 
	swifi_ktk_∑øms
 {

342 
u16
 
	mcmd
;

345 
u16
 
	mÀngth
;

346 
u8
 
	mõ
[
WLAN_WIFI_KTK_MAX_IE_SIZE
];

347 } 
	mõ_∑øms
;

350 
u16
 
	míabÀ
;

351 
u16
 
	m°¨tPos
;

352 
u16
 
	mÀngth
;

353 
u8
 
	mfûãr
[
WLAN_WIFI_KTK_MAX_IE_SIZE
];

354 } 
	mõ_fûãr_∑øms
;

357 
u16
 
	mssid_Àn
;

358 
u8
 
	mssid
[32];

359 
u8
 
	m∑s•hø£
[16];

360 } 
	m°¨t_∑øms
;

361 } 
	m∑øms
;

365 
	swifi_dfs_skù_∑øms
 {

366 
u16
 
	míabÀ
;

369 
	$©h6kl_tm_cmd
(
wùhy
 *wùhy, *
d©a
, 
Àn
)

371 
©h6kl
 *
¨
 = 
	`wùhy_¥iv
(
wùhy
);

372 
∆©å
 *
tb
[
ATH6KL_TM_ATTR_MAX
 + 1];

373 
îr
, 
buf_Àn
;

374 *
buf
;

376 
îr
 = 
	`∆a_∑r£
(
tb
, 
ATH6KL_TM_ATTR_MAX
, 
d©a
, 
Àn
,

377 
©h6kl_tm_pﬁicy
);

379 i‡(
îr
)

380  
îr
;

382 i‡(!
tb
[
ATH6KL_TM_ATTR_CMD
])

383  -
EINVAL
;

385 
	`∆a_gë_u32
(
tb
[
ATH6KL_TM_ATTR_CMD
])) {

386 
ATH6KL_TM_CMD_TCMD
:

387 i‡(!
tb
[
ATH6KL_TM_ATTR_DATA
])

388  -
EINVAL
;

390 
buf
 = 
	`∆a_d©a
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

391 
buf_Àn
 = 
	`∆a_Àn
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

393 
	`©h6kl_wmi_ã°_cmd
(
¨
->
wmi
, 
buf
, 
buf_Àn
);

398 #ifde‡
ATH6KL_SUPPORT_WLAN_HB


399 
ATH6KL_TM_CMD_WLAN_HB
:

401 
wœn_hb_∑øms
 *
hb_∑øms
;

402 
©h6kl_vif
 *
vif
;

404 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

406 i‡(!
vif
)

407  -
EINVAL
;

409 i‡(!
tb
[
ATH6KL_TM_ATTR_DATA
]) {

410 
	`¥ötk
(
KERN_ERR
 "%s: NO DATA\n", 
__func__
);

411  -
EINVAL
;

414 
buf
 = 
	`∆a_d©a
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

415 
buf_Àn
 = 
	`∆a_Àn
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

417 
hb_∑øms
 = (
wœn_hb_∑øms
 *)
buf
;

419 i‡(
hb_∑øms
->
cmd
 =
NL80211_WLAN_HB_ENABLE
) {

420 i‡(
hb_∑øms
->
∑øms
.hb_∑øms.
íabÀ
 != 0) {

422 i‡(
	`©h6kl_íabÀ_wow_hb
(
¨
)) {

423 
	`¥ötk
(
KERN_ERR


425 
__func__
);

426  -
EINVAL
;

429 i‡(
hb_∑øms
->
∑øms
.hb_∑øms.
ôem


430 =
WLAN_HB_TCP
) {

431 i‡(
	`©h6kl_wmi_£t_hóπ_bót_∑øms
(

432 
¨
->
wmi
,

433 
vif
->
fw_vif_idx
,

435 
WLAN_HB_TCP
,

436 
hb_∑øms
->
∑øms
.hb_∑øms.
£ssi⁄
)) {

437 
	`¥ötk
(
KERN_ERR


439 
__func__
);

440  -
EINVAL
;

442 } i‡(
hb_∑øms
->
∑øms
.hb_∑øms.
ôem


443 =
WLAN_HB_UDP
) {

444 i‡(
	`©h6kl_wmi_£t_hóπ_bót_∑øms
(

445 
¨
->
wmi
,

446 
vif
->
fw_vif_idx
,

448 
WLAN_HB_UDP
,

449 
hb_∑øms
->
∑øms
.hb_∑øms.
£ssi⁄
)) {

450 
	`¥ötk
(
KERN_ERR


452 
__func__
);

453  -
EINVAL
;

457 #ifde‡
CONFIG_ANDROID


458 i‡(
	`©h6kl_™droid_íabÀ_wow_deÁu…
(
¨
)) {

459 
	`¥ötk
(
KERN_ERR


461 
__func__
);

464 i‡(
hb_∑øms
->
∑øms
.hb_∑øms.
ôem


465 =
WLAN_HB_TCP
) {

466 i‡(
	`©h6kl_wmi_£t_hóπ_bót_∑øms
(

467 
¨
->
wmi
,

468 
vif
->
fw_vif_idx
,

470 
WLAN_HB_TCP
,

471 
hb_∑øms
->
∑øms
.hb_∑øms.
£ssi⁄
)) {

472 
	`¥ötk
(
KERN_ERR


474 
__func__
);

475  -
EINVAL
;

477 } i‡(
hb_∑øms
->
∑øms
.hb_∑øms.
ôem


478 =
WLAN_HB_UDP
) {

479 i‡(
	`©h6kl_wmi_£t_hóπ_bót_∑øms
(

480 
¨
->
wmi
,

481 
vif
->
fw_vif_idx
,

483 
WLAN_HB_UDP
,

484 
hb_∑øms
->
∑øms
.hb_∑øms.
£ssi⁄
)) {

485 
	`¥ötk
(
KERN_ERR


487 
__func__
);

488  -
EINVAL
;

492 } i‡(
hb_∑øms
->
cmd
 =
NL80211_WLAN_TCP_PARAMS
) {

493 i‡(
	`©h6kl_wmi_hóπ_bót_£t_t˝_∑øms
(
¨
->
wmi
,

494 
vif
->
fw_vif_idx
,

495 
hb_∑øms
->
∑øms
.
t˝_∑øms
.
§c_p‹t
,

496 
hb_∑øms
->
∑øms
.
t˝_∑øms
.
d°_p‹t
,

497 
hb_∑øms
->
∑øms
.
t˝_∑øms
.
§v_ù
,

498 
hb_∑øms
->
∑øms
.
t˝_∑øms
.
dev_ù
,

499 
hb_∑øms
->
∑øms
.
t˝_∑øms
.
timeout
,

500 
hb_∑øms
->
∑øms
.
t˝_∑øms
.
£ssi⁄
,

501 
hb_∑øms
->
∑øms
.
t˝_∑øms
.
g©eway_mac
)) {

502 
	`¥ötk
(
KERN_ERR


504 
__func__
);

505  -
EINVAL
;

508 } i‡(
hb_∑øms
->
cmd
 =
NL80211_WLAN_TCP_FILTER
) {

509 i‡(
hb_∑øms
->
∑øms
.
t˝_fûãr
.
Àngth


510 > 
WMI_MAX_TCP_FILTER_SIZE
) {

511 
	`¥ötk
(
KERN_ERR
 "%s: size ofÅcp filter isÅooÜarge: %d\n",

512 
__func__
,

513 
hb_∑øms
->
∑øms
.
t˝_fûãr
.
Àngth
);

514  -
E2BIG
;

517 i‡(
	`©h6kl_wmi_hóπ_bót_£t_t˝_fûãr
(
¨
->
wmi
,

518 
vif
->
fw_vif_idx
,

519 
hb_∑øms
->
∑øms
.
t˝_fûãr
.
fûãr
,

520 
hb_∑øms
->
∑øms
.
t˝_fûãr
.
Àngth
,

521 
hb_∑øms
->
∑øms
.
t˝_fûãr
.
off£t
,

522 
hb_∑øms
->
∑øms
.
t˝_fûãr
.
£ssi⁄
)) {

523 
	`¥ötk
(
KERN_ERR


525 
__func__
);

526  -
EINVAL
;

528 } i‡(
hb_∑øms
->
cmd
 =
NL80211_WLAN_UDP_PARAMS
) {

529 i‡(
	`©h6kl_wmi_hóπ_bót_£t_udp_∑øms
(
¨
->
wmi
,

530 
vif
->
fw_vif_idx
,

531 
hb_∑øms
->
∑øms
.
udp_∑øms
.
§c_p‹t
,

532 
hb_∑øms
->
∑øms
.
udp_∑øms
.
d°_p‹t
,

533 
hb_∑øms
->
∑øms
.
udp_∑øms
.
§v_ù
,

534 
hb_∑øms
->
∑øms
.
udp_∑øms
.
dev_ù
,

535 
hb_∑øms
->
∑øms
.
udp_∑øms
.
öãrvÆ
,

536 
hb_∑øms
->
∑øms
.
udp_∑øms
.
timeout
,

537 
hb_∑øms
->
∑øms
.
udp_∑øms
.
£ssi⁄
,

538 
hb_∑øms
->
∑øms
.
udp_∑øms
.
g©eway_mac
)) {

539 
	`¥ötk
(
KERN_ERR


541 
__func__
);

542  -
EINVAL
;

544 } i‡(
hb_∑øms
->
cmd
 =
NL80211_WLAN_UDP_FILTER
) {

545 i‡(
hb_∑øms
->
∑øms
.
udp_fûãr
.
Àngth


546 > 
WMI_MAX_UDP_FILTER_SIZE
) {

547 
	`¥ötk
(
KERN_ERR


549 
__func__
,

550 
hb_∑øms
->
∑øms
.
udp_fûãr
.
Àngth
);

551  -
E2BIG
;

554 i‡(
	`©h6kl_wmi_hóπ_bót_£t_udp_fûãr
(
¨
->
wmi
,

555 
vif
->
fw_vif_idx
,

556 
hb_∑øms
->
∑øms
.
udp_fûãr
.
fûãr
,

557 
hb_∑øms
->
∑øms
.
udp_fûãr
.
Àngth
,

558 
hb_∑øms
->
∑øms
.
udp_fûãr
.
off£t
,

559 
hb_∑øms
->
∑øms
.
udp_fûãr
.
£ssi⁄
)) {

560 
	`¥ötk
(
KERN_ERR


562 
__func__
);

563  -
EINVAL
;

571 #ifde‡
ATH6KL_SUPPORT_WIFI_DISC


572 
ATH6KL_TM_CMD_WIFI_DISC
:

574 
wifi_disc_∑øms
 *
disc_∑øms
;

575 
©h6kl_vif
 *
vif
;

577 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

579 i‡(!
vif
)

580  -
EINVAL
;

582 i‡(!
tb
[
ATH6KL_TM_ATTR_DATA
]) {

583 
	`¥ötk
(
KERN_ERR
 "%s: NO DATA\n", 
__func__
);

584  -
EINVAL
;

587 
buf
 = 
	`∆a_d©a
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

588 
buf_Àn
 = 
	`∆a_Àn
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

590 
disc_∑øms
 = (
wifi_disc_∑øms
 *)
buf
;

592 i‡(
disc_∑øms
->
cmd
 =
NL80211_WIFI_DISC_IE
) {

593 
u8
 
õ_hdr
[6] = {0xDD, 0x00, 0x00, 0x03, 0x7f, 0x00};

594 
u8
 *
õ
 = 
NULL
;

595 
u16
 
õ_Àngth
 = 
disc_∑øms
->
∑øms
.
õ_∑øms
.
Àngth
;

597 
õ
 = 
	`kmÆloc
(
õ_Àngth
+6, 
GFP_KERNEL
);

598 i‡(
õ
 =
NULL
)

599  -
ENOMEM
;

601 
	`mem˝y
(
õ
, 
õ_hdr
, 6);

602 
õ
[1] = 
õ_Àngth
+4;

603 
	`mem˝y
(
õ
+6,

604 
disc_∑øms
->
∑øms
.
õ_∑øms
.
õ
,

605 
õ_Àngth
);

607 i‡(
	`©h6kl_wmi_£t_≠põ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

608 
WMI_FRAME_PROBE_REQ
, 
õ
, 
õ_Àngth
+6)) {

609 
	`k‰ì
(
õ
);

610 
	`¥ötk
(
KERN_ERR


612 
__func__
);

613  -
EINVAL
;

616 i‡(
	`©h6kl_wmi_£t_≠põ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

617 
WMI_FRAME_PROBE_RESP
, 
õ
, 
õ_Àngth
+6)) {

618 
	`k‰ì
(
õ
);

619 
	`¥ötk
(
KERN_ERR


621 
__func__
);

622  -
EINVAL
;

625 
	`k‰ì
(
õ
);

626 } i‡(
disc_∑øms
->
cmd
 =
NL80211_WIFI_DISC_IE_FILTER
) {

627 i‡(
	`©h6kl_wmi_disc_õ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

628 
disc_∑øms
->
∑øms
.
õ_fûãr_∑øms
.
íabÀ
,

629 
disc_∑øms
->
∑øms
.
õ_fûãr_∑øms
.
°¨tPos
,

630 
disc_∑øms
->
∑øms
.
õ_fûãr_∑øms
.
fûãr
,

631 
disc_∑øms
->
∑øms
.
õ_fûãr_∑øms
.
Àngth
)) {

632 
	`¥ötk
(
KERN_ERR


634 
__func__
);

635  -
EINVAL
;

637 } i‡(
disc_∑øms
->
cmd
 =
NL80211_WIFI_DISC_START
) {

638 
b™d
, 
‰eq
, 
numPìrs
, 
øndom
;

640 i‡(
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
ch™√l
 <= 14)

641 
b™d
 = 
IEEE80211_BAND_2GHZ
;

643 
b™d
 = 
IEEE80211_BAND_5GHZ
;

645 
‰eq
 = 
	`õì80211_ch™√l_to_‰equícy
(

646 
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
ch™√l
, 
b™d
);

647 i‡(!
‰eq
) {

648 
	`¥ötk
(
KERN_ERR
 "%s: wifi discovery start channel %dÉrror\n",

649 
__func__
,

650 
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
ch™√l
);

651  -
EINVAL
;

654 i‡(
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
numPìrs
 == 0)

655 
numPìrs
 = 1;

656 i‡(
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
numPìrs
 > 4)

657 
numPìrs
 = 4;

659 
numPìrs
 =

660 
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
numPìrs
;

662 
øndom
 = (
disc_∑øms
->
∑øms
.
°¨t_∑øms
.random == 0)

663 ? 100 : 
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
øndom
;

665 i‡(
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
txPowî
)

666 
	`©h6kl_wmi_£t_tx_pwr_cmd
(
¨
->
wmi
,

667 
vif
->
fw_vif_idx
,

668 
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
txPowî
);

671 
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

675 i‡(
	`©h6kl_wmi_disc_mode_cmd
(
¨
->
wmi
,

676 
vif
->
fw_vif_idx
, 1, 
‰eq
,

677 
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
dwñlTime
,

678 
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
¶ìpTime
,

679 
øndom
, 
numPìrs
,

680 
disc_∑øms
->
∑øms
.
°¨t_∑øms
.
≥îTimeout


682 
	`¥ötk
(
KERN_ERR
 "%s: wifi discovery start fail\n",

683 
__func__
);

684  -
EINVAL
;

688 
¨
->
disc_a˘ive
 = 
åue
;

689 } i‡(
disc_∑øms
->
cmd
 =
NL80211_WIFI_DISC_STOP
) {

691 
¨
->
disc_a˘ive
 = 
Ál£
;

692 i‡(
	`©h6kl_wmi_disc_mode_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

694 
	`¥ötk
(
KERN_ERR
 "%s: wifi discovery stop fail\n",

695 
__func__
);

696  -
EINVAL
;

705 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


706 
ATH6KL_TM_CMD_WIFI_KTK
:

708 
wifi_ktk_∑øms
 *
ktk_∑øms
;

709 
©h6kl_vif
 *
vif
;

711 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

712 i‡(!
vif
)

713  -
EINVAL
;

715 i‡(!
tb
[
ATH6KL_TM_ATTR_DATA
]) {

716 
	`¥ötk
(
KERN_ERR
 "%s: NO DATA\n", 
__func__
);

717  -
EINVAL
;

720 
buf
 = 
	`∆a_d©a
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

721 
buf_Àn
 = 
	`∆a_Àn
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

723 
ktk_∑øms
 = (
wifi_ktk_∑øms
 *)
buf
;

725 i‡(
ktk_∑øms
->
cmd
 =
NL80211_WIFI_KTK_IE
) {

726 
u8
 
õ_hdr
[6] = {0xDD, 0x00, 0x00, 0x03, 0x7f, 0x00};

727 
u8
 *
õ
 = 
NULL
;

728 
u16
 
õ_Àngth
 = 
ktk_∑øms
->
∑øms
.
õ_∑øms
.
Àngth
;

730 
õ
 = 
	`kmÆloc
(
õ_Àngth
+6, 
GFP_KERNEL
);

731 i‡(
õ
 =
NULL
)

732  -
ENOMEM
;

734 
	`mem˝y
(
õ
, 
õ_hdr
, 6);

735 
õ
[1] = 
õ_Àngth
+4;

736 
	`mem˝y
(
õ
+6, 
ktk_∑øms
->
∑øms
.
õ_∑øms
.ie,

737 
õ_Àngth
);

739 i‡(
	`©h6kl_wmi_£t_≠põ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

740 
WMI_FRAME_PROBE_RESP
,

741 
õ
,

742 
õ_Àngth
+6)) {

743 
	`k‰ì
(
õ
);

744 
	`¥ötk
(
KERN_ERR


746 
__func__
);

747  -
EINVAL
;

750 i‡(
	`©h6kl_wmi_£t_≠põ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

751 
WMI_FRAME_BEACON
, 
õ
, 
õ_Àngth
+6)) {

752 
	`k‰ì
(
õ
);

753 
	`¥ötk
(
KERN_ERR


755 
__func__
);

756  -
EINVAL
;

759 
	`k‰ì
(
õ
);

760 } i‡(
ktk_∑øms
->
cmd
 =
NL80211_WIFI_KTK_IE_FILTER
) {

761 i‡(
	`©h6kl_wmi_disc_õ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

762 
ktk_∑øms
->
∑øms
.
õ_fûãr_∑øms
.
íabÀ
,

763 
ktk_∑øms
->
∑øms
.
õ_fûãr_∑øms
.
°¨tPos
,

764 
ktk_∑øms
->
∑øms
.
õ_fûãr_∑øms
.
fûãr
,

765 
ktk_∑øms
->
∑øms
.
õ_fûãr_∑øms
.
Àngth
)) {

766 
	`¥ötk
(
KERN_ERR


768 
__func__
);

769  -
EINVAL
;

771 } i‡(
ktk_∑øms
->
cmd
 =
NL80211_WIFI_KTK_START
) {

772 
¨
->
ktk_a˘ive
 = 
åue
;

775 i‡(
	`©h6kl_wmi_disc_õ_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

778 
NULL
,

780 
	`¥ötk
(
KERN_ERR
 "%s: wifi ktk clear ie filter fail\n",

781 
__func__
);

782  -
EINVAL
;

785 
	`mem˝y
(
¨
->
ktk_∑s•hø£
,

786 
ktk_∑øms
->
∑øms
.
°¨t_∑øms
.
∑s•hø£
,

789 i‡(
	`©h6kl_wmi_¥obedssid_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

790 1, 
SPECIFIC_SSID_FLAG
,

791 
ktk_∑øms
->
∑øms
.
°¨t_∑øms
.
ssid_Àn
,

792 
ktk_∑øms
->
∑øms
.
°¨t_∑øms
.
ssid
)) {

793 
	`¥ötk
(
KERN_ERR
 "%s: wifi ktk setÖrobedssid fail\n",

794 
__func__
);

795  -
EINVAL
;

798 i‡(
	`©h6kl_wmi_ibss_pm_ˇps_cmd
(
¨
->
wmi
,

799 
vif
->
fw_vif_idx
,

800 
ADHOC_PS_KTK
,

804 
	`¥ötk
(
KERN_ERR
 "%s: wifi ktk setÖower save mode on fail\n",

805 
__func__
);

806  -
EINVAL
;

808 } i‡(
ktk_∑øms
->
cmd
 =
NL80211_WIFI_KTK_STOP
) {

809 
¨
->
ktk_a˘ive
 = 
Ál£
;

811 i‡(
	`©h6kl_wmi_ibss_pm_ˇps_cmd
(
¨
->
wmi
,

812 
vif
->
fw_vif_idx
,

813 
ADHOC_PS_DISABLE
,

817 
	`¥ötk
(
KERN_ERR
 "%s: wifi ktk setÖower save mode off fail\n",

818 
__func__
);

819  -
EINVAL
;

828 
ATH6KL_TM_CMD_DFS_SKIP
:

830 
wifi_dfs_skù_∑øms
 *
dfs_skù_∑øms
;

831 
©h6kl_vif
 *
vif
;

833 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

835 i‡(!
vif
)

836  -
EINVAL
;

838 i‡(!
tb
[
ATH6KL_TM_ATTR_DATA
]) {

839 
	`¥ötk
(
KERN_ERR
 "%s: NO DATA\n", 
__func__
);

840  -
EINVAL
;

843 
buf
 = 
	`∆a_d©a
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

844 
buf_Àn
 = 
	`∆a_Àn
(
tb
[
ATH6KL_TM_ATTR_DATA
]);

846 
dfs_skù_∑øms
 = (
wifi_dfs_skù_∑øms
 *)
buf
;

848 i‡(
dfs_skù_∑øms
->
íabÀ
)

849 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags


850 |
ENABLE_DFS_SKIP_CTRL_FLAGS
;

852 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags


853 &~
ENABLE_DFS_SKIP_CTRL_FLAGS
;

855 i‡(
	`©h6kl_wmi_sˇ≈¨ams_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

856 
vif
->
sc_∑øms
.
fg_°¨t_≥riod
,

857 
vif
->
sc_∑øms
.
fg_íd_≥riod
,

858 
vif
->
sc_∑øms
.
bg_≥riod
,

859 
vif
->
sc_∑øms
.
möa˘_chdwñl_time
,

860 
vif
->
sc_∑øms
.
maxa˘_chdwñl_time
,

861 
vif
->
sc_∑øms
.
∑s_chdwñl_time
,

862 
vif
->
sc_∑øms
.
sh‹t_sˇn_øtio
,

863 
vif
->
sc_∑øms
.
sˇn_˘æ_Êags
,

864 
vif
->
sc_∑øms
.
max_dfsch_a˘_time
,

865 
vif
->
sc_∑øms
.
maxa˘_sˇn_≥r_ssid
)) {

866 
	`¥ötk
(
KERN_ERR
 "%s: wifi dfs skipÉnable fail\n",

867 
__func__
);

868  -
EINVAL
;

876  -
EOPNOTSUPP
;

878 
	}
}

	@testmode.h

17 
	~"c‹e.h
"

19 #ifde‡
CONFIG_NL80211_TESTMODE


21 
©h6kl_tm_rx_ªp‹t_evít
(
©h6kl
 *
¨
, *
buf
, 
size_t
 
buf_Àn
);

22 
©h6kl_tm_rx_evít
(
©h6kl
 *
¨
, *
buf
, 
size_t
 
buf_Àn
);

23 
©h6kl_tm_cmd
(
wùhy
 *wùhy, *
d©a
, 
Àn
);

24 
©h6kl_wœn_hb_evít
(
©h6kl
 *
¨
, 
u8
 
vÆue
, *
buf
,

25 
size_t
 
buf_Àn
);

26 
©h6kl_tm_disc_evít
(
©h6kl
 *
¨
, *
buf
, 
size_t
 
buf_Àn
);

30 
ölöe
 
	$©h6kl_tm_rx_ªp‹t_evít
(
©h6kl
 *
¨
, *
buf
,

31 
size_t
 
buf_Àn
)

33 
	}
}

35 
ölöe
 
	$©h6kl_tm_cmd
(
wùhy
 *wùhy, *
d©a
, 
Àn
)

38 
	}
}

40 
ölöe
 
	$©h6kl_tm_rx_evít
(
©h6kl
 *
¨
, *
buf
,

41 
size_t
 
buf_Àn
)

43 
	}
}

45 
ölöe
 
	$©h6kl_wœn_hb_evít
(
©h6kl
 *
¨
, 
u8
 
vÆue
, *
buf
,

46 
size_t
 
buf_Àn
)

48 
	}
}

50 
ölöe
 
	$©h6kl_tm_disc_evít
(
©h6kl
 *
¨
, *
buf
,

51 
size_t
 
buf_Àn
)

53 
	}
}

	@txrx.c

17 
	~"c‹e.h
"

18 
	~"debug.h
"

19 
	~"htc-›s.h
"

20 
	~"ïpög.h
"

21 
	~<löux/vîsi⁄.h
>

24 c⁄° 
u8
 
	gup_to_ac
[] = {

25 
WMM_AC_BE
,

26 
WMM_AC_BK
,

27 
WMM_AC_BK
,

28 
WMM_AC_BE
,

29 
WMM_AC_VI
,

30 
WMM_AC_VI
,

31 
WMM_AC_VO
,

32 
WMM_AC_VO
,

35 
aggr_tx
(
©h6kl_vif
 *
vif
, 
©h6kl_°a
 *
°a
,

36 
sk_buff
 **
skb
);

37 
aggr_tx_Êush
(
©h6kl_vif
 *
vif
, 
©h6kl_°a
 *
c⁄n
);

39 
©h6kl_ópﬁ_h™dshake_¥Ÿe˘
(
©h6kl_vif
 *
vif
, 
boﬁ
 
tx
);

41 
u8
 
	$©h6kl_ibss_m≠_ïid
(
sk_buff
 *
skb
, 
√t_devi˚
 *
dev
,

42 
u32
 *
m≠_no
)

44 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

45 
ëhhdr
 *
ëh_hdr
;

46 
u32
 
i
, 
ï_m≠
 = -1;

47 
u8
 *
d©≠
;

49 *
m≠_no
 = 0;

50 
d©≠
 = 
skb
->
d©a
;

51 
ëh_hdr
 = (
ëhhdr
 *Ë(
d©≠
 + (
wmi_d©a_hdr
));

53 i‡(
	`is_mu…iˇ°_ëhî_addr
(
ëh_hdr
->
h_de°
))

54  
ENDPOINT_2
;

56 
i
 = 0; i < 
¨
->
node_num
; i++) {

57 i‡(
	`memcmp
(
ëh_hdr
->
h_de°
, 
¨
->
node_m≠
[
i
].
mac_addr
,

58 
ETH_ALEN
) == 0) {

59 *
m≠_no
 = 
i
 + 1;

60 
¨
->
node_m≠
[
i
].
tx_≥nd
++;

61  
¨
->
node_m≠
[
i
].
ï_id
;

64 i‡((
ï_m≠
 =-1Ë&& !
¨
->
node_m≠
[
i
].
tx_≥nd
)

65 
ï_m≠
 = 
i
;

68 i‡(
ï_m≠
 == -1) {

69 
ï_m≠
 = 
¨
->
node_num
;

70 
¨
->
node_num
++;

71 i‡(
¨
->
node_num
 > 
MAX_NODE_NUM
)

72  
ENDPOINT_UNUSED
;

75 
	`mem˝y
(
¨
->
node_m≠
[
ï_m≠
].
mac_addr
, 
ëh_hdr
->
h_de°
, 
ETH_ALEN
);

77 
i
 = 
ENDPOINT_2
; i <
ENDPOINT_5
; i++) {

78 i‡(!
¨
->
tx_≥ndög
[
i
]) {

79 
¨
->
node_m≠
[
ï_m≠
].
ï_id
 = 
i
;

87 i‡(
i
 =
ENDPOINT_5
) {

88 
¨
->
node_m≠
[
ï_m≠
].
ï_id
 =ár->
√xt_ï_id
;

89 
¨
->
√xt_ï_id
++;

90 i‡(
¨
->
√xt_ï_id
 > 
ENDPOINT_5
)

91 
¨
->
√xt_ï_id
 = 
ENDPOINT_2
;

95 *
m≠_no
 = 
ï_m≠
 + 1;

96 
¨
->
node_m≠
[
ï_m≠
].
tx_≥nd
++;

98  
¨
->
node_m≠
[
ï_m≠
].
ï_id
;

99 
	}
}

101 
ölöe
 
boﬁ
 
	$_powîßve_≠_tx_mu…iˇ°
(
©h6kl_vif
 *
vif
,

102 
sk_buff
 *
skb
, 
u32
 *
Êags
)

104 
u8
 
˘r
 = 0;

105 
boﬁ
 
q_mˇ°
 = 
Ál£
, 
ps_queued
 = false;

106 
ªt
;

108 
˘r
 = 0; cå < 
AP_MAX_NUM_STA
; ctr++) {

109 i‡(
vif
->
°a_li°
[
˘r
].
°a_Êags
 & 
STA_PS_SLEEP
) {

110 
q_mˇ°
 = 
åue
;

115 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

117 
__func__
,

118 
q_mˇ°
,

119 !
	`©h6kl_ps_queue_em±y
(&
vif
->
psq_mˇ°
));

121 i‡(
q_mˇ°
) {

126 i‡(!
	`ã°_bô
(
DTIM_EXPIRED
, &
vif
->
Êags
)) {

127 
boﬁ
 
is_psq_em±y
 = 
Ál£
;

129 
	`•ö_lock_bh
(&
vif
->
psq_mˇ°_lock
);

130 
is_psq_em±y
 = 
	`©h6kl_ps_queue_em±y
(&
vif
->
psq_mˇ°
);

131 
ªt
 = 
	`©h6kl_ps_queue_íqueue_d©a
(

132 &
vif
->
psq_mˇ°
, 
skb
);

133 
	`•ö_u∆ock_bh
(&
vif
->
psq_mˇ°_lock
);

135 i‡(
ªt
 == 0) {

141 i‡(
is_psq_em±y
)

142 
	`©h6kl_wmi_£t_pvb_cmd
(
vif
->
¨
->
wmi
,

143 
vif
->
fw_vif_idx
,

144 
MCAST_AID
,

148 
	`dev_k‰ì_skb
(
skb
);

150 
ps_queued
 = 
åue
;

156 
	`•ö_lock_bh
(&
vif
->
psq_mˇ°_lock
);

157 i‡(!
	`©h6kl_ps_queue_em±y
(&
vif
->
psq_mˇ°
))

158 *
Êags
 |
WMI_DATA_HDR_FLAGS_MORE
;

159 
	`•ö_u∆ock_bh
(&
vif
->
psq_mˇ°_lock
);

163  
ps_queued
;

164 
	}
}

166 
ölöe
 
	$__powîßve_≠_tx_uniˇ°_¶ìp
(
©h6kl_vif
 *
vif
,

167 
©h6kl_°a
 *
c⁄n
, 
sk_buff
 *
skb
, 
u32
 *
Êags
)

169 
ëhhdr
 *
d©≠
 = (ëhhd∏*Ë
skb
->
d©a
;

170 
boﬁ
 
åiggî
 = 
Ál£
, 
is_psq_em±y
 = false;

171 
ªt
;

173 i‡(
c⁄n
->
≠sd_öfo
) {

174 
u8
 
up
 = 0;

175 
u8
 
åaffic_˛ass
;

177 i‡(
	`ã°_bô
(
WMM_ENABLED
, &
vif
->
Êags
)) {

178 
©h6kl_Œc_¢≠_hdr
 *
Œc_hdr
;

179 
u16
 
ëhî_ty≥
;

180 
u16
 
ù_ty≥
 = 
IP_ETHERTYPE
;

181 
u8
 *
ù_hdr
;

183 
ëhî_ty≥
 = 
d©≠
->
h_¥Ÿo
;

184 i‡(
	`is_ëhîty≥
(
	`be16_to_˝u
(
ëhî_ty≥
))) {

186 
ù_hdr
 = (
u8
 *)(
d©≠
 + 1);

189 
Œc_hdr
 = (
©h6kl_Œc_¢≠_hdr
 *)

190 (
d©≠
 + 1);

191 
ëhî_ty≥
 = 
Œc_hdr
->
ëh_ty≥
;

192 
ù_hdr
 = (
u8
 *)(
Œc_hdr
 + 1);

195 i‡(
ëhî_ty≥
 =
	`˝u_to_be16
(
ù_ty≥
))

196 
up
 = 
	`©h6kl_wmi_dëîmöe_u£r_¥i‹ôy
(
ù_hdr
,

199 
åaffic_˛ass
 = 
up_to_ac
[
up
 & 0x7];

200 i‡(
c⁄n
->
≠sd_öfo
 & (1 << 
åaffic_˛ass
))

201 
åiggî
 = 
åue
;

205 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

206 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

209 
__func__
,

210 
c⁄n
->
aid
,

211 
c⁄n
->
°a_Êags
,

212 
c⁄n
->
≠sd_öfo
,

213 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
),

214 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
),

215 
åiggî
);

217 
is_psq_em±y
 = 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
) &&

218 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
);

220 
ªt
 = 
	`©h6kl_ps_queue_íqueue_d©a
(&
c⁄n
->
psq_d©a
, 
skb
);

221 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

223 i‡(
ªt
 == 0) {

224 i‡(
is_psq_em±y
) {

225 i‡(
åiggî
)

226 
	`©h6kl_wmi_£t_≠sd_buf„ªd_åaffic_cmd
(

227 
vif
->
¨
->
wmi
,

228 
vif
->
fw_vif_idx
,

229 
c⁄n
->
aid
,

237 
	`©h6kl_wmi_£t_pvb_cmd
(
vif
->
¨
->
wmi
,

238 
vif
->
fw_vif_idx
,

239 
c⁄n
->
aid
,

244 
	`dev_k‰ì_skb
(
skb
);

248 
	}
}

250 
ölöe
 
	$__powîßve_≠_tx_uniˇ°_awake
(
©h6kl_vif
 *
vif
,

251 
©h6kl_°a
 *
c⁄n
, 
u32
 *
Êags
)

257 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

258 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

261 
__func__
,

262 
c⁄n
->
aid
,

263 
c⁄n
->
°a_Êags
,

264 
c⁄n
->
≠sd_öfo
,

265 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
),

266 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
));

268 i‡(!
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
) ||

269 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
))

270 *
Êags
 |
WMI_DATA_HDR_FLAGS_MORE
;

272 i‡(!(
c⁄n
->
°a_Êags
 & 
STA_PS_POLLED
)) {

278 *
Êags
 |
WMI_DATA_HDR_FLAGS_TRIGGERED
;

280 i‡(
c⁄n
->
°a_Êags
 & 
STA_PS_APSD_EOSP
)

281 *
Êags
 |
WMI_DATA_HDR_FLAGS_EOSP
;

283 *
Êags
 |
WMI_DATA_HDR_FLAGS_PSPOLLED
;

284 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

287 
	}
}

289 
ölöe
 
boﬁ
 
	$_powîßve_≠_tx_uniˇ°
(
©h6kl_vif
 *
vif
,

290 
sk_buff
 *
skb
, 
u32
 *
Êags
, 
©h6kl_°a
 **
°a
)

292 
ëhhdr
 *
d©≠
 = (ëhhd∏*Ë
skb
->
d©a
;

293 
©h6kl_°a
 *
c⁄n
 = 
NULL
;

294 
boﬁ
 
ps_queued
 = 
Ál£
;

296 
c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, 
d©≠
->
h_de°
);

297 i‡(!
c⁄n
) {

298 
	`dev_k‰ì_skb
(
skb
);

301  
åue
;

304 *
°a
 = 
c⁄n
;

306 i‡(
c⁄n
->
°a_Êags
 & 
STA_PS_SLEEP
) {

307 i‡(!((
c⁄n
->
°a_Êags
 & 
STA_PS_POLLED
) ||

308 (
c⁄n
->
°a_Êags
 & 
STA_PS_APSD_TRIGGER
))) {

309 
	`__powîßve_≠_tx_uniˇ°_¶ìp
(
vif
, 
c⁄n
, 
skb
, 
Êags
);

310 
ps_queued
 = 
åue
;

312 
	`__powîßve_≠_tx_uniˇ°_awake
(
vif
, 
c⁄n
, 
Êags
);

315  
ps_queued
;

316 
	}
}

318 
boﬁ
 
	$©h6kl_powîßve_≠
(
©h6kl_vif
 *
vif
, 
sk_buff
 *
skb
,

319 
u32
 *
Êags
,

320 
©h6kl_°a
 **
°a
)

322 
ëhhdr
 *
d©≠
 = (ëhhd∏*Ë
skb
->
d©a
;

323 
boﬁ
 
ps_queued
 = 
Ál£
;

325 i‡(
	`is_mu…iˇ°_ëhî_addr
(
d©≠
->
h_de°
))

326 
ps_queued
 = 
	`_powîßve_≠_tx_mu…iˇ°
(
vif
, 
skb
, 
Êags
);

328 
ps_queued
 = 
	`_powîßve_≠_tx_uniˇ°
(
vif
, 
skb
, 
Êags
, 
°a
);

330  
ps_queued
;

331 
	}
}

333 
boﬁ
 
	$©h6kl_mgmt_powîßve_≠
(
©h6kl_vif
 *
vif
,

334 
u32
 
id
,

335 
u32
 
‰eq
,

336 
u32
 
waô
,

337 c⁄° 
u8
 *
buf
,

338 
size_t
 
Àn
,

339 
boﬁ
 
no_cck
,

340 
boﬁ
 
d⁄t_waô_f‹_ack
,

341 
u32
 *
Êags
)

343 
õì80211_mgmt
 *
mgmt
;

344 
©h6kl_°a
 *
c⁄n
 = 
NULL
;

345 
boﬁ
 
ps_queued
 = 
Ál£
, 
is_psq_em±y
 = false;

346 
ªt
;

348 
mgmt
 = (
õì80211_mgmt
 *)
buf
;

349 i‡(
	`is_mu…iˇ°_ëhî_addr
(
mgmt
->
da
)) {

350  
Ál£
;

352 
c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, 
mgmt
->
da
);

353 i‡(!
c⁄n
)

354  
Ál£
;

356 i‡(
c⁄n
->
°a_Êags
 & 
STA_PS_SLEEP
) {

357 i‡(!(
c⁄n
->
°a_Êags
 & 
STA_PS_POLLED
)) {

359 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

360 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

362 
__func__
, 
c⁄n
->
aid
, c⁄n->
°a_Êags
,

363 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
),

364 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
)

367 
is_psq_em±y
 = 
	`©h6kl_ps_queue_em±y
(

368 &
c⁄n
->
psq_d©a
) &&

369 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
);

371 
ªt
 = 
	`©h6kl_ps_queue_íqueue_mgmt
(

372 &
c⁄n
->
psq_mgmt
,

373 
buf
,

374 
Àn
,

375 
id
,

376 
‰eq
,

377 
waô
,

378 
no_cck
,

379 
d⁄t_waô_f‹_ack
);

380 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

382 i‡(
ªt
 == 0) {

388 i‡(
is_psq_em±y
)

389 
	`©h6kl_wmi_£t_pvb_cmd
(

390 
vif
->
¨
->
wmi
,

391 
vif
->
fw_vif_idx
,

392 
c⁄n
->
aid
, 1);

396 
ps_queued
 = 
åue
;

402 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

403 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

405 
__func__
, 
c⁄n
->
aid
, c⁄n->
°a_Êags
,

406 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
),

407 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
)

410 i‡(!
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
) ||

411 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
))

412 *
Êags
 |
WMI_DATA_HDR_FLAGS_MORE
;

413 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

418  
ps_queued
;

419 
	}
}

423 
	$©h6kl_c⁄åﬁ_tx
(*
devt
, 
sk_buff
 *
skb
,

424 
htc_ídpoöt_id
 
eid
)

426 
©h6kl
 *
¨
 = 
devt
;

427 
°©us
 = 0;

428 
©h6kl_cookõ
 *
cookõ
 = 
NULL
;

430 
	`•ö_lock_bh
(&
¨
->
lock
);

432 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX
,

433 "%s: skb=0x%p,Üí=0x%xÉid =%d\n", 
__func__
,

434 
skb
, skb->
Àn
, 
eid
);

436 i‡(
	`ã°_bô
(
WMI_CTRL_EP_FULL
, &
¨
->
Êag
Ë&& (
eid
 =¨->
˘æ_ï
)) {

441 
cookõ
 = 
NULL
;

442 
	`©h6kl_îr
("wmi ctrlÉp full, droppingÖkt : 0x%p,Üen:%d\n",

443 
skb
, skb->
Àn
);

445 
cookõ
 = 
	`©h6kl_Æloc_cookõ
(
¨
, 
COOKIE_TYPE_CTRL
);

447 i‡(
cookõ
 =
NULL
) {

448 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

449 
°©us
 = -
ENOMEM
;

450 
Áû_˘æ_tx
;

453 
¨
->
tx_≥ndög
[
eid
]++;

455 i‡(
eid
 !
¨
->
˘æ_ï
)

456 
¨
->
tŸÆ_tx_d©a_≥nd
++;

458 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

460 
cookõ
->
skb
 = skb;

461 
cookõ
->
m≠_no
 = 0;

462 
	`£t_htc_pkt_öfo
(
cookõ
->
htc_pkt
, cookõ, 
skb
->
d©a
, skb->
Àn
,

463 
eid
, 
ATH6KL_CONTROL_PKT_TAG
);

464 
cookõ
->
htc_pkt
->
skb
 = skb;

467 i‡(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_ENABLE_FLOWCTRL
) {

468 
cookõ
->
htc_pkt
->
c⁄nid
 = 
ATH6KL_P2P_FLOWCTRL_NULL_CONNID
;

469 
cookõ
->
htc_pkt
->
ªcy˛e_cou¡
 = 0;

473 
cookõ
->
htc_pkt
->
vif
 = 
NULL
;

479 
	`©h6kl_htc_tx
(
¨
->
htc_èrgë
, 
cookõ
->
htc_pkt
);

483 
Áû_˘æ_tx
:

484 
	`dev_k‰ì_skb
(
skb
);

485  
°©us
;

486 
	}
}

488 
	$©h6kl_d©a_tx
(
sk_buff
 *
skb
, 
√t_devi˚
 *
dev
,

489 
boﬁ
 
by∑ss_tx_aggr
)

491 
©h6kl
 *
¨
 = 
	`©h6kl_¥iv
(
dev
);

492 
©h6kl_cookõ
 *
cookõ
 = 
NULL
;

493 
htc_ídpoöt_id
 
eid
 = 
ENDPOINT_UNUSED
;

494 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

495 
u32
 
m≠_no
 = 0;

496 
u16
 
htc_èg
 = 
ATH6KL_DATA_PKT_TAG
;

497 
u8
 
ac
 = 99 ;

498 
boﬁ
 
chk_adhoc_ps_m≠pög
 = 
Ál£
;

499 
u32
 
wmi_d©a_Êags
 = 0;

500 
ªt
, 
aggr_tx_°©us
 = 
AGGR_TX_UNKNOW
;

501 
©h6kl_°a
 *
c⁄n
 = 
NULL
;

504 i‡(!
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) &&

505 !
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

506 
	`dev_k‰ì_skb
(
skb
);

510 i‡(!
	`ã°_bô
(
WMI_READY
, &
¨
->
Êag
) &&

511 !
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

512 
Áû_tx
;

515 i‡((
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_SKB_DUP
) &&

516 (
	`skb_˛⁄ed
(
skb
Ë|| 
	`skb_sh¨ed
(skb))) {

517 
sk_buff
 *
nskb
;

518 
nskb
 = 
	`skb_c›y
(
skb
, 
GFP_ATOMIC
);

519 i‡(
nskb
 =
NULL
)

520 
Áû_tx
;

521 
	`dev_k‰ì_skb_™y
(
skb
);

522 
skb
 = 
nskb
;

525 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX
,

526 "%s: skb=0x%p, d©a=0x%p,Üí=0x%x\n", 
__func__
,

527 
skb
, skb->
d©a
, skb->
Àn
);

530 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

531 i‡(
	`©h6kl_powîßve_≠
(
vif
, 
skb
, &
wmi_d©a_Êags
, &
c⁄n
))

535 i‡(
	`ã°_bô
(
WMI_ENABLED
, &
¨
->
Êag
)) {

536 i‡(
	`skb_hódroom
(
skb
Ë< 
vif
->
√eded_hódroom
) {

537 
sk_buff
 *
tmp_skb
 = 
	`©h6kl_buf_Æloc
(
skb
->
Àn
);

539 i‡(
tmp_skb
 =
NULL
) {

540 
vif
->
√t_°©s
.
tx_dr›≥d
++;

541 
Áû_tx
;

544 
	`skb_put
(
tmp_skb
, 
skb
->
Àn
);

545 
	`mem˝y
(
tmp_skb
->
d©a
, 
skb
->d©a, skb->
Àn
);

546 
	`k‰ì_skb
(
skb
);

547 
skb
 = 
tmp_skb
;

550 i‡(
	`©h6kl_wmi_dix_2_dŸ3
(
¨
->
wmi
, 
skb
)) {

551 
	`©h6kl_îr
("ath6kl_wmi_dix_2_dot3 failed\n");

552 
Áû_tx
;

555 i‡(
	`©h6kl_wmi_d©a_hdr_add
(
¨
->
wmi
, 
skb
, 
DATA_MSGTYPE
,

556 
wmi_d©a_Êags
, 0, 0, 
NULL
,

557 
vif
->
fw_vif_idx
)) {

558 
	`©h6kl_îr
("wmi_data_hdr_add failed\n");

559 
Áû_tx
;

562 i‡((
vif
->
nw_ty≥
 =
ADHOC_NETWORK
) &&

563 
¨
->
ibss_ps_íabÀ
 && 
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))

564 
chk_adhoc_ps_m≠pög
 = 
åue
;

567 
ªt
 = 
	`©h6kl_wmi_im∂icô_¸óã_p°ªam
(
¨
->
wmi
,

568 
vif
->
fw_vif_idx
, 
skb
,

569 0, 
	`ã°_bô
(
WMM_ENABLED
, &
vif
->
Êags
),

570 &
ac
, &
htc_èg
);

571 i‡(
ªt
)

572 
Áû_tx
;

574 } i‡(
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

575 
ïpög_hódî
 *
ïpög_hdr
;

577 
ïpög_hdr
 = (
ïpög_hódî
 *)
skb
->
d©a
;

579 i‡(
	`IS_EPPING_PACKET
(
ïpög_hdr
)) {

580 
ac
 = 
ïpög_hdr
->
°ªam_no_h
;

586 i‡(
	`IS_EPING_PACKET_NO_DROP
(
ïpög_hdr
))

587 
htc_èg
 = 
ATH6KL_CONTROL_PKT_TAG
;

590 i‡(
ac
 =
HCI_TRANSPORT_STREAM_NUM
) {

591 
Áû_tx
;

598 i‡(
EPPING_ALIGNMENT_PAD
 > 0)

599 
	`skb_push
(
skb
, 
EPPING_ALIGNMENT_PAD
);

604 
Áû_tx
;

607 
Áû_tx
;

609 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) &&

610 (
skb
->
¥Ÿocﬁ
 =
	`˝u_to_be16
(
ETH_P_PAE
)))

611 
	`©h6kl_ópﬁ_h™dshake_¥Ÿe˘
(
vif
, 
åue
);

614 i‡((
	`ã°_bô
(
AMSDU_ENABLED
, &
vif
->
Êags
)) &&

615 (!
by∑ss_tx_aggr
) &&

616 (
vif
->
aggr_˙txt
->
tx_amsdu_íabÀ
) &&

617 (!
chk_adhoc_ps_m≠pög
) &&

618 (
vif
->
nw_ty≥
 & (
INFRA_NETWORK
 | 
AP_NETWORK
))) {

619 
aggr_tx_°©us
 = 
	`aggr_tx
(
vif
, 
c⁄n
, &
skb
);

621 i‡(
aggr_tx_°©us
 =
AGGR_TX_OK
)

623 i‡(
aggr_tx_°©us
 =
AGGR_TX_DROP
)

624 
Áû_tx
;

626 
	`WARN_ON
(
skb
 =
NULL
);

628 i‡((
vif
->
aggr_˙txt
->
tx_amsdu_£q_pkt
) &&

629 (
aggr_tx_°©us
 =
AGGR_TX_BYPASS
))

630 
	`aggr_tx_Êush
(
vif
, 
c⁄n
);

633 
	`•ö_lock_bh
(&
¨
->
lock
);

635 i‡(
chk_adhoc_ps_m≠pög
)

636 
eid
 = 
	`©h6kl_ibss_m≠_ïid
(
skb
, 
dev
, &
m≠_no
);

638 
eid
 = 
¨
->
ac2ï_m≠
[
ac
];

640 i‡(
eid
 =0 ||Éid =
ENDPOINT_UNUSED
) {

641 i‡((
ac
 =
WMM_NUM_AC
) &&

642 
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

646 
eid
 = 
¨
->
˘æ_ï
;

648 
	`©h6kl_îr
("eid %d i†nŸ m≠≥d!\n", 
eid
);

649 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

650 
Áû_tx
;

655 i‡(
htc_èg
 =
ATH6KL_DATA_PKT_TAG
) {

656 i‡(
	`ã°_bô
(
MCC_ENABLED
, &
¨
->
Êag
)) {

657 i‡(
vif
->
d©a_cookõ_cou¡
 <
MAX_VIF_COOKIE_NUM
) {

658 
cookõ
 = 
	`©h6kl_Æloc_cookõ
(
¨
,

659 
COOKIE_TYPE_DATA
);

662 
cookõ
 = 
	`©h6kl_Æloc_cookõ
(
¨
,

663 
COOKIE_TYPE_DATA
);

665 
cookõ
 = 
	`©h6kl_Æloc_cookõ
(
¨
, 
COOKIE_TYPE_CTRL
);

667 i‡(!
cookõ
) {

668 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

669 
Áû_tx
;

672 i‡(
htc_èg
 =
ATH6KL_DATA_PKT_TAG
)

673 
vif
->
d©a_cookõ_cou¡
++;

676 
¨
->
tx_≥ndög
[
eid
]++;

677 
¨
->
tŸÆ_tx_d©a_≥nd
++;

679 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

681 i‡(!
	`IS_ALIGNED
((Ë
skb
->
d©a
 - 
HTC_HDR_LENGTH
, 4) &&

682 
	`skb_˛⁄ed
(
skb
)) {

690 
sk_buff
 *
nskb
;

692 
nskb
 = 
	`skb_c›y_ex∑nd
(
skb
, 
HTC_HDR_LENGTH
, 0, 
GFP_ATOMIC
);

693 i‡(
nskb
 =
NULL
)

694 
Áû_tx
;

695 
	`k‰ì_skb
(
skb
);

696 
skb
 = 
nskb
;

699 
cookõ
->
skb
 = skb;

700 
cookõ
->
m≠_no
 = map_no;

701 
	`£t_htc_pkt_öfo
(
cookõ
->
htc_pkt
, cookõ, 
skb
->
d©a
, skb->
Àn
,

702 
eid
, 
htc_èg
);

703 
cookõ
->
htc_pkt
->
skb
 = skb;

705 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_RAW_BYTES
, 
__func__
, "tx ",

706 
skb
->
d©a
, skb->
Àn
);

709 i‡(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_ENABLE_FLOWCTRL
) {

710 
cookõ
->
htc_pkt
->
c⁄nid
 =

711 
	`©h6kl_p2p_Êow˘æ_gë_c⁄n_id
(
vif
, 
skb
);

712 
cookõ
->
htc_pkt
->
ªcy˛e_cou¡
 = 0;

713 
ªt
 = 
	`©h6kl_p2p_Êow˘æ_tx_scheduÀ_pkt
(
¨
, (*)
cookõ
);

714 i‡(
ªt
 == 0)

716 i‡(
ªt
 < 0)

717 
Áû_tx
;

720 
cookõ
->
htc_pkt
->
vif
 = vif;

722 
¨
->
tx_⁄_vif
 |(1 << 
vif
->
fw_vif_idx
);

728 
	`©h6kl_htc_tx
(
¨
->
htc_èrgë
, 
cookõ
->
htc_pkt
);

732 
Áû_tx
:

733 
	`dev_k‰ì_skb
(
skb
);

735 
vif
->
√t_°©s
.
tx_dr›≥d
++;

736 
vif
->
√t_°©s
.
tx_ab‹ãd_îr‹s
++;

739 
	}
}

741 
	$©h6kl_°¨t_tx
(
sk_buff
 *
skb
, 
√t_devi˚
 *
dev
)

744  
	`©h6kl_d©a_tx
(
skb
, 
dev
, 
Ál£
);

745 
	}
}

748 
	$©h6kl_ödiˇã_tx_a˘ivôy
(*
devt
, 
u8
 
åaffic_˛ass
, 
boﬁ
 
a˘ive
)

750 
©h6kl
 *
¨
 = 
devt
;

751 
htc_ídpoöt_id
 
eid
;

752 
i
;

753 
u8
 
num_°ªam_a˘ive
;

755 
eid
 = 
¨
->
ac2ï_m≠
[
åaffic_˛ass
];

757 i‡(!
	`ã°_bô
(
WMI_ENABLED
, &
¨
->
Êag
))

758 
nŸify_htc
;

760 
	`•ö_lock_bh
(&
¨
->
lock
);

762 
¨
->
ac_°ªam_a˘ive
[
åaffic_˛ass
] = 
a˘ive
;

764 i‡(
a˘ive
) {

769 i‡(
¨
->
ac_°ªam_¥i_m≠
[
åaffic_˛ass
] >

770 
¨
->
hüc_°ªam_a˘ive_¥i
)

772 
¨
->
hüc_°ªam_a˘ive_¥i
 =

773 
¨
->
ac_°ªam_¥i_m≠
[
åaffic_˛ass
];

775 i‡(
	`©h6kl_htc_ch™ge_¸edô_by∑ss
(
¨
->
htc_èrgë
,

776 
åaffic_˛ass
)) {

777 
©h6kl_vif
 *
vif
;

778 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

780 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

782 i‡(
vif
)

783 
	`©h6kl_wmi_£t_¸edô_by∑ss
(
¨
->
wmi
,

784 
vif
->
fw_vif_idx
,

785 
¨
->
ac2ï_m≠
[
WMM_AC_BE
], 0, 6);

787 
	`•ö_lock_bh
(&
¨
->
lock
);

794 i‡(
¨
->
hüc_°ªam_a˘ive_¥i
 ==

795 
¨
->
ac_°ªam_¥i_m≠
[
åaffic_˛ass
]) {

801 
¨
->
hüc_°ªam_a˘ive_¥i
 = 0;

803 
i
 = 0; i < 
WMM_NUM_AC
; i++) {

804 i‡(
¨
->
ac_°ªam_a˘ive
[
i
] &&

805 (
¨
->
ac_°ªam_¥i_m≠
[
i
] >

806 
¨
->
hüc_°ªam_a˘ive_¥i
))

811 
¨
->
hüc_°ªam_a˘ive_¥i
 =

812 
¨
->
ac_°ªam_¥i_m≠
[
i
];

816 i‡(
	`©h6kl_htc_ch™ge_¸edô_by∑ss
(
¨
->
htc_èrgë
,

817 
åaffic_˛ass
)) {

818 
©h6kl_vif
 *
vif
;

819 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

821 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

823 i‡(
vif
)

824 
	`©h6kl_wmi_£t_¸edô_by∑ss
(
¨
->
wmi
,

825 
vif
->
fw_vif_idx
,

826 
¨
->
ac2ï_m≠
[
WMM_AC_BE
],

829 
	`•ö_lock_bh
(&
¨
->
lock
);

834 
num_°ªam_a˘ive
 = 0;

836 
i
 = 0; i < 
WMM_NUM_AC
; i++) {

837 i‡(
¨
->
ac_°ªam_a˘ive
[
i
] =
åue
)

838 
num_°ªam_a˘ive
++;

841 
¨
->
ac_°ªam_a˘ive_num
 = 
num_°ªam_a˘ive
;

843 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

845 
nŸify_htc
:

847 
	`©h6kl_htc_ödiˇã_a˘ivôy_ch™ge
(
¨
->
htc_èrgë
, 
eid
, 
a˘ive
);

848 
	}
}

850 
htc_£nd_fuŒ_a˘i⁄
 
	$©h6kl_tx_queue_fuŒ
(
htc_èrgë
 *
èrgë
,

851 
htc_∑ckë
 *
∑ckë
)

853 
©h6kl
 *
¨
 = 
èrgë
->
dev
->ar;

854 
©h6kl_vif
 *
vif
;

855 
htc_ídpoöt_id
 
ídpoöt
 = 
∑ckë
->endpoint;

856 
htc_£nd_fuŒ_a˘i⁄
 
a˘i⁄
 = 
HTC_SEND_FULL_KEEP
;

858 i‡(
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

859 
ac
;

861 i‡(
∑ckë
->
öfo
.
tx
.
èg
 =
ATH6KL_CONTROL_PKT_TAG
) {

863  
HTC_SEND_FULL_KEEP
;

866 
ac
 = 
¨
->
ï2ac_m≠
[
ídpoöt
];

870 i‡((
¨
->
ac_°ªam_a˘ive
[
WMM_AC_VO
] ||

871 
¨
->
ac_°ªam_a˘ive
[
WMM_AC_BE
]) &&

872 ((
ac
 =
WMM_AC_BE
Ë|| (a¯=
WMM_AC_BK
))) {

873  
HTC_SEND_FULL_DROP
;

875 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

876 
	`li°_f‹_óch_íåy
(
vif
, &
¨
->
vif_li°
, 
li°
) {

879 
	`£t_bô
(
NETQ_STOPPED
, &
vif
->
Êags
);

880 
	`√tif_°›_queue
(
vif
->
ndev
);

882 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

883  
HTC_SEND_FULL_KEEP
;

887 i‡(
ídpoöt
 =
¨
->
˘æ_ï
) {

894 
	`•ö_lock_bh
(&
¨
->
lock
);

895 
	`£t_bô
(
WMI_CTRL_EP_FULL
, &
¨
->
Êag
);

896 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

897 
	`©h6kl_îr
("wmi ctrlÉp is full\n");

898 
	`©h6kl_fw_¸ash_å≠
(
¨
);

899  
a˘i⁄
;

902 i‡((
∑ckë
->
öfo
.
tx
.
èg
 =
ATH6KL_CONTROL_PKT_TAG
) ||

903 (
∑ckë
->
öfo
.
tx
.
èg
 =
ATH6KL_PRI_DATA_PKT_TAG
))

904  
a˘i⁄
;

910 i‡(
¨
->
ac_°ªam_¥i_m≠
[¨->
ï2ac_m≠
[
ídpoöt
]] <

911 
¨
->
hüc_°ªam_a˘ive_¥i
 &&

912 
¨
->
cookõ_d©a
.
cookõ_cou¡
 <=

913 
èrgë
->
ídpoöt
[ídpoöt].
tx_dr›_∑ckë_thªshﬁd
){

918 
a˘i⁄
 = 
HTC_SEND_FULL_DROP
;

919 } i‡(
¨
->
vif_max
 > 1) {

920 
i
, 
⁄goög_tx
 = 0;

922 
i
 = 0; i < 
¨
->
vif_max
; i++) {

923 i‡(
¨
->
tx_⁄_vif
 & (1 << 
i
))

924 
⁄goög_tx
++;

927 i‡(
⁄goög_tx
 > 1)

928  
a˘i⁄
;

932 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

933 
	`li°_f‹_óch_íåy
(
vif
, &
¨
->
vif_li°
, 
li°
) {

934 i‡(
vif
->
nw_ty≥
 =
ADHOC_NETWORK
 ||

935 
a˘i⁄
 !
HTC_SEND_FULL_DROP
) {

936 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

938 i‡(
	`©h6kl_htc_°›_√tif_queue_fuŒ
(
¨
->
htc_èrgë
) ||

939 
vif
->
nw_ty≥
 =
INFRA_NETWORK
 ||

940 
¨
->
ac_°ªam_a˘ive_num
 == 1) {

941 
	`£t_bô
(
NETQ_STOPPED
, &
vif
->
Êags
);

942 
	`√tif_°›_queue
(
vif
->
ndev
);

945 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

948 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

950  
a˘i⁄
;

951 
	}
}

954 
	$©h6kl_tx_˛ór_node_m≠
(
©h6kl_vif
 *
vif
,

955 
htc_ídpoöt_id
 
eid
, 
u32
 
m≠_no
)

957 
©h6kl
 *
¨
 = 
vif
->ar;

958 
u32
 
i
;

960 i‡(
vif
->
nw_ty≥
 !
ADHOC_NETWORK
)

963 i‡(!
¨
->
ibss_ps_íabÀ
)

966 i‡(
eid
 =
¨
->
˘æ_ï
)

969 i‡(
m≠_no
 == 0)

972 
m≠_no
--;

973 
¨
->
node_m≠
[
m≠_no
].
tx_≥nd
--;

975 i‡(
¨
->
node_m≠
[
m≠_no
].
tx_≥nd
)

978 i‡(
m≠_no
 !(
¨
->
node_num
 - 1))

981 
i
 = 
¨
->
node_num
; i > 0; i--) {

982 i‡(
¨
->
node_m≠
[
i
 - 1].
tx_≥nd
)

985 
	`mem£t
(&
¨
->
node_m≠
[
i
 - 1], 0,

986 (
©h6kl_node_m≠pög
));

987 
¨
->
node_num
--;

989 
	}
}

991 
	$©h6kl_tx_com∂ëe
(
htc_èrgë
 *
èrgë
,

992 
li°_hód
 *
∑ckë_queue
)

994 
©h6kl
 *
¨
 = 
èrgë
->
dev
->ar;

995 
sk_buff_hód
 
skb_queue
;

996 
htc_∑ckë
 *
∑ckë
 = 
NULL
;

997 
sk_buff
 *
skb
;

998 
©h6kl_cookõ
 *ath6kl_cookie;

999 
u32
 
m≠_no
 = 0;

1000 
°©us
;

1001 
htc_ídpoöt_id
 
eid
 = 0;

1002 
boﬁ
 
wake_evít
 = 
Ál£
;

1003 
boﬁ
 
Êushög
[
ATH6KL_VIF_MAX
] = {
Ál£
};

1004 
u8
 
if_idx
;

1005 
©h6kl_vif
 *
vif
 = 
NULL
;

1006 
htc_ídpoöt
 *
ídpoöt
 = 
NULL
;

1007 
txq_dïth
;

1009 
	`skb_queue_hód_öô
(&
skb_queue
);

1012 
	`•ö_lock_bh
(&
¨
->
lock
);

1015 !
	`li°_em±y
(
∑ckë_queue
)) {

1017 
∑ckë
 = 
	`li°_fú°_íåy
(
∑ckë_queue
, 
htc_∑ckë
,

1018 
li°
);

1019 
	`li°_dñ
(&
∑ckë
->
li°
);

1021 
©h6kl_cookõ
 = (©h6kl_cookõ *)
∑ckë
->
pkt_˙txt
;

1022 i‡(!
©h6kl_cookõ
)

1023 
Áèl
;

1025 
°©us
 = 
∑ckë
->status;

1026 
skb
 = 
©h6kl_cookõ
->skb;

1027 
eid
 = 
∑ckë
->
ídpoöt
;

1028 
m≠_no
 = 
©h6kl_cookõ
->map_no;

1030 i‡(!
skb
 || !skb->
d©a
)

1031 
Áèl
;

1033 i‡(
eid
 =
ENDPOINT_UNUSED
 ||Éid =
ENDPOINT_MAX
)

1034 
Áèl
;

1036 
	`__skb_queue_èû
(&
skb_queue
, 
skb
);

1038 i‡(!
°©us
 && (
∑ckë
->
a˘_Àn
 !
skb
->
Àn
))

1039 
Áèl
;

1041 
¨
->
tx_≥ndög
[
eid
]--;

1043 i‡(!
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

1044 i‡(
eid
 !
¨
->
˘æ_ï
)

1045 
¨
->
tŸÆ_tx_d©a_≥nd
--;

1047 i‡(
eid
 =
¨
->
˘æ_ï
) {

1048 i‡(
	`ã°_bô
(
WMI_CTRL_EP_FULL
, &
¨
->
Êag
))

1049 
	`˛ór_bô
(
WMI_CTRL_EP_FULL
, &
¨
->
Êag
);

1051 i‡(
¨
->
tx_≥ndög
[
eid
] == 0)

1052 
wake_evít
 = 
åue
;

1055 i‡(
eid
 =
¨
->
˘æ_ï
) {

1056 
if_idx
 = 
	`wmi_cmd_hdr_gë_if_idx
(

1057 (
wmi_cmd_hdr
 *Ë
∑ckë
->
buf
);

1059 
if_idx
 = 
	`wmi_d©a_hdr_gë_if_idx
(

1060 (
wmi_d©a_hdr
 *Ë
∑ckë
->
buf
);

1067 
if_idx
 = 0;

1070 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
if_idx
);

1071 i‡(!
vif
) {

1072 
	`©h6kl_‰ì_cookõ
(
¨
, 
©h6kl_cookõ
);

1076 
¨
->
tx_⁄_vif
 &~(1 << 
if_idx
);

1078 i‡(
°©us
) {

1079 i‡(
°©us
 =-
ECANCELED
)

1081 
Êushög
[
if_idx
] = 
åue
;

1083 
vif
->
√t_°©s
.
tx_îr‹s
++;

1085 i‡(
°©us
 =-
ETXTBSY
)

1086 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX
,

1088 i‡(
°©us
 !-
ENOSPC
 &&

1089 
°©us
 !-
ECANCELED
 &&

1090 
°©us
 !-
ENOMEM
)

1091 
	`©h6kl_debug
("tx com∂ëêîr‹: %d\n", 
°©us
);

1093 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX
,

1095 
__func__
, 
skb
, 
∑ckë
->
buf
,Öackë->
a˘_Àn
,

1096 
eid
, "error!");

1098 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX
,

1100 
__func__
, 
skb
, 
∑ckë
->
buf
,Öackë->
a˘_Àn
,

1101 
eid
, "OK");

1103 
Êushög
[
if_idx
] = 
Ál£
;

1104 
vif
->
√t_°©s
.
tx_∑ckës
++;

1105 
vif
->
√t_°©s
.
tx_byãs
 +
skb
->
Àn
;

1108 
	`©h6kl_tx_˛ór_node_m≠
(
vif
, 
eid
, 
m≠_no
);

1109 i‡(
©h6kl_cookõ
->
htc_pkt
->
öfo
.
tx
.
èg
 ==

1110 
ATH6KL_DATA_PKT_TAG
)

1111 
vif
->
d©a_cookõ_cou¡
--;

1113 
	`©h6kl_‰ì_cookõ
(
¨
, 
©h6kl_cookõ
);

1115 i‡(
	`ã°_bô
(
NETQ_STOPPED
, &
vif
->
Êags
))

1116 
	`˛ór_bô
(
NETQ_STOPPED
, &
vif
->
Êags
);

1119 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

1121 
	`__skb_queue_purge
(&
skb_queue
);

1123 i‡(
	`ã°_bô
(
MCC_ENABLED
, &
¨
->
Êag
)) {

1124 
ídpoöt
 = &
¨
->
htc_èrgë
->ídpoöt[
eid
];

1126 i‡(
ídpoöt
 && 
∑ckë
 && 
¨
->
htc_èrgë
) {

1127 
li°_hód
 *
tx_queue
;

1129 
tx_queue
 = &
ídpoöt
->
txq
;

1130 i‡(
tx_queue
 && 
vif
 && !
Êushög
[vif->
fw_vif_idx
]) {

1131 
	`•ö_lock_bh
(&
¨
->
htc_èrgë
->
tx_lock
);

1132 
txq_dïth
 = 
	`gë_queue_dïth
(
tx_queue
);

1133 
	`•ö_u∆ock_bh
(&
¨
->
htc_èrgë
->
tx_lock
);

1135 i‡(
txq_dïth
 < 
ATH6KL_P2P_FLOWCTRL_REQ_STEP
)

1136 
	`©h6kl_p2p_Êow˘æ_√tif_å™sôi⁄
(

1137 
¨
,

1138 
ATH6KL_P2P_FLOWCTRL_NETIF_WAKE
);

1143 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

1144 
	`li°_f‹_óch_íåy
(
vif
, &
¨
->
vif_li°
, 
li°
) {

1145 i‡((
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) ||

1146 
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) &&

1147 !
Êushög
[
vif
->
fw_vif_idx
]) {

1148 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

1149 
	`√tif_wake_queue
(
vif
->
ndev
);

1150 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

1153 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

1156 i‡(
wake_evít
)

1157 
	`wake_up
(&
¨
->
evít_wq
);

1161 
Áèl
:

1162 
	`WARN_ON
(1);

1163 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

1165 
	}
}

1167 
	$©h6kl_Êush_d©a_ö_ï_by_if
(
©h6kl_vif
 *
vif
)

1169 
©h6kl
 *
¨
 = 
vif
->ar;

1170 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

1171 
htc_ídpoöt
 *
ídpoöt
;

1172 
li°_hód
 *
tx_queue
, 
c⁄èöî
;

1173 
eid
;

1175 
	`INIT_LIST_HEAD
(&
c⁄èöî
);

1177 
	`•ö_lock_bh
(&
¨
->
htc_èrgë
->
tx_lock
);

1178 
eid
 = 
ENDPOINT_2
;Éid <
ENDPOINT_5
;Éid++) {

1180 
ídpoöt
 = &
¨
->
htc_èrgë
->ídpoöt[
eid
];

1181 
tx_queue
 = &
ídpoöt
->
txq
;

1183 i‡(
	`li°_em±y
(
tx_queue
))

1186 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
,

1187 
tmp_pkt
,

1188 
tx_queue
,

1189 
li°
) {

1190 i‡(
∑ckë
->
vif
 != vif)

1192 
	`li°_dñ
(&
∑ckë
->
li°
);

1193 
∑ckë
->
°©us
 = 0;

1194 
	`li°_add_èû
(

1195 &
∑ckë
->
li°
,

1196 &
c⁄èöî
);

1199 
	`•ö_u∆ock_bh
(&
¨
->
htc_èrgë
->
tx_lock
);

1201 
	`©h6kl_tx_com∂ëe
(
¨
->
htc_èrgë
, &
c⁄èöî
);

1204 
	}
}

1206 
	$©h6kl_tx_d©a_˛ónup_by_if
(
©h6kl_vif
 *
vif
)

1208 
	`©h6kl_Êush_d©a_ö_ï_by_if
(
vif
);

1209 
	`©h6kl_p2p_Êow˘æ_c⁄n_li°_˛ónup_by_if
(
vif
);

1210 
	}
}

1212 
	$©h6kl_tx_d©a_˛ónup
(
©h6kl
 *
¨
)

1214 
i
;

1217 
i
 = 0; i < 
WMM_NUM_AC
; i++)

1218 
	`©h6kl_htc_Êush_txï
(
¨
->
htc_èrgë
,ár->
ac2ï_m≠
[
i
],

1219 
ATH6KL_DATA_PKT_TAG
);

1221 
	`©h6kl_p2p_Êow˘æ_c⁄n_li°_˛ónup
(
¨
);

1222 
	}
}

1225 #ifde‡
CONFIG_ANDROID


1226 
	$©h6kl_ópﬁ_£nd
(
w‹k_°ru˘
 *
w‹k
)

1228 
©h6kl_vif
 *
vif
 = 
NULL
;

1230 i‡(!
w‹k
)

1231 
FAILED
;

1233 
vif
 = 
	`c⁄èöî_of
(
w‹k
, 
©h6kl_vif
,

1234 
w‹k_ópﬁ_£nd
.
w‹k
);

1236 i‡(!
vif
)

1237 
FAILED
;

1239 
	`•ö_lock_bh
(&
vif
->
≥nd_skb_lock
);

1241 i‡(!
vif
->
≥nd_skb
) {

1242 
	`˛ór_bô
(
FIRST_EAPOL_PENDSENT
, &
vif
->
Êags
);

1243 
	`•ö_u∆ock_bh
(&
vif
->
≥nd_skb_lock
);

1244 
FAILED
;

1247 i‡(!(
vif
->
≥nd_skb
->
dev
->
Êags
 & 
IFF_UP
)) {

1248 
	`dev_k‰ì_skb
(
vif
->
≥nd_skb
);

1249 
vif
->
≥nd_skb
 = 
NULL
;

1250 
	`˛ór_bô
(
FIRST_EAPOL_PENDSENT
, &
vif
->
Êags
);

1251 
	`•ö_u∆ock_bh
(&
vif
->
≥nd_skb_lock
);

1255 
	`√tif_rx_ni
(
vif
->
≥nd_skb
);

1257 
vif
->
≥nd_skb
 = 
NULL
;

1259 
	`˛ór_bô
(
FIRST_EAPOL_PENDSENT
, &
vif
->
Êags
);

1261 
	`•ö_u∆ock_bh
(&
vif
->
≥nd_skb_lock
);

1264 
FAILED
:

1265 
	`˛ór_bô
(
FIRST_EAPOL_PENDSENT
, &
vif
->
Êags
);

1266 
	`©h6kl_îr
("%†Áûed\n", 
__func__
);

1268 
	}
}

1272 
	$©h6kl_dñivî_‰ames_to_nw_°ack
(
√t_devi˚
 *
dev
,

1273 
sk_buff
 *
skb
)

1275 
	#ETHERTYPE_IP
 0x0800

	)

1276 
	#IP_PROTO_UDP
 0x11

	)

1277 
©h6kl_vif
 *
vif
 = 
	`√tdev_¥iv
(
dev
);

1279 i‡(!
skb
)

1282 
skb
->
dev
 = dev;

1284 i‡(!(
skb
->
dev
->
Êags
 & 
IFF_UP
)) {

1285 
	`dev_k‰ì_skb
(
skb
);

1290 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

1291 
ëhhdr
 *
d©≠
 = (ëhhd∏*Ë
skb
->
d©a
;

1293 i‡(
	`©h6kl_föd_°a
(
vif
, 
d©≠
->
h_de°
)) {

1294 i‡(
vif
->
öåa_bss
)

1295 
	`©h6kl_d©a_tx
(
skb
, 
dev
, 
åue
);

1297 
	`dev_k‰ì_skb
(
skb
);

1303 
skb
->
¥Ÿocﬁ
 = 
	`ëh_ty≥_å™s
(skb, skb->
dev
);

1305 i‡(
skb
->
¥Ÿocﬁ
 =
	`˝u_to_be16
(
ETH_P_PAE
)) {

1306 #ifde‡
CONFIG_ANDROID


1307 
©h6kl
 *
¨
 = 
vif
->ar;

1309 i‡(
	`ã°_bô
(
CONNECT_HANDSHAKE_PROTECT
, &
vif
->
Êags
) &&

1310 (
¨
->
wùhy
->
Êags
 & 
WIPHY_FLAG_SUPPORTS_FW_ROAM
)) {

1311 i‡(
vif
->
≥nd_skb
 !
NULL
)

1312 
	`©h6kl_Êush_≥nd_skb
(
vif
);

1314 i‡(
	`ã°_bô
(
FIRST_EAPOL_PENDSENT
, &
vif
->
Êags
)) {

1315 
vif
->
≥nd_skb
 = 
skb
;

1316 
	`INIT_DELAYED_WORK
(&
vif
->
w‹k_ópﬁ_£nd
,

1317 
©h6kl_ópﬁ_£nd
);

1318 
	`scheduÀ_dñayed_w‹k
(&
vif
->
w‹k_ópﬁ_£nd
,

1319 
ATH6KL_EAPOL_DELAY_REPORT_IN_HANDSHAKE
);

1324 i‡(
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
))

1325 
	`©h6kl_ópﬁ_h™dshake_¥Ÿe˘
(
vif
, 
Ál£
);

1332 #ifde‡
CONFIG_ATH6KL_UDP_TPUT_WAR


1333 i‡(
skb
->
¥Ÿocﬁ
 =
	`ht⁄s
(
ETHERTYPE_IP
)) {

1334 
ëhhdr
 *
ëh
 = 
	`ëh_hdr
(
skb
);

1335 
ùhdr
 *
ù_hdr
 =

1336 (
ùhdr
 *)((
u8
 *)
ëh
 + (
ëhhdr
));

1338 i‡(
ù_hdr
->
¥Ÿocﬁ
 =
IP_PROTO_UDP
) {

1339 
sk_buff
 *
√w_skb
;

1341 
√w_skb
 = 
	`dev_Æloc_skb
(
skb
->
Àn
+
ETH_HLEN
);

1346 i‡(
√w_skb
 =
NULL
) {

1347 
	`√tif_rx_ni
(
skb
);

1349 
	`skb_put
(
√w_skb
, 
skb
->
Àn
+
ETH_HLEN
);

1350 
	`mem˝y
(
√w_skb
->
d©a
, 
ëh
, 
skb
->
Àn
+
ETH_HLEN
);

1352 
√w_skb
->
dev
 = dev;

1353 
√w_skb
->
¥Ÿocﬁ
 =

1354 
	`ëh_ty≥_å™s
(
√w_skb
,Çew_skb->
dev
);

1355 
	`dev_k‰ì_skb
(
skb
);

1356 
	`√tif_rx_ni
(
√w_skb
);

1364 
	`√tif_rx_ni
(
skb
);

1365 
	}
}

1367 
	$©h6kl_Æloc_√tbufs
(
sk_buff_hód
 *
q
, 
u16
 
num
)

1369 
sk_buff
 *
skb
;

1371 
num
) {

1372 
skb
 = 
	`©h6kl_buf_Æloc
(
ATH6KL_BUFFER_SIZE
);

1373 i‡(!
skb
) {

1374 
	`©h6kl_îr
("netbufállocation failed\n");

1377 
	`skb_queue_èû
(
q
, 
skb
);

1378 
num
--;

1380 
	}
}

1382 
sk_buff
 *
	$aggr_gë_‰ì_skb
(
aggr_c⁄n_öfo
 *
aggr_c⁄n
)

1384 
aggr_öfo
 *
aggr
 = 
aggr_c⁄n
->
aggr_˙txt
;

1385 
sk_buff
 *
skb
 = 
NULL
;

1387 
	`WARN_ON
(!
aggr
);

1388 i‡(
	`skb_queue_Àn
(&
aggr
->
‰ì_q
Ë< (
AGGR_NUM_OF_FREE_NETBUFS
 >> 2))

1389 
	`©h6kl_Æloc_√tbufs
(&
aggr
->
‰ì_q
, 
AGGR_NUM_OF_FREE_NETBUFS
);

1391 
skb
 = 
	`skb_dequeue
(&
aggr
->
‰ì_q
);

1393  
skb
;

1394 
	}
}

1396 
	$©h6kl_rx_ªfûl
(
htc_èrgë
 *
èrgë
, 
htc_ídpoöt_id
 
ídpoöt
)

1398 
©h6kl
 *
¨
 = 
èrgë
->
dev
->ar;

1399 
sk_buff
 *
skb
;

1400 
rx_buf
;

1401 
n_buf_ªfûl
;

1402 
htc_∑ckë
 *
∑ckë
;

1403 
li°_hód
 
queue
;

1405 
n_buf_ªfûl
 = 
ATH6KL_MAX_RX_BUFFERS
 -

1406 
	`©h6kl_htc_gë_rxbuf_num
(
¨
->
htc_èrgë
, 
ídpoöt
);

1408 i‡(
n_buf_ªfûl
 <= 0)

1411 
	`INIT_LIST_HEAD
(&
queue
);

1413 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_RX
,

1415 
__func__
, 
n_buf_ªfûl
, 
ídpoöt
);

1417 
rx_buf
 = 0;Ñx_bu‡< 
n_buf_ªfûl
;Ñx_buf++) {

1418 
skb
 = 
	`©h6kl_buf_Æloc
(
ATH6KL_BUFFER_SIZE
);

1419 i‡(!
skb
)

1422 
∑ckë
 = (
htc_∑ckë
 *Ë
skb
->
hód
;

1423 i‡(!
	`IS_ALIGNED
((Ë
skb
->
d©a
, 4)) {

1424 
size_t
 
Àn
 = 
	`skb_hódÀn
(
skb
);

1425 
skb
->
d©a
 = 
	`PTR_ALIGN
(skb->data - 4, 4);

1426 
	`skb_£t_èû_poöãr
(
skb
, 
Àn
);

1428 
	`£t_htc_rxpkt_öfo
(
∑ckë
, 
skb
, skb->
d©a
,

1429 
ATH6KL_BUFFER_SIZE
, 
ídpoöt
);

1430 
∑ckë
->
skb
 = skb;

1432 
	`li°_add_èû
(&
∑ckë
->
li°
, &
queue
);

1435 i‡(!
	`li°_em±y
(&
queue
))

1436 
	`©h6kl_htc_add_rxbuf_mu…ùÀ
(
¨
->
htc_èrgë
, &
queue
);

1437 
	}
}

1439 
	$©h6kl_ªfûl_amsdu_rxbufs
(
©h6kl
 *
¨
, 
cou¡
)

1441 
htc_∑ckë
 *
∑ckë
;

1442 
sk_buff
 *
skb
;

1444 
cou¡
) {

1445 
skb
 = 
	`©h6kl_buf_Æloc
(
ATH6KL_AMSDU_BUFFER_SIZE
);

1446 i‡(!
skb
)

1449 
∑ckë
 = (
htc_∑ckë
 *Ë
skb
->
hód
;

1450 i‡(!
	`IS_ALIGNED
((Ë
skb
->
d©a
, 4)) {

1451 
size_t
 
Àn
 = 
	`skb_hódÀn
(
skb
);

1452 
skb
->
d©a
 = 
	`PTR_ALIGN
(skb->data - 4, 4);

1453 
	`skb_£t_èû_poöãr
(
skb
, 
Àn
);

1455 
	`£t_htc_rxpkt_öfo
(
∑ckë
, 
skb
, skb->
d©a
,

1456 
ATH6KL_AMSDU_BUFFER_SIZE
, 0);

1457 
∑ckë
->
skb
 = skb;

1459 
	`•ö_lock_bh
(&
¨
->
lock
);

1460 
	`li°_add_èû
(&
∑ckë
->
li°
, &
¨
->
amsdu_rx_buf„r_queue
);

1461 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

1462 
cou¡
--;

1464 
	}
}

1470 
htc_∑ckë
 *
	$©h6kl_Æloc_amsdu_rxbuf
(
htc_èrgë
 *
èrgë
,

1471 
htc_ídpoöt_id
 
ídpoöt
,

1472 
Àn
)

1474 
©h6kl
 *
¨
 = 
èrgë
->
dev
->ar;

1475 
htc_∑ckë
 *
∑ckë
 = 
NULL
;

1476 
li°_hód
 *
pkt_pos
;

1477 
ªfûl_˙t
 = 0, 
dïth
 = 0;

1479 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_RX
, "%s:Éid=%d,Üen:%d\n",

1480 
__func__
, 
ídpoöt
, 
Àn
);

1482 i‡((
Àn
 <
ATH6KL_BUFFER_SIZE
) ||

1483 (
Àn
 > 
ATH6KL_AMSDU_BUFFER_SIZE
))

1484  
NULL
;

1486 
	`•ö_lock_bh
(&
¨
->
lock
);

1488 i‡(
	`li°_em±y
(&
¨
->
amsdu_rx_buf„r_queue
)) {

1489 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

1490 
ªfûl_˙t
 = 
ATH6KL_MAX_AMSDU_RX_BUFFERS
;

1491 
ªfûl_buf
;

1494 
∑ckë
 = 
	`li°_fú°_íåy
(&
¨
->
amsdu_rx_buf„r_queue
,

1495 
htc_∑ckë
, 
li°
);

1496 
	`li°_dñ
(&
∑ckë
->
li°
);

1497 
	`li°_f‹_óch
(
pkt_pos
, &
¨
->
amsdu_rx_buf„r_queue
)

1498 
dïth
++;

1500 
ªfûl_˙t
 = 
ATH6KL_MAX_AMSDU_RX_BUFFERS
 - 
dïth
;

1501 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

1504 
∑ckë
->
ídpoöt
 =Éndpoint;

1506 
ªfûl_buf
:

1507 i‡(
ªfûl_˙t
 >
ATH6KL_AMSDU_REFILL_THRESHOLD
)

1508 
	`©h6kl_ªfûl_amsdu_rxbufs
(
¨
, 
ªfûl_˙t
);

1510  
∑ckë
;

1511 
	}
}

1513 
	$aggr_¶i˚_amsdu
(
aggr_c⁄n_öfo
 *
aggr_c⁄n
,

1514 
rxtid
 *rxtid, 
sk_buff
 *
skb
)

1516 
sk_buff
 *
√w_skb
;

1517 
ëhhdr
 *
hdr
;

1518 
u16
 
‰ame_8023_Àn
, 
∑ylﬂd_8023_Àn
, 
mac_hdr_Àn
, 
amsdu_Àn
;

1519 
u8
 *
‰amï
;

1521 
mac_hdr_Àn
 = (
ëhhdr
);

1522 
‰amï
 = 
skb
->
d©a
 + 
mac_hdr_Àn
;

1523 
amsdu_Àn
 = 
skb
->
Àn
 - 
mac_hdr_Àn
;

1525 
amsdu_Àn
 > 
mac_hdr_Àn
) {

1526 
hdr
 = (
ëhhdr
 *Ë
‰amï
;

1527 
∑ylﬂd_8023_Àn
 = 
	`¡ohs
(
hdr
->
h_¥Ÿo
);

1529 i‡(
∑ylﬂd_8023_Àn
 < 
MIN_MSDU_SUBFRAME_PAYLOAD_LEN
 ||

1530 
∑ylﬂd_8023_Àn
 > 
MAX_MSDU_SUBFRAME_PAYLOAD_LEN
) {

1531 
	`©h6kl_îr
("802.3 AMSDU frame bound check failed.Üen %d\n",

1532 
∑ylﬂd_8023_Àn
);

1536 
‰ame_8023_Àn
 = 
∑ylﬂd_8023_Àn
 + 
mac_hdr_Àn
;

1537 
√w_skb
 = 
	`aggr_gë_‰ì_skb
(
aggr_c⁄n
);

1538 i‡(!
√w_skb
) {

1539 
	`©h6kl_îr
("no bufferávailable\n");

1543 
	`mem˝y
(
√w_skb
->
d©a
, 
‰amï
, 
‰ame_8023_Àn
);

1544 
	`skb_put
(
√w_skb
, 
‰ame_8023_Àn
);

1545 i‡(
	`©h6kl_wmi_dŸ3_2_dix
(
√w_skb
)) {

1546 
	`©h6kl_îr
("dot3_2_dixÉrror\n");

1547 
	`dev_k‰ì_skb
(
√w_skb
);

1551 
	`skb_queue_èû
(&
rxtid
->
q
, 
√w_skb
);

1554 i‡((
amsdu_Àn
 - 
‰ame_8023_Àn
) == 0)

1560 
‰ame_8023_Àn
 = 
	`ALIGN
(frame_8023_len, 4);

1562 
‰amï
 +
‰ame_8023_Àn
;

1563 
amsdu_Àn
 -
‰ame_8023_Àn
;

1566 
	`dev_k‰ì_skb
(
skb
);

1567 
	}
}

1569 
	$aggr_deque_‰ms
(
aggr_c⁄n_öfo
 *
aggr_c⁄n
, 
u8
 
tid
,

1570 
u16
 
£q_no
, 
u8
 
‹dî
)

1572 
sk_buff
 *
skb
;

1573 
rxtid
 *rxtid;

1574 
skb_hﬁd_q
 *
node
;

1575 
u16
 
idx
, 
idx_íd
, 
£q_íd
;

1576 
rxtid_°©s
 *
°©s
;

1577 
√t_devi˚
 *
dev
;

1579 i‡(!
aggr_c⁄n
)

1582 
rxtid
 = 
	`AGGR_GET_RXTID
(
aggr_c⁄n
, 
tid
);

1583 
°©s
 = 
	`AGGR_GET_RXTID_STATS
(
aggr_c⁄n
, 
tid
);

1585 
idx
 = 
	`AGGR_WIN_IDX
(
rxtid
->
£q_√xt
,Ñxtid->
hﬁd_q_sz
);

1600 
£q_íd
 = 
£q_no
 ? seq_nÿ: 
rxtid
->
£q_√xt
;

1601 
idx_íd
 = 
	`AGGR_WIN_IDX
(
£q_íd
, 
rxtid
->
hﬁd_q_sz
);

1603 
	`•ö_lock_bh
(&
rxtid
->
lock
);

1606 
node
 = &
rxtid
->
hﬁd_q
[
idx
];

1607 i‡((
‹dî
 =1Ë&& (!
node
->
skb
))

1610 i‡(
node
->
skb
) {

1611 i‡(
node
->
is_amsdu
)

1612 
	`aggr_¶i˚_amsdu
(
aggr_c⁄n
, 
rxtid
, 
node
->
skb
);

1614 
	`skb_queue_èû
(&
rxtid
->
q
, 
node
->
skb
);

1615 
node
->
skb
 = 
NULL
;

1617 
°©s
->
num_hﬁe
++;

1619 
rxtid
->
£q_√xt
 = 
	`ATH6KL_NEXT_SEQ_NO
(rxtid->seq_next);

1620 
idx
 = 
	`AGGR_WIN_IDX
(
rxtid
->
£q_√xt
,Ñxtid->
hﬁd_q_sz
);

1621 } 
idx
 !
idx_íd
);

1623 
°©s
->
num_dñivîed
 +
	`skb_queue_Àn
(&
rxtid
->
q
);

1625 
	`WARN_ON
(!
aggr_c⁄n
->
dev
);

1626 
dev
 = 
aggr_c⁄n
->dev;

1627 (
skb
 = 
	`skb_dequeue
(&
rxtid
->
q
)))

1628 
	`©h6kl_dñivî_‰ames_to_nw_°ack
(
dev
, 
skb
);

1629 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

1630 
	}
}

1632 
boﬁ
 
	$aggr_¥o˚ss_ªcv_‰m
(
©h6kl
 *
¨
,

1633 
aggr_c⁄n_öfo
 *
aggr_c⁄n
,

1634 
u8
 
tid
, 
u16
 
£q_no
,

1635 
boﬁ
 
is_amsdu
, 
sk_buff
 *
‰ame
)

1637 
rxtid
 *rxtid;

1638 
rxtid_°©s
 *
°©s
;

1639 
sk_buff
 *
skb
;

1640 
skb_hﬁd_q
 *
node
;

1641 
u16
 
idx
, 
°
, 
cur
, 
íd
;

1642 
boﬁ
 
is_queued
 = 
Ál£
;

1643 
u16
 
exãnded_íd
;

1644 
boﬁ
 
dr›_ô
 = 
Ál£
;

1646 
rxtid
 = 
	`AGGR_GET_RXTID
(
aggr_c⁄n
, 
tid
);

1647 
°©s
 = 
	`AGGR_GET_RXTID_STATS
(
aggr_c⁄n
, 
tid
);

1649 
°©s
->
num_öto_aggr
++;

1651 i‡(!
rxtid
->
aggr
) {

1652 i‡(
is_amsdu
) {

1653 
√t_devi˚
 *
dev
;

1655 
	`aggr_¶i˚_amsdu
(
aggr_c⁄n
, 
rxtid
, 
‰ame
);

1656 
is_queued
 = 
åue
;

1657 
°©s
->
num_amsdu
++;

1659 
	`WARN_ON
(!
aggr_c⁄n
->
dev
);

1660 
dev
 = 
aggr_c⁄n
->dev;

1661 (
skb
 = 
	`skb_dequeue
(&
rxtid
->
q
)))

1662 
	`©h6kl_dñivî_‰ames_to_nw_°ack
(
dev
,

1663 
skb
);

1665  
is_queued
;

1668 
	`•ö_lock_bh
(&
rxtid
->
lock
);

1669 i‡(
rxtid
->
sync_√xt_£q
 =
åue
) {

1670 
rxtid
->
£q_√xt
 = 
£q_no
;

1671 
rxtid
->
sync_√xt_£q
 = 
Ál£
;

1675 
°
 = 
rxtid
->
£q_√xt
;

1676 
cur
 = 
£q_no
;

1677 
íd
 = (
°
 + 
rxtid
->
hﬁd_q_sz
-1Ë& 
ATH6KL_MAX_SEQ_NO
;

1678 i‡(((
°
 < 
íd
Ë&& (
cur
 < st || cur >Énd)) ||

1679 ((
°
 > 
íd
Ë&& (
cur
 >Énd) && (cur < st))) {

1680 
exãnded_íd
 = (
íd
 + 
rxtid
->
hﬁd_q_sz
) &

1681 
ATH6KL_MAX_SEQ_NO
;

1683 i‡(((
íd
 < 
exãnded_íd
) &&

1684 (
cur
 < 
íd
 || cu∏> 
exãnded_íd
)) ||

1685 ((
íd
 > 
exãnded_íd
Ë&& (
cur
 >Éxtended_end) &&

1686 (
cur
 < 
íd
))) {

1687 
u16
 
ønge_vÆ
 = ((
cur
-
°
Ë& 
ATH6KL_MAX_SEQ_NO
);

1688 
	`©h6kl_dbg
(
ATH6KL_DBG_AGGR
,

1690 
__func__
, 
__LINE__
, 
ønge_vÆ
, (
rxtid
->
hﬁd_q_sz
 << 1),

1691 
°
, 
cur
, 
tid
);

1693 i‡((
ønge_vÆ
 >(
rxtid
->
hﬁd_q_sz
 << 1)) &&

1694 (
ønge_vÆ
 <=

1695 (
ATH6KL_MAX_SEQ_NO
-(
rxtid
->
hﬁd_q_sz
 << 1)+1))) {

1697 
	`©h6kl_dbg
(
ATH6KL_DBG_AGGR
, "%s[%d] chase seq\n",

1698 
__func__
, 
__LINE__
);

1700 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

1701 
	`aggr_deque_‰ms
(
aggr_c⁄n
, 
tid
, 0, 0);

1702 
	`•ö_lock_bh
(&
rxtid
->
lock
);

1704 
rxtid
->
£q_√xt
 =

1705 (
cur
 - 
rxtid
->
hﬁd_q_sz
) &

1706 
ATH6KL_MAX_SEQ_NO
;

1709 
	`©h6kl_dbg
(
ATH6KL_DBG_AGGR
, "%s[%d] old seq\n",

1710 
__func__
, 
__LINE__
);

1712 
dr›_ô
 = 
åue
;

1718 
°
 = (
cur
 - (
rxtid
->
hﬁd_q_sz
-1)Ë& 
ATH6KL_MAX_SEQ_NO
;

1719 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

1720 
	`aggr_deque_‰ms
(
aggr_c⁄n
, 
tid
, 
°
, 0);

1721 
	`•ö_lock_bh
(&
rxtid
->
lock
);

1723 
°©s
->
num_oow
++;

1726 i‡((
dr›_ô
 =
åue
) &&

1727 !(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_DISABLE_RX_AGGR_DROP
)) {

1728 
	`dev_k‰ì_skb
(
‰ame
);

1729 
is_queued
 = 
åue
;

1730 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

1731  
is_queued
;

1734 
idx
 = 
	`AGGR_WIN_IDX
(
£q_no
, 
rxtid
->
hﬁd_q_sz
);

1736 
node
 = &
rxtid
->
hﬁd_q
[
idx
];

1750 
	`dev_k‰ì_skb
(
node
->
skb
);

1751 
°©s
->
num_dups
++;

1753 
node
->
skb
 = 
‰ame
;

1754 
is_queued
 = 
åue
;

1755 
node
->
is_amsdu
 = is_amsdu;

1756 
node
->
£q_no
 = seq_no;

1758 i‡(
node
->
is_amsdu
)

1759 
°©s
->
num_amsdu
++;

1761 
°©s
->
num_mpdu
++;

1763 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

1764 
	`aggr_deque_‰ms
(
aggr_c⁄n
, 
tid
, 0, 1);

1765 
	`•ö_lock_bh
(&
rxtid
->
lock
);

1767 i‡(
rxtid
->
tid_timî_scheduÀd
 &&

1768 
rxtid
->
timîwaô_£q_num
 !rxtid->
£q_√xt
) {

1769 
	`dñ_timî
(&
rxtid
->
tid_timî
);

1770 
rxtid
->
tid_timî_scheduÀd
 = 
Ál£
;

1771 
rxtid
->
c⁄töuous_cou¡
 = 0;

1774 i‡(!
rxtid
->
tid_timî_scheduÀd
) {

1775 
idx
 = 0 ; idx < 
rxtid
->
hﬁd_q_sz
; idx++) {

1776 i‡(
rxtid
->
hﬁd_q
[
idx
].
skb
) {

1777 
rxtid
->
issue_timî_£q
 =

1778 
rxtid
->
hﬁd_q
[
idx
].
£q_no
;

1785 
rxtid
->
tid_timî_scheduÀd
 = 
åue
;

1786 
rxtid
->
timîwaô_£q_num
 =Ñxtid->
£q_√xt
;

1787 
rxtid
->
c⁄töuous_cou¡
++;

1788 
	`mod_timî
(&
rxtid
->
tid_timî
,

1789 (
jiffõs
 +

1790 
	`m£cs_to_jiffõs
(

1791 
aggr_c⁄n
->
tid_timeout_£âög
[
tid
])));

1796 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

1798  
is_queued
;

1799 
	}
}

1801 
	$©h6kl_u≠sd_åiggî_‰ame_rx
(
©h6kl_vif
 *
vif
,

1802 
©h6kl_°a
 *
c⁄n
)

1804 
boﬁ
 
is_psq_em±y
;

1805 
boﬁ
 
is_psq_em±y_©_°¨t
;

1806 
u32
 
num_‰ames_to_dñivî
;

1807 
©h6kl_ps_buf_desc
 *
ps_buf
;

1815 
num_‰ames_to_dñivî
 = (
c⁄n
->
≠sd_öfo
 >> 4) & 0xF;

1821 i‡(!
num_‰ames_to_dñivî
)

1822 
num_‰ames_to_dñivî
 = 0xFFFF;

1825 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

1826 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

1828 
__func__
, 
c⁄n
->
aid
, c⁄n->
°a_Êags
, c⁄n->
≠sd_öfo
,

1829 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
),

1830 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
));

1832 
is_psq_em±y
 = 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
) &&

1833 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
);

1834 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

1836 
is_psq_em±y_©_°¨t
 = 
is_psq_em±y
;

1837 (!
is_psq_em±y
Ë&& (
num_‰ames_to_dñivî
)) {

1838 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

1839 i‡(!
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
)) {

1840 
õì80211_mgmt
 *
mgmt
;

1842 
ps_buf
 = 
	`©h6kl_ps_queue_dequeue
(&
c⁄n
->
psq_mgmt
);

1843 
is_psq_em±y
 = 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
) &&

1844 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
);

1845 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

1850 
c⁄n
->
°a_Êags
 |
STA_PS_APSD_TRIGGER
;

1851 
num_‰ames_to_dñivî
--;

1856 i‡((
is_psq_em±y
) ||

1857 (!
num_‰ames_to_dñivî
))

1858 
c⁄n
->
°a_Êags
 |
STA_PS_APSD_EOSP
;

1860 
mgmt
 = (
õì80211_mgmt
 *Ë
ps_buf
->
buf
;

1861 i‡(
ps_buf
->
buf
 +Ös_buf->
Àn
 >=

1862 
mgmt
->
u
.
¥obe_ª•
.
v¨übÀ
 &&

1863 
	`õì80211_is_¥obe_ª•
(
mgmt
->
‰ame_c⁄åﬁ
))

1864 
	`©h6kl_wmi_£nd_go_¥obe_ª•⁄£_cmd
(

1865 
vif
->
¨
->
wmi
,

1866 
vif
,

1867 
ps_buf
->
buf
,

1868 
ps_buf
->
Àn
,

1869 
ps_buf
->
‰eq
);

1871 
	`©h6kl_wmi_£nd_a˘i⁄_cmd
(
vif
->
¨
->
wmi
,

1872 
vif
->
fw_vif_idx
,

1873 
ps_buf
->
id
,

1874 
ps_buf
->
‰eq
,

1875 
ps_buf
->
waô
,

1876 
ps_buf
->
buf
,

1877 
ps_buf
->
Àn
);

1879 
	`k‰ì
(
ps_buf
);

1880 
c⁄n
->
°a_Êags
 &~(
STA_PS_APSD_TRIGGER
);

1881 
c⁄n
->
°a_Êags
 &~(
STA_PS_APSD_EOSP
);

1883 
ps_buf
 = 
	`©h6kl_ps_queue_dequeue
(&
c⁄n
->
psq_d©a
);

1885 
is_psq_em±y
 = 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
) &&

1886 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
);

1887 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

1889 i‡(
ps_buf
) {

1893 
c⁄n
->
°a_Êags
 |
STA_PS_APSD_TRIGGER
;

1894 
num_‰ames_to_dñivî
--;

1899 i‡((
is_psq_em±y
) ||

1900 (!
num_‰ames_to_dñivî
))

1901 
c⁄n
->
°a_Êags
 |
STA_PS_APSD_EOSP
;

1903 
	`WARN_ON
(!
ps_buf
->
skb
);

1904 
	`©h6kl_d©a_tx
(
ps_buf
->
skb
, 
vif
->
ndev
, 
åue
);

1905 
	`k‰ì
(
ps_buf
);

1906 
c⁄n
->
°a_Êags
 &~(
STA_PS_APSD_TRIGGER
);

1907 
c⁄n
->
°a_Êags
 &~(
STA_PS_APSD_EOSP
);

1912 i‡(
is_psq_em±y
) {

1913 
	`©h6kl_wmi_£t_pvb_cmd
(
vif
->
¨
->
wmi
,

1914 
vif
->
fw_vif_idx
, 
c⁄n
->
aid
, 0);

1916 i‡(
is_psq_em±y_©_°¨t
)

1917 
	`©h6kl_wmi_£t_≠sd_buf„ªd_åaffic_cmd
(
vif
->
¨
->
wmi
,

1918 
vif
->
fw_vif_idx
, 
c⁄n
->
aid
, 0,

1919 
WMI_AP_APSD_NO_DELIVERY_FRAMES_FOR_THIS_TRIGGER


1922 
	`©h6kl_wmi_£t_≠sd_buf„ªd_åaffic_cmd
(
vif
->
¨
->
wmi
,

1923 
vif
->
fw_vif_idx
, 
c⁄n
->
aid
, 0,

1928 
	}
}

1930 
ölöe
 
©h6kl_°a
 *
	$_powîßve_≠_rx
(
©h6kl_vif
 *
vif
,

1931 
sk_buff
 *
skb
, 
Àn
,

1932 
boﬁ
 
ps_°©e
, boﬁ 
åiggî_°©e
)

1934 
©h6kl
 *
¨
 = 
vif
->ar;

1935 
©h6kl_°a
 *
c⁄n
;

1936 
ëhhdr
 *
d©≠
 = 
NULL
;

1937 
boﬁ
 
¥ev_ps
;

1938 
mö_hdr_Àn
;

1940 
d©≠
 = (
ëhhdr
 *Ë(
skb
->
d©a
);

1941 
c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, 
d©≠
->
h_sour˚
);

1942 i‡(!
c⁄n
) {

1943 
	`dev_k‰ì_skb
(
skb
);

1944  
NULL
;

1953 
¥ev_ps
 = !!(
c⁄n
->
°a_Êags
 & 
STA_PS_SLEEP
);

1955 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

1958 
__func__
,

1959 
c⁄n
->
aid
,

1960 
c⁄n
->
°a_Êags
,

1961 
¥ev_ps
,

1962 
ps_°©e
,

1963 
åiggî_°©e
,

1964 
Àn
);

1966 i‡(
ps_°©e
) {

1967 
c⁄n
->
°a_Êags
 |
STA_PS_SLEEP
;

1968 i‡(!
¥ev_ps
) {

1969 
	`aggr_tx_Êush
(
vif
 , 
c⁄n
);

1970 
	`©h6kl_ps_queue_age_°¨t
(
c⁄n
);

1973 
c⁄n
->
°a_Êags
 &~
STA_PS_SLEEP
;

1974 i‡(
¥ev_ps
)

1975 
	`©h6kl_ps_queue_age_°›
(
c⁄n
);

1978 i‡(
c⁄n
->
°a_Êags
 & 
STA_PS_SLEEP
) {

1980 i‡(
åiggî_°©e
)

1981 
	`©h6kl_u≠sd_åiggî_‰ame_rx
(
vif
, 
c⁄n
);

1984 i‡(
¥ev_ps
 ^ !!(
c⁄n
->
°a_Êags
 & 
STA_PS_SLEEP
)) {

1985 i‡(!(
c⁄n
->
°a_Êags
 & 
STA_PS_SLEEP
)) {

1986 
©h6kl_ps_buf_desc
 *
ps_buf
;

1987 
boﬁ
 
is_psq_em±y_©_°¨t
;

1988 
õì80211_mgmt
 *
mgmt
;

1990 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

1991 
	`©h6kl_dbg
(
ATH6KL_DBG_POWERSAVE
,

1993 
__func__
,

1994 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
),

1995 !
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
));

1997 
is_psq_em±y_©_°¨t
 =

1998 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_d©a
) &&

1999 
	`©h6kl_ps_queue_em±y
(&
c⁄n
->
psq_mgmt
);

2001 (
ps_buf
 = 
	`©h6kl_ps_queue_dequeue
(

2002 &
c⁄n
->
psq_mgmt
)Ë!
NULL
) {

2003 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

2005 
mgmt
 = (
õì80211_mgmt
 *Ë
ps_buf
->
buf
;

2007 i‡((
ps_buf
->
buf
 +Ös_buf->
Àn
 >=

2008 
mgmt
->
u
.
¥obe_ª•
.
v¨übÀ
) &&

2009 
	`õì80211_is_¥obe_ª•
(

2010 
mgmt
->
‰ame_c⁄åﬁ
))

2011 
	`©h6kl_wmi_£nd_go_¥obe_ª•⁄£_cmd
(

2012 
¨
->
wmi
,

2013 
vif
,

2014 
ps_buf
->
buf
,

2015 
ps_buf
->
Àn
,

2016 
ps_buf
->
‰eq
);

2018 
	`©h6kl_wmi_£nd_a˘i⁄_cmd
(

2019 
¨
->
wmi
,

2020 
vif
->
fw_vif_idx
,

2021 
ps_buf
->
id
,

2022 
ps_buf
->
‰eq
,

2023 
ps_buf
->
waô
,

2024 
ps_buf
->
buf
,

2025 
ps_buf
->
Àn
);

2026 
	`k‰ì
(
ps_buf
);

2027 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

2030 (
ps_buf
 = 
	`©h6kl_ps_queue_dequeue
(

2031 &
c⁄n
->
psq_d©a
)Ë!
NULL
) {

2032 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

2034 
	`WARN_ON
(!
ps_buf
->
skb
);

2035 
	`©h6kl_d©a_tx
(
ps_buf
->
skb
,

2036 
vif
->
ndev
, 
åue
);

2037 
	`k‰ì
(
ps_buf
);

2038 
	`•ö_lock_bh
(&
c⁄n
->
lock
);

2041 
	`•ö_u∆ock_bh
(&
c⁄n
->
lock
);

2043 i‡(!
is_psq_em±y_©_°¨t
)

2044 
	`©h6kl_wmi_£t_≠sd_buf„ªd_åaffic_cmd
(

2045 
¨
->
wmi
,

2046 
vif
->
fw_vif_idx
,

2047 
c⁄n
->
aid
,

2052 
	`©h6kl_wmi_£t_pvb_cmd
(
¨
->
wmi
,

2053 
vif
->
fw_vif_idx
,

2054 
c⁄n
->
aid
,

2059 
mö_hdr_Àn
 = (
ëhhdr
) +

2060 (
wmi_d©a_hdr
) +

2061 (
©h6kl_Œc_¢≠_hdr
);

2064 i‡((
Àn
 < 
mö_hdr_Àn
) ||

2065 (
Àn
 > 
WMI_MAX_AMSDU_RX_DATA_FRAME_LENGTH
)) {

2066 
	`dev_k‰ì_skb
(
skb
);

2067  
NULL
;

2070  
c⁄n
;

2071 
	}
}

2073 
	$©h6kl_rx
(
htc_èrgë
 *
èrgë
, 
htc_∑ckë
 *
∑ckë
)

2075 
©h6kl
 *
¨
 = 
èrgë
->
dev
->ar;

2076 
sk_buff
 *
skb
 = 
∑ckë
->
pkt_˙txt
;

2077 
wmi_rx_mëa_v2
 *
mëa
;

2078 
wmi_d©a_hdr
 *
dhdr
;

2079 
mö_hdr_Àn
;

2080 
u8
 
mëa_ty≥
, 
dŸ11_hdr
 = 0;

2081 
u8
 
∑d_bef‹e_d©a_°¨t
;

2082 
°©us
 = 
∑ckë
->status;

2083 
htc_ídpoöt_id
 
ït
 = 
∑ckë
->
ídpoöt
;

2084 
boﬁ
 
is_amsdu
;

2085 
©h6kl_°a
 *
c⁄n
 = 
NULL
;

2086 
sk_buff
 *
skb1
 = 
NULL
;

2087 
ëhhdr
 *
d©≠
 = 
NULL
;

2088 
©h6kl_vif
 *
vif
;

2089 
u16
 
£q_no
;

2090 
u8
 
tid
, 
if_idx
;

2092 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_RX
,

2094 
__func__
, 
¨
, 
ït
, 
skb
, 
∑ckë
->
buf
,

2095 
∑ckë
->
a˘_Àn
, 
°©us
);

2097 i‡(
°©us
 || !(
skb
->
d©a
 + 
HTC_HDR_LENGTH
)) {

2098 
	`dev_k‰ì_skb
(
skb
);

2102 
	`skb_put
(
skb
, 
∑ckë
->
a˘_Àn
 + 
HTC_HDR_LENGTH
);

2103 
	`skb_puŒ
(
skb
, 
HTC_HDR_LENGTH
);

2105 i‡(!
	`ã°_bô
(
TESTMODE_EPPING
, &
¨
->
Êag
)) {

2106 i‡(
ït
 =
¨
->
˘æ_ï
) {

2107 
if_idx
 =

2108 
	`wmi_cmd_hdr_gë_if_idx
(

2109 (
wmi_cmd_hdr
 *Ë
skb
->
d©a
);

2111 
if_idx
 =

2112 
	`wmi_d©a_hdr_gë_if_idx
(

2113 (
wmi_d©a_hdr
 *Ë
skb
->
d©a
);

2119 
if_idx
 = 0;

2122 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
if_idx
);

2123 i‡(!
vif
) {

2124 
	`dev_k‰ì_skb
(
skb
);

2132 
vif
->
√t_°©s
.
rx_∑ckës
++;

2133 
vif
->
√t_°©s
.
rx_byãs
 +
∑ckë
->
a˘_Àn
;

2135 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_RAW_BYTES
, 
__func__
, "rx ",

2136 
skb
->
d©a
, skb->
Àn
);

2138 
skb
->
dev
 = 
vif
->
ndev
;

2140 i‡(!
	`ã°_bô
(
WMI_ENABLED
, &
¨
->
Êag
)) {

2141 i‡(
EPPING_ALIGNMENT_PAD
 > 0)

2142 
	`skb_puŒ
(
skb
, 
EPPING_ALIGNMENT_PAD
);

2143 
	`©h6kl_dñivî_‰ames_to_nw_°ack
(
vif
->
ndev
, 
skb
);

2147 
	`©h6kl_check_wow_°©us
(
¨
);

2149 i‡(
ït
 =
¨
->
˘æ_ï
) {

2150 
	`©h6kl_wmi_c⁄åﬁ_rx
(
¨
->
wmi
, 
skb
);

2154 
mö_hdr_Àn
 = (
ëhhdr
Ë+ (
wmi_d©a_hdr
) +

2155 (
©h6kl_Œc_¢≠_hdr
);

2157 
dhdr
 = (
wmi_d©a_hdr
 *Ë
skb
->
d©a
;

2159 
is_amsdu
 = 
	`wmi_d©a_hdr_is_amsdu
(
dhdr
Ë? 
åue
 : 
Ál£
;

2160 
tid
 = 
	`wmi_d©a_hdr_gë_up
(
dhdr
);

2161 
£q_no
 = 
	`wmi_d©a_hdr_gë_£qno
(
dhdr
);

2162 
mëa_ty≥
 = 
	`wmi_d©a_hdr_gë_mëa
(
dhdr
);

2163 
dŸ11_hdr
 = 
	`wmi_d©a_hdr_gë_dŸ11
(
dhdr
);

2164 
∑d_bef‹e_d©a_°¨t
 =

2165 (
	`À16_to_˝u
(
dhdr
->
öfo3
Ë>> 
WMI_DATA_HDR_PAD_BEFORE_DATA_SHIFT
)

2166 & 
WMI_DATA_HDR_PAD_BEFORE_DATA_MASK
;

2167 
∑ckë
->
a˘_Àn
 -
∑d_bef‹e_d©a_°¨t
;

2174 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
 &&

2175 ((
∑ckë
->
a˘_Àn
 < 
mö_hdr_Àn
) ||

2176 (
∑ckë
->
a˘_Àn
 > 
WMI_MAX_AMSDU_RX_DATA_FRAME_LENGTH
))) {

2177 
	`©h6kl_öfo
("frameÜen isÅoo short orÅooÜong\n");

2178 
vif
->
√t_°©s
.
rx_îr‹s
++;

2179 
vif
->
√t_°©s
.
rx_Àngth_îr‹s
++;

2180 
	`dev_k‰ì_skb
(
skb
);

2184 
	`skb_puŒ
(
skb
, (
wmi_d©a_hdr
));

2186 
mëa_ty≥
) {

2187 
WMI_META_VERSION_1
:

2188 
	`skb_puŒ
(
skb
, (
wmi_rx_mëa_v1
));

2190 
WMI_META_VERSION_2
:

2191 
mëa
 = (
wmi_rx_mëa_v2
 *Ë
skb
->
d©a
;

2192 
mëa
->
csum
 = 
	`À16_to_˝u
(meta->csum);

2193 i‡(
mëa
->
csum_Êags
 & 0x1) {

2194 
skb
->
ù_summed
 = 
CHECKSUM_COMPLETE
;

2195 
skb
->
csum
 = (
__f‹˚
 
__wsum
Ë
mëa
->csum;

2197 
	`skb_puŒ
(
skb
, (
wmi_rx_mëa_v2
));

2203 
	`skb_puŒ
(
skb
, 
∑d_bef‹e_d©a_°¨t
);

2205 i‡(
dŸ11_hdr
)

2206 
°©us
 = 
	`©h6kl_wmi_dŸ11_hdr_ªmove
(
¨
->
wmi
, 
skb
);

2207 i‡(!
is_amsdu
)

2208 
°©us
 = 
	`©h6kl_wmi_dŸ3_2_dix
(
skb
);

2210 i‡(
°©us
) {

2215 
	`dev_k‰ì_skb
(
skb
);

2220 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

2221 
boﬁ
 
ps_°©e
, 
åiggî_°©e
;

2223 
ps_°©e
 = !!((
dhdr
->
öfo
 >> 
WMI_DATA_HDR_PS_SHIFT
) &

2224 
WMI_DATA_HDR_PS_MASK
);

2225 
åiggî_°©e
 = 
	`WMI_DATA_HDR_IS_TRIGGER
(
dhdr
);

2227 
c⁄n
 = 
	`_powîßve_≠_rx
(
vif
,

2228 
skb
, 
∑ckë
->
a˘_Àn
,

2229 
ps_°©e
, 
åiggî_°©e
);

2230 i‡(
c⁄n
 =
NULL
)

2234 i‡(!(
vif
->
ndev
->
Êags
 & 
IFF_UP
)) {

2235 
	`dev_k‰ì_skb
(
skb
);

2239 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

2240 
d©≠
 = (
ëhhdr
 *Ë
skb
->
d©a
;

2241 i‡(
	`is_mu…iˇ°_ëhî_addr
(
d©≠
->
h_de°
))

2246 
skb1
 = 
	`skb_c›y
(
skb
, 
GFP_ATOMIC
);

2254 
©h6kl_°a
 *
to_c⁄n
 = 
NULL
;

2256 i‡(
is_amsdu
)

2257 
rx_aggr_¥o˚ss
;

2259 
to_c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, 
d©≠
->
h_de°
);

2261 i‡(
to_c⁄n
 && 
vif
->
öåa_bss
) {

2262 
skb1
 = 
skb
;

2263 
skb
 = 
NULL
;

2264 } i‡(
to_c⁄n
 && !
vif
->
öåa_bss
) {

2265 
	`dev_k‰ì_skb
(
skb
);

2266 
skb
 = 
NULL
;

2269 i‡(
skb1
)

2270 
	`©h6kl_d©a_tx
(
skb1
, 
vif
->
ndev
, 
åue
);

2272 i‡(
skb
 =
NULL
) {

2276 #ifde‡
ATHTST_SUPPORT


2278 i‡(
c⁄n
->
avg_d©a_rssi
 == 0) {

2279 i‡((
dhdr
->
rssi
Ë>
RSSI_LPF_THRESHOLD
)

2280 
c⁄n
->
avg_d©a_rssi
 = 
	`ATH_RSSI_IN
(
dhdr
->
rssi
);

2282 
	`ATH_RSSI_LPF
(
c⁄n
->
avg_d©a_rssi
, 
dhdr
->
rssi
);

2286 #ifde‡
ATHTST_SUPPORT


2287 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
) {

2288 
c⁄n
 = &
vif
->
°a_li°
[0];

2290 i‡(
c⁄n
->
avg_d©a_rssi
 == 0) {

2291 i‡((
dhdr
->
rssi
Ë>
RSSI_LPF_THRESHOLD
)

2292 
c⁄n
->
avg_d©a_rssi
 = 
	`ATH_RSSI_IN
(
dhdr
->
rssi
);

2294 
	`ATH_RSSI_LPF
(
c⁄n
->
avg_d©a_rssi
, 
dhdr
->
rssi
);

2298 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
)

2299 
c⁄n
 = &
vif
->
°a_li°
[0];

2301 
rx_aggr_¥o˚ss
:

2302 
d©≠
 = (
ëhhdr
 *Ë
skb
->
d©a
;

2304 i‡((
	`is_uniˇ°_ëhî_addr
(
d©≠
->
h_de°
) ||

2305 (
vif
->
nw_ty≥
 =
AP_NETWORK
)) &&

2306 
	`aggr_¥o˚ss_ªcv_‰m
(
¨
, 
c⁄n
->
aggr_c⁄n_˙txt
, 
tid
,

2307 
£q_no
, 
is_amsdu
, 
skb
))

2311 
	`©h6kl_dñivî_‰ames_to_nw_°ack
(
vif
->
ndev
, 
skb
);

2312 
	}
}

2314 
	$aggr_tx_¥ogªssive
(
txtid
 *txtid, 
boﬁ
 
tx_timeout
)

2316 
©h6kl_vif
 *
vif
 = 
txtid
->vif;

2317 
aggr_öfo
 *
aggr
 = 
vif
->
aggr_˙txt
;

2318 
now
 = 
jiffõs
;

2321 i‡(
vif
->
nw_ty≥
 !
INFRA_NETWORK
)

2324 
txtid
->
œ°_num_amsdu
++;

2325 i‡(
tx_timeout
)

2326 
txtid
->
œ°_num_timeout
++;

2329 i‡(
aggr
->
tx_amsdu_¥ogªssive
 &&

2330 ((
txtid
->
œ°_check_time
 == 0) ||

2331 (
now
 - 
txtid
->
œ°_check_time
 > 
AGGR_TX_PROG_CHECK_INTVAL
))) {

2338 i‡(!
aggr
->
tx_amsdu_¥ogªssive_hi•ìd
) {

2339 i‡((
txtid
->
œ°_num_amsdu
 > 
AGGR_TX_PROG_HS_THRESH
) &&

2340 (
txtid
->
œ°_num_timeout
 <

2341 (
txtid
->
œ°_num_amsdu
 >>

2342 
AGGR_TX_PROG_HS_FACTOR
))) {

2343 
aggr
->
tx_amsdu_¥ogªssive_hi•ìd
 = 
åue
;

2344 
	`aggr_tx_c⁄fig
(
vif
,

2345 
aggr
->
tx_amsdu_£q_pkt
,

2346 
åue
,

2347 
AGGR_TX_PROG_HS_MAX_NUM
,

2348 
AGGR_TX_MAX_PDU_SIZE
,

2349 
AGGR_TX_PROG_HS_TIMEOUT
);

2351 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

2353 
__func__
,

2354 
txtid
->
œ°_num_amsdu
,

2355 
txtid
->
œ°_num_timeout
);

2357 } i‡(
aggr
->
tx_amsdu_¥ogªssive_hi•ìd
) {

2358 i‡((
txtid
->
œ°_num_amsdu
 < 
AGGR_TX_PROG_NS_THRESH
) &&

2359 (
txtid
->
œ°_num_timeout
 >

2360 (
txtid
->
œ°_num_amsdu
 >>

2361 
AGGR_TX_PROG_NS_FACTOR
))) {

2362 
aggr
->
tx_amsdu_¥ogªssive_hi•ìd
 = 
Ál£
;

2363 
	`aggr_tx_c⁄fig
(
vif
,

2364 
aggr
->
tx_amsdu_£q_pkt
,

2365 
åue
,

2366 
AGGR_TX_MAX_NUM
,

2367 
AGGR_TX_MAX_PDU_SIZE
,

2368 
AGGR_TX_TIMEOUT
);

2369 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

2371 
__func__
,

2372 
txtid
->
œ°_num_amsdu
,

2373 
txtid
->
œ°_num_timeout
);

2378 
txtid
->
œ°_num_amsdu
 = 0;

2379 
txtid
->
œ°_num_timeout
 = 0;

2382 
txtid
->
œ°_check_time
 = 
now
;

2386 
	}
}

2388 
	$aggr_tx_ª£t_aggr
(
txtid
 *txtid, 
boﬁ
 
‰ì_buf
,

2389 
boﬁ
 
timî_°›
)

2392 i‡(
timî_°›
)

2393 
	`dñ_timî
(&
txtid
->
timî
);

2395 i‡((
‰ì_buf
) &&

2396 (
txtid
->
amsdu_skb
))

2397 
	`dev_k‰ì_skb
(
txtid
->
amsdu_skb
);

2399 
txtid
->
amsdu_skb
 = 
NULL
;

2400 
txtid
->
amsdu_°¨t
 = 
NULL
;

2401 
txtid
->
amsdu_˙t
 = 0;

2402 
txtid
->
amsdu_Àn
 = 0;

2403 
txtid
->
amsdu_œ°pdu_Àn
 = 0;

2406 
	}
}

2408 
	$aggr_tx_dñëe_tid_°©e
(
aggr_c⁄n_öfo
 *
aggr_c⁄n
, 
u8
 
tid
)

2410 
txtid
 *txtid;

2411 
aggr_öfo
 *
aggr
 = 
aggr_c⁄n
->
aggr_˙txt
;

2413 
txtid
 = 
	`AGGR_GET_TXTID
(
aggr_c⁄n
, 
tid
);

2415 
	`•ö_lock_bh
(&
txtid
->
lock
);

2416 
txtid
->
aid
 = 0;

2417 
txtid
->
max_aggr_sz
 = 0;

2419 
	`aggr_tx_ª£t_aggr
(
txtid
, 
åue
,Årue);

2421 
txtid
->
num_pdu
 = 0;

2422 
txtid
->
num_amsdu
 = 0;

2423 
txtid
->
num_timeout
 = 0;

2424 
txtid
->
num_Êush
 = 0;

2425 
txtid
->
num_tx_nuŒ
 = 0;

2426 
txtid
->
num_ovîÊow
 = 0;

2428 
txtid
->
œ°_check_time
 = 0;

2429 
txtid
->
œ°_num_amsdu
 = 0;

2430 
txtid
->
œ°_num_timeout
 = 0;

2431 i‡(
aggr
->
tx_amsdu_¥ogªssive_hi•ìd
) {

2432 
aggr
->
tx_amsdu_¥ogªssive_hi•ìd
 = 
Ál£
;

2433 
	`aggr_tx_c⁄fig
(
aggr
->
vif
,

2434 
aggr
->
tx_amsdu_£q_pkt
,

2435 
åue
,

2436 
AGGR_TX_MAX_NUM
,

2437 
AGGR_TX_MAX_PDU_SIZE
,

2438 
AGGR_TX_TIMEOUT
);

2440 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

2442 
__func__
);

2445 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

2448 
	}
}

2450 
	$aggr_tx
(
©h6kl_vif
 *
vif
, 
©h6kl_°a
 *
°a
,

2451 
sk_buff
 **
skb
)

2453 
	#ETHERTYPE_IP
 0x0800

	)

2454 
	#IP_PROTO_TCP
 0x6

	)

2455 
ëhhdr
 *
ëh_hdr
;

2456 
©h6kl_Œc_¢≠_hdr
 *
Œc_hdr
;

2457 
aggr_öfo
 *
aggr
;

2458 
txtid
 *txtid;

2459 
pdu_Àn
, 
sub‰ame_Àn
;

2460 
hdr_Àn
 = (
wmi_d©a_hdr
);

2462 
pdu_Àn
 = (*
skb
)->
Àn
 - 
hdr_Àn
;

2463 
aggr
 = 
vif
->
aggr_˙txt
;

2472 i‡(
pdu_Àn
 > 
aggr
->
tx_amsdu_max_pdu_Àn
)

2473  
AGGR_TX_BYPASS
;

2475 
ëh_hdr
 = (
ëhhdr
 *)((*
skb
)->
d©a
 + 
hdr_Àn
);

2476 i‡(
	`is_mu…iˇ°_ëhî_addr
(
ëh_hdr
->
h_de°
))

2477  
AGGR_TX_BYPASS
;

2479 
Œc_hdr
 = (
©h6kl_Œc_¢≠_hdr
 *)((*
skb
)->
d©a
 + 
hdr_Àn
 +

2480 (
ëhhdr
));

2481 i‡(
Œc_hdr
->
ëh_ty≥
 =
	`ht⁄s
(
ETHERTYPE_IP
)) {

2482 
ùhdr
 *
ù_hdr
 = (ùhd∏*)((
u8
 *)
ëh_hdr
 +

2483 (
ëhhdr
) +

2484 (
©h6kl_Œc_¢≠_hdr
));

2486 i‡(
ù_hdr
->
¥Ÿocﬁ
 =
IP_PROTO_TCP
) {

2487 
©h6kl_°a
 *
c⁄n
;

2489 i‡(!
°a
)

2490 
c⁄n
 = 
	`©h6kl_föd_°a
(
vif
, 
ëh_hdr
->
h_de°
);

2495 
	`WARN_ON
(
vif
->
nw_ty≥
 !
AP_NETWORK
);

2497 
c⁄n
 = 
°a
;

2500 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_RAW_BYTES
, 
__func__
,

2501 "agg∏tx ", (*
skb
)->
d©a
, (*skb)->
Àn
);

2503 i‡(
c⁄n
) {

2504 
sk_buff
 *
amsdu_skb
;

2505 
wmi_d©a_hdr
 *
wmi_hdr
 =

2506 (
wmi_d©a_hdr
 *)((
u8
 *)
ëh_hdr
 -

2507 (
wmi_d©a_hdr
));

2508 
u16
 
öfo2_tmp
;

2511 i‡((
vif
->
nw_ty≥
 =
AP_NETWORK
) &&

2512 (
c⁄n
->
°a_Êags
 & (
STA_PS_SLEEP
 |

2513 
STA_PS_POLLED
 |

2514 
STA_PS_APSD_TRIGGER
))) {

2515 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

2517 
__func__
,

2518 
c⁄n
->
aid
,

2519 
c⁄n
->
°a_Êags
);

2520  
AGGR_TX_BYPASS
;

2523 
txtid
 = 
	`AGGR_GET_TXTID
(
c⁄n
->
aggr_c⁄n_˙txt
,

2524 ((
wmi_hdr
->
öfo
 >> 
WMI_DATA_HDR_UP_SHIFT
) &

2525 
WMI_DATA_HDR_UP_MASK
));

2527 
	`•ö_lock_bh
(&
txtid
->
lock
);

2528 i‡(!
txtid
->
max_aggr_sz
) {

2529 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

2530  
AGGR_TX_BYPASS
;

2533 
amsdu_skb
 = 
txtid
->amsdu_skb;

2534 i‡(
amsdu_skb
 =
NULL
) {

2535 
amsdu_skb
 =

2536 
	`dev_Æloc_skb
(
AGGR_TX_MAX_AGGR_SIZE
);

2537 i‡(
amsdu_skb
 =
NULL
) {

2538 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

2539  
AGGR_TX_BYPASS
;

2543 
öfo2_tmp
 = 
	`À16_to_˝u
(
wmi_hdr
->
öfo2
);

2544 
öfo2_tmp
 |(
WMI_DATA_HDR_AMSDU_MASK
 <<

2545 
WMI_DATA_HDR_AMSDU_SHIFT
);

2546 
wmi_hdr
->
öfo2
 = 
	`˝u_to_À16
(
öfo2_tmp
);

2549 
	`mem˝y
(
amsdu_skb
->
d©a
 - 
hdr_Àn
,

2550 (*
skb
)->
d©a
, 
hdr_Àn
);

2552 
	`aggr_tx_ª£t_aggr
(
txtid
, 
Ál£
, 
åue
);

2553 
txtid
->
amsdu_skb
 =ámsdu_skb;

2554 
txtid
->
amsdu_°¨t
 = 
amsdu_skb
->
d©a
;

2556 
amsdu_skb
->
d©a
 +=

2557 (
ëhhdr
);

2560 
	`mod_timî
(&
txtid
->
timî
, 
jiffõs
 +

2561 
	`m£cs_to_jiffõs
(

2562 
aggr
->
tx_amsdu_timeout
));

2564 i‡((
txtid
->
amsdu_Àn
 + 
pdu_Àn
) >

2565 
aggr
->
tx_amsdu_max_aggr_Àn
) {

2566 
txtid
->
num_ovîÊow
++;

2567 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

2569 
	`©h6kl_dbg
(

2570 
ATH6KL_DBG_WLAN_TX_AMSDU
,

2572 
__func__
,

2573 
pdu_Àn
,

2574 
txtid
->
amsdu_˙t
,

2575 
amsdu_skb
->
Àn
);

2577  
AGGR_TX_BYPASS
;

2582 
sub‰ame_Àn
 = 
	`roundup
(
pdu_Àn
, 4);

2583 
	`mem£t
(
amsdu_skb
->
d©a
 +

2584 
sub‰ame_Àn
 - 4, 0, 4);

2587 
	`mem˝y
(
amsdu_skb
->
d©a
, 
ëh_hdr
, 
pdu_Àn
);

2588 
amsdu_skb
->
Àn
 +
sub‰ame_Àn
;

2589 
amsdu_skb
->
d©a
 +
sub‰ame_Àn
;

2591 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

2593 
__func__
, 
sub‰ame_Àn
,

2594 ((
wmi_hdr
->
öfo
>>
WMI_DATA_HDR_UP_SHIFT
)

2595 & 
WMI_DATA_HDR_UP_MASK
),

2596 
txtid
->
amsdu_˙t
, 
amsdu_skb
->
Àn
);

2598 
txtid
->
amsdu_˙t
++;

2599 
txtid
->
amsdu_œ°pdu_Àn
 = 
pdu_Àn
;

2600 
txtid
->
amsdu_Àn
 +
sub‰ame_Àn
;

2602 
	`dev_k‰ì_skb
(*
skb
);

2603 *
skb
 = 
NULL
;

2605 i‡(
txtid
->
amsdu_˙t
 >=

2606 
aggr
->
tx_amsdu_max_aggr_num
) {

2608 i‡(
pdu_Àn
 & 0x3)

2609 
amsdu_skb
->
Àn
 -=

2610 (4 - (
pdu_Àn
 & 0x3));

2613 
ëh_hdr
 =

2614 (
ëhhdr
 *)
txtid
->
amsdu_°¨t
;

2616 i‡(
vif
->
nw_ty≥
 =
INFRA_NETWORK
) {

2617 
	`mem˝y
(
ëh_hdr
->
h_de°
,

2618 
vif
->
bssid
, 
ETH_ALEN
);

2619 
	`mem˝y
(
ëh_hdr
->
h_sour˚
,

2620 
vif
->
ndev
->
dev_addr
, 
ETH_ALEN
);

2622 
	`mem˝y
(
ëh_hdr
->
h_de°
,

2623 
c⁄n
->
mac
, 
ETH_ALEN
);

2624 
	`mem˝y
(
ëh_hdr
->
h_sour˚
,

2625 
vif
->
ndev
->
dev_addr
,

2626 
ETH_ALEN
);

2629 
ëh_hdr
->
h_¥Ÿo
 =

2630 
	`ht⁄s
(
amsdu_skb
->
Àn
);

2634 
amsdu_skb
->
Àn
 +=

2635 (
hdr_Àn
 + (
ëhhdr
));

2636 
amsdu_skb
->
d©a
 =

2637 
txtid
->
amsdu_°¨t
 - 
hdr_Àn
;

2639 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_RAW_BYTES
,

2640 
__func__
, "aggr-tx ",

2641 
amsdu_skb
->
d©a
,

2642 
amsdu_skb
->
Àn
);

2645 
txtid
->
num_amsdu
++;

2646 
txtid
->
num_pdu
 +txtid->
amsdu_˙t
;

2648 *
skb
 = 
amsdu_skb
;

2649 
	`aggr_tx_ª£t_aggr
(
txtid
, 
Ál£
, 
åue
);

2650 
	`aggr_tx_¥ogªssive
(
txtid
, 
Ál£
);

2651 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

2653  
AGGR_TX_DONE
;

2655 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

2656  
AGGR_TX_OK
;

2659  
AGGR_TX_DROP
;

2663  
AGGR_TX_BYPASS
;

2664 
	}
}

2666 
	$aggr_tx_tid
(
txtid
 *txtid, 
boﬁ
 
timî_°›
)

2668 
©h6kl_vif
 *
vif
 = 
txtid
->vif;

2669 
©h6kl
 *
¨
 = 
vif
->ar;

2670 
©h6kl_cookõ
 *
cookõ
;

2671 
htc_ídpoöt_id
 
eid
;

2672 
wmi_d©a_hdr
 *
wmi_hdr
;

2673 
sk_buff
 *
amsdu_skb
, *
skb
 = 
NULL
;

2674 
ëhhdr
 *
ëh_hdr
;

2675 
ac
;

2676 
hdr_Àn
 = (
wmi_d©a_hdr
);

2678 
	`•ö_lock_bh
(&
txtid
->
lock
);

2679 
amsdu_skb
 = 
txtid
->amsdu_skb;

2680 i‡(
amsdu_skb
 =
NULL
) {

2681 
txtid
->
num_tx_nuŒ
++;

2682 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

2683  -
EINVAL
;

2686 i‡(
timî_°›
)

2687 
txtid
->
num_Êush
++;

2689 
txtid
->
num_timeout
++;

2691 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

2693 
__func__
,

2694 
amsdu_skb
,ámsdu_skb->
d©a
,

2695 
amsdu_skb
->
Àn
, 
txtid
->
amsdu_˙t
);

2698 i‡(
txtid
->
amsdu_œ°pdu_Àn
 & 0x3)

2699 
amsdu_skb
->
Àn
 -(4 - (
txtid
->
amsdu_œ°pdu_Àn
 & 0x3));

2702 
ëh_hdr
 = (
ëhhdr
 *)
txtid
->
amsdu_°¨t
;

2703 i‡(
vif
->
nw_ty≥
 =
INFRA_NETWORK
) {

2704 
	`mem˝y
(
ëh_hdr
->
h_de°
, 
vif
->
bssid
, 
ETH_ALEN
);

2705 
	`mem˝y
(
ëh_hdr
->
h_sour˚
, 
vif
->
ndev
->
dev_addr
, 
ETH_ALEN
);

2707 
©h6kl_°a
 *
c⁄n
 = 
	`©h6kl_föd_°a_by_aid
(
vif
, 
txtid
->
aid
);

2709 i‡(
c⁄n
) {

2710 
	`mem˝y
(
ëh_hdr
->
h_de°
, 
c⁄n
->
mac
, 
ETH_ALEN
);

2711 
	`mem˝y
(
ëh_hdr
->
h_sour˚
, 
vif
->
ndev
->
dev_addr
, 
ETH_ALEN
);

2713 
	`aggr_tx_ª£t_aggr
(
txtid
, 
åue
, 
timî_°›
);

2714 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

2716 
	`©h6kl_îr
("aggr_tx_tidÉrror,Ço STA found, AID = %d\n",

2717 
txtid
->
aid
);

2718  -
EINVAL
;

2721 
ëh_hdr
->
h_¥Ÿo
 = 
	`ht⁄s
(
amsdu_skb
->
Àn
);

2724 
amsdu_skb
->
Àn
 +(
hdr_Àn
 + (
ëhhdr
));

2725 
amsdu_skb
->
d©a
 = 
txtid
->
amsdu_°¨t
 - 
hdr_Àn
;

2728 
txtid
->
num_amsdu
++;

2729 
txtid
->
num_pdu
 +txtid->
amsdu_˙t
;

2731 
skb
 = 
amsdu_skb
;

2732 
	`aggr_tx_ª£t_aggr
(
txtid
, 
Ál£
, 
timî_°›
);

2733 
	`aggr_tx_¥ogªssive
(
txtid
, !
timî_°›
);

2735 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

2737 
	`•ö_lock_bh
(&
¨
->
lock
);

2738 
wmi_hdr
 = (
wmi_d©a_hdr
 *)

2739 (
skb
->
d©a
 + 
hdr_Àn
 - (
wmi_d©a_hdr
));

2740 
ac
 = 
up_to_ac
[(
wmi_hdr
->
öfo
 >> 
WMI_DATA_HDR_UP_SHIFT
) &

2741 
WMI_DATA_HDR_UP_MASK
];

2742 
eid
 = 
¨
->
ac2ï_m≠
[
ac
];

2744 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

2745 "%s:Éid=%d,ác=%d\n", 
__func__
, 
eid
, 
ac
);

2747 i‡(
eid
 =0 ||Éid =
ENDPOINT_UNUSED
) {

2748 
	`©h6kl_îr
("eid %d i†nŸ m≠≥d!\n", 
eid
);

2749 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

2750 
Áû_tx
;

2754 
cookõ
 = 
	`©h6kl_Æloc_cookõ
(
¨
, 
COOKIE_TYPE_DATA
);

2756 i‡(!
cookõ
) {

2757 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

2758 
Áû_tx
;

2760 
vif
->
d©a_cookõ_cou¡
++;

2763 
¨
->
tx_≥ndög
[
eid
]++;

2764 
¨
->
tŸÆ_tx_d©a_≥nd
++;

2766 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

2768 
cookõ
->
skb
 = skb;

2769 
cookõ
->
m≠_no
 = 0;

2770 
	`£t_htc_pkt_öfo
(
cookõ
->
htc_pkt
, cookõ, 
skb
->
d©a
, skb->
Àn
,

2771 
eid
, 
ATH6KL_DATA_PKT_TAG
);

2772 
cookõ
->
htc_pkt
->
skb
 = skb;

2774 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_RAW_BYTES
, 
__func__
, "aggr-tx ",

2775 
skb
->
d©a
, skb->
Àn
);

2778 i‡(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_ENABLE_FLOWCTRL
) {

2779 
ªt
;

2781 
cookõ
->
htc_pkt
->
c⁄nid
 =

2782 
	`©h6kl_p2p_Êow˘æ_gë_c⁄n_id
(
vif
, 
skb
);

2783 
cookõ
->
htc_pkt
->
ªcy˛e_cou¡
 = 0;

2784 
ªt
 = 
	`©h6kl_p2p_Êow˘æ_tx_scheduÀ_pkt
(
¨
, (*)
cookõ
);

2785 i‡(
ªt
 == 0)

2787 i‡(
ªt
 < 0)

2788 
Áû_tx
;

2791 
cookõ
->
htc_pkt
->
vif
 = vif;

2793 
¨
->
tx_⁄_vif
 |(1 << 
vif
->
fw_vif_idx
);

2799 
	`©h6kl_htc_tx
(
¨
->
htc_èrgë
, 
cookõ
->
htc_pkt
);

2803 
Áû_tx
:

2804 
	`dev_k‰ì_skb
(
skb
);

2806 
vif
->
√t_°©s
.
tx_dr›≥d
++;

2807 
vif
->
√t_°©s
.
tx_ab‹ãd_îr‹s
++;

2809  -
EINVAL
;

2810 
	}
}

2812 
	$aggr_tx_timeout
(
¨g
)

2814 
txtid
 *txtid = (txtid *)
¨g
;

2816 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

2817 "%s:áid %d,Åid %d", 
__func__
, 
txtid
->
aid
,Åxtid->
tid
);

2819 
	`aggr_tx_tid
(
txtid
, 
Ál£
);

2822 
	}
}

2824 
	$aggr_tx_Êush
(
©h6kl_vif
 *
vif
, 
©h6kl_°a
 *
c⁄n
)

2826 
tid
;

2828 i‡(
c⁄n
 =
NULL
) {

2829 i‡(
vif
->
nw_ty≥
 =
INFRA_NETWORK
)

2830 
c⁄n
 = &
vif
->
°a_li°
[0];

2831 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
)

2834 
	`BUG_ON
(1);

2838 
tid
 = (
NUM_OF_TIDS
 - 1);Åid >= 0;Åid--) {

2839 
txtid
 *txtid =

2840 
	`AGGR_GET_TXTID
(
c⁄n
->
aggr_c⁄n_˙txt
, 
tid
);

2842 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

2843 "%s: flush sèáid %d\n", 
__func__
, 
c⁄n
->
aid
);

2844 
	`aggr_tx_tid
(
txtid
, 
åue
);

2847 
	}
}

2858 
	$aggr_timeout
(
¨g
)

2860 
u8
 
j
;

2861 
rxtid
 *rxtid = (rxtid *Ë
¨g
;

2862 
aggr_c⁄n_öfo
 *
aggr_c⁄n
 = 
rxtid
->aggr_conn;

2863 
rxtid_°©s
 *
°©s
;

2864 
u32
 
tid_√xt_timeout
 =

2865 
aggr_c⁄n
->
tid_timeout_£âög
[
rxtid
->
tid
];

2867 
°©s
 = 
	`AGGR_GET_RXTID_STATS
(
aggr_c⁄n
, 
rxtid
->
tid
);

2869 i‡(!
rxtid
->
aggr
 || !rxtid->
tid_timî_scheduÀd
)

2872 
	`•ö_lock_bh
(&
rxtid
->
lock
);

2874 i‡(
rxtid
->
timîwaô_£q_num
 =rxtid->
£q_√xt
) {

2875 
°©s
->
num_timeouts
++;

2876 
	`©h6kl_dbg
(
ATH6KL_DBG_AGGR
,

2878 
rxtid
->
£q_√xt
,

2879 ((
rxtid
->
£q_√xt
 +Ñxtid->
hﬁd_q_sz
-1) &

2880 
ATH6KL_MAX_SEQ_NO
), 
rxtid
->
tid
);

2881 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

2882 
	`aggr_deque_‰ms
(
aggr_c⁄n
, 
rxtid
->
tid
,

2883 ((
rxtid
->
timîwaô_£q_num
 + 1) &

2884 
ATH6KL_MAX_SEQ_NO
) , 0);

2886 
	`aggr_deque_‰ms
(
aggr_c⁄n
, 
rxtid
->
tid
, 0 , 1);

2887 i‡(
rxtid
->
£q_√xt
 ==

2888 ((
rxtid
->
timîwaô_£q_num
 + 1) &

2889 
ATH6KL_MAX_SEQ_NO
)) {

2891 i‡(
rxtid
->
c⁄töuous_cou¡
 >=

2892 
ATH6KL_MAX_WAIT_CONTINUOUS_PKT
) {

2893 
	`aggr_deque_‰ms
(
aggr_c⁄n
, 
rxtid
->
tid
,

2894 ((
rxtid
->
issue_timî_£q
 + 1) &

2895 
ATH6KL_MAX_SEQ_NO
) , 0);

2897 
	`aggr_deque_‰ms
(
aggr_c⁄n
, 
rxtid
->
tid
, 0 , 1);

2898 
rxtid
->
c⁄töuous_cou¡
 = 0;

2901 
rxtid
->
c⁄töuous_cou¡
 = 0;

2903 
	`•ö_lock_bh
(&
rxtid
->
lock
);

2905 
rxtid
->
tid_timî_scheduÀd
 = 
Ál£
;

2907 i‡(
rxtid
->
hﬁd_q
) {

2908 
j
 = 0; j < 
rxtid
->
hﬁd_q_sz
; j++) {

2909 i‡(
rxtid
->
hﬁd_q
[
j
].
skb
) {

2910 
rxtid
->
issue_timî_£q
 =

2911 
rxtid
->
hﬁd_q
[
j
].
£q_no
;

2912 
rxtid
->
timîwaô_£q_num
 =Ñxtid->
£q_√xt
;

2913 
rxtid
->
tid_timî_scheduÀd
 = 
åue
;

2914 
rxtid
->
c⁄töuous_cou¡
++;

2920 i‡(
rxtid
->
c⁄töuous_cou¡
 > 1) {

2921 i‡(
rxtid
->
c⁄töuous_cou¡
 <=

2922 
ATH6KL_MAX_WAIT_CONTINUOUS_PKT
) {

2923 
tid_√xt_timeout
 =Åid_next_timeout /

2924 ((
rxtid
->
c⁄töuous_cou¡
 - 1) * 2);

2925 
	`©h6kl_dbg
(
ATH6KL_DBG_AGGR
,

2927 
rxtid
->
c⁄töuous_cou¡
);

2929 
	`©h6kl_dbg
(
ATH6KL_DBG_AGGR
,

2931 
rxtid
->
c⁄töuous_cou¡
);

2932 
rxtid
->
c⁄töuous_cou¡
 = 0;

2936 i‡(
rxtid
->
tid_timî_scheduÀd
) {

2937 
	`mod_timî
(&
rxtid
->
tid_timî
,

2938 
jiffõs
 + 
	`m£cs_to_jiffõs
(
tid_√xt_timeout
));

2940 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

2941 
	}
}

2943 
	$aggr_dñëe_tid_°©e
(
aggr_c⁄n_öfo
 *
aggr_c⁄n
, 
u8
 
tid
)

2945 
rxtid
 *rxtid;

2946 
rxtid_°©s
 *
°©s
;

2948 i‡(!
aggr_c⁄n
 || 
tid
 >
NUM_OF_TIDS
)

2951 
rxtid
 = 
	`AGGR_GET_RXTID
(
aggr_c⁄n
, 
tid
);

2952 
°©s
 = 
	`AGGR_GET_RXTID_STATS
(
aggr_c⁄n
, 
tid
);

2954 i‡(
rxtid
->
aggr
)

2955 
	`aggr_deque_‰ms
(
aggr_c⁄n
, 
tid
, 0, 0);

2956 
	`•ö_lock_bh
(&
rxtid
->
lock
);

2957 
rxtid
->
aggr
 = 
Ál£
;

2958 
rxtid
->
wö_sz
 = 0;

2959 
rxtid
->
£q_√xt
 = 0;

2960 
rxtid
->
hﬁd_q_sz
 = 0;

2962 
	`k‰ì
(
rxtid
->
hﬁd_q
);

2963 
rxtid
->
hﬁd_q
 = 
NULL
;

2964 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

2965 
	`mem£t
(
°©s
, 0, (
rxtid_°©s
));

2966 
	}
}

2968 
	$aggr_ªcv_addba_ªq_evt
(
©h6kl_vif
 *
vif
, 
u8
 
tid
, 
u16
 
£q_no
,

2969 
u8
 
wö_sz
)

2971 
aggr_c⁄n_öfo
 *
aggr_c⁄n
;

2972 
rxtid
 *rxtid;

2973 
rxtid_°©s
 *
°©s
;

2974 
©h6kl_°a
 *
c⁄n
;

2975 
u16
 
hﬁd_q_size
;

2976 
u8
 
c⁄n_tid
, 
c⁄n_aid
;

2978 
c⁄n_tid
 = 
	`AGGR_BA_EVT_GET_TID
(
tid
);

2979 
c⁄n_aid
 = 
	`AGGR_BA_EVT_GET_CONNID
(
tid
);

2980 
c⁄n
 = 
	`©h6kl_föd_°a_by_aid
(
vif
, 
c⁄n_aid
);

2982 i‡(
c⁄n_tid
 >
NUM_OF_TIDS
) {

2983 
	`WARN_ON
(1);

2987 i‡(
c⁄n
 !
NULL
) {

2988 
	`WARN_ON
(!
c⁄n
->
aggr_c⁄n_˙txt
);

2990 
aggr_c⁄n
 = 
c⁄n
->
aggr_c⁄n_˙txt
;

2991 
rxtid
 = 
	`AGGR_GET_RXTID
(
aggr_c⁄n
, 
c⁄n_tid
);

2992 
°©s
 = 
	`AGGR_GET_RXTID_STATS
(
aggr_c⁄n
, 
c⁄n_tid
);

2994 i‡(
wö_sz
 < 
AGGR_WIN_SZ_MIN
 || wö_sz > 
AGGR_WIN_SZ_MAX
)

2995 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_RX
, "%s: win_sz %d,Åid %d,áid %d\n",

2996 
__func__
, 
wö_sz
, 
c⁄n_tid
, 
c⁄n_aid
);

2998 i‡(
rxtid
->
aggr
)

2999 
	`aggr_dñëe_tid_°©e
(
aggr_c⁄n
, 
c⁄n_tid
);

3000 
	`•ö_lock_bh
(&
rxtid
->
lock
);

3001 
rxtid
->
£q_√xt
 = 
£q_no
;

3002 
hﬁd_q_size
 = 
	`TID_WINDOW_SZ
(
wö_sz
Ë* (
skb_hﬁd_q
);

3003 
rxtid
->
hﬁd_q
 = 
	`kzÆloc
(
hﬁd_q_size
, 
GFP_ATOMIC
);

3005 i‡(!
rxtid
->
hﬁd_q
) {

3006 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

3010 
rxtid
->
wö_sz
 = win_sz;

3011 
rxtid
->
hﬁd_q_sz
 = 
	`TID_WINDOW_SZ
(
wö_sz
);

3012 i‡(!
	`skb_queue_em±y
(&
rxtid
->
q
)) {

3013 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

3017 
rxtid
->
aggr
 = 
åue
;

3018 
rxtid
->
sync_√xt_£q
 = 
åue
;

3019 
	`•ö_u∆ock_bh
(&
rxtid
->
lock
);

3021 
	}
}

3023 
	$aggr_ªcv_addba_ª•_evt
(
©h6kl_vif
 *
vif
, 
u8
 
tid
,

3024 
u16
 
amsdu_sz
, 
u8
 
°©us
)

3026 
aggr_c⁄n_öfo
 *
aggr_c⁄n
;

3027 
txtid
 *txtid;

3028 
©h6kl_°a
 *
c⁄n
;

3029 
u8
 
i
, 
c⁄n_tid
, 
c⁄n_aid
;

3031 
c⁄n_tid
 = 
	`AGGR_BA_EVT_GET_TID
(
tid
);

3032 
c⁄n_aid
 = 
	`AGGR_BA_EVT_GET_CONNID
(
tid
);

3033 
c⁄n
 = 
	`©h6kl_föd_°a_by_aid
(
vif
, 
c⁄n_aid
);

3035 i‡(
c⁄n_tid
 >
NUM_OF_TIDS
) {

3036 
	`WARN_ON
(1);

3040 i‡(
c⁄n
 !
NULL
) {

3041 
	`WARN_ON
(!
c⁄n
->
aggr_c⁄n_˙txt
);

3043 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "%s:ámsdu_sz %d,Åid %d,áid %d, status %d\n",

3044 
__func__
, 
amsdu_sz
, 
c⁄n_tid
, 
c⁄n_aid
, 
°©us
);

3046 
aggr_c⁄n
 = 
c⁄n
->
aggr_c⁄n_˙txt
;

3047 
txtid
 = 
	`AGGR_GET_TXTID
(
aggr_c⁄n
, 
c⁄n_tid
);

3049 
	`•ö_lock_bh
(&
txtid
->
lock
);

3050 
txtid
->
aid
 = 
c⁄n_aid
;

3051 i‡(
°©us
 == 0)

3052 
txtid
->
max_aggr_sz
 = 
amsdu_sz
;

3054 
txtid
->
max_aggr_sz
 = 0;

3057 i‡(!
txtid
->
max_aggr_sz
)

3058 
	`aggr_tx_ª£t_aggr
(
txtid
, 
åue
,Årue);

3059 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

3061 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
) {

3062 
vif
->
aggr_˙txt
->
tx_amsdu_íabÀ
 = 
Ál£
;

3063 
i
 = 0; i < 
NUM_OF_TIDS
; i++) {

3064 
txtid
 = 
	`AGGR_GET_TXTID
(
aggr_c⁄n
, 
i
);

3065 i‡(
txtid
->
max_aggr_sz
) {

3066 
vif
->
aggr_˙txt
->
tx_amsdu_íabÀ
 = 
åue
;

3072 
	}
}

3074 
	$aggr_tx_c⁄fig
(
©h6kl_vif
 *
vif
,

3075 
boﬁ
 
tx_amsdu_£q_pkt
,

3076 
boﬁ
 
tx_amsdu_¥ogªssive
,

3077 
u8
 
tx_amsdu_max_aggr_num
,

3078 
u16
 
tx_amsdu_max_pdu_Àn
,

3079 
u16
 
tx_amsdu_timeout
)

3081 i‡((
vif
) &&

3082 (
vif
->
aggr_˙txt
)) {

3083 
aggr_öfo
 *
aggr
 = 
vif
->
aggr_˙txt
;

3085 
aggr
->
tx_amsdu_£q_pkt
 =Åx_amsdu_seq_pkt;

3087 i‡(!
tx_amsdu_¥ogªssive
 &&

3088 
aggr
->
tx_amsdu_¥ogªssive
)

3089 
aggr
->
tx_amsdu_¥ogªssive_hi•ìd
 = 
Ál£
;

3090 i‡(
tx_amsdu_¥ogªssive
 &&

3091 !
aggr
->
tx_amsdu_¥ogªssive
) {

3094 
aggr
->
tx_amsdu_¥ogªssive
 =Åx_amsdu_progressive;

3096 i‡(
tx_amsdu_timeout
 == 0)

3097 
tx_amsdu_timeout
 = 
AGGR_TX_TIMEOUT
;

3098 
aggr
->
tx_amsdu_timeout
 =Åx_amsdu_timeout;

3100 i‡(
tx_amsdu_max_pdu_Àn
 == 0)

3101 
tx_amsdu_max_pdu_Àn
 = 
AGGR_TX_MAX_PDU_SIZE
;

3102 i‡(
tx_amsdu_max_pdu_Àn
 < 
AGGR_TX_MIN_PDU_SIZE
)

3103 
tx_amsdu_max_pdu_Àn
 = 
AGGR_TX_MIN_PDU_SIZE
;

3104 i‡(
tx_amsdu_max_pdu_Àn
 > (
aggr
->
tx_amsdu_max_aggr_Àn
 / 2))

3105 
tx_amsdu_max_pdu_Àn
 =

3106 (
aggr
->
tx_amsdu_max_aggr_Àn
 / 2);

3107 
aggr
->
tx_amsdu_max_pdu_Àn
 =Åx_amsdu_max_pdu_len;

3109 i‡(
tx_amsdu_max_aggr_num
 == 0)

3110 
tx_amsdu_max_aggr_num
 = 
AGGR_TX_MAX_NUM
;

3111 i‡(
tx_amsdu_max_aggr_num
 < 2)

3112 
tx_amsdu_max_aggr_num
 = 2;

3113 
aggr
->
tx_amsdu_max_aggr_num
 =Åx_amsdu_max_aggr_num;

3115 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
,

3117 
__func__
,

3118 
vif
->
fw_vif_idx
,

3119 
aggr
->
tx_amsdu_max_pdu_Àn
,

3120 
aggr
->
tx_amsdu_max_aggr_num
,

3121 
aggr
->
tx_amsdu_timeout
,

3122 
aggr
->
tx_amsdu_£q_pkt
,

3123 
aggr
->
tx_amsdu_¥ogªssive
);

3127 
	}
}

3129 
	$aggr_c⁄fig
(
©h6kl_vif
 *
vif
,

3130 
u16
 
rx_aggr_timeout
)

3132 i‡((
vif
) &&

3133 (
vif
->
aggr_˙txt
)) {

3134 
aggr_öfo
 *
aggr
 = 
vif
->
aggr_˙txt
;

3136 i‡(
rx_aggr_timeout
 == 0)

3137 
rx_aggr_timeout
 = 
AGGR_RX_TIMEOUT
;

3138 
aggr
->
rx_aggr_timeout
 =Ñx_aggr_timeout;

3142 
	}
}

3144 
aggr_öfo
 *
	$aggr_öô
(
©h6kl_vif
 *
vif
)

3146 
aggr_öfo
 *
aggr
 = 
NULL
;

3148 
aggr
 = 
	`kzÆloc
((
aggr_öfo
), 
GFP_KERNEL
);

3149 i‡(!
aggr
) {

3150 
	`©h6kl_îr
("failedÅoálloc memory forággr_module\n");

3151  
NULL
;

3154 
aggr
->
vif
 = vif;

3156 
	`skb_queue_hód_öô
(&
aggr
->
‰ì_q
);

3157 
	`©h6kl_Æloc_√tbufs
(&
aggr
->
‰ì_q
, 
AGGR_NUM_OF_FREE_NETBUFS
);

3158 
aggr
->
rx_aggr_timeout
 = 
AGGR_RX_TIMEOUT
;

3160 
aggr
->
tx_amsdu_íabÀ
 = 
åue
;

3161 
aggr
->
tx_amsdu_£q_pkt
 = 
åue
;

3162 
aggr
->
tx_amsdu_¥ogªssive
 = 
åue
;

3163 
aggr
->
tx_amsdu_max_aggr_num
 = 
AGGR_TX_MAX_NUM
;

3164 
aggr
->
tx_amsdu_max_aggr_Àn
 = 
AGGR_TX_MAX_AGGR_SIZE
 - 100;

3165 
aggr
->
tx_amsdu_max_pdu_Àn
 = 
AGGR_TX_MAX_PDU_SIZE
;

3166 
aggr
->
tx_amsdu_timeout
 = 
AGGR_TX_TIMEOUT
;

3169 
	`£t_bô
(
AMSDU_ENABLED
, &
vif
->
Êags
);

3171  
aggr
;

3172 
	}
}

3174 
aggr_c⁄n_öfo
 *
	$aggr_öô_c⁄n
(
©h6kl_vif
 *
vif
)

3176 
aggr_c⁄n_öfo
 *
aggr_c⁄n
 = 
NULL
;

3177 
rxtid
 *rxtid;

3178 
txtid
 *txtid;

3179 
u8
 
i
;

3181 
aggr_c⁄n
 = 
	`kzÆloc
((
aggr_c⁄n_öfo
), 
GFP_KERNEL
);

3182 i‡(!
aggr_c⁄n
) {

3183 
	`©h6kl_îr
("failedÅoálloc memory forággr_node\n");

3184  
NULL
;

3187 
aggr_c⁄n
->
aggr_sz
 = 
AGGR_SZ_DEFAULT
;

3188 
aggr_c⁄n
->
aggr_˙txt
 = 
vif
->aggr_cntxt;

3189 
aggr_c⁄n
->
dev
 = 
vif
->
ndev
;

3191 
i
 = 0; i < 
NUM_OF_TIDS
; i++) {

3192 
rxtid
 = 
	`AGGR_GET_RXTID
(
aggr_c⁄n
, 
i
);

3193 
rxtid
->
aggr
 = 
Ál£
;

3194 
	`skb_queue_hód_öô
(&
rxtid
->
q
);

3195 
	`•ö_lock_öô
(&
rxtid
->
lock
);

3196 
rxtid
->
aggr_c⁄n
 =ággr_conn;

3197 
rxtid
->
tid
 = 
i
;

3198 
	`öô_timî
(&
rxtid
->
tid_timî
);

3199 
rxtid
->
tid_timî
.
fun˘i⁄
 = 
aggr_timeout
;

3200 
rxtid
->
tid_timî
.
d©a
 = ()Ñxtid;

3201 
rxtid
->
tid_timî_scheduÀd
 = 
Ál£
;

3203 
up_to_ac
[
i
]) {

3204 
WMM_AC_BK
:

3205 
aggr_c⁄n
->
tid_timeout_£âög
[
i
] = 
AGGR_RX_TIMEOUT
;

3207 
WMM_AC_BE
:

3208 
aggr_c⁄n
->
tid_timeout_£âög
[
i
] = 
AGGR_RX_TIMEOUT
;

3210 
WMM_AC_VI
:

3211 
aggr_c⁄n
->
tid_timeout_£âög
[
i
] = 
AGGR_RX_TIMEOUT
;

3213 
WMM_AC_VO
:

3214 
aggr_c⁄n
->
tid_timeout_£âög
[
i
] = 
AGGR_RX_TIMEOUT_VO
;

3219 
txtid
 = 
	`AGGR_GET_TXTID
(
aggr_c⁄n
, 
i
);

3220 
txtid
->
tid
 = 
i
;

3221 
txtid
->
vif
 = vif;

3222 
	`öô_timî
(&
txtid
->
timî
);

3223 
txtid
->
timî
.
fun˘i⁄
 = 
aggr_tx_timeout
;

3224 
txtid
->
timî
.
d©a
 = ()txtid;

3225 
	`•ö_lock_öô
(&
txtid
->
lock
);

3229  
aggr_c⁄n
;

3230 
	}
}

3232 
	$aggr_ªcv_dñba_ªq_evt
(
©h6kl_vif
 *
vif
, 
u8
 
tid
, u8 
öôüt‹
)

3234 
aggr_c⁄n_öfo
 *
aggr_c⁄n
;

3235 
rxtid
 *rxtid;

3236 
txtid
 *txtid;

3237 
©h6kl_°a
 *
c⁄n
;

3238 
u8
 
c⁄n_tid
, 
c⁄n_aid
;

3240 
c⁄n_tid
 = 
	`AGGR_BA_EVT_GET_TID
(
tid
);

3241 
c⁄n_aid
 = 
	`AGGR_BA_EVT_GET_CONNID
(
tid
);

3242 
c⁄n
 = 
	`©h6kl_föd_°a_by_aid
(
vif
, 
c⁄n_aid
);

3244 i‡(
c⁄n
 !
NULL
) {

3245 
	`WARN_ON
(!
c⁄n
->
aggr_c⁄n_˙txt
);

3247 
aggr_c⁄n
 = 
c⁄n
->
aggr_c⁄n_˙txt
;

3248 i‡(
öôüt‹
 == 1) {

3250 
txtid
 = 
	`AGGR_GET_TXTID
(
aggr_c⁄n
, 
c⁄n_tid
);

3251 i‡(
txtid
)

3252 
	`aggr_tx_dñëe_tid_°©e
(
aggr_c⁄n
, 
c⁄n_tid
);

3254 
rxtid
 = 
	`AGGR_GET_RXTID
(
aggr_c⁄n
, 
c⁄n_tid
);

3255 i‡(
rxtid
->
aggr
)

3256 
	`aggr_dñëe_tid_°©e
(
aggr_c⁄n
, 
c⁄n_tid
);

3259 
	}
}

3261 
	$aggr_ª£t_°©e
(
aggr_c⁄n_öfo
 *
aggr_c⁄n
)

3263 
©h6kl_vif
 *
vif
 = 
aggr_c⁄n
->
aggr_˙txt
->vif;

3264 
u8
 
tid
;

3266 
tid
 = 0;Åid < 
NUM_OF_TIDS
;Åid++) {

3267 
	`aggr_dñëe_tid_°©e
(
aggr_c⁄n
, 
tid
);

3268 
	`aggr_tx_dñëe_tid_°©e
(
aggr_c⁄n
, 
tid
);

3271 i‡(
vif
->
nw_ty≥
 !
AP_NETWORK
)

3272 
aggr_c⁄n
->
aggr_˙txt
->
tx_amsdu_íabÀ
 = 
Ál£
;

3274 
	`©h6kl_dbg
(
ATH6KL_DBG_WLAN_TX_AMSDU
, "%s:Åx_amsdu_enable %d\n",

3275 
__func__
, 
aggr_c⁄n
->
aggr_˙txt
->
tx_amsdu_íabÀ
);

3278 
	}
}

3281 
	$©h6kl_˛ónup_amsdu_rxbufs
(
©h6kl
 *
¨
)

3283 
htc_∑ckë
 *
∑ckë
, *
tmp_pkt
;

3285 
	`•ö_lock_bh
(&
¨
->
lock
);

3286 i‡(
	`li°_em±y
(&
¨
->
amsdu_rx_buf„r_queue
)) {

3287 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

3291 
	`li°_f‹_óch_íåy_ß„
(
∑ckë
, 
tmp_pkt
, &
¨
->
amsdu_rx_buf„r_queue
,

3292 
li°
) {

3293 
	`li°_dñ
(&
∑ckë
->
li°
);

3294 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

3295 
	`dev_k‰ì_skb
(
∑ckë
->
pkt_˙txt
);

3296 
	`•ö_lock_bh
(&
¨
->
lock
);

3299 
	`•ö_u∆ock_bh
(&
¨
->
lock
);

3300 
	}
}

3302 
	$aggr_moduÀ_de°roy
(
aggr_öfo
 *
aggr
)

3304 i‡(!
aggr
)

3307 
	`skb_queue_purge
(&
aggr
->
‰ì_q
);

3308 
	`k‰ì
(
aggr
);

3309 
	}
}

3311 
	$aggr_moduÀ_de°roy_c⁄n
(
aggr_c⁄n_öfo
 *
aggr_c⁄n
)

3313 
rxtid
 *rxtid;

3314 
txtid
 *txtid;

3315 
u8
 
i
, 
k
;

3317 i‡(!
aggr_c⁄n
)

3320 
i
 = 0; i < 
NUM_OF_TIDS
; i++) {

3321 
rxtid
 = 
	`AGGR_GET_RXTID
(
aggr_c⁄n
, 
i
);

3323 i‡(
rxtid
->
tid_timî_scheduÀd
) {

3324 
	`dñ_timî
(&
rxtid
->
tid_timî
);

3325 
rxtid
->
tid_timî_scheduÀd
 = 
Ál£
;

3326 
rxtid
->
c⁄töuous_cou¡
 = 0;

3329 i‡(
rxtid
->
hﬁd_q
) {

3330 
k
 = 0; k < 
rxtid
->
hﬁd_q_sz
; k++)

3331 
	`dev_k‰ì_skb
(
rxtid
->
hﬁd_q
[
k
].
skb
);

3332 
	`k‰ì
(
rxtid
->
hﬁd_q
);

3334 
	`skb_queue_purge
(&
rxtid
->
q
);

3337 
txtid
 = 
	`AGGR_GET_TXTID
(
aggr_c⁄n
, 
i
);

3338 
	`•ö_lock_bh
(&
txtid
->
lock
);

3339 
	`aggr_tx_ª£t_aggr
(
txtid
, 
åue
,Årue);

3340 
	`•ö_u∆ock_bh
(&
txtid
->
lock
);

3343 
	`k‰ì
(
aggr_c⁄n
);

3344 
	}
}

3346 
	$©h6kl_ödiˇã_wmm_scheduÀ_ch™ge
(*
devt
, 
boﬁ
 
ch™ge
)

3348 
©h6kl
 *
¨
 = 
devt
;

3349 
ch™ge_f‹_°ªam_¥i
 = 0;

3351 
ch™ge_f‹_°ªam_¥i
 =

3352 
	`©h6kl_htc_wmm_scheduÀ_ch™ge
(
¨
->
htc_èrgë
, 
ch™ge
);

3354 i‡(
ch™ge_f‹_°ªam_¥i
 != 0) {

3355 i‡(
ch™ge
 =
åue
) {

3357 
¨
->
ac_°ªam_¥i_m≠
[
WMM_AC_BE
] = 2;

3358 
¨
->
ac_°ªam_¥i_m≠
[
WMM_AC_VI
] = 1;

3360 
¨
->
ac_°ªam_¥i_m≠
[
WMM_AC_BE
] = 1;

3361 
¨
->
ac_°ªam_¥i_m≠
[
WMM_AC_VI
] = 2;

3364 
	}
}

3366 
	$©h6kl_Êush_≥nd_skb
(
©h6kl_vif
 *
vif
)

3369 
	`•ö_lock_bh
(&
vif
->
≥nd_skb_lock
);

3371 i‡(!
vif
->
≥nd_skb
) {

3372 
	`•ö_u∆ock_bh
(&
vif
->
≥nd_skb_lock
);

3376 i‡(!(
vif
->
≥nd_skb
->
dev
->
Êags
 & 
IFF_UP
))

3377 
	`dev_k‰ì_skb_™y
(
vif
->
≥nd_skb
);

3379 
	`√tif_rx_ni
(
vif
->
≥nd_skb
);

3381 
vif
->
≥nd_skb
 = 
NULL
;

3382 
	`˛ór_bô
(
FIRST_EAPOL_PENDSENT
, &
vif
->
Êags
);

3384 
	`•ö_u∆ock_bh
(&
vif
->
≥nd_skb_lock
);

3385 
	}
}

3387 
	$©h6kl_ópﬁ_h™dshake_¥Ÿe˘
(
©h6kl_vif
 *
vif
, 
boﬁ
 
tx
)

3389 
©h6kl
 *
¨
 = 
vif
->ar;

3390 
©h6kl_vif
 *
tmp
;

3391 
i
;

3401 
	`£t_bô
(
EAPOL_HANDSHAKE_PROTECT
, &
¨
->
Êag
);

3402 
¨
->
ópﬁ_sh¥Ÿe˘_vif
 |(1 << 
vif
->
fw_vif_idx
);

3404 
	`mod_timî
(&
¨
->
ópﬁ_sh¥Ÿe˘_timî
,

3405 
jiffõs
 + 
ATH6KL_SCAN_PREEMPT_IN_HANDSHAKE
);

3407 
i
 = 0; i < 
¨
->
vif_max
; i++) {

3408 
tmp
 = 
	`©h6kl_gë_vif_by_ödex
(
¨
, 
i
);

3409 i‡(
tmp
 &&Åmp->
sˇn_ªq
) {

3410 
	`©h6kl_öfo
("%s EAPOL on-going, vif %d\n",

3411 (
tx
 ? "TX" : "RX"),

3412 
tmp
->
fw_vif_idx
);

3414 
	`dñ_timî
(&
tmp
->
vifsˇn_timî
);

3415 
	`©h6kl_wmi_ab‹t_sˇn_cmd
(
¨
->
wmi
,

3416 
tmp
->
fw_vif_idx
);

3417 
	`cfg80211_sˇn_d⁄e
(
tmp
->
sˇn_ªq
, 
åue
);

3418 
tmp
->
sˇn_ªq
 = 
NULL
;

3419 
	`˛ór_bô
(
SCANNING
, &
tmp
->
Êags
);

3424 
	}
}

	@usb.c

16 
	~<löux/ªboŸ.h
>

17 
	~<löux/moduÀ.h
>

18 
	~<löux/usb.h
>

20 
	~"debug.h
"

21 
	~"c‹e.h
"

22 
	~"cfg80211.h
"

24 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


25 
	~<asm/u«lig√d.h
>

29 
	#TX_URB_COUNT
 10

	)

30 
	#TX_URB_COUNT_LARGE
 40

	)

31 
	#RX_URB_COUNT
 32

	)

33 
	#ATH6KL_USB_RX_BUFFER_SIZE
 2048

	)

34 
	#ATH6KL_USB_RX_BUNDLE_BUFFER_SIZE
 16896

	)

35 
	#ATH6KL_USB_TX_BUNDLE_BUFFER_SIZE
 16384

	)

36 
	#WORKER_LOCK_BIT
 0

	)

38 
	#ATH6KL_MAX_AMSDU_SIZE
 7935

	)

41 
	eATH6KL_USB_PIPE_ID
 {

42 
	mATH6KL_USB_PIPE_TX_CTRL
 = 0,

43 
	mATH6KL_USB_PIPE_TX_DATA_LP
,

44 
	mATH6KL_USB_PIPE_TX_DATA_MP
,

45 
	mATH6KL_USB_PIPE_TX_DATA_HP
,

46 
	mATH6KL_USB_PIPE_TX_DATA_VHP
,

47 
	mATH6KL_USB_PIPE_RX_CTRL
,

48 
	mATH6KL_USB_PIPE_RX_DATA
,

49 
	mATH6KL_USB_PIPE_RX_DATA2
,

50 
	mATH6KL_USB_PIPE_RX_INT
,

51 
	mATH6KL_USB_PIPE_MAX


54 
	#ATH6KL_USB_PIPE_INVALID
 
ATH6KL_USB_PIPE_MAX


	)

56 
	s©h6kl_usb_pùe_°©
 {

57 
u32
 
	mnum_rx_comp
;

58 
u32
 
	mnum_tx_comp
;

59 
u32
 
	mnum_io_comp
;

61 
u32
 
	mnum_max_tx
;

62 
u32
 
	mnum_max_rx
;

64 
u32
 
	mnum_tx_ªsche
;

65 
u32
 
	mnum_rx_ªsche
;

67 
u32
 
	mnum_tx_sync
;

68 
u32
 
	mnum_tx
;

69 
u32
 
	mnum_tx_îr
;

70 
u32
 
	mnum_tx_îr_Ÿhîs
;

72 
u32
 
	mnum_tx_comp_îr
;

73 
u32
 
	mnum_rx_comp_îr
;

75 
u32
 
	mnum_rx_bundÀ_comp
;

76 
u32
 
	mnum_tx_bundÀ_comp
;

78 
u32
 
	mnum_tx_mu…i
;

79 
u32
 
	mnum_tx_mu…i_îr
;

80 
u32
 
	mnum_tx_mu…i_îr_Ÿhîs
;

82 
u32
 
	mnum_rx_bundÀ_comp_îr
;

83 
u32
 
	mnum_tx_bundÀ_comp_îr
;

86 
	s©h6kl_usb_pùe
 {

87 
li°_hód
 
	murb_li°_hód
;

88 
usb_™ch‹
 
	murb_submôãd
;

89 
u32
 
	murb_Æloc
;

90 
u32
 
	murb_˙t
;

91 
u32
 
	murb_˙t_thªsh
;

92 
	musb_pùe_h™dÀ
;

93 
u32
 
	mÊags
;

94 
u8
 
	mï_addªss
;

95 
u8
 
	mlogiˇl_pùe_num
;

96 
©h6kl_usb
 *
	m¨_usb
;

97 
u16
 
	mmax_∑ckë_size
;

98 
w‹k_°ru˘
 
	mio_com∂ëe_w‹k
;

99 
sk_buff_hód
 
	mio_comp_queue
;

100 
usb_ídpoöt_des¸ùt‹
 *
	mï_desc
;

101 
©h6kl_usb_pùe_°©
 
	musb_pùe_°©
;

102 
	mw‹kî_lock
;

105 
	#ATH6KL_USB_PIPE_FLAG_TX
 (1 << 0)

	)

106 
	#ATH6KL_USB_PIPE_FLAG_RX
 (1 << 1)

	)

109 
	s©h6kl_usb
 {

110 
•ölock_t
 
	mcs_lock
;

111 
•ölock_t
 
	mtx_lock
;

112 
•ölock_t
 
	mrx_lock
;

113 
©h6kl_hif_pùe_ˇŒbacks
 
	mhtc_ˇŒbacks
;

114 
usb_devi˚
 *
	mudev
;

115 
usb_öãrÁ˚
 *
	möãrÁ˚
;

116 
©h6kl_usb_pùe
 
	mpùes
[
ATH6KL_USB_PIPE_MAX
];

117 
u8
 *
	mdüg_cmd_buf„r
;

118 
u8
 *
	mdüg_ª•_buf„r
;

119 
©h6kl
 *
	m¨
;

120 
nŸifõr_block
 
	mªboŸ_nŸifõr
;

121 
u32
 
	mmax_sche_tx
;

122 
u32
 
	mmax_sche_rx
;

123 
u32
 
	mrxq_thªshﬁd
;

127 
	s©h6kl_urb_c⁄ãxt
 {

128 
li°_hód
 
	mlök
;

129 
©h6kl_usb_pùe
 *
	mpùe
;

130 
sk_buff
 *
	mbuf
;

131 
©h6kl
 *
	m¨
;

132 
sk_buff_hód
 
	mcomp_queue
;

136 
	#ATH6KL_USB_EP_ADDR_APP_CTRL_IN
 0x81

	)

137 
	#ATH6KL_USB_EP_ADDR_APP_DATA_IN
 0x82

	)

138 
	#ATH6KL_USB_EP_ADDR_APP_DATA2_IN
 0x83

	)

139 
	#ATH6KL_USB_EP_ADDR_APP_INT_IN
 0x84

	)

141 
	#ATH6KL_USB_EP_ADDR_APP_CTRL_OUT
 0x01

	)

142 
	#ATH6KL_USB_EP_ADDR_APP_DATA_LP_OUT
 0x02

	)

143 
	#ATH6KL_USB_EP_ADDR_APP_DATA_MP_OUT
 0x03

	)

144 
	#ATH6KL_USB_EP_ADDR_APP_DATA_HP_OUT
 0x04

	)

145 
	#ATH6KL_USB_EP_ADDR_APP_DATA_VHP_OUT
 0x05

	)

148 
	#ATH6KL_USB_CONTROL_REQ_SEND_BMI_CMD
 1

	)

149 
	#ATH6KL_USB_CONTROL_REQ_RECV_BMI_RESP
 2

	)

150 
	#ATH6KL_USB_CONTROL_REQ_DIAG_CMD
 3

	)

151 
	#ATH6KL_USB_CONTROL_REQ_DIAG_RESP
 4

	)

153 
	#ATH6KL_USB_CTRL_DIAG_CC_READ
 0

	)

154 
	#ATH6KL_USB_CTRL_DIAG_CC_WRITE
 1

	)

155 
	#ATH6KL_USB_CTRL_DIAG_CC_WARM_RESET
 2

	)

157 
	#HIF_USB_RX_QUEUE_THRESHOLD
 64

	)

160 
	#HIF_USB_MAX_SCHE_PKT
 (64)

	)

162 
	s©h6kl_usb_˘æ_düg_cmd_wrôe
 {

163 
__À32
 
	mcmd
;

164 
__À32
 
	maddªss
;

165 
__À32
 
	mvÆue
;

166 
__À32
 
	m_∑d
[1];

167 } 
	g__∑cked
;

169 
	s©h6kl_usb_˘æ_düg_cmd_ªad
 {

170 
__À32
 
	mcmd
;

171 
__À32
 
	maddªss
;

172 } 
	g__∑cked
;

174 
	s©h6kl_usb_˘æ_düg_ª•_ªad
 {

175 
__À32
 
	mvÆue
;

176 } 
	g__∑cked
;

178 
	#USB_CTRL_MAX_DIAG_CMD_SIZE
 \

179 ((
©h6kl_usb_˘æ_düg_cmd_wrôe
))

	)

180 
	#USB_CTRL_MAX_DIAG_RESP_SIZE
 \

181 ((
©h6kl_usb_˘æ_düg_ª•_ªad
))

	)

183 #ifde‡
ATH6KL_BUS_VOTE


184 
u8
 
	g©h6kl_∂©f‹m_has_vªg
;

185 
£m≠h‹e
 
	gusb_¥obe_£m
;

187 
	#USB_PROBE_WAIT_TIMEOUT
 2000

	)

190 #ifde‡
ATH6KL_HSIC_RECOVER


191 
w‹k_°ru˘
 
	gªcovî_w¨_w‹k
;

194 #ifde‡
ATHTST_SUPPORT


195 
	shif_¥odu˘_öfo_t
 {

196 
uöt16_t
 
	midVíd‹
;

197 
uöt16_t
 
	midProdu˘
;

198 
uöt8_t
 
	m¥odu˘
[64];

199 
uöt8_t
 
	mm™uÁ˘uªr
[64];

200 
uöt8_t
 
	m£rül
[64];

204 #ifde‡
CONFIG_PM


206 
©h6kl_usb_pm_su•íd
(
usb_öãrÁ˚
 *
öãrÁ˚
,

207 
pm_mesßge_t
 
mesßge
);

208 
©h6kl_usb_pm_ªsume
(
usb_öãrÁ˚
 *
öãrÁ˚
);

209 
©h6kl_usb_pm_ª£t_ªsume
(
usb_öãrÁ˚
 *
ötf
);

213 
	#©h6kl_usb_pm_su•íd
 
NULL


	)

214 
	#©h6kl_usb_pm_ªsume
 
NULL


	)

215 
	#©h6kl_usb_pm_ª£t_ªsume
 
NULL


	)

219 #ifde‡
CONFIG_ANDROID


221 
	#ATH6KL_USB_UNLOAD_TIMEOUT
 (2*
HZ
)

	)

222 
	e©h6kl_usb_drv_u∆ﬂd_°©e
 {

223 
	mATH6KL_USB_UNLOAD_STATE_NULL
 = 0,

224 
	mATH6KL_USB_UNLOAD_STATE_DRV_DEREG
,

225 
	mATH6KL_USB_UNLOAD_STATE_TARGET_RESET
,

226 
	mATH6KL_USB_UNLOAD_STATE_DEV_DISCONNECTED
,

229 
	g©h6kl_usb_u∆ﬂd_dev_num
 = -1;

230 
waô_queue_hód_t
 
	g©h6kl_usb_u∆ﬂd_evít_wq
;

231 
©omic_t
 
	g©h6kl_usb_u∆ﬂd_°©e
;

234 
©h6kl_usb_ªcv_com∂ëe
(
urb
 *urb);

235 
©h6kl_usb_ªcv_bundÀ_com∂ëe
(
urb
 *urb);

237 #ifde‡
USB_AUTO_SUSPEND


238 
usb_auto_pm_tu∫off
(
©h6kl
 *
¨
);

241 
	#ATH6KL_USB_IS_BULK_EP
(
©å
Ë((◊ârË& 3Ë=0x02)

	)

242 
	#ATH6KL_USB_IS_INT_EP
(
©å
Ë((◊ârË& 3Ë=0x03)

	)

243 
	#ATH6KL_USB_IS_ISOC_EP
(
©å
Ë((◊ârË& 3Ë=0x01)

	)

244 
	#ATH6KL_USB_IS_DIR_IN
(
addr
Ë(◊ddrË& 0x80)

	)

247 
©h6kl_urb_c⁄ãxt
 *
	$©h6kl_usb_Æloc_urb_‰om_pùe
(

248 
©h6kl_usb_pùe
 *
pùe
)

250 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
 = 
NULL
;

251 
Êags
;

253 
	`•ö_lock_úqßve
(&
pùe
->
¨_usb
->
cs_lock
, 
Êags
);

254 i‡(!
	`li°_em±y
(&
pùe
->
urb_li°_hód
)) {

255 
urb_c⁄ãxt
 =

256 
	`li°_fú°_íåy
(&
pùe
->
urb_li°_hód
,

257 
©h6kl_urb_c⁄ãxt
, 
lök
);

258 
	`li°_dñ
(&
urb_c⁄ãxt
->
lök
);

259 
pùe
->
urb_˙t
--;

261 
	`•ö_u∆ock_úqª°‹e
(&
pùe
->
¨_usb
->
cs_lock
, 
Êags
);

263  
urb_c⁄ãxt
;

264 
	}
}

266 
	$©h6kl_usb_‰ì_urb_to_pùe
(
©h6kl_usb_pùe
 *
pùe
,

267 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
)

269 
Êags
;

271 
	`•ö_lock_úqßve
(&
pùe
->
¨_usb
->
cs_lock
, 
Êags
);

272 
pùe
->
urb_˙t
++;

274 
	`li°_add
(&
urb_c⁄ãxt
->
lök
, &
pùe
->
urb_li°_hód
);

275 
	`•ö_u∆ock_úqª°‹e
(&
pùe
->
¨_usb
->
cs_lock
, 
Êags
);

276 
	}
}

278 
	$©h6kl_usb_˛ónup_ªcv_urb
(
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
)

280 i‡(
urb_c⁄ãxt
->
buf
 !
NULL
) {

281 
	`dev_k‰ì_skb
(
urb_c⁄ãxt
->
buf
);

282 
urb_c⁄ãxt
->
buf
 = 
NULL
;

285 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
, urb_context);

286 
	}
}

288 
ölöe
 
©h6kl_usb
 *
	$©h6kl_usb_¥iv
(
©h6kl
 *
¨
)

290  
¨
->
hif_¥iv
;

291 
	}
}

294 
	$©h6kl_usb_Æloc_pùe_ªsour˚s
(
©h6kl_usb_pùe
 *
pùe
,

295 
urb_˙t
)

297 
°©us
 = 0;

298 
i
;

299 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
;

301 
	`INIT_LIST_HEAD
(&
pùe
->
urb_li°_hód
);

302 
	`öô_usb_™ch‹
(&
pùe
->
urb_submôãd
);

304 
i
 = 0; i < 
urb_˙t
; i++) {

305 
urb_c⁄ãxt
 = (
©h6kl_urb_c⁄ãxt
 *)

306 
	`kzÆloc
((
©h6kl_urb_c⁄ãxt
), 
GFP_KERNEL
);

307 i‡(
urb_c⁄ãxt
 =
NULL
) {

308 
°©us
 = -
ENOMEM
;

309 
Áû_Æloc_pùe_ªsour˚s
;

312 
	`mem£t
(
urb_c⁄ãxt
, 0, (
©h6kl_urb_c⁄ãxt
));

313 
urb_c⁄ãxt
->
pùe
 =Öipe;

319 
pùe
->
urb_Æloc
++;

321 i‡(
htc_bundÀ_£nd
) {

325 i‡(
pùe
->
logiˇl_pùe_num
 >
ATH6KL_USB_PIPE_TX_DATA_LP
 &&

326 
pùe
->
logiˇl_pùe_num
 <
ATH6KL_USB_PIPE_TX_DATA_VHP
) {

327 
urb_c⁄ãxt
->
buf
 =

328 
	`dev_Æloc_skb
(
ATH6KL_USB_TX_BUNDLE_BUFFER_SIZE
);

329 i‡(
NULL
 =
urb_c⁄ãxt
->
buf
)

330 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
,

333 
ATH6KL_USB_TX_BUNDLE_BUFFER_SIZE
);

335 
	`skb_queue_hód_öô
(&
urb_c⁄ãxt
->
comp_queue
);

338 
	`©h6kl_usb_‰ì_urb_to_pùe
(
pùe
, 
urb_c⁄ãxt
);

340 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
,

343 
pùe
->
logiˇl_pùe_num
,Öùe->
usb_pùe_h™dÀ
,

344 
pùe
->
urb_Æloc
);

346 
Áû_Æloc_pùe_ªsour˚s
:

347  
°©us
;

348 
	}
}

350 
	$©h6kl_usb_‰ì_pùe_ªsour˚s
(
©h6kl_usb_pùe
 *
pùe
)

352 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
;

353 
sk_buff
 *
buf
 = 
NULL
;

355 i‡(
pùe
->
¨_usb
 =
NULL
) {

360 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
,

363 
pùe
->
logiˇl_pùe_num
,Öùe->
usb_pùe_h™dÀ
,

364 
pùe
->
urb_Æloc
,Öùe->
urb_˙t
);

366 i‡(
pùe
->
urb_Æloc
 !pùe->
urb_˙t
) {

367 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
,

370 
pùe
->
logiˇl_pùe_num
,Öùe->
usb_pùe_h™dÀ
,

371 
pùe
->
urb_Æloc
,Öùe->
urb_˙t
);

374 
åue
) {

375 
urb_c⁄ãxt
 = 
	`©h6kl_usb_Æloc_urb_‰om_pùe
(
pùe
);

376 i‡(
urb_c⁄ãxt
 =
NULL
)

379 i‡(
htc_bundÀ_£nd
) {

380 (
buf
 = 
	`skb_dequeue
(&
urb_c⁄ãxt
->
comp_queue
))

381 !
NULL
)

382 
	`dev_k‰ì_skb
(
buf
);

383 i‡(
pùe
->
logiˇl_pùe_num
 >=

384 
ATH6KL_USB_PIPE_TX_DATA_LP
 &&

385 
pùe
->
logiˇl_pùe_num
 <=

386 
ATH6KL_USB_PIPE_TX_DATA_VHP
)

387 i‡(
urb_c⁄ãxt
->
buf
 !
NULL
) {

388 
	`dev_k‰ì_skb
(
urb_c⁄ãxt
->
buf
);

389 
urb_c⁄ãxt
->
buf
 = 
NULL
;

392 i‡(
htc_bundÀ_ªcv
)

393 i‡(
pùe
->
logiˇl_pùe_num
 =
ATH6KL_USB_PIPE_RX_DATA
)

394 i‡(
urb_c⁄ãxt
->
buf
 !
NULL
) {

395 
	`dev_k‰ì_skb
(
urb_c⁄ãxt
->
buf
);

396 
urb_c⁄ãxt
->
buf
 = 
NULL
;

399 
	`k‰ì
(
urb_c⁄ãxt
);

402 
	}
}

404 
	$©h6kl_usb_˛ónup_pùe_ªsour˚s
(
©h6kl_usb
 *
devi˚
)

406 
i
;

408 
i
 = 0; i < 
ATH6KL_USB_PIPE_MAX
; i++)

409 
	`©h6kl_usb_‰ì_pùe_ªsour˚s
(&
devi˚
->
pùes
[
i
]);

411 
	}
}

413 
u8
 
	$©h6kl_usb_gë_logiˇl_pùe_num
(
©h6kl_usb
 *
devi˚
,

414 
u8
 
ï_addªss
, *
urb_cou¡
)

416 
u8
 
pùe_num
 = 
ATH6KL_USB_PIPE_INVALID
;

418 
ï_addªss
) {

419 
ATH6KL_USB_EP_ADDR_APP_CTRL_IN
:

420 
pùe_num
 = 
ATH6KL_USB_PIPE_RX_CTRL
;

421 *
urb_cou¡
 = 
RX_URB_COUNT
;

423 
ATH6KL_USB_EP_ADDR_APP_DATA_IN
:

424 
pùe_num
 = 
ATH6KL_USB_PIPE_RX_DATA
;

425 *
urb_cou¡
 = 
RX_URB_COUNT
;

427 
ATH6KL_USB_EP_ADDR_APP_INT_IN
:

428 
pùe_num
 = 
ATH6KL_USB_PIPE_RX_INT
;

429 *
urb_cou¡
 = 
RX_URB_COUNT
;

431 
ATH6KL_USB_EP_ADDR_APP_DATA2_IN
:

432 
pùe_num
 = 
ATH6KL_USB_PIPE_RX_DATA2
;

433 *
urb_cou¡
 = 
RX_URB_COUNT
;

435 
ATH6KL_USB_EP_ADDR_APP_CTRL_OUT
:

436 
pùe_num
 = 
ATH6KL_USB_PIPE_TX_CTRL
;

437 *
urb_cou¡
 = 
TX_URB_COUNT
;

439 
ATH6KL_USB_EP_ADDR_APP_DATA_LP_OUT
:

440 
pùe_num
 = 
ATH6KL_USB_PIPE_TX_DATA_LP
;

441 *
urb_cou¡
 = 
TX_URB_COUNT
;

443 
ATH6KL_USB_EP_ADDR_APP_DATA_MP_OUT
:

444 
pùe_num
 = 
ATH6KL_USB_PIPE_TX_DATA_MP
;

445 *
urb_cou¡
 = 
TX_URB_COUNT
;

447 
ATH6KL_USB_EP_ADDR_APP_DATA_HP_OUT
:

448 
pùe_num
 = 
ATH6KL_USB_PIPE_TX_DATA_HP
;

449 *
urb_cou¡
 = 
TX_URB_COUNT
;

451 
ATH6KL_USB_EP_ADDR_APP_DATA_VHP_OUT
:

452 
pùe_num
 = 
ATH6KL_USB_PIPE_TX_DATA_VHP
;

453 *
urb_cou¡
 = 
TX_URB_COUNT
;

460  
pùe_num
;

461 
	}
}

463 
	$©h6kl_usb_£tup_pùe_ªsour˚s
(
©h6kl_usb
 *
devi˚
)

465 
usb_öãrÁ˚
 *
öãrÁ˚
 = 
devi˚
->interface;

466 
usb_ho°_öãrÁ˚
 *
iÁ˚_desc
 = 
öãrÁ˚
->
cur_Æt£âög
;

467 
usb_ídpoöt_des¸ùt‹
 *
ídpoöt
;

468 
i
;

469 
urbcou¡
;

470 
°©us
 = 0;

471 
©h6kl_usb_pùe
 *
pùe
;

472 
u8
 
pùe_num
;

473 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "setting up USB Pipes using interface\n");

475 
i
 = 0; i < 
iÁ˚_desc
->
desc
.
bNumEndpoöts
; ++i) {

476 
ídpoöt
 = &
iÁ˚_desc
->ídpoöt[
i
].
desc
;

478 i‡(
	`ATH6KL_USB_IS_BULK_EP
(
ídpoöt
->
bmAâribuãs
)) {

479 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
,

481 
ATH6KL_USB_IS_DIR_IN


482 (
ídpoöt
->
bEndpoötAddªss
) ?

483 "RX" : "TX", 
ídpoöt
->
bEndpoötAddªss
,

484 
	`À16_to_˝u
(
ídpoöt
->
wMaxPackëSize
));

485 } i‡(
	`ATH6KL_USB_IS_INT_EP
(
ídpoöt
->
bmAâribuãs
)) {

486 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
,

488 
ATH6KL_USB_IS_DIR_IN


489 (
ídpoöt
->
bEndpoötAddªss
) ?

490 "RX" : "TX", 
ídpoöt
->
bEndpoötAddªss
,

491 
	`À16_to_˝u
(
ídpoöt
->
wMaxPackëSize
),

492 
ídpoöt
->
bI¡îvÆ
);

493 } i‡(
	`ATH6KL_USB_IS_ISOC_EP
(
ídpoöt
->
bmAâribuãs
)) {

495 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
,

497 
ATH6KL_USB_IS_DIR_IN


498 (
ídpoöt
->
bEndpoötAddªss
) ?

499 "RX" : "TX", 
ídpoöt
->
bEndpoötAddªss
,

500 
	`À16_to_˝u
(
ídpoöt
->
wMaxPackëSize
),

501 
ídpoöt
->
bI¡îvÆ
);

503 
urbcou¡
 = 0;

505 
pùe_num
 =

506 
	`©h6kl_usb_gë_logiˇl_pùe_num
(
devi˚
,

507 
ídpoöt
->
bEndpoötAddªss
,

508 &
urbcou¡
);

509 i‡(
pùe_num
 =
ATH6KL_USB_PIPE_INVALID
)

512 
pùe
 = &
devi˚
->
pùes
[
pùe_num
];

513 i‡(
pùe
->
¨_usb
 !
NULL
) {

518 
pùe
->
¨_usb
 = 
devi˚
;

519 
pùe
->
logiˇl_pùe_num
 = 
pùe_num
;

520 
pùe
->
ï_addªss
 = 
ídpoöt
->
bEndpoötAddªss
;

521 
pùe
->
max_∑ckë_size
 = 
	`À16_to_˝u
(
ídpoöt
->
wMaxPackëSize
);

523 i‡(
	`ATH6KL_USB_IS_BULK_EP
(
ídpoöt
->
bmAâribuãs
)) {

524 i‡(
	`ATH6KL_USB_IS_DIR_IN
(
pùe
->
ï_addªss
)) {

525 
pùe
->
usb_pùe_h™dÀ
 =

526 
	`usb_rcvbulkpùe
(
devi˚
->
udev
,

527 
pùe
->
ï_addªss
);

529 
pùe
->
usb_pùe_h™dÀ
 =

530 
	`usb_¢dbulkpùe
(
devi˚
->
udev
,

531 
pùe
->
ï_addªss
);

533 } i‡(
	`ATH6KL_USB_IS_INT_EP
(
ídpoöt
->
bmAâribuãs
)) {

534 i‡(
	`ATH6KL_USB_IS_DIR_IN
(
pùe
->
ï_addªss
)) {

535 
pùe
->
usb_pùe_h™dÀ
 =

536 
	`usb_rcvöçùe
(
devi˚
->
udev
,

537 
pùe
->
ï_addªss
);

539 
pùe
->
usb_pùe_h™dÀ
 =

540 
	`usb_¢döçùe
(
devi˚
->
udev
,

541 
pùe
->
ï_addªss
);

543 } i‡(
	`ATH6KL_USB_IS_ISOC_EP
(
ídpoöt
->
bmAâribuãs
)) {

545 i‡(
	`ATH6KL_USB_IS_DIR_IN
(
pùe
->
ï_addªss
)) {

546 
pùe
->
usb_pùe_h™dÀ
 =

547 
	`usb_rcviso˝ùe
(
devi˚
->
udev
,

548 
pùe
->
ï_addªss
);

550 
pùe
->
usb_pùe_h™dÀ
 =

551 
	`usb_¢diso˝ùe
(
devi˚
->
udev
,

552 
pùe
->
ï_addªss
);

555 
pùe
->
ï_desc
 = 
ídpoöt
;

557 i‡(!
	`ATH6KL_USB_IS_DIR_IN
(
pùe
->
ï_addªss
))

558 
pùe
->
Êags
 |
ATH6KL_USB_PIPE_FLAG_TX
;

560 
pùe
->
Êags
 |
ATH6KL_USB_PIPE_FLAG_RX
;

562 
°©us
 = 
	`©h6kl_usb_Æloc_pùe_ªsour˚s
(
pùe
, 
urbcou¡
);

563 i‡(
°©us
 != 0)

568  
°©us
;

569 
	}
}

572 
	$©h6kl_usb_po°_ªcv_å™s„rs
(
©h6kl_usb_pùe
 *
ªcv_pùe
,

573 
buf„r_Àngth
)

575 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
;

576 
u8
 *
d©a
;

577 
u32
 
Àn
;

578 
urb
 *urb;

579 
usb_°©us
;

583 
urb_c⁄ãxt
 = 
	`©h6kl_usb_Æloc_urb_‰om_pùe
(
ªcv_pùe
);

584 i‡(
urb_c⁄ãxt
 =
NULL
)

587 
urb_c⁄ãxt
->
buf
 = 
	`dev_Æloc_skb
(
buf„r_Àngth
);

588 i‡(
urb_c⁄ãxt
->
buf
 =
NULL
)

589 
îr_˛ónup_urb
;

591 
d©a
 = 
urb_c⁄ãxt
->
buf
->data;

592 
Àn
 = 
urb_c⁄ãxt
->
buf
->len;

594 
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_ATOMIC
);

595 i‡(
urb
 =
NULL
)

596 
îr_˛ónup_urb
;

598 
	`usb_fûl_bulk_urb
(
urb
,

599 
ªcv_pùe
->
¨_usb
->
udev
,

600 
ªcv_pùe
->
usb_pùe_h™dÀ
,

601 
d©a
,

602 
buf„r_Àngth
,

603 
©h6kl_usb_ªcv_com∂ëe
, 
urb_c⁄ãxt
);

605 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

608 
ªcv_pùe
->
logiˇl_pùe_num
,

609 
ªcv_pùe
->
usb_pùe_h™dÀ
,Ñecv_pùe->
ï_addªss
,

610 
buf„r_Àngth
, 
urb_c⁄ãxt
->
buf
);

612 
	`usb_™ch‹_urb
(
urb
, &
ªcv_pùe
->
urb_submôãd
);

613 
usb_°©us
 = 
	`usb_submô_urb
(
urb
, 
GFP_ATOMIC
);

615 i‡(
usb_°©us
) {

616 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

618 
usb_°©us
);

619 
	`usb_u«nch‹_urb
(
urb
);

620 
	`usb_‰ì_urb
(
urb
);

621 
îr_˛ónup_urb
;

623 
	`usb_‰ì_urb
(
urb
);

627 
îr_˛ónup_urb
:

628 
	`©h6kl_usb_˛ónup_ªcv_urb
(
urb_c⁄ãxt
);

630 
	}
}

632 
	$hif_usb_po°_ªcv_bundÀ_å™s„rs
(

633 
©h6kl_usb_pùe
 *
ªcv_pùe
,

634 
buf„r_Àngth
)

636 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
;

637 
u8
 *
d©a
;

638 
u32
 
Àn
;

639 
urb
 *urb;

640 
usb_°©us
;

643 
urb_c⁄ãxt
 = 
	`©h6kl_usb_Æloc_urb_‰om_pùe
(
ªcv_pùe
);

644 i‡(
urb_c⁄ãxt
 =
NULL
)

646 i‡(
buf„r_Àngth
) {

647 
urb_c⁄ãxt
->
buf
 = 
	`dev_Æloc_skb
(
buf„r_Àngth
);

648 i‡(
urb_c⁄ãxt
->
buf
 =
NULL
) {

649 
	`©h6kl_usb_˛ónup_ªcv_urb
(
urb_c⁄ãxt
);

654 
d©a
 = 
urb_c⁄ãxt
->
buf
->data;

655 
Àn
 = 
urb_c⁄ãxt
->
buf
->len;

657 
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_ATOMIC
);

658 i‡(
urb
 =
NULL
) {

659 
	`©h6kl_usb_˛ónup_ªcv_urb
(
urb_c⁄ãxt
);

663 
	`usb_fûl_bulk_urb
(
urb
,

664 
ªcv_pùe
->
¨_usb
->
udev
,

665 
ªcv_pùe
->
usb_pùe_h™dÀ
,

666 
d©a
,

667 
ATH6KL_USB_RX_BUNDLE_BUFFER_SIZE
,

668 
©h6kl_usb_ªcv_bundÀ_com∂ëe
, 
urb_c⁄ãxt
);

670 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

673 
ªcv_pùe
->
logiˇl_pùe_num
,

674 
ªcv_pùe
->
usb_pùe_h™dÀ
,Ñecv_pùe->
ï_addªss
,

675 
buf„r_Àngth
, 
urb_c⁄ãxt
->
buf
);

677 
	`usb_™ch‹_urb
(
urb
, &
ªcv_pùe
->
urb_submôãd
);

678 
usb_°©us
 = 
	`usb_submô_urb
(
urb
, 
GFP_ATOMIC
);

680 i‡(
usb_°©us
) {

681 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

683 
usb_°©us
);

684 
	`usb_u«nch‹_urb
(
urb
);

685 
	`usb_‰ì_urb
(
urb
);

686 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
,

687 
urb_c⁄ãxt
);

690 
	`usb_‰ì_urb
(
urb
);

693 
	}
}

696 
	$©h6kl_usb_Êush_Æl
(
©h6kl_usb
 *
devi˚
)

698 
i
;

699 
©h6kl_usb_pùe
 *
pùe
;

701 
i
 = 0; i < 
ATH6KL_USB_PIPE_MAX
; i++) {

703 i‡(
devi˚
->
pùes
[
i
].
¨_usb
) {

704 i‡(&
devi˚
->
pùes
[
i
].
urb_submôãd
)

705 
	`usb_kûl_™ch‹ed_urbs
(

706 &
devi˚
->
pùes
[
i
].
urb_submôãd
);

707 
pùe
 = &
devi˚
->
pùes
[
i
].
¨_usb
->pipes[i];

708 i‡(
pùe
)

709 
	`Êush_w‹k
(&
pùe
->
io_com∂ëe_w‹k
);

716 
	}
}

718 
	$©h6kl_usb_°¨t_ªcv_pùes
(
©h6kl_usb
 *
devi˚
)

729 
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA
].
urb_˙t_thªsh
 =

730 
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA
].
urb_Æloc
 / 2;

732 i‡(!
htc_bundÀ_ªcv
)

733 
	`©h6kl_usb_po°_ªcv_å™s„rs
(

734 &
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA
],

735 
ATH6KL_USB_RX_BUFFER_SIZE
);

737 
	`hif_usb_po°_ªcv_bundÀ_å™s„rs
(

738 &
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA
],

739 
ATH6KL_USB_RX_BUNDLE_BUFFER_SIZE
);

745 
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA2
].
urb_˙t_thªsh
 =

746 
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA2
].
urb_Æloc
 / 2;

747 
	`©h6kl_usb_po°_ªcv_å™s„rs
(

748 &
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA2
],

749 
ATH6KL_USB_RX_BUFFER_SIZE
);

751 
	}
}

754 
	$©h6kl_usb_ªcv_com∂ëe
(
urb
 *urb)

756 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
 =

757 (
©h6kl_urb_c⁄ãxt
 *)
urb
->
c⁄ãxt
;

758 
°©us
 = 0;

759 
sk_buff
 *
buf
 = 
NULL
;

760 
©h6kl_usb_pùe
 *
pùe
 = 
urb_c⁄ãxt
->pipe;

761 
©h6kl_usb_pùe_°©
 *
pùe_°
 = &
pùe
->
usb_pùe_°©
;

762 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


763 
©h6kl
 *
¨
 = 
pùe
->
¨_usb
->ar;

766 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

767 "%s:ÑecvÖùe: %d, sèt:%d,Üí:%d urb:0x%p\n", 
__func__
,

768 
pùe
->
logiˇl_pùe_num
, 
urb
->
°©us
, urb->
a˘uÆ_Àngth
,

769 
urb
);

771 i‡(
urb
->
°©us
 != 0) {

772 
pùe_°
->
num_rx_comp_îr
++;

773 
°©us
 = -
EIO
;

774 
urb
->
°©us
) {

775 -
EOVERFLOW
:

776 
urb
->
a˘uÆ_Àngth
 = 
ATH6KL_USB_RX_BUFFER_SIZE
;

777 
°©us
 = 0;

779 -
ECONNRESET
:

780 -
ENOENT
:

781 -
ESHUTDOWN
:

786 
°©us
 = -
ECANCELED
;

789 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

791 
__func__
, 
pùe
->
logiˇl_pùe_num
,

792 
pùe
->
ï_addªss
, 
urb
->
°©us
);

795 
˛ónup_ªcv_urb
;

797 i‡(
urb
->
a˘uÆ_Àngth
 == 0)

798 
˛ónup_ªcv_urb
;

800 
buf
 = 
urb_c⁄ãxt
->buf;

802 
urb_c⁄ãxt
->
buf
 = 
NULL
;

803 
	`skb_put
(
buf
, 
urb
->
a˘uÆ_Àngth
);

805 
	`skb_queue_èû
(&
pùe
->
io_comp_queue
, 
buf
);

806 
pùe_°
->
num_rx_comp
++;

807 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


808 
	`queue_w‹k
(
¨
->
©h6kl_wq
, &
pùe
->
io_com∂ëe_w‹k
);

810 
	`scheduÀ_w‹k
(&
pùe
->
io_com∂ëe_w‹k
);

813 
˛ónup_ªcv_urb
:

814 
	`©h6kl_usb_˛ónup_ªcv_urb
(
urb_c⁄ãxt
);

816 i‡(
°©us
 =0 || 
urb
->°©u†=-
EPROTO
) {

817 i‡(
pùe
->
urb_˙t
 >pùe->
urb_˙t_thªsh
 &&

818 
	`skb_queue_Àn
(&
pùe
->
io_comp_queue
) <

819 
pùe
->
¨_usb
->
rxq_thªshﬁd
) {

821 
	`©h6kl_usb_po°_ªcv_å™s„rs
(
pùe
,

822 
ATH6KL_USB_RX_BUFFER_SIZE
);

826 
	}
}

828 
	$©h6kl_usb_ªcv_bundÀ_com∂ëe
(
urb
 *urb)

830 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
 =

831 (
©h6kl_urb_c⁄ãxt
 *)
urb
->
c⁄ãxt
;

832 
°©us
 = 0;

833 
sk_buff
 *
buf
 = 
NULL
;

834 
©h6kl_usb_pùe
 *
pùe
 = 
urb_c⁄ãxt
->pipe;

835 
©h6kl_usb_pùe_°©
 *
pùe_°
 = &
pùe
->
usb_pùe_°©
;

836 
u8
 *
√td©a
, *
√td©a_√w
;

837 
u32
 
√éí
, 
√éí_√w
;

838 
htc_‰ame_hdr
 *
htc_hdr
;

839 
u16
 
∑ylﬂd_Àn
;

840 
sk_buff
 *
√w_skb
 = 
NULL
;

841 
©h6kl
 *
¨
 = 
pùe
->
¨_usb
->ar;

843 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

844 "%s:ÑecvÖùe: %d, sèt:%d,Üí:%d urb:0x%p\n", 
__func__
,

845 
pùe
->
logiˇl_pùe_num
, 
urb
->
°©us
, urb->
a˘uÆ_Àngth
,

846 
urb
);

850 i‡(
urb
->
°©us
 != 0) {

851 
pùe_°
->
num_rx_bundÀ_comp_îr
++;

852 
°©us
 = -
EIO
;

853 
urb
->
°©us
) {

854 -
EOVERFLOW
:

855 
urb
->
a˘uÆ_Àngth
 =

856 
ATH6KL_USB_RX_BUNDLE_BUFFER_SIZE
;

857 
°©us
 = 0;

859 -
ECONNRESET
:

860 -
ENOENT
:

861 -
ESHUTDOWN
:

866 
°©us
 = -
ECANCELED
;

869 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

871 
__func__
, 
pùe
->
logiˇl_pùe_num
,

872 
pùe
->
ï_addªss
, 
urb
->
°©us
);

876 i‡(
urb
->
a˘uÆ_Àngth
 == 0)

878 
buf
 = 
urb_c⁄ãxt
->buf;

880 
√td©a
 = 
buf
->
d©a
;

881 
√éí
 = 
buf
->
Àn
;

882 
√éí
 = 
urb
->
a˘uÆ_Àngth
;

885 
u8
 
exåa_∑d
 = 0;

886 
u16
 
a˘_‰ame_Àn
 = 0;

887 
u16
 
‰ame_Àn
;

890 
htc_hdr
 = (
htc_‰ame_hdr
 *)
√td©a
;

891 i‡(
htc_hdr
->
eid
 >
ENDPOINT_MAX
) {

892 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

893 "©husb: Rx: invÆidÉid=%d\n", 
htc_hdr
->
eid
);

897 
∑ylﬂd_Àn
 =

898 
	`À16_to_˝u
(
	`gë_u«lig√d
((
u16
 *)&
htc_hdr
->
∑yld_Àn
));

900 i‡(
¨
->
hw
.
Êags
 & 
ATH6KL_HW_TGT_ALIGN_PADDING
) {

901 
a˘_‰ame_Àn
 = (
HTC_HDR_LENGTH
 + 
∑ylﬂd_Àn
);

903 i‡(
htc_hdr
->
eid
 == 0 || htc_hdr->eid == 1)

907 
exåa_∑d
 = 0;

909 
exåa_∑d
 =

910 
	`gë_u«lig√d
((
u8
 *)&
htc_hdr
->
˘æ
[1]);

913 i‡(
∑ylﬂd_Àn
 > 
ATH6KL_MAX_AMSDU_SIZE
) {

914 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

916 
∑ylﬂd_Àn
);

920 i‡(
¨
->
hw
.
Êags
 & 
ATH6KL_HW_TGT_ALIGN_PADDING
)

921 
‰ame_Àn
 = (
a˘_‰ame_Àn
 + 
exåa_∑d
);

923 
‰ame_Àn
 = (
HTC_HDR_LENGTH
 + 
∑ylﬂd_Àn
);

925 i‡(
√éí
 >
‰ame_Àn
) {

927 i‡(
¨
->
hw
.
Êags
 &

928 
ATH6KL_HW_TGT_ALIGN_PADDING
) {

929 
√w_skb
 = 
	`dev_Æloc_skb
(
a˘_‰ame_Àn
);

930 i‡(
√w_skb
 =
NULL
) {

931 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

933 "Áûed\n", 
a˘_‰ame_Àn
);

937 
√td©a_√w
 = 
√w_skb
->
d©a
;

938 
√éí_√w
 = 
√w_skb
->
Àn
;

939 
	`mem˝y
(
√td©a_√w
,

940 
√td©a
, 
a˘_‰ame_Àn
);

941 
	`skb_put
(
√w_skb
, 
a˘_‰ame_Àn
);

943 
√w_skb
 = 
	`dev_Æloc_skb
(
‰ame_Àn
);

944 i‡(
√w_skb
 =
NULL
) {

945 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

947 "Áûed\n", 
‰ame_Àn
);

951 
√td©a_√w
 = 
√w_skb
->
d©a
;

952 
√éí_√w
 = 
√w_skb
->
Àn
;

953 
	`mem˝y
(
√td©a_√w
, 
√td©a
, 
‰ame_Àn
);

954 
	`skb_put
(
√w_skb
, 
‰ame_Àn
);

957 
	`skb_queue_èû
(&
pùe
->
io_comp_queue
, 
√w_skb
);

958 
√w_skb
 = 
NULL
;

960 
√td©a
 +
‰ame_Àn
;

961 
√éí
 -
‰ame_Àn
;

963 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

966 
√éí
, 
‰ame_Àn
);

969 } 
√éí
);

971 
pùe_°
->
num_rx_bundÀ_comp
++;

972 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


973 
	`queue_w‹k
(
¨
->
©h6kl_wq
, &
pùe
->
io_com∂ëe_w‹k
);

975 
	`scheduÀ_w‹k
(&
pùe
->
io_com∂ëe_w‹k
);

980 i‡(
urb_c⁄ãxt
->
buf
 =
NULL
)

981 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

984 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
, urb_context);

986 i‡(
°©us
 =0 || 
urb
->°©u†=-
EPROTO
) {

987 i‡(
pùe
->
urb_˙t
 >pùe->
urb_˙t_thªsh
)

989 
	`hif_usb_po°_ªcv_bundÀ_å™s„rs
(
pùe
,

993 
	}
}

996 
	$©h6kl_usb_usb_å™smô_com∂ëe
(
urb
 *urb)

998 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
 =

999 (
©h6kl_urb_c⁄ãxt
 *)
urb
->
c⁄ãxt
;

1000 
sk_buff
 *
buf
;

1001 
©h6kl_usb_pùe
 *
pùe
 = 
urb_c⁄ãxt
->pipe;

1002 
©h6kl_usb_pùe_°©
 *
pùe_°
 = &
pùe
->
usb_pùe_°©
;

1003 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


1004 
©h6kl
 *
¨
 = 
pùe
->
¨_usb
->ar;

1007 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1009 
__func__
, 
pùe
->
logiˇl_pùe_num
, 
urb
->
°©us
,

1010 
urb
->
a˘uÆ_Àngth
);

1012 i‡(
urb
->
°©us
 != 0) {

1013 
pùe_°
->
num_tx_comp_îr
++;

1014 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1016 
__func__
, 
pùe
->
logiˇl_pùe_num
, 
urb
->
°©us
);

1019 
buf
 = 
urb_c⁄ãxt
->buf;

1020 
urb_c⁄ãxt
->
buf
 = 
NULL
;

1021 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
, urb_context);

1024 
	`skb_queue_èû
(&
pùe
->
io_comp_queue
, 
buf
);

1025 
pùe_°
->
num_tx_comp
++;

1026 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


1027 
	`queue_w‹k
(
¨
->
©h6kl_wq
, &
pùe
->
io_com∂ëe_w‹k
);

1029 
	`scheduÀ_w‹k
(&
pùe
->
io_com∂ëe_w‹k
);

1031 
	}
}

1033 
	$©h6kl_usb_io_comp_w‹k
(
w‹k_°ru˘
 *
w‹k
)

1035 
©h6kl_usb_pùe
 *
pùe
 =

1036 
	`c⁄èöî_of
(
w‹k
, 
©h6kl_usb_pùe
, 
io_com∂ëe_w‹k
);

1037 
sk_buff
 *
buf
;

1038 
©h6kl_usb
 *
devi˚
;

1039 
©h6kl_usb_pùe_°©
 *
pùe_°
 = &
pùe
->
usb_pùe_°©
;

1040 
u32
 
tx
 = 0, 
rx
 = 0;

1041 #i‡
	`deföed
(
CE_OLD_KERNEL_SUPPORT_2_6_23
Ë|| deföed(
USB_AUTO_SUSPEND
)

1042 
©h6kl
 *
¨
 = 
pùe
->
¨_usb
->ar;

1045 
pùe_°
->
num_io_comp
++;

1046 
devi˚
 = 
pùe
->
¨_usb
;

1048 i‡(
	`ã°_™d_£t_bô
(
WORKER_LOCK_BIT
, &
pùe
->
w‹kî_lock
))

1051 (
buf
 = 
	`skb_dequeue
(&
pùe
->
io_comp_queue
))) {

1053 #ifde‡
USB_AUTO_SUSPEND


1055 i‡(
pùe
->
Êags
 & 
ATH6KL_USB_PIPE_FLAG_RX
) {

1056 i‡(
¨
->
htc_›s
->
skù_usb_m¨k_busy
 !
NULL
) {

1057 i‡(
¨
->
htc_›s
->
	`skù_usb_m¨k_busy
◊r, 
buf
))

1058 
skù_m¨k_busy
;

1061 
	`usb_m¨k_œ°_busy
(
devi˚
->
udev
);

1063 
skù_m¨k_busy
:

1065 i‡(
pùe
->
Êags
 & 
ATH6KL_USB_PIPE_FLAG_TX
) {

1066 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1067 "©h6k»usb xmô cÆlback buf:0x%p\n", 
buf
);

1068 
devi˚
->
htc_ˇŒbacks
.

1069 
	`tx_com∂ëi⁄
(
devi˚
->
¨
->
htc_èrgë
, 
buf
);

1070 #ifde‡
USB_AUTO_SUSPEND


1071 
	`•ö_lock_bh
(&
¨
->
usb_pm_lock
);

1072 
	`©h6kl_auto_pm_wakeup_ªsume
(
¨
);

1073 
	`•ö_u∆ock_bh
(&
¨
->
usb_pm_lock
);

1075 i‡(
tx
++ > 
devi˚
->
max_sche_tx
) {

1076 
	`˛ór_bô
(
WORKER_LOCK_BIT
, &
pùe
->
w‹kî_lock
);

1077 
pùe_°
->
num_tx_ªsche
++;

1078 
ªscheduÀ
;

1081 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1082 "©h6k»usbÑecv cÆlback buf:0x%p\n", 
buf
);

1084 i‡(!
devi˚
->
htc_ˇŒbacks
.
rx_com∂ëi⁄
) {

1085 
	`dev_k‰ì_skb
(
buf
);

1089 
devi˚
->
htc_ˇŒbacks
.

1090 
	`rx_com∂ëi⁄
(
devi˚
->
¨
->
htc_èrgë
, 
buf
,

1091 
pùe
->
logiˇl_pùe_num
);

1093 i‡(
rx
++ > 
devi˚
->
max_sche_rx
) {

1094 
	`˛ór_bô
(
WORKER_LOCK_BIT
, &
pùe
->
w‹kî_lock
);

1095 
pùe_°
->
num_rx_ªsche
++;

1096 
ªscheduÀ
;

1101 i‡(
pùe
->
Êags
 & 
ATH6KL_USB_PIPE_FLAG_RX
 &&

1102 
pùe
->
urb_˙t
 >pùe->
urb_˙t_thªsh
) {

1104 
	`©h6kl_usb_po°_ªcv_å™s„rs
(
pùe
, 
ATH6KL_USB_RX_BUFFER_SIZE
);

1107 
	`˛ór_bô
(
WORKER_LOCK_BIT
, &
pùe
->
w‹kî_lock
);

1109 i‡(
tx
 > 
pùe_°
->
num_max_tx
)

1110 
pùe_°
->
num_max_tx
 = 
tx
;

1112 i‡(
rx
 > 
pùe_°
->
num_max_rx
)

1113 
pùe_°
->
num_max_rx
 = 
rx
;

1117 
ªscheduÀ
:

1119 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1121 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


1122 
	`queue_w‹k
(
¨
->
©h6kl_wq
, &
pùe
->
io_com∂ëe_w‹k
);

1124 
	`scheduÀ_w‹k
(&
pùe
->
io_com∂ëe_w‹k
);

1128 
	}
}

1130 
	#ATH6KL_USB_MAX_DIAG_CMD
 ((
©h6kl_usb_˘æ_düg_cmd_wrôe
))

	)

1131 
	#ATH6KL_USB_MAX_DIAG_RESP
 ((
©h6kl_usb_˘æ_düg_ª•_ªad
))

	)

1133 
	$©h6kl_usb_de°roy
(
©h6kl_usb
 *
¨_usb
)

1135 
	`uƒegi°î_ªboŸ_nŸifõr
(&
¨_usb
->
ªboŸ_nŸifõr
);

1136 #i‚de‡
CE_OLD_KERNEL_SUPPORT_2_6_23


1137 
	`©h6kl_usb_Êush_Æl
(
¨_usb
);

1139 
	`©h6kl_usb_˛ónup_pùe_ªsour˚s
(
¨_usb
);

1141 
	`usb_£t_ötfd©a
(
¨_usb
->
öãrÁ˚
, 
NULL
);

1143 
	`k‰ì
(
¨_usb
->
düg_cmd_buf„r
);

1144 
	`k‰ì
(
¨_usb
->
düg_ª•_buf„r
);

1146 
	`k‰ì
(
¨_usb
);

1147 
	}
}

1149 
	$©h6kl_usb_ªboŸ
(
nŸifõr_block
 *
nb
, 
vÆ
,

1150 *
v
)

1152 
©h6kl_usb
 *
¨_usb
;

1153 
©h6kl
 *
¨
 ;

1155 
¨_usb
 = 
	`c⁄èöî_of
(
nb
, 
©h6kl_usb
, 
ªboŸ_nŸifõr
);

1156 i‡(
¨_usb
 =
NULL
)

1157  
NOTIFY_DONE
;

1159 
¨
 = (
©h6kl
 *Ë
¨_usb
->ar;

1160 #ifde‡
CE_SUPPORT


1161 i‡((
¨
 !
NULL
Ë&& (¨->
°©e
 =
ATH6KL_STATE_ON
))

1163 i‡(
¨
 !
NULL
)

1165 i‡(
	`BOOTSTRAP_IS_HSIC
(
¨
->
boŸ°øp_mode
) == 0)

1166 
	`©h6kl_ª£t_devi˚
(
¨
,ár->
èrgë_ty≥
, 
åue
,Årue);

1169  
NOTIFY_DONE
;

1170 
	}
}

1172 
©h6kl_usb
 *
	$©h6kl_usb_¸óã
(
usb_öãrÁ˚
 *
öãrÁ˚
)

1174 
©h6kl_usb
 *
¨_usb
 = 
NULL
;

1175 
usb_devi˚
 *
dev
 = 
	`öãrÁ˚_to_usbdev
(
öãrÁ˚
);

1176 
©h6kl_usb_pùe
 *
pùe
;

1177 
°©us
 = 0;

1178 
i
;

1180 
¨_usb
 = 
	`kzÆloc
((
©h6kl_usb
), 
GFP_KERNEL
);

1181 i‡(
¨_usb
 =
NULL
)

1182 
Áû_©h6kl_usb_¸óã
;

1184 
	`mem£t
(
¨_usb
, 0, (
©h6kl_usb
));

1185 
	`usb_£t_ötfd©a
(
öãrÁ˚
, 
¨_usb
);

1186 
	`•ö_lock_öô
(&(
¨_usb
->
cs_lock
));

1187 
	`•ö_lock_öô
(&(
¨_usb
->
rx_lock
));

1188 
	`•ö_lock_öô
(&(
¨_usb
->
tx_lock
));

1189 
¨_usb
->
udev
 = 
dev
;

1190 
¨_usb
->
öãrÁ˚
 = interface;

1192 #ifde‡
CONFIG_ANDROID


1193 
©h6kl_usb_u∆ﬂd_dev_num
 = 
dev
->
devnum
;

1196 
i
 = 0; i < 
ATH6KL_USB_PIPE_MAX
; i++) {

1197 
pùe
 = &
¨_usb
->
pùes
[
i
];

1198 
	`INIT_WORK
(&
pùe
->
io_com∂ëe_w‹k
,

1199 
©h6kl_usb_io_comp_w‹k
);

1200 
	`skb_queue_hód_öô
(&
pùe
->
io_comp_queue
);

1201 
pùe
->
w‹kî_lock
 = 0;

1204 
¨_usb
->
düg_cmd_buf„r
 = 
	`kzÆloc
(
ATH6KL_USB_MAX_DIAG_CMD
, 
GFP_KERNEL
);

1205 i‡(
¨_usb
->
düg_cmd_buf„r
 =
NULL
) {

1206 
°©us
 = -
ENOMEM
;

1207 
Áû_©h6kl_usb_¸óã
;

1210 
¨_usb
->
düg_ª•_buf„r
 = 
	`kzÆloc
(
ATH6KL_USB_MAX_DIAG_RESP
,

1211 
GFP_KERNEL
);

1212 i‡(
¨_usb
->
düg_ª•_buf„r
 =
NULL
) {

1213 
°©us
 = -
ENOMEM
;

1214 
Áû_©h6kl_usb_¸óã
;

1217 
¨_usb
->
max_sche_tx
 =

1218 
¨_usb
->
max_sche_rx
 = 
HIF_USB_MAX_SCHE_PKT
;

1219 
¨_usb
->
rxq_thªshﬁd
 = 
HIF_USB_RX_QUEUE_THRESHOLD
;

1221 
°©us
 = 
	`©h6kl_usb_£tup_pùe_ªsour˚s
(
¨_usb
);

1223 
¨_usb
->
ªboŸ_nŸifõr
.
nŸifõr_ˇŒ
 = 
©h6kl_usb_ªboŸ
;

1224 
	`ªgi°î_ªboŸ_nŸifõr
(&
¨_usb
->
ªboŸ_nŸifõr
);

1226 
Áû_©h6kl_usb_¸óã
:

1227 i‡(
°©us
 != 0) {

1228 
	`©h6kl_usb_de°roy
(
¨_usb
);

1229 
¨_usb
 = 
NULL
;

1231  
¨_usb
;

1232 
	}
}

1234 
	$©h6kl_usb_devi˚_dëached
(
usb_öãrÁ˚
 *
öãrÁ˚
)

1236 
©h6kl_usb
 *
¨_usb
;

1237 #ifde‡
USB_AUTO_SUSPEND


1238 
usb_pm_skb_queue_t
 *
íåy
, *
p_usb_pm_skb_queue
;

1239 
©h6kl
 *
¨
;

1242 
¨_usb
 = 
	`usb_gë_ötfd©a
(
öãrÁ˚
);

1243 i‡(
¨_usb
 =
NULL
)

1246 
	`©h6kl_°›_txrx
(
¨_usb
->
¨
);

1249 #ifde‡
CONFIG_ANDROID


1250 i‡(
	`©omic_ªad
(&
©h6kl_usb_u∆ﬂd_°©e
) ==

1251 
ATH6KL_USB_UNLOAD_STATE_DRV_DEREG
)

1252 
	`©omic_£t
(&
©h6kl_usb_u∆ﬂd_°©e
,

1253 
ATH6KL_USB_UNLOAD_STATE_TARGET_RESET
);

1255 
	`mdñay
(20);

1258 #ifde‡
USB_AUTO_SUSPEND


1265 
¨
 = 
¨_usb
->ar;

1266 
p_usb_pm_skb_queue
 = &
¨
->
usb_pm_skb_queue
;

1268 
	`gë_queue_dïth
(&(
p_usb_pm_skb_queue
->
li°
)) > 0) {

1269 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "%†Ñesume_wk qeuê%d\n", 
__func__
,

1270 
	`gë_queue_dïth
(&(
p_usb_pm_skb_queue
->
li°
)));

1271 
íåy
 = 
	`li°_fú°_íåy
(&
p_usb_pm_skb_queue
->
li°
,

1272 
usb_pm_skb_queue_t
, 
li°
);

1273 
	`li°_dñ
(&
íåy
->
li°
);

1274 
	`k‰ì
(
íåy
);

1276 #ifde‡
ATH6KL_BUS_VOTE


1277 i‡(
	`machöe_is_≠q8064_dma
(Ë|| 
	`machöe_is_≠q8064_buñÀr
() ||

1278 
©h6kl_∂©f‹m_has_vªg
 == 0)

1280 
	`usb_auto_pm_tu∫off
(
¨
);

1283 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


1284 
	`©h6kl_usb_Êush_Æl
(
¨_usb
);

1286 
	`©h6kl_c‹e_˛ónup
(
¨_usb
->
¨
);

1287 
	`©h6kl_usb_de°roy
(
¨_usb
);

1288 
	}
}

1291 
	$hif_°¨t
(
©h6kl
 *
¨
)

1293 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1294 
i
;

1296 
	`©h6kl_usb_°¨t_ªcv_pùes
(
devi˚
);

1299 
i
 = 
ATH6KL_USB_PIPE_TX_CTRL
;

1300 
i
 <
ATH6KL_USB_PIPE_TX_DATA_VHP
; i++) {

1301 
devi˚
->
pùes
[
i
].
urb_˙t_thªsh
 =

1302 
devi˚
->
pùes
[
i
].
urb_Æloc
 / 2;

1304 
	}
}

1306 
	$©h6kl_usb_å™smô_bundÀ_com∂ëe
(
urb
 *urb)

1308 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
 =

1309 (
©h6kl_urb_c⁄ãxt
 *)
urb
->
c⁄ãxt
;

1310 
©h6kl_usb_pùe
 *
pùe
 = 
urb_c⁄ãxt
->pipe;

1311 
©h6kl_usb_pùe_°©
 *
pùe_°
 = &
pùe
->
usb_pùe_°©
;

1312 
sk_buff
 *
tmp_buf
;

1313 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


1314 
©h6kl
 *
¨
 = 
pùe
->
¨_usb
->ar;

1317 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
, "+%s:Öipe: %d, stat:%d,Üen:%d " "\n",

1318 
__func__
, 
pùe
->
logiˇl_pùe_num
, 
urb
->
°©us
,

1319 
urb
->
a˘uÆ_Àngth
);

1321 i‡(
urb
->
°©us
 != 0) {

1322 
pùe_°
->
num_tx_bundÀ_comp_îr
++;

1323 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1325 
__func__
, 
pùe
->
logiˇl_pùe_num
, 
urb
->
°©us
);

1328 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
, urb_context);

1330 (
tmp_buf
 = 
	`skb_dequeue
(&
urb_c⁄ãxt
->
comp_queue
)))

1331 
	`skb_queue_èû
(&
pùe
->
io_comp_queue
, 
tmp_buf
);

1332 
pùe_°
->
num_tx_bundÀ_comp
++;

1333 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


1334 
	`queue_w‹k
(
¨
->
©h6kl_wq
, &
pùe
->
io_com∂ëe_w‹k
);

1336 
	`scheduÀ_w‹k
(&
pùe
->
io_com∂ëe_w‹k
);

1338 
	}
}

1340 
	$©h6kl_usb_£nd_bundÀ
(
©h6kl
 *
¨
, 
u8
 
pid
,

1341 
sk_buff
 **
msg_bundÀ
, 
num_msgs
)

1343 
°©us
 = 0;

1344 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1345 
©h6kl_usb_pùe
 *
pùe
 = &
devi˚
->
pùes
[
pid
];

1346 
©h6kl_usb_pùe_°©
 *
pùe_°
 = &
pùe
->
usb_pùe_°©
;

1347 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
;

1348 
urb
 *urb;

1349 
sk_buff
 *
°ªam_buf
 = 
NULL
, *
buf
 = NULL;

1350 
usb_°©us
;

1351 
i
;

1353 
pùe_°
->
num_tx_mu…i
++;

1354 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1356 
__func__
, 
pid
);

1359 
u8
 *
°ªam_√td©a
, *
√td©a
, *
°ªam_√td©a_°¨t
;

1360 
u32
 
°ªam_√éí
, 
√éí
;

1362 
urb_c⁄ãxt
 = 
	`©h6kl_usb_Æloc_urb_‰om_pùe
(
pùe
);

1364 i‡(
urb_c⁄ãxt
 =
NULL
) {

1365 
pùe_°
->
num_tx_mu…i_îr_Ÿhîs
++;

1370 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1372 
__func__
, 
pid
, 
pùe
->
urb_˙t
);

1373 
°©us
 = -
ENOMEM
;

1377 
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_ATOMIC
);

1378 i‡(
urb
 =
NULL
) {

1379 
pùe_°
->
num_tx_mu…i_îr_Ÿhîs
++;

1380 
°©us
 = -
ENOMEM
;

1381 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
,

1382 
urb_c⁄ãxt
);

1386 
°ªam_buf
 = 
urb_c⁄ãxt
->
buf
;

1388 
°ªam_√td©a
 = 
°ªam_buf
->
d©a
;

1389 
°ªam_√éí
 = 
°ªam_buf
->
Àn
;

1391 
°ªam_√éí
 = 0;

1392 
°ªam_√td©a_°¨t
 = 
°ªam_√td©a
;

1394 
i
 = 0; i < 
num_msgs
; i++) {

1395 
buf
 = 
msg_bundÀ
[
i
];

1396 
√td©a
 = 
buf
->
d©a
;

1397 
√éí
 = 
buf
->
Àn
;

1399 
	`mem˝y
(
°ªam_√td©a
, 
√td©a
, 
√éí
);

1402 
°ªam_√td©a
 += 1664;

1403 
°ªam_√éí
 += 1664;

1406 
	`skb_queue_èû
(&
urb_c⁄ãxt
->
comp_queue
, 
buf
);

1409 
	`usb_fûl_bulk_urb
(
urb
,

1410 
devi˚
->
udev
,

1411 
pùe
->
usb_pùe_h™dÀ
,

1412 
°ªam_√td©a_°¨t
,

1413 
°ªam_√éí
,

1414 
©h6kl_usb_å™smô_bundÀ_com∂ëe
,

1415 
urb_c⁄ãxt
);

1417 i‡((
°ªam_√éí
 % 
pùe
->
max_∑ckë_size
) == 0)

1419 
urb
->
å™s„r_Êags
 |
URB_ZERO_PACKET
;

1421 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1424 
pùe
->
logiˇl_pùe_num
,Öùe->
usb_pùe_h™dÀ
,

1425 
pùe
->
ï_addªss
, 
°ªam_√éí
);

1427 
	`usb_™ch‹_urb
(
urb
, &
pùe
->
urb_submôãd
);

1429 
	`•ö_lock_bh
(&
¨
->
°©e_lock
);

1430 i‡((
¨
->
°©e
 =
ATH6KL_STATE_DEEPSLEEP
) ||

1431 (
¨
->
°©e
 =
ATH6KL_STATE_WOW
))

1432 
usb_°©us
 = -
EINVAL
;

1434 
usb_°©us
 = 
	`usb_submô_urb
(
urb
, 
GFP_ATOMIC
);

1435 
	`•ö_u∆ock_bh
(&
¨
->
°©e_lock
);

1437 i‡(
usb_°©us
) {

1438 
pùe_°
->
num_tx_mu…i_îr
++;

1439 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1441 "\n", 
usb_°©us
);

1442 
	`usb_u«nch‹_urb
(
urb
);

1443 
	`usb_‰ì_urb
(
urb
);

1444 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
,

1445 
urb_c⁄ãxt
);

1446 
°©us
 = -
EINVAL
;

1449 
	`usb_‰ì_urb
(
urb
);

1452  
°©us
;

1453 
	}
}

1455 #ifde‡
USB_AUTO_SUSPEND


1456 
	$usb_debugfs_gë_pm_ußge_˙t
(
©h6kl
 *
¨
)

1458 
©h6kl_usb
 *
devi˚
 = (©h6kl_usb *)
¨
->
hif_¥iv
;

1459 
usb_öãrÁ˚
 *
öãrÁ˚
 = 
devi˚
->interface;

1460  
	`©omic_ªad
(&
öãrÁ˚
->
pm_ußge_˙t
);

1461 
	}
}

1463 
	$usb_auto_pm_dißbÀ
(
©h6kl
 *
¨
)

1465 
©h6kl_usb
 *
devi˚
 = (©h6kl_usb *)
¨
->
hif_¥iv
;

1466 
usb_öãrÁ˚
 *
öãrÁ˚
 = 
devi˚
->interface;

1467 
	`usb_aut›m_gë_öãrÁ˚_async
(
öãrÁ˚
);

1468 
¨
->
auto_pm_˙t
++;

1469 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "autopm +1Ñefcnt=%d my=%d\n",

1470 
	`usb_debugfs_gë_pm_ußge_˙t
(
¨
),ár->
auto_pm_˙t
);

1473 
	}
}

1476 
	$usb_auto_pm_íabÀ
(
©h6kl
 *
¨
)

1478 
©h6kl_usb
 *
devi˚
 = (©h6kl_usb *)
¨
->
hif_¥iv
;

1479 
usb_öãrÁ˚
 *
öãrÁ˚
 = 
devi˚
->interface;

1480 
	`usb_aut›m_put_öãrÁ˚_async
(
öãrÁ˚
);

1481 
¨
->
auto_pm_˙t
--;

1482 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "autopm -1Ñefcnt=%d my=%d\n",

1483 
	`usb_debugfs_gë_pm_ußge_˙t
(
¨
),ár->
auto_pm_˙t
);

1485 
	}
}

1487 
	$usb_auto_pm_tu∫off
(
©h6kl
 *
¨
)

1489 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1490 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_USB_AUTO_PM
))

1491 
	`usb_dißbÀ_autosu•íd
(
devi˚
->
udev
);

1492 
	}
}

1494 
	$usb_auto_pm_tu∫⁄
(
©h6kl
 *
¨
)

1496 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1497 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_USB_AUTO_PM
))

1498 
	`usb_íabÀ_autosu•íd
(
devi˚
->
udev
);

1499 
	}
}

1502 
	$©h6kl_auto_pm_wakeup_ªsume
(
©h6kl
 *
wk
)

1504 
sk_buff
 *
buf
;

1505 
°©us
 = 0;

1506 
©h6kl_usb
 *
devi˚
;

1507 
©h6kl_usb_pùe
 *
pùe
;

1508 
©h6kl_usb_pùe_°©
 *
pùe_°
;

1509 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
;

1510 
u8
 *
d©a
;

1511 
u32
 
Àn
;

1512 
urb
 *urb;

1513 
usb_°©us
;

1514 
usb_pm_skb_queue_t
 *
íåy
, *
p_usb_pm_skb_queue
;

1515 
©h6kl
 *
pm_¨
;

1516 
pm_PùeID
;

1518 
pm_¨
 = 
wk
;

1519 
p_usb_pm_skb_queue
 = &
pm_¨
->
usb_pm_skb_queue
;

1522 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "%sÑesume_wk qeue %dÉmpty=%d\n",

1523 
__func__
,

1524 
	`gë_queue_dïth
(&(
p_usb_pm_skb_queue
->
li°
)),

1525 
	`li°_em±y
(&
p_usb_pm_skb_queue
->
li°
));

1527 
	`gë_queue_dïth
(&(
p_usb_pm_skb_queue
->
li°
)) > 0) {

1528 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "%†Ñesume_wk qeuê%d\n", 
__func__
,

1529 
	`gë_queue_dïth
(&(
p_usb_pm_skb_queue
->
li°
)));

1530 
íåy
 = 
	`li°_fú°_íåy
(&
p_usb_pm_skb_queue
->
li°
,

1531 
usb_pm_skb_queue_t
, 
li°
);

1533 
pm_PùeID
 = 
íåy
->
pùeID
;

1534 
pm_¨
 = 
íåy
->
¨
;

1535 
buf
 = 
íåy
->
skb
;

1537 
devi˚
 = 
	`©h6kl_usb_¥iv
(
pm_¨
);

1538 
pùe
 = &
devi˚
->
pùes
[
pm_PùeID
];

1539 
pùe_°
 = &
pùe
->
usb_pùe_°©
;

1541 
	`usb_m¨k_œ°_busy
(
devi˚
->
udev
);

1543 
urb_c⁄ãxt
 = 
	`©h6kl_usb_Æloc_urb_‰om_pùe
(
pùe
);

1545 i‡(
urb_c⁄ãxt
 =
NULL
) {

1546 
pùe_°
->
num_tx_îr_Ÿhîs
++;

1551 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1553 
__func__
, 
pm_PùeID
, 
pùe
->
urb_˙t
);

1554 
°©us
 = -
ENOMEM
;

1555 
Áû_hif_£nd_usb
;

1557 
urb_c⁄ãxt
->
buf
 = buf;

1559 
d©a
 = 
buf
->data;

1560 
Àn
 = 
buf
->len;

1561 
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_ATOMIC
);

1562 i‡(
urb
 =
NULL
) {

1563 
pùe_°
->
num_tx_îr_Ÿhîs
++;

1564 
°©us
 = -
ENOMEM
;

1565 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
,

1566 
urb_c⁄ãxt
);

1567 
Áû_hif_£nd_usb
;

1570 
	`usb_fûl_bulk_urb
(
urb
,

1571 
devi˚
->
udev
,

1572 
pùe
->
usb_pùe_h™dÀ
,

1573 
d©a
,

1574 
Àn
,

1575 
©h6kl_usb_usb_å™smô_com∂ëe
,

1576 
urb_c⁄ãxt
);

1578 i‡((
Àn
 % 
pùe
->
max_∑ckë_size
) == 0) {

1580 
urb
->
å™s„r_Êags
 |
URB_ZERO_PACKET
;

1583 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1585 
pùe
->
logiˇl_pùe_num
,Öùe->
usb_pùe_h™dÀ
,

1586 
pùe
->
ï_addªss
, 
Àn
);

1588 
	`usb_™ch‹_urb
(
urb
, &
pùe
->
urb_submôãd
);

1589 
	`li°_dñ
(&
íåy
->
li°
);

1592 
usb_°©us
 = 
	`usb_submô_urb
(
urb
, 
GFP_ATOMIC
);

1595 i‡(
usb_°©us
) {

1596 
pùe_°
->
num_tx_îr
++;

1597 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1599 
usb_°©us
);

1600 
	`usb_u«nch‹_urb
(
urb
);

1601 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
,

1602 
urb_c⁄ãxt
);

1603 
°©us
 = -
EINVAL
;

1605 
	`usb_‰ì_urb
(
urb
);

1606 
pùe_°
->
num_tx
++;

1608 
	`k‰ì
(
íåy
);

1611 
Áû_hif_£nd_usb
:

1612 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "wakeup_resume done\n");

1613 
	}
}

1619 
	$©h6kl_usb_£nd
(
©h6kl
 *
¨
, 
u8
 
PùeID
,

1620 
sk_buff
 *
hdr_buf
, sk_buf‡*
buf
)

1622 
°©us
 = 0;

1623 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1624 
©h6kl_usb_pùe
 *
pùe
 = &
devi˚
->
pùes
[
PùeID
];

1625 
©h6kl_usb_pùe_°©
 *
pùe_°
 = &
pùe
->
usb_pùe_°©
;

1626 
©h6kl_urb_c⁄ãxt
 *
urb_c⁄ãxt
;

1627 
u8
 *
d©a
;

1628 
u32
 
Àn
;

1629 
urb
 *urb;

1630 
usb_°©us
;

1631 #ifde‡
USB_AUTO_SUSPEND


1632 
usb_pm_skb_queue_t
 *
p_pmskb
;

1633 
qÀn
, 
usb_pm_ö¸ómít
;

1634 
usb_pm_skb_queue_t
 *
p_usb_pm_skb_queue
 = &
¨
->
usb_pm_skb_queue
;

1636 #ifde‡
USB_AUTO_SUSPEND


1638 #ñi‡
	`deföed
(
CONFIG_ANDROID
)

1639 
usb_öãrÁ˚
 *
öãrÁ˚
 = 
devi˚
->interface;

1642 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1644 
__func__
, 
PùeID
, 
buf
, 
¨
->
°©e
);

1646 #ifde‡
USB_AUTO_SUSPEND


1647 i‡(
¨
->
°©e
 =
ATH6KL_STATE_PRE_SUSPEND_DEEPSLEEP
) {

1648 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "%s: deep sleep state=%d\n",

1649 
__func__
, 
¨
->
°©e
);

1650 
°©us
 = -
ETXTBSY
;

1651 
pùe_°
->
num_tx
++;

1652  
°©us
;

1655 
usb_pm_ö¸ómít
 = 0;

1656 i‡(
¨
->
°©e
 !
ATH6KL_STATE_PRE_SUSPEND
) {

1657 
usb_pm_ö¸ómít
++;

1658 
	`usb_auto_pm_dißbÀ
(
¨
);

1661 
	`•ö_lock_bh
(&
¨
->
usb_pm_lock
);

1662 i‡(!
	`li°_em±y
(&
p_usb_pm_skb_queue
->
li°
) ||

1663 (
¨
->
°©e
 =
ATH6KL_STATE_WOW
) ||

1664 (
¨
->
°©e
 =
ATH6KL_STATE_DEEPSLEEP
)) {

1666 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "usb_send sleep Q %d queueÜen =%d\n",

1667 
¨
->
°©e
,

1668 
	`gë_queue_dïth
(&(
p_usb_pm_skb_queue
->
li°
)));

1669 
p_pmskb
 = 
	`kmÆloc
((
usb_pm_skb_queue_t
),

1670 
GFP_ATOMIC
);

1671 i‡(
p_pmskb
 =
NULL
)

1672 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "p_pmskb = kmalloc fila\n");

1674 
p_pmskb
->
pùeID
 = 
PùeID
;

1675 
p_pmskb
->
¨
 =ár;

1676 
p_pmskb
->
skb
 = 
buf
;

1678 
	`li°_add_èû
(&(
p_pmskb
->
li°
), &(
p_usb_pm_skb_queue
->list));

1679 
qÀn
 = 
	`gë_queue_dïth
(&(
p_usb_pm_skb_queue
->
li°
));

1680 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "qÀ¿%d\n", 
qÀn
);

1686 
	`•ö_u∆ock_bh
(&
¨
->
usb_pm_lock
);

1688 i‡(
usb_pm_ö¸ómít
 != 0)

1689 
	`usb_auto_pm_íabÀ
(
¨
);

1693 
	`•ö_u∆ock_bh
(&
¨
->
usb_pm_lock
);

1694 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "usb_send 2\n");

1696 #ñi‡
	`deföed
(
CONFIG_ANDROID
)

1697 i‡(
PùeID
 !
ATH6KL_USB_PIPE_TX_CTRL
)

1698 
	`usb_aut›m_gë_öãrÁ˚_async
(
öãrÁ˚
);

1700 
urb_c⁄ãxt
 = 
	`©h6kl_usb_Æloc_urb_‰om_pùe
(
pùe
);

1702 i‡(
urb_c⁄ãxt
 =
NULL
) {

1703 
pùe_°
->
num_tx_îr_Ÿhîs
++;

1708 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1710 
__func__
, 
PùeID
, 
pùe
->
urb_˙t
);

1711 
°©us
 = -
ENOMEM
;

1712 
Áû_hif_£nd
;

1714 
urb_c⁄ãxt
->
buf
 = buf;

1716 
d©a
 = 
buf
->data;

1717 
Àn
 = 
buf
->len;

1718 
urb
 = 
	`usb_Æloc_urb
(0, 
GFP_ATOMIC
);

1719 i‡(
urb
 =
NULL
) {

1720 
pùe_°
->
num_tx_îr_Ÿhîs
++;

1721 
°©us
 = -
ENOMEM
;

1722 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
,

1723 
urb_c⁄ãxt
);

1724 
Áû_hif_£nd
;

1727 
	`usb_fûl_bulk_urb
(
urb
,

1728 
devi˚
->
udev
,

1729 
pùe
->
usb_pùe_h™dÀ
,

1730 
d©a
,

1731 
Àn
,

1732 
©h6kl_usb_usb_å™smô_com∂ëe
, 
urb_c⁄ãxt
);

1734 i‡((
Àn
 % 
pùe
->
max_∑ckë_size
) == 0) {

1736 
urb
->
å™s„r_Êags
 |
URB_ZERO_PACKET
;

1739 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1741 
pùe
->
logiˇl_pùe_num
,Öùe->
usb_pùe_h™dÀ
,

1742 
pùe
->
ï_addªss
, 
Àn
);

1744 
	`usb_™ch‹_urb
(
urb
, &
pùe
->
urb_submôãd
);

1746 
	`•ö_lock_bh
(&
¨
->
°©e_lock
);

1747 #i‚de‡
USB_AUTO_SUSPEND


1748 i‡((
¨
->
°©e
 =
ATH6KL_STATE_DEEPSLEEP
) ||

1749 (
¨
->
°©e
 =
ATH6KL_STATE_WOW
))

1750 
usb_°©us
 = -
EINVAL
;

1753 
usb_°©us
 = 
	`usb_submô_urb
(
urb
, 
GFP_ATOMIC
);

1754 
	`•ö_u∆ock_bh
(&
¨
->
°©e_lock
);

1756 i‡(
usb_°©us
) {

1757 
pùe_°
->
num_tx_îr
++;

1758 
	`©h6kl_dbg
(
ATH6KL_DBG_USB_BULK
,

1760 
usb_°©us
);

1761 
	`usb_u«nch‹_urb
(
urb
);

1762 
	`©h6kl_usb_‰ì_urb_to_pùe
(
urb_c⁄ãxt
->
pùe
,

1763 
urb_c⁄ãxt
);

1764 
°©us
 = -
EINVAL
;

1766 
	`usb_‰ì_urb
(
urb
);

1767 
pùe_°
->
num_tx
++;

1769 
Áû_hif_£nd
:

1771 #ifde‡
USB_AUTO_SUSPEND


1772 i‡(
usb_pm_ö¸ómít
 != 0)

1773 
	`usb_auto_pm_íabÀ
(
¨
);

1775 #ñi‡
	`deföed
(
CONFIG_ANDROID
)

1776 i‡(
PùeID
 !
ATH6KL_USB_PIPE_TX_CTRL
)

1777 
	`usb_aut›m_put_öãrÁ˚_async
(
öãrÁ˚
);

1779  
°©us
;

1780 
	}
}

1782 
	$hif_°›
(
©h6kl
 *
¨
)

1784 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1786 
	`©h6kl_usb_Êush_Æl
(
devi˚
);

1787 
	}
}

1789 
	$©h6kl_usb_gë_deÁu…_pùe
(
©h6kl
 *
¨
,

1790 
u8
 *
ul_pùe
, u8 *
dl_pùe
)

1792 *
ul_pùe
 = 
ATH6KL_USB_PIPE_TX_CTRL
;

1793 *
dl_pùe
 = 
ATH6KL_USB_PIPE_RX_CTRL
;

1794 
	}
}

1796 
	$©h6kl_usb_m≠_£rvi˚_pùe
(
©h6kl
 *
¨
, 
u16
 
svcId
, 
u8
 *
ULPùe
,

1797 
u8
 *
DLPùe
)

1799 
°©us
 = 0;

1801 
svcId
) {

1802 
HTC_CTRL_RSVD_SVC
:

1803 
WMI_CONTROL_SVC
:

1804 *
ULPùe
 = 
ATH6KL_USB_PIPE_TX_CTRL
;

1805 *
DLPùe
 = 
ATH6KL_USB_PIPE_RX_DATA
;

1807 
WMI_DATA_BE_SVC
:

1808 
WMI_DATA_BK_SVC
:

1809 *
ULPùe
 = 
ATH6KL_USB_PIPE_TX_DATA_LP
;

1810 *
DLPùe
 = 
ATH6KL_USB_PIPE_RX_DATA
;

1812 
WMI_DATA_VI_SVC
:

1813 *
ULPùe
 = 
ATH6KL_USB_PIPE_TX_DATA_LP
;

1814 *
DLPùe
 = 
ATH6KL_USB_PIPE_RX_DATA
;

1816 
WMI_DATA_VO_SVC
:

1817 *
ULPùe
 = 
ATH6KL_USB_PIPE_TX_DATA_LP
;

1818 *
DLPùe
 = 
ATH6KL_USB_PIPE_RX_DATA
;

1821 
°©us
 = -
EPERM
;

1825  
°©us
;

1826 
	}
}

1828 
	$©h6kl_usb_ªgi°î_ˇŒback
(
©h6kl
 *
¨
,

1829 *
unu£d
,

1830 
©h6kl_hif_pùe_ˇŒbacks
 *
ˇŒbacks
)

1832 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1834 
	`mem˝y
(&
devi˚
->
htc_ˇŒbacks
, 
ˇŒbacks
,

1835 (
©h6kl_hif_pùe_ˇŒbacks
));

1836 
	}
}

1838 
u16
 
	$©h6kl_usb_gë_‰ì_queue_numbî
(
©h6kl
 *
¨
, 
u8
 
PùeID
)

1840 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1841  
devi˚
->
pùes
[
PùeID
].
urb_˙t
;

1842 
	}
}

1844 
u16
 
	$©h6kl_usb_gë_max_queue_numbî
(
©h6kl
 *
¨
, 
u8
 
PùeID
)

1846 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1847  
devi˚
->
pùes
[
PùeID
].
urb_Æloc
;

1848 
	}
}

1850 
	$hif_dëach_htc
(
©h6kl
 *
¨
)

1852 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

1854 
	`©h6kl_usb_Êush_Æl
(
devi˚
);

1856 
	`mem£t
(&
devi˚
->
htc_ˇŒbacks
, 0,

1857 (
©h6kl_hif_pùe_ˇŒbacks
));

1858 
	}
}

1860 
	$©h6kl_usb_submô_˘æ_out
(
©h6kl_usb
 *
¨_usb
,

1861 
u8
 
ªq
, 
u16
 
vÆue
, u16 
ödex
, *
d©a
,

1862 
u32
 
size
)

1864 
u8
 *
buf
 = 
NULL
;

1865 
ªt
;

1867 i‡(
size
 > 0) {

1868 
buf
 = 
	`kmÆloc
(
size
, 
GFP_KERNEL
);

1869 i‡(
buf
 =
NULL
)

1870  -
ENOMEM
;

1872 
	`mem˝y
(
buf
, 
d©a
, 
size
);

1876 
ªt
 = 
	`usb_c⁄åﬁ_msg
(
¨_usb
->
udev
,

1877 
	`usb_¢d˘æpùe
(
¨_usb
->
udev
, 0),

1878 
ªq
,

1879 
USB_DIR_OUT
 | 
USB_TYPE_VENDOR
 |

1880 
USB_RECIP_DEVICE
, 
vÆue
, 
ödex
, 
buf
,

1881 
size
, 1000);

1883 i‡(
ªt
 < 0) {

1884 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "%s failed,result = %d\n",

1885 
__func__
, 
ªt
);

1888 
	`k‰ì
(
buf
);

1891 
	}
}

1893 
	$©h6kl_usb_submô_˘æ_ö
(
©h6kl_usb
 *
¨_usb
,

1894 
u8
 
ªq
, 
u16
 
vÆue
, u16 
ödex
, *
d©a
,

1895 
u32
 
size
)

1897 
u8
 *
buf
 = 
NULL
;

1898 
ªt
;

1900 i‡(
size
 > 0) {

1901 
buf
 = 
	`kmÆloc
(
size
, 
GFP_KERNEL
);

1902 i‡(
buf
 =
NULL
)

1903  -
ENOMEM
;

1907 
ªt
 = 
	`usb_c⁄åﬁ_msg
(
¨_usb
->
udev
,

1908 
	`usb_rcv˘æpùe
(
¨_usb
->
udev
, 0),

1909 
ªq
,

1910 
USB_DIR_IN
 | 
USB_TYPE_VENDOR
 |

1911 
USB_RECIP_DEVICE
, 
vÆue
, 
ödex
, 
buf
,

1912 
size
, 2 * 
HZ
);

1914 i‡(
ªt
 < 0) {

1915 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "%s failed,result = %d\n",

1916 
__func__
, 
ªt
);

1919 
	`mem˝y
((
u8
 *Ë
d©a
, 
buf
, 
size
);

1921 
	`k‰ì
(
buf
);

1924 
	}
}

1926 
	$©h6kl_usb_˘æ_msg_exch™ge
(
©h6kl_usb
 *
¨_usb
,

1927 
u8
 
ªq_vÆ
, u8 *
ªq_buf
, 
u32
 
ªq_Àn
,

1928 
u8
 
ª•_vÆ
, u8 *
ª•_buf
, 
u32
 *
ª•_Àn
)

1930 
ªt
;

1933 
ªt
 = 
	`©h6kl_usb_submô_˘æ_out
(
¨_usb
, 
ªq_vÆ
, 0, 0,

1934 
ªq_buf
, 
ªq_Àn
);

1936 i‡(
ªt
 != 0)

1937  
ªt
;

1939 i‡(
ª•_buf
 =
NULL
) {

1941  
ªt
;

1945 
ªt
 = 
	`©h6kl_usb_submô_˘æ_ö
(
¨_usb
, 
ª•_vÆ
, 0, 0,

1946 
ª•_buf
, *
ª•_Àn
);

1948  
ªt
;

1949 
	}
}

1951 
	$©h6kl_usb_düg_ªad32
(
©h6kl
 *
¨
, 
u32
 
addªss
, u32 *
d©a
)

1953 
©h6kl_usb
 *
¨_usb
 = 
¨
->
hif_¥iv
;

1954 
©h6kl_usb_˘æ_düg_ª•_ªad
 *
ª•
;

1955 
©h6kl_usb_˘æ_düg_cmd_ªad
 *
cmd
;

1956 
u32
 
ª•_Àn
;

1957 
ªt
;

1959 
cmd
 = (
©h6kl_usb_˘æ_düg_cmd_ªad
 *Ë
¨_usb
->
düg_cmd_buf„r
;

1961 
	`mem£t
(
cmd
, 0, (*cmd));

1962 
cmd
->cmd = 
ATH6KL_USB_CTRL_DIAG_CC_READ
;

1963 
cmd
->
addªss
 = 
	`˝u_to_À32
(address);

1964 
ª•_Àn
 = (*
ª•
);

1966 
ªt
 = 
	`©h6kl_usb_˘æ_msg_exch™ge
(
¨_usb
,

1967 
ATH6KL_USB_CONTROL_REQ_DIAG_CMD
,

1968 (
u8
 *Ë
cmd
,

1969 (
©h6kl_usb_˘æ_düg_cmd_wrôe
),

1970 
ATH6KL_USB_CONTROL_REQ_DIAG_RESP
,

1971 
¨_usb
->
düg_ª•_buf„r
, &
ª•_Àn
);

1973 i‡(
ªt
)

1974  
ªt
;

1976 
ª•
 = (
©h6kl_usb_˘æ_düg_ª•_ªad
 *)

1977 
¨_usb
->
düg_ª•_buf„r
;

1979 *
d©a
 = 
	`À32_to_˝u
(
ª•
->
vÆue
);

1981  
ªt
;

1982 
	}
}

1984 
	$©h6kl_usb_düg_wrôe32
(
©h6kl
 *
¨
, 
u32
 
addªss
, 
__À32
 
d©a
)

1986 
©h6kl_usb
 *
¨_usb
 = 
¨
->
hif_¥iv
;

1987 
©h6kl_usb_˘æ_düg_cmd_wrôe
 *
cmd
;

1989 
cmd
 = (
©h6kl_usb_˘æ_düg_cmd_wrôe
 *Ë
¨_usb
->
düg_cmd_buf„r
;

1991 
	`mem£t
(
cmd
, 0, (
©h6kl_usb_˘æ_düg_cmd_wrôe
));

1992 
cmd
->cmd = 
	`˝u_to_À32
(
ATH6KL_USB_CTRL_DIAG_CC_WRITE
);

1993 
cmd
->
addªss
 = 
	`˝u_to_À32
(address);

1994 
cmd
->
vÆue
 = 
d©a
;

1996  
	`©h6kl_usb_˘æ_msg_exch™ge
(
¨_usb
,

1997 
ATH6KL_USB_CONTROL_REQ_DIAG_CMD
,

1998 (
u8
 *Ë
cmd
,

1999 (*
cmd
),

2000 0, 
NULL
, NULL);

2002 
	}
}

2004 
	$©h6kl_usb_bmi_ªad
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
u32
 
Àn
)

2006 
©h6kl_usb
 *
¨_usb
 = 
¨
->
hif_¥iv
;

2007 
ªt
;

2010 
ªt
 = 
	`©h6kl_usb_submô_˘æ_ö
(
¨_usb
,

2011 
ATH6KL_USB_CONTROL_REQ_RECV_BMI_RESP
,

2012 0, 0, 
buf
, 
Àn
);

2013 i‡(
ªt
 != 0) {

2014 
	`©h6kl_îr
("UnableÅoÑeadÅhe bmi data fromÅhe device: %d\n",

2015 
ªt
);

2016  
ªt
;

2020 
	}
}

2022 
	$©h6kl_usb_bmi_wrôe
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
u32
 
Àn
)

2024 
©h6kl_usb
 *
¨_usb
 = 
¨
->
hif_¥iv
;

2025 
ªt
;

2028 
ªt
 = 
	`©h6kl_usb_submô_˘æ_out
(
¨_usb
,

2029 
ATH6KL_USB_CONTROL_REQ_SEND_BMI_CMD
,

2030 0, 0, 
buf
, 
Àn
);

2031 i‡(
ªt
 != 0) {

2032 
	`©h6kl_îr
("unableÅo sendÅhe bmi dataÅoÅhe device: %d\n",

2033 
ªt
);

2034  
ªt
;

2038 
	}
}

2040 
	$©h6kl_usb_powî_⁄
(
©h6kl
 *
¨
)

2042 i‡(
	`ã°_bô
(
USB_REMOTE_WKUP
, &
¨
->
Êag
)) {

2043 
©h6kl_usb
 *
¨_usb
 = (©h6kl_usb *)
¨
->
hif_¥iv
;

2044 
	`usb_ª£t_devi˚
(
¨_usb
->
udev
);

2047 
	`hif_°¨t
(
¨
);

2049 
	}
}

2051 
	$©h6kl_usb_powî_off
(
©h6kl
 *
¨
)

2053 
	`hif_dëach_htc
(
¨
);

2055 
	}
}

2057 
	$©h6kl_usb_°›
(
©h6kl
 *
¨
)

2059 
	`hif_°›
(
¨
);

2060 
	}
}

2062 
	$©h6kl_usb_pùe_°©
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
)

2064 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

2065 
©h6kl_usb_pùe_°©
 *
pùe_°
;

2066 
i
, 
Àn
 = 0;

2068 i‡((!
devi˚
Ë|| (!
buf
))

2071 
i
 = 0; i < 
ATH6KL_USB_PIPE_MAX
; i++) {

2072 i‡((
i
 =
ATH6KL_USB_PIPE_RX_INT
) ||

2073 (
i
 =
ATH6KL_USB_PIPE_RX_DATA2
))

2076 
pùe_°
 = &
devi˚
->
pùes
[
i
].
usb_pùe_°©
;

2078 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üí, "\nPIPE-%d\n", 
i
);

2079 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2081 
pùe_°
->
num_rx_comp
);

2082 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2084 
pùe_°
->
num_tx_comp
);

2085 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2087 
pùe_°
->
num_io_comp
);

2088 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2090 
pùe_°
->
num_max_tx
);

2091 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2093 
pùe_°
->
num_max_rx
);

2094 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2096 
pùe_°
->
num_tx_ªsche
);

2097 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2099 
pùe_°
->
num_rx_ªsche
);

2100 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2102 
pùe_°
->
num_tx_sync
);

2103 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2105 
pùe_°
->
num_tx
);

2106 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2108 
pùe_°
->
num_tx_îr
);

2109 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2111 
pùe_°
->
num_tx_îr_Ÿhîs
);

2112 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2114 
pùe_°
->
num_tx_comp_îr
);

2115 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2117 
pùe_°
->
num_rx_comp_îr
);

2120 i‡(
htc_bundÀ_ªcv
 || 
htc_bundÀ_£nd
) {

2121 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2123 
pùe_°
->
num_rx_bundÀ_comp
);

2124 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2126 
pùe_°
->
num_tx_bundÀ_comp
);

2127 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2129 
pùe_°
->
num_tx_mu…i
);

2130 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2132 
pùe_°
->
num_tx_mu…i_îr
);

2133 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2135 
pùe_°
->
num_tx_mu…i_îr_Ÿhîs
);

2136 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2138 
pùe_°
->
num_rx_bundÀ_comp_îr
);

2139 
Àn
 +
	`¢¥ötf
(
buf
 +Üí, 
buf_Àn
 -Üen,

2141 
pùe_°
->
num_tx_bundÀ_comp_îr
);

2145  
Àn
;

2146 
	}
}

2148 
	$©h6kl_usb_£t_max_sche
(
©h6kl
 *
¨
,

2149 
u32
 
max_sche_tx
, u32 
max_sche_rx
)

2151 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

2153 
devi˚
->
max_sche_tx
 = max_sche_tx;

2154 
devi˚
->
max_sche_rx
 = max_sche_rx;

2156 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "max_sche_tx = %d, max_sche_rx = %d\n",

2157 
devi˚
->
max_sche_tx
, devi˚->
max_sche_rx
);

2160 
	}
}

2162 
	$©h6kl_usb_su•íd
(
©h6kl
 *
¨
, 
cfg80211_wowœn
 *
wow
)

2164 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

2165 
usb_öãrÁ˚
 *
öãrÁ˚
 = 
devi˚
->interface;

2166 
pm_mesßge_t
 
mesßge
;

2167 
ªt
;

2169 
	`©h6kl_dbg
(
ATH6KL_DBG_EXT_INFO1
, "usb suspend\n");

2171 #ifde‡
CONFIG_ANDROID


2172 i‡(
	`©h6kl_™droid_√ed_wow_su•íd
(
¨
)) {

2174 i‡(
wow
) {

2176 
ªt
 = 
	`©h6kl_cfg80211_su•íd
(
¨
, 
ATH6KL_CFG_SUSPEND_WOW
, 
wow
);

2177 i‡(
ªt
)

2178  
ªt
;

2180 
	`mem£t
(&
mesßge
, 0, (message));

2181 
ªt
 = 
	`©h6kl_usb_pm_su•íd
(
öãrÁ˚
, 
mesßge
);

2184  
ªt
;

2185 
	}
}

2187 
	$©h6kl_usb_ªsume
(
©h6kl
 *
¨
)

2189 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

2190 
usb_öãrÁ˚
 *
öãrÁ˚
 = 
devi˚
->interface;

2192 
	`©h6kl_dbg
(
ATH6KL_DBG_EXT_INFO1
, "usbÑesume: sèã %d\n", 
¨
->
°©e
);

2194  
	`©h6kl_usb_pm_ªsume
(
öãrÁ˚
);

2195 
	}
}

2197 
	$©h6kl_usb_˛ónup_sˇâî
(
©h6kl
 *
¨
)

2199 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "InitÅarget fail?\n");

2201 
	}
}

2203 
	$©h6kl_usb_£t_rxq_thªshﬁd
(
©h6kl
 *
¨
, 
u32
 
rxq_thªshﬁd
)

2205 
©h6kl_usb
 *
¨_usb
 = 
	`©h6kl_usb_¥iv
(
¨
);

2207 
¨_usb
->
rxq_thªshﬁd
 =Ñxq_threshold;

2209 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
,

2210 "rxq_thªshﬁd = %d\n", 
¨_usb
->
rxq_thªshﬁd
);

2213 
	}
}

2215 #ifde‡
CONFIG_HAS_EARLYSUSPEND


2217 
	$©h6kl_usb_óæy_su•íd
(
©h6kl
 *
¨
)

2219 #i‚de‡
USB_AUTO_SUSPEND


2220 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

2222 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
,

2223 
ATH6KL_MODULE_DISABLE_USB_AUTO_SUSPEND
)) {

2224 i‡(
	`BOOTSTRAP_IS_HSIC
(
¨
->
boŸ°øp_mode
)) {

2225 
usb_devi˚
 *
udev
 = 
devi˚
->udev;

2226 
	`pm_ru¡ime_£t_autosu•íd_dñay
(&
udev
->
dev
, 2000);

2228 
	`usb_íabÀ_autosu•íd
(
devi˚
->
udev
);

2231 
	}
}

2233 
	$©h6kl_usb_œã_ªsume
(
©h6kl
 *
¨
)

2235 #i‚de‡
USB_AUTO_SUSPEND


2236 
©h6kl_usb
 *
devi˚
 = 
	`©h6kl_usb_¥iv
(
¨
);

2238 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
,

2239 
ATH6KL_MODULE_DISABLE_USB_AUTO_SUSPEND
))

2240 
	`usb_dißbÀ_autosu•íd
(
devi˚
->
udev
);

2242 
	}
}

2247 
	$©h6kl_usb_ªc⁄fig
(
©h6kl
 *
¨
)

2249 
ªt
 = 0;

2250 
u32
 
d©a
, 
addr
;

2257 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
,

2258 
ATH6KL_MODULE_ENABLE_USB_REMOTE_WKUP
)) {

2259 
ªt
 = 0;

2260 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
, "Disable USBÑemote wakeup.\n");

2262 i‡(
¨
->
vîsi⁄
.
èrgë_vî
 =
AR6004_HW_1_3_VERSION
)

2263 
addr
 = 0x409754;

2264 i‡(
¨
->
vîsi⁄
.
èrgë_vî
 =
AR6004_HW_1_2_VERSION
)

2265 
addr
 = 0x4087d4;

2266 i‡(
¨
->
vîsi⁄
.
èrgë_vî
 =
AR6004_HW_1_1_VERSION
)

2267 
addr
 = 0x408304;

2269 
addr
 = 0;

2271 i‡(
addr
) {

2272 
	`©h6kl_bmi_ªad
(
¨
, 
addr
, (
u8
 *)&
d©a
,

2274 
d©a
 |= (1<<29);

2275 
	`©h6kl_bmi_wrôe
(
¨
, 
addr
, (
u8
 *)&
d©a
,

2277 
ªt
 = 1;

2278 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

2281 
ªt
 = 0;

2282 
	`©h6kl_dbg
(
ATH6KL_DBG_BOOT
,

2287  
ªt
;

2288 
	}
}

2290 
	$©h6kl_usb_düg_w¨m_ª£t
(
©h6kl
 *
¨
)

2292 
©h6kl_usb
 *
¨_usb
 = 
¨
->
hif_¥iv
;

2293 
©h6kl_usb_˘æ_düg_cmd_wrôe
 *
cmd
;

2294 
u32
 
d©a
, 
addªss
;

2296 
addªss
 = 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_ª£t_Êag_vÆid
));

2297 
	`©h6kl_usb_düg_ªad32
(
¨
, 
addªss
, &
d©a
);

2299 #ifde‡
ATH6KL_BUS_VOTE


2300 i‡(
©h6kl_∂©f‹m_has_vªg
 == 0)

2301 
d©a
 = 0x12345678;

2303 
d©a
 = 0;

2305 
d©a
 |= 0x12345678;

2308 
	`©h6kl_usb_düg_wrôe32
(
¨
, 
addªss
, 
d©a
);

2310 
addªss
 = 
	`©h6kl_gë_hi_ôem_addr
(
¨
, 
	`HI_ITEM
(
hi_ª£t_Êag
));

2311 
	`©h6kl_usb_düg_ªad32
(
¨
, 
addªss
, &
d©a
);

2312 
d©a
 |= 0x20;

2313 
	`©h6kl_usb_düg_wrôe32
(
¨
, 
addªss
, 
d©a
);

2315 
cmd
 = (
©h6kl_usb_˘æ_düg_cmd_wrôe
 *)
¨_usb
->
düg_cmd_buf„r
;

2316 
	`mem£t
(
cmd
, 0, (
©h6kl_usb_˘æ_düg_cmd_wrôe
));

2317 
cmd
->cmd = 
	`˝u_to_À32
(
ATH6KL_USB_CTRL_DIAG_CC_WARM_RESET
);

2319  
	`©h6kl_usb_˘æ_msg_exch™ge
(
¨_usb
,

2320 
ATH6KL_USB_CONTROL_REQ_DIAG_CMD
,

2321 (
u8
 *Ë
cmd
,

2322 (*
cmd
),

2323 0, 
NULL
, NULL);

2324 
	}
}

2326 #ifde‡
ATH6KL_HSIC_RECOVER


2327 
	$©h6kl_ªcovî_w¨_w‹k
(
w‹k_°ru˘
 *
w‹k
)

2329 
	`©h6kl_öfo
("%†dÿHSICÑediscovîy\n", 
__func__
);

2330 
	`©h6kl_hsic_ªdiscovîy
();

2331 
	}
}

2333 
	$©h6kl_hsic_sw_ªcovî
(
©h6kl
 *
¨
)

2335 
©h6kl_usb
 *
¨_usb
 = 
¨
->
hif_¥iv
;

2336 
©h6kl_vif
 *
vif
;

2337 
√t_devi˚
 *
√tdev
;

2339 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

2341 
	`usb_dißbÀ_autosu•íd
(
¨_usb
->
udev
);

2343 
√tdev
 = 
vif
->
ndev
;

2344 #ifde‡
CE_OLD_KERNEL_SUPPORT_2_6_23


2345 
√tdev
->
	`°›
(netdev);

2347 
√tdev
->
√tdev_›s
->
	`ndo_°›
(netdev);

2350 
	`©h6kl_öfo
("%†scheduÀÑecovî w‹kîÅhªad\n", 
__func__
);

2351 
	`scheduÀ_w‹k
(&
ªcovî_w¨_w‹k
);

2353 
	}
}

2356 c⁄° 
©h6kl_hif_›s
 
	g©h6kl_usb_›s
 = {

2357 .
düg_ªad32
 = 
©h6kl_usb_düg_ªad32
,

2358 .
	gdüg_wrôe32
 = 
©h6kl_usb_düg_wrôe32
,

2359 .
	gbmi_ªad
 = 
©h6kl_usb_bmi_ªad
,

2360 .
	gbmi_wrôe
 = 
©h6kl_usb_bmi_wrôe
,

2361 .
	gpowî_⁄
 = 
©h6kl_usb_powî_⁄
,

2362 .
	gpowî_off
 = 
©h6kl_usb_powî_off
,

2363 .
	g°›
 = 
©h6kl_usb_°›
,

2364 .
	ggë_°©
 = 
©h6kl_usb_pùe_°©
,

2365 .
	gpùe_ªgi°î_ˇŒback
 = 
©h6kl_usb_ªgi°î_ˇŒback
,

2366 .
	gpùe_£nd
 = 
©h6kl_usb_£nd
,

2367 .
	gpùe_gë_deÁu…
 = 
©h6kl_usb_gë_deÁu…_pùe
,

2368 .
	gpùe_m≠_£rvi˚
 = 
©h6kl_usb_m≠_£rvi˚_pùe
,

2369 .
	gpùe_gë_‰ì_queue_numbî
 = 
©h6kl_usb_gë_‰ì_queue_numbî
,

2370 .
	gpùe_£nd_bundÀ
 = 
©h6kl_usb_£nd_bundÀ
,

2371 .
	gpùe_gë_max_queue_numbî
 = 
©h6kl_usb_gë_max_queue_numbî
,

2372 .
	gpùe_£t_max_sche
 = 
©h6kl_usb_£t_max_sche
,

2373 .
	gsu•íd
 = 
©h6kl_usb_su•íd
,

2374 .
	gªsume
 = 
©h6kl_usb_ªsume
,

2375 .
	g˛ónup_sˇâî
 = 
©h6kl_usb_˛ónup_sˇâî
,

2376 .
	gdüg_w¨m_ª£t
 = 
©h6kl_usb_düg_w¨m_ª£t
,

2377 #ifde‡
CONFIG_HAS_EARLYSUSPEND


2378 .
	góæy_su•íd
 = 
©h6kl_usb_óæy_su•íd
,

2379 .
	gœã_ªsume
 = 
©h6kl_usb_œã_ªsume
,

2381 .
	gbus_c⁄fig
 = 
©h6kl_usb_ªc⁄fig
,

2382 #ifde‡
USB_AUTO_SUSPEND


2383 .
	gauto_pm_dißbÀ
 = 
usb_auto_pm_dißbÀ
,

2384 .
	gauto_pm_íabÀ
 = 
usb_auto_pm_íabÀ
,

2385 .
	gauto_pm_tu∫⁄
 = 
usb_auto_pm_tu∫⁄
,

2386 .
	gauto_pm_tu∫off
 = 
usb_auto_pm_tu∫off
,

2387 .
	gauto_pm_gë_ußge_˙t
 = 
usb_debugfs_gë_pm_ußge_˙t
,

2389 .
	gpùe_£t_rxq_thªshﬁd
 = 
©h6kl_usb_£t_rxq_thªshﬁd
,

2390 #ifde‡
ATH6KL_HSIC_RECOVER


2391 .
	gsw_ªcovî
 = 
©h6kl_hsic_sw_ªcovî
,

2395 #ifde‡
ATHTST_SUPPORT


2396 
hif_¥odu˘_öfo_t
 
	gg_¥odu˘_öfo
;

2397 
	$©h6kl_usb_gë_usböfo
(*
¥odu˘_öfo
)

2399 
	`mem˝y
(
¥odu˘_öfo
, &
g_¥odu˘_öfo
, (g_product_info));

2401 
	}
}

2405 
	$©h6kl_usb_¥obe
(
usb_öãrÁ˚
 *
öãrÁ˚
,

2406 c⁄° 
usb_devi˚_id
 *
id
)

2408 
usb_devi˚
 *
dev
 = 
	`öãrÁ˚_to_usbdev
(
öãrÁ˚
);

2409 
©h6kl
 *
¨
;

2410 
©h6kl_usb
 *
¨_usb
 = 
NULL
;

2411 
víd‹_id
, 
¥odu˘_id
;

2412 
ªt
 = 0;

2414 
	`usb_gë_dev
(
dev
);

2416 
víd‹_id
 = 
	`À16_to_˝u
(
dev
->
des¸ùt‹
.
idVíd‹
);

2417 
¥odu˘_id
 = 
	`À16_to_˝u
(
dev
->
des¸ùt‹
.
idProdu˘
);

2419 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
 | 
ATH6KL_DBG_EXT_INFO1
,

2421 
víd‹_id
, 
¥odu˘_id
);

2423 #ifde‡
ATHTST_SUPPORT


2424 
g_¥odu˘_öfo
.
idVíd‹
 = 
víd‹_id
 =

2425 
	`À16_to_˝u
(
dev
->
des¸ùt‹
.
idVíd‹
);

2426 
g_¥odu˘_öfo
.
idProdu˘
 = 
¥odu˘_id
 =

2427 
	`À16_to_˝u
(
dev
->
des¸ùt‹
.
idProdu˘
);

2428 i‡(
dev
->
¥odu˘
)

2429 
	`mem˝y
(
g_¥odu˘_öfo
.
¥odu˘
, 
dev
->product,

2430 (
g_¥odu˘_öfo
.
¥odu˘
));

2431 i‡(
dev
->
m™uÁ˘uªr
)

2432 
	`mem˝y
(
g_¥odu˘_öfo
.
m™uÁ˘uªr
, 
dev
->manufacturer,

2433 (
g_¥odu˘_öfo
.
m™uÁ˘uªr
));

2434 i‡(
dev
->
£rül
)

2435 
	`mem˝y
(
g_¥odu˘_öfo
.
£rül
, 
dev
->serial,

2436 (
g_¥odu˘_öfo
.
£rül
));

2439 i‡(
öãrÁ˚
->
cur_Æt£âög
)

2440 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "USB Interface %d\n",

2441 
öãrÁ˚
->
cur_Æt£âög
->
desc
.
bI¡îÁ˚Numbî
);

2444 i‡(
dev
->
•ìd
 =
USB_SPEED_HIGH
)

2445 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "USB 2.0 Host\n");

2447 
	`©h6kl_dbg
(
ATH6KL_DBG_USB
, "USB 1.1 Host\n");

2449 
¨_usb
 = 
	`©h6kl_usb_¸óã
(
öãrÁ˚
);

2451 #ifde‡
ATH6KL_BUS_VOTE


2452 #ifde‡
CONFIG_ANDROID


2453 i‡(
©h6kl_bt_⁄
 =1 || 
©h6kl_∂©f‹m_has_vªg
 == 0)

2454 
	`usb_ª£t_devi˚
(
¨_usb
->
udev
);

2458 i‡(
¨_usb
 =
NULL
) {

2459 
	`©h6kl_îr
("FailedÅo create USB interface\n");

2460 
ªt
 = -
ENOMEM
;

2461 
îr_usb_put
;

2464 
¨
 = 
	`©h6kl_c‹e_Æloc
(&
¨_usb
->
udev
->
dev
);

2465 i‡(
¨
 =
NULL
) {

2466 
	`©h6kl_îr
("FailedÅoállocáth6kl core\n");

2467 
ªt
 = -
ENOMEM
;

2468 
îr_usb_de°roy
;

2471 
¨
->
hif_¥iv
 = 
¨_usb
;

2472 
¨
->
hif_ty≥
 = 
ATH6KL_HIF_TYPE_USB
;

2473 
¨
->
hif_›s
 = &
©h6kl_usb_›s
;

2474 
¨
->
mbox_öfo
.
block_size
 = 16;

2475 
¨
->
bmi
.
max_d©a_size
 = 252;

2477 
¨_usb
->
¨
 =ár;

2478 #ifde‡
CONFIG_ANDROID


2479 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_USB_AUTO_PM
))

2480 
	`usb_dißbÀ_autosu•íd
(
¨_usb
->
udev
);

2483 #ifde‡
USB_AUTO_SUSPEND


2484 
	`•ö_lock_öô
(&
¨
->
usb_pm_lock
);

2485 
	`INIT_LIST_HEAD
(&
¨
->
usb_pm_skb_queue
.
li°
);

2486 
	`pm_ru¡ime_£t_autosu•íd_dñay
(&
dev
->dev, 2000);

2487 i‡(!
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_DISABLE_USB_AUTO_PM
) &&

2488 !(
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_TESTMODE_ENABLE
) ||

2489 
	`©h6kl_mod_debug_quúks
(
¨
, 
ATH6KL_MODULE_ENABLE_EPPING
))) {

2490 
	`usb_íabÀ_autosu•íd
(
dev
);

2492 
¨
->
auto_pm_˙t
 = 0;

2494 
	`©h6kl_htc_pùe_©èch
(
¨
);

2495 
ªt
 = 
	`©h6kl_c‹e_öô
(
¨
);

2496 i‡(
ªt
) {

2497 
	`©h6kl_îr
("FaûedÅÿöôáth6k»c‹e: %d\n", 
ªt
);

2498 
îr_c‹e_‰ì
;

2501 i‡(
¨
->
vîsi⁄
.
èrgë_vî
 =
AR6004_HW_1_3_VERSION
) {

2505 
	`©h6kl_usb_‰ì_pùe_ªsour˚s
(

2506 &
¨_usb
->
pùes
[
ATH6KL_USB_PIPE_TX_DATA_LP
]);

2507 i‡(
	`©h6kl_usb_Æloc_pùe_ªsour˚s
(

2508 &
¨_usb
->
pùes
[
ATH6KL_USB_PIPE_TX_DATA_LP
],

2509 
TX_URB_COUNT_LARGE
) != 0) {

2510 
	`©h6kl_usb_de°roy
(
¨_usb
);

2511 
¨_usb
 = 
NULL
;

2512 
ªt
 = -
ENOMEM
;

2513 
îr_usb_put
;

2517 #ifde‡
ATH6KL_HSIC_RECOVER


2519 
	`INIT_WORK
(&
ªcovî_w¨_w‹k
,

2520 
©h6kl_ªcovî_w¨_w‹k
);

2523 #ifde‡
ATH6KL_BUS_VOTE


2524 
	`up
(&
usb_¥obe_£m
);

2527  
ªt
;

2529 
îr_c‹e_‰ì
:

2530 
	`©h6kl_c‹e_‰ì
(
¨
);

2531 
îr_usb_de°roy
:

2532 
	`©h6kl_usb_de°roy
(
¨_usb
);

2533 
îr_usb_put
:

2534 
	`usb_put_dev
(
dev
);

2536 #ifde‡
ATH6KL_BUS_VOTE


2537 
	`up
(&
usb_¥obe_£m
);

2540  
ªt
;

2541 
	}
}

2543 
	$©h6kl_usb_ªmove
(
usb_öãrÁ˚
 *
öãrÁ˚
)

2545 
	`©h6kl_dbg
(
ATH6KL_DBG_EXT_INFO1
, "usb cardÑemoved\n");

2547 
	`usb_put_dev
(
	`öãrÁ˚_to_usbdev
(
öãrÁ˚
));

2548 
	`©h6kl_usb_devi˚_dëached
(
öãrÁ˚
);

2549 
	}
}

2551 #ifde‡
CONFIG_PM


2553 #ifde‡
CONFIG_ANDROID


2554 
	$©h6kl_usb_pm_su•íd
(
usb_öãrÁ˚
 *
öãrÁ˚
,

2555 
pm_mesßge_t
 
mesßge
)

2557 
©h6kl_usb
 *
devi˚
;

2558 
©h6kl
 *
¨
;

2559 
©h6kl_vif
 *
vif
;

2560 
ªt
;

2562 
devi˚
 = (
©h6kl_usb
 *)
	`usb_gë_ötfd©a
(
öãrÁ˚
);

2563 
¨
 = 
devi˚
->ar;

2565 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

2567 i‡(
	`©h6kl_™droid_√ed_wow_su•íd
(
¨
))

2568 
ªt
 = 
	`©h6kl_cfg80211_su•íd
(
¨
, 
ATH6KL_CFG_SUSPEND_WOW
, 
NULL
);

2570 
ªt
 = 
	`©h6kl_cfg80211_su•íd
(
¨
, 
ATH6KL_CFG_SUSPEND_DEEPSLEEP
,

2571 
NULL
);

2572 i‡(
ªt
 == 0)

2573 
	`©h6kl_usb_Êush_Æl
(
devi˚
);

2575  
ªt
;

2576 
	}
}

2578 
	$©h6kl_usb_pm_su•íd
(
usb_öãrÁ˚
 *
öãrÁ˚
,

2579 
pm_mesßge_t
 
mesßge
)

2581 
©h6kl_usb
 *
devi˚
;

2582 
©h6kl
 *
¨
;

2583 #ifde‡
USB_AUTO_SUSPEND


2584 
ªt
;

2586 
devi˚
 = (
©h6kl_usb
 *)
	`usb_gë_ötfd©a
(
öãrÁ˚
);

2587 
¨
 = 
devi˚
->ar;

2589 #ifde‡
USB_AUTO_SUSPEND


2591 i‡(
	`©h6kl_™droid_√ed_wow_su•íd
(
¨
))

2592 
ªt
 = 
	`©h6kl_cfg80211_su•íd
(
¨
, 
ATH6KL_CFG_SUSPEND_WOW
, 
NULL
);

2594 
ªt
 = 
	`©h6kl_cfg80211_su•íd
(
¨
, 
ATH6KL_CFG_SUSPEND_DEEPSLEEP
,

2595 
NULL
);

2599 i‡(
¨
->
°©e
 !
ATH6KL_STATE_WOW
)

2600 
	`©h6kl_cfg80211_su•íd
(
¨
, 
ATH6KL_CFG_SUSPEND_DEEPSLEEP
, 
NULL
);

2603 
	`©h6kl_usb_Êush_Æl
(
devi˚
);

2605 
	}
}

2609 
	$©h6kl_usb_pm_ªsume
(
usb_öãrÁ˚
 *
öãrÁ˚
)

2611 
©h6kl_usb
 *
devi˚
;

2612 
©h6kl
 *
¨
;

2614 
devi˚
 = (
©h6kl_usb
 *)
	`usb_gë_ötfd©a
(
öãrÁ˚
);

2615 
¨
 = 
devi˚
->ar;

2619 
	`©h6kl_usb_po°_ªcv_å™s„rs
(

2620 &
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_CTRL
],

2621 
ATH6KL_USB_RX_BUFFER_SIZE
);

2623 i‡(!
htc_bundÀ_ªcv
) {

2624 
	`©h6kl_usb_po°_ªcv_å™s„rs
(

2625 &
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA
],

2626 
ATH6KL_USB_RX_BUFFER_SIZE
);

2628 
	`hif_usb_po°_ªcv_bundÀ_å™s„rs
(

2629 &
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA
],

2632 
	`hif_usb_po°_ªcv_bundÀ_å™s„rs
(

2633 &
devi˚
->
pùes
[
ATH6KL_USB_PIPE_RX_DATA2
],

2638 
	`©h6kl_cfg80211_ªsume
(
¨
);

2641 
	}
}

2643 
	$©h6kl_usb_pm_ª£t_ªsume
(
usb_öãrÁ˚
 *
ötf
)

2645 
©h6kl_usb
 *
devi˚
;

2646 
©h6kl
 *
¨
;

2648 
devi˚
 = (
©h6kl_usb
 *)
	`usb_gë_ötfd©a
(
ötf
);

2649 
¨
 = 
devi˚
->ar;

2654 i‡(
	`BOOTSTRAP_IS_HSIC
(
¨
->
boŸ°øp_mode
)) {

2655 
	`©h6kl_öfo
("ath6kl_usb_pm_reset_resume\n");

2656 
	`©h6kl_usb_pm_ªsume
(
ötf
);

2658 i‡(
	`usb_gë_ötfd©a
(
ötf
))

2659 
	`©h6kl_usb_ªmove
(
ötf
);

2662 
	}
}

2666 
usb_devi˚_id
 
	g©h6kl_usb_ids
[] = {

2667 {
USB_DEVICE
(0x0cf3, 0x9375)},

2668 {
USB_DEVICE
(0x0cf3, 0x9374)},

2669 {
USB_DEVICE
(0x0cf3, 0x9372)},

2673 
MODULE_DEVICE_TABLE
(
usb
, 
©h6kl_usb_ids
);

2675 
usb_drivî
 
	g©h6kl_usb_drivî
 = {

2676 .
«me
 = "ath6kl_usb",

2677 .
	g¥obe
 = 
©h6kl_usb_¥obe
,

2678 #ifde‡
CONFIG_PM


2679 .
	gsu•íd
 = 
©h6kl_usb_pm_su•íd
,

2680 .
	gªsume
 = 
©h6kl_usb_pm_ªsume
,

2681 .
	gª£t_ªsume
 = 
©h6kl_usb_pm_ª£t_ªsume
,

2683 .
	gdisc⁄√˘
 = 
©h6kl_usb_ªmove
,

2684 .
	gid_èbÀ
 = 
©h6kl_usb_ids
,

2685 .
	gsuµ‹ts_autosu•íd
 = 
åue
,

2688 #ifde‡
CONFIG_ANDROID


2689 
	$©h6kl_usb_dev_nŸify
(
nŸifõr_block
 *
nb
,

2690 
a˘i⁄
, *
dev
)

2692 
usb_devi˚
 *
udev
;

2693 
ªt
 = 
NOTIFY_DONE
;

2695 i‡(
a˘i⁄
 !
USB_DEVICE_REMOVE
)

2696 
d⁄e
;

2698 
udev
 = (
usb_devi˚
 *Ë
dev
;

2699 i‡(
©h6kl_usb_u∆ﬂd_dev_num
 !
udev
->
devnum
)

2700 
d⁄e
;

2702 i‡(
	`©omic_ªad
(&
©h6kl_usb_u∆ﬂd_°©e
) ==

2703 
ATH6KL_USB_UNLOAD_STATE_TARGET_RESET
) {

2704 
	`©omic_£t
(&
©h6kl_usb_u∆ﬂd_°©e
,

2705 
ATH6KL_USB_UNLOAD_STATE_DEV_DISCONNECTED
);

2706 
	`wake_up
(&
©h6kl_usb_u∆ﬂd_evít_wq
);

2709 
d⁄e
:

2710  
ªt
;

2711 
	}
}

2713 
nŸifõr_block
 
	g©h6kl_usb_dev_nb
 = {

2714 .
nŸifõr_ˇŒ
 = 
©h6kl_usb_dev_nŸify
,

2717 
	$©h6kl_usb_öô
()

2719 
	`öô_waôqueue_hód
(&
©h6kl_usb_u∆ﬂd_evít_wq
);

2720 
	`©omic_£t
(&
©h6kl_usb_u∆ﬂd_°©e
, 
ATH6KL_USB_UNLOAD_STATE_NULL
);

2721 
	`usb_ªgi°î_nŸify
(&
©h6kl_usb_dev_nb
);

2723 #ifde‡
ATH6KL_BUS_VOTE


2724 
	`£ma_öô
(&
usb_¥obe_£m
, 1);

2725 
	`down
(&
usb_¥obe_£m
);

2728 
	`usb_ªgi°î
(&
©h6kl_usb_drivî
);

2730 #ifde‡
ATH6KL_BUS_VOTE


2731 #ifde‡
CONFIG_ANDROID


2732 i‡(
	`machöe_is_≠q8064_dma
(Ë|| 
	`machöe_is_≠q8064_buñÀr
()) {

2733 
©h6kl_∂©f‹m_has_vªg
 = 1;

2734 
	`©h6kl_hsic_böd
(1);

2738 i‡(
	`©h6kl_hsic_öô_msm
(&
©h6kl_∂©f‹m_has_vªg
) != 0)

2739 
	`©h6kl_îr
("%†©h6kl_hsic_öô_msm faûed\n", 
__func__
);

2741 i‡(
©h6kl_∂©f‹m_has_vªg
) {

2743 i‡(
	`down_timeout
(&
usb_¥obe_£m
,

2744 
	`m£cs_to_jiffõs
(
USB_PROBE_WAIT_TIMEOUT
)) != 0) {

2745 
	`©h6kl_öfo
("can't wait for usbÖrobe done\n");

2751 
	}
}

2753 
	$©h6kl_usb_exô
()

2755 
timñe·
 = 0;

2756 
	`©omic_£t
(&
©h6kl_usb_u∆ﬂd_°©e
, 
ATH6KL_USB_UNLOAD_STATE_DRV_DEREG
);

2757 
	`usb_dîegi°î
(&
©h6kl_usb_drivî
);

2759 i‡(
	`©omic_ªad
(&
©h6kl_usb_u∆ﬂd_°©e
) !=

2760 
ATH6KL_USB_UNLOAD_STATE_TARGET_RESET
)

2761 
föish
;

2763 
timñe·
 = 
	`waô_evít_öãºu±ibÀ_timeout
(
©h6kl_usb_u∆ﬂd_evít_wq
,

2764 
	`©omic_ªad
(&
©h6kl_usb_u∆ﬂd_°©e
) ==

2765 
ATH6KL_USB_UNLOAD_STATE_DEV_DISCONNECTED
,

2766 
ATH6KL_USB_UNLOAD_TIMEOUT
);

2768 
föish
:

2769 
	`usb_uƒegi°î_nŸify
(&
©h6kl_usb_dev_nb
);

2770 #ifde‡
ATH6KL_BUS_VOTE


2771 
	`©h6kl_hsic_exô_msm
();

2774 #ifde‡
ATH6KL_BUS_VOTE


2775 i‡(
	`machöe_is_≠q8064_dma
(Ë|| 
	`machöe_is_≠q8064_buñÀr
())

2776 
	`©h6kl_hsic_böd
(0);

2779 
	}
}

2781 
	$©h6kl_usb_öô
()

2783 
	`usb_ªgi°î
(&
©h6kl_usb_drivî
);

2785 
	}
}

2787 
	$©h6kl_usb_exô
()

2789 
	`usb_dîegi°î
(&
©h6kl_usb_drivî
);

2790 
	}
}

2793 
moduÀ_öô
(
©h6kl_usb_öô
);

2794 
moduÀ_exô
(
©h6kl_usb_exô
);

2796 
MODULE_AUTHOR
("Atheros Communications, Inc.");

2797 
MODULE_DESCRIPTION
("Driver support for Atheros AR600x USB devices");

2798 
MODULE_LICENSE
("Dual BSD/GPL");

2799 
MODULE_VERSION
(
DRV_VERSION
);

2800 
MODULE_FIRMWARE
(
AR6004_HW_1_0_FW_DIR
 "/" 
AR6004_HW_1_0_FIRMWARE_FILE
);

2801 
MODULE_FIRMWARE
(
AR6004_HW_1_0_BOARD_DATA_FILE
);

2802 
MODULE_FIRMWARE
(
AR6004_HW_1_0_DEFAULT_BOARD_DATA_FILE
);

2803 
MODULE_FIRMWARE
(
AR6004_HW_1_1_FW_DIR
 "/" 
AR6004_HW_1_1_FIRMWARE_FILE
);

2804 
MODULE_FIRMWARE
(
AR6004_HW_1_1_BOARD_DATA_FILE
);

2805 
MODULE_FIRMWARE
(
AR6004_HW_1_1_DEFAULT_BOARD_DATA_FILE
);

2806 
MODULE_FIRMWARE
(
AR6004_HW_1_2_FW_DIR
 "/" 
AR6004_HW_1_2_FIRMWARE_FILE
);

2807 
MODULE_FIRMWARE
(
AR6004_HW_1_2_BOARD_DATA_FILE
);

2808 
MODULE_FIRMWARE
(
AR6004_HW_1_2_DEFAULT_BOARD_DATA_FILE
);

2809 
MODULE_FIRMWARE
(
AR6004_HW_1_3_FW_DIR
 "/" 
AR6004_HW_1_3_FIRMWARE_FILE
);

2810 
MODULE_FIRMWARE
(
AR6004_HW_1_3_BOARD_DATA_FILE
);

2811 
MODULE_FIRMWARE
(
AR6004_HW_1_3_DEFAULT_BOARD_DATA_FILE
);

2812 
MODULE_FIRMWARE
(
AR6004_HW_2_0_FW_DIR
 "/" 
AR6004_HW_2_0_FIRMWARE_FILE
);

2813 
MODULE_FIRMWARE
(
AR6004_HW_2_0_BOARD_DATA_FILE
);

2814 
MODULE_FIRMWARE
(
AR6004_HW_2_0_DEFAULT_BOARD_DATA_FILE
);

2815 
MODULE_FIRMWARE
(
AR6006_HW_1_0_FW_DIR
 "/" 
AR6006_HW_1_0_FIRMWARE_FILE
);

2816 
MODULE_FIRMWARE
(
AR6006_HW_1_0_BOARD_DATA_FILE
);

2817 
MODULE_FIRMWARE
(
AR6006_HW_1_0_DEFAULT_BOARD_DATA_FILE
);

	@wlan_location_defs.h

17 #i‚de‡
_WLAN_LOCATION_DEFS_H


18 
	#_WLAN_LOCATION_DEFS_H


	)

20 #i‚de‡
ETH_ALEN


21 
	#ETH_ALEN
 6

	)

23 
	#NUM_OFDM_TONES_ACK_FRAME
 52

	)

24 
	#RESOLUTION_IN_BITS
 10

	)

25 
	#RTTM_CDUMP_SIZE
(
rxchaö
, 
bw40
) \

26 ((
NUM_OFDM_TONES_ACK_FRAME
 * 2 * (
bw40
 + 1) * \

27 (
rxchaö
Ë* 
RESOLUTION_IN_BITS
Ë/ 8)

	)

28 
	#MAX_RTTREQ_MEAS
 10

	)

29 
	#NUM_WLAN_BANDS
 2

	)

30 
	#MAX_CHAINS
 2

	)

31 
	#NUM_CLKOFFSETCAL_SAMPLES
 5

	)

32 
	#CLKOFFSET_GPIO_PIN
 26

	)

34 
	#NSP_MRQST_MEASTYPEMASK
 0x3

	)

36 
	#MRQST_MODE_RTT
 0x0

	)

37 
	#MRQST_MODE_CIR
 0x1

	)

38 
	#MRQST_MODE_DBG
 0x2

	)

40 
	#NSMP_MRQST_MEASTYPE
(
mode
Ë(modê& 0x3)

	)

41 
	#NSP_MRQST_FRAMETYPE
(
mode
Ë((mode>>2Ë& 0x7)

	)

42 
	#NSP_MRQST_TXCHAIN
(
mode
Ë((mode>>5Ë& 0x3)

	)

43 
	#NSP_MRQST_RXCHAIN
(
mode
Ë((mode>>7Ë& 0x3)

	)

44 
	#NSP_MRQST_REQMETHOD
(
mode
Ë((mode>>9Ë& 0x3)

	)

45 
	#NSP_MRQST_MOREREQ
(
mode
Ë((mode>>11Ë& 0x1)

	)

47 
	sn•_hódî
 {

48 
u8
 
	mvîsi⁄
;

49 
u8
 
	m‰ame_ty≥
;

51 
	#NSP_HDR_LEN
 (
n•_hódî
)

	)

53 
	sn•_mrq°
 {

54 
u32
 
	m°a_öfo
;

61 
u32
 
	må™smô_øã
;

66 
u32
 
	mtimeout
;

73 
u32
 
	mª£rved
;

74 
u16
 
	mmode
;

75 
	#FRAME_TYPE_HASH
 0x001c

	)

76 
	#NULL_FRAME
 0

	)

77 
	#QOS_NULL_FRAME
 4

	)

78 
	#RTS_CTS
 8

	)

94 
u8
 
	mªque°_id
;

99 
u8
 
	m°a_mac_addr
[
ETH_ALEN
];

102 
u8
 
	m•oof_mac_addr
[
ETH_ALEN
];

106 
u8
 
	mch™√l
;

113 
u8
 
	mno_of_mósuªmíts
;

117 
u8
 
	mª£rved2
[3];

121 
	sn•_¸q°
 {

122 
u8
 
	mªque°_id
;

129 
	sn•_§q°
 {

130 
u8
 
	mªque°_id
;

136 
	#MRESP_RTT
 0x0

	)

137 
	#MRESP_CIR
 0x1

	)

138 
	#MRESP_DBG
 0x

	)

139 
	#MRESP_CLKOFFSETCAL_START
 0x3

	)

140 
	#MRESP_CLKOFFSETCAL_END
 0x4

	)

142 
	sn•_mª•hdr
 {

143 
u8
 
	mªque°_id
;

147 
u8
 
	m°a_mac_addr
[
ETH_ALEN
];

150 
u8
 
	mª•⁄£_ty≥
;

153 
u16
 
	mno_of_ª•⁄£s
;

156 
u16
 
	mªsu…
;

160 
u32
 
	mbegöts
;

163 
u32
 
	mídts
;

166 
u32
 
	mª£rved
;

169 
	#RTTM_CHANNEL_DUMP_LEN
 
	`RTTM_CDUMP_SIZE
(
MAX_CHAINS
, 1)

	)

170 
	sn•_cú_ª•
 {

171 
u32
 
	mtod
;

174 
u32
 
	mtﬂ
;

177 
u32
 
	m£ndøã
;

180 
u32
 
	mªcvøã
;

184 
u8
 
	mch™√l_dump
[
RTTM_CHANNEL_DUMP_LEN
];

187 
u8
 
	mno_of_chaös
;

190 
u8
 
	mrssi
[
MAX_CHAINS
];

193 
u8
 
	misht40
;

195 
s8
 
	mfwc‹r
;

197 
u8
 
	mª£rved
[3];

200 
	sπåe•_mós_debug
 {

201 
u32
 
	mπt
;

202 
	mπt_ˇl
;

203 
s8
 
	mc‹r
;

204 
u8
 
	mrssi0
;

205 
u8
 
	mrssi1
;

206 
u8
 
	mª£rved
;

207 
u32
 
	mønge
;

208 
	m˛koff£t
;

211 
	sn•_πåe•_debugöfo
 {

212 
πåe•_mós_debug
 
	mπtmósdbg
[
MAX_RTTREQ_MEAS
];

213 
u8
 
	mnTŸÆMós
;

214 
u8
 
	mwœnb™d
;

215 
u8
 
	misht40
;

216 
u8
 
	mª£rved1
;

217 
u32
 
	mª£rved2
;

220 
	#RTTRESP_DEBUG_SIZE
 (
n•_πåe•_debugöfo
)

	)

222 
	sn•_πt_ª•
 {

223 
u32
 
	mønge_avîage
;

226 
u32
 
	mønge_°ddev
;

229 
u32
 
	mønge_mö
;

231 
u32
 
	mønge_max
;

233 
u32
 
	mπt_mö
;

235 
u32
 
	mπt_max
;

237 
u32
 
	mπt_avîage
;

240 
u32
 
	mπt_°ddev
;

244 
u8
 
	mrssi_avîage
;

247 
u8
 
	mrssi_°ddev
;

250 
u8
 
	mrssi_mö
;

253 
u8
 
	mrssi_max
;

256 
u8
 
	mπt_ßm∂es
;

259 
u8
 
	mª£rved1
[3];

261 
u32
 
	mª£rved2
;

263 
u32
 
	m˛ock_dñè
;

265 
u8
 
	mdebug
[
RTTRESP_DEBUG_SIZE
];

269 
	sn•_πt_c⁄fig
 {

270 
u32
 
	mClkCÆ
[
NUM_WLAN_BANDS
];

271 
u8
 
	mFFTSˇÀ
;

272 
u8
 
	mR™geSˇÀ
;

273 
u8
 
	mClkS≥ed
[
NUM_WLAN_BANDS
];

274 
u32
 
	mª£rved
[4];

277 
	s°RâHo°TS
 {

278 
u32
 
	m£c
;

279 
u32
 
	mn£c
;

282 
	sn•_πtd2h2_˛koff£t
 {

283 
°RâHo°TS
 
	mèbs_h2
[
NUM_CLKOFFSETCAL_SAMPLES
];

284 
u8
 
	mnumßm∂es
;

285 
u8
 
	mª£rved
[3];

289 
	sn•_πt_˛koff£t
 {

290 
u32
 
	mtdñè_d1d2
[
NUM_CLKOFFSETCAL_SAMPLES
];

291 
°RâHo°TS
 
	mèbs_h1
[
NUM_CLKOFFSETCAL_SAMPLES
];

292 
°RâHo°TS
 
	mèbs_h2
[
NUM_CLKOFFSETCAL_SAMPLES
];

293 
u32
 
	mèbs_d1
[
NUM_CLKOFFSETCAL_SAMPLES
];

294 
u32
 
	mèbs_d2
[
NUM_CLKOFFSETCAL_SAMPLES
];

295 
u8
 
	mnumßm∂es
;

296 
u8
 
	mª£rved
[3];

299 
	#MREQ_LEN
 (
n•_mrq°
)

	)

300 
	#MRES_LEN
 (
n•_mª•hdr
)

	)

301 
	#CIR_RES_LEN
 (
n•_cú_ª•
)

	)

303 
	eNSP_FRAME_TYPE
 {

304 
	mNSP_MRQST
 = 1,

305 
	mNSP_CIRMRESP
,

306 
	mNSP_RTTMRESP
,

307 
	mNSP_SRQST
,

308 
	mNSP_SRESP
,

309 
	mNSP_CRQST
,

310 
	mNSP_CRESP
,

311 
	mNSP_WRQST
,

312 
	mNSP_WRESP
,

313 
	mNSP_SLRQST
,

314 
	mNSP_SLRESP
,

315 
	mNSP_RTTCONFIG
,

316 
	mNSP_RTTCLKCAL_INFO
,

	@wmi.c

18 
	#DHCP_CLIENT_FEATURE


	)

19 
	#DHCP_SERVER_FEATURE


	)

21 
	~<löux/ù.h
>

22 
	~"c‹e.h
"

23 
	~"debug.h
"

24 
	~"ã°mode.h
"

25 
	~"wœn_loˇti⁄_defs.h
"

26 
	~"πèpi.h
"

27 #ifde‡
ATHTST_SUPPORT


28 
	~"˚_©ht°.h
"

30 #ifde‡
ATH6KL_DIAGNOSTIC


31 
wmi
 *
	gglobÆwmi
;

34 
©h6kl_wmi_sync_poöt
(
wmi
 *wmi, 
u8
 
if_idx
);

36 c⁄° 
s32
 
	gwmi_øã_tbl
[][2] = {

69 c⁄° 
s32
 
	gwmi_øã_tbl_¨6004
[][2] = {

118 c⁄° 
u8
 
	gup_to_ac
[] = {

119 
WMM_AC_BE
,

120 
WMM_AC_BK
,

121 
WMM_AC_BK
,

122 
WMM_AC_BE
,

123 
WMM_AC_VI
,

124 
WMM_AC_VI
,

125 
WMM_AC_VO
,

126 
WMM_AC_VO
,

129 
boﬁ
 
	$©h6kl_wmi_ªp‹t_rx_mgmt
(
√t_devi˚
 *
dev
, 
‰eq
,

130 
sig_mbm
, c⁄° 
u8
 *
buf
, 
size_t
 
Àn
, 
gÂ_t
 
gÂ
)

132 #ifde‡
NL80211_ATTR_WIPHY_RX_SIGNAL_DBM


133 #ifde‡
CFG80211_NETDEV_REPLACED_BY_WDEV


134 
	`BUG_ON
(!
dev
->
õì80211_±r
);

136  
	`cfg80211_rx_mgmt
(
dev
->
õì80211_±r
,

137 
‰eq
,

138 
sig_mbm
,

139 
buf
,

140 
Àn
,

141 
gÂ
);

143  
	`cfg80211_rx_mgmt
(
dev
, 
‰eq
, 
sig_mbm
, 
buf
, 
Àn
, 
gÂ
);

146  
	`cfg80211_rx_mgmt
(
dev
, 
‰eq
, 
buf
, 
Àn
, 
gÂ
);

148 
	}
}

150 
	$©h6kl_wmi_ªady_⁄_ch™√l
(
√t_devi˚
 *
ndev
,

151 
u64
 
cookõ
,

152 
õì80211_ch™√l
 *
ch™
,

153 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
,

154 
duøti⁄
, 
gÂ_t
 
gÂ
)

156 #ifde‡
CFG80211_NETDEV_REPLACED_BY_WDEV


157 
	`BUG_ON
(!
ndev
->
õì80211_±r
);

159 #ifde‡
CFG80211_REMOVE_ROC_CHAN_TYPE


160 
	`cfg80211_ªady_⁄_ch™√l
(
ndev
->
õì80211_±r
,

161 
cookõ
,

162 
ch™
,

163 
duøti⁄
,

164 
gÂ
);

166 
	`cfg80211_ªady_⁄_ch™√l
(
ndev
->
õì80211_±r
,

167 
cookõ
,

168 
ch™
,

169 
ch™√l_ty≥
,

170 
duøti⁄
,

171 
gÂ
);

174 
	`cfg80211_ªady_⁄_ch™√l
(
ndev
,

175 
cookõ
,

176 
ch™
,

177 
ch™√l_ty≥
,

178 
duøti⁄
,

179 
gÂ
);

181 
	}
}

183 
	$©h6kl_wmi_ªmaö_⁄_ch™√l_expúed
(
√t_devi˚
 *
ndev
,

184 
u64
 
cookõ
,

185 
õì80211_ch™√l
 *
ch™
,

186 
∆80211_ch™√l_ty≥
 
ch™√l_ty≥
,

187 
gÂ_t
 
gÂ
)

189 #ifde‡
CFG80211_NETDEV_REPLACED_BY_WDEV


190 
	`BUG_ON
(!
ndev
->
õì80211_±r
);

192 #ifde‡
CFG80211_REMOVE_ROC_CHAN_TYPE


193 
	`cfg80211_ªmaö_⁄_ch™√l_expúed
(
ndev
->
õì80211_±r
,

194 
cookõ
,

195 
ch™
,

196 
gÂ
);

198 
	`cfg80211_ªmaö_⁄_ch™√l_expúed
(
ndev
->
õì80211_±r
,

199 
cookõ
,

200 
ch™
,

201 
ch™√l_ty≥
,

202 
gÂ
);

205 
	`cfg80211_ªmaö_⁄_ch™√l_expúed
(
ndev
,

206 
cookõ
,

207 
ch™
,

208 
ch™√l_ty≥
,

209 
gÂ
);

211 
	}
}

213 
	$©h6kl_wmi_mgmt_tx_°©us
(
√t_devi˚
 *
ndev
, 
u64
 
cookõ
,

214 c⁄° 
u8
 *
buf
, 
size_t
 
Àn
, 
boﬁ
 
ack
, 
gÂ_t
 
gÂ
)

217 #ifde‡
CFG80211_NETDEV_REPLACED_BY_WDEV


218 
	`BUG_ON
(!
ndev
->
õì80211_±r
);

220 
	`cfg80211_mgmt_tx_°©us
(
ndev
->
õì80211_±r
,

221 
cookõ
,

222 
buf
,

223 
Àn
,

224 
ack
,

225 
gÂ
);

227 
	`cfg80211_mgmt_tx_°©us
(
ndev
,

228 
cookõ
,

229 
buf
,

230 
Àn
,

231 
ack
,

232 
gÂ
);

234 
	}
}

236 
	$©h6kl_wmi_£t_c⁄åﬁ_ï
(
wmi
 *wmi, 
htc_ídpoöt_id
 
ï_id
)

238 i‡(
	`WARN_ON
(
ï_id
 =
ENDPOINT_UNUSED
 ||Ép_id >
ENDPOINT_MAX
))

241 
wmi
->
ï_id
 =Ép_id;

242 
	}
}

244 
htc_ídpoöt_id
 
	$©h6kl_wmi_gë_c⁄åﬁ_ï
(
wmi
 *wmi)

246  
wmi
->
ï_id
;

247 
	}
}

249 
©h6kl_vif
 *
	$©h6kl_gë_vif_by_ödex
(
©h6kl
 *
¨
, 
u8
 
if_idx
)

251 
©h6kl_vif
 *
vif
, *
found
 = 
NULL
;

253 i‡(
	`WARN_ON
(
if_idx
 > (
¨
->
vif_max
 - 1)))

254  
NULL
;

257 
	`•ö_lock_bh
(&
¨
->
li°_lock
);

258 
	`li°_f‹_óch_íåy
(
vif
, &
¨
->
vif_li°
, 
li°
) {

259 i‡(
vif
->
fw_vif_idx
 =
if_idx
) {

260 
found
 = 
vif
;

264 
	`•ö_u∆ock_bh
(&
¨
->
li°_lock
);

266  
found
;

267 
	}
}

273 
	$©h6kl_wmi_dix_2_dŸ3
(
wmi
 *wmi, 
sk_buff
 *
skb
)

275 
©h6kl_Œc_¢≠_hdr
 *
Œc_hdr
;

276 
ëhhdr
 *
ëh_hdr
;

277 
size_t
 
√w_Àn
;

278 
__be16
 
ty≥
;

279 
u8
 *
d©≠
;

280 
u16
 
size
;

282 i‡(
	`WARN_ON
(
skb
 =
NULL
))

283  -
EINVAL
;

285 
size
 = (
©h6kl_Œc_¢≠_hdr
Ë+ (
wmi_d©a_hdr
);

286 i‡(
	`skb_hódroom
(
skb
Ë< 
size
)

287  -
ENOMEM
;

289 
ëh_hdr
 = (
ëhhdr
 *Ë
skb
->
d©a
;

290 
ty≥
 = 
ëh_hdr
->
h_¥Ÿo
;

292 i‡(!
	`is_ëhîty≥
(
	`be16_to_˝u
(
ty≥
))) {

293 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

294 "%s:Ökài†Æªady i¿802.3 f‹m©\n", 
__func__
);

298 
√w_Àn
 = 
skb
->
Àn
 - (*
ëh_hdr
Ë+ (*
Œc_hdr
);

300 
	`skb_push
(
skb
, (
©h6kl_Œc_¢≠_hdr
));

301 
d©≠
 = 
skb
->
d©a
;

303 
ëh_hdr
->
h_¥Ÿo
 = 
	`˝u_to_be16
(
√w_Àn
);

305 
	`mem˝y
(
d©≠
, 
ëh_hdr
, (*eth_hdr));

307 
Œc_hdr
 = (
©h6kl_Œc_¢≠_hdr
 *)(
d©≠
 + (*
ëh_hdr
));

308 
Œc_hdr
->
dßp
 = 0xAA;

309 
Œc_hdr
->
sßp
 = 0xAA;

310 
Œc_hdr
->
˙é
 = 0x03;

311 
Œc_hdr
->
‹g_code
[0] = 0x0;

312 
Œc_hdr
->
‹g_code
[1] = 0x0;

313 
Œc_hdr
->
‹g_code
[2] = 0x0;

314 
Œc_hdr
->
ëh_ty≥
 = 
ty≥
;

317 
	}
}

319 
	$©h6kl_wmi_mëa_add
(
wmi
 *wmi, 
sk_buff
 *
skb
,

320 
u8
 *
vîsi⁄
, *
tx_mëa_öfo
)

322 
wmi_tx_mëa_v1
 *
v1
;

323 
wmi_tx_mëa_v2
 *
v2
;

325 i‡(
	`WARN_ON
(
skb
 =
NULL
 || 
vîsi⁄
 == NULL))

326  -
EINVAL
;

328 *
vîsi⁄
) {

329 
WMI_META_VERSION_1
:

330 
	`skb_push
(
skb
, 
WMI_MAX_TX_META_SZ
);

331 
v1
 = (
wmi_tx_mëa_v1
 *Ë
skb
->
d©a
;

332 
v1
->
pkt_id
 = 0;

333 
v1
->
øã_∂cy_id
 = 0;

334 *
vîsi⁄
 = 
WMI_META_VERSION_1
;

336 
WMI_META_VERSION_2
:

337 
	`skb_push
(
skb
, 
WMI_MAX_TX_META_SZ
);

338 
v2
 = (
wmi_tx_mëa_v2
 *Ë
skb
->
d©a
;

339 
	`mem˝y
(
v2
, (
wmi_tx_mëa_v2
 *Ë
tx_mëa_öfo
,

340 (
wmi_tx_mëa_v2
));

345 
	}
}

347 
	$©h6kl_wmi_d©a_hdr_add
(
wmi
 *wmi, 
sk_buff
 *
skb
,

348 
u8
 
msg_ty≥
, 
u32
 
Êags
,

349 
wmi_d©a_hdr_d©a_ty≥
 
d©a_ty≥
,

350 
u8
 
mëa_vî
, *
tx_mëa_öfo
, u8 
if_idx
)

352 
wmi_d©a_hdr
 *
d©a_hdr
;

353 
ªt
;

355 i‡(
	`WARN_ON
(
skb
 =
NULL
 || (
if_idx
 > 
wmi
->
∑ª¡_dev
->
vif_max
 - 1)))

356  -
EINVAL
;

358 i‡(
tx_mëa_öfo
) {

359 
ªt
 = 
	`©h6kl_wmi_mëa_add
(
wmi
, 
skb
, &
mëa_vî
, 
tx_mëa_öfo
);

360 i‡(
ªt
)

361  
ªt
;

364 
	`skb_push
(
skb
, (
wmi_d©a_hdr
));

366 
d©a_hdr
 = (
wmi_d©a_hdr
 *)
skb
->
d©a
;

367 
	`mem£t
(
d©a_hdr
, 0, (
wmi_d©a_hdr
));

369 
d©a_hdr
->
öfo
 = 
msg_ty≥
 << 
WMI_DATA_HDR_MSG_TYPE_SHIFT
;

370 
d©a_hdr
->
öfo
 |
d©a_ty≥
 << 
WMI_DATA_HDR_DATA_TYPE_SHIFT
;

372 
d©a_hdr
->
öfo2
 = 
mëa_vî
 << 
WMI_DATA_HDR_META_SHIFT
;

373 
d©a_hdr
->
öfo3
 = 
if_idx
 & 
WMI_DATA_HDR_IF_IDX_MASK
;

375 i‡(
Êags
 & 
WMI_DATA_HDR_FLAGS_MORE
)

376 
	`WMI_DATA_HDR_SET_MORE_BIT
(
d©a_hdr
);

378 i‡(
Êags
 & 
WMI_DATA_HDR_FLAGS_EOSP
)

379 
	`WMI_DATA_HDR_SET_EOSP_BIT
(
d©a_hdr
);

381 i‡(
Êags
 & 
WMI_DATA_HDR_FLAGS_TRIGGERED
)

382 
	`WMI_DATA_HDR_SET_TRIGGERED_BIT
(
d©a_hdr
);

384 i‡(
Êags
 & 
WMI_DATA_HDR_FLAGS_PSPOLLED
)

385 
	`WMI_DATA_HDR_SET_PSPOLLED_BIT
(
d©a_hdr
);

387 
d©a_hdr
->
öfo2
 = 
	`˝u_to_À16
(data_hdr->info2);

388 
d©a_hdr
->
öfo3
 = 
	`˝u_to_À16
(data_hdr->info3);

391 
	}
}

393 
u8
 
	$©h6kl_wmi_dëîmöe_u£r_¥i‹ôy
(
u8
 *
pkt
, 
u32
 
œyî2_¥i
)

395 
ùhdr
 *
ù_hdr
 = (ùhd∏*Ë
pkt
;

396 
u8
 
ù_¥i
;

406 
ù_¥i
 = 
ù_hdr
->
tos
 >> 5;

407 
ù_¥i
 &= 0x7;

409 i‡((
œyî2_¥i
 & 0x7Ë> 
ù_¥i
)

410  (
u8
Ë
œyî2_¥i
 & 0x7;

412  
ù_¥i
;

413 
	}
}

415 
	$©h6kl_wmi_im∂icô_¸óã_p°ªam
(
wmi
 *wmi, 
u8
 
if_idx
,

416 
sk_buff
 *
skb
,

417 
u32
 
œyî2_¥i‹ôy
, 
boﬁ
 
wmm_íabÀd
,

418 
u8
 *
ac
, 
u16
 *
phtc_èg
)

420 
wmi_d©a_hdr
 *
d©a_hdr
;

421 
©h6kl_Œc_¢≠_hdr
 *
Œc_hdr
;

422 
wmi_¸óã_p°ªam_cmd
 
cmd
;

423 
u32
 
mëa_size
, 
hdr_size
;

424 
u16
 
ù_ty≥
 = 
IP_ETHERTYPE
;

425 
u8
 
°ªam_exi°
, 
u§_¥i
;

426 
u8
 
åaffic_˛ass
 = 
WMM_AC_BE
;

427 
u8
 *
d©≠
;

429 i‡(
	`WARN_ON
(
skb
 =
NULL
))

430  -
EINVAL
;

432 
d©≠
 = 
skb
->
d©a
;

433 
d©a_hdr
 = (
wmi_d©a_hdr
 *Ë
d©≠
;

435 
mëa_size
 = ((
	`À16_to_˝u
(
d©a_hdr
->
öfo2
Ë>> 
WMI_DATA_HDR_META_SHIFT
) &

436 
WMI_DATA_HDR_META_MASK
Ë? 
WMI_MAX_TX_META_SZ
 : 0;

438 i‡(!
wmm_íabÀd
) {

440 
u§_¥i
 = 0;

442 
hdr_size
 = (
ëhhdr
);

444 
Œc_hdr
 = (
©h6kl_Œc_¢≠_hdr
 *)(
d©≠
 +

446 
wmi_d©a_hdr
) +

447 
mëa_size
 + 
hdr_size
);

449 i‡(
Œc_hdr
->
ëh_ty≥
 =
	`ht⁄s
(
ù_ty≥
)) {

454 
u§_¥i
 =

455 
	`©h6kl_wmi_dëîmöe_u£r_¥i‹ôy
(((
u8
 *Ë
Œc_hdr
) +

456 (
©h6kl_Œc_¢≠_hdr
),

457 
œyî2_¥i‹ôy
);

459 
u§_¥i
 = 
œyî2_¥i‹ôy
 & 0x7;

465 i‡(
skb
->
¥Ÿocﬁ
 =
	`˝u_to_be16
(
ETH_P_PAE
)) {

466 
u§_¥i
 = 
WMI_VOICE_USER_PRIORITY
;

467 *
phtc_èg
 = 
ATH6KL_PRI_DATA_PKT_TAG
;

477 i‡((
wmi
->
åaffic_˛ass
 =
WMM_AC_VI
) &&

478 ((
u§_¥i
 == 5) || (usr_pri == 4)))

479 
u§_¥i
 = 1;

482 
åaffic_˛ass
 = 
up_to_ac
[
u§_¥i
 & 0x7];

484 
	`wmi_d©a_hdr_£t_up
(
d©a_hdr
, 
u§_¥i
);

486 
	`•ö_lock_bh
(&
wmi
->
lock
);

487 
°ªam_exi°
 = 
wmi
->
Át_pùe_exi°
;

489 i‡(!(
°ªam_exi°
 & (1 << 
åaffic_˛ass
))) {

490 
wmi
->
Át_pùe_exi°
 |(1 << 
åaffic_˛ass
);

491 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

493 
	`mem£t
(&
cmd
, 0, (cmd));

494 
cmd
.
åaffic_˛ass
 =Åraffic_class;

495 
cmd
.
u£r_¥i
 = 
u§_¥i
;

496 
cmd
.
öa˘ivôy_öt
 =

497 
	`˝u_to_À32
(
WMI_IMPLICIT_PSTREAM_INACTIVITY_INT
);

499 
cmd
.
tsid
 = 
WMI_IMPLICIT_PSTREAM
;

500 
	`©h6kl_wmi_¸óã_p°ªam_cmd
(
wmi
, 
if_idx
, &
cmd
);

502 
	`•ö_lock_bh
(&
wmi
->
lock
);

504 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

506 *
ac
 = 
åaffic_˛ass
;

509 
	}
}

511 
	$©h6kl_wmi_dŸ11_hdr_ªmove
(
wmi
 *wmi, 
sk_buff
 *
skb
)

513 
õì80211_hdr_3addr
 *
pwh
, 
wh
;

514 
©h6kl_Œc_¢≠_hdr
 *
Œc_hdr
;

515 
ëhhdr
 
ëh_hdr
;

516 
u32
 
hdr_size
;

517 
u8
 *
d©≠
;

518 
__À16
 
sub_ty≥
;

520 i‡(
	`WARN_ON
(
skb
 =
NULL
))

521  -
EINVAL
;

523 
d©≠
 = 
skb
->
d©a
;

524 
pwh
 = (
õì80211_hdr_3addr
 *Ë
d©≠
;

526 
sub_ty≥
 = 
pwh
->
‰ame_c⁄åﬁ
 & 
	`˝u_to_À16
(
IEEE80211_FCTL_STYPE
);

528 
	`mem˝y
((
u8
 *Ë&
wh
, 
d©≠
, (
õì80211_hdr_3addr
));

531 i‡(
sub_ty≥
 =
	`˝u_to_À16
(
IEEE80211_STYPE_QOS_DATA
)) {

532 
hdr_size
 = 
	`roundup
((
õì80211_qos_hdr
),

533 (
u32
));

534 
	`skb_puŒ
(
skb
, 
hdr_size
);

535 } i‡(
sub_ty≥
 =
	`˝u_to_À16
(
IEEE80211_STYPE_DATA
))

536 
	`skb_puŒ
(
skb
, (
õì80211_hdr_3addr
));

538 
d©≠
 = 
skb
->
d©a
;

539 
Œc_hdr
 = (
©h6kl_Œc_¢≠_hdr
 *)(
d©≠
);

541 
	`mem£t
(&
ëh_hdr
, 0, (eth_hdr));

542 
ëh_hdr
.
h_¥Ÿo
 = 
Œc_hdr
->
ëh_ty≥
;

544 (
	`À16_to_˝u
(
wh
.
‰ame_c⁄åﬁ
)) &

545 (
IEEE80211_FCTL_FROMDS
 | 
IEEE80211_FCTL_TODS
)) {

547 
	`mem˝y
(
ëh_hdr
.
h_de°
, 
wh
.
addr1
, 
ETH_ALEN
);

548 
	`mem˝y
(
ëh_hdr
.
h_sour˚
, 
wh
.
addr2
, 
ETH_ALEN
);

550 
IEEE80211_FCTL_TODS
:

551 
	`mem˝y
(
ëh_hdr
.
h_de°
, 
wh
.
addr3
, 
ETH_ALEN
);

552 
	`mem˝y
(
ëh_hdr
.
h_sour˚
, 
wh
.
addr2
, 
ETH_ALEN
);

554 
IEEE80211_FCTL_FROMDS
:

555 
	`mem˝y
(
ëh_hdr
.
h_de°
, 
wh
.
addr1
, 
ETH_ALEN
);

556 
	`mem˝y
(
ëh_hdr
.
h_sour˚
, 
wh
.
addr3
, 
ETH_ALEN
);

558 
IEEE80211_FCTL_FROMDS
 | 
IEEE80211_FCTL_TODS
:

562 
	`skb_puŒ
(
skb
, (
©h6kl_Œc_¢≠_hdr
));

563 
	`skb_push
(
skb
, (
ëh_hdr
));

565 
d©≠
 = 
skb
->
d©a
;

567 
	`mem˝y
(
d©≠
, &
ëh_hdr
, (eth_hdr));

570 
	}
}

576 
	$©h6kl_wmi_dŸ3_2_dix
(
sk_buff
 *
skb
)

578 
©h6kl_Œc_¢≠_hdr
 *
Œc_hdr
;

579 
ëhhdr
 
ëh_hdr
;

580 
u8
 *
d©≠
;

582 i‡(
	`WARN_ON
(
skb
 =
NULL
))

583  -
EINVAL
;

585 
d©≠
 = 
skb
->
d©a
;

587 
	`mem˝y
(&
ëh_hdr
, 
d©≠
, (eth_hdr));

589 
Œc_hdr
 = (
©h6kl_Œc_¢≠_hdr
 *Ë(
d©≠
 + (
ëh_hdr
));

590 
ëh_hdr
.
h_¥Ÿo
 = 
Œc_hdr
->
ëh_ty≥
;

592 
	`skb_puŒ
(
skb
, (
©h6kl_Œc_¢≠_hdr
));

593 
d©≠
 = 
skb
->
d©a
;

595 
	`mem˝y
(
d©≠
, &
ëh_hdr
, (eth_hdr));

598 
	}
}

600 
	$©h6kl_wmi_tx_com∂ëe_evít_rx
(
u8
 *
d©≠
, 
Àn
)

602 
tx_com∂ëe_msg_v1
 *
msg_v1
;

603 
wmi_tx_com∂ëe_evít
 *
evt
;

604 
ödex
;

605 
u16
 
size
;

607 
evt
 = (
wmi_tx_com∂ëe_evít
 *Ë
d©≠
;

609 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "comp: %d %d %d\n",

610 
evt
->
num_msg
,Évt->
msg_Àn
,Évt->
msg_ty≥
);

612 i‡(!
	`AR_DBG_LVL_CHECK
(
ATH6KL_DBG_WMI
))

615 
ödex
 = 0; index < 
evt
->
num_msg
; index++) {

616 
size
 = (
wmi_tx_com∂ëe_evít
) +

617 (
ödex
 * (
tx_com∂ëe_msg_v1
));

618 
msg_v1
 = (
tx_com∂ëe_msg_v1
 *)(
d©≠
 + 
size
);

620 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "msg: %d %d %d %d\n",

621 
msg_v1
->
°©us
, msg_v1->
pkt_id
,

622 
msg_v1
->
øã_idx
, msg_v1->
ack_Áûuªs
);

626 
	}
}

628 
	$©h6kl_wmi_ªmaö_⁄_ch∆_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
,

629 
Àn
, 
©h6kl_vif
 *
vif
)

631 
wmi_ªmaö_⁄_ch∆_evít
 *
ev
;

632 
u32
 
‰eq
;

633 
u32
 
dur
;

634 
õì80211_ch™√l
 *
ch™
;

635 
©h6kl
 *
¨
 = 
wmi
->
∑ª¡_dev
;

636 
u32
 
id
;

638 i‡(
Àn
 < (*
ev
))

639  -
EINVAL
;

641 
ev
 = (
wmi_ªmaö_⁄_ch∆_evít
 *Ë
d©≠
;

642 
‰eq
 = 
	`À32_to_˝u
(
ev
->freq);

643 
dur
 = 
	`À32_to_˝u
(
ev
->
duøti⁄
);

644 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "remain_on_chnl: freq=%u dur=%u\n",

645 
‰eq
, 
dur
);

646 
ch™
 = 
	`õì80211_gë_ch™√l
(
¨
->
wùhy
, 
‰eq
);

647 i‡(!
ch™
) {

648 
	`©h6kl_îr
("RoC :Ñemain_on_chnl: Unknown channel "

649 "(‰eq=%uË(dur=%u)\n", 
‰eq
, 
dur
);

650  -
EINVAL
;

653 
	`•ö_lock_bh
(&
vif
->
if_lock
);

654 
id
 = 
vif
->
œ°_roc_id
;

655 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

657 
	`˛ór_bô
(
ROC_PEND
, &
vif
->
Êags
);

658 
	`£t_bô
(
ROC_ONGOING
, &
vif
->
Êags
);

661 i‡(
id
 =
vif
->
œ°_ˇn˚l_roc_id
) {

662 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

663 "RoC : Thi†RoCáÃódy bêˇn˚Œed by u£∏%x\n", 
id
);

665 
	`©h6kl_wmi_ªady_⁄_ch™√l
(
vif
->
ndev
,

666 
id
, 
ch™
, 
NL80211_CHAN_NO_HT
, 
dur
, 
GFP_ATOMIC
);

669 i‡(
	`ã°_bô
(
ROC_WAIT_EVENT
, &
vif
->
Êags
)) {

670 
	`˛ór_bô
(
ROC_WAIT_EVENT
, &
vif
->
Êags
);

671 
	`wake_up
(&
¨
->
evít_wq
);

674 
	}
}

676 
	$©h6kl_wmi_ˇn˚l_ªmaö_⁄_ch∆_evít_rx
(
wmi
 *wmi,

677 
u8
 *
d©≠
, 
Àn
,

678 
©h6kl_vif
 *
vif
)

680 
wmi_ˇn˚l_ªmaö_⁄_ch∆_evít
 *
ev
;

681 
u32
 
‰eq
;

682 
u32
 
dur
;

683 
õì80211_ch™√l
 *
ch™
;

684 
©h6kl
 *
¨
 = 
wmi
->
∑ª¡_dev
;

685 
u32
 
id
;

687 i‡(
Àn
 < (*
ev
))

688  -
EINVAL
;

690 
ev
 = (
wmi_ˇn˚l_ªmaö_⁄_ch∆_evít
 *Ë
d©≠
;

691 
‰eq
 = 
	`À32_to_˝u
(
ev
->freq);

692 
dur
 = 
	`À32_to_˝u
(
ev
->
duøti⁄
);

693 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "cancel_remain_on_chnl: freq=%u dur=%u "

694 "°©us=%u\n", 
‰eq
, 
dur
, 
ev
->
°©us
);

700 i‡(
ev
->
°©us
 != 0) {

701 i‡(
	`ã°_bô
(
ROC_PEND
, &
vif
->
Êags
)) {

702 
	`BUG_ON
(!
vif
->
œ°_roc_ch™√l
);

704 
	`©h6kl_îr
("RoC :Ñequest %d %dÑeject byÅarget %d\n",

705 
vif
->
œ°_roc_id
,

706 
vif
->
œ°_roc_ch™√l
->
˚¡î_‰eq
,

707 
ev
->
°©us
);

710 i‡(
vif
->
œ°_roc_duøti⁄
 ==

711 (
ATH6KL_ROC_MAX_PERIOD
 * 1000))

712 
	`©h6kl_wmi_ªady_⁄_ch™√l
(
vif
->
ndev
,

713 
vif
->
œ°_roc_id
,

714 
vif
->
œ°_roc_ch™√l
,

715 
NL80211_CHAN_NO_HT
,

716 
vif
->
œ°_roc_duøti⁄
,

717 
GFP_ATOMIC
);

723 
	`©h6kl_wmi_ªmaö_⁄_ch™√l_expúed
(
vif
->
ndev
,

724 
vif
->
œ°_roc_id
,

725 
vif
->
œ°_roc_ch™√l
,

726 
NL80211_CHAN_NO_HT
,

727 
GFP_ATOMIC
);

728 
vif
->
œ°_ˇn˚l_roc_id
 = 0;

729 
	`˛ór_bô
(
ROC_PEND
, &
vif
->
Êags
);

733 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "RoC : cancal fail %d %d\n",

734 
	`ã°_bô
(
ROC_ONGOING
, &
vif
->
Êags
),

735 
ev
->
°©us
);

738 
ch™
 = 
	`õì80211_gë_ch™√l
(
¨
->
wùhy
, 
‰eq
);

739 i‡(!
ch™
) {

740 
	`•ö_lock_bh
(&
vif
->
if_lock
);

741 
vif
->
œ°_ˇn˚l_roc_id
 = 0;

742 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

744 
	`©h6kl_îr
("RoC : cancel_remain_on_chnl: Unknown "

745 "ch™√»(‰eq=%uË(dur=%u)\n", 
‰eq
, 
dur
);

746  -
EINVAL
;

750 i‡(!
	`li°_em±y
(&
wmi
->
mgmt_tx_‰ame_li°
)) {

751 
wmi_mgmt_tx_‰ame
 *
mgmt_tx_‰ame
, *
tmp
;

753 
	`li°_f‹_óch_íåy_ß„
(
mgmt_tx_‰ame
, 
tmp
,

754 &
wmi
->
mgmt_tx_‰ame_li°
, 
li°
) {

756 
	`©h6kl_dbg
(
ATH6KL_DBG_INFO
,

759 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_idx
,

760 
vif
->
fw_vif_idx
);

762 i‡(
mgmt_tx_‰ame
->
vif
 == vif) {

763 
	`li°_dñ
(&
mgmt_tx_‰ame
->
li°
);

765 
	`©h6kl_wmi_mgmt_tx_°©us
(
vif
->
ndev
,

766 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_idx
,

767 
mgmt_tx_‰ame
->mgmt_tx_frame,

768 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_Àn
,

769 
Ál£
, 
GFP_ATOMIC
);

770 
	`k‰ì
(
mgmt_tx_‰ame
->mgmt_tx_frame);

771 
	`k‰ì
(
mgmt_tx_‰ame
);

776 
	`•ö_lock_bh
(&
vif
->
if_lock
);

777 i‡(
vif
->
œ°_ˇn˚l_roc_id
 &&

778 
vif
->
œ°_ˇn˚l_roc_id
 + 1 =vif->
œ°_roc_id
)

779 
id
 = 
vif
->
œ°_ˇn˚l_roc_id
;

781 
id
 = 
vif
->
œ°_roc_id
;

782 
vif
->
œ°_ˇn˚l_roc_id
 = 0;

783 
	`•ö_u∆ock_bh
(&
vif
->
if_lock
);

785 
	`˛ór_bô
(
ROC_ONGOING
, &
vif
->
Êags
);

786 i‡(
	`ã°_bô
(
ROC_CANCEL_PEND
, &
vif
->
Êags
)) {

789 
	`©h6kl_wmi_ªmaö_⁄_ch™√l_expúed
(
vif
->
ndev
, 
id
, 
ch™
,

790 
NL80211_CHAN_NO_HT
,

791 
GFP_ATOMIC
);

793 
	`˛ór_bô
(
ROC_CANCEL_PEND
, &
vif
->
Êags
);

794 
	`wake_up
(&
¨
->
evít_wq
);

796 
	`©h6kl_wmi_ªmaö_⁄_ch™√l_expúed
(
vif
->
ndev
, 
id
, 
ch™
,

797 
NL80211_CHAN_NO_HT
,

798 
GFP_ATOMIC
);

799 i‡(
	`ã°_bô
(
ROC_WAIT_EVENT
, &
vif
->
Êags
)) {

800 
	`˛ór_bô
(
ROC_WAIT_EVENT
, &
vif
->
Êags
);

801 
	`wake_up
(&
¨
->
evít_wq
);

807 
	}
}

809 
	$©h6kl_wmi_ª£nd_a˘i⁄_cmd
(
wmi
 *wmi,

810 
wmi_mgmt_tx_‰ame
 *
mgmt_tx_‰ame
)

812 
sk_buff
 *
skb
;

813 
wmi_£nd_a˘i⁄_cmd
 *
p
;

814 
u32
 
waô
 = 0;

816 
	`BUG_ON
(
mgmt_tx_‰ame
->
mgmt_tx_‰ame_ªåy
 == 0);

818 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
p
) +

819 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_Àn
);

820 i‡(!
skb
)

821  -
ENOMEM
;

823 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_ªåy
--;

824 
	`li°_add_èû
(&
mgmt_tx_‰ame
->
li°
, &
wmi
->
mgmt_tx_‰ame_li°
);

826 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "resend_action_cmd: id=%u freq=%uÜen=%u\n",

827 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_idx
,

828 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_‰eq
,

829 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_Àn
);

831 
p
 = (
wmi_£nd_a˘i⁄_cmd
 *Ë
skb
->
d©a
;

832 
p
->
id
 = 
	`˝u_to_À32
(
mgmt_tx_‰ame
->
mgmt_tx_‰ame_idx
);

833 
p
->
‰eq
 = 
	`˝u_to_À32
(
mgmt_tx_‰ame
->
mgmt_tx_‰ame_‰eq
);

834 
p
->
waô
 = 
	`˝u_to_À32
(wait);

835 
p
->
Àn
 = 
	`˝u_to_À16
(
mgmt_tx_‰ame
->
mgmt_tx_‰ame_Àn
);

836 
	`mem˝y
(
p
->
d©a
,

837 
mgmt_tx_‰ame
->mgmt_tx_frame,

838 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_Àn
);

840  
	`©h6kl_wmi_cmd_£nd
(
wmi
,

841 
mgmt_tx_‰ame
->
vif
->
fw_vif_idx
,

842 
skb
,

843 
WMI_SEND_ACTION_CMDID
,

844 
NO_SYNC_WMIFLAG
);

845 
	}
}

847 
	$©h6kl_wmi_tx_°©us_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

848 
©h6kl_vif
 *
vif
)

850 
wmi_tx_°©us_evít
 *
ev
;

851 
u32
 
id
;

853 i‡(
Àn
 < (*
ev
))

854  -
EINVAL
;

856 
ev
 = (
wmi_tx_°©us_evít
 *Ë
d©≠
;

857 
id
 = 
	`À32_to_˝u
(
ev
->id);

858 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "tx_status: id=%xáck_status=%u\n",

859 
id
, 
ev
->
ack_°©us
);

861 i‡(!
	`li°_em±y
(&
wmi
->
mgmt_tx_‰ame_li°
)) {

862 
wmi_mgmt_tx_‰ame
 *
mgmt_tx_‰ame
, *
tmp
;

863 
found
 = 0, 
£q
 = 0;

865 
	`li°_f‹_óch_íåy_ß„
(
mgmt_tx_‰ame
, 
tmp
,

866 &
wmi
->
mgmt_tx_‰ame_li°
, 
li°
) {

867 
£q
++;

868 i‡(
mgmt_tx_‰ame
->
mgmt_tx_‰ame_idx
 =
id
) {

869 
	`li°_dñ
(&
mgmt_tx_‰ame
->
li°
);

871 i‡((
ev
->
ack_°©us
 == 0) &&

872 (
mgmt_tx_‰ame
->
mgmt_tx_‰ame_ªåy
) &&

873 (
	`©h6kl_wmi_ª£nd_a˘i⁄_cmd
(
wmi
,

874 
mgmt_tx_‰ame
) == 0))

877 
found
 = 1;

878 
	`©h6kl_wmi_mgmt_tx_°©us
(
vif
->
ndev
, 
id
,

879 
mgmt_tx_‰ame
->mgmt_tx_frame,

880 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_Àn
,

881 !!
ev
->
ack_°©us
, 
GFP_ATOMIC
);

882 
	`k‰ì
(
mgmt_tx_‰ame
->mgmt_tx_frame);

883 
	`k‰ì
(
mgmt_tx_‰ame
);

888 i‡(!
found
) {

889 
	`©h6kl_îr
("tx_status_report: "

890 "u√x≥˘edÑï‹t? seq = %d\n", 
£q
);

891 } i‡(
£q
 > 1) {

892 
	`©h6kl_îr
("tx_status_report: "

893 "nŸ by ordî, seq = %d\n", 
£q
);

898 
	}
}

900 
	$©h6kl_wmi_rx_¥obe_ªq_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

901 
©h6kl_vif
 *
vif
)

903 
wmi_p2p_rx_¥obe_ªq_evít
 *
ev
;

904 
u32
 
‰eq
;

905 
u16
 
dÀn
;

907 i‡(
Àn
 < (*
ev
))

908  -
EINVAL
;

910 
ev
 = (
wmi_p2p_rx_¥obe_ªq_evít
 *Ë
d©≠
;

911 
‰eq
 = 
	`À32_to_˝u
(
ev
->freq);

912 
dÀn
 = 
	`À16_to_˝u
(
ev
->
Àn
);

913 #ifde‡
CE_SUPPORT


914 i‡(
©h6kl_˚_Êags
 == 1)

915 
dÀn
 = dlen+4;

917 i‡(
d©≠
 + 
Àn
 < 
ev
->
d©a
 + 
dÀn
) {

918 
	`©h6kl_îr
("invalid wmi_p2p_rx_probe_req_event: "

919 "Àn=%d dÀn=%u\n", 
Àn
, 
dÀn
);

920  -
EINVAL
;

922 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "rx_probe_req:Üen=%u freq=%u "

924 
dÀn
, 
‰eq
, 
vif
->
¥obe_ªq_ªp‹t
);

926 i‡(
vif
->
¥obe_ªq_ªp‹t
 || vif->
nw_ty≥
 =
AP_NETWORK
)

927 
	`©h6kl_wmi_ªp‹t_rx_mgmt
(
vif
->
ndev
,

928 
‰eq
,

930 
ev
->
d©a
,

931 
dÀn
,

932 
GFP_ATOMIC
);

935 
	}
}

936 #ifde‡
CE_SUPPORT


937 
	$©h6kl_wmi_rx_¥obe_ª•_evít_rx
(
©h6kl_vif
 *
vif
,

938 
u8
 *
d©≠
, 
Àn
)

940 
wmi_p2p_rx_¥obe_ª•_evít
 *
ev
;

941 
u32
 
‰eq
;

942 
u16
 
dÀn
;

944 i‡(
Àn
 < (*
ev
))

945  -
EINVAL
;

947 
ev
 = (
wmi_p2p_rx_¥obe_ª•_evít
 *Ë
d©≠
;

948 
‰eq
 = 
	`À32_to_˝u
(
ev
->freq);

949 
dÀn
 = 
	`À16_to_˝u
(
ev
->
Àn
);

950 #ifde‡
CE_SUPPORT


951 i‡(
©h6kl_˚_Êags
 == 1)

952 
dÀn
 = dlen+4;

954 i‡(
d©≠
 + 
Àn
 < 
ev
->
d©a
 + 
dÀn
) {

955 
	`©h6kl_îr
("invalid wmi_p2p_rx_probe_resp_event: "

956 "Àn=%d dÀn=%u\n", 
Àn
, 
dÀn
);

957  -
EINVAL
;

960 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "rx_probe_resp:Üen=%u freq=%u "

962 
dÀn
, 
‰eq
, 
vif
->
¥obe_ª•_ªp‹t
);

964 i‡(
vif
->
¥obe_ª•_ªp‹t
)

965 
	`©h6kl_wmi_ªp‹t_rx_mgmt
(
vif
->
ndev
,

966 
‰eq
,

968 
ev
->
d©a
,

969 
dÀn
,

970 
GFP_ATOMIC
);

973 
	}
}

975 
	$©h6kl_wmi_Áke_¥obe_ª•_evít_by_bssöfo
(
wmi
 *wmi,

976 
u8
 *
d©≠
, 
Àn
, 
©h6kl_vif
 *
vif
)

978 
	#_DEFAULT_SNR
 (96Ë

	)

979 
wmi_p2p_rx_¥obe_ª•_evít
 *
ev
;

980 
wmi_bss_öfo_hdr2
 *
bih
;

981 
u8
 *
buf
, *
Áke_d©≠
;

982 
õì80211_mgmt
 *
mgmt
;

983 
u32
 
rssi
, 
Áke_Àn
;

984 
√t_devi˚
 *
dev
 = 
vif
->
ndev
;

986 i‡(
Àn
 <(
wmi_bss_öfo_hdr2
))

987  -
EINVAL
;

989 
bih
 = (
wmi_bss_öfo_hdr2
 *Ë
d©≠
;

990 
buf
 = 
d©≠
 + (
wmi_bss_öfo_hdr2
);

991 
Àn
 -(
wmi_bss_öfo_hdr2
);

993 i‡(
bih
->
‰ame_ty≥
 !
PROBERESP_FTYPE
)

996 i‡(
bih
->
¢r
 == 0x80)

997  -
EINVAL
;

998 
Áke_Àn
 = (
wmi_p2p_rx_¥obe_ª•_evít
Ë+ 24 + 
Àn
 + 4;

999 
Áke_d©≠
 = 
	`kmÆloc
(
Áke_Àn
, 
GFP_ATOMIC
);

1000 i‡(
Áke_d©≠
 =
NULL
)

1001  -
EINVAL
;

1002 
ev
 = (
wmi_p2p_rx_¥obe_ª•_evít
 *)
Áke_d©≠
;

1003 
ev
->
‰eq
 = 
	`˝u_to_À32
(-1);

1004 
ev
->
Àn
 = 
	`˝u_to_À16
(24 +Üen);

1006 
mgmt
 = (
õì80211_mgmt
 *)(
Áke_d©≠
 +

1007 (
wmi_p2p_rx_¥obe_ª•_evít
));

1008 i‡(
mgmt
 =
NULL
)

1009  -
EINVAL
;

1011 
mgmt
->
‰ame_c⁄åﬁ
 = 
	`˝u_to_À16
(
IEEE80211_STYPE_PROBE_RESP
);

1012 
	`mem˝y
(
mgmt
->
da
, 
dev
->
dev_addr
, 
ETH_ALEN
);

1014 
mgmt
->
duøti⁄
 = 
	`˝u_to_À16
(0);

1015 
	`mem˝y
(
mgmt
->
ß
, 
bih
->
bssid
, 
ETH_ALEN
);

1016 
	`mem˝y
(
mgmt
->
bssid
, 
bih
->bssid, 
ETH_ALEN
);

1017 
mgmt
->
£q_˘æ
 = 
	`˝u_to_À16
(0);

1019 
	`mem˝y
(&
mgmt
->
u
.
¥obe_ª•
, 
buf
, 
Àn
);

1020 
rssi
 = 
bih
->
¢r
;

1021 
	`mem˝y
(
Áke_d©≠
 + 
Áke_Àn
 - 4, &
rssi
, 4);

1023 
	`©h6kl_wmi_rx_¥obe_ª•_evít_rx
(
vif
, 
Áke_d©≠
, 
Áke_Àn
);

1024 
	`k‰ì
(
Áke_d©≠
);

1026 #unde‡
_DEFAULT_SNR


1027 
	}
}

1030 #ifde‡
ACL_SUPPORT


1031 
	$©h6kl_wmi_a˛_ªje˘_evít_rx
(
©h6kl_vif
 *
vif
,

1032 
u8
 *
d©≠
, 
Àn
)

1034 
wmi_a˛_ªje˘_evít
 *
ev
;

1035 
u16
 
dÀn
;

1037 i‡(
Àn
 < (*
ev
))

1038  -
EINVAL
;

1040 
ev
 = (
wmi_a˛_ªje˘_evít
 *Ë
d©≠
;

1042 
dÀn
 = 
	`À16_to_˝u
(
ev
->
Àn
);

1044 i‡(
d©≠
 + 
Àn
 < 
ev
->
d©a
 + 
dÀn
) {

1045 
	`©h6kl_îr
("invalidáth6kl_wmi_acl_reject_event_rx: "

1046 "Àn=%d dÀn=%u\n", 
Àn
, 
dÀn
);

1047  -
EINVAL
;

1049 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "rx_probe_resp:Üen=%u "

1051 
dÀn
, 
ev
->
d©a
[0],Év->data[1],Év->data[2],

1052 
ev
->
d©a
[3],Év->data[4],Év->data[5]);

1053 
	`cfg80211_rx_a˛_ªje˘_öfo
(
vif
->
ndev
, 
ev
->
d©a
, 
dÀn
, 
GFP_ATOMIC
);

1056 
	}
}

1059 
	$©h6kl_wmi_p2p_ˇ∑bûôõs_evít_rx
(
u8
 *
d©≠
, 
Àn
)

1061 
wmi_p2p_ˇ∑bûôõs_evít
 *
ev
;

1062 
u16
 
dÀn
;

1064 i‡(
Àn
 < (*
ev
))

1065  -
EINVAL
;

1067 
ev
 = (
wmi_p2p_ˇ∑bûôõs_evít
 *Ë
d©≠
;

1068 
dÀn
 = 
	`À16_to_˝u
(
ev
->
Àn
);

1069 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "p2p_ˇ∑b:Üí=%u\n", 
dÀn
);

1072 
	}
}

1074 
	$©h6kl_wmi_rx_a˘i⁄_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

1075 
©h6kl_vif
 *
vif
)

1077 
wmi_rx_a˘i⁄_evít
 *
ev
;

1078 
u32
 
‰eq
;

1079 
u16
 
dÀn
;

1081 i‡(
Àn
 < (*
ev
))

1082  -
EINVAL
;

1084 
ev
 = (
wmi_rx_a˘i⁄_evít
 *Ë
d©≠
;

1085 
‰eq
 = 
	`À32_to_˝u
(
ev
->freq);

1086 
dÀn
 = 
	`À16_to_˝u
(
ev
->
Àn
);

1087 #ifde‡
CE_SUPPORT


1088 i‡(
©h6kl_˚_Êags
 == 1)

1089 
dÀn
 = dlen+4;

1091 i‡(
d©≠
 + 
Àn
 < 
ev
->
d©a
 + 
dÀn
) {

1092 
	`©h6kl_îr
("invalid wmi_rx_action_event: "

1093 "Àn=%d dÀn=%u\n", 
Àn
, 
dÀn
);

1094  -
EINVAL
;

1096 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "rx_a˘i⁄:Üí=%u fªq=%u\n", 
dÀn
, 
‰eq
);

1098 i‡(
vif
->
¨
->
p2p_‰ame_nŸ_ªp‹t
 &&

1099 !
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
) &&

1100 
	`ã°_bô
(
SCANNING
, &
vif
->
Êags
) &&

1101 
	`©h6kl_p2p_is_p2p_‰ame
(
vif
->
¨
, (c⁄° 
u8
 *Ë
ev
->
d©a
, 
dÀn
)) {

1102 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "rx_action:ÇotÑeportÅo user!\n");

1103 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_WMI_DUMP
, 
__func__
, "actionÑx ",

1104 
ev
->
d©a
, 
dÀn
);

1109 
	`©h6kl_wmi_ªp‹t_rx_mgmt
(
vif
->
ndev
,

1110 
‰eq
,

1112 
ev
->
d©a
,

1113 
dÀn
,

1114 
GFP_ATOMIC
);

1117 
	}
}

1119 
	$©h6kl_wmi_p2p_öfo_evít_rx
(
u8
 *
d©≠
, 
Àn
)

1121 
wmi_p2p_öfo_evít
 *
ev
;

1122 
u32
 
Êags
;

1123 
u16
 
dÀn
;

1125 i‡(
Àn
 < (*
ev
))

1126  -
EINVAL
;

1128 
ev
 = (
wmi_p2p_öfo_evít
 *Ë
d©≠
;

1129 
Êags
 = 
	`À32_to_˝u
(
ev
->
öfo_ªq_Êags
);

1130 
dÀn
 = 
	`À16_to_˝u
(
ev
->
Àn
);

1131 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "p2p_öfo: fœgs=%xÜí=%d\n", 
Êags
, 
dÀn
);

1133 i‡(
Êags
 & 
P2P_FLAG_CAPABILITIES_REQ
) {

1134 
wmi_p2p_ˇ∑bûôõs
 *
ˇp
;

1135 i‡(
dÀn
 < (*
ˇp
))

1136  -
EINVAL
;

1137 
ˇp
 = (
wmi_p2p_ˇ∑bûôõs
 *Ë
ev
->
d©a
;

1138 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "p2p_info: GO Power Save = %d\n",

1139 
ˇp
->
go_powî_ßve
);

1142 i‡(
Êags
 & 
P2P_FLAG_MACADDR_REQ
) {

1143 
wmi_p2p_maˇddr
 *
mac
;

1144 i‡(
dÀn
 < (*
mac
))

1145  -
EINVAL
;

1146 
mac
 = (
wmi_p2p_maˇddr
 *Ë
ev
->
d©a
;

1147 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "p2p_info: MAC Address = %pM\n",

1148 
mac
->
mac_addr
);

1151 i‡(
Êags
 & 
P2P_FLAG_HMODEL_REQ
) {

1152 
wmi_p2p_hmodñ
 *
mod
;

1153 i‡(
dÀn
 < (*
mod
))

1154  -
EINVAL
;

1155 
mod
 = (
wmi_p2p_hmodñ
 *Ë
ev
->
d©a
;

1156 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "p2p_info: P2P Model = %d (%s)\n",

1157 
mod
->
p2p_modñ
,

1158 
mod
->
p2p_modñ
 ? "host" : "firmware");

1161 
	}
}

1163 
	$©h6kl_wmi_Êow˘æ_öd_evít_rx
(
u8
 *
d©≠
, 
Àn
,

1164 
©h6kl_vif
 *
vif
)

1166 
©h6kl
 *
¨
 = 
vif
->ar;

1167 
wmi_Êow˘æ_öd_evít
 *
ev
;

1169 i‡((!(
¨
->
c⁄f_Êags
 & 
ATH6KL_CONF_ENABLE_FLOWCTRL
)) ||

1170 (
	`ã°_bô
(
SKIP_FLOWCTRL_EVENT
, &
¨
->
Êag
)) ||

1171 (
¨
->
vif_max
 == 1))

1174 i‡(
Àn
 < (*
ev
))

1175  -
EINVAL
;

1177 
ev
 = (
wmi_Êow˘æ_öd_evít
 *Ë
d©≠
;

1179 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "flowctrl_info:Çum_of_conn=%d "

1181 
ev
->
num_of_c⁄n
,Év->
ac_m≠
[0],

1182 
ev
->
ac_m≠
[1],Év->ac_map[2]);

1184 
	`©h6kl_p2p_Êow˘æ_°©e_upd©e
(
¨
,

1185 
ev
->
num_of_c⁄n
,

1186 
ev
->
ac_m≠
,

1187 
ev
->
ac_queue_dïth
);

1188 
	`©h6kl_p2p_Êow˘æ_°©e_ch™ge
(
¨
);

1189 
	`©h6kl_p2p_Êow˘æ_tx_scheduÀ
(
¨
);

1192 
	}
}

1194 
sk_buff
 *
	$©h6kl_wmi_gë_√w_buf
(
u32
 
size
)

1196 
sk_buff
 *
skb
;

1198 
skb
 = 
	`©h6kl_buf_Æloc
(
size
);

1199 i‡(!
skb
)

1200  
NULL
;

1202 
	`skb_put
(
skb
, 
size
);

1203 i‡(
size
)

1204 
	`mem£t
(
skb
->
d©a
, 0, 
size
);

1206  
skb
;

1207 
	}
}

1210 
	$©h6kl_wmi_sim∂e_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

1211 
wmi_cmd_id
 
cmd_id
)

1213 
sk_buff
 *
skb
;

1214 
ªt
;

1216 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(0);

1217 i‡(!
skb
)

1218  -
ENOMEM
;

1220 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
cmd_id
, 
NO_SYNC_WMIFLAG
);

1222  
ªt
;

1223 
	}
}

1225 
	$©h6kl_wmi_ªady_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1227 
wmi_ªady_evít_2
 *
ev
 = (wmi_ªady_evít_2 *Ë
d©≠
;

1229 i‡(
Àn
 < (
wmi_ªady_evít_2
))

1230  -
EINVAL
;

1232 
	`©h6kl_ªady_evít
(
wmi
->
∑ª¡_dev
, 
ev
->
mac_addr
,

1233 
	`À32_to_˝u
(
ev
->
sw_vîsi⁄
),

1234 
	`À32_to_˝u
(
ev
->
abi_vîsi⁄
));

1237 
	}
}

1245 
	$©h6kl_wmi_£t_rﬂm_˘æ_cmd
(
wmi
 *wmi,

1246 
u8
 
fw_vif_idx
,

1247 
u16
 
lowrssi_sˇn_≥riod
,

1248 
u16
 
lowrssi_sˇn_thªshﬁd
,

1249 
u16
 
lowrssi_rﬂm_thªshﬁd
,

1250 
u8
 
rﬂm_rssi_Êo‹
)

1252 
sk_buff
 *
skb
;

1253 
rﬂm_˘æ_cmd
 *
cmd
;

1254 
ªt
;

1256 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

1257 i‡(!
skb
)

1258  -
ENOMEM
;

1260 
cmd
 = (
rﬂm_˘æ_cmd
 *Ë
skb
->
d©a
;

1262 
cmd
->
rﬂm_˘æ
 = 
WMI_SET_LRSSI_SCAN_PARAMS
;

1263 
cmd
->
öfo
.
∑øms
.
Ãssi_sˇn_≥riod
 = 
	`˝u_to_À16
(
lowrssi_sˇn_≥riod
);

1264 
cmd
->
öfo
.
∑øms
.
Ãssi_sˇn_thªshﬁd
 =

1265 
	`˝u_to_À16
(
lowrssi_sˇn_thªshﬁd
);

1266 
cmd
->
öfo
.
∑øms
.
Ãssi_rﬂm_thªshﬁd
 =

1267 
	`˝u_to_À16
(
lowrssi_rﬂm_thªshﬁd
);

1268 
cmd
->
öfo
.
∑øms
.
rﬂm_rssi_Êo‹
 =Ñoam_rssi_floor;

1270 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
fw_vif_idx
, 
skb
, 
WMI_SET_ROAM_CTRL_CMDID
,

1271 
NO_SYNC_WMIFLAG
);

1272  
ªt
;

1274 
	}
}

1276 
	$©h6kl_wmi_f‹˚_rﬂm_cmd
(
wmi
 *wmi, c⁄° 
u8
 *
bssid
)

1278 
sk_buff
 *
skb
;

1279 
rﬂm_˘æ_cmd
 *
cmd
;

1281 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

1282 i‡(!
skb
)

1283  -
ENOMEM
;

1285 
cmd
 = (
rﬂm_˘æ_cmd
 *Ë
skb
->
d©a
;

1286 
	`mem£t
(
cmd
, 0, (*cmd));

1288 
	`mem˝y
(
cmd
->
öfo
.
bssid
, bssid, 
ETH_ALEN
);

1289 
cmd
->
rﬂm_˘æ
 = 
WMI_FORCE_ROAM
;

1291 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "f‹˚ÑﬂmÅÿ%pM\n", 
bssid
);

1292  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_SET_ROAM_CTRL_CMDID
,

1293 
NO_SYNC_WMIFLAG
);

1294 
	}
}

1296 
	$©h6kl_wmi_£t_rﬂm_mode_cmd
(
wmi
 *wmi, 
wmi_rﬂm_mode
 
mode
)

1298 
sk_buff
 *
skb
;

1299 
rﬂm_˘æ_cmd
 *
cmd
;

1301 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

1302 i‡(!
skb
)

1303  -
ENOMEM
;

1305 
cmd
 = (
rﬂm_˘æ_cmd
 *Ë
skb
->
d©a
;

1306 
	`mem£t
(
cmd
, 0, (*cmd));

1308 
cmd
->
öfo
.
rﬂm_mode
 = 
mode
;

1309 
cmd
->
rﬂm_˘æ
 = 
WMI_SET_ROAM_MODE
;

1311 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "£àrﬂm modê%d\n", 
mode
);

1312  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_SET_ROAM_CTRL_CMDID
,

1313 
NO_SYNC_WMIFLAG
);

1314 
	}
}

1316 
	$©h6kl_wmi_£t_rﬂm_5g_büs_cmd
(
wmi
 *wmi, 
u8
 
büs_5g
)

1318 
sk_buff
 *
skb
;

1319 
rﬂm_˘æ_cmd
 *
cmd
;

1321 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

1322 i‡(!
skb
)

1323  -
ENOMEM
;

1325 
cmd
 = (
rﬂm_˘æ_cmd
 *Ë
skb
->
d©a
;

1326 
	`mem£t
(
cmd
, 0, (*cmd));

1328 
cmd
->
öfo
.
büs5G
 = 
büs_5g
;

1329 
cmd
->
rﬂm_˘æ
 = 
WMI_SET_HOST_5G_BIAS
;

1331 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "£àrﬂm 5g bü†%d\n", 
büs_5g
);

1332  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_SET_ROAM_CTRL_CMDID
,

1333 
NO_SYNC_WMIFLAG
);

1334 
	}
}

1336 
	$©h6kl_wmi_c⁄√˘_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

1337 
©h6kl_vif
 *
vif
)

1339 
wmi_c⁄√˘_evít
 *
ev
;

1340 
u8
 *
põ
, *
≥õ
;

1341 
u8
 *
assoc_ªq
 = 
NULL
;

1342 
u16
 
assoc_ªq_Àn
 = 0;

1344 i‡(
Àn
 < (
wmi_c⁄√˘_evít
))

1345  -
EINVAL
;

1347 
ev
 = (
wmi_c⁄√˘_evít
 *Ë
d©≠
;

1349 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

1351 
√t_devi˚
 *
dev
 = 
vif
->
ndev
;

1352 i‡(
	`memcmp
(
dev
->
dev_addr
, 
ev
->
u
.
≠_bss
.
bssid
, 
ETH_ALEN
) == 0) {

1353 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "%s: freq %d bssid %pM "

1355 
__func__
, 
	`À16_to_˝u
(
ev
->
u
.
≠_bss
.
ch
),

1356 
ev
->
u
.
≠_bss
.
bssid
);

1357 
	`©h6kl_p2p_Êow˘æ_£t_c⁄n_id
(
vif
,

1358 
ev
->
u
.
≠_bss
.
bssid
,

1359 
ev
->
u
.
≠_bss
.
aid
);

1360 
	`©h6kl_c⁄√˘_≠_mode_bss
(

1361 
vif
,

1362 
	`À16_to_˝u
(
ev
->
u
.
≠_bss
.
ch
),

1363 
ev
->
assoc_öfo
,

1364 
ev
->
bóc⁄_õ_Àn
);

1367 
	`©h6kl_≠_kì∑live_°¨t
(
vif
);

1370 
	`©h6kl_≠_a˛_°¨t
(
vif
);

1373 
	`©h6kl_≠_admc_°¨t
(
vif
);

1376 
	`©h6kl_≠_ch_swôch
(
vif
);

1378 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "%s:áid %u mac_addr %pM "

1381 
__func__
, 
ev
->
u
.
≠_°a
.
aid
,

1382 
ev
->
u
.
≠_°a
.
mac_addr
,

1383 
ev
->
u
.
≠_°a
.
auth
,

1384 
ev
->
u
.
≠_°a
.
keymgmt
,

1385 
	`À16_to_˝u
(
ev
->
u
.
≠_°a
.
cùhî
),

1386 
ev
->
u
.
≠_°a
.
≠sd_öfo
);

1387 
	`©h6kl_p2p_Êow˘æ_£t_c⁄n_id
(
vif
,

1388 
ev
->
u
.
≠_°a
.
mac_addr
,

1389 
ev
->
u
.
≠_°a
.
aid
);

1390 
	`©h6kl_≠_admc_assoc_ªq_„tch
(
vif
,

1391 
ev
,

1392 &
assoc_ªq
,

1393 &
assoc_ªq_Àn
);

1394 
	`©h6kl_c⁄√˘_≠_mode_°a
(

1395 
vif
, 
ev
->
u
.
≠_°a
.
aid
,Év->u.≠_°a.
mac_addr
,

1396 
ev
->
u
.
≠_°a
.
keymgmt
,

1397 
	`À16_to_˝u
(
ev
->
u
.
≠_°a
.
cùhî
),

1398 
ev
->
u
.
≠_°a
.
auth
, 
assoc_ªq_Àn
,

1399 
assoc_ªq
,

1400 
ev
->
u
.
≠_°a
.
≠sd_öfo
,

1401 
ev
->
u
.
≠_°a
.
phymode
);

1402 
	`©h6kl_≠_admc_assoc_ªq_ªÀa£
(
vif
,

1403 
assoc_ªq
);

1406 
	`©h6kl_≠_ht_upd©e_õs
(
vif
);

1412 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

1415 
	`À16_to_˝u
(
ev
->
u
.
°a
.
ch
),Év->u.°a.
bssid
,

1416 
	`À16_to_˝u
(
ev
->
u
.
°a
.
li°í_ötvl
),

1417 
	`À16_to_˝u
(
ev
->
u
.
°a
.
bóc⁄_ötvl
),

1418 
	`À32_to_˝u
(
ev
->
u
.
°a
.
nw_ty≥
));

1421 
põ
 = 
ev
->
assoc_öfo
 +Év->
bóc⁄_õ_Àn
 +

1422 
ev
->
assoc_ªq_Àn
 + ((
u16
) * 3);

1425 
≥õ
 = 
ev
->
assoc_öfo
 +Év->
bóc⁄_õ_Àn
 +Év->
assoc_ªq_Àn
 +

1426 
ev
->
assoc_ª•_Àn
;

1428 
põ
 < 
≥õ
) {

1429 *
põ
) {

1430 
WLAN_EID_VENDOR_SPECIFIC
:

1431 i‡(
põ
[1] > 3 &&Öie[2] == 0x00 &&Öie[3] == 0x50 &&

1432 
põ
[4] =0xf2 &&Öõ[5] =
WMM_OUI_TYPE
) {

1434 i‡(
põ
[1] > 5

1435 && 
põ
[6] =
WMM_PARAM_OUI_SUBTYPE
)

1436 
wmi
->
is_wmm_íabÀd
 = 
åue
;

1441 i‡(
wmi
->
is_wmm_íabÀd
)

1444 
põ
 +=Öie[1] + 2;

1446 
	`©h6kl_p2p_Êow˘æ_£t_c⁄n_id
(
vif
,

1447 
vif
->
ndev
->
dev_addr
,

1448 
ev
->
u
.
°a
.
aid
);

1450 
	`©h6kl_c⁄√˘_evít
(
vif
, 
	`À16_to_˝u
(
ev
->
u
.
°a
.
ch
),

1451 
ev
->
u
.
°a
.
bssid
,

1452 
	`À16_to_˝u
(
ev
->
u
.
°a
.
li°í_ötvl
),

1453 
	`À16_to_˝u
(
ev
->
u
.
°a
.
bóc⁄_ötvl
),

1454 
	`À32_to_˝u
(
ev
->
u
.
°a
.
nw_ty≥
),

1455 
ev
->
bóc⁄_õ_Àn
,Év->
assoc_ªq_Àn
,

1456 
ev
->
assoc_ª•_Àn
,Év->
assoc_öfo
);

1459 
	}
}

1461 
	$©h6kl_wmi_ªgdomaö_evít
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1463 
©h6kl_wmi_ªgdomaö
 *
ev
;

1464 
©h6kl
 *
¨
 = 
wmi
->
∑ª¡_dev
;

1465 
u32
 
ªg_code
;

1467 
ev
 = (
©h6kl_wmi_ªgdomaö
 *Ë
d©≠
;

1468 
ªg_code
 = 
	`À32_to_˝u
(
ev
->reg_code);

1470 
	`©h6kl_ªg_èrgë_nŸify
(
¨
, 
ªg_code
);

1473 
	}
}

1475 
	$©h6kl_wmi_disc⁄√˘_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

1476 
©h6kl_vif
 *
vif
)

1478 
wmi_disc⁄√˘_evít
 *
ev
;

1479 
wmi
->
åaffic_˛ass
 = 100;

1481 i‡(
Àn
 < (
wmi_disc⁄√˘_evít
))

1482  -
EINVAL
;

1484 
ev
 = (
wmi_disc⁄√˘_evít
 *Ë
d©≠
;

1486 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

1489 
	`À16_to_˝u
(
ev
->
¥Ÿo_ªas⁄_°©us
),Év->
bssid
,

1490 
ev
->
disc⁄n_ªas⁄
,Év->
assoc_ª•_Àn
);

1492 
wmi
->
is_wmm_íabÀd
 = 
Ál£
;

1494 
	`©h6kl_disc⁄√˘_evít
(
vif
, 
ev
->
disc⁄n_ªas⁄
,

1495 
ev
->
bssid
,Év->
assoc_ª•_Àn
,Év->
assoc_öfo
,

1496 
	`À16_to_˝u
(
ev
->
¥Ÿo_ªas⁄_°©us
));

1499 
	}
}

1501 
	$©h6kl_wmi_≥î_node_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1503 
wmi_≥î_node_evít
 *
ev
;

1505 i‡(
Àn
 < (
wmi_≥î_node_evít
))

1506  -
EINVAL
;

1508 
ev
 = (
wmi_≥î_node_evít
 *Ë
d©≠
;

1510 i‡(
ev
->
evít_code
 =
PEER_NODE_JOIN_EVENT
)

1511 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "joinedÇode with macáddr: %pM\n",

1512 
ev
->
≥î_mac_addr
);

1513 i‡(
ev
->
evít_code
 =
PEER_NODE_LEAVE_EVENT
)

1514 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "leftÇode with macáddr: %pM\n",

1515 
ev
->
≥î_mac_addr
);

1518 
	}
}

1520 
	$©h6kl_wmi_tkù_mi˚º_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

1521 
©h6kl_vif
 *
vif
)

1523 
wmi_tkù_mi˚º_evít
 *
ev
;

1525 i‡(
Àn
 < (
wmi_tkù_mi˚º_evít
))

1526  -
EINVAL
;

1528 
ev
 = (
wmi_tkù_mi˚º_evít
 *Ë
d©≠
;

1530 
	`©h6kl_tkù_mi˚º_evít
(
vif
, 
ev
->
key_id
,Év->
is_mˇ°
);

1533 
	}
}

1535 
	$©h6kl_wmi_bssöfo_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

1536 
©h6kl_vif
 *
vif
)

1538 
	#_DEFAULT_SNR
 (96Ë

	)

1539 
wmi_bss_öfo_hdr2
 *
bih
;

1540 
u8
 *
buf
;

1541 
õì80211_ch™√l
 *
ch™√l
;

1542 
©h6kl
 *
¨
 = 
wmi
->
∑ª¡_dev
;

1543 
õì80211_mgmt
 *
mgmt
;

1544 
cfg80211_bss
 *
bss
;

1546 i‡(
Àn
 <(
wmi_bss_öfo_hdr2
))

1547  -
EINVAL
;

1549 
bih
 = (
wmi_bss_öfo_hdr2
 *Ë
d©≠
;

1550 
buf
 = 
d©≠
 + (
wmi_bss_öfo_hdr2
);

1551 
Àn
 -(
wmi_bss_öfo_hdr2
);

1553 i‡(
bih
->
¢r
 == 0x80)

1554  -
EINVAL
;

1556 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

1559 
bih
->
ch
, bih->
¢r
, (
s8
)bih->¢∏- 
_DEFAULT_SNR
, bih->
bssid
,

1560 
bih
->
‰ame_ty≥
);

1562 i‡(
bih
->
‰ame_ty≥
 !
BEACON_FTYPE
 &&

1563 
bih
->
‰ame_ty≥
 !
PROBERESP_FTYPE
)

1566 i‡(
bih
->
‰ame_ty≥
 =
BEACON_FTYPE
 &&

1567 
	`ã°_bô
(
CLEAR_BSSFILTER_ON_BEACON
, &
vif
->
Êags
)) {

1568 
	`˛ór_bô
(
CLEAR_BSSFILTER_ON_BEACON
, &
vif
->
Êags
);

1569 
	`©h6kl_wmi_bssfûãr_cmd
(
¨
->
wmi
, 
vif
->
fw_vif_idx
,

1570 
NONE_BSS_FILTER
, 0);

1573 
ch™√l
 = 
	`õì80211_gë_ch™√l
(
¨
->
wùhy
, 
	`À16_to_˝u
(
bih
->
ch
));

1574 i‡(
ch™√l
 =
NULL
)

1575  -
EINVAL
;

1576 #ifde‡
CE_SUPPORT


1577 i‡(
ch™√l
 =
NULL
 ||

1578 ((
vif
->
sˇn_b™d
 =
ATHR_CMD_SCANBAND_CHAN_ONLY
) &&

1579 (
vif
->
sˇn_ch™
 !
ch™√l
->
˚¡î_‰eq
)))

1580  -
EINVAL
;

1582 i‡(
Àn
 < 8 + 2 + 2)

1583  -
EINVAL
;

1585 i‡(
bih
->
‰ame_ty≥
 =
BEACON_FTYPE
 && 
	`ã°_bô
(
CONNECTED
, &
vif
->
Êags
)

1586 && 
	`memcmp
(
bih
->
bssid
, 
vif
->bssid, 
ETH_ALEN
) == 0) {

1587 c⁄° 
u8
 *
tim
;

1588 
tim
 = 
	`cfg80211_föd_õ
(
WLAN_EID_TIM
, 
buf
 + 8 + 2 + 2,

1589 
Àn
 - 8 - 2 - 2);

1590 i‡(
tim
 &&Åim[1] >= 2) {

1591 
vif
->
assoc_bss_dtim_≥riod
 = 
tim
[3];

1592 
	`£t_bô
(
DTIM_PERIOD_AVAIL
, &
vif
->
Êags
);

1603 
mgmt
 = 
	`kmÆloc
(24 + 
Àn
, 
GFP_ATOMIC
);

1604 i‡(
mgmt
 =
NULL
)

1605  -
EINVAL
;

1607 i‡(
bih
->
‰ame_ty≥
 =
BEACON_FTYPE
) {

1608 
mgmt
->
‰ame_c⁄åﬁ
 = 
	`˝u_to_À16
(
IEEE80211_FTYPE_MGMT
 |

1609 
IEEE80211_STYPE_BEACON
);

1610 
	`mem£t
(
mgmt
->
da
, 0xff, 
ETH_ALEN
);

1612 
√t_devi˚
 *
dev
 = 
vif
->
ndev
;

1614 
mgmt
->
‰ame_c⁄åﬁ
 = 
	`˝u_to_À16
(
IEEE80211_FTYPE_MGMT
 |

1615 
IEEE80211_STYPE_PROBE_RESP
);

1616 
	`mem˝y
(
mgmt
->
da
, 
dev
->
dev_addr
, 
ETH_ALEN
);

1618 
mgmt
->
duøti⁄
 = 
	`˝u_to_À16
(0);

1619 
	`mem˝y
(
mgmt
->
ß
, 
bih
->
bssid
, 
ETH_ALEN
);

1620 
	`mem˝y
(
mgmt
->
bssid
, 
bih
->bssid, 
ETH_ALEN
);

1621 
mgmt
->
£q_˘æ
 = 
	`˝u_to_À16
(0);

1623 
	`mem˝y
(&
mgmt
->
u
.
bóc⁄
, 
buf
, 
Àn
);

1627 #ifde‡
CE_SUPPORT


1629 
cfg80211_sˇn_ªque°
 *
ªque°
;

1630 
s8
 
n_ch™√ls
 = 0;

1631 
i
;

1632 
boﬁ
 
dr›_ô
 = 
åue
;

1634 
ªque°
 = 
vif
->
sˇn_ªq
;

1635 i‡(
ªque°
) {

1636 
n_ch™√ls
 = 
ªque°
->n_channels;

1637 i‡(
vif
->
sˇn_b™d
 =
ATHR_CMD_SCANBAND_CHAN_ONLY
) {

1638 
dr›_ô
 = 
Ál£
;

1640 
i
 = 0; i < 
n_ch™√ls
; i++) {

1641 i‡(
ªque°
->
ch™√ls
[
i
]->
˚¡î_‰eq
 ==

1642 
ch™√l
->
˚¡î_‰eq
) {

1643 
dr›_ô
 = 
Ál£
;

1648 i‡(
dr›_ô
 =
åue
) {

1649 
	`¥ötk
(
KERN_DEBUG
 "%s[%d]incorrect channel,%d\n\r",

1650 
__func__
, 
__LINE__
, 
ch™√l
->
˚¡î_‰eq
);

1651 
	`k‰ì
(
mgmt
);

1652  -
EINVAL
;

1658 #ifde‡
ACS_SUPPORT


1659 
	`©h6kl_acs_bss_öfo
(
vif
, 
mgmt
, 24 + 
Àn
, 
ch™√l
, 
bih
->
¢r
);

1661 
	`©h6kl_p2p_rc_bss_öfo
(
vif
, 
bih
->
¢r
, 
ch™√l
);

1662 
	`©h6kl_htc€x_bss_öfo
(
vif
, 
mgmt
, 24 + 
Àn
, 
ch™√l
);

1663 
	`©h6kl_ªg_bss_öfo
(
vif
->
¨
, 
mgmt
, 24 + 
Àn
, 
bih
->
¢r
, 
ch™√l
);

1664 
	`©h6kl_bss_po°_¥oc_bss_öfo
(
vif
,

1665 
mgmt
,

1666 24 + 
Àn
,

1667 ((
s8
)
bih
->
¢r
 - 
_DEFAULT_SNR
) * 100,

1668 
ch™√l
);

1670 
bss
 = 
	`cfg80211_öf‹m_bss_‰ame
(
¨
->
wùhy
, 
ch™√l
, 
mgmt
,

1671 24 + 
Àn
,

1672 ((
s8
)
bih
->
¢r
 - 
_DEFAULT_SNR
) * 100,

1673 
GFP_ATOMIC
);

1674 
	`k‰ì
(
mgmt
);

1675 i‡(
bss
 =
NULL
)

1676  -
ENOMEM
;

1678 #ifde‡
CE_SUPPORT


1679 
bss
->
comög_‰om_dev
 = 
vif
->
ndev
;

1682 
	`©h6kl_bss_put
(
vif
->
¨
, 
bss
);

1685 #unde‡
_DEFAULT_SNR


1686 
	}
}

1689 
	$©h6kl_wmi_p°ªam_timeout_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
,

1690 
Àn
)

1692 
wmi_p°ªam_timeout_evít
 *
ev
;

1694 i‡(
Àn
 < (
wmi_p°ªam_timeout_evít
))

1695  -
EINVAL
;

1697 
ev
 = (
wmi_p°ªam_timeout_evít
 *Ë
d©≠
;

1705 
	`•ö_lock_bh
(&
wmi
->
lock
);

1706 
wmi
->
°ªam_exi°_f‹_ac
[
ev
->
åaffic_˛ass
] = 0;

1707 
wmi
->
Át_pùe_exi°
 &~(1 << 
ev
->
åaffic_˛ass
);

1708 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

1711 
	`©h6kl_ödiˇã_tx_a˘ivôy
(
wmi
->
∑ª¡_dev
, 
ev
->
åaffic_˛ass
, 
Ál£
);

1714 
	}
}

1716 
	$©h6kl_wmi_bôøã_ª∂y_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1718 
wmi_bô_øã_ª∂y
 *
ª∂y
;

1719 
s32
 
øã
;

1720 
u32
 
sgi
, 
ödex
;

1722 i‡(
Àn
 < (
wmi_bô_øã_ª∂y
))

1723  -
EINVAL
;

1725 
ª∂y
 = (
wmi_bô_øã_ª∂y
 *Ë
d©≠
;

1727 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "øãödex %d\n", 
ª∂y
->
øã_ödex
);

1729 i‡(
ª∂y
->
øã_ödex
 =(
s8
Ë
RATE_AUTO
) {

1730 
øã
 = 
RATE_AUTO
;

1732 
ödex
 = 
ª∂y
->
øã_ödex
 & 0x7f;

1733 
sgi
 = (
ª∂y
->
øã_ödex
 & 0x80) ? 1 : 0;

1734 i‡(
ödex
 >(
wmi_øã_tbl
)/(wmi_rate_tbl[0]))

1735 
øã
 = 0;

1737 
øã
 = 
wmi_øã_tbl
[
ödex
][
sgi
];

1740 
	`©h6kl_wakeup_evít
(
wmi
->
∑ª¡_dev
);

1743 
	}
}

1745 
	$©h6kl_wmi_tcmd_ã°_ªp‹t_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1747 
	`©h6kl_tm_rx_evít
(
wmi
->
∑ª¡_dev
, 
d©≠
, 
Àn
);

1750 
	}
}

1752 
	$©h6kl_wmi_øãmask_ª∂y_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1754 i‡(
Àn
 < (
wmi_fix_øãs_ª∂y
))

1755  -
EINVAL
;

1757 
	`©h6kl_wakeup_evít
(
wmi
->
∑ª¡_dev
);

1760 
	}
}

1762 
	$©h6kl_wmi_ch_li°_ª∂y_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1764 i‡(
Àn
 < (
wmi_ch™√l_li°_ª∂y
))

1765  -
EINVAL
;

1767 
	`©h6kl_wakeup_evít
(
wmi
->
∑ª¡_dev
);

1770 
	}
}

1772 
	$©h6kl_wmi_tx_pwr_ª∂y_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1774 
wmi_tx_pwr_ª∂y
 *
ª∂y
;

1776 i‡(
Àn
 < (
wmi_tx_pwr_ª∂y
))

1777  -
EINVAL
;

1779 
ª∂y
 = (
wmi_tx_pwr_ª∂y
 *Ë
d©≠
;

1780 
	`©h6kl_txpwr_rx_evt
(
wmi
->
∑ª¡_dev
, 
ª∂y
->
dbM
);

1783 
	}
}

1785 
	$©h6kl_wmi_kì∑live_ª∂y_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1787 i‡(
Àn
 < (
wmi_gë_kì∑live_cmd
))

1788  -
EINVAL
;

1790 
	`©h6kl_wakeup_evít
(
wmi
->
∑ª¡_dev
);

1793 
	}
}

1795 
	$©h6kl_wmi_sˇn_com∂ëe_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

1796 
©h6kl_vif
 *
vif
)

1798 
wmi_sˇn_com∂ëe_evít
 *
ev
;

1800 
ev
 = (
wmi_sˇn_com∂ëe_evít
 *Ë
d©≠
;

1802 
	`©h6kl_sˇn_com∂ëe_evt
(
vif
, 
	`a_¶e32_to_˝u
(
ev
->
°©us
));

1803 
wmi
->
is_¥obe_ssid
 = 
Ál£
;

1806 
	}
}

1808 
	$©h6kl_wmi_√ighb‹_ªp‹t_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
,

1809 
Àn
, 
©h6kl_vif
 *
vif
)

1811 
wmi_√ighb‹_ªp‹t_evít
 *
ev
;

1812 
u8
 
i
;

1814 i‡(
Àn
 < (*
ev
))

1815  -
EINVAL
;

1816 
ev
 = (
wmi_√ighb‹_ªp‹t_evít
 *Ë
d©≠
;

1817 i‡((*
ev
Ë+Év->
num_√ighb‹s
 * (
wmi_√ighb‹_öfo
)

1818 > 
Àn
) {

1819 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "truncatedÇeighborÉvent "

1820 "“um=%dÜí=%d)\n", 
ev
->
num_√ighb‹s
, 
Àn
);

1821  -
EINVAL
;

1823 
i
 = 0; i < 
ev
->
num_√ighb‹s
; i++) {

1824 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "neighbor %d/%d - %pM 0x%x\n",

1825 
i
 + 1, 
ev
->
num_√ighb‹s
,Év->
√ighb‹
[i].
bssid
,

1826 
ev
->
√ighb‹
[
i
].
bss_Êags
);

1827 
	`cfg80211_pmkß_ˇndid©e_nŸify
(
vif
->
ndev
, 
i
,

1828 
ev
->
√ighb‹
[
i
].
bssid
,

1829 !!(
ev
->
√ighb‹
[
i
].
bss_Êags
 &

1830 
WMI_PREAUTH_CAPABLE_BSS
),

1831 
GFP_ATOMIC
);

1835 
	}
}

1844 
	$©h6kl_wmi_îr‹_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

1846 c⁄° *
ty≥
 = "unknownÉrror";

1847 
wmi_cmd_îr‹_evít
 *
ev
;

1848 
ev
 = (
wmi_cmd_îr‹_evít
 *Ë
d©≠
;

1850 
ev
->
îr_code
) {

1851 
INVALID_PARAM
:

1852 
ty≥
 = "invalidÖarameter";

1854 
ILLEGAL_STATE
:

1855 
ty≥
 = "invalid state";

1857 
INTERNAL_ERROR
:

1858 
ty≥
 = "internalÉrror";

1862 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "programmingÉrror, cmd=%d %s\n",

1863 
ev
->
cmd_id
, 
ty≥
);

1866 
	}
}

1868 
	$©h6kl_wmi_°©s_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

1869 
©h6kl_vif
 *
vif
)

1871 
	`©h6kl_tgt_°©s_evít
(
vif
, 
d©≠
, 
Àn
);

1874 
	}
}

1876 #ifde‡
ATHTST_SUPPORT


1877 
	$©h6kl_wmi_˚_gë_ªg_evít_rx
(
©h6kl_vif
 *
vif
,

1878 
u8
 *
d©≠
, 
Àn
)

1880 
	`©h6kl_tgt_˚_gë_ªg_evít
(
vif
, 
d©≠
, 
Àn
);

1883 
	}
}

1884 
	$©h6kl_wmi_˚_gë_vîsi⁄_öfo_evít_rx
(
©h6kl_vif
 *
vif
,

1885 
u8
 *
d©≠
, 
Àn
)

1887 
	`©h6kl_tgt_˚_gë_vîsi⁄_öfo_evít
(
vif
, 
d©≠
, 
Àn
);

1890 
	}
}

1891 #i‡
deföed
(
CE_CUSTOM_1
)

1892 
	$©h6kl_wmi_˚_gë_widimode_evít_rx
(
©h6kl_vif
 *
vif
,

1893 
u8
 *
d©≠
, 
Àn
)

1895 
	`©h6kl_tgt_˚_gë_widimode_evít
(
vif
, 
d©≠
, 
Àn
);

1898 
	}
}

1900 
	$©h6kl_wmi_˚_gë_ã°mode_evít_rx
(
©h6kl_vif
 *
vif
,

1901 
u8
 *
d©≠
, 
Àn
)

1903 
	`©h6kl_tgt_˚_gë_ã°mode_evít
(
vif
, 
d©≠
, 
Àn
);

1906 
	}
}

1907 
	$©h6kl_wmi_˚_gë_txpow_evít_rx
(
©h6kl_vif
 *
vif
,

1908 
u8
 *
d©≠
, 
Àn
)

1910 
	`©h6kl_tgt_˚_gë_txpow_evít
(
vif
, 
d©≠
, 
Àn
);

1913 
	}
}

1914 
	$©h6kl_wmi_˚_gë_°aöfo_evít_rx
(
©h6kl_vif
 *
vif
,

1915 
u8
 *
d©≠
, 
Àn
)

1917 
	`©h6kl_tgt_˚_gë_°aöfo_evít
(
vif
, 
d©≠
, 
Àn
);

1920 
	}
}

1921 
	$©h6kl_wmi_˚_gë_sˇnöfo_evít_rx
(
©h6kl_vif
 *
vif
,

1922 
u8
 *
d©≠
, 
Àn
)

1924 
	`©h6kl_tgt_˚_gë_sˇnöfo_evít
(
vif
, 
d©≠
, 
Àn
);

1926 
	}
}

1927 
	$©h6kl_wmi_˚_£t_sˇn_d⁄e_evít_rx
(
©h6kl_vif
 *
vif
,

1928 
u8
 *
d©≠
, 
Àn
)

1930 
	`©h6kl_tgt_˚_£t_sˇn_d⁄e_evít
(
vif
, 
d©≠
, 
Àn
);

1932 
	}
}

1933 
	$©h6kl_wmi_cß_evít_rx
(
©h6kl_vif
 *
vif
,

1934 
u8
 *
d©≠
, 
Àn
)

1936 
	`©h6kl_tgt_˚_cß_evít_rx
(
vif
, 
d©≠
, 
Àn
);

1938 
	}
}

1939 
	$©h6kl_wmi_˚_gë_˘l_evít_rx
(
©h6kl_vif
 *
vif
,

1940 
u8
 *
d©≠
, 
Àn
)

1942 
	`©h6kl_tgt_˚_gë_˘l_evít
(
vif
, 
d©≠
, 
Àn
);

1944 
	}
}

1947 
u8
 
	$©h6kl_wmi_gë_uµî_thªshﬁd
(
s16
 
rssi
,

1948 
sq_thªshﬁd_∑øms
 *
sq_thªsh
,

1949 
u32
 
size
)

1951 
u32
 
ödex
;

1952 
u8
 
thªshﬁd
 = (u8Ë
sq_thªsh
->
uµî_thªshﬁd
[
size
 - 1];

1955 
ödex
 = 0; index < 
size
; index++) {

1956 i‡(
rssi
 < 
sq_thªsh
->
uµî_thªshﬁd
[
ödex
]) {

1957 
thªshﬁd
 = (
u8
Ë
sq_thªsh
->
uµî_thªshﬁd
[
ödex
];

1962  
thªshﬁd
;

1963 
	}
}

1965 
u8
 
	$©h6kl_wmi_gë_lowî_thªshﬁd
(
s16
 
rssi
,

1966 
sq_thªshﬁd_∑øms
 *
sq_thªsh
,

1967 
u32
 
size
)

1969 
u32
 
ödex
;

1970 
u8
 
thªshﬁd
 = (u8Ë
sq_thªsh
->
lowî_thªshﬁd
[
size
 - 1];

1973 
ödex
 = 0; index < 
size
; index++) {

1974 i‡(
rssi
 > 
sq_thªsh
->
lowî_thªshﬁd
[
ödex
]) {

1975 
thªshﬁd
 = (
u8
Ë
sq_thªsh
->
lowî_thªshﬁd
[
ödex
];

1980  
thªshﬁd
;

1981 
	}
}

1983 
	$©h6kl_wmi_£nd_rssi_thªshﬁd_∑øms
(
wmi
 *wmi,

1984 
wmi_rssi_thªshﬁd_∑øms_cmd
 *
rssi_cmd
)

1986 
sk_buff
 *
skb
;

1987 
wmi_rssi_thªshﬁd_∑øms_cmd
 *
cmd
;

1989 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

1990 i‡(!
skb
)

1991  -
ENOMEM
;

1993 
cmd
 = (
wmi_rssi_thªshﬁd_∑øms_cmd
 *Ë
skb
->
d©a
;

1994 
	`mem˝y
(
cmd
, 
rssi_cmd
, (
wmi_rssi_thªshﬁd_∑øms_cmd
));

1996  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_RSSI_THRESHOLD_PARAMS_CMDID
,

1997 
NO_SYNC_WMIFLAG
);

1998 
	}
}

2000 
	$©h6kl_wmi_rssi_thªshﬁd_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
,

2001 
Àn
)

2003 
wmi_rssi_thªshﬁd_evít
 *
ª∂y
;

2004 
wmi_rssi_thªshﬁd_∑øms_cmd
 
cmd
;

2005 
sq_thªshﬁd_∑øms
 *
sq_thªsh
;

2006 
wmi_rssi_thªshﬁd_vÆ
 
√w_thªshﬁd
;

2007 
u8
 
uµî_rssi_thªshﬁd
, 
lowî_rssi_thªshﬁd
;

2008 
s16
 
rssi
;

2009 
ªt
;

2011 i‡(
Àn
 < (
wmi_rssi_thªshﬁd_evít
))

2012  -
EINVAL
;

2014 
ª∂y
 = (
wmi_rssi_thªshﬁd_evít
 *Ë
d©≠
;

2015 
√w_thªshﬁd
 = (
wmi_rssi_thªshﬁd_vÆ
Ë
ª∂y
->
ønge
;

2016 
rssi
 = 
	`a_¶e16_to_˝u
(
ª∂y
->rssi);

2018 
sq_thªsh
 = &
wmi
->
sq_thªshld
[
SIGNAL_QUALITY_METRICS_RSSI
];

2025 i‡(
√w_thªshﬁd
) {

2027 i‡(
rssi
 < 
sq_thªsh
->
uµî_thªshﬁd
[0]) {

2028 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

2030 
rssi
);

2031 } i‡((
rssi
 < 
sq_thªsh
->
uµî_thªshﬁd
[1]) &&

2032 (
rssi
 >
sq_thªsh
->
uµî_thªshﬁd
[0])) {

2033 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD1_ABOVE
;

2034 } i‡((
rssi
 < 
sq_thªsh
->
uµî_thªshﬁd
[2]) &&

2035 (
rssi
 >
sq_thªsh
->
uµî_thªshﬁd
[1])) {

2036 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD2_ABOVE
;

2037 } i‡((
rssi
 < 
sq_thªsh
->
uµî_thªshﬁd
[3]) &&

2038 (
rssi
 >
sq_thªsh
->
uµî_thªshﬁd
[2])) {

2039 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD3_ABOVE
;

2040 } i‡((
rssi
 < 
sq_thªsh
->
uµî_thªshﬁd
[4]) &&

2041 (
rssi
 >
sq_thªsh
->
uµî_thªshﬁd
[3])) {

2042 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD4_ABOVE
;

2043 } i‡((
rssi
 < 
sq_thªsh
->
uµî_thªshﬁd
[5]) &&

2044 (
rssi
 >
sq_thªsh
->
uµî_thªshﬁd
[4])) {

2045 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD5_ABOVE
;

2046 } i‡(
rssi
 >
sq_thªsh
->
uµî_thªshﬁd
[5]) {

2047 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD6_ABOVE
;

2051 i‡(
rssi
 > 
sq_thªsh
->
lowî_thªshﬁd
[0]) {

2052 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

2054 
rssi
, 
sq_thªsh
->
lowî_thªshﬁd
[0]);

2055 } i‡((
rssi
 > 
sq_thªsh
->
lowî_thªshﬁd
[1]) &&

2056 (
rssi
 <
sq_thªsh
->
lowî_thªshﬁd
[0])) {

2057 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD6_BELOW
;

2058 } i‡((
rssi
 > 
sq_thªsh
->
lowî_thªshﬁd
[2]) &&

2059 (
rssi
 <
sq_thªsh
->
lowî_thªshﬁd
[1])) {

2060 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD5_BELOW
;

2061 } i‡((
rssi
 > 
sq_thªsh
->
lowî_thªshﬁd
[3]) &&

2062 (
rssi
 <
sq_thªsh
->
lowî_thªshﬁd
[2])) {

2063 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD4_BELOW
;

2064 } i‡((
rssi
 > 
sq_thªsh
->
lowî_thªshﬁd
[4]) &&

2065 (
rssi
 <
sq_thªsh
->
lowî_thªshﬁd
[3])) {

2066 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD3_BELOW
;

2067 } i‡((
rssi
 > 
sq_thªsh
->
lowî_thªshﬁd
[5]) &&

2068 (
rssi
 <
sq_thªsh
->
lowî_thªshﬁd
[4])) {

2069 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD2_BELOW
;

2070 } i‡(
rssi
 <
sq_thªsh
->
lowî_thªshﬁd
[5]) {

2071 
√w_thªshﬁd
 = 
WMI_RSSI_THRESHOLD1_BELOW
;

2076 
lowî_rssi_thªshﬁd
 = 
	`©h6kl_wmi_gë_lowî_thªshﬁd
(
rssi
, 
sq_thªsh
,

2077 
sq_thªsh
->
lowî_thªshﬁd_vÆid_cou¡
);

2078 
uµî_rssi_thªshﬁd
 = 
	`©h6kl_wmi_gë_uµî_thªshﬁd
(
rssi
, 
sq_thªsh
,

2079 
sq_thªsh
->
uµî_thªshﬁd_vÆid_cou¡
);

2082 
cmd
.
thªsh_above1_vÆ
 = 
	`a_˝u_to_¶e16
(
uµî_rssi_thªshﬁd
);

2083 
cmd
.
thªsh_bñow1_vÆ
 = 
	`a_˝u_to_¶e16
(
lowî_rssi_thªshﬁd
);

2084 
cmd
.
weight
 = 
sq_thªsh
->weight;

2085 
cmd
.
pﬁl_time
 = 
	`˝u_to_À32
(
sq_thªsh
->
pﬁlög_öãrvÆ
);

2087 
ªt
 = 
	`©h6kl_wmi_£nd_rssi_thªshﬁd_∑øms
(
wmi
, &
cmd
);

2088 i‡(
ªt
) {

2089 
	`©h6kl_îr
("unableÅo configureÑssiÅhresholds\n");

2090  -
EIO
;

2094 
	}
}

2096 
	$©h6kl_wmi_ˇc_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

2097 
©h6kl_vif
 *
vif
)

2099 
wmi_ˇc_evít
 *
ª∂y
;

2100 
õì80211_t•ec_õ
 *
ts
;

2101 
u16
 
a˘ive_tsids
, 
tsöfo
;

2102 
u8
 
tsid
, 
ödex
;

2103 
u8
 
ts_id
;

2105 i‡(
Àn
 < (
wmi_ˇc_evít
))

2106  -
EINVAL
;

2108 
ª∂y
 = (
wmi_ˇc_evít
 *Ë
d©≠
;

2110 i‡((
ª∂y
->
ˇc_ödiˇti⁄
 =
CAC_INDICATION_ADMISSION_RESP
) &&

2111 (
ª∂y
->
°©us_code
 !
IEEE80211_TSPEC_STATUS_ADMISS_ACCEPTED
)) {

2113 
ts
 = (
õì80211_t•ec_õ
 *Ë&(
ª∂y
->
t•ec_sugge°i⁄
);

2114 
tsöfo
 = 
	`À16_to_˝u
(
ts
->tsinfo);

2115 
tsid
 = (
tsöfo
 >> 
IEEE80211_WMM_IE_TSPEC_TID_SHIFT
) &

2116 
IEEE80211_WMM_IE_TSPEC_TID_MASK
;

2118 
	`©h6kl_wmi_dñëe_p°ªam_cmd
(
wmi
, 
vif
->
fw_vif_idx
,

2119 
ª∂y
->
ac
, 
tsid
);

2120 } i‡(
ª∂y
->
ˇc_ödiˇti⁄
 =
CAC_INDICATION_NO_RESP
) {

2125 
	`•ö_lock_bh
(&
wmi
->
lock
);

2126 
a˘ive_tsids
 = 
wmi
->
°ªam_exi°_f‹_ac
[
ª∂y
->
ac
];

2127 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

2129 
ödex
 = 0; index < (
a˘ive_tsids
) * 8; index++) {

2130 i‡((
a˘ive_tsids
 >> 
ödex
) & 1)

2133 i‡(
ödex
 < ((
a˘ive_tsids
) * 8))

2134 
	`©h6kl_wmi_dñëe_p°ªam_cmd
(
wmi
, 
vif
->
fw_vif_idx
,

2135 
ª∂y
->
ac
, 
ödex
);

2142 i‡(
ª∂y
->
ˇc_ödiˇti⁄
 =
CAC_INDICATION_DELETE
) {

2144 
ts
 = (
õì80211_t•ec_õ
 *Ë&(
ª∂y
->
t•ec_sugge°i⁄
);

2145 
tsöfo
 = 
	`À16_to_˝u
(
ts
->tsinfo);

2146 
ts_id
 = ((
tsöfo
 >> 
IEEE80211_WMM_IE_TSPEC_TID_SHIFT
) &

2147 
IEEE80211_WMM_IE_TSPEC_TID_MASK
);

2149 
	`•ö_lock_bh
(&
wmi
->
lock
);

2150 
wmi
->
°ªam_exi°_f‹_ac
[
ª∂y
->
ac
] &~(1 << 
ts_id
);

2151 
a˘ive_tsids
 = 
wmi
->
°ªam_exi°_f‹_ac
[
ª∂y
->
ac
];

2152 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

2157 i‡(!
a˘ive_tsids
) {

2158 
	`©h6kl_ödiˇã_tx_a˘ivôy
(
wmi
->
∑ª¡_dev
, 
ª∂y
->
ac
,

2159 
Ál£
);

2160 
	`•ö_lock_bh
(&
wmi
->
lock
);

2161 
wmi
->
Át_pùe_exi°
 &~(1 << 
ª∂y
->
ac
);

2162 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

2167 
	}
}

2169 
	$©h6kl_wmi_£nd_¢r_thªshﬁd_∑øms
(
wmi
 *wmi,

2170 
wmi_¢r_thªshﬁd_∑øms_cmd
 *
¢r_cmd
)

2172 
sk_buff
 *
skb
;

2173 
wmi_¢r_thªshﬁd_∑øms_cmd
 *
cmd
;

2175 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2176 i‡(!
skb
)

2177  -
ENOMEM
;

2179 
cmd
 = (
wmi_¢r_thªshﬁd_∑øms_cmd
 *Ë
skb
->
d©a
;

2180 
	`mem˝y
(
cmd
, 
¢r_cmd
, (
wmi_¢r_thªshﬁd_∑øms_cmd
));

2182  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_SNR_THRESHOLD_PARAMS_CMDID
,

2183 
NO_SYNC_WMIFLAG
);

2184 
	}
}

2186 
	$©h6kl_wmi_¢r_thªshﬁd_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
,

2187 
Àn
)

2189 
wmi_¢r_thªshﬁd_evít
 *
ª∂y
;

2190 
sq_thªshﬁd_∑øms
 *
sq_thªsh
;

2191 
wmi_¢r_thªshﬁd_∑øms_cmd
 
cmd
;

2192 
wmi_¢r_thªshﬁd_vÆ
 
√w_thªshﬁd
;

2193 
u8
 
uµî_¢r_thªshﬁd
, 
lowî_¢r_thªshﬁd
;

2194 
s16
 
¢r
;

2195 
ªt
;

2197 i‡(
Àn
 < (
wmi_¢r_thªshﬁd_evít
))

2198  -
EINVAL
;

2200 
ª∂y
 = (
wmi_¢r_thªshﬁd_evít
 *Ë
d©≠
;

2202 
√w_thªshﬁd
 = (
wmi_¢r_thªshﬁd_vÆ
Ë
ª∂y
->
ønge
;

2203 
¢r
 = 
ª∂y
->snr;

2205 
sq_thªsh
 = &
wmi
->
sq_thªshld
[
SIGNAL_QUALITY_METRICS_SNR
];

2212 i‡(
√w_thªshﬁd
) {

2214 i‡(
¢r
 < 
sq_thªsh
->
uµî_thªshﬁd
[0]) {

2215 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

2217 
¢r
);

2218 } i‡((
¢r
 < 
sq_thªsh
->
uµî_thªshﬁd
[1]) &&

2219 (
¢r
 >
sq_thªsh
->
uµî_thªshﬁd
[0])) {

2220 
√w_thªshﬁd
 = 
WMI_SNR_THRESHOLD1_ABOVE
;

2221 } i‡((
¢r
 < 
sq_thªsh
->
uµî_thªshﬁd
[2]) &&

2222 (
¢r
 >
sq_thªsh
->
uµî_thªshﬁd
[1])) {

2223 
√w_thªshﬁd
 = 
WMI_SNR_THRESHOLD2_ABOVE
;

2224 } i‡((
¢r
 < 
sq_thªsh
->
uµî_thªshﬁd
[3]) &&

2225 (
¢r
 >
sq_thªsh
->
uµî_thªshﬁd
[2])) {

2226 
√w_thªshﬁd
 = 
WMI_SNR_THRESHOLD3_ABOVE
;

2227 } i‡(
¢r
 >
sq_thªsh
->
uµî_thªshﬁd
[3]) {

2228 
√w_thªshﬁd
 = 
WMI_SNR_THRESHOLD4_ABOVE
;

2232 i‡(
¢r
 > 
sq_thªsh
->
lowî_thªshﬁd
[0]) {

2233 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

2235 
sq_thªsh
->
lowî_thªshﬁd
[0]);

2236 } i‡((
¢r
 > 
sq_thªsh
->
lowî_thªshﬁd
[1]) &&

2237 (
¢r
 <
sq_thªsh
->
lowî_thªshﬁd
[0])) {

2238 
√w_thªshﬁd
 = 
WMI_SNR_THRESHOLD4_BELOW
;

2239 } i‡((
¢r
 > 
sq_thªsh
->
lowî_thªshﬁd
[2]) &&

2240 (
¢r
 <
sq_thªsh
->
lowî_thªshﬁd
[1])) {

2241 
√w_thªshﬁd
 = 
WMI_SNR_THRESHOLD3_BELOW
;

2242 } i‡((
¢r
 > 
sq_thªsh
->
lowî_thªshﬁd
[3]) &&

2243 (
¢r
 <
sq_thªsh
->
lowî_thªshﬁd
[2])) {

2244 
√w_thªshﬁd
 = 
WMI_SNR_THRESHOLD2_BELOW
;

2245 } i‡(
¢r
 <
sq_thªsh
->
lowî_thªshﬁd
[3]) {

2246 
√w_thªshﬁd
 = 
WMI_SNR_THRESHOLD1_BELOW
;

2251 
lowî_¢r_thªshﬁd
 = 
	`©h6kl_wmi_gë_lowî_thªshﬁd
(
¢r
, 
sq_thªsh
,

2252 
sq_thªsh
->
lowî_thªshﬁd_vÆid_cou¡
);

2253 
uµî_¢r_thªshﬁd
 = 
	`©h6kl_wmi_gë_uµî_thªshﬁd
(
¢r
, 
sq_thªsh
,

2254 
sq_thªsh
->
uµî_thªshﬁd_vÆid_cou¡
);

2257 
cmd
.
thªsh_above1_vÆ
 = 
uµî_¢r_thªshﬁd
;

2258 
cmd
.
thªsh_bñow1_vÆ
 = 
lowî_¢r_thªshﬁd
;

2259 
cmd
.
weight
 = 
sq_thªsh
->weight;

2260 
cmd
.
pﬁl_time
 = 
	`˝u_to_À32
(
sq_thªsh
->
pﬁlög_öãrvÆ
);

2262 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

2264 
¢r
, 
√w_thªshﬁd
,

2265 
lowî_¢r_thªshﬁd
, 
uµî_¢r_thªshﬁd
);

2267 
ªt
 = 
	`©h6kl_wmi_£nd_¢r_thªshﬁd_∑øms
(
wmi
, &
cmd
);

2268 i‡(
ªt
) {

2269 
	`©h6kl_îr
("unableÅo configure snrÅhreshold\n");

2270  -
EIO
;

2274 
	}
}

2276 
	$©h6kl_wmi_≠li°_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

2278 
u16
 
≠_öfo_íåy_size
;

2279 
wmi_≠li°_evít
 *
ev
 = (wmi_≠li°_evíà*Ë
d©≠
;

2280 
wmi_≠_öfo_v1
 *
≠_öfo_v1
;

2281 
u8
 
ödex
;

2283 i‡(
Àn
 < (
wmi_≠li°_evít
) ||

2284 
ev
->
≠_li°_vî
 !
APLIST_VER1
)

2285  -
EINVAL
;

2287 
≠_öfo_íåy_size
 = (
wmi_≠_öfo_v1
);

2288 
≠_öfo_v1
 = (
wmi_≠_öfo_v1
 *Ë
ev
->
≠_li°
;

2290 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

2291 "numbî o‡AP†öá∂i°Évít: %d\n", 
ev
->
num_≠
);

2293 i‡(
Àn
 < (Ë((
wmi_≠li°_evít
) +

2294 (
ev
->
num_≠
 - 1Ë* 
≠_öfo_íåy_size
))

2295  -
EINVAL
;

2298 
ödex
 = 0; index < 
ev
->
num_≠
; index++) {

2299 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "AP#%d BSSID %pM Channel %d\n",

2300 
ödex
, 
≠_öfo_v1
->
bssid
,áp_öfo_v1->
ch™√l
);

2301 
≠_öfo_v1
++;

2305 
	}
}

2307 
	$©h6kl_wmi_cmd_£nd
(
wmi
 *wmi, 
u8
 
if_idx
, 
sk_buff
 *
skb
,

2308 
wmi_cmd_id
 
cmd_id
, 
wmi_sync_Êag
 
sync_Êag
)

2310 
wmi_cmd_hdr
 *
cmd_hdr
;

2311 
htc_ídpoöt_id
 
ï_id
 = 
wmi
->ep_id;

2312 
ªt
;

2313 
u16
 
öfo1
;

2315 i‡(
	`WARN_ON
(
skb
 =
NULL
 ||

2316 (
if_idx
 > (
wmi
->
∑ª¡_dev
->
vif_max
 - 1)))) {

2317 
	`dev_k‰ì_skb
(
skb
);

2318  -
EINVAL
;

2320 #ifde‡
CE_SUPPORT


2321 i‡((
wmi
->
∑ª¡_dev
->
°©e
 =
ATH6KL_STATE_WOW
) ||

2322 (
wmi
->
∑ª¡_dev
->
°©e
 =
ATH6KL_STATE_DEEPSLEEP
)) {

2323 
	`¥ötk
("suspend mode,skip wmi cmd\n\r");

2324  -
EINVAL
;

2327 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmiÅx id %dÜen %d flag %d\n",

2328 
cmd_id
, 
skb
->
Àn
, 
sync_Êag
);

2329 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_WMI_DUMP
, 
NULL
, "wmiÅx ",

2330 
skb
->
d©a
, skb->
Àn
);

2332 i‡(
sync_Êag
 >
END_WMIFLAG
) {

2333 
	`dev_k‰ì_skb
(
skb
);

2334  -
EINVAL
;

2337 i‡((
sync_Êag
 =
SYNC_BEFORE_WMIFLAG
) ||

2338 (
sync_Êag
 =
SYNC_BOTH_WMIFLAG
)) {

2343 
	`©h6kl_wmi_sync_poöt
(
wmi
, 
if_idx
);

2346 
	`skb_push
(
skb
, (
wmi_cmd_hdr
));

2348 
cmd_hdr
 = (
wmi_cmd_hdr
 *Ë
skb
->
d©a
;

2349 
cmd_hdr
->
cmd_id
 = 
	`˝u_to_À16
(cmd_id);

2350 
öfo1
 = 
if_idx
 & 
WMI_CMD_HDR_IF_ID_MASK
;

2351 
cmd_hdr
->
öfo1
 = 
	`˝u_to_À16
(info1);

2354 i‡(
cmd_id
 =
WMI_OPT_TX_FRAME_CMDID
) {

2355 
ªt
 = 
	`©h6kl_wmi_d©a_hdr_add
(
wmi
, 
skb
, 
OPT_MSGTYPE
,

2356 0, 
Ál£
, 0, 
NULL
, 
if_idx
);

2357 i‡(
ªt
) {

2358 
	`dev_k‰ì_skb
(
skb
);

2359  
ªt
;

2361 
ï_id
 = 
	`©h6kl_ac2_ídpoöt_id
(
wmi
->
∑ª¡_dev
, 
WMM_AC_BE
);

2364 
ªt
 = 
	`©h6kl_c⁄åﬁ_tx
(
wmi
->
∑ª¡_dev
, 
skb
, 
ï_id
);

2365 i‡(
ªt
)

2366 
	`©h6kl_îr
("wmi fail, cmd_id 0x%xÉp_id %d if_idx %d\n",

2367 
cmd_id
, 
ï_id
, 
if_idx
);

2369 i‡((
sync_Êag
 =
SYNC_AFTER_WMIFLAG
) ||

2370 (
sync_Êag
 =
SYNC_BOTH_WMIFLAG
)) {

2375 
	`©h6kl_wmi_sync_poöt
(
wmi
, 
if_idx
);

2379 
	}
}

2381 
	$©h6kl_wmi_c⁄√˘_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

2382 
√tw‹k_ty≥
 
nw_ty≥
,

2383 
dŸ11_auth_mode
 dot11_auth_mode,

2384 
auth_mode
áuth_mode,

2385 
¸y±o_ty≥
 
∑úwi£_¸y±o
,

2386 
u8
 
∑úwi£_¸y±o_Àn
,

2387 
¸y±o_ty≥
 
group_¸y±o
,

2388 
u8
 
group_¸y±o_Àn
, 
ssid_Àn
, u8 *
ssid
,

2389 
u8
 *
bssid
, 
u16
 
ch™√l
, 
u32
 
˘æ_Êags
)

2391 
sk_buff
 *
skb
;

2392 
wmi_c⁄√˘_cmd
 *
cc
;

2393 
ªt
;

2395 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

2398 
bssid
, 
ch™√l
, 
˘æ_Êags
, 
ssid_Àn
, 
nw_ty≥
,

2399 
dŸ11_auth_mode
, 
auth_mode
, 
∑úwi£_¸y±o
, 
group_¸y±o
);

2400 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_WMI
, 
NULL
, "ssid ", 
ssid
, 
ssid_Àn
);

2402 
wmi
->
åaffic_˛ass
 = 100;

2404 i‡((
∑úwi£_¸y±o
 =
NONE_CRYPT
Ë&& (
group_¸y±o
 != NONE_CRYPT))

2405  -
EINVAL
;

2407 i‡((
∑úwi£_¸y±o
 !
NONE_CRYPT
Ë&& (
group_¸y±o
 == NONE_CRYPT))

2408  -
EINVAL
;

2410 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_c⁄√˘_cmd
));

2411 i‡(!
skb
)

2412  -
ENOMEM
;

2414 
cc
 = (
wmi_c⁄√˘_cmd
 *Ë
skb
->
d©a
;

2416 i‡(
ssid_Àn
)

2417 
	`mem˝y
(
cc
->
ssid
, ssid, 
ssid_Àn
);

2419 
cc
->
ssid_Àn
 = ssid_len;

2420 
cc
->
nw_ty≥
 =Çw_type;

2421 
cc
->
dŸ11_auth_mode
 = dot11_auth_mode;

2422 
cc
->
auth_mode
 =áuth_mode;

2423 
cc
->
¥wi£_¸y±o_ty≥
 = 
∑úwi£_¸y±o
;

2424 
cc
->
¥wi£_¸y±o_Àn
 = 
∑úwi£_¸y±o_Àn
;

2425 
cc
->
gΩ_¸y±o_ty≥
 = 
group_¸y±o
;

2426 
cc
->
gΩ_¸y±o_Àn
 = 
group_¸y±o_Àn
;

2427 
cc
->
ch
 = 
	`˝u_to_À16
(
ch™√l
);

2428 
cc
->
˘æ_Êags
 = 
	`˝u_to_À32
(ctrl_flags);

2430 i‡(
bssid
 !
NULL
)

2431 
	`mem˝y
(
cc
->
bssid
, bssid, 
ETH_ALEN
);

2433 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_CONNECT_CMDID
,

2434 
NO_SYNC_WMIFLAG
);

2436  
ªt
;

2437 
	}
}

2439 
	$©h6kl_wmi_£t_øndom_bóc⁄_skù
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
íabÀd
, u32 
⁄
, u32 
∫d
, u32 
off
 )

2441 
sk_buff
 *
skb
;

2442 
wmi_øndom_bóc⁄_skù_cmd
 *
cmd
;

2444 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmiÑandom beacon skipÉnabled %d, on %d,Ñnd %d, off %d\n",

2445 
íabÀd
, 
⁄
, 
∫d
, 
off
);

2447 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2448 i‡(!
skb
)

2449  -
ENOMEM
;

2451 
cmd
 = (
wmi_øndom_bóc⁄_skù_cmd
 *Ë
skb
->
d©a
;

2453 
cmd
->
íabÀ
 = 
	`˝u_to_À32
(((
íabÀd
)?1:0));

2454 
cmd
->
⁄
 = 
	`˝u_to_À32
(on);

2455 
cmd
->
∫d
 = 
	`˝u_to_À32
(rnd);

2456 
cmd
->
off
 = 
	`˝u_to_À32
(off);

2458  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_RANDOM_BEACON_SKIP_CMDID
, 
NO_SYNC_WMIFLAG
);

2459 
	}
}

2461 #ifde‡
DHCP_CLIENT_FEATURE


2463 
	$©h6kl_wmi_£t_dh˝_˛õ¡
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
ù
, u32 
íabÀd
)

2465 
sk_buff
 *
skb
;

2466 
wmi_dh˝_∑øms_cmd
 *
cmd
;

2468 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmò£àdh˝ clõ¡É«bÀd %d %d.%d.%d.%d\n", 
íabÀd
,

2469 ((
ù
 >> 24) & 0xFF),

2470 ((
ù
 >> 16) & 0xFF),

2471 ((
ù
 >> 8) & 0xFF),

2472 (
ù
 & 0xFF));

2474 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2475 i‡(!
skb
)

2476  -
ENOMEM
;

2478 
cmd
 = (
wmi_dh˝_∑øms_cmd
 *Ë
skb
->
d©a
;

2479 
cmd
->
ù
 = 
	`˝u_to_À32
(ip);

2480 
cmd
->
íabÀ
 = 
	`˝u_to_À32
((
íabÀd
)?1:0);

2482  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_DHCP_CLIENT_CMDID
, 
NO_SYNC_WMIFLAG
);

2483 
	}
}

2487 #ifde‡
DHCP_SERVER_FEATURE


2489 
	$©h6kl_wmi_£t_dh˝_£rvî
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
ù
, u32 
íabÀd
)

2491 
sk_buff
 *
skb
;

2492 
wmi_dh˝_∑øms_cmd
 *
cmd
;

2494 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmò£àdh˝ sîvîÉ«bÀd %d %d.%d.%d.%d\n", 
íabÀd
,

2495 ((
ù
 >> 24) & 0xFF),

2496 ((
ù
 >> 16) & 0xFF),

2497 ((
ù
 >> 8) & 0xFF),

2498 (
ù
 & 0xFF));

2499 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2500 i‡(!
skb
)

2501  -
ENOMEM
;

2503 
cmd
 = (
wmi_dh˝_∑øms_cmd
 *Ë
skb
->
d©a
;

2504 
cmd
->
ù
 = 
	`˝u_to_À32
(ip);

2505 
cmd
->
íabÀ
 = 
	`˝u_to_À32
((
íabÀd
)?1:0);

2507  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_DHCP_SERVER_CMDID
, 
NO_SYNC_WMIFLAG
);

2508 
	}
}

2512 
	$©h6kl_wmi_ªc⁄√˘_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 *
bssid
,

2513 
u16
 
ch™√l
)

2515 
sk_buff
 *
skb
;

2516 
wmi_ªc⁄√˘_cmd
 *
cc
;

2517 
ªt
;

2519 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmiÑeconnect bssid %pM freq %d\n",

2520 
bssid
, 
ch™√l
);

2522 
wmi
->
åaffic_˛ass
 = 100;

2524 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_ªc⁄√˘_cmd
));

2525 i‡(!
skb
)

2526  -
ENOMEM
;

2528 
cc
 = (
wmi_ªc⁄√˘_cmd
 *Ë
skb
->
d©a
;

2529 
cc
->
ch™√l
 = 
	`˝u_to_À16
(channel);

2531 i‡(
bssid
 !
NULL
)

2532 
	`mem˝y
(
cc
->
bssid
, bssid, 
ETH_ALEN
);

2534 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_RECONNECT_CMDID
,

2535 
NO_SYNC_WMIFLAG
);

2537  
ªt
;

2538 
	}
}

2540 
	$©h6kl_wmi_disc⁄√˘_cmd
(
wmi
 *wmi, 
u8
 
if_idx
)

2542 
ªt
;

2544 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmi disconnect\n");

2546 
wmi
->
åaffic_˛ass
 = 100;

2549 
ªt
 = 
	`©h6kl_wmi_sim∂e_cmd
(
wmi
, 
if_idx
, 
WMI_DISCONNECT_CMDID
);

2551  
ªt
;

2552 
	}
}

2554 
	$©h6kl_wmi_°¨tsˇn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

2555 
wmi_sˇn_ty≥
 
sˇn_ty≥
,

2556 
u32
 
f‹˚_fgsˇn
, u32 
is_Àgacy
,

2557 
u32
 
home_dwñl_time
, u32 
f‹˚_sˇn_öãrvÆ
,

2558 
s8
 
num_ch™
, 
u16
 *
ch_li°
)

2560 
sk_buff
 *
skb
;

2561 
wmi_°¨t_sˇn_cmd
 *
sc
;

2562 
s8
 
size
;

2563 
i
, 
ªt
;

2565 
size
 = (
wmi_°¨t_sˇn_cmd
);

2567 i‡((
sˇn_ty≥
 !
WMI_LONG_SCAN
Ë&& (sˇn_ty≥ !
WMI_SHORT_SCAN
))

2568  -
EINVAL
;

2570 i‡(
num_ch™
 > 
WMI_MAX_CHANNELS
)

2571  -
EINVAL
;

2573 i‡(
num_ch™
)

2574 
size
 +(
u16
Ë* (
num_ch™
 - 1);

2576 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

2577 i‡(!
skb
)

2578  -
ENOMEM
;

2580 
sc
 = (
wmi_°¨t_sˇn_cmd
 *Ë
skb
->
d©a
;

2581 
sc
->
sˇn_ty≥
 = scan_type;

2582 
sc
->
f‹˚_fg_sˇn
 = 
	`˝u_to_À32
(
f‹˚_fgsˇn
);

2583 
sc
->
is_Àgacy
 = 
	`˝u_to_À32
(is_legacy);

2584 
sc
->
home_dwñl_time
 = 
	`˝u_to_À32
(home_dwell_time);

2585 
sc
->
f‹˚_sˇn_ötvl
 = 
	`˝u_to_À32
(
f‹˚_sˇn_öãrvÆ
);

2586 
sc
->
num_ch
 = 
num_ch™
;

2588 
i
 = 0; i < 
num_ch™
; i++)

2589 
sc
->
ch_li°
[
i
] = 
	`˝u_to_À16
(ch_list[i]);

2591 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_START_SCAN_CMDID
,

2592 
NO_SYNC_WMIFLAG
);

2594  
ªt
;

2595 
	}
}

2597 
	$©h6kl_wmi_sˇ≈¨ams_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

2598 
u16
 
fg_°¨t_£c
,

2599 
u16
 
fg_íd_£c
, u16 
bg_£c
,

2600 
u16
 
möa˘_chdw_m£c
, u16 
maxa˘_chdw_m£c
,

2601 
u16
 
∑s_chdw_m£c
, 
u8
 
sh‹t_sˇn_øtio
,

2602 
u8
 
sˇn_˘æ_Êag
, 
u32
 
max_dfsch_a˘_time
,

2603 
u16
 
maxa˘_sˇn_≥r_ssid
)

2605 
sk_buff
 *
skb
;

2606 
wmi_sˇn_∑øms_cmd
 *
sc
;

2607 
ªt
;

2609 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
sc
));

2610 i‡(!
skb
)

2611  -
ENOMEM
;

2613 
sc
 = (
wmi_sˇn_∑øms_cmd
 *Ë
skb
->
d©a
;

2614 
sc
->
fg_°¨t_≥riod
 = 
	`˝u_to_À16
(
fg_°¨t_£c
);

2615 
sc
->
fg_íd_≥riod
 = 
	`˝u_to_À16
(
fg_íd_£c
);

2616 
sc
->
bg_≥riod
 = 
	`˝u_to_À16
(
bg_£c
);

2617 
sc
->
möa˘_chdwñl_time
 = 
	`˝u_to_À16
(
möa˘_chdw_m£c
);

2618 
sc
->
maxa˘_chdwñl_time
 = 
	`˝u_to_À16
(
maxa˘_chdw_m£c
);

2619 
sc
->
∑s_chdwñl_time
 = 
	`˝u_to_À16
(
∑s_chdw_m£c
);

2620 
sc
->
sh‹t_sˇn_øtio
 = short_scan_ratio;

2621 
sc
->
sˇn_˘æ_Êags
 = 
sˇn_˘æ_Êag
;

2622 
sc
->
max_dfsch_a˘_time
 = 
	`˝u_to_À32
(max_dfsch_act_time);

2623 
sc
->
maxa˘_sˇn_≥r_ssid
 = 
	`˝u_to_À16
(maxact_scan_per_ssid);

2625 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_SCAN_PARAMS_CMDID
,

2626 
NO_SYNC_WMIFLAG
);

2627  
ªt
;

2628 
	}
}

2630 
	$©h6kl_wmi_bssfûãr_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
fûãr
, 
u32
 
õ_mask
)

2632 
sk_buff
 *
skb
;

2633 
wmi_bss_fûãr_cmd
 *
cmd
;

2634 
ªt
;

2636 i‡(
fûãr
 >
LAST_BSS_FILTER
)

2637  -
EINVAL
;

2639 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2640 i‡(!
skb
)

2641  -
ENOMEM
;

2643 
cmd
 = (
wmi_bss_fûãr_cmd
 *Ë
skb
->
d©a
;

2644 
cmd
->
bss_fûãr
 = 
fûãr
;

2645 
cmd
->
õ_mask
 = 
	`˝u_to_À32
(ie_mask);

2647 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_BSS_FILTER_CMDID
,

2648 
NO_SYNC_WMIFLAG
);

2649  
ªt
;

2650 
	}
}

2652 
	$©h6kl_wmi_go_sync_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

2653 
wmi_£t_go_sync_cmd
 *
gsync
)

2655 
sk_buff
 *
skb
;

2656 
wmi_£t_go_sync_cmd
 *
gs
;

2657 
ªt
;

2659 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
gs
));

2660 i‡(!
skb
)

2661  -
ENOMEM
;

2663 
gs
 = (
wmi_£t_go_sync_cmd
 *Ë
skb
->
d©a
;

2664 
gs
->
‰eq
 = 
	`˝u_to_À16
(
gsync
->freq);

2665 
	`mem˝y
(
gs
->
addr
, 
gsync
->addr, 
ETH_ALEN
);

2666 
gs
->
ª≥©
 = 
gsync
->repeat;

2667 
gs
->
°a_dwñl_time
 = 
gsync
->sta_dwell_time;

2669 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_GO_SYNC_CMDID
,

2670 
NO_SYNC_WMIFLAG
);

2672  
ªt
;

2673 
	}
}

2675 
	$©h6kl_wmi_¥obedssid_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
ödex
, u8 
Êag
,

2676 
u8
 
ssid_Àn
, u8 *
ssid
)

2678 
sk_buff
 *
skb
;

2679 
wmi_¥obed_ssid_cmd
 *
cmd
;

2680 
ªt
;

2682 i‡(
ödex
 > 
MAX_PROBED_SSID_INDEX
)

2683  -
EINVAL
;

2685 i‡(
ssid_Àn
 > (
cmd
->
ssid
))

2686  -
EINVAL
;

2688 i‡((
Êag
 & (
DISABLE_SSID_FLAG
 | 
ANY_SSID_FLAG
)Ë&& (
ssid_Àn
 > 0))

2689  -
EINVAL
;

2691 i‡((
Êag
 & 
SPECIFIC_SSID_FLAG
Ë&& !
ssid_Àn
)

2692  -
EINVAL
;

2694 i‡(
Êag
 & 
SPECIFIC_SSID_FLAG
)

2695 
wmi
->
is_¥obe_ssid
 = 
åue
;

2697 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2698 i‡(!
skb
)

2699  -
ENOMEM
;

2701 
cmd
 = (
wmi_¥obed_ssid_cmd
 *Ë
skb
->
d©a
;

2702 
cmd
->
íåy_ödex
 = 
ödex
;

2703 
cmd
->
Êag
 = flag;

2704 
cmd
->
ssid_Àn
 = ssid_len;

2705 
	`mem˝y
(
cmd
->
ssid
, ssid, 
ssid_Àn
);

2707 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_PROBED_SSID_CMDID
,

2708 
NO_SYNC_WMIFLAG
);

2709  
ªt
;

2710 
	}
}

2712 
	$©h6kl_wmi_li°íöãrvÆ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

2713 
u16
 
li°í_öãrvÆ
,

2714 
u16
 
li°í_bóc⁄s
)

2716 
sk_buff
 *
skb
;

2717 
wmi_li°í_öt_cmd
 *
cmd
;

2718 
ªt
;

2720 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2721 i‡(!
skb
)

2722  -
ENOMEM
;

2724 
cmd
 = (
wmi_li°í_öt_cmd
 *Ë
skb
->
d©a
;

2725 
cmd
->
li°í_ötvl
 = 
	`˝u_to_À16
(
li°í_öãrvÆ
);

2726 
cmd
->
num_bóc⁄s
 = 
	`˝u_to_À16
(
li°í_bóc⁄s
);

2728 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_LISTEN_INT_CMDID
,

2729 
NO_SYNC_WMIFLAG
);

2730  
ªt
;

2731 
	}
}

2733 
	$©h6kl_wmi_powîmode_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
pwr_mode
)

2735 
sk_buff
 *
skb
;

2736 
wmi_powî_mode_cmd
 *
cmd
;

2737 
©h6kl_vif
 *
vif
;

2738 
ªt
;

2740 i‡((
pwr_mode
 !
REC_POWER
Ë&& (pwr_modê!
MAX_PERF_POWER
))

2741  -
EINVAL
;

2743 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2744 i‡(!
skb
)

2745  -
ENOMEM
;

2747 
cmd
 = (
wmi_powî_mode_cmd
 *Ë
skb
->
d©a
;

2748 
cmd
->
pwr_mode
 =Öwr_mode;

2750 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
wmi
->
∑ª¡_dev
, 
if_idx
);

2751 i‡(
vif
)

2752 
vif
->
œ°_pwr_mode
 = 
pwr_mode
;

2754 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_POWER_MODE_CMDID
,

2755 
NO_SYNC_WMIFLAG
);

2756  
ªt
;

2757 
	}
}

2759 
	$©h6kl_wmi_pm∑øms_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
idÀ_≥riod
,

2760 
u16
 
ps_pﬁl_num
, u16 
dtim_pﬁicy
,

2761 
u16
 
tx_wakeup_pﬁicy
, u16 
num_tx_to_wakeup
,

2762 
u16
 
ps_Áû_evít_pﬁicy
)

2764 
sk_buff
 *
skb
;

2765 
wmi_powî_∑øms_cmd
 *
pm
;

2766 
ªt
;

2768 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
pm
));

2769 i‡(!
skb
)

2770  -
ENOMEM
;

2772 
pm
 = (
wmi_powî_∑øms_cmd
 *)
skb
->
d©a
;

2773 
pm
->
idÀ_≥riod
 = 
	`˝u_to_À16
(idle_period);

2774 
pm
->
p•ﬁl_numbî
 = 
	`˝u_to_À16
(
ps_pﬁl_num
);

2775 
pm
->
dtim_pﬁicy
 = 
	`˝u_to_À16
(dtim_policy);

2776 
pm
->
tx_wakeup_pﬁicy
 = 
	`˝u_to_À16
(tx_wakeup_policy);

2777 
pm
->
num_tx_to_wakeup
 = 
	`˝u_to_À16
(num_tx_to_wakeup);

2778 
pm
->
ps_Áû_evít_pﬁicy
 = 
	`˝u_to_À16
(ps_fail_event_policy);

2780 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_POWER_PARAMS_CMDID
,

2781 
NO_SYNC_WMIFLAG
);

2782  
ªt
;

2783 
	}
}

2785 #ifde‡
ATH6KL_SUPPORT_WIFI_KTK


2786 
	$©h6kl_wmi_ibss_pm_ˇps_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
adhoc_ps_ty≥
,

2787 
u8
 
âl
,

2788 
u16
 
©im_wödows
,

2789 
u16
 
timeout_vÆue
)

2791 
sk_buff
 *
skb
;

2792 
wmi_ibss_pm_ˇps_cmd
 *
cmd
;

2793 
ªt
;

2795 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2796 i‡(!
skb
)

2797  -
ENOMEM
;

2799 
cmd
 = (
wmi_ibss_pm_ˇps_cmd
 *Ë
skb
->
d©a
;

2800 
cmd
->
powî_ßvög
 = 
adhoc_ps_ty≥
;

2801 
cmd
->
âl
 =Åtl;

2802 
cmd
->
©im_wödows
 =átim_windows;

2803 
cmd
->
timeout_vÆue
 =Åimeout_value;

2805 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_IBSS_PM_CAPS_CMDID
,

2806 
NO_SYNC_WMIFLAG
);

2807  
ªt
;

2808 
	}
}

2811 
	$©h6kl_wmi_dis˘imeout_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
timeout
)

2813 
sk_buff
 *
skb
;

2814 
wmi_disc_timeout_cmd
 *
cmd
;

2815 
ªt
;

2817 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2818 i‡(!
skb
)

2819  -
ENOMEM
;

2821 
cmd
 = (
wmi_disc_timeout_cmd
 *Ë
skb
->
d©a
;

2822 
cmd
->
disc⁄_timeout
 = 
timeout
;

2824 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_DISC_TIMEOUT_CMDID
,

2825 
NO_SYNC_WMIFLAG
);

2827 i‡(
ªt
 == 0)

2828 
	`©h6kl_debug_£t_disc⁄√˘_timeout
(
wmi
->
∑ª¡_dev
, 
timeout
);

2830  
ªt
;

2831 
	}
}

2833 
	$©h6kl_wmi_addkey_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
key_ödex
,

2834 
¸y±o_ty≥
 
key_ty≥
,

2835 
u8
 
key_ußge
, u8 
key_Àn
,

2836 
u8
 *
key_rsc
, 
key_rsc_Àn
,

2837 
u8
 *
key_m©îül
,

2838 
u8
 
key_›_˘æ
, u8 *
mac_addr
,

2839 
wmi_sync_Êag
 
sync_Êag
)

2841 
sk_buff
 *
skb
;

2842 
wmi_add_cùhî_key_cmd
 *
cmd
;

2843 
ªt
;

2845 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "addkey cmd: key_index=%u key_type=%d "

2847 
key_ödex
, 
key_ty≥
, 
key_ußge
, 
key_Àn
, 
key_›_˘æ
);

2849 i‡((
key_ödex
 > 
WMI_MAX_KEY_INDEX
Ë|| (
key_Àn
 > 
WMI_MAX_KEY_LEN
) ||

2850 (
key_m©îül
 =
NULL
Ë|| 
key_rsc_Àn
 > 8)

2851  -
EINVAL
;

2853 i‡((
WEP_CRYPT
 !
key_ty≥
Ë&& (
NULL
 =
key_rsc
))

2854  -
EINVAL
;

2856 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2857 i‡(!
skb
)

2858  -
ENOMEM
;

2860 
cmd
 = (
wmi_add_cùhî_key_cmd
 *Ë
skb
->
d©a
;

2861 
cmd
->
key_ödex
 = key_index;

2862 
cmd
->
key_ty≥
 = key_type;

2863 
cmd
->
key_ußge
 = key_usage;

2864 
cmd
->
key_Àn
 = key_len;

2865 
	`mem˝y
(
cmd
->
key
, 
key_m©îül
, 
key_Àn
);

2867 i‡(
key_rsc
 !
NULL
)

2868 
	`mem˝y
(
cmd
->
key_rsc
, key_rsc, 
key_rsc_Àn
);

2870 
cmd
->
key_›_˘æ
 = key_op_ctrl;

2872 i‡(
mac_addr
)

2873 
	`mem˝y
(
cmd
->
key_mac_addr
, 
mac_addr
, 
ETH_ALEN
);

2875 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_ADD_CIPHER_KEY_CMDID
,

2876 
sync_Êag
);

2878  
ªt
;

2879 
	}
}

2881 #ifde‡
PMF_SUPPORT


2882 
	$©h6kl_wmi_addkey_igtk_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
key_ödex
,

2883 
u8
 
key_Àn
, u8 *
key_rsc
, u8 *
key_m©îül
,

2884 
wmi_sync_Êag
 
sync_Êag
)

2886 
sk_buff
 *
skb
;

2887 
wmi_add_igtk_cmd
 *
cmd
;

2888 
ªt
;

2890 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "addkey_igtk cmd: key_index=%u "

2891 "key_Àn=%d\n", 
key_ödex
, 
key_Àn
);

2893 i‡((
key_ödex
 > 
WMI_MAX_IGTK_INDEX
) ||

2894 (
key_ödex
 < 
WMI_MIN_IGTK_INDEX
) ||

2895 (
key_Àn
 > 
WMI_IGTK_KEY_LEN
) ||

2896 (
key_m©îül
 =
NULL
Ë|| (NULL =
key_rsc
))

2897  -
EINVAL
;

2899 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2900 i‡(!
skb
)

2901  -
ENOMEM
;

2903 
cmd
 = (
wmi_add_igtk_cmd
 *)
skb
->
d©a
;

2904 
cmd
->
key_ödex
 = key_index;

2905 
cmd
->
key_Àn
 = key_len;

2906 
	`mem˝y
(
cmd
->
key
, 
key_m©îül
, 
key_Àn
);

2907 
	`mem˝y
(
cmd
->
key_rsc
, key_rsc, 6);

2909 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_IGTK_CMDID
,

2910 
sync_Êag
);

2912  
ªt
;

2913 
	}
}

2916 
	$©h6kl_wmi_add_krk_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 *
krk
)

2918 
sk_buff
 *
skb
;

2919 
wmi_add_krk_cmd
 *
cmd
;

2920 
ªt
;

2922 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2923 i‡(!
skb
)

2924  -
ENOMEM
;

2926 
cmd
 = (
wmi_add_krk_cmd
 *Ë
skb
->
d©a
;

2927 
	`mem˝y
(
cmd
->
krk
, krk, 
WMI_KRK_LEN
);

2929 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_ADD_KRK_CMDID
,

2930 
NO_SYNC_WMIFLAG
);

2932  
ªt
;

2933 
	}
}

2935 
	$©h6kl_wmi_dñëekey_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
key_ödex
)

2937 
sk_buff
 *
skb
;

2938 
wmi_dñëe_cùhî_key_cmd
 *
cmd
;

2939 
ªt
;

2941 i‡(
key_ödex
 > 
WMI_MAX_KEY_INDEX
)

2942  -
EINVAL
;

2944 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2945 i‡(!
skb
)

2946  -
ENOMEM
;

2948 
cmd
 = (
wmi_dñëe_cùhî_key_cmd
 *Ë
skb
->
d©a
;

2949 
cmd
->
key_ödex
 = key_index;

2951 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_DELETE_CIPHER_KEY_CMDID
,

2952 
NO_SYNC_WMIFLAG
);

2954  
ªt
;

2955 
	}
}

2957 
	$©h6kl_wmi_£çmkid_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, c⁄° u8 *
bssid
,

2958 c⁄° 
u8
 *
pmkid
, 
boﬁ
 
£t
)

2960 
sk_buff
 *
skb
;

2961 
wmi_£çmkid_cmd
 *
cmd
;

2962 
ªt
;

2964 i‡(
bssid
 =
NULL
)

2965  -
EINVAL
;

2967 i‡(
£t
 && 
pmkid
 =
NULL
)

2968  -
EINVAL
;

2970 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

2971 i‡(!
skb
)

2972  -
ENOMEM
;

2974 
cmd
 = (
wmi_£çmkid_cmd
 *Ë
skb
->
d©a
;

2975 
	`mem˝y
(
cmd
->
bssid
, bssid, 
ETH_ALEN
);

2976 i‡(
£t
) {

2977 
	`mem˝y
(
cmd
->
pmkid
,Ömkid, (cmd->pmkid));

2978 
cmd
->
íabÀ
 = 
PMKID_ENABLE
;

2980 
	`mem£t
(
cmd
->
pmkid
, 0, (cmd->pmkid));

2981 
cmd
->
íabÀ
 = 
PMKID_DISABLE
;

2984 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_PMKID_CMDID
,

2985 
NO_SYNC_WMIFLAG
);

2987  
ªt
;

2988 
	}
}

2990 
	$©h6kl_wmi_d©a_sync_£nd
(
wmi
 *wmi, 
sk_buff
 *
skb
,

2991 
htc_ídpoöt_id
 
ï_id
, 
u8
 
if_idx
)

2993 
wmi_d©a_hdr
 *
d©a_hdr
;

2994 
ªt
;

2996 i‡(
	`WARN_ON
(
skb
 =
NULL
 || 
ï_id
 =
wmi
->ep_id)) {

2997 
	`dev_k‰ì_skb
(
skb
);

2998  -
EINVAL
;

3001 
	`skb_push
(
skb
, (
wmi_d©a_hdr
));

3003 
d©a_hdr
 = (
wmi_d©a_hdr
 *Ë
skb
->
d©a
;

3004 
d©a_hdr
->
öfo
 = 
SYNC_MSGTYPE
 << 
WMI_DATA_HDR_MSG_TYPE_SHIFT
;

3005 
d©a_hdr
->
öfo3
 = 
	`˝u_to_À16
(
if_idx
 & 
WMI_DATA_HDR_IF_IDX_MASK
);

3007 
ªt
 = 
	`©h6kl_c⁄åﬁ_tx
(
wmi
->
∑ª¡_dev
, 
skb
, 
ï_id
);

3008 i‡(
ªt
)

3009 
	`©h6kl_îr
("wmi sync fail,Ép_id %d if_idx %d\n",

3010 
ï_id
, 
if_idx
);

3012  
ªt
;

3013 
	}
}

3015 
	$©h6kl_wmi_sync_poöt
(
wmi
 *wmi, 
u8
 
if_idx
)

3017 
sk_buff
 *
skb
;

3018 
wmi_sync_cmd
 *
cmd
;

3019 
wmi_d©a_sync_bufs
 
d©a_sync_bufs
[
WMM_NUM_AC
];

3020 
htc_ídpoöt_id
 
ï_id
;

3021 
u8
 
ödex
, 
num_¥i_°ªams
 = 0;

3022 
ªt
 = 0;

3024 
	`mem£t
(
d©a_sync_bufs
, 0, (data_sync_bufs));

3026 
	`•ö_lock_bh
(&
wmi
->
lock
);

3028 
ödex
 = 0; index < 
WMM_NUM_AC
; index++) {

3029 i‡(
wmi
->
Át_pùe_exi°
 & (1 << 
ödex
)) {

3030 
num_¥i_°ªams
++;

3031 
d©a_sync_bufs
[
num_¥i_°ªams
 - 1].
åaffic_˛ass
 =

3032 
ödex
;

3036 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3038 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3039 i‡(!
skb
)

3040  -
ENOMEM
;

3042 
cmd
 = (
wmi_sync_cmd
 *Ë
skb
->
d©a
;

3048 
	`•ö_lock_bh
(&
wmi
->
lock
);

3049 
cmd
->
d©a_sync_m≠
 = 
wmi
->
Át_pùe_exi°
;

3050 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3052 
ödex
 = 0; index < 
num_¥i_°ªams
; index++) {

3053 
d©a_sync_bufs
[
ödex
].
skb
 = 
	`©h6kl_buf_Æloc
(0);

3054 i‡(
d©a_sync_bufs
[
ödex
].
skb
 =
NULL
) {

3055 
ªt
 = -
ENOMEM
;

3064 i‡(
ªt
)

3065 
‰ì_cmd_skb
;

3071 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SYNCHRONIZE_CMDID
,

3072 
NO_SYNC_WMIFLAG
);

3074 i‡(
ªt
)

3075 
‰ì_d©a_skb
;

3078 
skb
 = 
NULL
;

3080 
ödex
 = 0; index < 
num_¥i_°ªams
; index++) {

3082 i‡(
	`WARN_ON
(!
d©a_sync_bufs
[
ödex
].
skb
))

3085 
ï_id
 = 
	`©h6kl_ac2_ídpoöt_id
(
wmi
->
∑ª¡_dev
,

3086 
d©a_sync_bufs
[
ödex
].

3087 
åaffic_˛ass
);

3088 
ªt
 =

3089 
	`©h6kl_wmi_d©a_sync_£nd
(
wmi
, 
d©a_sync_bufs
[
ödex
].
skb
,

3090 
ï_id
, 
if_idx
);

3092 
d©a_sync_bufs
[
ödex
].
skb
 = 
NULL
;

3094 i‡(
ªt
)

3095 
‰ì_d©a_skb
;

3099 
‰ì_cmd_skb
:

3101 i‡(
skb
)

3102 
	`dev_k‰ì_skb
(
skb
);

3104 
‰ì_d©a_skb
:

3105 
ödex
 = 0; index < 
num_¥i_°ªams
; index++) {

3106 i‡(
d©a_sync_bufs
[
ödex
].
skb
 !
NULL
) {

3107 
	`dev_k‰ì_skb
((
sk_buff
 *)
d©a_sync_bufs
[
ödex
].

3108 
skb
);

3111  
ªt
;

3112 
	}
}

3114 
	$©h6kl_wmi_¸óã_p°ªam_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3115 
wmi_¸óã_p°ªam_cmd
 *
∑øms
)

3117 
sk_buff
 *
skb
;

3118 
wmi_¸óã_p°ªam_cmd
 *
cmd
;

3119 
©h6kl
 *
¨
 = 
wmi
->
∑ª¡_dev
;

3120 
boﬁ
 
Áçùe_exi°_f‹_ac
 = 
Ál£
;

3121 
s32
 
mö_phy
 = 0;

3122 
s32
 
nomöÆ_phy
 = 0;

3123 
ªt
;

3125 i‡(!((
∑øms
->
u£r_¥i
 < 8) &&

3126 (
∑øms
->
u£r_¥i
 <= 0x7) &&

3127 (
up_to_ac
[
∑øms
->
u£r_¥i
 & 0x7] =∑øms->
åaffic_˛ass
) &&

3128 (
∑øms
->
åaffic_dúec
 =
UPLINK_TRAFFIC
 ||

3129 
∑øms
->
åaffic_dúec
 =
DNLINK_TRAFFIC
 ||

3130 
∑øms
->
åaffic_dúec
 =
BIDIR_TRAFFIC
) &&

3131 (
∑øms
->
åaffic_ty≥
 =
TRAFFIC_TYPE_APERIODIC
 ||

3132 
∑øms
->
åaffic_ty≥
 =
TRAFFIC_TYPE_PERIODIC
) &&

3133 (
∑øms
->
voi˚_psc_ˇp
 =
DISABLE_FOR_THIS_AC
 ||

3134 
∑øms
->
voi˚_psc_ˇp
 =
ENABLE_FOR_THIS_AC
 ||

3135 
∑øms
->
voi˚_psc_ˇp
 =
ENABLE_FOR_ALL_AC
) &&

3136 (
∑øms
->
tsid
 =
WMI_IMPLICIT_PSTREAM
 ||

3137 
∑øms
->
tsid
 <
WMI_MAX_THINSTREAM
))) {

3138  -
EINVAL
;

3147 
mö_phy
 = ((
	`À32_to_˝u
(
∑øms
->
mö_phy_øã
) / 1000) / 1000);

3150 i‡(
∑øms
->
nomöÆ_phy
 >
mö_phy
) {

3152 
nomöÆ_phy
 = (
∑øms
->nominal_phy * 1000) / 500;

3153 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

3155 
mö_phy
, 
nomöÆ_phy
);

3157 
∑øms
->
nomöÆ_phy
 =Çominal_phy;

3159 
∑øms
->
nomöÆ_phy
 = 0;

3162 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3163 i‡(!
skb
)

3164  -
ENOMEM
;

3166 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

3168 
∑øms
->
åaffic_˛ass
,Ö¨ams->
tsid
);

3170 
cmd
 = (
wmi_¸óã_p°ªam_cmd
 *Ë
skb
->
d©a
;

3171 
	`mem˝y
(
cmd
, 
∑øms
, (*cmd));

3174 i‡((
u32
Ë
∑øms
->
tsid
 =(u32Ë
WMI_IMPLICIT_PSTREAM
) {

3175 
	`•ö_lock_bh
(&
wmi
->
lock
);

3176 
Áçùe_exi°_f‹_ac
 =

3177 
¨
->
ac_°ªam_a˘ive
[
∑øms
->
åaffic_˛ass
];

3178 
wmi
->
Át_pùe_exi°
 |(1 << 
∑øms
->
åaffic_˛ass
);

3179 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3182 
	`•ö_lock_bh
(&
wmi
->
lock
);

3183 
Áçùe_exi°_f‹_ac
 =

3184 
¨
->
ac_°ªam_a˘ive
[
∑øms
->
åaffic_˛ass
];

3185 
wmi
->
°ªam_exi°_f‹_ac
[
∑øms
->
åaffic_˛ass
] |=

3186 (1 << 
∑øms
->
tsid
);

3191 
wmi
->
Át_pùe_exi°
 |(1 << 
∑øms
->
åaffic_˛ass
);

3192 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3200 i‡(!
Áçùe_exi°_f‹_ac
)

3201 
	`©h6kl_ödiˇã_tx_a˘ivôy
(
wmi
->
∑ª¡_dev
,

3202 
∑øms
->
åaffic_˛ass
, 
åue
);

3204 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_CREATE_PSTREAM_CMDID
,

3205 
NO_SYNC_WMIFLAG
);

3206  
ªt
;

3207 
	}
}

3209 
	$©h6kl_wmi_dñëe_p°ªam_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
åaffic_˛ass
,

3210 
u8
 
tsid
)

3212 
sk_buff
 *
skb
;

3213 
wmi_dñëe_p°ªam_cmd
 *
cmd
;

3214 
u16
 
a˘ive_tsids
 = 0;

3215 
ªt
;

3217 i‡(
åaffic_˛ass
 > 3) {

3218 
	`©h6kl_îr
("övÆidÅøffi¯˛ass: %d\n", 
åaffic_˛ass
);

3219  -
EINVAL
;

3222 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3223 i‡(!
skb
)

3224  -
ENOMEM
;

3226 
cmd
 = (
wmi_dñëe_p°ªam_cmd
 *Ë
skb
->
d©a
;

3227 
cmd
->
åaffic_˛ass
 =Åraffic_class;

3228 
cmd
->
tsid
 =Åsid;

3230 
	`•ö_lock_bh
(&
wmi
->
lock
);

3231 
a˘ive_tsids
 = 
wmi
->
°ªam_exi°_f‹_ac
[
åaffic_˛ass
];

3232 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3234 i‡(!(
a˘ive_tsids
 & (1 << 
tsid
))) {

3235 
	`dev_k‰ì_skb
(
skb
);

3236 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

3238 
tsid
, 
åaffic_˛ass
);

3239  -
ENODATA
;

3242 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

3244 
åaffic_˛ass
, 
tsid
);

3246 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_DELETE_PSTREAM_CMDID
,

3247 
SYNC_BEFORE_WMIFLAG
);

3249 
	`•ö_lock_bh
(&
wmi
->
lock
);

3250 
wmi
->
°ªam_exi°_f‹_ac
[
åaffic_˛ass
] &~(1 << 
tsid
);

3251 
a˘ive_tsids
 = 
wmi
->
°ªam_exi°_f‹_ac
[
åaffic_˛ass
];

3252 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3258 i‡(!
a˘ive_tsids
) {

3259 
	`©h6kl_ödiˇã_tx_a˘ivôy
(
wmi
->
∑ª¡_dev
,

3260 
åaffic_˛ass
, 
Ál£
);

3261 
	`•ö_lock_bh
(&
wmi
->
lock
);

3262 
wmi
->
Át_pùe_exi°
 &~(1 << 
åaffic_˛ass
);

3263 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3266  
ªt
;

3267 
	}
}

3269 
	$©h6kl_wmi_£t_ù_cmd
(
wmi
 *wmi, 
wmi_£t_ù_cmd
 *
ù_cmd
)

3271 
sk_buff
 *
skb
;

3272 
wmi_£t_ù_cmd
 *
cmd
;

3273 
ªt
;

3276 i‡((*((
u8
 *Ë&
ù_cmd
->
ùs
[0]) >= 0xE0) ||

3277 (*((
u8
 *Ë&
ù_cmd
->
ùs
[1]) >= 0xE0))

3278  -
EINVAL
;

3280 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_£t_ù_cmd
));

3281 i‡(!
skb
)

3282  -
ENOMEM
;

3284 
cmd
 = (
wmi_£t_ù_cmd
 *Ë
skb
->
d©a
;

3285 
	`mem˝y
(
cmd
, 
ù_cmd
, (
wmi_£t_ù_cmd
));

3287 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_SET_IP_CMDID
,

3288 
NO_SYNC_WMIFLAG
);

3289  
ªt
;

3290 
	}
}

3292 
	$©h6kl_wmi_ªlöquish_im∂icô_p°ªam_¸edôs
(
wmi
 *wmi)

3294 
u16
 
a˘ive_tsids
;

3295 
u8
 
°ªam_exi°
;

3296 
i
;

3304 
	`•ö_lock_bh
(&
wmi
->
lock
);

3305 
°ªam_exi°
 = 
wmi
->
Át_pùe_exi°
;

3306 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3308 
i
 = 0; i < 
WMM_NUM_AC
; i++) {

3309 i‡(
°ªam_exi°
 & (1 << 
i
)) {

3315 
	`•ö_lock_bh
(&
wmi
->
lock
);

3316 
a˘ive_tsids
 = 
wmi
->
°ªam_exi°_f‹_ac
[
i
];

3317 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3323 i‡(!
a˘ive_tsids
) {

3324 
°ªam_exi°
 &~(1 << 
i
);

3329 
	`©h6kl_ödiˇã_tx_a˘ivôy
(
wmi
->
∑ª¡_dev
,

3330 
i
, 
Ál£
);

3336 
	`•ö_lock_bh
(&
wmi
->
lock
);

3337 
wmi
->
Át_pùe_exi°
 = 
°ªam_exi°
;

3338 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

3339 
	}
}

3341 
	$©h6kl_wmi_£t_ho°_¶ìp_mode_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3342 
©h6kl_ho°_mode
 
ho°_mode
)

3344 
sk_buff
 *
skb
;

3345 
wmi_£t_ho°_¶ìp_mode_cmd
 *
cmd
;

3346 
ªt
;

3348 i‡((
ho°_mode
 !
ATH6KL_HOST_MODE_ASLEEP
) &&

3349 (
ho°_mode
 !
ATH6KL_HOST_MODE_AWAKE
)) {

3350 
	`©h6kl_îr
("övÆid ho° sÀï mode: %d\n", 
ho°_mode
);

3351  -
EINVAL
;

3354 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3355 i‡(!
skb
)

3356  -
ENOMEM
;

3358 
cmd
 = (
wmi_£t_ho°_¶ìp_mode_cmd
 *Ë
skb
->
d©a
;

3360 i‡(
ho°_mode
 =
ATH6KL_HOST_MODE_ASLEEP
) {

3361 
	`©h6kl_wmi_ªlöquish_im∂icô_p°ªam_¸edôs
(
wmi
);

3362 
cmd
->
a¶ìp
 = 
	`˝u_to_À32
(1);

3364 
cmd
->
awake
 = 
	`˝u_to_À32
(1);

3366 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

3367 
WMI_SET_HOST_SLEEP_MODE_CMDID
,

3368 
NO_SYNC_WMIFLAG
);

3369  
ªt
;

3370 
	}
}

3373 
	$©h6kl_wmi_ho°_¶ìp_mode_cmd_¥cd_evt_rx
(
wmi
 *wmi,

3374 
©h6kl_vif
 *
vif
)

3376 
©h6kl
 *
¨
 = 
wmi
->
∑ª¡_dev
;

3378 
	`£t_bô
(
HOST_SLEEP_MODE_CMD_PROCESSED
, &
vif
->
Êags
);

3379 
	`wake_up
(&
¨
->
evít_wq
);

3382 
	}
}

3384 
	$©h6kl_wmi_qrf_sˇn_ªsu…_evt_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

3386 
wmi_qrf_sˇn_ªsu…s_evít
 *
ev
 = (wmi_qrf_sˇn_ªsu…s_evíà*)
d©≠
 ;

3388 if(
Àn
 < (
wmi_qrf_sˇn_ªsu…s_evít
))

3389 (-
ENOMEM
);

3391 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_QRF_SCAN_RESULTS_EVENTID %d %02x:%02x:%02x:%02x:%02x:%02x\n",

3392 
ev
->
vÆid
,

3393 
ev
->
mac
[0],

3394 
ev
->
mac
[1],

3395 
ev
->
mac
[2],

3396 
ev
->
mac
[3],

3397 
ev
->
mac
[4],

3398 
ev
->
mac
[5]);

3400 
wmi
->
sˇn_ªsu…_vÆid
 = 
ev
->
vÆid
;

3401 
	`mem˝y
(
wmi
->
sˇn_ªsu…_mac
, 
ev
->
mac
, 
ETH_ALEN
);

3403 
	`wake_up
(&
wmi
->
wmiEvít
);

3406 
	}
}

3408 
	$©h6kl_wmi_£t_wow_mode_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3409 
©h6kl_wow_mode
 
wow_mode
,

3410 
u32
 
fûãr
, 
u16
 
ho°_ªq_dñay
)

3412 
sk_buff
 *
skb
;

3413 
wmi_£t_wow_mode_cmd
 *
cmd
;

3414 
ªt
;

3416 i‡((
wow_mode
 !
ATH6KL_WOW_MODE_ENABLE
) &&

3417 
wow_mode
 !
ATH6KL_WOW_MODE_DISABLE
) {

3418 
	`©h6kl_îr
("övÆid wow mode: %d\n", 
wow_mode
);

3419  -
EINVAL
;

3422 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3423 i‡(!
skb
)

3424  -
ENOMEM
;

3426 
cmd
 = (
wmi_£t_wow_mode_cmd
 *Ë
skb
->
d©a
;

3427 
cmd
->
íabÀ_wow
 = 
	`˝u_to_À32
(
wow_mode
);

3428 
cmd
->
fûãr
 = 
	`˝u_to_À32
(filter);

3429 
cmd
->
ho°_ªq_dñay
 = 
	`˝u_to_À16
(host_req_delay);

3431 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_WOW_MODE_CMDID
,

3432 
NO_SYNC_WMIFLAG
);

3433  
ªt
;

3434 
	}
}

3436 
	$©h6kl_wmi_add_wow_∑âîn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3437 
u8
 
li°_id
, u8 
fûãr_size
,

3438 
u8
 
fûãr_off£t
, u8 *
fûãr
, u8 *
mask
)

3440 
sk_buff
 *
skb
;

3441 
wmi_add_wow_∑âîn_cmd
 *
cmd
;

3442 
u16
 
size
;

3443 
u8
 *
fûãr_mask
;

3444 
ªt
;

3450 
size
 = (*
cmd
Ë+ (2 * 
fûãr_size
);

3452 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

3453 i‡(!
skb
)

3454  -
ENOMEM
;

3456 
cmd
 = (
wmi_add_wow_∑âîn_cmd
 *Ë
skb
->
d©a
;

3457 
cmd
->
fûãr_li°_id
 = 
li°_id
;

3458 
cmd
->
fûãr_size
 = filter_size;

3459 
cmd
->
fûãr_off£t
 = filter_offset;

3461 
	`mem˝y
(
cmd
->
fûãr
, fûãr, 
fûãr_size
);

3463 
fûãr_mask
 = (
u8
 *Ë(
cmd
->
fûãr
 + 
fûãr_size
);

3464 
	`mem˝y
(
fûãr_mask
, 
mask
, 
fûãr_size
);

3466 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_ADD_WOW_PATTERN_CMDID
,

3467 
NO_SYNC_WMIFLAG
);

3469  
ªt
;

3470 
	}
}

3472 
	$©h6kl_wmi_dñ_wow_∑âîn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3473 
u16
 
li°_id
, u16 
fûãr_id
)

3475 
sk_buff
 *
skb
;

3476 
wmi_dñ_wow_∑âîn_cmd
 *
cmd
;

3477 
ªt
;

3479 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3480 i‡(!
skb
)

3481  -
ENOMEM
;

3483 
cmd
 = (
wmi_dñ_wow_∑âîn_cmd
 *Ë
skb
->
d©a
;

3484 
cmd
->
fûãr_li°_id
 = 
	`˝u_to_À16
(
li°_id
);

3485 
cmd
->
fûãr_id
 = 
	`˝u_to_À16
(filter_id);

3487 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_DEL_WOW_PATTERN_CMDID
,

3488 
NO_SYNC_WMIFLAG
);

3489  
ªt
;

3490 
	}
}

3492 
	$©h6kl_wmi_cmd_£nd_xäd
(
wmi
 *wmi, 
sk_buff
 *
skb
,

3493 
wmix_comm™d_id
 
cmd_id
,

3494 
wmi_sync_Êag
 
sync_Êag
)

3496 
wmix_cmd_hdr
 *
cmd_hdr
;

3497 
ªt
;

3499 
	`skb_push
(
skb
, (
wmix_cmd_hdr
));

3501 
cmd_hdr
 = (
wmix_cmd_hdr
 *Ë
skb
->
d©a
;

3502 
cmd_hdr
->
cmd_id
 = 
	`˝u_to_À32
(cmd_id);

3504 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_EXTENSION_CMDID
, 
sync_Êag
);

3506  
ªt
;

3507 
	}
}

3509 
	$©h6kl_wmi_gë_chÆÀnge_ª•_cmd
(
wmi
 *wmi, 
u32
 
cookõ
, u32 
sour˚
)

3511 
sk_buff
 *
skb
;

3512 
wmix_hb_chÆÀnge_ª•_cmd
 *
cmd
;

3513 
ªt
;

3515 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3516 i‡(!
skb
)

3517  -
ENOMEM
;

3519 
cmd
 = (
wmix_hb_chÆÀnge_ª•_cmd
 *Ë
skb
->
d©a
;

3520 
cmd
->
cookõ
 = 
	`˝u_to_À32
(cookie);

3521 
cmd
->
sour˚
 = 
	`˝u_to_À32
(source);

3523 
ªt
 = 
	`©h6kl_wmi_cmd_£nd_xäd
(
wmi
, 
skb
, 
WMIX_HB_CHALLENGE_RESP_CMDID
,

3524 
NO_SYNC_WMIFLAG
);

3525  
ªt
;

3526 
	}
}

3528 
	$©h6kl_wmi_c⁄fig_debug_moduÀ_cmd
(
wmi
 *wmi, 
u32
 
vÆid
, u32 
c⁄fig
)

3530 
©h6kl_wmix_dbglog_cfg_moduÀ_cmd
 *
cmd
;

3531 
sk_buff
 *
skb
;

3532 
ªt
;

3534 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3535 i‡(!
skb
)

3536  -
ENOMEM
;

3538 
cmd
 = (
©h6kl_wmix_dbglog_cfg_moduÀ_cmd
 *Ë
skb
->
d©a
;

3539 
cmd
->
vÆid
 = 
	`˝u_to_À32
(valid);

3540 
cmd
->
c⁄fig
 = 
	`˝u_to_À32
(config);

3542 
ªt
 = 
	`©h6kl_wmi_cmd_£nd_xäd
(
wmi
, 
skb
, 
WMIX_DBGLOG_CFG_MODULE_CMDID
,

3543 
NO_SYNC_WMIFLAG
);

3544  
ªt
;

3545 
	}
}

3547 
	$©h6kl_wmi_gë_°©s_cmd
(
wmi
 *wmi, 
u8
 
if_idx
)

3549  
	`©h6kl_wmi_sim∂e_cmd
(
wmi
, 
if_idx
, 
WMI_GET_STATISTICS_CMDID
);

3550 
	}
}

3552 
	$©h6kl_wmi_£t_tx_pwr_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
dbM
)

3554 
sk_buff
 *
skb
;

3555 
wmi_£t_tx_pwr_cmd
 *
cmd
;

3556 
ªt
;

3558 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_£t_tx_pwr_cmd
));

3559 i‡(!
skb
)

3560  -
ENOMEM
;

3562 
cmd
 = (
wmi_£t_tx_pwr_cmd
 *Ë
skb
->
d©a
;

3563 
cmd
->
dbM
 = dbM;

3565 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_TX_PWR_CMDID
,

3566 
NO_SYNC_WMIFLAG
);

3568  
ªt
;

3569 
	}
}

3571 
	$©h6kl_wmi_gë_tx_pwr_cmd
(
wmi
 *wmi, 
u8
 
if_idx
)

3573  
	`©h6kl_wmi_sim∂e_cmd
(
wmi
, 
if_idx
, 
WMI_GET_TX_PWR_CMDID
);

3574 
	}
}

3576 
	$©h6kl_wmi_gë_rﬂm_tbl_cmd
(
wmi
 *wmi)

3578  
	`©h6kl_wmi_sim∂e_cmd
(
wmi
, 0, 
WMI_GET_ROAM_TBL_CMDID
);

3579 
	}
}

3581 
	$©h6kl_wmi_£t_ÕªambÀ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
°©us
,

3582 
u8
 
¥ómbÀ_pﬁicy
)

3584 
sk_buff
 *
skb
;

3585 
wmi_£t_ÕªambÀ_cmd
 *
cmd
;

3586 
ªt
;

3588 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_£t_ÕªambÀ_cmd
));

3589 i‡(!
skb
)

3590  -
ENOMEM
;

3592 
cmd
 = (
wmi_£t_ÕªambÀ_cmd
 *Ë
skb
->
d©a
;

3593 
cmd
->
°©us
 = status;

3594 
cmd
->
¥ómbÀ_pﬁicy
 =Öreamble_policy;

3596 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_LPREAMBLE_CMDID
,

3597 
NO_SYNC_WMIFLAG
);

3598  
ªt
;

3599 
	}
}

3601 
	$©h6kl_wmi_£t_πs_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
thªshﬁd
)

3603 
sk_buff
 *
skb
;

3604 
wmi_£t_πs_cmd
 *
cmd
;

3605 
ªt
;

3607 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_£t_πs_cmd
));

3608 i‡(!
skb
)

3609  -
ENOMEM
;

3611 
cmd
 = (
wmi_£t_πs_cmd
 *Ë
skb
->
d©a
;

3612 
cmd
->
thªshﬁd
 = 
	`˝u_to_À16
(threshold);

3614 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_RTS_CMDID
,

3615 
NO_SYNC_WMIFLAG
);

3616  
ªt
;

3617 
	}
}

3619 
	$©h6kl_wmi_£t_wmm_tx›
(
wmi
 *wmi, 
u8
 
if_idx
, 
wmi_tx›_cfg
 
cfg
)

3621 
sk_buff
 *
skb
;

3622 
wmi_£t_wmm_tx›_cmd
 *
cmd
;

3623 
ªt
;

3625 i‡(!((
cfg
 =
WMI_TXOP_DISABLED
Ë|| (cfg =
WMI_TXOP_ENABLED
)))

3626  -
EINVAL
;

3628 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_£t_wmm_tx›_cmd
));

3629 i‡(!
skb
)

3630  -
ENOMEM
;

3632 
cmd
 = (
wmi_£t_wmm_tx›_cmd
 *Ë
skb
->
d©a
;

3633 
cmd
->
tx›_íabÀ
 = 
cfg
;

3635 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_WMM_TXOP_CMDID
,

3636 
NO_SYNC_WMIFLAG
);

3637  
ªt
;

3638 
	}
}

3640 
	$©h6kl_wmi_£t_kì∑live_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3641 
u8
 
kìp_Æive_ötvl
)

3643 
sk_buff
 *
skb
;

3644 
wmi_£t_kì∑live_cmd
 *
cmd
;

3645 
ªt
;

3647 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3648 i‡(!
skb
)

3649  -
ENOMEM
;

3651 
cmd
 = (
wmi_£t_kì∑live_cmd
 *Ë
skb
->
d©a
;

3652 
cmd
->
kìp_Æive_ötvl
 = keep_alive_intvl;

3654 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_KEEPALIVE_CMDID
,

3655 
NO_SYNC_WMIFLAG
);

3657 i‡(
ªt
 == 0)

3658 
	`©h6kl_debug_£t_kì∑live
(
wmi
->
∑ª¡_dev
, 
kìp_Æive_ötvl
);

3660  
ªt
;

3661 
	}
}

3663 
	$©h6kl_wmi_ã°_cmd
(
wmi
 *wmi, *
buf
, 
size_t
 
Àn
)

3665 
sk_buff
 *
skb
;

3666 
ªt
;

3668 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
Àn
);

3669 i‡(!
skb
)

3670  -
ENOMEM
;

3672 
	`mem˝y
(
skb
->
d©a
, 
buf
, 
Àn
);

3674 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_TEST_CMDID
, 
NO_SYNC_WMIFLAG
);

3676  
ªt
;

3677 
	}
}

3679 
	$©h6kl_wmi_£t_ªgdomaö_cmd
(
wmi
 *wmi, c⁄° *
Æpha2
)

3681 
sk_buff
 *
skb
;

3682 
wmi_£t_ªgdomaö_cmd
 *
cmd
;

3684 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3685 i‡(!
skb
)

3686  -
ENOMEM
;

3688 
cmd
 = (
wmi_£t_ªgdomaö_cmd
 *Ë
skb
->
d©a
;

3689 
	`mem˝y
(
cmd
->
iso_«me
, 
Æpha2
, 2);

3690 
cmd
->
Àngth
 = 2;

3692 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "%s:Ñegdomaö = %s\n", 
__func__
, 
Æpha2
);

3694  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
,

3695 
WMI_SET_REGDOMAIN_CMDID
,

3696 
NO_SYNC_WMIFLAG
);

3697 
	}
}

3699 
s32
 
	$©h6kl_wmi_gë_øã
(
s8
 
øã_ödex
)

3701 
u32
 
sgi
 = 0;

3702 i‡(
øã_ödex
 =
RATE_AUTO
)

3705 
sgi
 = (
øã_ödex
 & 0x80) ? 1 : 0;

3707 i‡((
øã_ödex
 & 0x7f) >=

3708 ((
wmi_øã_tbl
)/(wmi_rate_tbl[0])))

3711  
wmi_øã_tbl
[(
u32
Ë(
øã_ödex
&0x7f)][
sgi
];

3712 
	}
}

3714 
s32
 
	$©h6kl_wmi_gë_øã_¨6004
(
s8
 
øã_ödex
)

3716 
u32
 
sgi
 = 0;

3717 i‡(
øã_ödex
 =
RATE_AUTO
)

3720 
sgi
 = (
øã_ödex
 & 0x80) ? 1 : 0;

3722 i‡((
øã_ödex
 & 0x7f) >=

3723 ((
wmi_øã_tbl_¨6004
)/(wmi_rate_tbl_ar6004[0])))

3726  
wmi_øã_tbl_¨6004
[(
u32
Ë(
øã_ödex
&0x7f)][
sgi
];

3727 
	}
}

3729 
	$©h6kl_wmi_gë_pmkid_li°_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
,

3730 
u32
 
Àn
, 
©h6kl_vif
 *
vif
)

3732 
wmi_pmkid_li°_ª∂y
 *
ª∂y
;

3733 
©h6kl
 *
¨
 = 
vif
->ar;

3734 
u32
 
ex≥˘ed_Àn
;

3736 i‡(
Àn
 < (
wmi_pmkid_li°_ª∂y
)) {

3737 i‡(
	`ã°_bô
(
PMKLIST_GET_PEND
, &
vif
->
Êags
)) {

3738 
	`˛ór_bô
(
PMKLIST_GET_PEND
, &
vif
->
Êags
);

3739 
	`wake_up
(&
¨
->
evít_wq
);

3742  -
EINVAL
;

3745 
ª∂y
 = (
wmi_pmkid_li°_ª∂y
 *)
d©≠
;

3746 
ex≥˘ed_Àn
 = (
ª∂y
->
num_pmkid
) +

3747 
	`À32_to_˝u
(
ª∂y
->
num_pmkid
Ë* (
ETH_ALEN
 + 
WMI_PMKID_LEN
);

3749 i‡(
Àn
 < 
ex≥˘ed_Àn
) {

3750 i‡(
	`ã°_bô
(
PMKLIST_GET_PEND
, &
vif
->
Êags
)) {

3751 
	`˛ór_bô
(
PMKLIST_GET_PEND
, &
vif
->
Êags
);

3752 
	`wake_up
(&
¨
->
evít_wq
);

3755  -
EINVAL
;

3758 i‡(
ex≥˘ed_Àn
 <
MAX_PMKID_LIST_SIZE
) {

3759 
	`mem˝y
(
vif
->
pmkid_li°_buf
, 
d©≠
, 
ex≥˘ed_Àn
);

3761 i‡(
	`ã°_bô
(
PMKLIST_GET_PEND
, &
vif
->
Êags
)) {

3762 
	`˛ór_bô
(
PMKLIST_GET_PEND
, &
vif
->
Êags
);

3763 
	`wake_up
(&
¨
->
evít_wq
);

3766 i‡(
	`ã°_bô
(
PMKLIST_GET_PEND
, &
vif
->
Êags
)) {

3767 
	`˛ór_bô
(
PMKLIST_GET_PEND
, &
vif
->
Êags
);

3768 
	`wake_up
(&
¨
->
evít_wq
);

3771  -
EOVERFLOW
;

3775 
	}
}

3777 
	$©h6kl_wmi_addba_ªq_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

3778 
©h6kl_vif
 *
vif
)

3780 
wmi_addba_ªq_evít
 *
cmd
 = (wmi_addba_ªq_evíà*Ë
d©≠
;

3782 
	`aggr_ªcv_addba_ªq_evt
(
vif
, 
cmd
->
tid
,

3783 
	`À16_to_˝u
(
cmd
->
°_£q_no
), cmd->
wö_sz
);

3786 
	}
}

3788 
	$©h6kl_wmi_addba_ª•_evít_rx
(
©h6kl_vif
 *
vif
,

3789 
u8
 *
d©≠
, 
Àn
)

3791 
wmi_addba_ª•_evít
 *
cmd
 =

3792 (
wmi_addba_ª•_evít
 *Ë
d©≠
;

3794 
	`aggr_ªcv_addba_ª•_evt
(
vif
, 
cmd
->
tid
,

3795 
	`À16_to_˝u
(
cmd
->
amsdu_sz
), cmd->
°©us
);

3798 
	}
}

3800 
	$©h6kl_wmi_dñba_ªq_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

3801 
©h6kl_vif
 *
vif
)

3803 
wmi_dñba_evít
 *
cmd
 = (wmi_dñba_evíà*Ë
d©≠
;

3804 
u8
 
is_≥î_öôüt‹
 = 
cmd
->is_peer_initiator;

3806 
	`aggr_ªcv_dñba_ªq_evt
(
vif
, 
cmd
->
tid
, 
is_≥î_öôüt‹
);

3809 
	}
}

3813 
	$©h6kl_wmi_≠_¥ofûe_commô
(
wmi
 *
wmù
, 
u8
 
if_idx
,

3814 
wmi_c⁄√˘_cmd
 *
p
)

3816 
sk_buff
 *
skb
;

3817 
wmi_c⁄√˘_cmd
 *
cm
;

3818 
ªs
;

3820 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cm
));

3821 i‡(!
skb
)

3822  -
ENOMEM
;

3824 
cm
 = (
wmi_c⁄√˘_cmd
 *Ë
skb
->
d©a
;

3825 
	`mem˝y
(
cm
, 
p
, (*cm));

3827 
ªs
 = 
	`©h6kl_wmi_cmd_£nd
(
wmù
, 
if_idx
, 
skb
, 
WMI_AP_CONFIG_COMMIT_CMDID
,

3828 
NO_SYNC_WMIFLAG
);

3829 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "%s:Çw_type=%uáuth_mode=%u ch=%u "

3831 
__func__
, 
p
->
nw_ty≥
,Ö->
auth_mode
, 
	`À16_to_˝u
’->
ch
),

3832 
	`À32_to_˝u
(
p
->
˘æ_Êags
), 
ªs
);

3833  
ªs
;

3834 
	}
}

3836 
	$©h6kl_wmi_≠_£t_mlme
(
wmi
 *
wmù
, 
u8
 
if_idx
, u8 
cmd
, c⁄° u8 *
mac
,

3837 
u16
 
ªas⁄
)

3839 
sk_buff
 *
skb
;

3840 
wmi_≠_£t_mlme_cmd
 *
cm
;

3842 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cm
));

3843 i‡(!
skb
)

3844  -
ENOMEM
;

3846 
cm
 = (
wmi_≠_£t_mlme_cmd
 *Ë
skb
->
d©a
;

3847 
	`mem˝y
(
cm
->
mac
, mac, 
ETH_ALEN
);

3848 
cm
->
ªas⁄
 = 
	`˝u_to_À16
(reason);

3849 
cm
->
cmd
 = cmd;

3851  
	`©h6kl_wmi_cmd_£nd
(
wmù
, 
if_idx
, 
skb
, 
WMI_AP_SET_MLME_CMDID
,

3852 
NO_SYNC_WMIFLAG
);

3853 
	}
}

3855 
	$©h6kl_wmi_p•ﬁl_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

3856 
©h6kl_vif
 *
vif
)

3858 
wmi_p•ﬁl_evít
 *
ev
;

3860 i‡(
Àn
 < (
wmi_p•ﬁl_evít
))

3861  -
EINVAL
;

3863 
ev
 = (
wmi_p•ﬁl_evít
 *Ë
d©≠
;

3865 
	`©h6kl_p•ﬁl_evít
(
vif
, 
	`À16_to_˝u
(
ev
->
aid
));

3868 
	}
}

3870 
	$©h6kl_wmi_dtimexpúy_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
,

3871 
©h6kl_vif
 *
vif
)

3873 
	`©h6kl_dtimexpúy_evít
(
vif
);

3876 
	}
}

3878 
	$©h6kl_wmi_£t_pvb_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
aid
,

3879 
boﬁ
 
Êag
)

3881 
sk_buff
 *
skb
;

3882 
wmi_≠_£t_pvb_cmd
 *
cmd
;

3883 
ªt
;

3885 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_≠_£t_pvb_cmd
));

3886 i‡(!
skb
)

3887  -
ENOMEM
;

3889 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "ath6kl_wmi_set_pvb_cmd:áid=%d flag=%d\n",

3890 
aid
, 
Êag
);

3892 
cmd
 = (
wmi_≠_£t_pvb_cmd
 *Ë
skb
->
d©a
;

3893 
cmd
->
aid
 = 
	`˝u_to_À16
(aid);

3894 
cmd
->
rsvd
 = 
	`˝u_to_À16
(0);

3895 
cmd
->
Êag
 = 
	`˝u_to_À32
(flag);

3897 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_AP_SET_PVB_CMDID
,

3898 
NO_SYNC_WMIFLAG
);

3901 
	}
}

3903 
	$©h6kl_wmi_£t_rx_‰ame_f‹m©_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3904 
u8
 
rx_mëa_vî
,

3905 
boﬁ
 
rx_dŸ11_hdr
, boﬁ 
de‰ag_⁄_ho°
)

3907 
sk_buff
 *
skb
;

3908 
wmi_rx_‰ame_f‹m©_cmd
 *
cmd
;

3909 
ªt
;

3911 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3912 i‡(!
skb
)

3913  -
ENOMEM
;

3915 
cmd
 = (
wmi_rx_‰ame_f‹m©_cmd
 *Ë
skb
->
d©a
;

3916 
cmd
->
dŸ11_hdr
 = 
rx_dŸ11_hdr
 ? 1 : 0;

3917 
cmd
->
de‰ag_⁄_ho°
 = defrag_on_host ? 1 : 0;

3918 
cmd
->
mëa_vî
 = 
rx_mëa_vî
;

3921 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_RX_FRAME_FORMAT_CMDID
,

3922 
NO_SYNC_WMIFLAG
);

3924  
ªt
;

3925 
	}
}

3927 
	$©h6kl_wmi_£t_≠põ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
mgmt_‰m_ty≥
,

3928 c⁄° 
u8
 *
õ
, u8 
õ_Àn
)

3930 
sk_buff
 *
skb
;

3931 
wmi_£t_≠põ_cmd
 *
p
;

3933 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
p
Ë+ 
õ_Àn
);

3934 i‡(!
skb
)

3935  -
ENOMEM
;

3937 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "set_appie_cmd: mgmt_frm_type=%u "

3938 "õ_Àn=%u\n", 
mgmt_‰m_ty≥
, 
õ_Àn
);

3939 
p
 = (
wmi_£t_≠põ_cmd
 *Ë
skb
->
d©a
;

3940 
p
->
mgmt_‰m_ty≥
 = mgmt_frm_type;

3941 
p
->
õ_Àn
 = ie_len;

3942 
	`mem˝y
(
p
->
õ_öfo
, 
õ
, 
õ_Àn
);

3943  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_APPIE_CMDID
,

3944 
NO_SYNC_WMIFLAG
);

3945 
	}
}

3947 
	$©h6kl_wmi_£t_øã_˘æ_cmd
(
wmi
 *wmi,

3948 
u8
 
if_idx
,

3949 
u32
 
øãmode
)

3951 
sk_buff
 *
skb
;

3952 
wmi_£t_øã˘æ_∑rm_cmd
 *
cmd
;

3954 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3955 i‡(!
skb
)

3956  -
ENOMEM
;

3958 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "ath6kl_wmi_setratectrl_cmd: mode=%d\n",

3959 
øãmode
);

3960 
cmd
 = (
wmi_£t_øã˘æ_∑rm_cmd
 *Ë
skb
->
d©a
;

3961 
cmd
->
mode
 = 
øãmode
 ? 1 : 0;

3963  
	`©h6kl_wmi_cmd_£nd
(
wmi
,

3964 
if_idx
,

3965 
skb
,

3966 
WMI_SET_RATECTRL_PARM_CMDID
,

3967 
NO_SYNC_WMIFLAG
);

3968 
	}
}

3970 
	$©h6kl_wmi_dißbÀ_11b_øãs_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
boﬁ
 
dißbÀ
)

3972 
sk_buff
 *
skb
;

3973 
wmi_dißbÀ_11b_øãs_cmd
 *
cmd
;

3975 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

3976 i‡(!
skb
)

3977  -
ENOMEM
;

3979 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "disable_11b_rates_cmd: disable=%u\n",

3980 
dißbÀ
);

3981 
cmd
 = (
wmi_dißbÀ_11b_øãs_cmd
 *Ë
skb
->
d©a
;

3982 
cmd
->
dißbÀ
 = disable ? 1 : 0;

3984  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

3985 
WMI_DISABLE_11B_RATES_CMDID
,

3986 
NO_SYNC_WMIFLAG
);

3987 
	}
}

3989 
	$©h6kl_wmi_ªmaö_⁄_ch∆_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
‰eq
, u32 
dur
)

3991 
sk_buff
 *
skb
;

3992 
wmi_ªmaö_⁄_ch∆_cmd
 *
p
;

3994 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
p
));

3995 i‡(!
skb
)

3996  -
ENOMEM
;

3998 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "remain_on_chnl_cmd: freq=%u dur=%u\n",

3999 
‰eq
, 
dur
);

4000 
p
 = (
wmi_ªmaö_⁄_ch∆_cmd
 *Ë
skb
->
d©a
;

4001 
p
->
‰eq
 = 
	`˝u_to_À32
(freq);

4002 
p
->
duøti⁄
 = 
	`˝u_to_À32
(
dur
);

4003  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_REMAIN_ON_CHNL_CMDID
,

4004 
NO_SYNC_WMIFLAG
);

4005 
	}
}

4007 
	$©h6kl_wmi_£nd_a˘i⁄_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
id
, u32 
‰eq
,

4008 
u32
 
waô
, c⁄° 
u8
 *
d©a
, 
u16
 
d©a_Àn
)

4010 
sk_buff
 *
skb
;

4011 
wmi_£nd_a˘i⁄_cmd
 *
p
;

4012 
wmi_mgmt_tx_‰ame
 *
mgmt_tx_‰ame
 = 
NULL
;

4013 
õì80211_mgmt
 *
mgmt
 = (õì80211_mgmà*Ë
d©a
;

4014 
u8
 *
buf
 = 
NULL
;

4016 i‡(
waô
)

4017  -
EINVAL
;

4021 i‡((
wmi
->
∑ª¡_dev
->
p2p
) &&

4022 
	`õì80211_is_a˘i⁄
(
mgmt
->
‰ame_c⁄åﬁ
)) {

4023 
buf
 = 
	`kmÆloc
(
d©a_Àn
, 
GFP_KERNEL
);

4024 i‡(!
buf
)

4025  -
ENOMEM
;

4027 
mgmt_tx_‰ame
 = 
	`kmÆloc
(

4028 (
wmi_mgmt_tx_‰ame
), 
GFP_KERNEL
);

4029 i‡(!
mgmt_tx_‰ame
) {

4030 
	`k‰ì
(
buf
);

4031  -
ENOMEM
;

4034 
mgmt_tx_‰ame
->
vif
 =

4035 
	`©h6kl_gë_vif_by_ödex
(
wmi
->
∑ª¡_dev
, 
if_idx
);

4036 
	`WARN_ON
(!
mgmt_tx_‰ame
->
vif
);

4038 
	`mem˝y
(
buf
, 
d©a
, 
d©a_Àn
);

4039 
mgmt_tx_‰ame
->mgmt_tx_‰amê
buf
;

4040 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_Àn
 = 
d©a_Àn
;

4041 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_idx
 = 
id
;

4042 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_‰eq
 = 
‰eq
;

4043 i‡(
	`©h6kl_p2p_‰ame_ªåy
(
wmi
->
∑ª¡_dev
,

4044 (
u8
 *)&(
mgmt
->
u
.
a˘i⁄
),

4045 (
d©a_Àn
 - 24)))

4046 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_ªåy
 =

4047 
WMI_TX_MGMT_RETRY_MAX
;

4049 
mgmt_tx_‰ame
->
mgmt_tx_‰ame_ªåy
 = 0;

4051 
	`li°_add_èû
(&
mgmt_tx_‰ame
->
li°
, &
wmi
->
mgmt_tx_‰ame_li°
);

4054 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
p
Ë+ 
d©a_Àn
);

4055 i‡(!
skb
) {

4056 
	`k‰ì
(
buf
);

4057 i‡(
mgmt_tx_‰ame
) {

4058 
	`li°_dñ
(&
mgmt_tx_‰ame
->
li°
);

4059 
	`k‰ì
(
mgmt_tx_‰ame
);

4061  -
ENOMEM
;

4064 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "send_action_cmd: id=%u freq=%u wait=%u "

4065 "Àn=%u\n", 
id
, 
‰eq
, 
waô
, 
d©a_Àn
);

4066 
p
 = (
wmi_£nd_a˘i⁄_cmd
 *Ë
skb
->
d©a
;

4067 
p
->
id
 = 
	`˝u_to_À32
(id);

4068 
p
->
‰eq
 = 
	`˝u_to_À32
(freq);

4069 
p
->
waô
 = 
	`˝u_to_À32
(wait);

4070 
p
->
Àn
 = 
	`˝u_to_À16
(
d©a_Àn
);

4071 
	`mem˝y
(
p
->
d©a
, d©a, 
d©a_Àn
);

4072  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SEND_ACTION_CMDID
,

4073 
NO_SYNC_WMIFLAG
);

4074 
	}
}

4076 
	$©h6kl_wmi_£nd_¥obe_ª•⁄£_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
‰eq
,

4077 c⁄° 
u8
 *
d°
, c⁄° u8 *
d©a
,

4078 
u16
 
d©a_Àn
)

4080 
sk_buff
 *
skb
;

4081 
wmi_p2p_¥obe_ª•⁄£_cmd
 *
p
;

4082 
size_t
 
cmd_Àn
 = (*
p
Ë+ 
d©a_Àn
;

4084 i‡(
d©a_Àn
 == 0)

4085 
cmd_Àn
++;

4087 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
cmd_Àn
);

4088 i‡(!
skb
)

4089  -
ENOMEM
;

4091 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "send_probe_response_cmd: freq=%u dst=%pM "

4092 "Àn=%u\n", 
‰eq
, 
d°
, 
d©a_Àn
);

4093 
p
 = (
wmi_p2p_¥obe_ª•⁄£_cmd
 *Ë
skb
->
d©a
;

4094 
p
->
‰eq
 = 
	`˝u_to_À32
(freq);

4095 
	`mem˝y
(
p
->
de°ö©i⁄_addr
, 
d°
, 
ETH_ALEN
);

4096 
p
->
Àn
 = 
	`˝u_to_À16
(
d©a_Àn
);

4097 
	`mem˝y
(
p
->
d©a
, d©a, 
d©a_Àn
);

4098  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

4099 
WMI_SEND_PROBE_RESPONSE_CMDID
,

4100 
NO_SYNC_WMIFLAG
);

4101 
	}
}

4103 
	$©h6kl_wmi_£nd_go_¥obe_ª•⁄£_cmd
(
wmi
 *wmi,

4104 
©h6kl_vif
 *
vif
, c⁄° 
u8
 *
buf
, 
size_t
 
Àn
, 
‰eq
)

4106 c⁄° 
u8
 *
pos
;

4107 
u8
 *
p2p
, *
wfd
;

4108 
p2p_Àn
, 
wfd_Àn
;

4109 
ªt
;

4110 c⁄° 
õì80211_mgmt
 *
mgmt
;

4112 
mgmt
 = (c⁄° 
õì80211_mgmt
 *Ë
buf
;

4114 
p2p
 = 
	`kmÆloc
(
Àn
, 
GFP_KERNEL
);

4115 i‡(
p2p
 =
NULL
)

4116  -
ENOMEM
;

4117 
p2p_Àn
 = 0;

4119 
wfd
 = 
	`kmÆloc
(
Àn
, 
GFP_KERNEL
);

4120 i‡(
wfd
 =
NULL
) {

4121 
	`k‰ì
(
p2p
);

4122  -
ENOMEM
;

4124 
wfd_Àn
 = 0;

4127 
pos
 = 
mgmt
->
u
.
¥obe_ª•
.
v¨übÀ
;

4128 
pos
 + 1 < 
buf
 + 
Àn
) {

4129 i‡(
pos
 + 2 +Öos[1] > 
buf
 + 
Àn
)

4131 i‡(
	`©h6kl_is_p2p_õ
(
pos
)) {

4132 
	`mem˝y
(
p2p
 + 
p2p_Àn
, 
pos
, 2 +Öos[1]);

4133 
p2p_Àn
 +2 + 
pos
[1];

4134 } i‡(
	`©h6kl_is_wfd_õ
(
pos
)) {

4135 
	`mem˝y
(
wfd
 + 
wfd_Àn
, 
pos
, 2 +Öos[1]);

4136 
wfd_Àn
 +2 + 
pos
[1];

4138 
pos
 += 2 +Öos[1];

4141 
	`©h6kl_p2p_ps_u£r_≠p_õ
(
vif
->
p2p_ps_öfo_˘x
,

4142 
WMI_FRAME_PROBE_RESP
,

4143 &
p2p
,

4144 &
p2p_Àn
);

4147 i‡(
wfd_Àn
) {

4148 
u8
 *
p2p_wfd
;

4150 
p2p_wfd
 = 
	`kmÆloc
(
p2p_Àn
 + 
wfd_Àn
, 
GFP_KERNEL
);

4151 i‡(
p2p_wfd
 =
NULL
) {

4152 
	`k‰ì
(
wfd
);

4153 
	`k‰ì
(
p2p
);

4154  -
ENOMEM
;

4157 
	`mem˝y
(
p2p_wfd
, 
p2p
, 
p2p_Àn
);

4158 
	`mem˝y
(
p2p_wfd
 + 
p2p_Àn
, 
wfd
, 
wfd_Àn
);

4160 
	`k‰ì
(
p2p
);

4161 
p2p
 = 
p2p_wfd
;

4162 
p2p_Àn
 +
wfd_Àn
;

4165 
ªt
 = 
	`©h6kl_wmi_£nd_¥obe_ª•⁄£_cmd
(
wmi
, 
vif
->
fw_vif_idx
, 
‰eq
,

4166 
mgmt
->
da
, 
p2p
, 
p2p_Àn
);

4168 
	`k‰ì
(
p2p
);

4169 
	`k‰ì
(
wfd
);

4171  
ªt
;

4172 
	}
}

4174 
	$©h6kl_wmi_¥obe_ªp‹t_ªq_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
boﬁ
 
íabÀ
)

4176 
sk_buff
 *
skb
;

4177 
wmi_¥obe_ªq_ªp‹t_cmd
 *
p
;

4179 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
p
));

4180 i‡(!
skb
)

4181  -
ENOMEM
;

4183 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "probe_report_req_cmd:Énable=%u\n",

4184 
íabÀ
);

4185 
p
 = (
wmi_¥obe_ªq_ªp‹t_cmd
 *Ë
skb
->
d©a
;

4186 
p
->
íabÀ
 =Énable ? 1 : 0;

4187  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_PROBE_REQ_REPORT_CMDID
,

4188 
NO_SYNC_WMIFLAG
);

4189 
	}
}

4191 
	$©h6kl_wmi_¥obe_ª•_ªp‹t_ªq_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

4192 
boﬁ
 
íabÀ
)

4194 
sk_buff
 *
skb
;

4195 
wmi_¥obe_ª•_ªp‹t_cmd
 *
p
;

4197 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
p
));

4198 i‡(!
skb
)

4199  -
ENOMEM
;

4201 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "probe_resp_report_req_cmd:Énable=%u\n",

4202 
íabÀ
);

4203 
p
 = (
wmi_¥obe_ª•_ªp‹t_cmd
 *Ë
skb
->
d©a
;

4204 
p
->
íabÀ
 =Énable ? 1 : 0;

4205  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

4206 
WMI_SET_CUSTOM_PROBE_RESP_REPORT_CMDID
, 
NO_SYNC_WMIFLAG
);

4207 
	}
}

4209 
	$©h6kl_wmi_öfo_ªq_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
öfo_ªq_Êags
)

4211 
sk_buff
 *
skb
;

4212 
wmi_gë_p2p_öfo
 *
p
;

4214 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
p
));

4215 i‡(!
skb
)

4216  -
ENOMEM
;

4218 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "info_req_cmd: flags=%x\n",

4219 
öfo_ªq_Êags
);

4220 
p
 = (
wmi_gë_p2p_öfo
 *Ë
skb
->
d©a
;

4221 
p
->
öfo_ªq_Êags
 = 
	`˝u_to_À32
(info_req_flags);

4222  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_GET_P2P_INFO_CMDID
,

4223 
NO_SYNC_WMIFLAG
);

4224 
	}
}

4226 
	$©h6kl_wmi_ˇn˚l_ªmaö_⁄_ch∆_cmd
(
wmi
 *wmi, 
u8
 
if_idx
)

4228 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "cancel_remain_on_chnl_cmd\n");

4229  
	`©h6kl_wmi_sim∂e_cmd
(
wmi
, 
if_idx
,

4230 
WMI_CANCEL_REMAIN_ON_CHNL_CMDID
);

4231 
	}
}

4233 
	$wmi_πt_evít_rx
(
wmi
 *
wmù
, 
u8
 *
d©≠
, 
Àn
)

4235 
	`πtm_ªcv
(
d©≠
, 
Àn
);

4237 
	}
}

4239 
	$©h6kl_wmi_c⁄åﬁ_rx_xäd
(
wmi
 *wmi, 
sk_buff
 *
skb
)

4241 
wmix_cmd_hdr
 *
cmd
;

4242 
u32
 
Àn
;

4243 
u16
 
id
;

4244 
u8
 *
d©≠
;

4245 
ªt
 = 0;

4247 i‡(
skb
->
Àn
 < (
wmix_cmd_hdr
)) {

4248 
	`©h6kl_îr
("badÖacket 1\n");

4249  -
EINVAL
;

4252 
cmd
 = (
wmix_cmd_hdr
 *Ë
skb
->
d©a
;

4253 
id
 = 
	`À32_to_˝u
(
cmd
->
cmd_id
);

4255 
	`skb_puŒ
(
skb
, (
wmix_cmd_hdr
));

4257 
d©≠
 = 
skb
->
d©a
;

4258 
Àn
 = 
skb
->len;

4260 
id
) {

4261 
WMIX_HB_CHALLENGE_RESP_EVENTID
:

4262 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmiÉvent hb challengeÑesp\n");

4264 
WMIX_DBGLOG_EVENTID
:

4265 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmòevíàdbglogÜí %d\n", 
Àn
);

4266 
	`©h6kl_debug_fwlog_evít
(
wmi
->
∑ª¡_dev
, 
d©≠
, 
Àn
);

4268 
WMIX_RTT_RESP_EVENTID
:

4269 
	`wmi_πt_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4271 #ifde‡
ATH6KL_DIAGNOSTIC


4272 
WMIX_PKTLOG_EVENTID
:

4273 
	`©h6kl_wmi_pkéog_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4277 
	`©h6kl_w¨n
("unknow¿cmd id 0x%x\n", 
id
);

4278 
ªt
 = -
EINVAL
;

4282  
ªt
;

4283 
	}
}

4285 
	$©h6kl_wmi_rﬂm_tbl_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
Àn
)

4287  
	`©h6kl_debug_rﬂm_tbl_evít
(
wmi
->
∑ª¡_dev
, 
d©≠
, 
Àn
);

4288 
	}
}

4290 
	$©h6kl_wmi_r¢_ˇp_evít_rx
(
©h6kl_vif
 *
vif
,

4291 
u8
 *
d©≠
, 
Àn
)

4293 
wmi_r¢_ˇp_cmd
 *
cmd
 = (wmi_r¢_ˇp_cmd *Ë
d©≠
;

4295 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmòevíàr¢_ˇ∞%04x\n", 
cmd
->
r¢_ˇp
);

4297 
vif
->
œ°_r¢_ˇp
 = 
	`À16_to_˝u
(
cmd
->
r¢_ˇp
);

4300 
	}
}

4302 
	$©h6kl_wmi_nﬂ_öfo_evít_rx
(
©h6kl_vif
 *
vif
,

4303 
u8
 *
d©≠
, 
Àn
)

4305 
wmi_nﬂ_öfo
 *
ev
;

4306 
wmi_nﬂ_des¸ùt‹
 *
nﬂ_des¸ùt‹
;

4307 
i
, 
num_nﬂ
;

4309 i‡(
Àn
 < (*
ev
))

4310  -
EINVAL
;

4312 
ev
 = (
wmi_nﬂ_öfo
 *Ë
d©≠
;

4314 i‡(
ev
->
cou¡
 > 
ATH6KL_P2P_PS_MAX_NOA_DESCRIPTORS
)

4315 
num_nﬂ
 = 
ATH6KL_P2P_PS_MAX_NOA_DESCRIPTORS
;

4317 
num_nﬂ
 = 
ev
->
cou¡
;

4319 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmiÉventÇoa_info,Çum_noa %d "

4320 "íabÀd %d\n", 
num_nﬂ
, 
ev
->
íabÀ
);

4322 i‡(
	`©h6kl_p2p_ps_ª£t_nﬂ
(
vif
->
p2p_ps_öfo_˘x
))

4323  -
EIO
;

4325 i‡((!
ev
->
íabÀ
Ë|| (
num_nﬂ
 == 0))

4326 
upd©e
;

4328 
nﬂ_des¸ùt‹
 = (
wmi_nﬂ_des¸ùt‹
 *)(
ev
->
nﬂs
);

4329 
i
 = 0; i < 
num_nﬂ
; i++) {

4330 
	`©h6kl_p2p_ps_£tup_nﬂ
(
vif
->
p2p_ps_öfo_˘x
, 
i
,

4331 
nﬂ_des¸ùt‹
->
cou¡_‹_ty≥
,

4332 
	`À32_to_˝u
(
nﬂ_des¸ùt‹
->
öãrvÆ
),

4333 
	`À32_to_˝u
(
nﬂ_des¸ùt‹
->
°¨t_‹_off£t
),

4334 
	`À32_to_˝u
(
nﬂ_des¸ùt‹
->
duøti⁄
));

4335 
nﬂ_des¸ùt‹
++;

4338 
upd©e
:

4340 i‡(
	`©h6kl_p2p_ps_upd©e_nŸif
(
vif
->
p2p_ps_öfo_˘x
))

4341  -
EIO
;

4344 
	}
}

4346 
	$©h6kl_wmi_›µs_öfo_evít_rx
(
©h6kl_vif
 *
vif
,

4347 
u8
 *
d©≠
, 
Àn
)

4349 
wmi_›µs_öfo
 *
ev
;

4351 i‡(
Àn
 < (*
ev
))

4352  -
EINVAL
;

4354 
ev
 = (
wmi_›µs_öfo
 *Ë
d©≠
;

4356 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmiÉvent oppps_info, ctwin %d "

4357 "íabÀd %d\n", 
ev
->
˘wö
,Év->
íabÀ
);

4359 i‡(
	`©h6kl_p2p_ps_ª£t_›ps
(
vif
->
p2p_ps_öfo_˘x
))

4360  -
EIO
;

4362 
	`©h6kl_p2p_ps_£tup_›ps
(
vif
->
p2p_ps_öfo_˘x
,

4363 
ev
->
íabÀ
,

4364 (
ev
->
˘wö
 & 0x7f));

4367 i‡(
	`©h6kl_p2p_ps_upd©e_nŸif
(
vif
->
p2p_ps_öfo_˘x
))

4368  -
EIO
;

4371 
	}
}

4373 
	$©h6kl_wmi_p‹t_°©us_evít_rx
(
©h6kl_vif
 *
vif
,

4374 
u8
 *
d©≠
, 
Àn
)

4376 
wmi_p‹t_°©us
 *
ev
;

4378 i‡(
Àn
 < (*
ev
))

4379  -
EINVAL
;

4381 
ev
 = (
wmi_p‹t_°©us
 *Ë
d©≠
;

4384 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmiÉventÖort_status,Öort_id %d status %d"

4386 
ev
->
p‹t_id
,Év->
°©us
, 
vif
->
fw_vif_idx
);

4388 i‡((
ev
->
°©us
 =
ADD_PORT_FAIL
) ||

4389 (
ev
->
°©us
 =
DEL_PORT_FAIL
)) {

4390 
	`©h6kl_îr
("Add_port/Del_portÉrror.\n");

4393 
	`©h6kl_p2p_utûs_check_p‹t
(
vif
, 
ev
->
p‹t_id
);

4396 
	}
}

4399 
	$©h6kl_wmi_wow_ext_wake_evít
(
wmi
 *wmi, 
u8
 *
d©≠
,

4400 
Àn
)

4402 
wmi_wow_evít_wake_evít
 *
ev
;

4404 i‡(
Àn
 < (*
ev
))

4405  -
EINVAL
;

4407 
ev
 = (
wmi_wow_evít_wake_evít
 *Ë
d©≠
;

4409 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "-- wakeup-event --\n");

4410 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, " fœg: %d\n", 
ev
->
Êags
);

4411 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "Åy≥: %d\n", 
ev
->
ty≥
);

4412 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, " vÆue: %d\n", 
ev
->
vÆue
);

4413 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "Ökt_Àn: %d\n", 
ev
->
∑ckë_Àngth
);

4414 if(
ev
->
ty≥
 =
WOW_EXT_WAKE_TYPE_QRF
)

4416 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
,

4417 " mac: %02X:%02X:%02X:%02X:%02X:%02X\n", 
ev
->
wake_d©a
[0]

4418 , 
ev
->
wake_d©a
[1]

4419 , 
ev
->
wake_d©a
[2]

4420 , 
ev
->
wake_d©a
[3]

4421 , 
ev
->
wake_d©a
[4]

4422 , 
ev
->
wake_d©a
[5]);

4425 #ifde‡
ATH6KL_SUPPORT_WLAN_HB


4426 i‡(
ev
->
ty≥
 =
WOW_EXT_WAKE_TYPE_WLAN_HB
) {

4427 
	`©h6kl_wœn_hb_evít
(
wmi
->
∑ª¡_dev
, 
ev
->
vÆue
,Év->
wake_d©a
,

4428 
ev
->
∑ckë_Àngth
);

4433 
	}
}

4435 #ifde‡
ATH6KL_SUPPORT_WIFI_DISC


4436 
	$©h6kl_wmi_disc_≥î_evít_rx
(
u8
 *
d©≠
,

4437 
Àn
, 
©h6kl_vif
 *
vif
)

4439 
©h6kl
 *
¨
 = 
vif
->ar;

4440 
wmi_disc_≥î_evít
 *
ev
;

4441 
u16
 
≥îs_size
;

4442 
u8
 
≥î_num
;

4444 i‡(
Àn
 < (*
ev
))

4445  -
EINVAL
;

4447 
ev
 = (
wmi_disc_≥î_evít
 *Ë
d©≠
;

4448 
≥î_num
 = 
ev
->peer_num;

4449 
≥îs_size
 = (
wmi_disc_≥î
)*
≥î_num
;

4451 
	`©h6kl_tm_disc_evít
(
¨
, 
ev
, (*ev)+
≥îs_size
-1);

4454 
	}
}

4457 
	$©h6kl_wmi_wmm_∑øms_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
,

4458 
Àn
)

4460 
i
;

4461 
wmi_ªp‹t_wmm_∑øms
 *
wmm_∑øms
 =

4462 (
wmi_ªp‹t_wmm_∑øms
 *Ë
d©≠
;

4463 
boﬁ
 
ch™ge
 = 
Ál£
;

4465 
i
 = 0; i < 
WMM_NUM_AC
; i++) {

4466 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "(%d):ácm: %d,áifsn: %d, "

4468 
i
, 
wmm_∑øms
->wmm_∑øms[i].
acm
,

4469 
wmm_∑øms
->wmm_∑øms[
i
].
aif¢
,

4470 
wmm_∑øms
->wmm_∑øms[
i
].
logcwmö
,

4471 
wmm_∑øms
->wmm_∑øms[
i
].
logcwmax
,

4472 
wmm_∑øms
->wmm_∑øms[
i
].
tx›Limô
);

4475 i‡(
wmm_∑øms
->wmm_∑øms[
WMM_AC_BE
].
aif¢
 <

4476 
wmm_∑øms
->wmm_∑øms[
WMM_AC_VI
].
aif¢
)

4477 
ch™ge
 = 
åue
;

4479 
	`©h6kl_ödiˇã_wmm_scheduÀ_ch™ge
(
wmi
->
∑ª¡_dev
, 
ch™ge
);

4482 
	}
}

4484 
	$©h6kl_wmi_assoc_ªq_evít_rx
(
©h6kl_vif
 *
vif
, 
u8
 *
d©≠
,

4485 
Àn
)

4487 
wmi_assoc_ªq_evít
 *
assoc_ªq_evít
 =

4488 (
wmi_assoc_ªq_evít
 *Ë
d©≠
;

4491 i‡(
Àn
 < (*
assoc_ªq_evít
) + 28)

4492  -
EINVAL
;

4494 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmòevíàassoc_ªqÜí %d\n", 
Àn
);

4496 
	`©h6kl_≠_admc_assoc_ªq
(
vif
,

4497 
assoc_ªq_evít
->
assocReq
,

4498 
Àn
 - (
wmi_assoc_ªq_evít
),

4499 
assoc_ªq_evít
->
r•Ty≥
,

4500 
assoc_ªq_evít
->
°©us
);

4503 
	}
}

4506 
	$©h6kl_wmi_c⁄åﬁ_rx
(
wmi
 *wmi, 
sk_buff
 *
skb
)

4508 
wmi_cmd_hdr
 *
cmd
;

4509 
©h6kl_vif
 *
vif
;

4510 
u32
 
Àn
;

4511 
u16
 
id
;

4512 
u8
 
if_idx
;

4513 
u8
 *
d©≠
;

4514 
ªt
 = 0;

4515 
©h6kl
 *
¨
;

4517 i‡(
	`WARN_ON
(
skb
 =
NULL
))

4518  -
EINVAL
;

4520 i‡(
skb
->
Àn
 < (
wmi_cmd_hdr
)) {

4521 
	`©h6kl_îr
("badÖacket 1\n");

4522 
	`dev_k‰ì_skb
(
skb
);

4523  -
EINVAL
;

4526 
cmd
 = (
wmi_cmd_hdr
 *Ë
skb
->
d©a
;

4527 
id
 = 
	`À16_to_˝u
(
cmd
->
cmd_id
);

4528 
if_idx
 = 
	`À16_to_˝u
(
cmd
->
öfo1
Ë& 
WMI_CMD_HDR_IF_ID_MASK
;

4530 
	`skb_puŒ
(
skb
, (
wmi_cmd_hdr
));

4532 
d©≠
 = 
skb
->
d©a
;

4533 
Àn
 = 
skb
->len;

4535 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "wmòrx id %dÜí %d\n", 
id
, 
Àn
);

4536 
	`©h6kl_dbg_dump
(
ATH6KL_DBG_WMI_DUMP
, 
NULL
, "wmiÑx ",

4537 
d©≠
, 
Àn
);

4539 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
wmi
->
∑ª¡_dev
, 
if_idx
);

4540 i‡(!
vif
) {

4541 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

4543 
if_idx
);

4544 
	`dev_k‰ì_skb
(
skb
);

4545  -
EINVAL
;

4548 
¨
 = 
vif
->ar;

4551 i‡(
	`down_öãºu±ibÀ
(&
¨
->
wmi_evt_£m
)) {

4552 
	`©h6kl_îr
("ath6kl_wmi_control_rx busy, couldn't getáccess\n");

4553  -
ERESTARTSYS
;

4556 
id
) {

4557 
WMI_GET_BITRATE_CMDID
:

4558 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_BITRATE_CMDID\n");

4559 
ªt
 = 
	`©h6kl_wmi_bôøã_ª∂y_rx
(
wmi
, 
d©≠
, 
Àn
);

4561 
WMI_GET_CHANNEL_LIST_CMDID
:

4562 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_CHANNEL_LIST_CMDID\n");

4563 
ªt
 = 
	`©h6kl_wmi_ch_li°_ª∂y_rx
(
wmi
, 
d©≠
, 
Àn
);

4565 
WMI_GET_TX_PWR_CMDID
:

4566 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_TX_PWR_CMDID\n");

4567 
ªt
 = 
	`©h6kl_wmi_tx_pwr_ª∂y_rx
(
wmi
, 
d©≠
, 
Àn
);

4569 
WMI_READY_EVENTID
:

4570 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_READY_EVENTID\n");

4571 
ªt
 = 
	`©h6kl_wmi_ªady_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4572 
	`mdñay
(400);

4573 
	`©h6kl_£nd_evít_to_≠p
(
skb
->
dev
, 
id
, skb->dev->
ifödex
,

4574 
d©≠
, 
Àn
);

4576 
WMI_CONNECT_EVENTID
:

4577 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_CONNECT_EVENTID\n");

4578 
ªt
 = 
	`©h6kl_wmi_c⁄√˘_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4579 
	`©h6kl_£nd_gíevít_to_≠p
(
skb
->
dev
, 
id
, skb->dev->
ifödex
,

4580 
d©≠
, 
Àn
);

4582 
WMI_DISCONNECT_EVENTID
:

4583 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_DISCONNECT_EVENTID\n");

4584 
ªt
 = 
	`©h6kl_wmi_disc⁄√˘_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4585 
	`©h6kl_£nd_evít_to_≠p
(
skb
->
dev
, 
id
, skb->dev->
ifödex
,

4586 
d©≠
, 
Àn
);

4588 
WMI_PEER_NODE_EVENTID
:

4589 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_PEER_NODE_EVENTID\n");

4590 
ªt
 = 
	`©h6kl_wmi_≥î_node_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4591 
	`©h6kl_£nd_evít_to_≠p
(
skb
->
dev
, 
id
, skb->dev->
ifödex
,

4592 
d©≠
, 
Àn
);

4594 
WMI_TKIP_MICERR_EVENTID
:

4595 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_TKIP_MICERR_EVENTID\n");

4596 
ªt
 = 
	`©h6kl_wmi_tkù_mi˚º_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4598 
WMI_BSSINFO_EVENTID
:

4599 #ifde‡
ATHTST_SUPPORT


4600 i‡(
	`ã°_bô
(
CE_WMI_SCAN
, &
vif
->
Êags
)) {

4601 
ªt
 = 
	`©h6kl_wmi_˚_gë_sˇnöfo_evít_rx
(
vif
, 
d©≠
,

4602 
Àn
);

4605 i‡(
	`ã°_bô
(
CE_WMI_TESTMODE_RX
, &
vif
->
Êags
)) {

4606 
wmi_bss_öfo_hdr2
 *
bih
;

4607 
u8
 *
buf
;

4609 i‡(
Àn
 <(
wmi_bss_öfo_hdr2
))

4612 
bih
 = (
wmi_bss_öfo_hdr2
 *Ë
d©≠
;

4613 
buf
 = 
d©≠
 + (
wmi_bss_öfo_hdr2
);

4614 
Àn
 -(
wmi_bss_öfo_hdr2
);

4616 i‡(
	`memcmp
(
ã°mode_¥iv©e
.
bssid
, 
bih
->bssid,

4617 (
ã°mode_¥iv©e
.
bssid
)) == 0) {

4618 
	`¥ötk
(

4619 
KERN_DEBUG
 "bss infoÉvt - ch %u, snr %d,Ñssi %d, bssid \"%pM\" "

4621 
bih
->
ch
, bih->
¢r
, bih->¢∏- 95, bih->
bssid
,

4622 
bih
->
‰ame_ty≥
);

4623 
ã°mode_¥iv©e
.
rssi_comböed
 = 
bih
->
¢r
;

4628 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_BSSINFO_EVENTID\n");

4629 
ªt
 = 
	`©h6kl_wmi_bssöfo_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4630 #ifde‡
CE_SUPPORT


4631 
	`©h6kl_wmi_Áke_¥obe_ª•_evít_by_bssöfo
(
wmi
, 
d©≠
,

4632 
Àn
, 
vif
);

4635 
WMI_REGDOMAIN_EVENTID
:

4636 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_REGDOMAIN_EVENTID\n");

4637 
	`©h6kl_wmi_ªgdomaö_evít
(
wmi
, 
d©≠
, 
Àn
);

4639 
WMI_PSTREAM_TIMEOUT_EVENTID
:

4640 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_PSTREAM_TIMEOUT_EVENTID\n");

4641 
ªt
 = 
	`©h6kl_wmi_p°ªam_timeout_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4642 
	`©h6kl_£nd_evít_to_≠p
(
skb
->
dev
, 
id
, skb->dev->
ifödex
,

4643 
d©≠
, 
Àn
);

4645 
WMI_NEIGHBOR_REPORT_EVENTID
:

4646 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_NEIGHBOR_REPORT_EVENTID\n");

4647 
ªt
 = 
	`©h6kl_wmi_√ighb‹_ªp‹t_evít_rx
(
wmi
, 
d©≠
, 
Àn
,

4648 
vif
);

4650 
WMI_SCAN_COMPLETE_EVENTID
:

4651 #ifde‡
ATHTST_SUPPORT


4652 i‡(
	`ã°_bô
(
CE_WMI_SCAN
, &
vif
->
Êags
)) {

4653 
ªt
 = 
	`©h6kl_wmi_˚_£t_sˇn_d⁄e_evít_rx
(
vif
, 
d©≠
,

4654 
Àn
);

4657 i‡(
	`ã°_bô
(
CE_WMI_TESTMODE_RX
, &
vif
->
Êags
)) {

4660 
©hcfg_wcmd_ã°mode_t
 
ã°mode
;

4661 
ã°mode
.
›î©i⁄
 = 
ATHCFG_WCMD_TESTMODE_RX
;

4662 
ã°mode
.
rx
 = 1;

4663 
	`©h6kl_wmi_£t_cu°omî_ã°mode_cmd
(
vif
, &
ã°mode
);

4667 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_SCAN_COMPLETE_EVENTID\n");

4668 
ªt
 = 
	`©h6kl_wmi_sˇn_com∂ëe_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4669 
	`©h6kl_£nd_evít_to_≠p
(
skb
->
dev
, 
id
, skb->dev->
ifödex
,

4670 
d©≠
, 
Àn
);

4672 
WMI_CMDERROR_EVENTID
:

4673 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_CMDERROR_EVENTID\n");

4674 
ªt
 = 
	`©h6kl_wmi_îr‹_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4676 
WMI_REPORT_STATISTICS_EVENTID
:

4677 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_REPORT_STATISTICS_EVENTID\n");

4678 
ªt
 = 
	`©h6kl_wmi_°©s_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4680 
WMI_RSSI_THRESHOLD_EVENTID
:

4681 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_RSSI_THRESHOLD_EVENTID\n");

4682 
ªt
 = 
	`©h6kl_wmi_rssi_thªshﬁd_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4684 
WMI_ERROR_REPORT_EVENTID
:

4685 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_ERROR_REPORT_EVENTID\n");

4686 
	`©h6kl_£nd_evít_to_≠p
(
skb
->
dev
, 
id
, skb->dev->
ifödex
,

4687 
d©≠
, 
Àn
);

4689 
WMI_OPT_RX_FRAME_EVENTID
:

4690 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_OPT_RX_FRAME_EVENTID\n");

4693 
WMI_REPORT_ROAM_TBL_EVENTID
:

4694 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_REPORT_ROAM_TBL_EVENTID\n");

4695 
ªt
 = 
	`©h6kl_wmi_rﬂm_tbl_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4697 
WMI_EXTENSION_EVENTID
:

4698 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_EXTENSION_EVENTID\n");

4699 
ªt
 = 
	`©h6kl_wmi_c⁄åﬁ_rx_xäd
(
wmi
, 
skb
);

4701 
WMI_CAC_EVENTID
:

4702 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_CAC_EVENTID\n");

4703 
ªt
 = 
	`©h6kl_wmi_ˇc_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4705 
WMI_CHANNEL_CHANGE_EVENTID
:

4706 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_CHANNEL_CHANGE_EVENTID\n");

4708 
WMI_REPORT_ROAM_DATA_EVENTID
:

4709 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_REPORT_ROAM_DATA_EVENTID\n");

4711 
WMI_TEST_EVENTID
:

4712 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_TEST_EVENTID\n");

4713 
ªt
 = 
	`©h6kl_wmi_tcmd_ã°_ªp‹t_rx
(
wmi
, 
d©≠
, 
Àn
);

4715 
WMI_GET_FIXRATES_CMDID
:

4716 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_FIXRATES_CMDID\n");

4717 
ªt
 = 
	`©h6kl_wmi_øãmask_ª∂y_rx
(
wmi
, 
d©≠
, 
Àn
);

4719 
WMI_TX_RETRY_ERR_EVENTID
:

4720 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_TX_RETRY_ERR_EVENTID\n");

4721 
	`©h6kl_£nd_evít_to_≠p
(
skb
->
dev
, 
id
, skb->dev->
ifödex
,

4722 
d©≠
, 
Àn
);

4724 
WMI_SNR_THRESHOLD_EVENTID
:

4725 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_SNR_THRESHOLD_EVENTID\n");

4726 
ªt
 = 
	`©h6kl_wmi_¢r_thªshﬁd_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4728 
WMI_LQ_THRESHOLD_EVENTID
:

4729 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_LQ_THRESHOLD_EVENTID\n");

4730 
	`©h6kl_£nd_evít_to_≠p
(
skb
->
dev
, 
id
, skb->dev->
ifödex
,

4731 
d©≠
, 
Àn
);

4733 
WMI_APLIST_EVENTID
:

4734 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_APLIST_EVENTID\n");

4735 
ªt
 = 
	`©h6kl_wmi_≠li°_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4737 
WMI_GET_KEEPALIVE_CMDID
:

4738 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_KEEPALIVE_CMDID\n");

4739 
ªt
 = 
	`©h6kl_wmi_kì∑live_ª∂y_rx
(
wmi
, 
d©≠
, 
Àn
);

4741 
WMI_GET_WOW_LIST_EVENTID
:

4742 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_WOW_LIST_EVENTID\n");

4744 
WMI_GET_PMKID_LIST_EVENTID
:

4745 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_PMKID_LIST_EVENTID\n");

4746 
ªt
 = 
	`©h6kl_wmi_gë_pmkid_li°_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4748 
WMI_PSPOLL_EVENTID
:

4749 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_PSPOLL_EVENTID\n");

4750 
ªt
 = 
	`©h6kl_wmi_p•ﬁl_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4752 
WMI_DTIMEXPIRY_EVENTID
:

4753 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_DTIMEXPIRY_EVENTID\n");

4754 
ªt
 = 
	`©h6kl_wmi_dtimexpúy_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4756 
WMI_SET_PARAMS_REPLY_EVENTID
:

4757 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_SET_PARAMS_REPLY_EVENTID\n");

4759 
WMI_ADDBA_REQ_EVENTID
:

4760 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_ADDBA_REQ_EVENTID\n");

4761 
ªt
 = 
	`©h6kl_wmi_addba_ªq_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4763 
WMI_ADDBA_RESP_EVENTID
:

4764 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_ADDBA_RESP_EVENTID\n");

4765 
ªt
 = 
	`©h6kl_wmi_addba_ª•_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4767 
WMI_DELBA_REQ_EVENTID
:

4768 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_DELBA_REQ_EVENTID\n");

4769 
ªt
 = 
	`©h6kl_wmi_dñba_ªq_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4771 
WMI_REPORT_BTCOEX_CONFIG_EVENTID
:

4772 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

4775 
WMI_REPORT_BTCOEX_STATS_EVENTID
:

4776 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

4779 
WMI_TX_COMPLETE_EVENTID
:

4780 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_TX_COMPLETE_EVENTID\n");

4781 
ªt
 = 
	`©h6kl_wmi_tx_com∂ëe_evít_rx
(
d©≠
, 
Àn
);

4783 
WMI_SET_HOST_SLEEP_MODE_CMD_PROCESSED_EVENTID
:

4784 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

4786 
ªt
 = 
	`©h6kl_wmi_ho°_¶ìp_mode_cmd_¥cd_evt_rx
(
wmi
, 
vif
);

4788 #ifde‡
CONFIG_WLAN_QRF


4789 
WMI_QRF_SCAN_RESULTS_EVENTID
:

4790 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_QRF_SCAN_RESULTS_EVENTID");

4791 
ªt
 = 
	`©h6kl_wmi_qrf_sˇn_ªsu…_evt_rx
(
wmi
, 
d©≠
, 
Àn
);

4794 
WMI_REMAIN_ON_CHNL_EVENTID
:

4795 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_REMAIN_ON_CHNL_EVENTID\n");

4796 
ªt
 = 
	`©h6kl_wmi_ªmaö_⁄_ch∆_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4798 
WMI_CANCEL_REMAIN_ON_CHNL_EVENTID
:

4799 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

4801 
ªt
 = 
	`©h6kl_wmi_ˇn˚l_ªmaö_⁄_ch∆_evít_rx
(
wmi
, 
d©≠
,

4802 
Àn
, 
vif
);

4804 
WMI_TX_STATUS_EVENTID
:

4805 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_TX_STATUS_EVENTID\n");

4806 
ªt
 = 
	`©h6kl_wmi_tx_°©us_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4808 
WMI_RX_PROBE_REQ_EVENTID
:

4809 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_RX_PROBE_REQ_EVENTID\n");

4810 
ªt
 = 
	`©h6kl_wmi_rx_¥obe_ªq_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4812 #ifde‡
CE_SUPPORT


4813 
WMI_RX_PROBE_RESP_EVENTID
:

4814 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_RX_PROBE_RESP_EVENTID\n");

4815 
ªt
 = 
	`©h6kl_wmi_rx_¥obe_ª•_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4818 
WMI_ACL_REJECT_EVENTID
:

4819 #ifde‡
ACL_SUPPORT


4820 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_ACL_REJECT_EVENTID\n");

4821 
ªt
 = 
	`©h6kl_wmi_a˛_ªje˘_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4824 
WMI_P2P_CAPABILITIES_EVENTID
:

4825 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_P2P_CAPABILITIES_EVENTID\n");

4826 
ªt
 = 
	`©h6kl_wmi_p2p_ˇ∑bûôõs_evít_rx
(
d©≠
, 
Àn
);

4828 
WMI_RX_ACTION_EVENTID
:

4829 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_RX_ACTION_EVENTID\n");

4830 
ªt
 = 
	`©h6kl_wmi_rx_a˘i⁄_evít_rx
(
wmi
, 
d©≠
, 
Àn
, 
vif
);

4832 
WMI_P2P_INFO_EVENTID
:

4833 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_P2P_INFO_EVENTID\n");

4834 
ªt
 = 
	`©h6kl_wmi_p2p_öfo_evít_rx
(
d©≠
, 
Àn
);

4836 
WMI_GET_RSN_CAP_EVENTID
:

4837 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_RSN_CAP_EVENTID\n");

4838 
ªt
 = 
	`©h6kl_wmi_r¢_ˇp_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4840 
WMI_FLOWCTRL_IND_EVENTID
:

4841 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_FLOWCTRL_IND_EVENTID\n");

4842 
ªt
 = 
	`©h6kl_wmi_Êow˘æ_öd_evít_rx
(
d©≠
, 
Àn
, 
vif
);

4844 
WMI_NOA_INFO_EVENTID
:

4845 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_NOA_INFO_EVENTID\n");

4846 
ªt
 = 
	`©h6kl_wmi_nﬂ_öfo_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4848 
WMI_OPPPS_INFO_EVENTID
:

4849 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_OPPPS_INFO_EVENTID\n");

4850 
ªt
 = 
	`©h6kl_wmi_›µs_öfo_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4852 
WMI_PORT_STATUS_EVENTID
:

4853 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_PORT_STATUS_EVENTID\n");

4854 
ªt
 = 
	`©h6kl_wmi_p‹t_°©us_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4856 #ifde‡
ATH6KL_DIAGNOSTIC


4857 
WMI_DIAGNOSTIC_EVENTID
:

4858 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_DIAGNOSTIC_EVENTID\n");

4859 
ªt
 = 
	`©h6kl_wmi_düg_evít
(
vif
, 
wmi
, 
skb
);

4862 
WMI_WOW_EXT_WAKE_EVENTID
:

4863 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_WOW_EXT_WAKE_EVENTID\n");

4864 
ªt
 = 
	`©h6kl_wmi_wow_ext_wake_evít
(
wmi
, 
d©≠
, 
Àn
);

4866 #ifde‡
ATH6KL_SUPPORT_WIFI_DISC


4867 
WMI_DISC_PEER_EVENTID
:

4868 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_DISC_PEER_EVENTID\n");

4869 
ªt
 = 
	`©h6kl_wmi_disc_≥î_evít_rx
(
d©≠
, 
Àn
, 
vif
);

4872 
WMI_REPORT_WMM_PARAMS_EVENTID
:

4873 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_REPORT_WMM_PARAMS_EVENTID\n");

4874 
ªt
 = 
	`©h6kl_wmi_wmm_∑øms_evít_rx
(
wmi
, 
d©≠
, 
Àn
);

4876 
WMI_ASSOC_REQ_EVENTID
:

4877 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_ASSOC_REQ_EVENTID\n");

4878 
ªt
 = 
	`©h6kl_wmi_assoc_ªq_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4880 #ifde‡
ATHTST_SUPPORT


4881 
WMI_GET_REG_EVENTID
:

4882 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "%s[%d] WMI_GET_REG_EVENTID\n",

4883 
__func__
, 
__LINE__
);

4884 
ªt
 = 
	`©h6kl_wmi_˚_gë_ªg_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4886 
WMI_GET_STAINFO_EVENTID
:

4887 
ªt
 = 
	`©h6kl_wmi_˚_gë_°aöfo_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4889 
WMI_GET_TXPOW_EVENTID
:

4890 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "%s[%d] WMI_GET_TXPOW_EVENTID\n",

4891 
__func__
, 
__LINE__
);

4892 
ªt
 = 
	`©h6kl_wmi_˚_gë_txpow_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4894 
WMI_GET_VERSION_INFO_EVENTID
:

4895 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "%s[%d] WMI_GET_VERSION_INFO_EVENTID\n",

4896 
__func__
, 
__LINE__
);

4897 
ªt
 = 
	`©h6kl_wmi_˚_gë_vîsi⁄_öfo_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4899 
WMI_GET_TESTMODE_EVENTID
:

4900 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "%s[%d] WMI_GET_TESTMODE_EVENTID\n",

4901 
__func__
, 
__LINE__
);

4902 
ªt
 = 
	`©h6kl_wmi_˚_gë_ã°mode_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4904 #i‡
	`deföed
(
CE_CUSTOM_1
)

4905 
WMI_GET_WIDIMODE_EVENTID
:

4906 
ªt
 = 
	`©h6kl_wmi_˚_gë_widimode_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4910 
WMI_GET_ANTDIVSTAT_CMDID
:

4911 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_ANTDIVSTAT_CMDID\n");

4912 
ªt
 = 
	`©h6kl_wmi_™tdiv°©e_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4914 
WMI_GET_ANISTAT_CMDID
:

4915 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_ANISTAT_CMDID\n");

4916 
ªt
 = 
	`©h6kl_wmi_™i°©e_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4918 #ifde‡
CE_SUPPORT


4919 
WMI_CSA_EVENTID
:

4920 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_CSA_EVENTID\n");

4921 
ªt
 = 
	`©h6kl_wmi_cß_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4923 
WMI_GET_CTL_EVENTID
:

4924 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "WMI_GET_CTL_EVENTID\n");

4925 
ªt
 = 
	`©h6kl_wmi_˚_gë_˘l_evít_rx
(
vif
, 
d©≠
, 
Àn
);

4929 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "unknow¿cmd id 0x%x\n", 
id
);

4930 
ªt
 = -
EINVAL
;

4933 
	`up
(&
¨
->
wmi_evt_£m
);

4935 
	`dev_k‰ì_skb
(
skb
);

4937  
ªt
;

4938 
	}
}

4940 
	$©h6kl_wmi_ª£t
(
wmi
 *wmi)

4942 
	`•ö_lock_bh
(&
wmi
->
lock
);

4944 
wmi
->
Át_pùe_exi°
 = 0;

4945 
	`mem£t
(
wmi
->
°ªam_exi°_f‹_ac
, 0, (wmi->stream_exist_for_ac));

4947 
	`•ö_u∆ock_bh
(&
wmi
->
lock
);

4948 
	}
}

4950 *
	$©h6kl_wmi_öô
(
©h6kl
 *
dev
)

4952 
wmi
 *wmi;

4954 
wmi
 = 
	`kzÆloc
((wmi), 
GFP_KERNEL
);

4955 i‡(!
wmi
)

4956  
NULL
;

4958 
	`•ö_lock_öô
(&
wmi
->
lock
);

4960 
	`öô_waôqueue_hód
(&
wmi
->
wmiEvít
);

4962 
wmi
->
∑ª¡_dev
 = 
dev
;

4964 
wmi
->
pwr_mode
 = 
REC_POWER
;

4966 
	`INIT_LIST_HEAD
(&
wmi
->
mgmt_tx_‰ame_li°
);

4968 
	`©h6kl_wmi_ª£t
(
wmi
);

4970 #ifde‡
ATH6KL_DIAGNOSTIC


4971 
globÆwmi
 = 
wmi
;

4974  
wmi
;

4975 
	}
}

4977 
	$©h6kl_wmi_shutdown
(
wmi
 *wmi)

4979 
wmi_mgmt_tx_‰ame
 *
mgmt_tx_‰ame
, *
tmp
;

4981 i‡(!
wmi
)

4984 
	`li°_f‹_óch_íåy_ß„
(
mgmt_tx_‰ame
, 
tmp
,

4985 &
wmi
->
mgmt_tx_‰ame_li°
, 
li°
) {

4986 
	`li°_dñ
(&
mgmt_tx_‰ame
->
li°
);

4987 
	`k‰ì
(
mgmt_tx_‰ame
->mgmt_tx_frame);

4988 
	`k‰ì
(
mgmt_tx_‰ame
);

4990 
	`k‰ì
(
wmi
);

4991 
	}
}

4994 
	$wmi_πt_ªq
(
wmi
 *
wmù
, 
wmi_cmd_id
 
cmd_id
, *
d©a
, 
u32
 
Àn
)

4996 
sk_buff
 *
skb
;

4997 
°©us
;

4998 *
cmd
 = 
NULL
;

5000 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
Àn
);

5001 i‡(
skb
 =
NULL
) {

5002 
	`©h6kl_dbg
(
ATH6KL_DBG_RTT
, "RTTREQ Failed To get WMI Buffer");

5003  -
ENOMEM
;

5006 
cmd
 = 
skb
->
d©a
;

5007 
	`mem£t
(
cmd
, 0, 
Àn
);

5008 
	`mem˝y
(
cmd
, 
d©a
, 
Àn
);

5010 
°©us
 = 
	`©h6kl_wmi_cmd_£nd
(
wmù
, 0, 
skb
, 
cmd_id
,

5011 
NO_SYNC_WMIFLAG
);

5012  
°©us
;

5013 
	}
}

5015 
	$©h6kl_wmi_£t_gªí_tx_∑øms
(
wmi
 *wmi,

5016 
wmi_gªí_tx_∑øms
 *
∑øms
)

5018 
sk_buff
 *
skb
;

5019 
wmi_gªí_tx_∑øms
 *
cmd
;

5020 
ªt
 = 0;

5022 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_gªí_tx_∑øms
));

5024 i‡(
skb
 =
NULL
)

5025  -
ENOMEM
;

5027 
cmd
 = (
wmi_gªí_tx_∑øms
 *)
skb
->
d©a
;

5028 
	`mem£t
(
cmd
, 0, (
wmi_gªí_tx_∑øms
));

5030 
	`mem˝y
(
cmd
, 
∑øms
, (
wmi_gªí_tx_∑øms
));

5033 
cmd
->
íabÀ
 = 
	`˝u_to_À32
(cmd->enable);

5035 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
,

5036 
WMI_GREENTX_PARAMS_CMDID
, 
NO_SYNC_WMIFLAG
);

5038  
ªt
;

5039 
	}
}

5041 
	$©h6kl_wmi_smps_c⁄fig
(
wmi
 *wmi, 
wmi_c⁄fig_smps_cmd
 *
›ti⁄s
)

5043 
sk_buff
 *
skb
;

5044 
wmi_c⁄fig_smps_cmd
 *
cmd
;

5045 
ªt
 = 0;

5047 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_c⁄fig_smps_cmd
));

5049 i‡(
skb
 =
NULL
)

5050  -
ENOMEM
;

5052 
cmd
 = (
wmi_c⁄fig_smps_cmd
 *)
skb
->
d©a
;

5053 
	`mem£t
(
cmd
, 0, (
wmi_c⁄fig_smps_cmd
));

5055 
	`mem˝y
(
cmd
, 
›ti⁄s
, (
wmi_c⁄fig_smps_cmd
));

5057 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
,

5058 
WMI_SMPS_CONFIG_CMDID
, 
NO_SYNC_WMIFLAG
);

5060  
ªt
;

5061 
	}
}

5063 
	$©h6kl_wmi_smps_íabÀ
(
wmi
 *wmi,

5064 
wmi_c⁄fig_íabÀ_cmd
 *
›ti⁄s
)

5066 
sk_buff
 *
skb
;

5067 
wmi_c⁄fig_íabÀ_cmd
 *
cmd
;

5068 
ªt
 = 0;

5070 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_c⁄fig_íabÀ_cmd
));

5072 i‡(
skb
 =
NULL
)

5073  -
ENOMEM
;

5075 
cmd
 = (
wmi_c⁄fig_íabÀ_cmd
 *)
skb
->
d©a
;

5076 
	`mem£t
(
cmd
, 0, (
wmi_c⁄fig_íabÀ_cmd
));

5078 
	`mem˝y
(
cmd
, 
›ti⁄s
, (
wmi_c⁄fig_íabÀ_cmd
));

5080 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
,

5081 
WMI_SMPS_ENABLE_CMDID
, 
NO_SYNC_WMIFLAG
);

5083  
ªt
;

5084 
	}
}

5086 
	$©h6kl_wmi_Õl_íabÀ_cmd
(
wmi
 *wmi,

5087 
wmi_Õl_f‹˚_íabÀ_cmd
 *
f‹˚_íabÀ_cmd
)

5089 
sk_buff
 *
skb
;

5090 
wmi_Õl_f‹˚_íabÀ_cmd
 *
cmd
;

5091 
ªt
 = 0;

5093 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_Õl_f‹˚_íabÀ_cmd
));

5095 i‡(
skb
 =
NULL
)

5096  -
ENOMEM
;

5098 
cmd
 = (
wmi_Õl_f‹˚_íabÀ_cmd
 *)
skb
->
d©a
;

5099 
	`mem£t
(
cmd
, 0, (
wmi_Õl_f‹˚_íabÀ_cmd
));

5101 
	`mem˝y
(
cmd
, 
f‹˚_íabÀ_cmd
, (
wmi_Õl_f‹˚_íabÀ_cmd
));

5103 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
,

5104 
WMI_LPL_FORCE_ENABLE_CMDID
, 
NO_SYNC_WMIFLAG
);

5106  
ªt
;

5107 
	}
}

5109 
	$©h6kl_wmi_ab‹t_sˇn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
)

5111 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "abort_scan_cmd\n");

5112  
	`©h6kl_wmi_sim∂e_cmd
(
wmi
, 
if_idx
, 
WMI_ABORT_SCAN_CMDID
);

5113 
	}
}

5115 
	$©h6kl_wmi_£t_ht_ˇp_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

5116 
u8
 
b™d
, u8 
ch™_width_40M_suµ‹ãd
, u8 
sh‹t_GI
, u8 
ötﬁî™˚_40MHz
)

5118 
ªt
 = 0;

5119 
sk_buff
 *
skb
;

5120 
wmi_£t_ht_ˇp
 *
cmd
;

5122 i‡(
	`WARN_ON
((
b™d
 !
A_BAND_24GHZ
Ë&& (b™d !
A_BAND_5GHZ
)) ||

5123 
	`WARN_ON
(
ch™_width_40M_suµ‹ãd
 > 1) ||

5124 
	`WARN_ON
(
sh‹t_GI
 > 1))

5125  
ªt
;

5127 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5128 i‡(!
skb
)

5129  -
ENOMEM
;

5131 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

5135 
if_idx
,

5136 
b™d
, 
ch™_width_40M_suµ‹ãd
, 
sh‹t_GI
, 
ötﬁî™˚_40MHz
);

5138 
cmd
 = (
wmi_£t_ht_ˇp
 *Ë
skb
->
d©a
;

5139 
cmd
->
b™d
 = band;

5140 
cmd
->
íabÀ
 = 1;

5141 
cmd
->
ch™_width_40M_suµ‹ãd
 = chan_width_40M_supported;

5142 
cmd
->
sh‹t_GI_20MHz
 = 
sh‹t_GI
;

5143 
cmd
->
sh‹t_GI_40MHz
 = 
sh‹t_GI
;

5144 
cmd
->
ötﬁî™˚_40MHz
 = intolerance_40MHz;

5145 
cmd
->
max_ampdu_Àn_exp
 = 2;

5147 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_HT_CAP_CMDID
,

5148 
NO_SYNC_WMIFLAG
);

5150  
ªt
;

5151 
	}
}

5153 
	$©h6kl_wmi_£t_ht_›_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

5154 
u8
 
°a_ch™_width
, u8 
›mode
)

5156 
ªt
 = 0;

5157 
sk_buff
 *
skb
;

5158 
wmi_£t_ht_›
 *
cmd
;

5160 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5161 i‡(!
skb
)

5162  -
ENOMEM
;

5164 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

5166 
if_idx
,

5167 
°a_ch™_width
, 
›mode
);

5169 
cmd
 = (
wmi_£t_ht_›
 *Ë
skb
->
d©a
;

5170 
cmd
->
°a_ch™_width
 = 0;

5171 
cmd
->
≠_ht_öfo
 = ((
›mode
 & 0x3) << 0);

5173 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_HT_OP_CMDID
,

5174 
NO_SYNC_WMIFLAG
);

5176  
ªt
;

5177 
	}
}

5179 
	$©h6kl_wmi_£t_hiddí_ssid_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
hiddí_ssid
)

5181 
sk_buff
 *
skb
;

5182 
wmi_£t_hiddí_ssid
 *
cmd
;

5184 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5185 i‡(!
skb
)

5186  -
ENOMEM
;

5188 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "£t_hiddí_ssid: %d\n", 
hiddí_ssid
);

5190 
cmd
 = (
wmi_£t_hiddí_ssid
 *)
skb
->
d©a
;

5191 
cmd
->
hiddí_ssid
 = hidden_ssid;

5193  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_AP_HIDDEN_SSID_CMDID
,

5194 
NO_SYNC_WMIFLAG
);

5195 
	}
}

5197 
	$©h6kl_wmi_£t_bóc⁄_öãrvÆ_cmd
(
wmi
 *wmi,

5198 
u8
 
if_idx
, 
u32
 
bóc⁄_öãrvÆ
)

5200 
sk_buff
 *
skb
;

5201 
wmi_£t_bóc⁄_ötvl
 *
cmd
;

5203 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5204 i‡(!
skb
)

5205  -
ENOMEM
;

5207 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "set_beacon_interval: %d\n",

5208 
bóc⁄_öãrvÆ
);

5210 
cmd
 = (
wmi_£t_bóc⁄_ötvl
 *)
skb
->
d©a
;

5211 
cmd
->
bóc⁄_öãrvÆ
 = 
	`˝u_to_À16
(beacon_interval);

5213  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_BEACON_INT_CMDID
,

5214 
NO_SYNC_WMIFLAG
);

5215 
	}
}

5217 
	$©h6kl_wmi_£t_dtim_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
dtim
)

5219 
sk_buff
 *
skb
;

5220 
wmi_£t_dtim_cmd
 *
cmd
;

5222 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5223 i‡(!
skb
)

5224  -
ENOMEM
;

5226 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "£t_dtim: %d\n", 
dtim
);

5228 
cmd
 = (
wmi_£t_dtim_cmd
 *)
skb
->
d©a
;

5229 
cmd
->
dtim
 = (
u8
)dtim;

5231  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_AP_SET_DTIM_CMDID
,

5232 
NO_SYNC_WMIFLAG
);

5233 
	}
}

5235 
	$©h6kl_wmi_≠_£t_≠sd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
íabÀ
)

5237 
sk_buff
 *
skb
;

5238 
wmi_≠_£t_≠sd_cmd
 *
cmd
;

5240 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5241 i‡(!
skb
)

5242  -
ENOMEM
;

5244 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "£t_≠sd: %d\n", 
íabÀ
);

5246 
cmd
 = (
wmi_≠_£t_≠sd_cmd
 *)
skb
->
d©a
;

5247 
cmd
->
íabÀ
 =Énable;

5249  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_AP_SET_APSD_CMDID
,

5250 
NO_SYNC_WMIFLAG
);

5251 
	}
}

5253 
	$©h6kl_wmi_£t_≠sd_buf„ªd_åaffic_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

5254 
u16
 
aid
, u16 
bôm≠
, 
u32
 
Êags
)

5256 
sk_buff
 *
skb
;

5257 
wmi_≠_≠sd_buf„ªd_åaffic_cmd
 *
cmd
;

5259 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5260 i‡(!
skb
)

5261  -
ENOMEM
;

5263 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "set_apsd_buffered_traffic: %d %x %x\n",

5264 
aid
, 
bôm≠
, 
Êags
);

5266 
cmd
 = (
wmi_≠_≠sd_buf„ªd_åaffic_cmd
 *)
skb
->
d©a
;

5267 
cmd
->
aid
 =áid;

5268 
cmd
->
bôm≠
 = bitmap;

5269 
cmd
->
Êags
 = flags;

5271  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5272 
WMI_AP_APSD_BUFFERED_TRAFFIC_CMDID
,

5273 
NO_SYNC_WMIFLAG
);

5274 
	}
}

5276 
	$©h6kl_wmi_add_wow_ext_∑âîn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

5277 
u8
 
li°_id
, u8 
fûãr_size
,

5278 
u8
 
fûãr_id
, u8 
fûãr_off£t
,

5279 
u8
 *
fûãr
, u8 *
mask
)

5281 
sk_buff
 *
skb
;

5282 
wmi_add_wow_ext_∑âîn_cmd
 *
cmd
;

5283 
size
;

5284 
u8
 *
fûãr_mask
;

5285 
mask_size
;

5286 
ªt
 = 0;

5288 i‡(0 =
fûãr_size
)

5289  -
EINVAL
;

5291 
mask_size
 = (()
fûãr_size
) / 8;

5292 i‡(
fûãr_size
 % 8)

5293 
mask_size
++;

5295 
size
 = (
wmi_add_wow_ext_∑âîn_cmd
);

5296 
size
 +()
fûãr_size
;

5297 
size
 +
mask_size
;

5299 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
size
);

5300 i‡(!
skb
)

5301  -
ENOMEM
;

5303 
cmd
 = (
wmi_add_wow_ext_∑âîn_cmd
 *)
skb
->
d©a
;

5305 
cmd
->
fûãr_li°_id
 = 
li°_id
;

5306 
cmd
->
fûãr_id
 = filter_id;

5307 
cmd
->
fûãr_off£t
 = filter_offset;

5308 
cmd
->
fûãr_size
 = filter_size;

5310 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "Adding wowÖattern\n");

5311 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "\t cmd->filter_list_id: %d",

5312 
cmd
->
fûãr_li°_id
);

5313 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "\t cmd->filter_id: %d",

5314 
cmd
->
fûãr_id
);

5315 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "\t cmd->filter_offset: %d",

5316 
cmd
->
fûãr_off£t
);

5317 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "\t cmd->filter_size: %d",

5318 
cmd
->
fûãr_size
);

5319 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "\àmask-size: %d", 
mask_size
);

5321 
	`mem˝y
(
cmd
->
fûãr
, fûãr, cmd->
fûãr_size
);

5322 
fûãr_mask
 = (
u8
 *)(
cmd
->
fûãr
 + cmd->
fûãr_size
);

5323 
	`mem˝y
(
fûãr_mask
, 
mask
, 
mask_size
);

5324 
	`©h6kl_dbg
(
ATH6KL_DBG_WOWLAN
, "\t mask: %x",

5325 
cmd
->
fûãr
[cmd->
fûãr_size
]);

5326 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5327 
WMI_ADD_WOW_EXT_PATTERN_CMDID
, 
NO_SYNC_WMIFLAG
);

5329  
ªt
;

5330 
	}
}

5332 
	$©h6kl_wmi_dñ_Æl_wow_ext_∑âîns_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

5333 
__À16
 
fûãr_li°_id
)

5335  
	`©h6kl_wmi_dñ_wow_∑âîn_cmd
(
wmi
, 
if_idx
,

5336 
fûãr_li°_id
, 
WOW_EXT_FILTER_ID_CLEAR_ALL
);

5337 
	}
}

5339 
	$©h6kl_wm_£t_gtk_ofÊﬂd
(
wmi
 *wmi, 
u8
 
if_idx
,

5340 
u8
 *
kek
, u8 *
kck
, u8 *
ª∂ay_˘r
)

5342 
ªt
 = 0;

5343 
sk_buff
 *
skb
;

5344 
wmi_gtk_ofÊﬂd_›
 *
cmd
;

5345 
u64
 
ª∂ay_cou¡î
;

5347 i‡(
	`WARN_ON
(!
kek
Ë|| WARN_ON(!
kck
Ë|| WARN_ON(!
ª∂ay_˘r
))

5348  
ªt
;

5350 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_gtk_ofÊﬂd_›
));

5351 i‡(!
skb
)

5352  -
ENOMEM
;

5354 
cmd
 = (
wmi_gtk_ofÊﬂd_›
 *)
skb
->
d©a
;

5356 
	`mem£t
(
cmd
, 0, (
wmi_gtk_ofÊﬂd_›
));

5358 
ª∂ay_cou¡î
 = 
	`˝u_to_be64
(*
ª∂ay_˘r
);

5359 
	`mem˝y
(
cmd
->
kek
, kek, 
NL80211_KEK_LEN
);

5360 
	`mem˝y
(
cmd
->
kck
, kck, 
NL80211_KCK_LEN
);

5361 
	`mem˝y
(
cmd
->
ª∂ay_cou¡î
,

5362 (
u8
 *)&
ª∂ay_cou¡î
,

5363 
NL80211_REPLAY_CTR_LEN
);

5365 
cmd
->
›code
 = 
WMI_GTK_OFFLOAD_OPCODE_SET
;

5367 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5368 
WMI_GTK_OFFLOAD_OP_CMDID
, 
NO_SYNC_WMIFLAG
);

5370  
ªt
;

5371 
	}
}

5373 
	$©h6kl_wmi_£t_tx_£À˘_øãs_⁄_Æl_mode
(
wmi
 *wmi,

5374 
u8
 
if_idx
, 
u64
 
mask
)

5376 
sk_buff
 *
skb
;

5377 
wmi_£t_tx_£À˘_øã_cmd
 *
cmd
;

5378 
ªt
;

5379 
i
;

5380 
u64
 
tx£À˘mask
;

5382 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5383 i‡(!
skb
)

5384  -
ENOMEM
;

5386 
cmd
 = (
wmi_£t_tx_£À˘_øã_cmd
 *Ë
skb
->
d©a
;

5387 
tx£À˘mask
 = 
	`˝u_to_À64
(
mask
);

5389 
i
 = 0; i < (
WMI_MODE_MAX
 * 
WMI_MAX_RATE_MASK
); i += 2)

5390 
	`mem˝y
((*)(
cmd
->
øãMasks
 + 
i
),

5391 (*)&
tx£À˘mask
, (txselectmask));

5393 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5394 
WMI_SET_TX_SELECT_RATES_CMDID
,

5395 
NO_SYNC_WMIFLAG
);

5396  
ªt
;

5397 
	}
}

5399 
	$©h6kl_wmi_£t_™tdivcfg
(
wmi
 *wmi,

5400 
u8
 
if_idx
, u8 
divîsôy_c⁄åﬁ
)

5402 
sk_buff
 *
skb
;

5403 
wmi_™t_div_cmd
 *
cmd
;

5404 
ªt
;

5406 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5407 i‡(!
skb
)

5408  -
ENOMEM
;

5410 
cmd
 = (
wmi_™t_div_cmd
 *Ë
skb
->
d©a
;

5411 
cmd
->
divîsôy_c⁄åﬁ
 = diversity_control;

5413 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5414 
WMI_SET_ANTDIVCFG_CMDID
,

5415 
NO_SYNC_WMIFLAG
);

5416  
ªt
;

5417 
	}
}

5419 
	$©h6kl_wmi_£t_r¢_ˇp
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
r¢_ˇp
)

5421 
sk_buff
 *
skb
;

5422 
wmi_r¢_ˇp_cmd
 *
cmd
;

5424 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5425 i‡(!
skb
)

5426  -
ENOMEM
;

5428 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "£t_r¢_ˇp: 0x%04x\n", 
r¢_ˇp
);

5430 
cmd
 = (
wmi_r¢_ˇp_cmd
 *)
skb
->
d©a
;

5431 
cmd
->
r¢_ˇp
 = 
	`˝u_to_À16
(rsn_cap);

5433  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_RSN_CAP_CMDID
,

5434 
NO_SYNC_WMIFLAG
);

5435 
	}
}

5437 
	$©h6kl_wmi_gë_r¢_ˇp
(
wmi
 *wmi, 
u8
 
if_idx
)

5439  
	`©h6kl_wmi_sim∂e_cmd
(
wmi
, 
if_idx
, 
WMI_GET_RSN_CAP_CMDID
);

5440 
	}
}

5442 
	$©h6kl_wmi_gë_pmkid_li°
(
wmi
 *wmi, 
u8
 
if_idx
)

5444  
	`©h6kl_wmi_sim∂e_cmd
(
wmi
, 
if_idx
, 
WMI_GET_PMKID_LIST_CMDID
);

5445 
	}
}

5447 
	$©h6kl_wmi_£t_fix_øãs
(
wmi
 *wmi, 
u8
 
if_idx
, 
u64
 
mask
)

5449 
sk_buff
 *
skb
;

5450 
wmi_£t_fix_øãs_cmd
 *
cmd
;

5452 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5453 i‡(!
skb
)

5454  -
ENOMEM
;

5456 
cmd
 = (
wmi_£t_fix_øãs_cmd
 *)
skb
->
d©a
;

5457 
cmd
->
fixR©eMask
[0] = (
u32
)(
mask
 & 0xffffffff);

5458 
cmd
->
fixR©eMask
[1] = (
u32
)((
mask
 >> 32) & 0xffffffff);

5460 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "set_fix_rate: 0x%08x 0x%08x\n",

5461 
cmd
->
fixR©eMask
[0], cmd->fixRateMask[1]);

5463  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_FIXRATES_CMDID
,

5464 
NO_SYNC_WMIFLAG
);

5465 
	}
}

5467 
	$©h6kl_wmi_add_p‹t_cmd
(
wmi
 *wmi, 
©h6kl_vif
 *
vif
,

5468 
u8
 
›mode
, u8 
sub›mode
)

5470 
sk_buff
 *
skb
;

5471 
wmi_add_p‹t_cmd
 *
cmd
;

5473 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5474 i‡(!
skb
)

5475  -
ENOMEM
;

5477 
cmd
 = (
wmi_add_p‹t_cmd
 *)
skb
->
d©a
;

5478 
cmd
->
p‹t_id
 = 0;

5479 
cmd
->
p‹t_›mode
 = 
›mode
;

5480 
cmd
->
p‹t_sub›mode
 = 
sub›mode
;

5482 
	`mem˝y
(
cmd
->
mac_addr
, &
vif
->
ndev
->
dev_addr
[0], 
ETH_ALEN
);

5484 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "add_port: if_idx %d opmode %d "

5486 
vif
->
fw_vif_idx
,

5487 
›mode
, 
sub›mode
);

5489  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
vif
->
fw_vif_idx
, 
skb
,

5490 
WMI_ADD_PORT_CMDID
,

5491 
NO_SYNC_WMIFLAG
);

5492 
	}
}

5494 
	$©h6kl_wmi_dñ_p‹t_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
p‹t_id
)

5496 
sk_buff
 *
skb
;

5497 
wmi_dñ_p‹t_cmd
 *
cmd
;

5499 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5500 i‡(!
skb
)

5501  -
ENOMEM
;

5503 
cmd
 = (
wmi_dñ_p‹t_cmd
 *)
skb
->
d©a
;

5504 
cmd
->
p‹t_id
 =Öort_id;

5506 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "del_port: if_idx %dÖort_id %d\n",

5507 
if_idx
, 
p‹t_id
);

5509  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_DEL_PORT_CMDID
,

5510 
NO_SYNC_WMIFLAG
);

5511 
	}
}

5513 
	$©h6kl_wmi_£t_nﬂ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

5514 
u8
 
cou¡
, 
u32
 
°¨t
, u32 
duøti⁄
, u32 
öãrvÆ
)

5516 
©h6kl_vif
 *
vif
;

5517 
wmi_nﬂ_öfo
 *
cmd
;

5518 
wmi_nﬂ_des¸ùt‹
 *
nﬂ_des¸ùt‹
;

5519 
sk_buff
 *
skb
;

5520 
size_t
 
cmd_size
;

5522 i‡(!
wmi
->
∑ª¡_dev
->
p2p
)

5523  -
EINVAL
;

5525 
vif
 = 
	`©h6kl_gë_vif_by_ödex
(
wmi
->
∑ª¡_dev
, 
if_idx
);

5526 i‡((!
vif
) ||

5527 ((
vif
) &&

5528 (
vif
->
nw_ty≥
 !
AP_NETWORK
))) {

5529 
	`©h6kl_îr
("setÇoa in client mode? if_idx %d, count %d, "

5531 
if_idx
,

5532 
cou¡
,

5533 
°¨t
,

5534 
duøti⁄
,

5535 
öãrvÆ
);

5536  -
ENOTSUPP
;

5540 
cmd_size
 = (
wmi_nﬂ_öfo
) +

5541 (
wmi_nﬂ_des¸ùt‹
);

5542 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
(
cmd_size
);

5543 i‡(!
skb
)

5544  -
ENOMEM
;

5546 
cmd
 = (
wmi_nﬂ_öfo
 *)
skb
->
d©a
;

5547 
cmd
->
íabÀ
 = 0;

5548 
cmd
->
cou¡
 = 0;

5549 i‡(
cou¡
) {

5550 
cmd
->
íabÀ
 = 1;

5551 
cmd
->
cou¡
 = 1;

5553 
nﬂ_des¸ùt‹
 = (
wmi_nﬂ_des¸ùt‹
 *)
cmd
->
nﬂs
;

5554 
nﬂ_des¸ùt‹
->
duøti⁄
 = 0;

5555 
nﬂ_des¸ùt‹
->
öãrvÆ
 = 0;

5561 i‡(
cou¡
 == 1) {

5563 
nﬂ_des¸ùt‹
->
cou¡_‹_ty≥
 = 1;

5564 
nﬂ_des¸ùt‹
->
duøti⁄
 = duration;

5566 
nﬂ_des¸ùt‹
->
öãrvÆ
 = 
duøti⁄
;

5567 
nﬂ_des¸ùt‹
->
°¨t_‹_off£t
 = 
°¨t
;

5568 } i‡(
cou¡
 != 255) {

5570 
nﬂ_des¸ùt‹
->
cou¡_‹_ty≥
 = 
cou¡
;

5571 
nﬂ_des¸ùt‹
->
duøti⁄
 = duration;

5572 
nﬂ_des¸ùt‹
->
öãrvÆ
 = interval;

5573 
nﬂ_des¸ùt‹
->
°¨t_‹_off£t
 = 
°¨t
;

5576 
nﬂ_des¸ùt‹
->
cou¡_‹_ty≥
 = 255;

5577 
nﬂ_des¸ùt‹
->
duøti⁄
 = duration;

5578 
nﬂ_des¸ùt‹
->
öãrvÆ
 = interval;

5579 
nﬂ_des¸ùt‹
->
°¨t_‹_off£t
 = 
°¨t
;

5583 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "set_noa: if_idx %d count %d start %d "

5585 
if_idx
,

5586 
cou¡
,

5587 
°¨t
,

5588 
duøti⁄
,

5589 
öãrvÆ
);

5591  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_NOA_CMDID
,

5592 
NO_SYNC_WMIFLAG
);

5593 
	}
}

5595 
	$©h6kl_wmi_£t_›µs_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

5596 
u8
 
íabÀ
, u8 
˘wö
)

5598 
sk_buff
 *
skb
;

5599 
wmi_›µs_öfo
 *
cmd
;

5601 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5602 i‡(!
skb
)

5603  -
ENOMEM
;

5605 
cmd
 = (
wmi_›µs_öfo
 *)
skb
->
d©a
;

5606 
cmd
->
íabÀ
 =Énable;

5607 i‡(
íabÀ
)

5608 
cmd
->
˘wö
 = ctwin;

5610 
cmd
->
˘wö
 = 0;

5612 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "set_oppps: if_idx %dÉnable %d ctwin %d\n",

5613 
if_idx
,

5614 
íabÀ
,

5615 
˘wö
);

5617  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_OPPPS_CMDID
,

5618 
NO_SYNC_WMIFLAG
);

5619 
	}
}

5621 #ifde‡
ATH6KL_SUPPORT_WLAN_HB


5622 
	$©h6kl_wmi_£t_hóπ_bót_∑øms
(
wmi
 *wmi, 
u8
 
if_idx
,

5623 
u8
 
íabÀ
, u8 
ôem
, u8 
£ssi⁄
)

5625 
sk_buff
 *
skb
;

5626 
wmi_hóπ_bót_∑øms_cmd
 *
cmd
;

5628 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5629 i‡(!
skb
)

5630  -
ENOMEM
;

5632 
cmd
 = (
wmi_hóπ_bót_∑øms_cmd
 *)
skb
->
d©a
;

5633 
cmd
->
íabÀ
 =Énable;

5634 
cmd
->
ôem
 = item;

5635 
cmd
->
£ssi⁄
 = session;

5637  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_HEART_PARAMS_CMDID
,

5638 
NO_SYNC_WMIFLAG
);

5639 
	}
}

5641 
	$©h6kl_wmi_hóπ_bót_£t_t˝_∑øms
(
wmi
 *wmi, 
u8
 
if_idx
,

5642 
u16
 
§c_p‹t
, u16 
d°_p‹t
, 
u32
 
§v_ù
, u32 
dev_ù
, u16 
timeout
,

5643 
u8
 
£ssi⁄
, u8 *
g©eway_mac
)

5645 
sk_buff
 *
skb
;

5646 
wmi_hóπ_bót_t˝_∑øms_cmd
 *
cmd
;

5648 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5649 i‡(!
skb
)

5650  -
ENOMEM
;

5652 
cmd
 = (
wmi_hóπ_bót_t˝_∑øms_cmd
 *)
skb
->
d©a
;

5653 
cmd
->
§c_p‹t
 = 
	`˝u_to_À16
(src_port);

5654 
cmd
->
d°_p‹t
 = 
	`˝u_to_À16
(dst_port);

5655 
cmd
->
§v_ù
 = 
	`˝u_to_À32
(srv_ip);

5656 
cmd
->
dev_ù
 = 
	`˝u_to_À32
(dev_ip);

5657 
cmd
->
timeout
 = 
	`˝u_to_À16
(timeout);

5658 
cmd
->
£ssi⁄
 = session;

5659 
	`mem˝y
(
cmd
->
g©eway_mac
, g©eway_mac, 
ETH_ALEN
);

5661  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5662 
WMI_HEART_SET_TCP_PARAMS_CMDID
,

5663 
NO_SYNC_WMIFLAG
);

5664 
	}
}

5666 
	$©h6kl_wmi_hóπ_bót_£t_t˝_fûãr
(
wmi
 *wmi, 
u8
 
if_idx
,

5667 
u8
 *
fûãr
, u8 
Àngth
, u8 
off£t
, u8 
£ssi⁄
)

5669 
sk_buff
 *
skb
;

5670 
wmi_hóπ_bót_t˝_fûãr_cmd
 *
cmd
;

5672 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5673 i‡(!
skb
)

5674  -
ENOMEM
;

5676 
cmd
 = (
wmi_hóπ_bót_t˝_fûãr_cmd
 *)
skb
->
d©a
;

5677 
	`mem˝y
(
cmd
->
fûãr
, fûãr, 
Àngth
);

5678 
cmd
->
Àngth
 =Üength;

5679 
cmd
->
off£t
 = offset;

5680 
cmd
->
£ssi⁄
 = session;

5682  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5683 
WMI_HEART_SET_TCP_PKT_FILTER_CMDID
,

5684 
NO_SYNC_WMIFLAG
);

5685 
	}
}

5687 
	$©h6kl_wmi_hóπ_bót_£t_udp_∑øms
(
wmi
 *wmi, 
u8
 
if_idx
,

5688 
u16
 
§c_p‹t
, u16 
d°_p‹t
, 
u32
 
§v_ù
,

5689 
u32
 
dev_ù
, 
u16
 
öãrvÆ
, u16 
timeout
,

5690 
u8
 
£ssi⁄
, u8 *
g©eway_mac
)

5692 
sk_buff
 *
skb
;

5693 
wmi_hóπ_bót_udp_∑øms_cmd
 *
cmd
;

5695 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5696 i‡(!
skb
)

5697  -
ENOMEM
;

5699 
cmd
 = (
wmi_hóπ_bót_udp_∑øms_cmd
 *)
skb
->
d©a
;

5700 
cmd
->
§c_p‹t
 = 
	`˝u_to_À16
(src_port);

5701 
cmd
->
d°_p‹t
 = 
	`˝u_to_À16
(dst_port);

5702 
cmd
->
§v_ù
 = 
	`˝u_to_À32
(srv_ip);

5703 
cmd
->
dev_ù
 = 
	`˝u_to_À32
(dev_ip);

5704 
cmd
->
öãrvÆ
 = 
	`˝u_to_À16
(interval);

5705 
cmd
->
timeout
 = 
	`˝u_to_À16
(timeout);

5706 
cmd
->
£ssi⁄
 = session;

5707 
	`mem˝y
(
cmd
->
g©eway_mac
, g©eway_mac, 
ETH_ALEN
);

5709  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5710 
WMI_HEART_SET_UDP_PARAMS_CMDID
,

5711 
NO_SYNC_WMIFLAG
);

5712 
	}
}

5714 
	$©h6kl_wmi_hóπ_bót_£t_udp_fûãr
(
wmi
 *wmi, 
u8
 
if_idx
,

5715 
u8
 *
fûãr
, u8 
Àngth
, u8 
off£t
, u8 
£ssi⁄
)

5717 
sk_buff
 *
skb
;

5718 
wmi_hóπ_bót_udp_fûãr_cmd
 *
cmd
;

5720 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5721 i‡(!
skb
)

5722  -
ENOMEM
;

5724 
cmd
 = (
wmi_hóπ_bót_udp_fûãr_cmd
 *)
skb
->
d©a
;

5725 
	`mem˝y
(
cmd
->
fûãr
, fûãr, 
Àngth
);

5726 
cmd
->
Àngth
 =Üength;

5727 
cmd
->
off£t
 = offset;

5728 
cmd
->
£ssi⁄
 = session;

5730  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5731 
WMI_HEART_SET_UDP_PKT_FILTER_CMDID
,

5732 
NO_SYNC_WMIFLAG
);

5733 
	}
}

5736 #ifde‡
ATH6KL_SUPPORT_WIFI_DISC


5737 
	$©h6kl_wmi_disc_õ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
íabÀ
,

5738 
u8
 
°¨tPos
, u8 *
∑âîn
, u8 
Àngth
)

5740 
sk_buff
 *
skb
;

5741 
wmi_disc_õ_fûãr_cmd
 *
cmd
;

5742 
ªt
;

5744 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
Ë+ 
Àngth
);

5745 i‡(!
skb
)

5746  -
ENOMEM
;

5748 
cmd
 = (
wmi_disc_õ_fûãr_cmd
 *Ë
skb
->
d©a
;

5750 
cmd
->
íabÀ
 =Énable;

5751 
cmd
->
°¨tPos
 = startPos;

5752 
cmd
->
Àngth
 =Üength;

5754 i‡(
cmd
->
íabÀ
)

5755 
	`mem˝y
(
cmd
->
∑âîn
,Ö©ã∫, cmd->
Àngth
);

5757 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5758 
WMI_DISC_SET_IE_FILTER_CMDID
,

5759 
NO_SYNC_WMIFLAG
);

5761  
ªt
;

5762 
	}
}

5764 
	$©h6kl_wmi_disc_mode_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
íabÀ
,

5765 
u16
 
ch™√l
, 
u32
 
home_dwñl_time
, u32 
¶ìpTime
,

5766 
u32
 
øndom
, u32 
numPìrs
, u32 
≥îTimeout
)

5768 
sk_buff
 *
skb
;

5769 
wmi_disc_mode_cmd
 *
cmd
;

5770 
ªt
;

5772 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5773 i‡(!
skb
)

5774  -
ENOMEM
;

5776 
cmd
 = (
wmi_disc_mode_cmd
 *Ë
skb
->
d©a
;

5778 
cmd
->
íabÀ
 =Énable;

5779 
cmd
->
ch™√l
 = 
	`˝u_to_À16
(channel);

5780 
cmd
->
home_dwñl_time
 = 
	`˝u_to_À32
(home_dwell_time);

5781 
cmd
->
¶ìpTime
 = 
	`˝u_to_À32
(sleepTime);

5782 
cmd
->
øndom
 = 
	`˝u_to_À32
(random);

5783 
cmd
->
numPìrs
 = 
	`˝u_to_À32
(numPeers);

5784 
cmd
->
≥îTimeout
 = 
	`˝u_to_À32
(peerTimeout);

5786 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_DISC_SET_MODE_CMDID
,

5787 
NO_SYNC_WMIFLAG
);

5789  
ªt
;

5790 
	}
}

5793 
	$©h6kl_wmi_≠_pﬁl_°a
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
aid
)

5795 
sk_buff
 *
skb
;

5796 
wmi_≠_pﬁl_°a_cmd
 *
cmd
;

5798 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5799 i‡(!
skb
)

5800  -
ENOMEM
;

5802 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

5803 "kìp_Æive_nuŒd©a:áid %d\n", 
aid
);

5805 
cmd
 = (
wmi_≠_pﬁl_°a_cmd
 *)
skb
->
d©a
;

5806 
cmd
->
aid
 =áid;

5808  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_AP_POLL_STA_CMDID
,

5809 
NO_SYNC_WMIFLAG
);

5810 
	}
}

5812 
	$©h6kl_wmi_≠_a˛_pﬁicy
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
pﬁicy
)

5814 
sk_buff
 *
skb
;

5815 
wmi_≠_a˛_pﬁicy_cmd
 *
cmd
;

5817 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5818 i‡(!
skb
)

5819  -
ENOMEM
;

5821 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

5822 "a˛_pﬁicy:Öﬁicy %d\n", 
pﬁicy
);

5824 
cmd
 = (
wmi_≠_a˛_pﬁicy_cmd
 *)
skb
->
d©a
;

5825 
cmd
->
pﬁicy
 =Öolicy;

5827  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_AP_ACL_POLICY_CMDID
,

5828 
NO_SYNC_WMIFLAG
);

5829 
	}
}

5831 
	$©h6kl_wmi_≠_a˛_mac_li°
(
wmi
 *wmi, 
u8
 
if_idx
,

5832 
u8
 
idx
, u8 *
mac_addr
, u8 
a˘i⁄
)

5834 
sk_buff
 *
skb
;

5835 
wmi_≠_a˛_mac_li°_cmd
 *
cmd
;

5837 i‡(
	`WARN_ON
(
idx
 >
AP_ACL_SIZE
))

5838  -
EINVAL
;

5840 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5841 i‡(!
skb
)

5842  -
ENOMEM
;

5844 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

5846 
idx
,

5847 
mac_addr
[0], mac_addr[1], mac_addr[2],

5848 
mac_addr
[3], mac_addr[4], mac_addr[5],

5849 
a˘i⁄
);

5851 
cmd
 = (
wmi_≠_a˛_mac_li°_cmd
 *)
skb
->
d©a
;

5852 
cmd
->
a˘i⁄
 =áction;

5853 
cmd
->
ödex
 = 
idx
;

5854 
	`mem˝y
(
cmd
->
mac
, 
mac_addr
, 
ETH_ALEN
);

5855 
cmd
->
wûdˇrd
 = 0;

5857  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_AP_ACL_MAC_LIST_CMDID
,

5858 
NO_SYNC_WMIFLAG
);

5859 
	}
}

5861 
	$©h6kl_wmi_Ælow_aggr_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

5862 
u16
 
tx_tid_mask
, u16 
rx_tid_mask
)

5864 
sk_buff
 *
skb
;

5865 
wmi_Ælow_aggr_cmd
 *
cmd
;

5867 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5868 i‡(!
skb
)

5869  -
ENOMEM
;

5871 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

5873 
tx_tid_mask
,

5874 
rx_tid_mask
);

5876 
cmd
 = (
wmi_Ælow_aggr_cmd
 *)
skb
->
d©a
;

5877 
cmd
->
tx_Ælow_aggr
 = 
tx_tid_mask
;

5878 
cmd
->
rx_Ælow_aggr
 = 
rx_tid_mask
;

5880  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_ALLOW_AGGR_CMDID
,

5881 
NO_SYNC_WMIFLAG
);

5882 
	}
}

5884 
	$©h6kl_wmi_£t_¸edô_by∑ss
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
eid
,

5885 
u8
 
ª°‹e
, 
u16
 
thªshﬁd
)

5887 
sk_buff
 *
skb
;

5888 
wmi_£t_¸edô_by∑ss_cmd
 *
cmd
;

5890 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5891 i‡(!
skb
)

5892  -
ENOMEM
;

5894 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

5896 
eid
, 
ª°‹e
, 
thªshﬁd
);

5898 
cmd
 = (
wmi_£t_¸edô_by∑ss_cmd
 *)
skb
->
d©a
;

5899 
cmd
->
eid
 =Éid;

5900 
cmd
->
ª°‹e
 =Ñestore;

5901 
cmd
->
thªshﬁd
 =Åhreshold;

5903  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

5904 
WMI_SET_CREDIT_BYPASS_CMDID
,

5905 
NO_SYNC_WMIFLAG
);

5906 
	}
}

5908 
	$©h6kl_wmi_£t_¨p_ofÊﬂd_ù_cmd
(
wmi
 *wmi, 
u8
 *
ù_addrs
)

5910 
sk_buff
 *
skb
;

5911 
wmi_£t_¨p_ns_ofÊﬂd_cmd
 *
cmd
;

5912 
ªt
, 
i
;

5914 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5915 i‡(!
skb
)

5916  -
ENOMEM
;

5918 
cmd
 = (
wmi_£t_¨p_ns_ofÊﬂd_cmd
 *)
skb
->
d©a
;

5919 
	`mem£t
(
cmd
, 0, (*cmd));

5921 
i
 = 0 ; i < 4; i++) {

5923 
cmd
->
¨p_tu∂es
[0].
èrgë_ùaddr
[
i
] = *(
ù_addrs
+i);

5924 
	`¥ötk
("%d\n",
cmd
->
¨p_tu∂es
[
i
].
èrgë_ùaddr
[i] );

5926 
cmd
->
¨p_tu∂es
[0].
Êags
 = 
WMI_ARPOFF_FLAGS_VALID
;

5927 
cmd
->
Êags
 = 0;

5929 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_SET_ARP_NS_OFFLOAD_CMDID
,

5930 
NO_SYNC_WMIFLAG
);

5931  
ªt
;

5932 
	}
}

5934 
	$©h6kl_wmi_£t_mcc_¥ofûe_cmd
(
wmi
 *wmi, 
u32
 
mcc_¥ofûe
)

5936 
sk_buff
 *
skb
;

5937 
wmi_£t_mcc_¥ofûe_cmd
 *
cmd
;

5939 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5940 i‡(!
skb
)

5941  -
ENOMEM
;

5943 
cmd
 = (
wmi_£t_mcc_¥ofûe_cmd
 *)
skb
->
d©a
;

5944 
cmd
->
mcc_¥ofûe
 = mcc_profile;

5946  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_SET_MCC_PROFILE_CMDID
,

5947 
NO_SYNC_WMIFLAG
);

5948 
	}
}

5950 
	$©h6kl_wmi_£t_£amÀss_mcc_scc_swôch_‰eq_cmd
(
wmi
 *wmi, 
u32
 
‰eq
)

5952 
sk_buff
 *
skb
;

5953 
u32
 *
cmd
;

5955 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5956 i‡(!
skb
)

5957  -
ENOMEM
;

5959 
cmd
 = (
u32
 *)
skb
->
d©a
;

5960 *
cmd
 = 
‰eq
;

5962  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
,

5963 
WMI_SET_SEAMLESS_MCC_SCC_SWITCH_FREQ_CMDID
, 
NO_SYNC_WMIFLAG
);

5964 
	}
}

5966 
	$©h6kl_wmi_£t_öa˘_cmd
(
wmi
 *wmi, 
u32
 
öa˝îiod
)

5968 
sk_buff
 *
skb
;

5969 
wmi_≠_c⁄n_öa˘_cmd
 *
cmd
;

5971 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5972 i‡(!
skb
)

5973  -
ENOMEM
;

5975 
cmd
 = (
wmi_≠_c⁄n_öa˘_cmd
 *)
skb
->
d©a
;

5976 
cmd
->
≥riod
 = 
öa˝îiod
;

5978  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_AP_CONN_INACT_CMDID
,

5979 
NO_SYNC_WMIFLAG
);

5980 
	}
}

5982 
	$©h6kl_wmi_£nd_assoc_ª•_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

5983 
boﬁ
 
ac˚±
, 
u8
 
ªas⁄_code
, u8 
fw_°©us
, u8 *
°a_mac
, u8 
ªq_ty≥
)

5985 
sk_buff
 *
skb
;

5986 
wmi_assoc_ª•_£nd_cmd
 *
cmd
;

5988 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

5989 i‡(!
skb
)

5990  -
ENOMEM
;

5992 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

5994 
ac˚±
, 
ªas⁄_code
, 
fw_°©us
, 
ªq_ty≥
);

5996 
cmd
 = (
wmi_assoc_ª•_£nd_cmd
 *)
skb
->
d©a
;

5997 i‡(
ac˚±
) {

6003 
cmd
->
ho°_ac˚±
 = 1;

6004 
cmd
->
ho°_ªas⁄Code
 = 0;

6006 
cmd
->
ho°_ac˚±
 = 0;

6007 
cmd
->
ho°_ªas⁄Code
 = 
ªas⁄_code
;

6009 
cmd
->
èrgë_°©us
 = 
fw_°©us
;

6010 
cmd
->
r•Ty≥
 = 
ªq_ty≥
;

6011 
	`mem˝y
(
cmd
->
°a_mac_addr
, 
°a_mac
, 
ETH_ALEN
);

6013  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SEND_ASSOC_RES_CMDID
,

6014 
NO_SYNC_WMIFLAG
);

6015 
	}
}

6017 
	$©h6kl_wmi_£t_assoc_ªq_ªœy_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
boﬁ
 
íabÀd
)

6019 
sk_buff
 *
skb
;

6020 
wmi_assoc_ªq_ªœy_cmd
 *
cmd
;

6022 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

6023 i‡(!
skb
)

6024  -
ENOMEM
;

6026 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

6028 
íabÀd
);

6030 
cmd
 = (
wmi_assoc_ªq_ªœy_cmd
 *)
skb
->
d©a
;

6031 i‡(
íabÀd
)

6032 
cmd
->
íabÀ
 = 1;

6034 
cmd
->
íabÀ
 = 0;

6036  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

6037 
WMI_SET_ASSOC_REQ_RELAY_CMDID
,

6038 
NO_SYNC_WMIFLAG
);

6039 
	}
}

6040 #ifde‡
ATHTST_SUPPORT


6041 
	$©h6kl_wmi_£t_≠_num_°a_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
°a_nums
)

6043 
sk_buff
 *
skb
;

6044 
WMI_AP_NUM_STA_CMD
 *
cmd
;

6046 i‡(
°a_nums
 > 10)

6047  -
EIO
;

6049 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

6050 i‡(!
skb
)

6051  -
ENOMEM
;

6053 
cmd
 = (
WMI_AP_NUM_STA_CMD
 *Ë
skb
->
d©a
;

6054 
cmd
->
num_°a
 = (
u8
)
°a_nums
;

6055  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_AP_SET_NUM_STA_CMDID
,

6056 
NO_SYNC_WMIFLAG
);

6057 
	}
}

6060 
	$©h6kl_wmi_™tdiv°©e_evít_rx
(
©h6kl_vif
 *
vif
, 
u8
 *
d©≠
, 
Àn
)

6062 
	`mem˝y
(&
vif
->
™t_div_°©
, 
d©≠
, (
wmi_™t_div_°©
));

6064 
	}
}

6066 
	$©h6kl_wmi_™i°©e_evít_rx
(
©h6kl_vif
 *
vif
, 
u8
 *
d©≠
, 
Àn
)

6068 
	`mem˝y
(&
vif
->
™i_°©
, 
d©≠
, (
wmi_™i_°©
));

6070 
	}
}

6072 
	$©h6kl_wmi_™i°©e_íabÀ
(
wmi
 *wmi,

6073 
wmi_c⁄fig_íabÀ_cmd
 *
›ti⁄s
)

6075 
sk_buff
 *
skb
;

6076 
wmi_c⁄fig_íabÀ_cmd
 *
cmd
;

6077 
ªt
 = 0;

6079 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((
wmi_c⁄fig_íabÀ_cmd
));

6081 i‡(
skb
 =
NULL
)

6082  -
ENOMEM
;

6084 
cmd
 = (
wmi_c⁄fig_íabÀ_cmd
 *)
skb
->
d©a
;

6085 
	`mem£t
(
cmd
, 0, (
wmi_c⁄fig_íabÀ_cmd
));

6087 
	`mem˝y
(
cmd
, 
›ti⁄s
, (
wmi_c⁄fig_íabÀ_cmd
));

6089 
ªt
 = 
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
,

6090 
WMI_GET_ANISTAT_CMDID
, 
NO_SYNC_WMIFLAG
);

6092  
ªt
;

6093 
	}
}

6095 
	$©h6kl_wmi_£t_bmiss_time
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
numBóc⁄
)

6097 
sk_buff
 *
skb
;

6098 
wmi_bmiss_time_cmd
 *
cmd
;

6100 i‡((
numBóc⁄
 < 
MIN_BMISS_BEACONS
) ||

6101 (
numBóc⁄
 > 
MAX_BMISS_BEACONS
))

6102  -
EINVAL
;

6104 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

6105 i‡(!
skb
)

6106  -
ENOMEM
;

6108 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

6109 "bmiss_time:ÇumBóc⁄ %d\n", 
numBóc⁄
);

6111 
cmd
 = (
wmi_bmiss_time_cmd
 *)
skb
->
d©a
;

6112 
cmd
->
numBóc⁄s
 = 
numBóc⁄
;

6114  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_SET_BMISS_TIME_CMDID
,

6115 
NO_SYNC_WMIFLAG
);

6116 
	}
}

6118 
	$©h6kl_wmi_£t_sˇn_ch™_∂™
(
wmi
 *wmi, 
u8
 
if_idx
,

6119 
u8
 
ty≥
, u8 
numCh™
, 
u16
 *
ch™Li°
)

6121 
sk_buff
 *
skb
;

6122 
wmi_sˇn_ch™_∂™_cmd
 *
cmd
;

6123 
i
;

6125 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
) +

6126 ((
u16
Ë* 
numCh™
));

6127 i‡(!
skb
)

6128  -
ENOMEM
;

6130 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

6132 
if_idx
, 
ty≥
, 
numCh™
);

6134 
cmd
 = (
wmi_sˇn_ch™_∂™_cmd
 *)
skb
->
d©a
;

6136 i‡(
ty≥
 =
ATH6KL_SCAN_PLAN_IN_ORDER
)

6137 
cmd
->
ty≥
 = 
WMI_SCAN_PLAN_IN_ORDER
;

6138 i‡(
ty≥
 =
ATH6KL_SCAN_PLAN_REVERSE_ORDER
)

6139 
cmd
->
ty≥
 = 
WMI_SCAN_PLAN_REVERSE_ORDER
;

6140 i‡(
ty≥
 =
ATH6KL_SCAN_PLAN_HOST_ORDER
)

6141 
cmd
->
ty≥
 = 
WMI_SCAN_PLAN_HOST_ORDER
;

6143 
	`WARN_ON
(1);

6145 i‡(
cmd
->
ty≥
 =
WMI_SCAN_PLAN_HOST_ORDER
) {

6146 
cmd
->
numCh™√ls
 = 
numCh™
;

6147 
i
 = 0; i < 
cmd
->
numCh™√ls
; i++)

6148 
cmd
->
ch™√Œi°
[
i
] = 
	`˝u_to_À16
(
ch™Li°
[i]);

6150 
cmd
->
numCh™√ls
 = 0;

6152  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
,

6153 
WMI_SET_SCAN_CHAN_PLAN_CMDID
,

6154 
NO_SYNC_WMIFLAG
);

6155 
	}
}

6157 
	$©h6kl_wmi_£t_dtim_ext
(
wmi
 *wmi, 
u8
 
dtim_ext
)

6159 
sk_buff
 *
skb
;

6160 
wmi_£t_dtim_ext_cmd
 *
cmd
;

6162 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

6163 i‡(!
skb
)

6164  -
ENOMEM
;

6166 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
,

6167 "dtim_ext: %d\n", 
dtim_ext
);

6169 
cmd
 = (
wmi_£t_dtim_ext_cmd
 *)
skb
->
d©a
;

6170 
cmd
->
dtim_ext
 = dtim_ext;

6172  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
, 
WMI_SET_DTIM_EXT_CMDID
,

6173 
NO_SYNC_WMIFLAG
);

6174 
	}
}

6176 #ifde‡
CONFIG_WLAN_QRF


6178 
	$©h6kl_wmi_qrf_íabÀ
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
íabÀ
)

6180 
sk_buff
 *
skb
;

6181 
wmi_qrf_íabÀ_cmd
 *
cmd
;

6183 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

6184 i‡(!
skb
)

6185  -
ENOMEM
;

6187 
cmd
 = (
wmi_qrf_íabÀ_cmd
 *)
skb
->
d©a
;

6188 
cmd
->
íabÀ
 =Énable;

6190  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_QRF_EN_CMD_ID
,

6191 
NO_SYNC_WMIFLAG
);

6192 
	}
}

6195 
	$©h6kl_wmi_qrf_£t_ssid
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
Êag
,

6196 
u8
 
ssid_Àn
, u8 *
ssid
)

6198 
sk_buff
 *
skb
;

6199 
wmi_qrf_£t_ssid_cmd
 *
cmd
;

6201 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "ath6kl_wmi_qrf_set_ssid\n");

6203 if((!
ssid
Ë|| (!
ssid_Àn
Ë|| (ssid_À¿> 
IEEE80211_MAX_SSID_LEN
))

6204  -
EINVAL
;

6206 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "ssid %†Êag %d\n", 
ssid
, 
Êag
);

6208 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

6209 i‡(!
skb
)

6210  -
ENOMEM
;

6212 
cmd
 = (
wmi_qrf_£t_ssid_cmd
 *)
skb
->
d©a
;

6213 
cmd
->
Êag
 = (
u8
)((Êag =
ANY_SSID_FLAG
)?ANY_SSID_FLAG:
SPECIFIC_SSID_FLAG
);

6214 
cmd
->
ssid_Àn
 = ssid_len;

6215 
	`mem˝y
(
cmd
->
ssid
, ssid, 
ssid_Àn
);

6217  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_QRF_SET_SSID_CMD_ID
,

6218 
NO_SYNC_WMIFLAG
);

6219 
	}
}

6221 
	$©h6kl_wmi_qrf_£t_mac
(
wmi
 *wmi, 
u8
 
if_idx
, u8 *
mac
)

6223 
sk_buff
 *
skb
;

6224 
wmi_qrf_£t_mac_cmd
 *
cmd
;

6226 if(!
mac
)

6227  -
EINVAL
;

6229 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "ath6kl_wmi_qrf_set_mac\n");

6231 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

6232 i‡(!
skb
)

6233  -
ENOMEM
;

6235 
cmd
 = (
wmi_qrf_£t_mac_cmd
 *)
skb
->
d©a
;

6236 
	`mem˝y
(
cmd
->
mac
, mac, 
ETH_ALEN
);

6238 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "mac %02X%02X%02X%02X%02X%02X\n",

6239 
mac
[0], mac[1], mac[2], mac[3], mac[4], mac[5]);

6241  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_QRF_SET_MAC_CMD_ID
,

6242 
NO_SYNC_WMIFLAG
);

6243 
	}
}

6245 
	$©h6kl_wmi_qrf_£t_∑øms
(
wmi
 *wmi, 
u8
 
if_idx
,

6246 
u32
 
sˇnI¡îvÆ
, u32 
sˇnDwñlI¡îvÆ
, 
u8
 
numCh™√ls
,

6247 
u16
 *
ch™√lLi°
)

6249 
sk_buff
 *
skb
;

6250 
wmi_qrf_£t_∑øms_cmd
 *
cmd
;

6252 if((!
ch™√lLi°
) ||

6253 (!
numCh™√ls
) ||

6254 (
numCh™√ls
 > 
WMI_QRF_NUM_CHANNELS_MAX
))

6255  -
EINVAL
;

6257 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
Ë+ ((
u16
)*(
numCh™√ls
-1)));

6258 i‡(!
skb
)

6259  -
ENOMEM
;

6261 
cmd
 = (
wmi_qrf_£t_∑øms_cmd
 *)
skb
->
d©a
;

6263 
cmd
->
sˇnI¡îvÆ
 = 
	`˝u_to_À32
(scanInterval);

6264 
cmd
->
sˇnDwñlI¡îvÆ
 = 
	`˝u_to_À32
(scanDwellInterval);

6265 
cmd
->
numCh™√ls
 =ÇumChannels;

6266 
	`mem˝y
(
cmd
->
ch™√lLi°
, ch™√lLi°, (
numCh™√ls
 * (
u16
)));

6268  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_QRF_SET_PARAMS_CMD_ID
,

6269 
NO_SYNC_WMIFLAG
);

6270 
	}
}

6272 
	$©h6kl_wmi_qrf_£t_≠∑øms
(
wmi
 *wmi, 
u8
 
if_idx
,

6273 
u32
 
sˇnDwñl
, u32 
sˇnRïót
, 
u8
 
sˇnMode
)

6275 
sk_buff
 *
skb
;

6276 
wmi_qrf_£t_≠∑øms_cmd
 *
cmd
;

6278 if((
sˇnMode
 !
WMI_AP_SCAN_DISABLED
Ë&& (sˇnModê!
WMI_AP_SCAN_ENABLED
))

6279  -
EINVAL
;

6281 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

6282 i‡(!
skb
)

6283  -
ENOMEM
;

6285 
cmd
 = (
wmi_qrf_£t_≠∑øms_cmd
 *)
skb
->
d©a
;

6287 
cmd
->
sˇnDwñl
 = 
	`˝u_to_À32
(scanDwell);

6288 
cmd
->
sˇnRïót
 = 
	`˝u_to_À32
(scanRepeat);

6289 
cmd
->
sˇnMode
 = scanMode;

6291  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_QRF_SET_APPARAMS_CMD_ID
,

6292 
NO_SYNC_WMIFLAG
);

6293 
	}
}

6295 
	$©h6kl_wmi_qrf_gë_sˇn_ªsu…s
(
wmi
 *wmi, 
u8
 
if_idx
,

6296 
u32
 
mumMacs
, 
u8
 *
mac
)

6298 
sk_buff
 *
skb
;

6299 
wmi_qrf_gë_sˇn_ªsu…s_cmd
 *
cmd
;

6301 if((!
mumMacs
Ë|| (!
mac
))

6302  -
EINVAL
;

6304 
skb
 = 
	`©h6kl_wmi_gë_√w_buf
((*
cmd
));

6305 i‡(!
skb
)

6306  -
ENOMEM
;

6308 
cmd
 = (
wmi_qrf_gë_sˇn_ªsu…s_cmd
 *)
skb
->
d©a
;

6309 
cmd
->
numMacs
 = 
mumMacs
;

6311  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 
if_idx
, 
skb
, 
WMI_QRF_GET_SCAN_RESULTS_CMD_ID
, 
NO_SYNC_WMIFLAG
);

6312 
	}
}

	@wmi.h

24 #i‚de‡
WMI_H


25 
	#WMI_H


	)

30 
	#CONFIG_WLAN_QRF


	)

32 
	~<löux/õì80211.h
>

34 
	~"htc.h
"

35 
	~"wœn_loˇti⁄_defs.h
"

36 
	#HTC_PROTOCOL_VERSION
 0x0002

	)

37 
	#WMI_PROTOCOL_VERSION
 0x0002

	)

38 
	#WMI_CONTROL_MSG_MAX_LEN
 256

	)

39 
	#is_ëhîty≥
(
ty≥_‹_Àn
Ë(—y≥_‹_ÀnË>0x0600)

	)

41 
	#IP_ETHERTYPE
 0x0800

	)

43 
	#WMI_IMPLICIT_PSTREAM
 0xFF

	)

44 
	#WMI_MAX_THINSTREAM
 15

	)

46 
	#SSID_IE_LEN_INDEX
 13

	)

49 
	#SIG_QUALITY_THRESH_LVLS
 6

	)

50 
	#SIG_QUALITY_UPPER_THRESH_LVLS
 
SIG_QUALITY_THRESH_LVLS


	)

51 
	#SIG_QUALITY_LOWER_THRESH_LVLS
 
SIG_QUALITY_THRESH_LVLS


	)

53 
	#A_BAND_24GHZ
 0

	)

54 
	#A_BAND_5GHZ
 1

	)

55 
	#A_NUM_BANDS
 2

	)

58 
	#WMI_IMPLICIT_PSTREAM_INACTIVITY_INT
 5000

	)

67 
__s16
 
	t__bôwi£
 
	ta_¶e16
;

68 
__s32
 
	t__bôwi£
 
	ta_¶e32
;

70 
ölöe
 
a_¶e32
 
	$a_˝u_to_¶e32
(
s32
 
vÆ
)

72  (
__f‹˚
 
a_¶e32
Ë
	`˝u_to_À32
(
vÆ
);

73 
	}
}

75 
ölöe
 
s32
 
	$a_¶e32_to_˝u
(
a_¶e32
 
vÆ
)

77  
	`À32_to_˝u
((
__f‹˚
 
__À32
Ë
vÆ
);

78 
	}
}

80 
ölöe
 
a_¶e16
 
	$a_˝u_to_¶e16
(
s16
 
vÆ
)

82  (
__f‹˚
 
a_¶e16
Ë
	`˝u_to_À16
(
vÆ
);

83 
	}
}

85 
ölöe
 
s16
 
	$a_¶e16_to_˝u
(
a_¶e16
 
vÆ
)

87  
	`À16_to_˝u
((
__f‹˚
 
__À16
Ë
vÆ
);

88 
	}
}

90 
	ssq_thªshﬁd_∑øms
 {

91 
s16
 
	muµî_thªshﬁd
[
SIG_QUALITY_UPPER_THRESH_LVLS
];

92 
s16
 
	mlowî_thªshﬁd
[
SIG_QUALITY_LOWER_THRESH_LVLS
];

93 
u32
 
	muµî_thªshﬁd_vÆid_cou¡
;

94 
u32
 
	mlowî_thªshﬁd_vÆid_cou¡
;

95 
u32
 
	mpﬁlög_öãrvÆ
;

96 
u8
 
	mweight
;

97 
u8
 
	mœ°_rssi
;

98 
u8
 
	mœ°_rssi_pﬁl_evít
;

101 
	swmi_d©a_sync_bufs
 {

102 
u8
 
	måaffic_˛ass
;

103 
sk_buff
 *
	mskb
;

106 
	swmi_mgmt_tx_‰ame
 {

107 
li°_hód
 
	mli°
;

109 
©h6kl_vif
 *
	mvif
;

110 
u8
 *
	mmgmt_tx_‰ame
;

111 
size_t
 
	mmgmt_tx_‰ame_Àn
;

112 
	mmgmt_tx_‰ame_idx
;

113 
u32
 
	mmgmt_tx_‰ame_‰eq
;

114 
	#WMI_TX_MGMT_RETRY_MAX
 (3)

	)

115 
	mmgmt_tx_‰ame_ªåy
;

119 
	#WMM_NUM_AC
 4

	)

120 
	#WMM_AC_BE
 0

	)

121 
	#WMM_AC_BK
 1

	)

122 
	#WMM_AC_VI
 2

	)

123 
	#WMM_AC_VO
 3

	)

125 
	#WMI_VOICE_USER_PRIORITY
 0x7

	)

127 
	swmi
 {

128 
u16
 
	m°ªam_exi°_f‹_ac
[
WMM_NUM_AC
];

129 
u8
 
	mÁt_pùe_exi°
;

130 
©h6kl
 *
	m∑ª¡_dev
;

131 
u8
 
	mpwr_mode
;

132 
•ölock_t
 
	mlock
;

133 
htc_ídpoöt_id
 
	mï_id
;

134 
sq_thªshﬁd_∑øms


135 
	msq_thªshld
[
SIGNAL_QUALITY_METRICS_NUM_MAX
];

136 
boﬁ
 
	mis_wmm_íabÀd
;

137 
u8
 
	måaffic_˛ass
;

138 
boﬁ
 
	mis_¥obe_ssid
;

140 
li°_hód
 
	mmgmt_tx_‰ame_li°
;

141 
u8
 
	msˇn_ªsu…_vÆid
;

142 
u8
 
	msˇn_ªsu…_mac
[
ETH_ALEN
];

143 
waô_queue_hód_t
 
	mwmiEvít
;

146 
	sho°_≠p_¨ó
 {

147 
__À32
 
	mwmi_¥Ÿocﬁ_vî
;

148 } 
	g__∑cked
;

150 
	ewmi_msg_ty≥
 {

151 
	mDATA_MSGTYPE
 = 0x0,

152 
	mCNTL_MSGTYPE
,

153 
	mSYNC_MSGTYPE
,

154 
	mOPT_MSGTYPE
,

161 
	#WMI_DATA_HDR_MSG_TYPE_MASK
 0x03

	)

162 
	#WMI_DATA_HDR_MSG_TYPE_SHIFT
 0

	)

163 
	#WMI_DATA_HDR_UP_MASK
 0x07

	)

164 
	#WMI_DATA_HDR_UP_SHIFT
 2

	)

169 
	#WMI_DATA_HDR_PS_MASK
 0x1

	)

170 
	#WMI_DATA_HDR_PS_SHIFT
 5

	)

172 
	#WMI_DATA_HDR_MORE_MASK
 0x1

	)

173 
	#WMI_DATA_HDR_MORE_SHIFT
 5

	)

174 
	#WMI_DATA_HDR_SET_MORE_BIT
(
h
Ë\

	)

175 ((
	gh
)->
	göfo
 |(
WMI_DATA_HDR_MORE_MASK
 << 
WMI_DATA_HDR_MORE_SHIFT
))

176 
	#WMI_DATA_HDR_HAS_MORE_BIT
(
h
Ë\

	)

177 ((
h
)->
öfo
 & (
WMI_DATA_HDR_MORE_MASK
 << 
WMI_DATA_HDR_MORE_SHIFT
))

179 
	ewmi_d©a_hdr_d©a_ty≥
 {

180 
WMI_DATA_HDR_DATA_TYPE_802_3
 = 0,

181 
	mWMI_DATA_HDR_DATA_TYPE_802_11
,

184 
	mWMI_DATA_HDR_DATA_TYPE_ACL
,

188 
	eWMI_DATA_HDR_FLAGS
 {

189 
	mWMI_DATA_HDR_FLAGS_MORE
 = 0x1,

190 
	mWMI_DATA_HDR_FLAGS_EOSP
 = 0x2,

191 
	mWMI_DATA_HDR_FLAGS_TRIGGERED
 = 0x4,

192 
	mWMI_DATA_HDR_FLAGS_PSPOLLED
 = 0x8,

195 
	#WMI_DATA_HDR_DATA_TYPE_MASK
 0x3

	)

196 
	#WMI_DATA_HDR_DATA_TYPE_SHIFT
 6

	)

199 
	#WMI_DATA_HDR_SEQNO_MASK
 0xFFF

	)

200 
	#WMI_DATA_HDR_SEQNO_SHIFT
 0

	)

202 
	#WMI_DATA_HDR_AMSDU_MASK
 0x1

	)

203 
	#WMI_DATA_HDR_AMSDU_SHIFT
 12

	)

205 
	#WMI_DATA_HDR_META_MASK
 0x7

	)

206 
	#WMI_DATA_HDR_META_SHIFT
 13

	)

208 
	#WMI_DATA_HDR_PAD_BEFORE_DATA_MASK
 0xFF

	)

209 
	#WMI_DATA_HDR_PAD_BEFORE_DATA_SHIFT
 0x8

	)

211 
	#WMI_DATA_HDR_IF_IDX_MASK
 0xF

	)

214 
	#WMI_DATA_HDR_TRIGGER_MASK
 0x1

	)

215 
	#WMI_DATA_HDR_TRIGGER_SHIFT
 4

	)

216 
	#WMI_DATA_HDR_SET_TRIGGER
(
h
, 
_v
Ë\

	)

217 ((
	gh
)->
	göfo3
 = ((
h
)->
öfo3
 & ~(
WMI_DATA_HDR_TRIGGER_MASK
 << \

218 
WMI_DATA_HDR_TRIGGER_SHIFT
)) \

219 | ((
_v
Ë<< 
WMI_DATA_HDR_TRIGGER_SHIFT
))

220 
	#WMI_DATA_HDR_IS_TRIGGER
(
h
Ë\

	)

221 (((
À16_to_˝u
((
h
)->
öfo3
Ë>> 
WMI_DATA_HDR_TRIGGER_SHIFT
) & \

222 
WMI_DATA_HDR_TRIGGER_MASK
) == WMI_DATA_HDR_TRIGGER_MASK)

224 
	#WMI_DATA_HDR_EOSP_MASK
 
WMI_DATA_HDR_TRIGGER_MASK


	)

225 
	#WMI_DATA_HDR_EOSP_SHIFT
 
WMI_DATA_HDR_TRIGGER_SHIFT


	)

226 
	#WMI_DATA_HDR_SET_EOSP_BIT
(
h
Ë\

	)

227 ((
h
)->
öfo3
 |(
WMI_DATA_HDR_EOSP_MASK
 << 
WMI_DATA_HDR_EOSP_SHIFT
))

228 
	#WMI_DATA_HDR_HAS_EOSP_BIT
(
h
Ë\

	)

229 ((
h
)->
öfo3
 & (
WMI_DATA_HDR_EOSP_MASK
 << 
WMI_DATA_HDR_EOSP_SHIFT
))

231 
	#WMI_DATA_HDR_TRIGGERED_MASK
 0x1

	)

232 
	#WMI_DATA_HDR_TRIGGERED_SHIFT
 6

	)

233 
	#WMI_DATA_HDR_SET_TRIGGERED_BIT
(
h
Ë((h)->
öfo3
 |\

	)

234 (
WMI_DATA_HDR_TRIGGERED_MASK
 << 
WMI_DATA_HDR_TRIGGERED_SHIFT
))

235 
	#WMI_DATA_HDR_HAS_TRIGGERED_BIT
(
h
Ë((h)->
öfo3
 & \

	)

236 (
WMI_DATA_HDR_TRIGGERED_MASK
 << 
WMI_DATA_HDR_TRIGGERED_SHIFT
))

238 
	#WMI_DATA_HDR_PSPOLLED_MASK
 0x1

	)

239 
	#WMI_DATA_HDR_PSPOLLED_SHIFT
 7

	)

240 
	#WMI_DATA_HDR_SET_PSPOLLED_BIT
(
h
Ë((h)->
öfo3
 |\

	)

241 (
WMI_DATA_HDR_PSPOLLED_MASK
 << 
WMI_DATA_HDR_PSPOLLED_SHIFT
))

242 
	#WMI_DATA_HDR_HAS_PSPOLLED_BIT
(
h
Ë((h)->
öfo3
 & \

	)

243 (
WMI_DATA_HDR_PSPOLLED_MASK
 << 
WMI_DATA_HDR_PSPOLLED_SHIFT
))

245 
	swmi_d©a_hdr
 {

246 
s8
 
rssi
;

259 
u8
 
	möfo
;

268 
__À16
 
	möfo2
;

275 
__À16
 
	möfo3
;

276 } 
	g__∑cked
;

278 
ölöe
 
u8
 
	$wmi_d©a_hdr_gë_up
(
wmi_d©a_hdr
 *
dhdr
)

280  (
dhdr
->
öfo
 >> 
WMI_DATA_HDR_UP_SHIFT
Ë& 
WMI_DATA_HDR_UP_MASK
;

281 
	}
}

283 
ölöe
 
	$wmi_d©a_hdr_£t_up
(
wmi_d©a_hdr
 *
dhdr
,

284 
u8
 
u§_¥i
)

286 
dhdr
->
öfo
 &~(
WMI_DATA_HDR_UP_MASK
 << 
WMI_DATA_HDR_UP_SHIFT
);

287 
dhdr
->
öfo
 |
u§_¥i
 << 
WMI_DATA_HDR_UP_SHIFT
;

288 
	}
}

290 
ölöe
 
u8
 
	$wmi_d©a_hdr_gë_dŸ11
(
wmi_d©a_hdr
 *
dhdr
)

292 
u8
 
d©a_ty≥
;

294 
d©a_ty≥
 = (
dhdr
->
öfo
 >> 
WMI_DATA_HDR_DATA_TYPE_SHIFT
) &

295 
WMI_DATA_HDR_DATA_TYPE_MASK
;

296  (
d©a_ty≥
 =
WMI_DATA_HDR_DATA_TYPE_802_11
);

297 
	}
}

299 
ölöe
 
u16
 
	$wmi_d©a_hdr_gë_£qno
(
wmi_d©a_hdr
 *
dhdr
)

301  (
	`À16_to_˝u
(
dhdr
->
öfo2
Ë>> 
WMI_DATA_HDR_SEQNO_SHIFT
) &

302 
WMI_DATA_HDR_SEQNO_MASK
;

303 
	}
}

305 
ölöe
 
u8
 
	$wmi_d©a_hdr_is_amsdu
(
wmi_d©a_hdr
 *
dhdr
)

307  (
	`À16_to_˝u
(
dhdr
->
öfo2
Ë>> 
WMI_DATA_HDR_AMSDU_SHIFT
) &

308 
WMI_DATA_HDR_AMSDU_MASK
;

309 
	}
}

311 
ölöe
 
u8
 
	$wmi_d©a_hdr_gë_mëa
(
wmi_d©a_hdr
 *
dhdr
)

313  (
	`À16_to_˝u
(
dhdr
->
öfo2
Ë>> 
WMI_DATA_HDR_META_SHIFT
) &

314 
WMI_DATA_HDR_META_MASK
;

315 
	}
}

317 
ölöe
 
u8
 
	$wmi_d©a_hdr_gë_if_idx
(
wmi_d©a_hdr
 *
dhdr
)

319  
	`À16_to_˝u
(
dhdr
->
öfo3
Ë& 
WMI_DATA_HDR_IF_IDX_MASK
;

320 
	}
}

323 
	#WMI_MAX_TX_META_SZ
 12

	)

324 
	#WMI_META_VERSION_1
 0x01

	)

325 
	#WMI_META_VERSION_2
 0x02

	)

327 
	swmi_tx_mëa_v1
 {

329 
u8
 
	mpkt_id
;

332 
u8
 
	møã_∂cy_id
;

333 } 
	g__∑cked
;

335 
	swmi_tx_mëa_v2
 {

340 
u8
 
	mcsum_°¨t
;

343 
u8
 
	mcsum_de°
;

346 
u8
 
	mcsum_Êags
;

347 } 
	g__∑cked
;

349 
	swmi_rx_mëa_v1
 {

350 
u8
 
	m°©us
;

353 
u8
 
	mrix
;

356 
u8
 
	mrssi
;

359 
u8
 
	mch™√l
;

361 
__À16
 
	mÊags
;

362 } 
	g__∑cked
;

364 
	swmi_rx_mëa_v2
 {

365 
__À16
 
	mcsum
;

368 
u8
 
	mcsum_Êags
;

369 } 
	g__∑cked
;

371 
	#WMI_CMD_HDR_IF_ID_MASK
 0xF

	)

374 
	swmi_cmd_hdr
 {

375 
__À16
 
	mcmd_id
;

380 
__À16
 
	möfo1
;

383 
__À16
 
	mª£rved
;

384 } 
	g__∑cked
;

386 
ölöe
 
u8
 
	$wmi_cmd_hdr_gë_if_idx
(
wmi_cmd_hdr
 *
chdr
)

388  
	`À16_to_˝u
(
chdr
->
öfo1
Ë& 
WMI_CMD_HDR_IF_ID_MASK
;

389 
	}
}

392 
	ewmi_cmd_id
 {

393 
	mWMI_CONNECT_CMDID
 = 0x0001,

394 
	mWMI_RECONNECT_CMDID
,

395 
	mWMI_DISCONNECT_CMDID
,

396 
	mWMI_SYNCHRONIZE_CMDID
,

397 
	mWMI_CREATE_PSTREAM_CMDID
,

398 
	mWMI_DELETE_PSTREAM_CMDID
,

399 
	mWMI_START_SCAN_CMDID
,

400 
	mWMI_SET_SCAN_PARAMS_CMDID
,

401 
	mWMI_SET_BSS_FILTER_CMDID
,

402 
	mWMI_SET_PROBED_SSID_CMDID
,

403 
	mWMI_SET_LISTEN_INT_CMDID
,

404 
	mWMI_SET_BMISS_TIME_CMDID
,

405 
	mWMI_SET_DISC_TIMEOUT_CMDID
,

406 
	mWMI_GET_CHANNEL_LIST_CMDID
,

407 
	mWMI_SET_BEACON_INT_CMDID
,

408 
	mWMI_GET_STATISTICS_CMDID
,

409 
	mWMI_SET_CHANNEL_PARAMS_CMDID
,

410 
	mWMI_SET_POWER_MODE_CMDID
,

411 
	mWMI_SET_IBSS_PM_CAPS_CMDID
,

412 
	mWMI_SET_POWER_PARAMS_CMDID
,

413 
	mWMI_SET_POWERSAVE_TIMERS_POLICY_CMDID
,

414 
	mWMI_ADD_CIPHER_KEY_CMDID
,

415 
	mWMI_DELETE_CIPHER_KEY_CMDID
,

416 
	mWMI_ADD_KRK_CMDID
,

417 
	mWMI_DELETE_KRK_CMDID
,

418 
	mWMI_SET_PMKID_CMDID
,

419 
	mWMI_SET_TX_PWR_CMDID
,

420 
	mWMI_GET_TX_PWR_CMDID
,

421 
	mWMI_SET_ASSOC_INFO_CMDID
,

422 
	mWMI_ADD_BAD_AP_CMDID
,

423 
	mWMI_DELETE_BAD_AP_CMDID
,

424 
	mWMI_SET_TKIP_COUNTERMEASURES_CMDID
,

425 
	mWMI_RSSI_THRESHOLD_PARAMS_CMDID
,

426 
	mWMI_TARGET_ERROR_REPORT_BITMASK_CMDID
,

427 
	mWMI_SET_ACCESS_PARAMS_CMDID
,

428 
	mWMI_SET_RETRY_LIMITS_CMDID
,

429 
	mWMI_SET_OPT_MODE_CMDID
,

430 
	mWMI_OPT_TX_FRAME_CMDID
,

431 
	mWMI_SET_VOICE_PKT_SIZE_CMDID
,

432 
	mWMI_SET_MAX_SP_LEN_CMDID
,

433 
	mWMI_SET_ROAM_CTRL_CMDID
,

434 
	mWMI_GET_ROAM_TBL_CMDID
,

435 
	mWMI_GET_ROAM_DATA_CMDID
,

436 
	mWMI_ENABLE_RM_CMDID
,

437 
	mWMI_SET_MAX_OFFHOME_DURATION_CMDID
,

438 
	mWMI_EXTENSION_CMDID
,

439 
	mWMI_SNR_THRESHOLD_PARAMS_CMDID
,

440 
	mWMI_LQ_THRESHOLD_PARAMS_CMDID
,

441 
	mWMI_SET_LPREAMBLE_CMDID
,

442 
	mWMI_SET_RTS_CMDID
,

443 
	mWMI_CLR_RSSI_SNR_CMDID
,

444 
	mWMI_SET_FIXRATES_CMDID
,

445 
	mWMI_GET_FIXRATES_CMDID
,

446 
	mWMI_SET_AUTH_MODE_CMDID
,

447 
	mWMI_SET_REASSOC_MODE_CMDID
,

448 
	mWMI_SET_WMM_CMDID
,

449 
	mWMI_SET_WMM_TXOP_CMDID
,

450 
	mWMI_TEST_CMDID
,

452 
	mWMI_SET_BT_STATUS_CMDID
,

453 
	mWMI_SET_BT_PARAMS_CMDID
,

455 
	mWMI_SET_KEEPALIVE_CMDID
,

456 
	mWMI_GET_KEEPALIVE_CMDID
,

457 
	mWMI_SET_APPIE_CMDID
,

458 
	mWMI_GET_APPIE_CMDID
,

459 
	mWMI_SET_WSC_STATUS_CMDID
,

462 
	mWMI_SET_HOST_SLEEP_MODE_CMDID
,

463 
	mWMI_SET_WOW_MODE_CMDID
,

464 
	mWMI_GET_WOW_LIST_CMDID
,

465 
	mWMI_ADD_WOW_PATTERN_CMDID
,

466 
	mWMI_DEL_WOW_PATTERN_CMDID
,

468 
	mWMI_SET_FRAMERATES_CMDID
,

469 
	mWMI_SET_AP_PS_CMDID
,

470 
	mWMI_SET_QOS_SUPP_CMDID
,

472 #ifde‡
CONFIG_WLAN_QRF


473 
	mWMI_QRF_EN_CMD_ID
,

474 
	mWMI_QRF_SET_SSID_CMD_ID
,

475 
	mWMI_QRF_SET_MAC_CMD_ID
,

476 
	mWMI_QRF_SET_PARAMS_CMD_ID
,

477 
	mWMI_QRF_SET_APPARAMS_CMD_ID
,

478 
	mWMI_QRF_GET_SCAN_RESULTS_CMD_ID
,

479 
	mWMI_SET_RANDOM_BEACON_SKIP_CMDID
,

482 #ifde‡
DHCP_CLIENT_FEATURE


483 
	mWMI_SET_DHCP_CLIENT_CMDID
,

486 #ifde‡
DHCP_SERVER_FEATURE


487 
	mWMI_SET_DHCP_SERVER_CMDID
,

493 
	mWMI_THIN_RESERVED_START
 = 0x8000,

494 
	mWMI_THIN_RESERVED_END
 = 0x8fff,

498 
	mWMI_SET_BITRATE_CMDID
 = 0xF000,

499 
	mWMI_GET_BITRATE_CMDID
,

500 
	mWMI_SET_WHALPARAM_CMDID
,

506 
	mWMI_SET_MAC_ADDRESS_CMDID
,

507 
	mWMI_SET_AKMP_PARAMS_CMDID
,

508 
	mWMI_SET_PMKID_LIST_CMDID
,

509 
	mWMI_GET_PMKID_LIST_CMDID
,

510 
	mWMI_ABORT_SCAN_CMDID
,

511 
	mWMI_SET_TARGET_EVENT_REPORT_CMDID
,

514 
	mWMI_UNUSED1
,

515 
	mWMI_UNUSED2
,

520 
	mWMI_AP_HIDDEN_SSID_CMDID
,

521 
	mWMI_AP_SET_NUM_STA_CMDID
,

522 
	mWMI_AP_ACL_POLICY_CMDID
,

523 
	mWMI_AP_ACL_MAC_LIST_CMDID
,

524 
	mWMI_AP_CONFIG_COMMIT_CMDID
,

525 
	mWMI_AP_SET_MLME_CMDID
,

526 
	mWMI_AP_SET_PVB_CMDID
,

527 
	mWMI_AP_CONN_INACT_CMDID
,

528 
	mWMI_AP_PROT_SCAN_TIME_CMDID
,

529 
	mWMI_AP_SET_COUNTRY_CMDID
,

530 
	mWMI_AP_SET_DTIM_CMDID
,

531 
	mWMI_AP_MODE_STAT_CMDID
,

533 
	mWMI_SET_IP_CMDID
,

534 
	mWMI_SET_PARAMS_CMDID
,

535 
	mWMI_SET_MCAST_FILTER_CMDID
,

536 
	mWMI_DEL_MCAST_FILTER_CMDID
,

538 
	mWMI_ALLOW_AGGR_CMDID
,

539 
	mWMI_ADDBA_REQ_CMDID
,

540 
	mWMI_DELBA_REQ_CMDID
,

541 
	mWMI_SET_HT_CAP_CMDID
,

542 
	mWMI_SET_HT_OP_CMDID
,

543 
	mWMI_SET_TX_SELECT_RATES_CMDID
,

544 
	mWMI_SET_TX_SGI_PARAM_CMDID
,

545 
	mWMI_SET_RATE_POLICY_CMDID
,

547 
	mWMI_HCI_CMD_CMDID
,

548 
	mWMI_RX_FRAME_FORMAT_CMDID
,

549 
	mWMI_SET_THIN_MODE_CMDID
,

550 
	mWMI_SET_BT_WLAN_CONN_PRECEDENCE_CMDID
,

552 
	mWMI_AP_SET_11BG_RATESET_CMDID
,

553 
	mWMI_SET_PMK_CMDID
,

554 
	mWMI_MCAST_FILTER_CMDID
,

556 
	mWMI_SET_BTCOEX_FE_ANT_CMDID
,

557 
	mWMI_SET_BTCOEX_COLOCATED_BT_DEV_CMDID
,

558 
	mWMI_SET_BTCOEX_SCO_CONFIG_CMDID
,

559 
	mWMI_SET_BTCOEX_A2DP_CONFIG_CMDID
,

560 
	mWMI_SET_BTCOEX_ACLCOEX_CONFIG_CMDID
,

561 
	mWMI_SET_BTCOEX_BTINQUIRY_PAGE_CONFIG_CMDID
,

562 
	mWMI_SET_BTCOEX_DEBUG_CMDID
,

563 
	mWMI_SET_BTCOEX_BT_OPERATING_STATUS_CMDID
,

564 
	mWMI_GET_BTCOEX_STATS_CMDID
,

565 
	mWMI_GET_BTCOEX_CONFIG_CMDID
,

567 
	mWMI_DFS_RESERVED
,

568 
	mWMI_SET_DFS_MINRSSITHRESH_CMDID
,

569 
	mWMI_SET_DFS_MAXPULSEDUR_CMDID
,

570 
	mWMI_DFS_RADAR_DETECTED_CMDID
,

573 
	mWMI_P2P_SET_CONFIG_CMDID
,

574 
	mWMI_WPS_SET_CONFIG_CMDID
,

575 
	mWMI_SET_REQ_DEV_ATTR_CMDID
,

576 
	mWMI_P2P_FIND_CMDID
,

577 
	mWMI_P2P_STOP_FIND_CMDID
,

578 
	mWMI_P2P_GO_NEG_START_CMDID
,

579 
	mWMI_P2P_LISTEN_CMDID
,

582 
	mWMI_CONFIG_TX_MAC_RULES_CMDID
,

583 
	mWMI_SET_PROMISCUOUS_MODE_CMDID
,

584 
	mWMI_RX_FRAME_FILTER_CMDID
,

585 
	mWMI_SET_CHANNEL_CMDID
,

588 
	mWMI_ENABLE_WAC_CMDID
,

589 
	mWMI_WAC_SCAN_REPLY_CMDID
,

590 
	mWMI_WAC_CTRL_REQ_CMDID
,

592 
	mWMI_SET_DIV_PARAMS_CMDID
,

593 
	mWMI_GET_PMK_CMDID
,

594 
	mWMI_SET_PASSPHRASE_CMDID
,

595 
	mWMI_SEND_ASSOC_RES_CMDID
,

596 
	mWMI_SET_ASSOC_REQ_RELAY_CMDID
,

599 
	mWMI_ACS_CTRL_CMDID
,

600 
	mWMI_SET_EXCESS_TX_RETRY_THRES_CMDID
,

601 
	mWMI_SET_TBD_TIME_CMDID
,

604 
	mWMI_PKTLOG_ENABLE_CMDID
,

605 
	mWMI_PKTLOG_DISABLE_CMDID
,

608 
	mWMI_P2P_GO_NEG_REQ_RSP_CMDID
,

609 
	mWMI_P2P_GRP_INIT_CMDID
,

610 
	mWMI_P2P_GRP_FORMATION_DONE_CMDID
,

611 
	mWMI_P2P_INVITE_CMDID
,

612 
	mWMI_P2P_INVITE_REQ_RSP_CMDID
,

613 
	mWMI_P2P_PROV_DISC_REQ_CMDID
,

614 
	mWMI_P2P_SET_CMDID
,

616 
	mWMI_GET_RFKILL_MODE_CMDID
,

617 
	mWMI_SET_RFKILL_MODE_CMDID
,

618 
	mWMI_AP_SET_APSD_CMDID
,

619 
	mWMI_AP_APSD_BUFFERED_TRAFFIC_CMDID
,

621 
	mWMI_P2P_SDPD_TX_CMDID
,

622 
	mWMI_P2P_STOP_SDPD_CMDID
,

623 
	mWMI_P2P_CANCEL_CMDID
,

625 
	mWMI_STORERECALL_CONFIGURE_CMDID
,

626 
	mWMI_STORERECALL_RECALL_CMDID
,

627 
	mWMI_STORERECALL_HOST_READY_CMDID
,

628 
	mWMI_FORCE_TARGET_ASSERT_CMDID
,

630 
	mWMI_SET_PROBED_SSID_EX_CMDID
,

631 
	mWMI_SET_NETWORK_LIST_OFFLOAD_CMDID
,

632 
	mWMI_SET_ARP_NS_OFFLOAD_CMDID
,

633 
	mWMI_ADD_WOW_EXT_PATTERN_CMDID
,

634 
	mWMI_GTK_OFFLOAD_OP_CMDID
,

636 
	mWMI_REMAIN_ON_CHNL_CMDID
,

637 
	mWMI_CANCEL_REMAIN_ON_CHNL_CMDID
,

638 
	mWMI_SEND_ACTION_CMDID
,

639 
	mWMI_PROBE_REQ_REPORT_CMDID
,

640 
	mWMI_DISABLE_11B_RATES_CMDID
,

641 
	mWMI_SEND_PROBE_RESPONSE_CMDID
,

642 
	mWMI_GET_P2P_INFO_CMDID
,

643 
	mWMI_AP_JOIN_BSS_CMDID
,

645 
	mWMI_SMPS_ENABLE_CMDID
,

646 
	mWMI_SMPS_CONFIG_CMDID
,

647 
	mWMI_SET_RATECTRL_PARM_CMDID
,

649 
	mWMI_LPL_FORCE_ENABLE_CMDID
,

650 
	mWMI_LPL_SET_POLICY_CMDID
,

651 
	mWMI_LPL_GET_POLICY_CMDID
,

652 
	mWMI_LPL_GET_HWSTATE_CMDID
,

653 
	mWMI_LPL_SET_PARAMS_CMDID
,

654 
	mWMI_LPL_GET_PARAMS_CMDID
,

656 
	mWMI_SET_BUNDLE_PARAM_CMDID
,

659 
	mWMI_GREENTX_PARAMS_CMDID
,

662 
	mWMI_WPS_START_CMDID
,

663 
	mWMI_GET_WPS_STATUS_CMDID
,

666 
	mWMI_SET_NOA_CMDID
,

667 
	mWMI_GET_NOA_CMDID
,

668 
	mWMI_SET_OPPPS_CMDID
,

669 
	mWMI_GET_OPPPS_CMDID
,

670 
	mWMI_ADD_PORT_CMDID
,

671 
	mWMI_DEL_PORT_CMDID
,

674 
	mWMI_SET_RSN_CAP_CMDID
,

675 
	mWMI_GET_RSN_CAP_CMDID
,

676 
	mWMI_SET_IGTK_CMDID
,

678 
	mWMI_RX_FILTER_COALESCE_FILTER_OP_CMDID
,

679 
	mWMI_RX_FILTER_SET_FRAME_TEST_LIST_CMDID
,

681 
	mWMI_RTT_MEASREQ_CMDID
,

682 
	mWMI_RTT_CAPREQ_CMDID
,

683 
	mWMI_RTT_STATUSREQ_CMDID
,

686 
	mWMI_ENABLE_LED_CMDID
,

687 
	mWMI_CONFIG_LED_CMDID
,

688 
	mWMI_SET_LED_CMDID
,

690 
	mWMI_SOCKET_CMDID
,

691 
	mWMI_P2P_PSIE_CONFIG_CMDID
,

692 
	mWMI_LOG_FRAME_CMDID
,

693 
	mWMI_QUERY_PHY_INFO_CMDID
,

695 
	mWMI_P2P_CONNECT_CMDID
,

696 
	mWMI_P2P_GET_NODE_LIST_CMDID
,

697 
	mWMI_P2P_AUTH_GO_NEG_CMDID
,

698 
	mWMI_P2P_FW_PROV_DISC_REQ_CMDID
,

700 
	mWMI_SET_DFS_ENABLE_CMDID
,

702 
	mWMI_CCX_FRAME_REPORT_CMDID
,

703 
	mWMI_CCX_HOST_FEATURE_CONFIG_CMDID
,

704 
	mWMI_DIAGNOSTIC_CMDID
,

705 
	mWMI_SET_FILTERED_PROMISCUOUS_MODE_CMDID
,

708 
	mWMI_SET_BTCOEX_HID_CONFIG_CMDID
,

709 
	mWMI_RTT_CONFIG_CMDID
,

710 
	mWMI_STA_BMISS_ENHANCE_CMDID
,

711 
	mWMI_P2P_PERSISTENT_PROFILE_CMDID
,

712 
	mWMI_P2P_SET_JOIN_PROFILE_CMDID
,

715 
	mWMI_HEART_PARAMS_CMDID
,

716 
	mWMI_HEART_SET_TCP_PARAMS_CMDID
,

717 
	mWMI_HEART_SET_TCP_PKT_FILTER_CMDID
,

718 
	mWMI_HEART_SET_UDP_PARAMS_CMDID
,

719 
	mWMI_HEART_SET_UDP_PKT_FILTER_CMDID
,

720 
	mWMI_HEART_SET_NETWORK_INFO_CMDID
,

723 
	mWMI_DISC_SET_IE_FILTER_CMDID
,

724 
	mWMI_DISC_SET_MODE_CMDID
,

726 
	mWMI_RTT_CLKCALINFO_CMDID
,

728 
	mWMI_P2P_SET_PROFILE_CMDID
,

731 
	mWMI_P2P_FW_SET_NOA_CMDID
,

732 
	mWMI_P2P_FW_GET_NOA_CMDID
,

733 
	mWMI_P2P_FW_SET_OPPPS_CMDID
,

734 
	mWMI_P2P_FW_GET_OPPPS_CMDID
,

737 
	mWMI_ENABLE_BLINKING_LED_CMDID
,

739 
	mWMI_AP_POLL_STA_CMDID
,

740 
	mWMI_AP_PSBUF_OFFLOAD_CMDID
,

741 
	mWMI_SET_REGDOMAIN_CMDID
,

743 
	mWMI_ARGOS_CMDID
,

744 
	mWMI_SEND_MGMT_CMDID
,

745 
	mWMI_BEGIN_SCAN_CMDID
,

746 
	mWMI_SET_IE_CMDID
,

747 
	mWMI_SET_RSSI_FILTER_CMDID
,

748 
	mWMI_SET_CREDIT_REVERSE_CMDID
 = 0xF0B6,

749 
	mWMI_SET_RCV_DATA_CLASSIFIER_CMDID
,

750 
	mWMI_AP_SET_IDLE_CLOSE_TIME_CMDID
,

751 
	mWMI_SET_LTE_COEX_STATE_CMDID
,

752 
	mWMI_SET_MCC_PROFILE_CMDID
,

753 
	mWMI_SET_MEDIA_STREAM_CMDID
 = 0xF0BB,

756 
	mWMI_SET_CUSTOM_REG
,

757 
	mWMI_GET_CUSTOM_REG
,

758 
	mWMI_GET_CUSTOM_PRODUCT_INFO
,

759 
	mWMI_SET_CUSTOM_TESTMODE
,

760 
	mWMI_GET_CUSTOM_TESTMODE
,

761 
	mWMI_GET_CUSTOM_STAINFO
,

762 
	mWMI_GET_CUSTOM_SCANTIME
,

763 
	mWMI_SET_CUSTOM_SCAN
,

764 
	mWMI_GET_CUSTOM_SCAN
,

765 
	mWMI_GET_CUSTOM_VERSION_INFO
,

766 
	mWMI_GET_CUSTOM_WIFI_TXPOW
,

767 
	mWMI_GET_CUSTOM_ATHSTATS
,

769 
	mWMI_TX99TOOL_CMDID
,

770 
	mWMI_SET_CUSTOM_PROBE_RESP_REPORT_CMDID
,

771 
	mWMI_SET_CUSTOM_WIDI
,

772 
	mWMI_GET_CUSTOM_WIDI
,

775 
	mWMI_SET_ANTDIVCFG_CMDID
,

776 
	mWMI_GET_ANTDIVSTAT_CMDID
,

778 
	mWMI_GET_ANISTAT_CMDID
,

780 
	mWMI_SET_SEAMLESS_MCC_SCC_SWITCH_FREQ_CMDID
,

782 
	mWMI_SET_CHAIN_MASK_CMDID
,

784 
	mWMI_SET_SCAN_CHAN_PLAN_CMDID
,

785 
	mWMI_SET_MCC_EVENT_MODE_CMDID
,

786 
	mWMI_GET_CTL
,

791 
	mWMI_SET_GO_SYNC_CMDID
 = 0xFFFC,

792 
	mWMI_SET_DTIM_EXT_CMDID
 = 0xFFFD,

793 
	mWMI_SET_CREDIT_BYPASS_CMDID
 = 0xFFFE,

796 
	ewmi_mgmt_‰ame_ty≥
 {

797 
	mWMI_FRAME_BEACON
 = 0,

798 
	mWMI_FRAME_PROBE_REQ
,

799 
	mWMI_FRAME_PROBE_RESP
,

800 
	mWMI_FRAME_ASSOC_REQ
,

801 
	mWMI_FRAME_ASSOC_RESP
,

802 
	mWMI_NUM_MGMT_FRAME


806 
	e√tw‹k_ty≥
 {

807 
	mINFRA_NETWORK
 = 0x01,

808 
	mADHOC_NETWORK
 = 0x02,

809 
	mADHOC_CREATOR
 = 0x04,

810 
	mAP_NETWORK
 = 0x10,

813 
	edŸ11_auth_mode
 {

814 
	mOPEN_AUTH
 = 0x01,

815 
	mSHARED_AUTH
 = 0x02,

818 
	mLEAP_AUTH
 = 0x04,

821 
	eauth_mode
 {

822 
	mNONE_AUTH
 = 0x01,

823 
	mWPA_AUTH
 = 0x02,

824 
	mWPA2_AUTH
 = 0x04,

825 
	mWPA_PSK_AUTH
 = 0x08,

826 
	mWPA2_PSK_AUTH
 = 0x10,

827 
	mWPA_AUTH_CCKM
 = 0x20,

828 
	mWPA2_AUTH_CCKM
 = 0x40,

829 #ifde‡
PMF_SUPPORT


830 
	mWPA2_PSK_SHA256_AUTH
 = 0x80,

834 
	#WMI_MIN_KEY_INDEX
 0

	)

835 
	#WMI_MAX_KEY_INDEX
 3

	)

837 
	#WMI_MAX_KEY_LEN
 32

	)

839 #ifde‡
PMF_SUPPORT


840 
	#WMI_MIN_IGTK_INDEX
 4

	)

841 
	#WMI_MAX_IGTK_INDEX
 5

	)

842 
	#WMI_IGTK_KEY_LEN
 16

	)

850 
	#ATH6KL_CIPHER_WEP
 0

	)

851 
	#ATH6KL_CIPHER_TKIP
 1

	)

852 
	#ATH6KL_CIPHER_AES_OCB
 2

	)

853 
	#ATH6KL_CIPHER_AES_CCM
 3

	)

854 
	#ATH6KL_CIPHER_CKIP
 5

	)

855 
	#ATH6KL_CIPHER_CCKM_KRK
 6

	)

856 
	#ATH6KL_CIPHER_NONE
 7

	)

861 
	#ATH6KL_RATE_MAXSIZE
 15

	)

863 
	#ATH_OUI_TYPE
 0x01

	)

864 
	#WPA_OUI_TYPE
 0x01

	)

865 
	#WMM_PARAM_OUI_SUBTYPE
 0x01

	)

866 
	#WMM_OUI_TYPE
 0x02

	)

867 
	#WSC_OUT_TYPE
 0x04

	)

869 
	ewmi_c⁄√˘_˘æ_Êags_bôs
 {

870 
	mCONNECT_ASSOC_POLICY_USER
 = 0x0001,

871 
	mCONNECT_SEND_REASSOC
 = 0x0002,

872 
	mCONNECT_IGNORE_WPAx_GROUP_CIPHER
 = 0x0004,

873 
	mCONNECT_PROFILE_MATCH_DONE
 = 0x0008,

874 
	mCONNECT_IGNORE_AAC_BEACON
 = 0x0010,

875 
	mCONNECT_CSA_FOLLOW_BSS
 = 0x0020,

876 
	mCONNECT_DO_WPA_OFFLOAD
 = 0x0040,

877 
	mCONNECT_DO_NOT_DEAUTH
 = 0x0080,

878 
	mCONNECT_WPS_FLAG
 = 0x0100,

880 
	mAP_NO_DISASSOC_UPON_DEAUTH
 = 0x10000,

881 
	mAP_HOSTPAL_SUPPORT
 = 0x20000,

884 
	#WMI_CONNECT_AP_CHAN_SELECT_OFFSET
 (14)

	)

885 
	#WMI_CONNECT_AP_CHAN_SELECT_MASK
 (0xc000)

	)

887 
	ewmi_c⁄√˘_≠_ch™√l_ty≥
 {

888 
	mAP_CHANNEL_TYPE_NONE
 = 0,

889 
	mAP_CHANNEL_TYPE_HT40PLUS
,

890 
	mAP_CHANNEL_TYPE_HT40MINUS
,

891 
	mAP_CHANNEL_TYPE_HT20


894 
	swmi_c⁄√˘_cmd
 {

895 
u8
 
	mnw_ty≥
;

896 
u8
 
	mdŸ11_auth_mode
;

897 
u8
 
	mauth_mode
;

898 
u8
 
	m¥wi£_¸y±o_ty≥
;

899 
u8
 
	m¥wi£_¸y±o_Àn
;

900 
u8
 
	mgΩ_¸y±o_ty≥
;

901 
u8
 
	mgΩ_¸y±o_Àn
;

902 
u8
 
	mssid_Àn
;

903 
u8
 
	mssid
[
IEEE80211_MAX_SSID_LEN
];

904 
__À16
 
	mch
;

905 
u8
 
	mbssid
[
ETH_ALEN
];

906 
__À32
 
	m˘æ_Êags
;

907 } 
	g__∑cked
;

910 
	swmi_øndom_bóc⁄_skù_cmd
 {

911 
u32
 
	míabÀ
;

912 
u32
 
	m⁄
;

913 
u32
 
	m∫d
;

914 
u32
 
	moff
;

915 } 
	g__∑cked
;

917 #ifde‡
DHCP_CLIENT_FEATURE


919 
	swmi_dh˝_∑øms_cmd
 {

920 
u32
 
	míabÀ
;

921 
u32
 
	mù
;

922 } 
	g__∑cked
;

927 
	swmi_ªc⁄√˘_cmd
 {

929 
__À16
 
	mch™√l
;

932 
u8
 
	mbssid
[
ETH_ALEN
];

933 } 
	g__∑cked
;

936 
	ekey_ußge
 {

937 
	mPAIRWISE_USAGE
 = 0x00,

938 
	mGROUP_USAGE
 = 0x01,

941 
	mTX_USAGE
 = 0x02,

948 
	#KEY_OP_INIT_TSC
 0x01

	)

949 
	#KEY_OP_INIT_RSC
 0x02

	)

952 
	#KEY_OP_INIT_VAL
 0x03

	)

953 
	#KEY_OP_VALID_MASK
 0x03

	)

955 
	swmi_add_cùhî_key_cmd
 {

956 
u8
 
	mkey_ödex
;

957 
u8
 
	mkey_ty≥
;

960 
u8
 
	mkey_ußge
;

962 
u8
 
	mkey_Àn
;

965 
u8
 
	mkey_rsc
[8];

967 
u8
 
	mkey
[
WLAN_MAX_KEY_LEN
];

970 
u8
 
	mkey_›_˘æ
;

972 
u8
 
	mkey_mac_addr
[
ETH_ALEN
];

973 } 
	g__∑cked
;

976 
	swmi_dñëe_cùhî_key_cmd
 {

977 
u8
 
	mkey_ödex
;

978 } 
	g__∑cked
;

980 
	#WMI_KRK_LEN
 16

	)

983 
	swmi_add_krk_cmd
 {

984 
u8
 
	mkrk
[
WMI_KRK_LEN
];

985 } 
	g__∑cked
;

987 #ifde‡
PMF_SUPPORT


988 
	swmi_add_igtk_cmd
 {

989 
u8
 
	mkey_ödex
;

990 
u8
 
	mkey_Àn
;

991 
u8
 
	mkey_rsc
[6];

992 
u8
 
	mkey
[
WMI_IGTK_KEY_LEN
];

993 } 
	g__∑cked
;

998 
	#WMI_PMKID_LEN
 16

	)

1000 
	epmkid_íabÀ_Êg
 {

1001 
	mPMKID_DISABLE
 = 0,

1002 
	mPMKID_ENABLE
 = 1,

1005 
	swmi_£çmkid_cmd
 {

1006 
u8
 
	mbssid
[
ETH_ALEN
];

1009 
u8
 
	míabÀ
;

1011 
u8
 
	mpmkid
[
WMI_PMKID_LEN
];

1012 } 
	g__∑cked
;

1015 
	ewmi_sˇn_ty≥
 {

1016 
	mWMI_LONG_SCAN
 = 0,

1017 
	mWMI_SHORT_SCAN
 = 1,

1020 
	swmi_°¨t_sˇn_cmd
 {

1021 
__À32
 
	mf‹˚_fg_sˇn
;

1024 
__À32
 
	mis_Àgacy
;

1027 
__À32
 
	mhome_dwñl_time
;

1030 
__À32
 
	mf‹˚_sˇn_ötvl
;

1033 
u8
 
	msˇn_ty≥
;

1036 
u8
 
	mnum_ch
;

1039 
__À16
 
	mch_li°
[1];

1040 } 
	g__∑cked
;

1047 
	ewmi_sˇn_˘æ_Êags_bôs
 {

1050 
	mCONNECT_SCAN_CTRL_FLAGS
 = 0x01,

1053 
	mSCAN_CONNECTED_CTRL_FLAGS
 = 0x02,

1056 
	mACTIVE_SCAN_CTRL_FLAGS
 = 0x04,

1059 
	mROAM_SCAN_CTRL_FLAGS
 = 0x08,

1062 
	mREPORT_BSSINFO_CTRL_FLAGS
 = 0x10,

1065 
	mENABLE_AUTO_CTRL_FLAGS
 = 0x20,

1071 
	mENABLE_SCAN_ABORT_EVENT
 = 0x40,

1074 
	mENABLE_DFS_SKIP_CTRL_FLAGS
 = 0x80,

1077 
	swmi_sˇn_∑øms_cmd
 {

1079 
__À16
 
	mfg_°¨t_≥riod
;

1082 
__À16
 
	mfg_íd_≥riod
;

1085 
__À16
 
	mbg_≥riod
;

1088 
__À16
 
	mmaxa˘_chdwñl_time
;

1091 
__À16
 
	m∑s_chdwñl_time
;

1094 
u8
 
	msh‹t_sˇn_øtio
;

1096 
u8
 
	msˇn_˘æ_Êags
;

1099 
__À16
 
	mmöa˘_chdwñl_time
;

1102 
__À16
 
	mmaxa˘_sˇn_≥r_ssid
;

1105 
__À32
 
	mmax_dfsch_a˘_time
;

1106 } 
	g__∑cked
;

1109 
	ewmi_bss_fûãr
 {

1111 
	mNONE_BSS_FILTER
 = 0x0,

1114 
	mALL_BSS_FILTER
,

1117 
	mPROFILE_FILTER
,

1120 
	mALL_BUT_PROFILE_FILTER
,

1123 
	mCURRENT_BSS_FILTER
,

1126 
	mALL_BUT_BSS_FILTER
,

1129 
	mPROBED_SSID_FILTER
,

1132 
	mLAST_BSS_FILTER
,

1135 
	swmi_bss_fûãr_cmd
 {

1137 
u8
 
	mbss_fûãr
;

1140 
u8
 
	mª£rved1
;

1143 
__À16
 
	mª£rved2
;

1145 
__À32
 
	mõ_mask
;

1146 } 
	g__∑cked
;

1149 
	#MAX_PROBED_SSID_INDEX
 9

	)

1151 
	ewmi_ssid_Êag
 {

1153 
	mDISABLE_SSID_FLAG
 = 0,

1156 
	mSPECIFIC_SSID_FLAG
 = 0x01,

1159 
	mANY_SSID_FLAG
 = 0x02,

1162 
	swmi_¥obed_ssid_cmd
 {

1164 
u8
 
	míåy_ödex
;

1167 
u8
 
	mÊag
;

1169 
u8
 
	mssid_Àn
;

1170 
u8
 
	mssid
[
IEEE80211_MAX_SSID_LEN
];

1171 } 
	g__∑cked
;

1177 
	swmi_li°í_öt_cmd
 {

1178 
__À16
 
	mli°í_ötvl
;

1179 
__À16
 
	mnum_bóc⁄s
;

1180 } 
	g__∑cked
;

1182 
	swmi_£t_ªgdomaö_cmd
 {

1183 
u8
 
	mÀngth
;

1184 
u8
 
	miso_«me
[2];

1185 } 
	g__∑cked
;

1188 
	ewmi_powî_mode
 {

1189 
	mREC_POWER
 = 0x01,

1190 
	mMAX_PERF_POWER
,

1193 
	swmi_powî_mode_cmd
 {

1195 
u8
 
	mpwr_mode
;

1196 } 
	g__∑cked
;

1202 
	epowî_ßve_Áû_evít_pﬁicy
 {

1203 
	mSEND_POWER_SAVE_FAIL_EVENT_ALWAYS
 = 1,

1204 
	mIGNORE_POWER_SAVE_FAIL_EVENT_DURING_SCAN
 = 2,

1207 
	swmi_powî_∑øms_cmd
 {

1209 
__À16
 
	midÀ_≥riod
;

1211 
__À16
 
	mp•ﬁl_numbî
;

1212 
__À16
 
	mdtim_pﬁicy
;

1213 
__À16
 
	mtx_wakeup_pﬁicy
;

1214 
__À16
 
	mnum_tx_to_wakeup
;

1215 
__À16
 
	mps_Áû_evít_pﬁicy
;

1216 } 
	g__∑cked
;

1219 
	ewmi_adhoc_ps_ty≥
 {

1220 
	mADHOC_PS_DISABLE
 = 1,

1221 
	mADHOC_PS_ATH
 = 2,

1222 
	mADHOC_PS_IEEE
 = 3,

1223 
	mADHOC_PS_OTHER
 = 4,

1224 
	mADHOC_PS_KTK
 = 5,

1227 
	swmi_ibss_pm_ˇps_cmd
 {

1229 
u8
 
	mpowî_ßvög
;

1232 
u8
 
	mâl
;

1235 
__À16
 
	m©im_wödows
;

1238 
__À16
 
	mtimeout_vÆue
;

1239 } 
	g__∑cked
;

1242 
	swmi_disc_timeout_cmd
 {

1244 
u8
 
	mdisc⁄_timeout
;

1245 } 
	g__∑cked
;

1247 
	edú_ty≥
 {

1248 
	mUPLINK_TRAFFIC
 = 0,

1249 
	mDNLINK_TRAFFIC
 = 1,

1250 
	mBIDIR_TRAFFIC
 = 2,

1253 
	evoi˚ps_ˇp_ty≥
 {

1254 
	mDISABLE_FOR_THIS_AC
 = 0,

1255 
	mENABLE_FOR_THIS_AC
 = 1,

1256 
	mENABLE_FOR_ALL_AC
 = 2,

1259 
	eåaffic_ty≥
 {

1260 
	mTRAFFIC_TYPE_APERIODIC
 = 0,

1261 
	mTRAFFIC_TYPE_PERIODIC
 = 1,

1265 
	swmi_sync_cmd
 {

1266 
u8
 
	md©a_sync_m≠
;

1267 } 
	g__∑cked
;

1270 
	swmi_¸óã_p°ªam_cmd
 {

1272 
__À32
 
	mmö_£rvi˚_öt
;

1275 
__À32
 
	mmax_£rvi˚_öt
;

1278 
__À32
 
	möa˘ivôy_öt
;

1281 
__À32
 
	msu•ísi⁄_öt
;

1283 
__À32
 
	m£rvi˚_°¨t_time
;

1286 
__À32
 
	mmö_d©a_øã
;

1289 
__À32
 
	mmón_d©a_øã
;

1292 
__À32
 
	m≥ak_d©a_øã
;

1294 
__À32
 
	mmax_bur°_size
;

1295 
__À32
 
	mdñay_bound
;

1298 
__À32
 
	mmö_phy_øã
;

1300 
__À32
 
	msba
;

1301 
__À32
 
	mmedium_time
;

1304 
__À16
 
	mnomöÆ_msdu
;

1307 
__À16
 
	mmax_msdu
;

1309 
u8
 
	måaffic_˛ass
;

1312 
u8
 
	måaffic_dúec
;

1314 
u8
 
	mrx_queue_num
;

1317 
u8
 
	måaffic_ty≥
;

1320 
u8
 
	mvoi˚_psc_ˇp
;

1321 
u8
 
	mtsid
;

1324 
u8
 
	mu£r_¥i
;

1327 
u8
 
	mnomöÆ_phy
;

1328 } 
	g__∑cked
;

1331 
	swmi_dñëe_p°ªam_cmd
 {

1332 
u8
 
	mtx_queue_num
;

1333 
u8
 
	mrx_queue_num
;

1334 
u8
 
	måaffic_dúec
;

1335 
u8
 
	måaffic_˛ass
;

1336 
u8
 
	mtsid
;

1337 } 
	g__∑cked
;

1340 
	ewmi_phy_mode
 {

1341 
	mWMI_11A_MODE
 = 0x1,

1342 
	mWMI_11G_MODE
 = 0x2,

1343 
	mWMI_11AG_MODE
 = 0x3,

1344 
	mWMI_11B_MODE
 = 0x4,

1345 
	mWMI_11GONLY_MODE
 = 0x5,

1348 
	#WMI_MAX_CHANNELS
 64

	)

1358 
	swmi_rssi_thªshﬁd_∑øms_cmd
 {

1360 
__À32
 
	mpﬁl_time
;

1363 
a_¶e16
 
	mthªsh_above1_vÆ
;

1365 
a_¶e16
 
	mthªsh_above2_vÆ
;

1366 
a_¶e16
 
	mthªsh_above3_vÆ
;

1367 
a_¶e16
 
	mthªsh_above4_vÆ
;

1368 
a_¶e16
 
	mthªsh_above5_vÆ
;

1371 
a_¶e16
 
	mthªsh_above6_vÆ
;

1374 
a_¶e16
 
	mthªsh_bñow1_vÆ
;

1376 
a_¶e16
 
	mthªsh_bñow2_vÆ
;

1377 
a_¶e16
 
	mthªsh_bñow3_vÆ
;

1378 
a_¶e16
 
	mthªsh_bñow4_vÆ
;

1379 
a_¶e16
 
	mthªsh_bñow5_vÆ
;

1382 
a_¶e16
 
	mthªsh_bñow6_vÆ
;

1385 
u8
 
	mweight
;

1387 
u8
 
	mª£rved
[3];

1388 } 
	g__∑cked
;

1395 
	swmi_¢r_thªshﬁd_∑øms_cmd
 {

1397 
__À32
 
	mpﬁl_time
;

1400 
u8
 
	mweight
;

1403 
u8
 
	mthªsh_above1_vÆ
;

1405 
u8
 
	mthªsh_above2_vÆ
;

1406 
u8
 
	mthªsh_above3_vÆ
;

1409 
u8
 
	mthªsh_above4_vÆ
;

1412 
u8
 
	mthªsh_bñow1_vÆ
;

1414 
u8
 
	mthªsh_bñow2_vÆ
;

1415 
u8
 
	mthªsh_bñow3_vÆ
;

1418 
u8
 
	mthªsh_bñow4_vÆ
;

1420 
u8
 
	mª£rved
[3];

1421 } 
	g__∑cked
;

1423 
	ewmi_¥ómbÀ_pﬁicy
 {

1424 
	mWMI_IGNORE_BARKER_IN_ERP
 = 0,

1425 
	mWMI_DONOT_IGNORE_BARKER_IN_ERP


1428 
	swmi_£t_ÕªambÀ_cmd
 {

1429 
u8
 
	m°©us
;

1430 
u8
 
	m¥ómbÀ_pﬁicy
;

1431 } 
	g__∑cked
;

1433 
	swmi_£t_πs_cmd
 {

1434 
__À16
 
	mthªshﬁd
;

1435 } 
	g__∑cked
;

1438 
	swmi_£t_tx_pwr_cmd
 {

1440 
u8
 
	mdbM
;

1441 } 
	g__∑cked
;

1443 
	swmi_tx_pwr_ª∂y
 {

1445 
u8
 
	mdbM
;

1446 } 
	g__∑cked
;

1448 
	swmi_ªp‹t_¶ìp_°©e_evít
 {

1449 
__À32
 
	m¶ìp_°©e
;

1452 
	ewmi_ªp‹t_¶ìp_°©us
 {

1453 
	mWMI_REPORT_SLEEP_STATUS_IS_DEEP_SLEEP
 = 0,

1454 
	mWMI_REPORT_SLEEP_STATUS_IS_AWAKE


1456 
	eèrgë_evít_ªp‹t_c⁄fig
 {

1458 
	mDISCONN_EVT_IN_RECONN
 = 0,

1460 
	mNO_DISCONN_EVT_IN_RECONN


1466 
	sWMI_AP_NUM_STA_CMD
 {

1467 
u8
 
	mnum_°a
;

1473 
	swmi_ch™√l_li°_ª∂y
 {

1474 
u8
 
	mª£rved
;

1477 
u8
 
	mnum_ch
;

1480 
__À16
 
	mch_li°
[1];

1481 } 
	g__∑cked
;

1484 
	ewmi_evít_id
 {

1485 
	mWMI_READY_EVENTID
 = 0x1001,

1486 
	mWMI_CONNECT_EVENTID
,

1487 
	mWMI_DISCONNECT_EVENTID
,

1488 
	mWMI_BSSINFO_EVENTID
,

1489 
	mWMI_CMDERROR_EVENTID
,

1490 
	mWMI_REGDOMAIN_EVENTID
,

1491 
	mWMI_PSTREAM_TIMEOUT_EVENTID
,

1492 
	mWMI_NEIGHBOR_REPORT_EVENTID
,

1493 
	mWMI_TKIP_MICERR_EVENTID
,

1494 
	mWMI_SCAN_COMPLETE_EVENTID
,

1495 
	mWMI_REPORT_STATISTICS_EVENTID
,

1496 
	mWMI_RSSI_THRESHOLD_EVENTID
,

1497 
	mWMI_ERROR_REPORT_EVENTID
,

1498 
	mWMI_OPT_RX_FRAME_EVENTID
,

1499 
	mWMI_REPORT_ROAM_TBL_EVENTID
,

1500 
	mWMI_EXTENSION_EVENTID
,

1501 
	mWMI_CAC_EVENTID
,

1502 
	mWMI_SNR_THRESHOLD_EVENTID
,

1503 
	mWMI_LQ_THRESHOLD_EVENTID
,

1504 
	mWMI_TX_RETRY_ERR_EVENTID
,

1505 
	mWMI_REPORT_ROAM_DATA_EVENTID
,

1506 
	mWMI_TEST_EVENTID
,

1507 
	mWMI_APLIST_EVENTID
,

1508 
	mWMI_GET_WOW_LIST_EVENTID
,

1509 
	mWMI_GET_PMKID_LIST_EVENTID
,

1510 
	mWMI_CHANNEL_CHANGE_EVENTID
,

1511 
	mWMI_PEER_NODE_EVENTID
,

1512 
	mWMI_PSPOLL_EVENTID
,

1513 
	mWMI_DTIMEXPIRY_EVENTID
,

1514 
	mWMI_WLAN_VERSION_EVENTID
,

1515 
	mWMI_SET_PARAMS_REPLY_EVENTID
,

1516 
	mWMI_ADDBA_REQ_EVENTID
,

1517 
	mWMI_ADDBA_RESP_EVENTID
,

1518 
	mWMI_DELBA_REQ_EVENTID
,

1519 
	mWMI_TX_COMPLETE_EVENTID
,

1520 
	mWMI_HCI_EVENT_EVENTID
,

1521 
	mWMI_ACL_DATA_EVENTID
,

1522 
	mWMI_REPORT_SLEEP_STATE_EVENTID
,

1523 
	mWMI_WAPI_REKEY_EVENTID
,

1524 
	mWMI_REPORT_BTCOEX_STATS_EVENTID
,

1525 
	mWMI_REPORT_BTCOEX_CONFIG_EVENTID
,

1526 
	mWMI_GET_PMK_EVENTID
,

1529 
	mWMI_DFS_HOST_ATTACH_EVENTID
,

1530 
	mWMI_DFS_HOST_INIT_EVENTID
,

1531 
	mWMI_DFS_RESET_DELAYLINES_EVENTID
,

1532 
	mWMI_DFS_RESET_RADARQ_EVENTID
,

1533 
	mWMI_DFS_RESET_AR_EVENTID
,

1534 
	mWMI_DFS_RESET_ARQ_EVENTID
,

1535 
	mWMI_DFS_SET_DUR_MULTIPLIER_EVENTID
,

1536 
	mWMI_DFS_SET_BANGRADAR_EVENTID
,

1537 
	mWMI_DFS_SET_DEBUGLEVEL_EVENTID
,

1538 
	mWMI_DFS_PHYERR_EVENTID
,

1540 
	mWMI_CCX_RM_STATUS_EVENTID
,

1543 
	mWMI_P2P_GO_NEG_RESULT_EVENTID
,

1545 
	mWMI_WAC_SCAN_DONE_EVENTID
,

1546 
	mWMI_WAC_REPORT_BSS_EVENTID
,

1547 
	mWMI_WAC_START_WPS_EVENTID
,

1548 
	mWMI_WAC_CTRL_REQ_REPLY_EVENTID
,

1549 
	mWMI_REPORT_WMM_PARAMS_EVENTID
,

1550 
	mWMI_WAC_REJECT_WPS_EVENTID
,

1553 
	mWMI_P2P_GO_NEG_REQ_EVENTID
,

1554 
	mWMI_P2P_INVITE_REQ_EVENTID
,

1555 
	mWMI_P2P_INVITE_RCVD_RESULT_EVENTID
,

1556 
	mWMI_P2P_INVITE_SENT_RESULT_EVENTID
,

1557 
	mWMI_P2P_PROV_DISC_RESP_EVENTID
,

1558 
	mWMI_P2P_PROV_DISC_REQ_EVENTID
,

1561 
	mWMI_RFKILL_STATE_CHANGE_EVENTID
,

1562 
	mWMI_RFKILL_GET_MODE_CMD_EVENTID
,

1564 
	mWMI_P2P_START_SDPD_EVENTID
,

1565 
	mWMI_P2P_SDPD_RX_EVENTID
,

1572 
	mWMI_SET_HOST_SLEEP_MODE_CMD_PROCESSED_EVENTID
,

1574 #ifde‡
CONFIG_WLAN_QRF


1575 
	mWMI_QRF_SCAN_RESULTS_EVENTID
,

1578 
	mWMI_THIN_RESERVED_START_EVENTID
 = 0x8000,

1581 
	mWMI_THIN_RESERVED_END_EVENTID
 = 0x8fff,

1583 
	mWMI_SET_CHANNEL_EVENTID
,

1584 
	mWMI_ASSOC_REQ_EVENTID
,

1587 
	mWMI_ACS_EVENTID
,

1588 
	mWMI_STORERECALL_STORE_EVENTID
,

1589 
	mWMI_WOW_EXT_WAKE_EVENTID
,

1590 
	mWMI_GTK_OFFLOAD_STATUS_EVENTID
,

1591 
	mWMI_NETWORK_LIST_OFFLOAD_EVENTID
,

1592 
	mWMI_REMAIN_ON_CHNL_EVENTID
,

1593 
	mWMI_CANCEL_REMAIN_ON_CHNL_EVENTID
,

1594 
	mWMI_TX_STATUS_EVENTID
,

1595 
	mWMI_RX_PROBE_REQ_EVENTID
,

1596 
	mWMI_P2P_CAPABILITIES_EVENTID
,

1597 
	mWMI_RX_ACTION_EVENTID
,

1598 
	mWMI_P2P_INFO_EVENTID
,

1600 
	mWMI_WPS_GET_STATUS_EVENTID
,

1601 
	mWMI_WPS_PROFILE_EVENTID
,

1604 
	mWMI_NOA_INFO_EVENTID
,

1605 
	mWMI_OPPPS_INFO_EVENTID
,

1606 
	mWMI_PORT_STATUS_EVENTID
,

1609 
	mWMI_GET_RSN_CAP_EVENTID
,

1611 
	mWMI_FLOWCTRL_IND_EVENTID
,

1612 
	mWMI_FLOWCTRL_UAPSD_FRAME_DILIVERED_EVENTID
,

1615 
	mWMI_SOCKET_RESPONSE_EVENTID
,

1617 
	mWMI_LOG_FRAME_EVENTID
,

1618 
	mWMI_QUERY_PHY_INFO_EVENTID
,

1619 
	mWMI_CCX_ROAMING_EVENTID
,

1621 
	mWMI_P2P_NODE_LIST_EVENTID
,

1622 
	mWMI_P2P_REQ_TO_AUTH_EVENTID
,

1623 
	mWMI_DIAGNOSTIC_EVENTID
,

1624 
	mWMI_DISC_PEER_EVENTID
,

1625 
	mWMI_BSS_RSSI_INFO_EVENTID
,

1626 
	mWMI_ARGOS_EVENTID
,

1627 
	mWMI_AP_IDLE_CLOSE_TIMEOUT_EVENTID
 = 0x9020,

1628 
	mWMI_SEND_DUMMY_DATA_EVENTID
,

1629 
	mWMI_FLUSH_BUFFERED_DATA_EVENTID
,

1630 
	mWMI_WLAN_INFO_LTE_EVENTID
,

1631 
	mWMI_CLIENT_POWER_SAVE_EVENTID
,

1634 
	mWMI_GET_REG_EVENTID
,

1635 
	mWMI_GET_STAINFO_EVENTID
,

1636 
	mWMI_GET_TXPOW_EVENTID
,

1637 
	mWMI_GET_VERSION_INFO_EVENTID
,

1638 
	mWMI_GET_TESTMODE_EVENTID
,

1639 
	mWMI_RX_PROBE_RESP_EVENTID
,

1640 
	mWMI_ACL_REJECT_EVENTID
,

1641 
	mWMI_GET_WIDIMODE_EVENTID
,

1642 
	mWMI_CSA_EVENTID
,

1643 
	mWMI_GET_CTL_EVENTID
,

1648 
	mWMI_EVENTID_LAST
 = 0xFFFE,

1651 
	swmi_ªady_evít_2
 {

1652 
__À32
 
	msw_vîsi⁄
;

1653 
__À32
 
	mabi_vîsi⁄
;

1654 
u8
 
	mmac_addr
[
ETH_ALEN
];

1655 
u8
 
	mphy_ˇp
;

1656 } 
	g__∑cked
;

1659 
	swmi_c⁄√˘_evít
 {

1662 
__À16
 
	mch
;

1663 
u8
 
	mbssid
[
ETH_ALEN
];

1664 
__À16
 
	mli°í_ötvl
;

1665 
__À16
 
	mbóc⁄_ötvl
;

1666 
__À16
 
	mnw_ty≥
;

1667 
u8
 
	mtx_scheduÀr_íabÀd
;

1668 
u8
 
	maid
;

1669 } 
	m°a
;

1671 
u8
 
	mphymode
;

1672 
u8
 
	maid
;

1673 
u8
 
	mmac_addr
[
ETH_ALEN
];

1674 
u8
 
	mauth
;

1675 
u8
 
	mkeymgmt
;

1676 
__À16
 
	mcùhî
;

1677 
u8
 
	m≠sd_öfo
;

1678 
u8
 
	munu£d
[3];

1679 } 
	m≠_°a
;

1681 
__À16
 
	mch
;

1682 
u8
 
	mbssid
[
ETH_ALEN
];

1683 
u8
 
	mtx_scheduÀr_íabÀd
;

1684 
u8
 
	maid
;

1685 
u8
 
	munu£d
[6];

1686 } 
	m≠_bss
;

1687 } 
	mu
;

1688 
u8
 
	mbóc⁄_õ_Àn
;

1689 
u8
 
	massoc_ªq_Àn
;

1690 
u8
 
	massoc_ª•_Àn
;

1691 
u8
 
	massoc_öfo
[1];

1692 } 
	g__∑cked
;

1695 
	ewmi_disc⁄√˘_ªas⁄
 {

1696 
	mNO_NETWORK_AVAIL
 = 0x01,

1699 
	mLOST_LINK
 = 0x02,

1701 
	mDISCONNECT_CMD
 = 0x03,

1702 
	mBSS_DISCONNECTED
 = 0x04,

1703 
	mAUTH_FAILED
 = 0x05,

1704 
	mASSOC_FAILED
 = 0x06,

1705 
	mNO_RESOURCES_AVAIL
 = 0x07,

1706 
	mCSERV_DISCONNECT
 = 0x08,

1707 
	mINVALID_PROFILE
 = 0x0a,

1708 
	mDOT11H_CHANNEL_SWITCH
 = 0x0b,

1709 
	mPROFILE_MISMATCH
 = 0x0c,

1710 
	mCONNECTION_EVICTED
 = 0x0d,

1711 
	mIBSS_MERGE
 = 0xe,

1714 
	#ATH6KL_COUNTRY_RD_SHIFT
 16

	)

1716 
	s©h6kl_wmi_ªgdomaö
 {

1717 
__À32
 
	mªg_code
;

1720 
	swmi_disc⁄√˘_evít
 {

1722 
__À16
 
	m¥Ÿo_ªas⁄_°©us
;

1725 
u8
 
	mbssid
[
ETH_ALEN
];

1728 
u8
 
	mdisc⁄n_ªas⁄
;

1730 
u8
 
	massoc_ª•_Àn
;

1731 
u8
 
	massoc_öfo
[1];

1732 } 
	g__∑cked
;

1740 
	ewmi_bi_·y≥
 {

1741 
	mBEACON_FTYPE
 = 0x1,

1742 
	mPROBERESP_FTYPE
,

1743 
	mACTION_MGMT_FTYPE
,

1744 
	mPROBEREQ_FTYPE
,

1747 
	#DEF_SCAN_FOR_ROAM_INTVL
 2

	)

1748 
	#WMI_ROAM_LRSSI_SCAN_PERIOD
 (15 * 1000Ë

	)

1749 
	#WMI_ROAM_LRSSI_ROAM_THRESHOLD
 29

	)

1750 
	#WMI_ROAM_LRSSI_SCAN_THRESHOLD
 (
WMI_ROAM_LRSSI_ROAM_THRESHOLD
 + \

	)

1751 
	gDEF_SCAN_FOR_ROAM_INTVL
)

1752 
	#WMI_ROAM_LRSSI_ROAM_FLOOR
 60

	)

1754 
	ewmi_rﬂm_˘æ
 {

1755 
	mWMI_FORCE_ROAM
 = 1,

1756 
	mWMI_SET_ROAM_MODE
,

1757 
	mWMI_SET_HOST_BIAS
,

1758 
	mWMI_SET_LRSSI_SCAN_PARAMS
,

1759 
	mWMI_SET_HOST_5G_BIAS
,

1762 
	ewmi_rﬂm_mode
 {

1763 
	mWMI_DEFAULT_ROAM_MODE
 = 1,

1764 
	mWMI_HOST_BIAS_ROAM_MODE
 = 2,

1765 
	mWMI_LOCK_BSS_MODE
 = 3,

1768 
	sbss_büs
 {

1769 
u8
 
	mbssid
[
ETH_ALEN
];

1770 
s8
 
	mbüs
;

1771 } 
	g__∑cked
;

1773 
	sbss_büs_öfo
 {

1774 
u8
 
	mnum_bss
;

1775 
bss_büs
 
	mbss_büs
[0];

1776 } 
	g__∑cked
;

1778 
	slow_rssi_sˇn_∑øms
 {

1779 
__À16
 
	mÃssi_sˇn_≥riod
;

1780 
a_¶e16
 
	mÃssi_sˇn_thªshﬁd
;

1781 
a_¶e16
 
	mÃssi_rﬂm_thªshﬁd
;

1782 
u8
 
	mrﬂm_rssi_Êo‹
;

1783 
u8
 
	mª£rved
[1];

1784 } 
	g__∑cked
;

1786 
	srﬂm_˘æ_cmd
 {

1788 
u8
 
	mbssid
[
ETH_ALEN
];

1789 
u8
 
	mrﬂm_mode
;

1790 
bss_büs_öfo
 
	mbss
;

1791 
u8
 
	mbüs5G
;

1792 
low_rssi_sˇn_∑øms
 
	m∑øms
;

1794 } 
__∑cked
 
	möfo
;

1795 
u8
 
	mrﬂm_˘æ
;

1796 } 
	g__∑cked
;

1799 
	swmi_bss_öfo_hdr2
 {

1800 
__À16
 
	mch
;

1803 
u8
 
	m‰ame_ty≥
;

1805 
u8
 
	m¢r
;

1806 
u8
 
	mbssid
[
ETH_ALEN
];

1807 
__À16
 
	mõ_mask
;

1808 } 
	g__∑cked
;

1811 
	ewmi_îr‹_code
 {

1812 
	mINVALID_PARAM
 = 0x01,

1813 
	mILLEGAL_STATE
 = 0x02,

1814 
	mINTERNAL_ERROR
 = 0x03,

1817 
	swmi_cmd_îr‹_evít
 {

1818 
__À16
 
	mcmd_id
;

1819 
u8
 
	mîr_code
;

1820 } 
	g__∑cked
;

1822 
	swmi_p°ªam_timeout_evít
 {

1823 
u8
 
	mtx_queue_num
;

1824 
u8
 
	mrx_queue_num
;

1825 
u8
 
	måaffic_dúec
;

1826 
u8
 
	måaffic_˛ass
;

1827 } 
	g__∑cked
;

1838 
	ewmi_bss_Êags
 {

1839 
	mWMI_DEFAULT_BSS_FLAGS
 = 0x00,

1840 
	mWMI_PREAUTH_CAPABLE_BSS
 = 0x01,

1841 
	mWMI_PMKID_VALID_BSS
 = 0x02,

1844 
	swmi_√ighb‹_öfo
 {

1845 
u8
 
	mbssid
[
ETH_ALEN
];

1846 
u8
 
	mbss_Êags
;

1847 } 
	g__∑cked
;

1849 
	swmi_√ighb‹_ªp‹t_evít
 {

1850 
u8
 
	mnum_√ighb‹s
;

1851 
wmi_√ighb‹_öfo
 
	m√ighb‹
[0];

1852 } 
	g__∑cked
;

1855 
	swmi_tkù_mi˚º_evít
 {

1856 
u8
 
	mkey_id
;

1857 
u8
 
	mis_mˇ°
;

1858 } 
	g__∑cked
;

1860 
	ewmi_sˇn_°©us
 {

1861 
	mWMI_SCAN_STATUS_SUCCESS
 = 0,

1865 
	swmi_sˇn_com∂ëe_evít
 {

1866 
a_¶e32
 
	m°©us
;

1867 } 
	g__∑cked
;

1869 
	#MAX_OPT_DATA_LEN
 1400

	)

1877 
	swmi_›t_rx_öfo_hdr
 {

1878 
__À16
 
	mch
;

1879 
u8
 
	m‰ame_ty≥
;

1880 
s8
 
	m¢r
;

1881 
u8
 
	m§c_addr
[
ETH_ALEN
];

1882 
u8
 
	mbssid
[
ETH_ALEN
];

1883 } 
	g__∑cked
;

1886 
	stx_°©s
 {

1887 
__À32
 
	mpkt
;

1888 
__À32
 
	mbyã
;

1889 
__À32
 
	muˇ°_pkt
;

1890 
__À32
 
	muˇ°_byã
;

1891 
__À32
 
	mmˇ°_pkt
;

1892 
__À32
 
	mmˇ°_byã
;

1893 
__À32
 
	mbˇ°_pkt
;

1894 
__À32
 
	mbˇ°_byã
;

1895 
__À32
 
	mπs_suc˚ss_˙t
;

1896 
__À32
 
	mpkt_≥r_ac
[4];

1897 
__À32
 
	mîr_≥r_ac
[4];

1899 
__À32
 
	mîr
;

1900 
__À32
 
	mÁû_˙t
;

1901 
__À32
 
	mªåy_˙t
;

1902 
__À32
 
	mmu…_ªåy_˙t
;

1903 
__À32
 
	mπs_Áû_˙t
;

1904 
a_¶e32
 
	muˇ°_øã
;

1905 } 
	g__∑cked
;

1907 
	srx_°©s
 {

1908 
__À32
 
	mpkt
;

1909 
__À32
 
	mbyã
;

1910 
__À32
 
	muˇ°_pkt
;

1911 
__À32
 
	muˇ°_byã
;

1912 
__À32
 
	mmˇ°_pkt
;

1913 
__À32
 
	mmˇ°_byã
;

1914 
__À32
 
	mbˇ°_pkt
;

1915 
__À32
 
	mbˇ°_byã
;

1916 
__À32
 
	m‰gmít_pkt
;

1918 
__À32
 
	mîr
;

1919 
__À32
 
	m¸c_îr
;

1920 
__À32
 
	mkey_ˇche_miss
;

1921 
__À32
 
	mde¸y±_îr
;

1922 
__À32
 
	mdu∂_‰ame
;

1923 
a_¶e32
 
	muˇ°_øã
;

1924 } 
	g__∑cked
;

1926 
	stkù_ccmp_°©s
 {

1927 
__À32
 
	mtkù_loˇl_mic_Áû
;

1928 
__À32
 
	mtkù_˙ãr_mósuªs_övoked
;

1929 
__À32
 
	mtkù_ª∂ays
;

1930 
__À32
 
	mtkù_fmt_îr
;

1931 
__À32
 
	mccmp_fmt_îr
;

1932 
__À32
 
	mccmp_ª∂ays
;

1933 } 
	g__∑cked
;

1935 
	spm_°©s
 {

1936 
__À32
 
	mpwr_ßve_Áûuª_˙t
;

1937 
__À16
 
	m°›_tx_Áûuª_˙t
;

1938 
__À16
 
	m©im_tx_Áûuª_˙t
;

1939 
__À16
 
	m©im_rx_Áûuª_˙t
;

1940 
__À16
 
	mb˙_rx_Áûuª_˙t
;

1941 } 
	g__∑cked
;

1943 
	sc£rv_°©s
 {

1944 
__À32
 
	mcs_bmiss_˙t
;

1945 
__À32
 
	mcs_low_rssi_˙t
;

1946 
__À16
 
	mcs_c⁄√˘_˙t
;

1947 
__À16
 
	mcs_disc⁄_˙t
;

1948 
a_¶e16
 
	mcs_ave_bóc⁄_rssi
;

1949 
__À16
 
	mcs_rﬂm_cou¡
;

1950 
a_¶e16
 
	mcs_rssi
;

1951 
u8
 
	mcs_¢r
;

1952 
u8
 
	mcs_ave_bóc⁄_¢r
;

1953 
u8
 
	mcs_œ°_rﬂm_m£c
;

1954 } 
	g__∑cked
;

1956 
	swœn_√t_°©s
 {

1957 
tx_°©s
 
	mtx
;

1958 
rx_°©s
 
	mrx
;

1959 
tkù_ccmp_°©s
 
	mtkù_ccmp_°©s
;

1960 } 
	g__∑cked
;

1962 
	s¨p_°©s
 {

1963 
__À32
 
	m¨p_ª˚ived
;

1964 
__À32
 
	m¨p_m©ched
;

1965 
__À32
 
	m¨p_ª∂õd
;

1966 } 
	g__∑cked
;

1968 
	swœn_wow_°©s
 {

1969 
__À32
 
	mwow_pkt_dr›≥d
;

1970 
__À16
 
	mwow_evt_disˇrded
;

1971 
u8
 
	mwow_ho°_pkt_wakeups
;

1972 
u8
 
	mwow_ho°_evt_wakeups
;

1973 } 
	g__∑cked
;

1975 
	swmi_èrgë_°©s
 {

1976 
__À32
 
	mlq_vÆ
;

1977 
a_¶e32
 
	mnoi£_Êo‹_ˇlib
;

1978 
pm_°©s
 
	mpm_°©s
;

1979 
wœn_√t_°©s
 
	m°©s
;

1980 
wœn_wow_°©s
 
	mwow_°©s
;

1981 
¨p_°©s
 
	m¨p_°©s
;

1982 
c£rv_°©s
 
	mc£rv_°©s
;

1983 } 
	g__∑cked
;

1990 
	ewmi_rssi_thªshﬁd_vÆ
 {

1991 
	mWMI_RSSI_THRESHOLD1_ABOVE
 = 0,

1992 
	mWMI_RSSI_THRESHOLD2_ABOVE
,

1993 
	mWMI_RSSI_THRESHOLD3_ABOVE
,

1994 
	mWMI_RSSI_THRESHOLD4_ABOVE
,

1995 
	mWMI_RSSI_THRESHOLD5_ABOVE
,

1996 
	mWMI_RSSI_THRESHOLD6_ABOVE
,

1997 
	mWMI_RSSI_THRESHOLD1_BELOW
,

1998 
	mWMI_RSSI_THRESHOLD2_BELOW
,

1999 
	mWMI_RSSI_THRESHOLD3_BELOW
,

2000 
	mWMI_RSSI_THRESHOLD4_BELOW
,

2001 
	mWMI_RSSI_THRESHOLD5_BELOW
,

2002 
	mWMI_RSSI_THRESHOLD6_BELOW


2005 
	swmi_rssi_thªshﬁd_evít
 {

2006 
a_¶e16
 
	mrssi
;

2007 
u8
 
	mønge
;

2008 } 
	g__∑cked
;

2010 
	ewmi_¢r_thªshﬁd_vÆ
 {

2011 
	mWMI_SNR_THRESHOLD1_ABOVE
 = 1,

2012 
	mWMI_SNR_THRESHOLD1_BELOW
,

2013 
	mWMI_SNR_THRESHOLD2_ABOVE
,

2014 
	mWMI_SNR_THRESHOLD2_BELOW
,

2015 
	mWMI_SNR_THRESHOLD3_ABOVE
,

2016 
	mWMI_SNR_THRESHOLD3_BELOW
,

2017 
	mWMI_SNR_THRESHOLD4_ABOVE
,

2018 
	mWMI_SNR_THRESHOLD4_BELOW


2021 
	swmi_¢r_thªshﬁd_evít
 {

2023 
u8
 
	mønge
;

2025 
u8
 
	m¢r
;

2026 } 
	g__∑cked
;

2029 
	#MAX_ROAM_TBL_CAND
 5

	)

2031 
	swmi_bss_rﬂm_öfo
 {

2032 
a_¶e32
 
	mrﬂm_utû
;

2033 
u8
 
	mbssid
[
ETH_ALEN
];

2034 
s8
 
	mrssi
;

2035 
s8
 
	mrssidt
;

2036 
s8
 
	mœ°_rssi
;

2037 
s8
 
	mutû
;

2038 
s8
 
	mbüs
;

2041 
u8
 
	mª£rved
;

2042 } 
	g__∑cked
;

2044 
	swmi_èrgë_rﬂm_tbl
 {

2045 
__À16
 
	mrﬂm_mode
;

2046 
__À16
 
	mnum_íåõs
;

2047 
wmi_bss_rﬂm_öfo
 
	möfo
[];

2048 } 
	g__∑cked
;

2051 
	eˇc_ödiˇti⁄
 {

2052 
	mCAC_INDICATION_ADMISSION
 = 0x00,

2053 
	mCAC_INDICATION_ADMISSION_RESP
 = 0x01,

2054 
	mCAC_INDICATION_DELETE
 = 0x02,

2055 
	mCAC_INDICATION_NO_RESP
 = 0x03,

2058 
	#WMM_TSPEC_IE_LEN
 63

	)

2060 
	swmi_ˇc_evít
 {

2061 
u8
 
	mac
;

2062 
u8
 
	mˇc_ödiˇti⁄
;

2063 
u8
 
	m°©us_code
;

2064 
u8
 
	mt•ec_sugge°i⁄
[
WMM_TSPEC_IE_LEN
];

2065 } 
	g__∑cked
;

2069 
	e≠li°_vî
 {

2070 
	mAPLIST_VER1
 = 1,

2073 
	swmi_≠_öfo_v1
 {

2074 
u8
 
	mbssid
[
ETH_ALEN
];

2075 
__À16
 
	mch™√l
;

2076 } 
	g__∑cked
;

2078 
	uwmi_≠_öfo
 {

2079 
wmi_≠_öfo_v1
 
	m≠_öfo_v1
;

2080 } 
	g__∑cked
;

2082 
	swmi_≠li°_evít
 {

2083 
u8
 
	m≠_li°_vî
;

2084 
u8
 
	mnum_≠
;

2085 
wmi_≠_öfo
 
	m≠_li°
[1];

2086 } 
	g__∑cked
;

2095 
	ewmi_bô_øã
 {

2096 
	mRATE_AUTO
 = -1,

2097 
	mRATE_1Mb
 = 0,

2098 
	mRATE_2Mb
 = 1,

2099 
	mRATE_5_5Mb
 = 2,

2100 
	mRATE_11Mb
 = 3,

2101 
	mRATE_6Mb
 = 4,

2102 
	mRATE_9Mb
 = 5,

2103 
	mRATE_12Mb
 = 6,

2104 
	mRATE_18Mb
 = 7,

2105 
	mRATE_24Mb
 = 8,

2106 
	mRATE_36Mb
 = 9,

2107 
	mRATE_48Mb
 = 10,

2108 
	mRATE_54Mb
 = 11,

2109 
	mRATE_MCS_0_20
 = 12,

2110 
	mRATE_MCS_1_20
 = 13,

2111 
	mRATE_MCS_2_20
 = 14,

2112 
	mRATE_MCS_3_20
 = 15,

2113 
	mRATE_MCS_4_20
 = 16,

2114 
	mRATE_MCS_5_20
 = 17,

2115 
	mRATE_MCS_6_20
 = 18,

2116 
	mRATE_MCS_7_20
 = 19,

2117 
	mRATE_MCS_0_40
 = 20,

2118 
	mRATE_MCS_1_40
 = 21,

2119 
	mRATE_MCS_2_40
 = 22,

2120 
	mRATE_MCS_3_40
 = 23,

2121 
	mRATE_MCS_4_40
 = 24,

2122 
	mRATE_MCS_5_40
 = 25,

2123 
	mRATE_MCS_6_40
 = 26,

2124 
	mRATE_MCS_7_40
 = 27,

2127 
	swmi_bô_øã_ª∂y
 {

2129 
s8
 
	møã_ödex
;

2130 } 
	g__∑cked
;

2137 
	swmi_fix_øãs_ª∂y
 {

2139 
__À32
 
	mfix_øã_mask
;

2140 } 
	g__∑cked
;

2142 
	erﬂm_d©a_ty≥
 {

2144 
	mROAM_DATA_TIME
 = 1,

2147 
	swmi_èrgë_rﬂm_time
 {

2148 
__À32
 
	mdißssoc_time
;

2149 
__À32
 
	mno_txrx_time
;

2150 
__À32
 
	massoc_time
;

2151 
__À32
 
	mÆlow_txrx_time
;

2152 
u8
 
	mdißssoc_bssid
[
ETH_ALEN
];

2153 
s8
 
	mdißssoc_bss_rssi
;

2154 
u8
 
	massoc_bssid
[
ETH_ALEN
];

2155 
s8
 
	massoc_bss_rssi
;

2156 } 
	g__∑cked
;

2158 
	ewmi_tx›_cfg
 {

2159 
	mWMI_TXOP_DISABLED
 = 0,

2160 
	mWMI_TXOP_ENABLED


2163 
	swmi_£t_wmm_tx›_cmd
 {

2164 
u8
 
	mtx›_íabÀ
;

2165 } 
	g__∑cked
;

2167 
	swmi_£t_kì∑live_cmd
 {

2168 
u8
 
	mkìp_Æive_ötvl
;

2169 } 
	g__∑cked
;

2171 
	swmi_gë_kì∑live_cmd
 {

2172 
__À32
 
	mc⁄figuªd
;

2173 
u8
 
	mkìp_Æive_ötvl
;

2174 } 
	g__∑cked
;

2176 
	#MAX_APP_IE_LEN
 (255)

	)

2178 
	swmi_£t_≠põ_cmd
 {

2179 
u8
 
	mmgmt_‰m_ty≥
;

2180 
u8
 
	mõ_Àn
;

2181 
u8
 
	mõ_öfo
[0];

2182 } 
	g__∑cked
;

2185 
	#WSC_REG_ACTIVE
 1

	)

2186 
	#WSC_REG_INACTIVE
 0

	)

2189 
	#WOW_EXT_FILTER_ID_CLEAR_ALL
 0xFFFF

	)

2191 
	#WOW_MAX_FILTER_LISTS
 1

	)

2192 
	#WOW_MAX_FILTERS_PER_LIST
 4

	)

2193 
	#WOW_MIN_PATTERN_SIZE
 6

	)

2194 
	#WOW_MAX_PATTERN_SIZE
 64

	)

2195 
	#WOW_MASK_SIZE
 64

	)

2197 
	#MAC_MAX_FILTERS_PER_LIST
 4

	)

2199 
	swow_fûãr
 {

2200 
u8
 
	mwow_vÆid_fûãr
;

2201 
u8
 
	mwow_fûãr_id
;

2202 
u8
 
	mwow_fûãr_size
;

2203 
u8
 
	mwow_fûãr_off£t
;

2204 
u8
 
	mwow_fûãr_mask
[
WOW_MASK_SIZE
];

2205 
u8
 
	mwow_fûãr_∑âîn
[
WOW_MAX_PATTERN_SIZE
];

2206 } 
	g__∑cked
;

2208 
	#MAX_IP_ADDRS
 2

	)

2210 
	swmi_£t_ù_cmd
 {

2212 
__À32
 
	mùs
[
MAX_IP_ADDRS
];

2213 } 
	g__∑cked
;

2215 
	e©h6kl_wow_fûãrs
 {

2216 
	mWOW_FILTER_SSID
 = 
BIT
(0),

2217 
	mWOW_FILTER_OPTION_MAGIC_PACKET
 = 
BIT
(2),

2218 
	mWOW_FILTER_OPTION_EAP_REQ
 = 
BIT
(3),

2219 
	mWOW_FILTER_OPTION_PATTERNS
 = 
BIT
(4),

2220 
	mWOW_FILTER_OPTION_OFFLOAD_ARP
 = 
BIT
(5),

2221 
	mWOW_FILTER_OPTION_OFFLOAD_NS
 = 
BIT
(6),

2222 
	mWOW_FILTER_OPTION_OFFLOAD_GTK
 = 
BIT
(7),

2223 
	mWOW_FILTER_OPTION_8021X_4WAYHS
 = 
BIT
(8),

2224 
	mWOW_FILTER_OPTION_NLO_DISCVRY
 = 
BIT
(9),

2225 
	mWOW_FILTER_OPTION_NWK_DISASSOC
 = 
BIT
(10),

2226 
	mWOW_FILTER_OPTION_GTK_ERROR
 = 
BIT
(11),

2227 
	mWOW_FILTER_OPTION_TEST_MODE
 = 
BIT
(15),

2230 
	e©h6kl_ho°_mode
 {

2231 
	mATH6KL_HOST_MODE_AWAKE
,

2232 
	mATH6KL_HOST_MODE_ASLEEP
,

2236 
	swmi_£t_ho°_¶ìp_mode_cmd
 {

2237 
__À32
 
	mawake
;

2238 
__À32
 
	ma¶ìp
;

2239 } 
	g__∑cked
;

2241 
	e©h6kl_wow_mode
 {

2242 
	mATH6KL_WOW_MODE_DISABLE
,

2243 
	mATH6KL_WOW_MODE_ENABLE
,

2247 
	swmi_£t_wow_mode_cmd
 {

2248 
__À32
 
	míabÀ_wow
;

2249 
__À32
 
	mfûãr
;

2250 
__À16
 
	mho°_ªq_dñay
;

2251 } 
	g__∑cked
;

2254 
	swmi_add_wow_∑âîn_cmd
 {

2255 
u8
 
	mfûãr_li°_id
;

2256 
u8
 
	mfûãr_size
;

2257 
u8
 
	mfûãr_off£t
;

2258 
u8
 
	mfûãr
[1];

2259 } 
	g__∑cked
;

2262 
	swmi_add_wow_ext_∑âîn_cmd
 {

2263 
u8
 
	mfûãr_li°_id
;

2264 
u8
 
	mfûãr_id
;

2265 
__À16
 
	mfûãr_size
;

2266 
u8
 
	mfûãr_off£t
;

2267 
u8
 
	mfûãr
[1];

2268 } 
	g__∑cked
;

2271 
	swmi_dñ_wow_∑âîn_cmd
 {

2272 
__À16
 
	mfûãr_li°_id
;

2273 
__À16
 
	mfûãr_id
;

2274 } 
	g__∑cked
;

2278 
	swmi_pmkid
 {

2279 
u8
 
	mpmkid
[
WMI_PMKID_LEN
];

2280 } 
	g__∑cked
;

2283 
	swmi_pmkid_li°_ª∂y
 {

2284 
__À32
 
	mnum_pmkid
;

2285 
u8
 
	mbssid_li°
[
ETH_ALEN
][1];

2286 
wmi_pmkid
 
	mpmkid_li°
[1];

2287 } 
	g__∑cked
;

2290 
	swmi_™t_div_cmd
 {

2291 
u8
 
	mdivîsôy_c⁄åﬁ
;

2292 
u8
 
	mmaö_ a_c⁄f
;

2293 
u8
 
	mÆt_ a_c⁄f
;

2294 
u8
 
	mÁ°_div_büs
;

2295 
u8
 
	mmaö_gaötb
;

2296 
u8
 
	mÆt_gaötb
;

2297 } 
	g__∑cked
;

2300 
	swmi_™t_div_°©
 {

2301 
u32
 
	msˇn_°¨t_time
;

2302 
u16
 
	mtŸÆ_pkt_cou¡
;

2303 
u16
 
	mcou¡
;

2304 
	mÆt_ªcv_˙t
;

2305 
	mmaö_ªcv_˙t
;

2306 
	mÆt_øtio
;

2307 
	mmaö_rssi_avg
;

2308 
	mÆt_rssi_avg
;

2309 
	mcuº_maö_£t
;

2310 
	mcuº_Æt_£t
;

2311 
	míd_°
;

2312 
	msˇn
;

2313 
	msˇn_nŸ_°¨t
;

2314 
	mcuº_büs
;

2315 
u8
 
	mmaö_ a_c⁄f
;

2316 
u8
 
	mÆt_ a_c⁄f
;

2317 
u8
 
	mÁ°_div_büs
;

2318 } 
	g__∑cked
;

2321 
	swmi_™i_°©
 {

2322 
u8
 
	míabÀ
;

2323 
u8
 
	mrssi
;

2324 
u8
 
	mpﬁl˙t
;

2325 
u8
 
	mnoi£ImmunôyLevñ
;

2326 
u8
 
	m•urImmunôyLevñ
;

2327 
u8
 
	mfú°ïLevñ
;

2328 
u8
 
	mofdmWókSigDëe˘Off
;

2329 
u8
 
	mcckWókSigThªshﬁd
;

2330 
u32
 
	mli°íTime
;

2331 
u32
 
	mofdmTrigHigh
;

2332 
u32
 
	mofdmTrigLow
;

2333 
u32
 
	mcckTrigHigh
;

2334 
u32
 
	mcckTrigLow
;

2335 
u32
 
	mrssiThrLow
;

2336 
u32
 
	mrssiThrHigh
;

2337 
u32
 
	mcy˛eCou¡
;

2338 
u32
 
	mofdmPhyEºCou¡
;

2339 
u32
 
	mcckPhyEºCou¡
;

2340 
u32
 
	mofdmPhyEºBa£
;

2341 
u32
 
	mcckPhyEºBa£
;

2342 
u32
 
	mrxFømeCou¡
;

2343 
u32
 
	mtxFømeCou¡
;

2344 } 
	g__∑cked
;

2346 
	#WMI_MAX_PMKID_CACHE
 8

	)

2347 
	#MAX_PMKID_LIST_SIZE
 ((
__À32
Ë+ 
WMI_MAX_PMKID_CACHE
 * \

	)

2348 ((
	gwmi_pmkid
Ë+ 
	gETH_ALEN
))

2351 
	swmi_addba_ªq_evít
 {

2352 
u8
 
	mtid
;

2353 
u8
 
	mwö_sz
;

2354 
__À16
 
	m°_£q_no
;

2357 
u8
 
	m°©us
;

2358 } 
	g__∑cked
;

2361 
	swmi_addba_ª•_evít
 {

2362 
u8
 
	mtid
;

2365 
u8
 
	m°©us
;

2368 
__À16
 
	mamsdu_sz
;

2369 } 
	g__∑cked
;

2375 
	swmi_dñba_evít
 {

2376 
u8
 
	mtid
;

2377 
u8
 
	mis_≥î_öôüt‹
;

2378 
__À16
 
	mªas⁄_code
;

2379 } 
	g__∑cked
;

2381 
	#PEER_NODE_JOIN_EVENT
 0x00

	)

2382 
	#PEER_NODE_LEAVE_EVENT
 0x01

	)

2383 
	#PEER_FIRST_NODE_JOIN_EVENT
 0x10

	)

2384 
	#PEER_LAST_NODE_LEAVE_EVENT
 0x11

	)

2386 
	swmi_≥î_node_evít
 {

2387 
u8
 
	mevít_code
;

2388 
u8
 
	m≥î_mac_addr
[
ETH_ALEN
];

2389 } 
	g__∑cked
;

2394 
	stx_com∂ëe_msg_v1
 {

2395 
	#TX_COMPLETE_STATUS_SUCCESS
 0

	)

2396 
	#TX_COMPLETE_STATUS_RETRIES
 1

	)

2397 
	#TX_COMPLETE_STATUS_NOLINK
 2

	)

2398 
	#TX_COMPLETE_STATUS_TIMEOUT
 3

	)

2399 
	#TX_COMPLETE_STATUS_OTHER
 4

	)

2401 
u8
 
	m°©us
;

2404 
u8
 
	mpkt_id
;

2407 
u8
 
	møã_idx
;

2410 
u8
 
	mack_Áûuªs
;

2411 } 
	g__∑cked
;

2413 
	swmi_tx_com∂ëe_evít
 {

2415 
u8
 
	mnum_msg
;

2418 
u8
 
	mmsg_Àn
;

2421 
u8
 
	mmsg_ty≥
;

2424 
u8
 
	mª£rved
;

2425 } 
	g__∑cked
;

2435 
	#AP_MAX_NUM_STA
 10

	)

2438 
	#NUM_DEV
 4

	)

2441 
	#NUM_CONN
 (
AP_MAX_NUM_STA
 + 
NUM_DEV
)

	)

2444 
	#WMI_NUM_CONN
 (
AP_MAX_NUM_STA
 + 
NUM_DEV
 - 1)

	)

2447 
	#MCAST_AID
 0xFF

	)

2449 
	#DEF_AP_COUNTRY_CODE
 "US "

	)

2458 
	#WMI_AP_MLME_ASSOC
 1

	)

2459 
	#WMI_AP_DISASSOC
 2

	)

2460 
	#WMI_AP_DEAUTH
 3

	)

2461 
	#WMI_AP_MLME_AUTHORIZE
 4

	)

2462 
	#WMI_AP_MLME_UNAUTHORIZE
 5

	)

2464 
	swmi_≠_£t_mlme_cmd
 {

2465 
u8
 
	mmac
[
ETH_ALEN
];

2466 
__À16
 
	mªas⁄
;

2467 
u8
 
	mcmd
;

2468 } 
	g__∑cked
;

2470 
	swmi_≠_£t_pvb_cmd
 {

2471 
__À32
 
	mÊag
;

2472 
__À16
 
	mrsvd
;

2473 
__À16
 
	maid
;

2474 } 
	g__∑cked
;

2476 
	swmi_rx_‰ame_f‹m©_cmd
 {

2478 
u8
 
	mmëa_vî
;

2484 
u8
 
	mdŸ11_hdr
;

2490 
u8
 
	mde‰ag_⁄_ho°
;

2493 
u8
 
	mª£rved
[1];

2494 } 
	g__∑cked
;

2499 
	swmi_p•ﬁl_evít
 {

2500 
__À16
 
	maid
;

2501 } 
	g__∑cked
;

2503 
	swmi_≥r_°a_°©
 {

2504 
__À32
 
	mtx_byãs
;

2505 
__À32
 
	mtx_pkts
;

2506 
__À32
 
	mtx_îr‹
;

2507 
__À32
 
	mtx_disˇrd
;

2508 
__À32
 
	mrx_byãs
;

2509 
__À32
 
	mrx_pkts
;

2510 
__À32
 
	mrx_îr‹
;

2511 
__À32
 
	mrx_disˇrd
;

2512 
u8
 
	maid
;

2513 
u8
 
	mtx_uˇ°_øã
;

2516 
__À16
 
	mœ°_txrx_time
;

2517 } 
	g__∑cked
;

2519 
	swmi_≠_mode_°©
 {

2520 
__À32
 
	ma˘i⁄
;

2521 
wmi_≥r_°a_°©
 
	m°a
[
AP_MAX_NUM_STA
 + 1];

2522 } 
	g__∑cked
;

2526 
	swmi_ªmaö_⁄_ch∆_cmd
 {

2527 
__À32
 
	m‰eq
;

2528 
__À32
 
	mduøti⁄
;

2529 } 
	g__∑cked
;

2531 
	swmi_£nd_a˘i⁄_cmd
 {

2532 
__À32
 
	mid
;

2533 
__À32
 
	m‰eq
;

2534 
__À32
 
	mwaô
;

2535 
__À16
 
	mÀn
;

2536 
u8
 
	md©a
[0];

2537 } 
	g__∑cked
;

2539 
	swmi_tx_°©us_evít
 {

2540 
__À32
 
	mid
;

2541 
u8
 
	mack_°©us
;

2542 } 
	g__∑cked
;

2544 
	swmi_¥obe_ªq_ªp‹t_cmd
 {

2545 
u8
 
	míabÀ
;

2546 } 
	g__∑cked
;

2548 
	swmi_¥obe_ª•_ªp‹t_cmd
 {

2549 
u8
 
	míabÀ
;

2550 } 
	g__∑cked
;

2552 
	swmi_dißbÀ_11b_øãs_cmd
 {

2553 
u8
 
	mdißbÀ
;

2554 } 
	g__∑cked
;

2556 
	swmi_£t_≠põ_exãnded_cmd
 {

2557 
u8
 
	mrﬁe_id
;

2558 
u8
 
	mmgmt_‰m_ty≥
;

2559 
u8
 
	mõ_Àn
;

2560 
u8
 
	mõ_öfo
[0];

2561 } 
	g__∑cked
;

2563 
	swmi_ªmaö_⁄_ch∆_evít
 {

2564 
__À32
 
	m‰eq
;

2565 
__À32
 
	mduøti⁄
;

2566 } 
	g__∑cked
;

2568 
	swmi_ˇn˚l_ªmaö_⁄_ch∆_evít
 {

2569 
__À32
 
	m‰eq
;

2570 
__À32
 
	mduøti⁄
;

2571 
u8
 
	m°©us
;

2572 } 
	g__∑cked
;

2574 
	swmi_rx_a˘i⁄_evít
 {

2575 
__À32
 
	m‰eq
;

2576 
__À16
 
	mÀn
;

2577 
u8
 
	md©a
[0];

2578 } 
	g__∑cked
;

2580 
	swmi_p2p_ˇ∑bûôõs_evít
 {

2581 
__À16
 
	mÀn
;

2582 
u8
 
	md©a
[0];

2583 } 
	g__∑cked
;

2585 
	swmi_p2p_rx_¥obe_ªq_evít
 {

2586 
__À32
 
	m‰eq
;

2587 
__À16
 
	mÀn
;

2588 
u8
 
	md©a
[0];

2589 } 
	g__∑cked
;

2591 
	swmi_p2p_rx_¥obe_ª•_evít
 {

2592 
__À32
 
	m‰eq
;

2593 
__À16
 
	mÀn
;

2594 
u8
 
	md©a
[0];

2595 } 
	g__∑cked
;

2596 
	swmi_a˛_ªje˘_evít
 {

2597 
__À16
 
	mÀn
;

2598 
u8
 
	md©a
[0];

2599 } 
	g__∑cked
;

2600 
	#P2P_FLAG_CAPABILITIES_REQ
 (0x00000001)

	)

2601 
	#P2P_FLAG_MACADDR_REQ
 (0x00000002)

	)

2602 
	#P2P_FLAG_HMODEL_REQ
 (0x00000004)

	)

2604 
	swmi_gë_p2p_öfo
 {

2605 
__À32
 
	möfo_ªq_Êags
;

2606 } 
	g__∑cked
;

2608 
	swmi_p2p_öfo_evít
 {

2609 
__À32
 
	möfo_ªq_Êags
;

2610 
__À16
 
	mÀn
;

2611 
u8
 
	md©a
[0];

2612 } 
	g__∑cked
;

2614 
	swmi_p2p_ˇ∑bûôõs
 {

2615 
u8
 
	mgo_powî_ßve
;

2616 } 
	g__∑cked
;

2618 
	swmi_p2p_maˇddr
 {

2619 
u8
 
	mmac_addr
[
ETH_ALEN
];

2620 } 
	g__∑cked
;

2622 
	swmi_p2p_hmodñ
 {

2623 
u8
 
	mp2p_modñ
;

2624 } 
	g__∑cked
;

2626 
	swmi_p2p_¥obe_ª•⁄£_cmd
 {

2627 
__À32
 
	m‰eq
;

2628 
u8
 
	mde°ö©i⁄_addr
[
ETH_ALEN
];

2629 
__À16
 
	mÀn
;

2630 
u8
 
	md©a
[0];

2631 } 
	g__∑cked
;

2633 
	#RATECTRL_MODE_DEFAULT
 0

	)

2634 
	#RATECTRL_MODE_PERONLY
 1

	)

2636 
	swmi_£t_øã˘æ_∑rm_cmd
 {

2637 
u32
 
	mmode
;

2638 } 
	g__∑cked
;

2640 
	ewmi_pkt_cmd
 {

2641 
	mWMI_PKTLOG_CMD_DISABLE
,

2642 
	mWMI_PKTLOG_CMD_SETSIZE
,

2643 } 
	g__∑cked
;

2645 
	#PKTLOG_MAX_BYTES
 4096

	)

2647 
	swmi_gë_pkéog_cmd
 {

2648 
__À32
 
	mnbyãs
;

2649 
u8
 
	mbuf„r
[
PKTLOG_MAX_BYTES
];

2650 } 
	g__∑cked
;

2653 
	ewmi_pkéog_›ti⁄
 {

2654 
	mWMI_PKTLOG_OPTION_LOG_TCP_HEADERS
 = 0x1,

2655 
	mWMI_PKTLOG_OPTION_TRIGGER_THRUPUT
 = 0x2,

2656 
	mWMI_PKTLOG_OPTION_TRIGGER_SACK
 = 0x4,

2657 
	mWMI_PKTLOG_OPTION_TRIGGER_PER
 = 0x8,

2658 
	mWMI_PKTLOG_OPTION_LOG_DIAGNOSTIC
 = 0x20

2661 
	ewmi_pkéog_evít
 {

2662 
	mWMI_PKTLOG_EVENT_RX
 = 0x1,

2663 
	mWMI_PKTLOG_EVENT_TX
 = 0x2,

2664 
	mWMI_PKTLOG_EVENT_RCF
 = 0x4,

2665 
	mWMI_PKTLOG_EVENT_RCU
 = 0x8,

2668 
	swmi_íabÀ_pkéog_cmd
 {

2669 
wmi_pkéog_evít
 
	mevli°
;

2670 
wmi_pkéog_›ti⁄
 
	m›ti⁄
;

2671 
__À32
 
	måiggî_thªsh
;

2672 
__À32
 
	måiggî_öãrvÆ
;

2673 
__À32
 
	måiggî_èû_cou¡
;

2674 
__À32
 
	mbuf„r_size
;

2675 } 
	g__∑cked
;

2691 
	swmix_cmd_hdr
 {

2692 
__À32
 
	mcmd_id
;

2693 } 
	g__∑cked
;

2695 
	ewmix_comm™d_id
 {

2696 
	mWMIX_DSETOPEN_REPLY_CMDID
 = 0x2001,

2697 
	mWMIX_DSETDATA_REPLY_CMDID
,

2698 
	mWMIX_GPIO_OUTPUT_SET_CMDID
,

2699 
	mWMIX_GPIO_INPUT_GET_CMDID
,

2700 
	mWMIX_GPIO_REGISTER_SET_CMDID
,

2701 
	mWMIX_GPIO_REGISTER_GET_CMDID
,

2702 
	mWMIX_GPIO_INTR_ACK_CMDID
,

2703 
	mWMIX_HB_CHALLENGE_RESP_CMDID
,

2704 
	mWMIX_DBGLOG_CFG_MODULE_CMDID
,

2705 
	mWMIX_PROF_CFG_CMDID
,

2706 
	mWMIX_PROF_ADDR_SET_CMDID
,

2707 
	mWMIX_PROF_START_CMDID
,

2708 
	mWMIX_PROF_STOP_CMDID
,

2709 
	mWMIX_PROF_COUNT_GET_CMDID
,

2712 
	ewmix_evít_id
 {

2713 
	mWMIX_DSETOPENREQ_EVENTID
 = 0x3001,

2714 
	mWMIX_DSETCLOSE_EVENTID
,

2715 
	mWMIX_DSETDATAREQ_EVENTID
,

2716 
	mWMIX_GPIO_INTR_EVENTID
,

2717 
	mWMIX_GPIO_DATA_EVENTID
,

2718 
	mWMIX_GPIO_ACK_EVENTID
,

2719 
	mWMIX_HB_CHALLENGE_RESP_EVENTID
,

2720 
	mWMIX_DBGLOG_EVENTID
,

2721 
	mWMIX_PROF_COUNT_EVENTID
,

2722 
	mWMIX_PKTLOG_EVENTID
,

2723 
	mWMIX_RTT_RESP_EVENTID
,

2734 
	swmix_hb_chÆÀnge_ª•_cmd
 {

2735 
__À32
 
	mcookõ
;

2736 
__À32
 
	msour˚
;

2737 } 
	g__∑cked
;

2739 
	s©h6kl_wmix_dbglog_cfg_moduÀ_cmd
 {

2740 
__À32
 
	mvÆid
;

2741 
__À32
 
	mc⁄fig
;

2742 } 
	g__∑cked
;

2755 
	swmid_cmd_hdr
 {

2756 
__À32
 
	mcmd_id
;

2757 
__À32
 
	m£q_num
;

2758 } 
	g__∑cked
;

2760 
	swmid_evít_£t_cmd
 {

2761 
boﬁ
 
	míabÀ
;

2762 } 
	g__∑cked
;

2764 
	swmid_macfûãr_cmd
 {

2765 
__À32
 
	mty≥
;

2766 
__À32
 
	mlow
;

2767 
__À32
 
	mhigh
;

2768 } 
	g__∑cked
;

2770 
	ewmid_comm™d_id
 {

2771 
	mWMID_INTERFERENCE_CMDID
 = 0x2001,

2772 
	mWMID_RXTIME_CMDID
,

2773 
	mWMID_FSM_EVENT_CMDID
,

2774 
	mWMID_PWR_SAVE_EVENT_CMDID
,

2775 
	mWMID_MACFILTER_CMDID
,

2776 
	mWMID_STAT_RX_RATE_CMDID
,

2777 
	mWMID_STAT_TX_RATE_CMDID
,

2780 
	ewmid_evít_id
 {

2781 
	mWMID_START_SCAN_EVENTID
 = 0x3001,

2782 
	mWMID_FSM_AUTH_EVENTID
,

2783 
	mWMID_FSM_ASSOC_EVENTID
,

2784 
	mWMID_FSM_DEAUTH_EVENTID
,

2785 
	mWMID_FSM_DISASSOC_EVENTID
,

2786 
	mWMID_STAT_RX_RATE_EVENTID
,

2787 
	mWMID_STAT_TX_RATE_EVENTID
,

2788 
	mWMID_INTERFERENCE_EVENTID
,

2789 
	mWMID_RXTIME_EVENTID
,

2790 
	mWMID_PWR_SAVE_EVENTID
,

2791 
	mWMID_FSM_CONNECT_EVENTID
,

2792 
	mWMID_FSM_DISCONNECT_EVENTID
,

2795 
	swmid_pwr_ßve_evít
 {

2796 
__À16
 
	mﬁdSèã
;

2797 
__À16
 
	mpmSèã
;

2798 } 
	g__∑cked
;

2801 
	ewmi_sync_Êag
 {

2802 
	mNO_SYNC_WMIFLAG
 = 0,

2805 
	mSYNC_BEFORE_WMIFLAG
,

2808 
	mSYNC_AFTER_WMIFLAG
,

2810 
	mSYNC_BOTH_WMIFLAG
,

2813 
	mEND_WMIFLAG


2817 
	swmi_gªí_tx_∑øms
 {

2818 
u32
 
	míabÀ
;

2819 
u8
 
	m√xt_¥obe_cou¡
;

2820 
u8
 
	mmax_back_off
;

2821 
u8
 
	mmö_gtx_rssi
;

2822 
u8
 
	mf‹˚_back_off
;

2823 } 
	g__∑cked
;

2826 
	swmi_Êow˘æ_öd_evít
 {

2827 
u8
 
	mnum_of_c⁄n
;

2828 
u8
 
	mac_m≠
[
WMI_NUM_CONN
];

2829 
u8
 
	mac_queue_dïth
[
WMI_NUM_CONN
 * 2];

2830 } 
	g__∑cked
;

2833 
	eWMI_SMPS_OPTION
 {

2834 
	mWMI_SMPS_OPTION_MODE
 = 0x1,

2835 
	mWMI_SMPS_OPTION_AUTO
 = 0x2,

2836 
	mWMI_SMPS_OPTION_DATATHRESH
 = 0x4,

2837 
	mWMI_SMPS_OPTION_RSSITHRESH
 = 0x8,

2840 
	eWMI_SMPS_MODE
 {

2841 
	mWMI_SMPS_MODE_STATIC
 = 0x1,

2842 
	mWMI_SMPS_MODE_DYNAMIC
 = 0x2,

2845 
	swmi_c⁄fig_smps_cmd
 {

2846 
u8
 
	mÊags
;

2847 
u8
 
	mrssiThªsh
;

2848 
u8
 
	md©aThªsh
;

2849 
u8
 
	mmode
;

2850 
u8
 
	mautom©ic
;

2851 } 
	g__∑cked
;

2853 
	swmi_c⁄fig_íabÀ_cmd
 {

2854 
u8
 
	míabÀ
;

2855 } 
	g__∑cked
;

2857 
	swmi_Õl_f‹˚_íabÀ_cmd
 {

2858 
u8
 
	mÕlPﬁicy
;

2859 
u8
 
	mnoBlockîDëe˘
;

2860 
u8
 
	mnoRfbDëe˘
;

2861 
u8
 
	mrsvd
;

2862 } 
	g__∑cked
;

2865 
	swmi_Õl_pﬁicy_cmd
 {

2866 
u64
 
	mödex
;

2867 
u32
 
	mvÆue
;

2868 } 
	g__∑cked
;

2870 
	swmi_Õl_∑øms_cmd
 {

2871 
u32
 
	mrfbPîiod
;

2872 
u32
 
	mrfbObsDuøti⁄
;

2873 
u32
 
	mblockîBóc⁄Rssi
;

2874 
u8
 
	mch™Off
;

2875 
u32
 
	mrfbDiffThﬁd
;

2876 
u32
 
	mbRssiThﬁd
;

2877 
u32
 
	mmaxBlockîRssi
;

2878 } 
	g__∑cked
;

2881 
	swmi_£t_ht_ˇp
 {

2882 
u8
 
	mb™d
;

2883 
u8
 
	míabÀ
;

2884 
u8
 
	mch™_width_40M_suµ‹ãd
;

2885 
u8
 
	msh‹t_GI_20MHz
;

2886 
u8
 
	msh‹t_GI_40MHz
;

2887 
u8
 
	mötﬁî™˚_40MHz
;

2888 
u8
 
	mmax_ampdu_Àn_exp
;

2889 } 
	g__∑cked
;

2891 
	#HT_INFO_OPMODE_PROT_PURE
 (0Ë

	)

2892 
	#HT_INFO_OPMODE_PROT_MAY_LEGACY
 (1Ë

	)

2893 
	#HT_INFO_OPMODE_PROT_HT20_ASSOC
 (2Ë

	)

2894 
	#HT_INFO_OPMODE_PROT_MIXED
 (3Ë

	)

2897 
	swmi_£t_ht_›
 {

2898 
u8
 
	m°a_ch™_width
;

2899 
u8
 
	m≠_ht_öfo
;

2900 } 
	g__∑cked
;

2903 
	swmi_£t_bóc⁄_ötvl
 {

2904 
u16
 
	mbóc⁄_öãrvÆ
;

2905 } 
	g__∑cked
;

2908 
	swmi_£t_hiddí_ssid
 {

2909 
u8
 
	mhiddí_ssid
;

2910 } 
	g__∑cked
;

2913 
	swmi_£t_dtim_cmd
 {

2914 
u8
 
	mdtim
;

2915 } 
	g__∑cked
;

2919 
	mWMI_AP_APSD_DISABLED
 = 0,

2920 
	mWMI_AP_APSD_ENABLED


2923 
	swmi_≠_£t_≠sd_cmd
 {

2924 
u8
 
	míabÀ
;

2925 } 
	g__∑cked
;

2928 
	mWMI_AP_APSD_NO_DELIVERY_FRAMES_FOR_THIS_TRIGGER
 = 0x1,

2931 
	swmi_≠_≠sd_buf„ªd_åaffic_cmd
 {

2932 
u16
 
	maid
;

2933 
u16
 
	mbôm≠
;

2934 
u32
 
	mÊags
;

2935 } 
	g__∑cked
;

2937 
	#GTK_OFFLOAD_KEK_BYTES
 16

	)

2938 
	#GTK_OFFLOAD_KCK_BYTES
 16

	)

2939 
	#GTK_REPLAY_COUNTER_BYTES
 8

	)

2942 
	#WMI_GTK_OFFLOAD_OPCODE_SET
 1

	)

2945 
	#WMI_GTK_OFFLOAD_OPCODE_CLEAR
 2

	)

2948 
	#WMI_GTK_OFFLOAD_OPCODE_STATUS
 3

	)

2954 
	swmi_gtk_ofÊﬂd_›
 {

2955 
__À32
 
	mÊags
;

2956 
u8
 
	m›code
;

2957 
u8
 
	mkek
[
GTK_OFFLOAD_KEK_BYTES
];

2958 
u8
 
	mkck
[
GTK_OFFLOAD_KCK_BYTES
];

2961 
u8
 
	mª∂ay_cou¡î
[
GTK_REPLAY_COUNTER_BYTES
];

2962 } 
	g__∑cked
;

2964 
	swmi_gtk_ofÊﬂd_°©us_evít
 {

2965 
__À32
 
	mÊags
;

2968 
__À32
 
	mª‰esh_˙t
;

2971 
u8
 
	mª∂ay_cou¡î
[
GTK_REPLAY_COUNTER_BYTES
];

2972 } 
	g__∑cked
;

2975 
	#WMI_MODE_MAX
 8

	)

2976 
	#WMI_MAX_RATE_MASK
 2

	)

2978 
	swmi_£t_tx_£À˘_øã_cmd
 {

2979 
__À32
 
	møãMasks
[
WMI_MODE_MAX
 * 
WMI_MAX_RATE_MASK
];

2980 } 
	g__∑cked
;

2982 
	swmi_r¢_ˇp_cmd
 {

2983 
__À16
 
	mr¢_ˇp
;

2984 } 
	g__∑cked
;

2986 
	#WMI_MAX_RATE_MASK
 2

	)

2988 
	swmi_£t_fix_øãs_cmd
 {

2989 
__À32
 
	mfixR©eMask
[
WMI_MAX_RATE_MASK
];

2990 } 
	g__∑cked
;

2993 
	swmi_nﬂ_des¸ùt‹
 {

2994 
__À32
 
	mduøti⁄
;

2995 
__À32
 
	möãrvÆ
;

2996 
__À32
 
	m°¨t_‹_off£t
;

2997 
u8
 
	mcou¡_‹_ty≥
;

2998 } 
	g__∑cked
;

3000 
	swmi_nﬂ_öfo
 {

3001 
u8
 
	míabÀ
;

3002 
u8
 
	mcou¡
;

3003 
u8
 
	mnﬂs
[0];

3004 } 
	g__∑cked
;

3007 
	swmi_›µs_öfo
 {

3008 
u8
 
	míabÀ
;

3009 
u8
 
	m˘wö
;

3010 } 
	g__∑cked
;

3013 
	#ADD_PORT_FAIL
 0x0

	)

3014 
	#ADD_PORT_SUCCESS
 0x1

	)

3015 
	#DEL_PORT_FAIL
 0x2

	)

3016 
	#DEL_PORT_SUCCESS
 0x3

	)

3018 
	swmi_add_p‹t_cmd
 {

3019 
u8
 
	mp‹t_id
;

3020 
u8
 
	mp‹t_›mode
;

3021 
u8
 
	mp‹t_sub›mode
;

3022 
u8
 
	mmac_addr
[6];

3023 } 
	g__∑cked
;

3025 
	swmi_dñ_p‹t_cmd
 {

3026 
u8
 
	mp‹t_id
;

3027 } 
	g__∑cked
;

3029 
	swmi_p‹t_°©us
 {

3030 
u8
 
	m°©us
;

3031 
u8
 
	mp‹t_id
;

3032 
u8
 
	mmac_addr
[6];

3033 } 
	g__∑cked
;

3037 
	eWOW_EXT_WAKE_TYPE
 {

3038 
	mWOW_EXT_WAKE_TYPE_UNDEF
 = 0,

3039 
	mWOW_EXT_WAKE_TYPE_MAGIC
,

3040 
	mWOW_EXT_WAKE_TYPE_PATTERN
,

3041 
	mWOW_EXT_WAKE_TYPE_EAPREQ
,

3042 
	mWOW_EXT_WAKE_TYPE_4WAYHS
,

3043 
	mWOW_EXT_WAKE_TYPE_NETWORK_NLO
,

3044 
	mWOW_EXT_WAKE_TYPE_NETWORK_DISASSOC
,

3045 
	mWOW_EXT_WAKE_TYPE_NETWORK_GTK_OFFL_ERROR
,

3046 
	mWOW_EXT_WAKE_TYPE_IPV4_TCP_SYN
,

3047 
	mWOW_EXT_WAKE_TYPE_IPV6_TCP_SYN
,

3048 
	mWOW_EXT_WAKE_TYPE_WLAN_HB
,

3049 
	mWOW_EXT_WAKE_TYPE_QRF
,

3050 
	mWOW_EXT_WAKE_TYPE_MAXs


3053 
	swmi_wow_evít_wake_evít
 {

3054 
u16
 
	mÊags
;

3055 
u8
 
	mty≥
;

3056 
u8
 
	mvÆue
;

3057 
u16
 
	m∑ckë_Àngth
;

3058 
u16
 
	mwake_d©a_Àngth
;

3059 
u8
 
	mwake_d©a
[1];

3060 } 
	g__∑cked
;

3062 
	#WMI_MAX_TCP_FILTER_SIZE
 32

	)

3063 
	#WMI_MAX_UDP_FILTER_SIZE
 32

	)

3065 
	swmi_hóπ_bót_∑øms_cmd
 {

3066 
u8
 
	míabÀ
;

3067 
u8
 
	môem
;

3068 
u8
 
	m£ssi⁄
;

3069 } 
	g__∑cked
;

3071 
	swmi_hóπ_bót_t˝_∑øms_cmd
 {

3072 
__À32
 
	m§v_ù
;

3073 
__À32
 
	mdev_ù
;

3074 
__À16
 
	m§c_p‹t
;

3075 
__À16
 
	md°_p‹t
;

3076 
__À16
 
	mtimeout
;

3077 
u8
 
	m£ssi⁄
;

3078 
u8
 
	mg©eway_mac
[
ETH_ALEN
];

3079 } 
	g__∑cked
;

3081 
	swmi_hóπ_bót_t˝_fûãr_cmd
 {

3082 
u8
 
	mÀngth
;

3083 
u8
 
	moff£t
;

3084 
u8
 
	m£ssi⁄
;

3085 
u8
 
	mfûãr
[
WMI_MAX_TCP_FILTER_SIZE
];

3086 } 
	g__∑cked
;

3088 
	swmi_hóπ_bót_udp_∑øms_cmd
 {

3089 
__À32
 
	m§v_ù
;

3090 
__À32
 
	mdev_ù
;

3091 
__À16
 
	m§c_p‹t
;

3092 
__À16
 
	md°_p‹t
;

3093 
__À16
 
	möãrvÆ
;

3094 
__À16
 
	mtimeout
;

3095 
u8
 
	m£ssi⁄
;

3096 
u8
 
	mg©eway_mac
[
ETH_ALEN
];

3097 } 
	g__∑cked
;

3099 
	swmi_hóπ_bót_udp_fûãr_cmd
 {

3100 
u8
 
	mÀngth
;

3101 
u8
 
	moff£t
;

3102 
u8
 
	m£ssi⁄
;

3103 
u8
 
	mfûãr
[
WMI_MAX_UDP_FILTER_SIZE
];

3104 } 
	g__∑cked
;

3106 
	swmi_hóπ_bót_√tw‹k_öfo_cmd
 {

3107 
u32
 
	mdevi˚_ù
;

3108 
u32
 
	m£rvî_ù
;

3109 
u32
 
	mg©eway_ù
;

3110 
u8
 
	mg©eway_mac
[
ETH_ALEN
];

3111 } 
	g__∑cked
;

3114 
	swmi_disc_õ_fûãr_cmd
 {

3115 
u8
 
	míabÀ
;

3116 
u8
 
	m°¨tPos
;

3117 
u8
 
	mÀngth
;

3118 
u8
 
	m∑âîn
[1];

3119 } 
	g__∑cked
;

3121 
	swmi_disc_mode_cmd
 {

3122 
__À16
 
	míabÀ
;

3123 
__À16
 
	mch™√l
;

3124 
__À32
 
	mhome_dwñl_time
;

3125 
__À32
 
	m¶ìpTime
;

3126 
__À32
 
	møndom
;

3127 
__À32
 
	mnumPìrs
;

3128 
__À32
 
	m≥îTimeout
;

3129 } 
	g__∑cked
;

3131 
	swmi_disc_≥î
 {

3132 
__À32
 
	mrssi
;

3133 
u8
 
	maddr
[
ETH_ALEN
];

3134 } 
	g__∑cked
;

3136 
	swmi_disc_≥î_evít
 {

3137 
u8
 
	m≥î_num
;

3138 
u8
 
	m≥î_d©a
[1];

3139 } 
	g__∑cked
;

3141 
	swmi_≠_pﬁl_°a_cmd
 {

3142 
u8
 
	maid
;

3143 
u8
 
	mª£rved
[7];

3144 } 
	g__∑cked
;

3146 
	swmm_∑øms
 {

3147 
u8
 
	macm
;

3148 
u8
 
	maif¢
;

3149 
u8
 
	mlogcwmö
;

3150 
u8
 
	mlogcwmax
;

3151 
u16
 
	mtx›Limô
;

3154 
	swmi_ªp‹t_wmm_∑øms
 {

3155 
wmm_∑øms
 
	mwmm_∑øms
[
WMM_NUM_AC
];

3156 } 
	g__∑cked
;

3158 
	swmi_£t_¸edô_by∑ss_cmd
 {

3159 
u8
 
	meid
;

3160 
u8
 
	mª°‹e
;

3161 
u16
 
	mthªshﬁd
;

3162 } 
	g__∑cked
;

3165 
	#AP_ACL_SIZE
 10

	)

3167 
	#AP_ACL_DISABLE
 0x00

	)

3168 
	#AP_ACL_ALLOW_MAC
 0x01

	)

3169 
	#AP_ACL_DENY_MAC
 0x02

	)

3170 
	#AP_ACL_RETAIN_LIST_MASK
 0x80

	)

3172 
	swmi_≠_a˛_pﬁicy_cmd
 {

3173 
u8
 
	mpﬁicy
;

3174 } 
	g__∑cked
;

3176 
	#ADD_MAC_ADDR
 1

	)

3177 
	#DEL_MAC_ADDR
 2

	)

3179 
	swmi_≠_a˛_mac_li°_cmd
 {

3180 
u8
 
	ma˘i⁄
;

3181 
u8
 
	mödex
;

3182 
u8
 
	mmac
[
ETH_ALEN
];

3183 
u8
 
	mwûdˇrd
;

3184 } 
	g__∑cked
;

3186 
	swmi_Ælow_aggr_cmd
 {

3187 
u16
 
	mtx_Ælow_aggr
;

3188 
u16
 
	mrx_Ælow_aggr
;

3189 } 
	g__∑cked
;

3192 
	swmi_assoc_ªq_evít
 {

3193 
u8
 
	m°©us
;

3194 
u8
 
	mr•Ty≥
;

3195 
u8
 
	massocReq
[0];

3196 } 
	g__∑cked
;

3198 
	swmi_assoc_ª•_£nd_cmd
 {

3199 
u8
 
	mho°_ac˚±
;

3200 
u8
 
	mho°_ªas⁄Code
;

3201 
u8
 
	mèrgë_°©us
;

3202 
u8
 
	m°a_mac_addr
[
ETH_ALEN
];

3203 
u8
 
	mr•Ty≥
;

3204 } 
	g__∑cked
;

3206 
	swmi_assoc_ªq_ªœy_cmd
 {

3207 
u8
 
	míabÀ
;

3208 } 
	g__∑cked
;

3212 
	swmi_ùv6_addr
 {

3213 
u8
 
	maddªss
[16];

3214 } 
	g__∑cked
;

3216 
	#WMI_MAX_NS_OFFLOADS
 2

	)

3217 
	#WMI_MAX_ARP_OFFLOADS
 2

	)

3220 
	#WMI_ARPOFF_FLAGS_VALID
 (1 << 0)

	)

3222 
	#WMI_ARPOFF_FLAGS_MAC_VALID
 (1 << 1)

	)

3224 
	#WMI_ARPOFF_FLAGS_REMOTE_IP_VALID
 (1 << 2)

	)

3231 
	swmi_¨p_ofÊﬂd_tu∂e
 {

3232 
u8
 
	mÊags
;

3233 
u8
 
	mèrgë_ùaddr
[4];

3234 
u8
 
	mªmŸe_ùaddr
[4];

3235 
u8
 
	mèrgë_mac
[
ETH_ALEN
];

3236 } 
	g__∑cked
;

3239 
	#WMI_NSOFF_FLAGS_VALID
 (1 << 0)

	)

3241 
	#WMI_NSOFF_FLAGS_MAC_VALID
 (1 << 1)

	)

3243 
	#WMI_NSOFF_FLAGS_REMOTE_IP_VALID
 (1 << 2)

	)

3245 
	#WMI_NSOFF_MAX_TARGET_IPS
 2

	)

3253 
	swmi_ns_ofÊﬂd_tu∂e
 {

3254 
u8
 
	mÊags
;

3255 
wmi_ùv6_addr
 
	mèrgë_ùaddr
[
WMI_NSOFF_MAX_TARGET_IPS
];

3256 
wmi_ùv6_addr
 
	msﬁicô©i⁄_ùaddr
;

3257 
wmi_ùv6_addr
 
	mªmŸe_ùaddr
;

3258 
u8
 
	mèrgë_mac
[
ETH_ALEN
];

3259 } 
	g__∑cked
;

3261 
	swmi_£t_¨p_ns_ofÊﬂd_cmd
 {

3262 
u32
 
	mÊags
;

3263 
wmi_ns_ofÊﬂd_tu∂e
 
	mns_tu∂es
[
WMI_MAX_NS_OFFLOADS
];

3264 
wmi_¨p_ofÊﬂd_tu∂e
 
	m¨p_tu∂es
[
WMI_MAX_ARP_OFFLOADS
];

3265 } 
	g__∑cked
;

3270 
	eWMI_MCC_PROFILE
 {

3271 
	mWMI_MCC_PROFILE_STA50
 = 
BIT
(0),

3272 
	mWMI_MCC_PROFILE_STA20
 = 
BIT
(1),

3273 
	mWMI_MCC_PROFILE_STA80
 = 
BIT
(2),

3274 
	mWMI_MCC_CTS_ENABLE
 = 
BIT
(4),

3275 
	mWMI_MCC_PSPOLL_ENABLE
 = 
BIT
(5),

3276 
	mWMI_MCC_DUAL_TIME_MASK
 = 
BIT
(8),

3279 
	swmi_£t_mcc_¥ofûe_cmd
 {

3280 
u32
 
	mmcc_¥ofûe
;

3281 } 
	g__∑cked
;

3283 
	swmi_£t_go_sync_cmd
 {

3284 
u16
 
	m‰eq
;

3285 
u8
 
	maddr
[
ETH_ALEN
];

3286 
u8
 
	mª≥©
;

3287 
u8
 
	m°a_dwñl_time
;

3288 } 
	g__∑cked
;

3290 
	#DISALBE_AP_INACTIVE_TIMEMER
 0

	)

3291 
	swmi_≠_c⁄n_öa˘_cmd
 {

3292 
u32
 
	m≥riod
;

3293 } 
	g__∑cked
;

3296 
	#MIN_BMISS_TIME
 1000

	)

3297 
	#MAX_BMISS_TIME
 5000

	)

3298 
	#MIN_BMISS_BEACONS
 1

	)

3299 
	#MAX_BMISS_BEACONS
 50

	)

3301 
	swmi_bmiss_time_cmd
 {

3302 
u16
 
	mbmissTime
;

3303 
u16
 
	mnumBóc⁄s
;

3304 } 
	g__∑cked
;

3306 
	eWMI_SCAN_PLAN_TYPE
 {

3307 
	mWMI_SCAN_PLAN_IN_ORDER
 = 0,

3308 
	mWMI_SCAN_PLAN_REVERSE_ORDER
 = 1,

3309 
	mWMI_SCAN_PLAN_HOST_ORDER
 = 2,

3312 
	swmi_sˇn_ch™_∂™_cmd
 {

3313 
u32
 
	mÊag
;

3314 
u8
 
	mty≥
;

3315 
u8
 
	mnumCh™√ls
;

3316 
__À16
 
	mch™√Œi°
[1];

3317 } 
	g__∑cked
;

3319 
	swmi_£t_dtim_ext_cmd
 {

3320 
u8
 
	mdtim_ext
;

3321 } 
	g__∑cked
;

3323 #ifde‡
CONFIG_WLAN_QRF


3325 
	swmi_qrf_íabÀ_cmd
 {

3326 
u8
 
	míabÀ
;

3327 } 
	g__∑cked
;

3329 
	swmi_qrf_£t_ssid_cmd
 {

3330 
u8
 
	mÊag
;

3331 
u8
 
	mssid
[
IEEE80211_MAX_SSID_LEN
];

3332 
u8
 
	mssid_Àn
;

3333 } 
	g__∑cked
;

3335 
	swmi_qrf_£t_mac_cmd
 {

3336 
u8
 
	mmac
[
ETH_ALEN
];

3337 } 
	g__∑cked
;

3339 
	#WMI_QRF_NUM_CHANNELS_MAX
 11

	)

3341 
	swmi_qrf_£t_∑øms_cmd
 {

3342 
u32
 
	msˇnI¡îvÆ
;

3343 
u32
 
	msˇnDwñlI¡îvÆ
;

3344 
u8
 
	mnumCh™√ls
;

3345 
u16
 
	mch™√lLi°
[1];

3346 } 
	g__∑cked
;

3348 
	eWMI_AP_SCAN_MODE
 {

3349 
	mWMI_AP_SCAN_DISABLED
,

3350 
	mWMI_AP_SCAN_ENABLED


3353 
	swmi_qrf_£t_≠∑øms_cmd
 {

3354 
u32
 
	msˇnDwñl
;

3355 
u32
 
	msˇnRïót
;

3356 
u8
 
	msˇnMode
;

3357 } 
	g__∑cked
;

3359 
	swmi_qrf_sˇn_ªsu…s_evít
 {

3360 
u8
 
	mvÆid
;

3361 
u8
 
	mmac
[6];

3362 } 
	g__∑cked
;

3364 
	#WMI_QRF_MAX_SCAN_RESULTS
 5

	)

3366 
	swmi_qrf_gë_sˇn_ªsu…s_cmd
 {

3367 
u32
 
	mnumMacs
;

3368 
u8
 
	mmac
[
WMI_QRF_MAX_SCAN_RESULTS
][
ETH_ALEN
];

3369 } 
	g__∑cked
;

3373 
htc_ídpoöt_id
 
©h6kl_wmi_gë_c⁄åﬁ_ï
(
wmi
 *wmi);

3374 
©h6kl_wmi_£t_c⁄åﬁ_ï
(
wmi
 *wmi, 
htc_ídpoöt_id
 
ï_id
);

3375 
©h6kl_wmi_dix_2_dŸ3
(
wmi
 *wmi, 
sk_buff
 *
skb
);

3376 
©h6kl_wmi_d©a_hdr_add
(
wmi
 *wmi, 
sk_buff
 *
skb
,

3377 
u8
 
msg_ty≥
, 
u32
 
Êags
,

3378 
wmi_d©a_hdr_d©a_ty≥
 
d©a_ty≥
,

3379 
u8
 
mëa_vî
, *
tx_mëa_öfo
, u8 
if_idx
);

3380 
u8
 
©h6kl_wmi_dëîmöe_u£r_¥i‹ôy
(u8 *
pkt
, 
u32
 
œyî2_¥i
);

3382 
©h6kl_wmi_dŸ11_hdr_ªmove
(
wmi
 *wmi, 
sk_buff
 *
skb
);

3383 
©h6kl_wmi_dŸ3_2_dix
(
sk_buff
 *
skb
);

3384 
©h6kl_wmi_im∂icô_¸óã_p°ªam
(
wmi
 *wmi, 
u8
 
if_idx
,

3385 
sk_buff
 *
skb
, 
u32
 
œyî2_¥i‹ôy
,

3386 
boﬁ
 
wmm_íabÀd
, 
u8
 *
ac
,

3387 
u16
 *
phtc_èg
);

3389 
©h6kl_wmi_c⁄åﬁ_rx
(
wmi
 *wmi, 
sk_buff
 *
skb
);

3391 
©h6kl_wmi_cmd_£nd
(
wmi
 *wmi, 
u8
 
if_idx
, 
sk_buff
 *
skb
,

3392 
wmi_cmd_id
 
cmd_id
, 
wmi_sync_Êag
 
sync_Êag
);

3394 
©h6kl_wmi_c⁄√˘_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3395 
√tw‹k_ty≥
 
nw_ty≥
,

3396 
dŸ11_auth_mode
 dot11_auth_mode,

3397 
auth_mode
áuth_mode,

3398 
¸y±o_ty≥
 
∑úwi£_¸y±o
,

3399 
u8
 
∑úwi£_¸y±o_Àn
,

3400 
¸y±o_ty≥
 
group_¸y±o
,

3401 
u8
 
group_¸y±o_Àn
, 
ssid_Àn
, u8 *
ssid
,

3402 
u8
 *
bssid
, 
u16
 
ch™√l
, 
u32
 
˘æ_Êags
);

3404 
©h6kl_wmi_£t_øndom_bóc⁄_skù
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
íabÀd
,

3405 
u32
 
⁄
, u32 
∫d
, u32 
off
);

3406 
©h6kl_wmi_£t_dh˝_˛õ¡
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
ù
, u32 
íabÀd
);

3407 
©h6kl_wmi_£t_dh˝_£rvî
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
ù
, u32 
íabÀd
);

3408 
©h6kl_wmi_ªc⁄√˘_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 *
bssid
,

3409 
u16
 
ch™√l
);

3410 
©h6kl_wmi_disc⁄√˘_cmd
(
wmi
 *wmi, 
u8
 
if_idx
);

3411 
©h6kl_wmi_°¨tsˇn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3412 
wmi_sˇn_ty≥
 
sˇn_ty≥
,

3413 
u32
 
f‹˚_fgsˇn
, u32 
is_Àgacy
,

3414 
u32
 
home_dwñl_time
, u32 
f‹˚_sˇn_öãrvÆ
,

3415 
s8
 
num_ch™
, 
u16
 *
ch_li°
);

3416 
©h6kl_wmi_sˇ≈¨ams_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
fg_°¨t_£c
,

3417 
u16
 
fg_íd_£c
, u16 
bg_£c
,

3418 
u16
 
möa˘_chdw_m£c
, u16 
maxa˘_chdw_m£c
,

3419 
u16
 
∑s_chdw_m£c
, 
u8
 
sh‹t_sˇn_øtio
,

3420 
u8
 
sˇn_˘æ_Êag
, 
u32
 
max_dfsch_a˘_time
,

3421 
u16
 
maxa˘_sˇn_≥r_ssid
);

3422 
©h6kl_wmi_bssfûãr_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
fûãr
,

3423 
u32
 
õ_mask
);

3424 
©h6kl_wmi_go_sync_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3425 
wmi_£t_go_sync_cmd
 *
gsync
);

3426 
©h6kl_wmi_¥obedssid_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
ödex
, u8 
Êag
,

3427 
u8
 
ssid_Àn
, u8 *
ssid
);

3428 
©h6kl_wmi_li°íöãrvÆ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3429 
u16
 
li°í_öãrvÆ
,

3430 
u16
 
li°í_bóc⁄s
);

3431 
©h6kl_wmi_powîmode_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
pwr_mode
);

3432 
©h6kl_wmi_pm∑øms_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
idÀ_≥riod
,

3433 
u16
 
ps_pﬁl_num
, u16 
dtim_pﬁicy
,

3434 
u16
 
tx_wakup_pﬁicy
, u16 
num_tx_to_wakeup
,

3435 
u16
 
ps_Áû_evít_pﬁicy
);

3436 
©h6kl_wmi_ibss_pm_ˇps_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
adhoc_ps_ty≥
,

3437 
u8
 
âl
,

3438 
u16
 
©im_wödows
,

3439 
u16
 
timeout_vÆue
);

3440 
©h6kl_wmi_¸óã_p°ªam_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3441 
wmi_¸óã_p°ªam_cmd
 *
p°ªam
);

3442 
©h6kl_wmi_dñëe_p°ªam_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
åaffic_˛ass
,

3443 
u8
 
tsid
);

3444 
©h6kl_wmi_dis˘imeout_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
timeout
);

3446 
©h6kl_wmi_£t_πs_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
thªshﬁd
);

3447 
©h6kl_wmi_£t_ÕªambÀ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
°©us
,

3448 
u8
 
¥ómbÀ_pﬁicy
);

3450 
©h6kl_wmi_gë_chÆÀnge_ª•_cmd
(
wmi
 *wmi, 
u32
 
cookõ
, u32 
sour˚
);

3451 
©h6kl_wmi_c⁄fig_debug_moduÀ_cmd
(
wmi
 *wmi, 
u32
 
vÆid
, u32 
c⁄fig
);

3453 
©h6kl_wmi_gë_°©s_cmd
(
wmi
 *wmi, 
u8
 
if_idx
);

3454 
©h6kl_wmi_addkey_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
key_ödex
,

3455 
¸y±o_ty≥
 
key_ty≥
,

3456 
u8
 
key_ußge
, u8 
key_Àn
,

3457 
u8
 *
key_rsc
, 
key_rsc_Àn
,

3458 
u8
 *
key_m©îül
,

3459 
u8
 
key_›_˘æ
, u8 *
mac_addr
,

3460 
wmi_sync_Êag
 
sync_Êag
);

3461 #ifde‡
PMF_SUPPORT


3462 
©h6kl_wmi_addkey_igtk_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
key_ödex
,

3463 
u8
 
key_Àn
, u8 *
key_rsc
, u8 *
key_m©îül
,

3464 
wmi_sync_Êag
 
sync_Êag
);

3466 
©h6kl_wmi_add_krk_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 *
krk
);

3467 
©h6kl_wmi_dñëekey_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
key_ödex
);

3468 
©h6kl_wmi_£çmkid_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, c⁄° u8 *
bssid
,

3469 c⁄° 
u8
 *
pmkid
, 
boﬁ
 
£t
);

3470 
©h6kl_wmi_£t_tx_pwr_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
dbM
);

3471 
©h6kl_wmi_gë_tx_pwr_cmd
(
wmi
 *wmi, 
u8
 
if_idx
);

3472 
©h6kl_wmi_gë_rﬂm_tbl_cmd
(
wmi
 *wmi);

3474 
©h6kl_wmi_£t_wmm_tx›
(
wmi
 *wmi, 
u8
 
if_idx
, 
wmi_tx›_cfg
 
cfg
);

3475 
©h6kl_wmi_£t_kì∑live_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3476 
u8
 
kìp_Æive_ötvl
);

3477 
©h6kl_wmi_ã°_cmd
(
wmi
 *wmi, *
buf
, 
size_t
 
Àn
);

3479 
s32
 
©h6kl_wmi_gë_øã
(
s8
 
øã_ödex
);

3480 
s32
 
©h6kl_wmi_gë_øã_¨6004
(
s8
 
øã_ödex
);

3482 
©h6kl_wmi_£t_ù_cmd
(
wmi
 *wmi, 
wmi_£t_ù_cmd
 *
ù_cmd
);

3485 
©h6kl_wmi_£t_ho°_¶ìp_mode_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3486 
©h6kl_ho°_mode
 
ho°_mode
);

3487 
©h6kl_wmi_£t_wow_mode_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3488 
©h6kl_wow_mode
 
wow_mode
,

3489 
u32
 
fûãr
, 
u16
 
ho°_ªq_dñay
);

3490 
©h6kl_wmi_add_wow_∑âîn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3491 
u8
 
li°_id
, u8 
fûãr_size
,

3492 
u8
 
fûãr_off£t
, u8 *
fûãr
, u8 *
mask
);

3493 
©h6kl_wmi_dñ_wow_∑âîn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3494 
u16
 
li°_id
, u16 
fûãr_id
);

3495 
©h6kl_wmi_add_wow_ext_∑âîn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3496 
u8
 
li°_id
, u8 
fûãr_size
,

3497 
u8
 
fûãr_id
, u8 
fûãr_off£t
,

3498 
u8
 *
fûãr
, u8 *
mask
);

3499 
©h6kl_wmi_dñ_Æl_wow_ext_∑âîns_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3500 
__À16
 
fûãr_li°_id
);

3501 
©h6kl_wm_£t_gtk_ofÊﬂd
(
wmi
 *wmi, 
u8
 
if_idx
,

3502 
u8
 *
kek
, u8 *
kck
, u8 *
ª∂ay_˘r
);

3504 
©h6kl_wmi_£t_rﬂm_˘æ_cmd
(
wmi
 *wmi,

3505 
u8
 
fw_vif_idx
, 
u16
 
lowrssi_sˇn_≥riod
, u16 
lowrssi_sˇn_thªshﬁd
,

3506 
u16
 
lowrssi_rﬂm_thªshﬁd
,

3507 
u8
 
rﬂm_rssi_Êo‹
);

3509 
©h6kl_wmi_f‹˚_rﬂm_cmd
(
wmi
 *wmi, c⁄° 
u8
 *
bssid
);

3510 
©h6kl_wmi_£t_rﬂm_mode_cmd
(
wmi
 *wmi, 
wmi_rﬂm_mode
 
mode
);

3511 
©h6kl_wmi_£t_rﬂm_5g_büs_cmd
(
wmi
 *wmi, 
u8
 
büs_5g
);

3514 
©h6kl_wmi_≠_¥ofûe_commô
(
wmi
 *
wmù
, 
u8
 
if_idx
,

3515 
wmi_c⁄√˘_cmd
 *
p
);

3517 
©h6kl_wmi_≠_£t_mlme
(
wmi
 *
wmù
, 
u8
 
if_idx
, u8 
cmd
,

3518 c⁄° 
u8
 *
mac
, 
u16
 
ªas⁄
);

3520 
©h6kl_wmi_£t_pvb_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
aid
, 
boﬁ
 
Êag
);

3522 
©h6kl_wmi_£t_rx_‰ame_f‹m©_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3523 
u8
 
rx_mëa_vîsi⁄
,

3524 
boﬁ
 
rx_dŸ11_hdr
, boﬁ 
de‰ag_⁄_ho°
);

3526 
©h6kl_wmi_£t_≠põ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
mgmt_‰m_ty≥
,

3527 c⁄° 
u8
 *
õ
, u8 
õ_Àn
);

3529 
©h6kl_wmi_£t_øã_˘æ_cmd
(
wmi
 *wmi,

3530 
u8
 
if_idx
, 
u32
 
øãmode
);

3533 
©h6kl_wmi_dißbÀ_11b_øãs_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
boﬁ
 
dißbÀ
);

3535 
©h6kl_wmi_ªmaö_⁄_ch∆_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
‰eq
,

3536 
u32
 
dur
);

3538 
©h6kl_wmi_£nd_a˘i⁄_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
id
, u32 
‰eq
,

3539 
u32
 
waô
, c⁄° 
u8
 *
d©a
, 
u16
 
d©a_Àn
);

3541 
©h6kl_wmi_£nd_¥obe_ª•⁄£_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
‰eq
,

3542 c⁄° 
u8
 *
d°
, c⁄° u8 *
d©a
,

3543 
u16
 
d©a_Àn
);

3545 
©h6kl_wmi_£nd_go_¥obe_ª•⁄£_cmd
(
wmi
 *wmi,

3546 
©h6kl_vif
 *
vif
, c⁄° 
u8
 *
buf
, 
size_t
 
Àn
, 
‰eq
);

3548 
©h6kl_wmi_¥obe_ªp‹t_ªq_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
boﬁ
 
íabÀ
);

3550 
©h6kl_wmi_¥obe_ª•_ªp‹t_ªq_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3551 
boﬁ
 
íabÀ
);

3553 
©h6kl_wmi_öfo_ªq_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
öfo_ªq_Êags
);

3555 
©h6kl_wmi_ˇn˚l_ªmaö_⁄_ch∆_cmd
(
wmi
 *wmi, 
u8
 
if_idx
);

3557 
©h6kl_wmi_£t_≠põ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
mgmt_‰m_ty≥
,

3558 c⁄° 
u8
 *
õ
, u8 
õ_Àn
);

3560 
©h6kl_vif
 *
©h6kl_gë_vif_by_ödex
(
©h6kl
 *
¨
, 
u8
 
if_idx
);

3561 *
©h6kl_wmi_öô
(
©h6kl
 *
devt
);

3562 
©h6kl_wmi_shutdown
(
wmi
 *wmi);

3563 
©h6kl_wmi_ª£t
(
wmi
 *wmi);

3565 
wmi_πt_ªq_mós
(
wmi
 *
wmù
, 
n•_mrq°
 *
p°mrq°
, 
u32
 
Àn
);

3566 
wmi_πt_c⁄fig
(
wmi
 *
wmù
, 
n•_πt_c⁄fig
 *);

3567 
wmi_πt_ªq
(
wmi
 *
wmù
, 
wmi_cmd_id
 
cmd_id
, *
d©a
, 
u32
 
Àn
);

3569 
©h6kl_wmi_£t_gªí_tx_∑øms
(
wmi
 *wmi,

3570 
wmi_gªí_tx_∑øms
 *
∑øms
);

3572 
©h6kl_wmi_smps_c⁄fig
(
wmi
 *wmi,

3573 
wmi_c⁄fig_smps_cmd
 *
›ti⁄s
);

3575 
©h6kl_wmi_smps_íabÀ
(
wmi
 *wmi,

3576 
wmi_c⁄fig_íabÀ_cmd
 *
›ti⁄s
);

3578 
©h6kl_wmi_Õl_íabÀ_cmd
(
wmi
 *wmi,

3579 
wmi_Õl_f‹˚_íabÀ_cmd
 *
f‹˚_íabÀ_cmd
);

3581 
©h6kl_wmi_pkéog_íabÀ_cmd
(
wmi
 *wmi,

3582 
wmi_íabÀ_pkéog_cmd
 *
›ti⁄s
);

3584 
©h6kl_wmi_pkéog_dißbÀ_cmd
(
wmi
 *wmi);

3586 
©h6kl_wmi_pkéog_evít_rx
(
wmi
 *wmi, 
u8
 *
d©≠
, 
u32
 
Àn
);

3588 
©h6kl_wmi_sim∂e_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
wmi_cmd_id
 
cmd_id
);

3590 
sk_buff
 *
©h6kl_wmi_gë_√w_buf
(
u32
 
size
);

3592 
©h6kl_wmi_ab‹t_sˇn_cmd
(
wmi
 *wmi, 
u8
 
if_idx
);

3594 
©h6kl_wmi_£t_ht_ˇp_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3595 
u8
 
b™d
, u8 
ch™_width_40M_suµ‹ãd
,

3596 
u8
 
sh‹t_GI
, u8 
ötﬁî™˚_40MHz
);

3598 
©h6kl_wmi_£t_ht_›_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3599 
u8
 
°a_ch™_width
, u8 
›mode
);

3601 
©h6kl_wmi_£t_dtim_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
dtim
);

3603 
©h6kl_wmi_≠_£t_≠sd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
íabÀ
);

3605 
©h6kl_wmi_£t_≠sd_buf„ªd_åaffic_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3606 
u16
 
aid
, u16 
bôm≠
, 
u32
 
Êags
);

3608 
©h6kl_wmi_£t_tx_£À˘_øãs_⁄_Æl_mode
(
wmi
 *wmi,

3609 
u8
 
if_idx
, 
u64
 
mask
);

3611 
©h6kl_wmi_£t_hiddí_ssid_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
hiddí_ssid
);

3613 
©h6kl_wmi_£t_bóc⁄_öãrvÆ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3614 
u32
 
bóc⁄_öãrvÆ
);

3616 
©h6kl_wmi_£t_r¢_ˇp
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
r¢_ˇp
);

3617 
©h6kl_wmi_gë_r¢_ˇp
(
wmi
 *wmi, 
u8
 
if_idx
);

3618 
©h6kl_wmi_gë_pmkid_li°
(
wmi
 *wmi, 
u8
 
if_idx
);

3620 
©h6kl_wmi_£t_fix_øãs
(
wmi
 *wmi, 
u8
 
if_idx
, 
u64
 
mask
);

3622 
©h6kl_wmi_add_p‹t_cmd
(
wmi
 *wmi, 
©h6kl_vif
 *
vif
,

3623 
u8
 
›mode
, u8 
sub›mode
);

3624 
©h6kl_wmi_dñ_p‹t_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
p‹t_id
);

3626 
©h6kl_wmi_£t_nﬂ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3627 
u8
 
cou¡
, 
u32
 
°¨t
, u32 
duøti⁄
, u32 
öãrvÆ
);

3628 
©h6kl_wmi_£t_›µs_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3629 
u8
 
íabÀ
, u8 
˘wö
);

3631 
©h6kl_wmi_£t_hóπ_bót_∑øms
(
wmi
 *wmi, 
u8
 
if_idx
,

3632 
u8
 
íabÀ
, u8 
ôem
, u8 
£ssi⁄
);

3633 
©h6kl_wmi_hóπ_bót_£t_t˝_∑øms
(
wmi
 *wmi, 
u8
 
if_idx
,

3634 
u16
 
§c_p‹t
, u16 
d°_p‹t
, 
u32
 
§v_ù
, u32 
dev_ù
, u16 
timeout
,

3635 
u8
 
£ssi⁄
, u8 *
g©eway_mac
);

3636 
©h6kl_wmi_hóπ_bót_£t_t˝_fûãr
(
wmi
 *wmi, 
u8
 
if_idx
,

3637 
u8
 *
fûãr
, u8 
Àngth
, u8 
off£t
, u8 
£ssi⁄
);

3638 
©h6kl_wmi_hóπ_bót_£t_udp_∑øms
(
wmi
 *wmi, 
u8
 
if_idx
,

3639 
u16
 
§c_p‹t
, u16 
d°_p‹t
, 
u32
 
§v_ù
, u32 
dev_ù
, u16 
öãrvÆ
,

3640 
u16
 
timeout
, 
u8
 
£ssi⁄
, u8 *
g©eway_mac
);

3641 
©h6kl_wmi_hóπ_bót_£t_udp_fûãr
(
wmi
 *wmi, 
u8
 
if_idx
,

3642 
u8
 *
fûãr
, u8 
Àngth
, u8 
off£t
, u8 
£ssi⁄
);

3644 
©h6kl_wmi_disc_õ_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
íabÀ
,

3645 
u8
 
°¨tPos
, u8 *
∑âîn
, u8 
Àngth
);

3646 
©h6kl_wmi_disc_mode_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
íabÀ
,

3647 
u16
 
ch™√l
, 
u32
 
home_dwñl_time
, u32 
¶ìpTime
, u32 
øndom
,

3648 
u32
 
numPìrs
, u32 
≥îTimeout
);

3650 
©h6kl_wmi_≠_pﬁl_°a
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
aid
);

3651 
©h6kl_wmi_≠_a˛_pﬁicy
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
pﬁicy
);

3652 
©h6kl_wmi_≠_a˛_mac_li°
(
wmi
 *wmi, 
u8
 
if_idx
,

3653 
u8
 
idx
, u8 *
mac_addr
, u8 
a˘i⁄
);

3654 
©h6kl_wmi_Ælow_aggr_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3655 
u16
 
tx_tid_mask
, u16 
rx_tid_mask
);

3656 
©h6kl_wmi_£t_¸edô_by∑ss
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
eid
,

3657 
u8
 
ª°‹e
, 
u16
 
thªshﬁd
);

3658 
©h6kl_wmi_£t_¨p_ofÊﬂd_ù_cmd
(
wmi
 *wmi, 
u8
 *
ù_addrs
);

3659 
©h6kl_wmi_£t_mcc_¥ofûe_cmd
(
wmi
 *wmi, 
u32
 
mcc_¥ofûe
);

3660 
©h6kl_wmi_£t_£amÀss_mcc_scc_swôch_‰eq_cmd
(
wmi
 *wmi, 
u32
 
‰eq
);

3662 
©h6kl_wmi_£t_ªgdomaö_cmd
(
wmi
 *wmi, c⁄° *
Æpha2
);

3663 
©h6kl_wmi_£t_öa˘_cmd
(
wmi
 *wmi, 
u32
 
öa˝îiod
);

3664 
©h6kl_wmi_£nd_assoc_ª•_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3665 
boﬁ
 
ac˚±
, 
u8
 
ªas⁄_code
, u8 
fw_°©us
, u8 *
°a_mac
, u8 
ªq_ty≥
);

3666 
©h6kl_wmi_£t_assoc_ªq_ªœy_cmd
(
wmi
 *wmi, 
u8
 
if_idx
,

3667 
boﬁ
 
íabÀd
);

3669 
©h6kl_wmi_£t_≠_num_°a_cmd
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
°a_nums
);

3670 
©h6kl_wmi_£t_™tdivcfg
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
divîsôy_c⁄åﬁ
);

3671 
©h6kl_wmi_™tdiv°©e_evít_rx
(
©h6kl_vif
 *
vif
, 
u8
 *
d©≠
, 
Àn
);

3673 
©h6kl_wmi_™tdiv°©e_debug_evít_rx
(
©h6kl_vif
 *
vif
,

3674 
u8
 *
d©≠
, 
Àn
);

3675 
©h6kl_™tdiv_°©_debug
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
);

3677 
©h6kl_wmi_™i°©e_evít_rx
(
©h6kl_vif
 *
vif
, 
u8
 *
d©≠
, 
Àn
);

3679 
©h6kl_wmi_™i°©e_debug_evít_rx
(
©h6kl_vif
 *
vif
,

3680 
u8
 *
d©≠
, 
Àn
);

3681 
©h6kl_wmi_™i°©e_íabÀ
(
wmi
 *wmi,

3682 
wmi_c⁄fig_íabÀ_cmd
 *
›ti⁄s
);

3683 
©h6kl_™i_°©_debug
(
©h6kl
 *
¨
, 
u8
 *
buf
, 
buf_Àn
);

3684 
©h6kl_wmi_£t_bmiss_time
(
wmi
 *wmi, 
u8
 
if_idx
, 
u16
 
numBóc⁄
);

3686 
©h6kl_wmi_£t_sˇn_ch™_∂™
(
wmi
 *wmi, 
u8
 
if_idx
,

3687 
u8
 
ty≥
, u8 
numCh™
, 
u16
 *
ch™Li°
);

3688 
©h6kl_wmi_£t_dtim_ext
(
wmi
 *wmi, 
u8
 
dtim_ext
);

3690 
©h6kl_wmi_qrf_íabÀ
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
íabÀ
);

3691 
©h6kl_wmi_qrf_£t_ssid
(
wmi
 *wmi, 
u8
 
if_idx
, u8 
Êag
, u8 
ssid_Àn
,

3692 
u8
 *
ssid
);

3693 
©h6kl_wmi_qrf_£t_mac
(
wmi
 *wmi, 
u8
 
if_idx
, u8 *
mac
);

3694 
©h6kl_wmi_qrf_£t_∑øms
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
sˇnI¡îvÆ
,

3695 
u32
 
sˇnDwñlI¡îvÆ
, 
u8
 
numCh™√ls
, 
u16
 *
ch™√lLi°
);

3696 
©h6kl_wmi_qrf_£t_≠∑øms
(
wmi
 *wmi, 
u8
 
if_idx
, 
u32
 
sˇnDwñl
,

3697 
u32
 
sˇnRïót
, 
u8
 
sˇnMode
);

	@wmi_btcoex.c

17 
	~<löux/ù.h
>

18 
	~"c‹e.h
"

19 
	~"wmi_btc€x.h
"

20 
	~"debug.h
"

21 #ifde‡
CONFIG_ANDROID


22 
	~<mach/socöfo.h
>

25 
	#BDATA_ANTCONF_OFFSET
 4069

	)

26 
	#BDATA_BTDEV_OFFSET
 4070

	)

28 
	#BT_DEVICE_TYPE_QCOM
 2

	)

30 
	#WMI_A2DP_CONFIG_FLAG_ALLOW_OPTIMIZATION
 (1 << 0)

	)

31 
	#WMI_A2DP_CONFIG_FLAG_IS_EDR_CAPABLE
 (1 << 1)

	)

32 
	#WMI_A2DP_CONFIG_FLAG_IS_BT_ROLE_MASTER
 (1 << 2)

	)

33 
	#WMI_A2DP_CONFIG_FLAG_IS_A2DP_HIGH_PRI
 (1 << 3)

	)

34 
	#WMI_A2DP_CONFIG_FLAG_FIND_BT_ROLE
 (1 << 4)

	)

35 
	#WMI_A2DP_CONFIG_FLAG_DIS_SCANCONN_STOMP
 (1 << 5)

	)

37 
	#BTCOEX_A2DP_MAX_BLUETOOTH_TIME_LSB
 24

	)

38 
	#BTCOEX_A2DP_EDR_MAX_BLUETOOTH_TIME
 \

39 (40 << 
BTCOEX_A2DP_MAX_BLUETOOTH_TIME_LSB
)

	)

40 
	#BTCOEX_A2DP_BDR_MAX_BLUETOOTH_TIME
 \

41 (70 << 
BTCOEX_A2DP_MAX_BLUETOOTH_TIME_LSB
)

	)

42 
	#BTCOEX_APMODE_A2DP_MAX_BLUETOOTH_TIME
 \

43 (30 << 
BTCOEX_A2DP_MAX_BLUETOOTH_TIME_LSB
)

	)

44 
	#BTCOEX_APMODE_A2DP_BDR_MAX_BLUETOOTH_TIME
 \

45 (60 << 
BTCOEX_A2DP_MAX_BLUETOOTH_TIME_LSB
)

	)

46 
	#BTCOEX_A2DP_WLAN_MAX_DUR
 25

	)

47 
	#BTCOEX_A2DP_BDR_WLAN_MAX_DUR
 20

	)

48 
	#BTCOEX_APMODE_A2DP_BDR_WLAN_MAX_DUR
 40

	)

49 
	#BTCOEX_APMODE_A2DP_WLAN_MAX_DUR
 70

	)

50 
	#BTCOEX_APMODE_A2DP_MIN_BURST_CNT
 10

	)

52 
	#WMI_SCO_CONFIG_FLAG_ALLOW_OPTIMIZATION
 (1 << 0)

	)

53 
	#WMI_SCO_CONFIG_FLAG_IS_EDR_CAPABLE
 (1 << 1)

	)

54 
	#WMI_SCO_CONFIG_FLAG_IS_BT_MASTER
 (1 << 2)

	)

55 
	#WMI_SCO_CONFIG_FLAG_FW_DETECT_OF_PER
 (1 << 3)

	)

56 
	#WMI_SCO_CONFIG_FLAG_DIS_SCANCONN_STOMP
 (1 << 4)

	)

58 
ölöe
 
sk_buff
 *
	$©h6kl_wmi_btc€x_gë_√w_buf
(
u32
 
size
)

60 
sk_buff
 *
skb
;

62 
skb
 = 
	`©h6kl_buf_Æloc
(
size
);

63 i‡(!
skb
)

64  
NULL
;

66 
	`skb_put
(
skb
, 
size
);

67 i‡(
size
)

68 
	`mem£t
(
skb
->
d©a
, 0, 
size
);

70  
skb
;

71 
	}
}

76 
	#NL80211_WMI_SET_BT_STATUS
 0

	)

77 
	#NL80211_WMI_SET_BT_PARAMS
 1

	)

78 
	#NL80211_WMI_SET_BT_FT_ANT
 2

	)

79 
	#NL80211_WMI_SET_COLOCATED_BT_DEV
 3

	)

80 
	#NL80211_WMI_SET_BT_INQUIRY_PAGE_CONFIG
 4

	)

81 
	#NL80211_WMI_SET_BT_SCO_CONFIG
 5

	)

82 
	#NL80211_WMI_SET_BT_A2DP_CONFIG
 6

	)

83 
	#NL80211_WMI_SET_BT_ACLCOEX_CONFIG
 7

	)

84 
	#NL80211_WMI_SET_BT_DEBUG
 8

	)

85 
	#NL80211_WMI_SET_BT_OPSTATUS
 9

	)

86 
	#NL80211_WMI_GET_BT_CONFIG
 10

	)

87 
	#NL80211_WMI_GET_BT_STATS
 11

	)

88 
	#NL80211_WMI_SET_BT_HID_CONFIG
 12

	)

90 
	$©h6kl_gë_wmi_cmd
(
∆_cmd
)

92 
wmi_cmd
 = 0;

93 
∆_cmd
) {

94 
NL80211_WMI_SET_BT_STATUS
:

95 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BT status\n");

96 
wmi_cmd
 = 
WMI_SET_BT_STATUS_CMDID
;

99 
NL80211_WMI_SET_BT_PARAMS
:

100 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BTÖarams\n");

101 
wmi_cmd
 = 
WMI_SET_BT_PARAMS_CMDID
;

104 
NL80211_WMI_SET_BT_FT_ANT
:

105 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BT FTántenna\n");

106 
wmi_cmd
 = 
WMI_SET_BTCOEX_FE_ANT_CMDID
;

109 
NL80211_WMI_SET_COLOCATED_BT_DEV
:

110 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BT collocated dev\n");

111 
wmi_cmd
 = 
WMI_SET_BTCOEX_COLOCATED_BT_DEV_CMDID
;

114 
NL80211_WMI_SET_BT_INQUIRY_PAGE_CONFIG
:

115 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BT inquiryÖage\n");

116 
wmi_cmd
 = 
WMI_SET_BTCOEX_BTINQUIRY_PAGE_CONFIG_CMDID
;

119 
NL80211_WMI_SET_BT_SCO_CONFIG
:

120 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BT sco config\n");

121 
wmi_cmd
 = 
WMI_SET_BTCOEX_SCO_CONFIG_CMDID
;

124 
NL80211_WMI_SET_BT_A2DP_CONFIG
:

125 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BTá2dp config\n");

126 
wmi_cmd
 = 
WMI_SET_BTCOEX_A2DP_CONFIG_CMDID
;

129 
NL80211_WMI_SET_BT_ACLCOEX_CONFIG
:

130 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BTácl config\n");

131 
wmi_cmd
 = 
WMI_SET_BTCOEX_ACLCOEX_CONFIG_CMDID
;

134 
NL80211_WMI_SET_BT_DEBUG
:

135 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BT bt debug\n");

136 
wmi_cmd
 = 
WMI_SET_BTCOEX_DEBUG_CMDID
;

139 
NL80211_WMI_SET_BT_OPSTATUS
:

140 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BT op status\n");

141 
wmi_cmd
 = 
WMI_SET_BTCOEX_BT_OPERATING_STATUS_CMDID
;

144 
NL80211_WMI_GET_BT_CONFIG
:

145 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Get BT config\n");

146 
wmi_cmd
 = 
WMI_GET_BTCOEX_CONFIG_CMDID
;

149 
NL80211_WMI_GET_BT_STATS
:

150 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Get BT status\n");

151 
wmi_cmd
 = 
WMI_GET_BTCOEX_STATS_CMDID
;

154 
NL80211_WMI_SET_BT_HID_CONFIG
:

155 
	`©h6kl_dbg
(
ATH6KL_DBG_WMI
, "Set BT hid config\n");

156 
wmi_cmd
 = 
WMI_SET_BTCOEX_HID_CONFIG_CMDID
;

158  
wmi_cmd
;

159 
	}
}

161 
u8
 
	$„_™ã¬a_ty≥
(
©h6kl
 *
¨
)

164 
u8
 
„_™ã¬a
 = 
WMI_BTCOEX_FE_ANT_DUAL_SH_BT_LOW_ISO
;

166 i‡(
¨
->
vîsi⁄
.
èrgë_vî
 =
AR6004_HW_3_0_VERSION
) {

167 #ifde‡
CONFIG_ANDROID


168 i‡(
	`machöe_is_≠q8064_dma
() ||

169 
	`machöe_is_≠q8064_buñÀr
())

170 
„_™ã¬a
 =

171 
WMI_BTCOEX_FE_ANT_DUAL_SH_BT_LOW_ISO
;

173 
„_™ã¬a
 =

174 
WMI_BTCOEX_FE_ANT_DUAL_SH_BT_HIGH_ISO
;

179 i‡(
¨
->
fw_bﬂrd
[
BDATA_ANTCONF_OFFSET
])

180 
„_™ã¬a
 =

181 
¨
->
fw_bﬂrd
[
BDATA_ANTCONF_OFFSET
];

184  
„_™ã¬a
;

185 
	}
}

187 
	$©h6kl_btc€x_adju°_∑øms
(
©h6kl
 *
¨
,

188 
wmi_cmd
, 
u8
 *
buf
)

190 
wmi_cmd
) {

191 
WMI_SET_BTCOEX_FE_ANT_CMDID
:

193 
wmi_£t_btc€x_„_™ã¬a_cmd
 *
cmd
 =

194 (
wmi_£t_btc€x_„_™ã¬a_cmd
 *)
buf
;

196 
cmd
->
„_™ã¬a_ty≥
 = 
	`„_™ã¬a_ty≥
(
¨
);

199 
¨
->
gªí_tx_∑øms
.
íabÀ
 = 
Ál£
;

200 
	`©h6kl_wmi_£t_gªí_tx_∑øms
(
¨
->
wmi
,

201 &
¨
->
gªí_tx_∑øms
);

204 
WMI_SET_BTCOEX_COLOCATED_BT_DEV_CMDID
:

206 
wmi_£t_btc€x_cﬁoˇãd_bt_dev_cmd
 *
cmd
 =

207 (
wmi_£t_btc€x_cﬁoˇãd_bt_dev_cmd
 *)
buf
;

211 
¨
->
btc€x_öfo
.
bt_víd‹
 = 
BT_DEVICE_TYPE_QCOM
;

212 
cmd
->
cﬁoˇãd_bt_dev
 = 
BT_DEVICE_TYPE_QCOM
;

215 
WMI_SET_BTCOEX_A2DP_CONFIG_CMDID
:

217 
wmi_£t_btc€x_a2dp_c⁄fig_cmd
 *
cmd
 =

218 (
wmi_£t_btc€x_a2dp_c⁄fig_cmd
 *)
buf
;

219 
btc€x_a2dp_c⁄fig
 *
a2dp_c⁄fig
 = &
cmd
->a2dp_config;

220 
btc€x_p•ﬁl_a2dp_c⁄fig
 *
p•ﬁl_c⁄fig
 =

221 &
cmd
->
p•ﬁl_c⁄fig
;

222 
©h6kl_vif
 *
vif
;

224 i‡(
¨
->
btc€x_öfo
.
bt_víd‹
 =
BT_DEVICE_TYPE_QCOM
) {

225 
a2dp_c⁄fig
->
a2dp_Êags
 |
	`˝u_to_À32
(

226 
WMI_A2DP_CONFIG_FLAG_ALLOW_OPTIMIZATION
);

228 
a2dp_c⁄fig
->
a2dp_Êags
 |
	`˝u_to_À32
(

229 
WMI_A2DP_CONFIG_FLAG_IS_A2DP_HIGH_PRI
);

232 i‡(
a2dp_c⁄fig
->
a2dp_Êags
 &

233 
WMI_A2DP_CONFIG_FLAG_IS_EDR_CAPABLE
) {

236 i‡(
a2dp_c⁄fig
->
a2dp_Êags
 &

237 
WMI_A2DP_CONFIG_FLAG_IS_BT_ROLE_MASTER
) {

239 
a2dp_c⁄fig
->
a2dp_Êags
 |
	`˝u_to_À32
(

240 
BTCOEX_A2DP_EDR_MAX_BLUETOOTH_TIME
);

245 
a2dp_c⁄fig
->
a2dp_Êags
 |
	`˝u_to_À32
(

246 
WMI_A2DP_CONFIG_FLAG_DIS_SCANCONN_STOMP


250 
a2dp_c⁄fig
->
a2dp_Êags
 |
	`˝u_to_À32
(

251 
BTCOEX_A2DP_BDR_MAX_BLUETOOTH_TIME
);

253 
p•ﬁl_c⁄fig
->
a2dp_wœn_max_dur
 =

254 
BTCOEX_A2DP_WLAN_MAX_DUR
;

257 
a2dp_c⁄fig
->
a2dp_Êags
 |
	`˝u_to_À32
(

258 
BTCOEX_A2DP_BDR_MAX_BLUETOOTH_TIME
);

259 
p•ﬁl_c⁄fig
->
a2dp_wœn_max_dur
 =

260 
BTCOEX_A2DP_BDR_WLAN_MAX_DUR
;

264 
vif
 = 
	`©h6kl_vif_fú°
(
¨
);

265 i‡(!
vif
)

268 i‡(
vif
->
nw_ty≥
 =
AP_NETWORK
) {

269 i‡(
a2dp_c⁄fig
->
a2dp_Êags
 &

270 
WMI_A2DP_CONFIG_FLAG_IS_EDR_CAPABLE
) {

271 
p•ﬁl_c⁄fig
->
a2dp_wœn_max_dur
 =

272 
BTCOEX_APMODE_A2DP_WLAN_MAX_DUR
;

273 
a2dp_c⁄fig
->
a2dp_Êags
 |
	`˝u_to_À32
(

274 
BTCOEX_APMODE_A2DP_MAX_BLUETOOTH_TIME
);

276 
p•ﬁl_c⁄fig
->
a2dp_wœn_max_dur
 =

277 
BTCOEX_APMODE_A2DP_BDR_WLAN_MAX_DUR
;

278 
a2dp_c⁄fig
->
a2dp_Êags
 |
	`˝u_to_À32
(

279 
BTCOEX_APMODE_A2DP_BDR_MAX_BLUETOOTH_TIME
);

282 i‡(
¨
->
vîsi⁄
.
èrgë_vî
 =
AR6004_HW_1_3_VERSION
) {

283 
p•ﬁl_c⁄fig
->
a2dp_mö_bus_˙t
 = 
	`˝u_to_À32
(

284 
BTCOEX_APMODE_A2DP_MIN_BURST_CNT
);

289 
WMI_SET_BTCOEX_SCO_CONFIG_CMDID
:

291 
wmi_£t_btc€x_sco_c⁄fig_cmd
 *
cmd
 =

292 (
wmi_£t_btc€x_sco_c⁄fig_cmd
 *)
buf
;

293 
btc€x_sco_c⁄fig
 *
sco_c⁄fig
 = &
cmd
->sco_config;

294 i‡(
sco_c⁄fig
->
sco_Êags
 &

295 
WMI_SCO_CONFIG_FLAG_IS_EDR_CAPABLE
) {

297 
sco_c⁄fig
->
sco_Êags
 |
	`˝u_to_À32
(

298 
WMI_SCO_CONFIG_FLAG_DIS_SCANCONN_STOMP
);

304 
	}
}

306 
	$©h6kl_wmi_£nd_btc€x_cmd
(
©h6kl
 *
¨
,

307 
u8
 *
buf
, 
Àn
)

309 
sk_buff
 *
skb
;

310 
u32
 
∆_cmd
;

311 
wmi_cmd
;

312 
wmi
 *wmò
¨
->wmi;

314 
∆_cmd
 = *(
u32
 *)
buf
;

315 
buf
 +(
u32
);

316 
Àn
 -(
u32
);

317 
wmi_cmd
 = 
	`©h6kl_gë_wmi_cmd
(
∆_cmd
);

318 i‡(
wmi_cmd
 == 0)

319  -
ENOMEM
;

321 
skb
 = 
	`©h6kl_wmi_btc€x_gë_√w_buf
(
Àn
);

322 i‡(!
skb
)

323  -
ENOMEM
;

325 
	`©h6kl_btc€x_adju°_∑øms
(
¨
, 
wmi_cmd
, 
buf
);

327 
	`mem˝y
(
skb
->
d©a
, 
buf
, 
Àn
);

329  
	`©h6kl_wmi_cmd_£nd
(
wmi
, 0, 
skb
,

330 (
wmi_cmd_id
)
wmi_cmd
,

331 
NO_SYNC_WMIFLAG
);

332 
	}
}

	@wmi_btcoex.h

24 #i‚de‡
WMI_BTCOEX_H


25 
	#WMI_BTCOEX_H


	)

27 
	~<löux/õì80211.h
>

32 
	ewmi_btc€x_„_™t_ty≥
 {

33 
	mWMI_BTCOEX_NOT_ENABLED
 = 0,

34 
	mWMI_BTCOEX_FE_ANT_SINGLE
 = 1,

35 
	mWMI_BTCOEX_FE_ANT_DUAL
 = 2,

36 
	mWMI_BTCOEX_FE_ANT_DUAL_HIGH_ISO
 = 3,

37 
	mWMI_BTCOEX_FE_ANT_DUAL_SH_BT_LOW_ISO
 = 4,

38 
	mWMI_BTCOEX_FE_ANT_DUAL_SH_BT_HIGH_ISO
 = 5,

39 
	mWMI_BTCOEX_FE_ANT_TRIPLE
 = 6,

40 
	mWMI_BTCOEX_FE_ANT_TYPE_MAX


47 
	swmi_btc€x_bt_›_°©us_cmd
 {

48 
__À32
 
	m›_ty≥
;

49 
__À32
 
	m›_°©us
;

50 
__À32
 
	mlök_id
;

51 } 
	g__∑cked
;

57 
	sbtc€x_sco_c⁄fig
 {

58 
__À32
 
	msco_¶Ÿs
;

59 
__À32
 
	msco_idÀ_¶Ÿs
;

60 
__À32
 
	msco_Êags
;

61 
__À32
 
	mlök_id
;

62 } 
	g__∑cked
;

64 
	sbtc€x_p•ﬁl_mode_sco_c⁄fig
 {

65 
__À32
 
	msco_cy˛e_f‹˚_åiggî
;

66 
__À32
 
	msco_d©a_ªs_to
;

67 
__À32
 
	msco_°omp_duty_cy˛e_vÆ
;

68 
__À32
 
	msco_°omp_duty_cy˛e_max_vÆ
;

69 
__À32
 
	msco_p•ﬁl_œãncy_‰a˘i⁄
;

70 } 
	g__∑cked
;

72 
	sbtc€x_›tmode_sco_c⁄fig
 {

73 
__À32
 
	msco_°omp_˙t_ö_100ms
;

74 
__À32
 
	msco_c⁄t_°omp_˙t_max
;

75 
__À32
 
	msco_mö_low_øã_mbps
;

76 
__À32
 
	msco_low_øã_˙t
;

77 
__À32
 
	msco_hi_pkt_øtio
;

78 
__À32
 
	msco_max_aggr_size
;

79 
__À32
 
	msco_nuŒ_backoff
;

80 } 
	g__∑cked
;

82 
	sbtc€x_wœn_sco_c⁄fig
 {

83 
__À32
 
	msˇn_öãrvÆ
;

84 
__À32
 
	mmax_sˇn_°omp_˙t
;

85 } 
	g__∑cked
;

87 
	swmi_£t_btc€x_sco_c⁄fig_cmd
 {

88 
btc€x_sco_c⁄fig
 
	msco_c⁄fig
;

89 
btc€x_p•ﬁl_mode_sco_c⁄fig
 
	msco_p•ﬁl_c⁄fig
;

90 
btc€x_›tmode_sco_c⁄fig
 
	msco_›tmode_c⁄fig
;

91 
btc€x_wœn_sco_c⁄fig
 
	msco_wœn_c⁄fig
;

92 } 
	g__∑cked
;

97 
	sbtc€x_a2dp_c⁄fig
 {

98 
__À32
 
	ma2dp_Êags
;

99 
__À32
 
	mlök_id
;

100 } 
	g__∑cked
;

102 
	sbtc€x_p•ﬁl_a2dp_c⁄fig
 {

103 
__À32
 
	ma2dp_wœn_max_dur
;

104 
__À32
 
	ma2dp_mö_bus_˙t
;

105 
__À32
 
	ma2dp_d©a_ªs_to
;

107 } 
	g__∑cked
;

109 
	sbtc€x_a2dp_›tmode_c⁄fig
 {

110 
__À32
 
	ma2dp_mö_low_øã_mbps
;

111 
__À32
 
	ma2dp_low_øã_˙t
;

112 
__À32
 
	ma2dp_hi_pkt_øtio
;

113 
__À32
 
	ma2dp_max_aggr_size
;

114 
__À32
 
	ma2dp_pkt_°omp_˙t
;

115 } 
	g__∑cked
;

117 
	swmi_£t_btc€x_a2dp_c⁄fig_cmd
 {

118 
btc€x_a2dp_c⁄fig
 
	ma2dp_c⁄fig
;

119 
btc€x_p•ﬁl_a2dp_c⁄fig
 
	mp•ﬁl_c⁄fig
;

120 
btc€x_a2dp_›tmode_c⁄fig
 
	m›tmode_c⁄fig
;

121 } 
	g__∑cked
;

123 
	swmi_£t_btc€x_cﬁoˇãd_bt_dev_cmd
 {

124 
u8
 
	mcﬁoˇãd_bt_dev
;

125 } 
	g__∑cked
;

127 
	swmi_£t_btc€x_„_™ã¬a_cmd
 {

128 
u8
 
	m„_™ã¬a_ty≥
;

129 } 
	g__∑cked
;

131 
	sbtc€x_a˛_c⁄fig
 {

132 
__À32
 
	ma˛_wœn_medium_dur
;

133 
__À32
 
	ma˛_bt_medium_dur
;

134 
__À32
 
	ma˛_dëe˘_timeout
;

135 
__À32
 
	ma˛_pkt˙t_lowî_limô
;

136 
__À32
 
	ma˛_ôî_f‹_ídis
;

137 
__À32
 
	ma˛_pkt˙t_uµî_limô
;

138 
__À32
 
	ma˛_Êags
;

139 
__À32
 
	mlök_id
;

140 } 
	g__∑cked
;

142 
	sbtc€x_p•ﬁl_a˛_c⁄fig
 {

143 
__À32
 
	ma˛_d©a_ª•_timeout
;

144 } 
	g__∑cked
;

146 
	sbtc€x_›tmode_a˛_c⁄fig
 {

147 
__À32
 
	ma˛_mö_low_øã_mbps
;

148 
__À32
 
	ma˛_low_øã_˙t
;

149 
__À32
 
	ma˛_high_pkt_øtio
;

150 
__À32
 
	ma˛_max_aggr_size
;

151 
__À32
 
	ma˛_pkt_°omp_˙t
;

152 } 
	g__∑cked
;

154 
	swmi_£t_btc€x_a˛_c⁄fig_cmd
 {

155 
btc€x_a˛_c⁄fig
 
	ma˛_c⁄fig
;

156 
btc€x_p•ﬁl_a˛_c⁄fig
 
	ma˛_p•ﬁl_c⁄fig
;

157 
btc€x_›tmode_a˛_c⁄fig
 
	ma˛_›tmode_c⁄fig
;

158 } 
	g__∑cked
;

161 
©h6kl_wmi_£t_btc€x_bt_›_°©us
(
wmi
 *wmi, 
u8
 
›_id
, 
boﬁ
 
Êag
);

162 
©h6kl_wmi_£t_btc€x_sco_›
(
wmi
 *wmi, 
boﬁ
 
esco
, 
u32
 
tx_öãrvÆ
,

163 
u32
 
tx_pkt_Àn
);

164 
©h6kl_wmi_£t_btc€x_a2dp_›
(
wmi
 *wmi, 
u32
 
rﬁe
, u32 
vî
, u32 
ví
);

165 
©h6kl_wmi_£t_btc€x_£t_cﬁoˇãd_bt
(
wmi
 *wmi, 
u8
 
dev_ty≥
);

166 
©h6kl_wmi_£t_btc€x_£t_„_™ã¬a
(
wmi
 *wmi, 
u8
 
™ã¬a_ty≥
);

167 
©h6kl_wmi_£nd_btc€x_cmd
(
©h6kl
 *
¨
,

168 
u8
 *
buf
, 
Àn
);

	@/usr/include/asm/byteorder.h

1 #i‚de‡
_ASM_X86_BYTEORDER_H


2 
	#_ASM_X86_BYTEORDER_H


	)

4 
	~<löux/byã‹dî/lôée_ídün.h
>

	@/usr/include/linux/errno.h

1 #i‚de‡
_LINUX_ERRNO_H


2 
	#_LINUX_ERRNO_H


	)

4 
	~<asm/î∫o.h
>

	@/usr/include/linux/fs.h

1 #i‚de‡
_LINUX_FS_H


2 
	#_LINUX_FS_H


	)

9 
	~<löux/limôs.h
>

10 
	~<löux/io˘l.h
>

23 #unde‡
NR_OPEN


24 
	#INR_OPEN
 1024

	)

26 
	#BLOCK_SIZE_BITS
 10

	)

27 
	#BLOCK_SIZE
 (1<<
BLOCK_SIZE_BITS
)

	)

29 
	#SEEK_SET
 0

	)

30 
	#SEEK_CUR
 1

	)

31 
	#SEEK_END
 2

	)

32 
	#SEEK_MAX
 
SEEK_END


	)

35 
	sfûes_°©_°ru˘
 {

36 
	mƒ_fûes
;

37 
	mƒ_‰ì_fûes
;

38 
	mmax_fûes
;

41 
	söodes_°©_t
 {

42 
	mƒ_öodes
;

43 
	mƒ_unu£d
;

44 
	mdummy
[5];

48 
	#NR_FILE
 8192

	)

50 
	#MAY_EXEC
 1

	)

51 
	#MAY_WRITE
 2

	)

52 
	#MAY_READ
 4

	)

53 
	#MAY_APPEND
 8

	)

54 
	#MAY_ACCESS
 16

	)

55 
	#MAY_OPEN
 32

	)

63 
	#FMODE_READ
 ((
fmode_t
)1)

	)

65 
	#FMODE_WRITE
 ((
fmode_t
)2)

	)

67 
	#FMODE_LSEEK
 ((
fmode_t
)4)

	)

69 
	#FMODE_PREAD
 ((
fmode_t
)8)

	)

71 
	#FMODE_PWRITE
 ((
fmode_t
)16)

	)

73 
	#FMODE_EXEC
 ((
fmode_t
)32)

	)

75 
	#FMODE_NDELAY
 ((
fmode_t
)64)

	)

77 
	#FMODE_EXCL
 ((
fmode_t
)128)

	)

80 
	#FMODE_WRITE_IOCTL
 ((
fmode_t
)256)

	)

88 
	#FMODE_NOCMTIME
 ((
fmode_t
)2048)

	)

91 
	#FMODE_RANDOM
 ((
fmode_t
)4096)

	)

147 
	#RW_MASK
 1

	)

148 
	#RWA_MASK
 16

	)

149 
	#READ
 0

	)

150 
	#WRITE
 1

	)

151 
	#READA
 16

	)

152 
	#SWRITE
 17

	)

153 
	#READ_SYNC
 (
READ
 | (1 << 
BIO_RW_SYNCIO
Ë| (1 << 
BIO_RW_UNPLUG
))

	)

154 
	#READ_META
 (
READ
 | (1 << 
BIO_RW_META
))

	)

155 
	#WRITE_SYNC_PLUG
 (
WRITE
 | (1 << 
BIO_RW_SYNCIO
Ë| (1 << 
BIO_RW_NOIDLE
))

	)

156 
	#WRITE_SYNC
 (
WRITE_SYNC_PLUG
 | (1 << 
BIO_RW_UNPLUG
))

	)

157 
	#WRITE_ODIRECT
 (
WRITE
 | (1 << 
BIO_RW_SYNCIO
Ë| (1 << 
BIO_RW_UNPLUG
))

	)

158 
	#SWRITE_SYNC_PLUG
 \

159 (
SWRITE
 | (1 << 
BIO_RW_SYNCIO
Ë| (1 << 
BIO_RW_NOIDLE
))

	)

160 
	#SWRITE_SYNC
 (
SWRITE_SYNC_PLUG
 | (1 << 
BIO_RW_UNPLUG
))

	)

161 
	#WRITE_BARRIER
 (
WRITE
 | (1 << 
BIO_RW_BARRIER
))

	)

167 
	#DISCARD_NOBARRIER
 (
WRITE
 | (1 << 
BIO_RW_DISCARD
))

	)

168 
	#DISCARD_BARRIER
 (
DISCARD_NOBARRIER
 | (1 << 
BIO_RW_BARRIER
))

	)

170 
	#SEL_IN
 1

	)

171 
	#SEL_OUT
 2

	)

172 
	#SEL_EX
 4

	)

175 
	#FS_REQUIRES_DEV
 1

	)

176 
	#FS_BINARY_MOUNTDATA
 2

	)

177 
	#FS_HAS_SUBTYPE
 4

	)

178 
	#FS_REVAL_DOT
 16384

	)

179 
	#FS_RENAME_DOES_D_MOVE
 32768

	)

186 
	#MS_RDONLY
 1

	)

187 
	#MS_NOSUID
 2

	)

188 
	#MS_NODEV
 4

	)

189 
	#MS_NOEXEC
 8

	)

190 
	#MS_SYNCHRONOUS
 16

	)

191 
	#MS_REMOUNT
 32

	)

192 
	#MS_MANDLOCK
 64

	)

193 
	#MS_DIRSYNC
 128

	)

194 
	#MS_NOATIME
 1024

	)

195 
	#MS_NODIRATIME
 2048

	)

196 
	#MS_BIND
 4096

	)

197 
	#MS_MOVE
 8192

	)

198 
	#MS_REC
 16384

	)

199 
	#MS_VERBOSE
 32768

	)

201 
	#MS_SILENT
 32768

	)

202 
	#MS_POSIXACL
 (1<<16Ë

	)

203 
	#MS_UNBINDABLE
 (1<<17Ë

	)

204 
	#MS_PRIVATE
 (1<<18Ë

	)

205 
	#MS_SLAVE
 (1<<19Ë

	)

206 
	#MS_SHARED
 (1<<20Ë

	)

207 
	#MS_RELATIME
 (1<<21Ë

	)

208 
	#MS_KERNMOUNT
 (1<<22Ë

	)

209 
	#MS_I_VERSION
 (1<<23Ë

	)

210 
	#MS_STRICTATIME
 (1<<24Ë

	)

211 
	#MS_ACTIVE
 (1<<30)

	)

212 
	#MS_NOUSER
 (1<<31)

	)

217 
	#MS_RMT_MASK
 (
MS_RDONLY
|
MS_SYNCHRONOUS
|
MS_MANDLOCK
|
MS_I_VERSION
)

	)

222 
	#MS_MGC_VAL
 0xC0ED0000

	)

223 
	#MS_MGC_MSK
 0xffff0000

	)

227 
	#S_SYNC
 1

	)

228 
	#S_NOATIME
 2

	)

229 
	#S_APPEND
 4

	)

230 
	#S_IMMUTABLE
 8

	)

231 
	#S_DEAD
 16

	)

232 
	#S_NOQUOTA
 32

	)

233 
	#S_DIRSYNC
 64

	)

234 
	#S_NOCMTIME
 128

	)

235 
	#S_SWAPFILE
 256

	)

236 
	#S_PRIVATE
 512

	)

251 
	#__IS_FLG
(
öode
,
Êg
Ë((öode)->
i_sb
->
s_Êags
 & (Êg))

	)

253 
	#IS_RDONLY
(
öode
Ë((öode)->
i_sb
->
s_Êags
 & 
MS_RDONLY
)

	)

254 
	#IS_SYNC
(
öode
Ë(
	`__IS_FLG
(öode, 
MS_SYNCHRONOUS
) || \

255 ((
öode
)->
i_Êags
 & 
S_SYNC
))

	)

256 
	#IS_DIRSYNC
(
öode
Ë(
	`__IS_FLG
(öode, 
MS_SYNCHRONOUS
|
MS_DIRSYNC
) || \

257 ((
öode
)->
i_Êags
 & (
S_SYNC
|
S_DIRSYNC
)))

	)

258 
	#IS_MANDLOCK
(
öode
Ë
	`__IS_FLG
(öode, 
MS_MANDLOCK
)

	)

259 
	#IS_NOATIME
(
öode
Ë
	`__IS_FLG
(öode, 
MS_RDONLY
|
MS_NOATIME
)

	)

260 
	#IS_I_VERSION
(
öode
Ë
	`__IS_FLG
(öode, 
MS_I_VERSION
)

	)

262 
	#IS_NOQUOTA
(
öode
Ë((öode)->
i_Êags
 & 
S_NOQUOTA
)

	)

263 
	#IS_APPEND
(
öode
Ë((öode)->
i_Êags
 & 
S_APPEND
)

	)

264 
	#IS_IMMUTABLE
(
öode
Ë((öode)->
i_Êags
 & 
S_IMMUTABLE
)

	)

265 
	#IS_POSIXACL
(
öode
Ë
	`__IS_FLG
(öode, 
MS_POSIXACL
)

	)

267 
	#IS_DEADDIR
(
öode
Ë((öode)->
i_Êags
 & 
S_DEAD
)

	)

268 
	#IS_NOCMTIME
(
öode
Ë((öode)->
i_Êags
 & 
S_NOCMTIME
)

	)

269 
	#IS_SWAPFILE
(
öode
Ë((öode)->
i_Êags
 & 
S_SWAPFILE
)

	)

270 
	#IS_PRIVATE
(
öode
Ë((öode)->
i_Êags
 & 
S_PRIVATE
)

	)

275 
	#BLKROSET
 
	`_IO
(0x12,93Ë

	)

276 
	#BLKROGET
 
	`_IO
(0x12,94Ë

	)

277 
	#BLKRRPART
 
	`_IO
(0x12,95Ë

	)

278 
	#BLKGETSIZE
 
	`_IO
(0x12,96Ë

	)

279 
	#BLKFLSBUF
 
	`_IO
(0x12,97Ë

	)

280 
	#BLKRASET
 
	`_IO
(0x12,98Ë

	)

281 
	#BLKRAGET
 
	`_IO
(0x12,99Ë

	)

282 
	#BLKFRASET
 
	`_IO
(0x12,100)

	)

283 
	#BLKFRAGET
 
	`_IO
(0x12,101)

	)

284 
	#BLKSECTSET
 
	`_IO
(0x12,102)

	)

285 
	#BLKSECTGET
 
	`_IO
(0x12,103)

	)

286 
	#BLKSSZGET
 
	`_IO
(0x12,104)

	)

288 
	#BLKPG
 
	`_IO
(0x12,105)

	)

292 
	#BLKELVGET
 
	`_IOR
(0x12,106,
size_t
)

	)

293 
	#BLKELVSET
 
	`_IOW
(0x12,107,
size_t
)

	)

298 
	#BLKBSZGET
 
	`_IOR
(0x12,112,
size_t
)

	)

299 
	#BLKBSZSET
 
	`_IOW
(0x12,113,
size_t
)

	)

300 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
Ë

	)

301 
	#BLKTRACESETUP
 
	`_IOWR
(0x12,115,
blk_u£r_åa˚_£tup
)

	)

302 
	#BLKTRACESTART
 
	`_IO
(0x12,116)

	)

303 
	#BLKTRACESTOP
 
	`_IO
(0x12,117)

	)

304 
	#BLKTRACETEARDOWN
 
	`_IO
(0x12,118)

	)

305 
	#BLKDISCARD
 
	`_IO
(0x12,119)

	)

306 
	#BLKIOMIN
 
	`_IO
(0x12,120)

	)

307 
	#BLKIOOPT
 
	`_IO
(0x12,121)

	)

308 
	#BLKALIGNOFF
 
	`_IO
(0x12,122)

	)

309 
	#BLKPBSZGET
 
	`_IO
(0x12,123)

	)

311 
	#BMAP_IOCTL
 1

	)

312 
	#FIBMAP
 
	`_IO
(0x00,1Ë

	)

313 
	#FIGETBSZ
 
	`_IO
(0x00,2Ë

	)

314 
	#FIFREEZE
 
	`_IOWR
('X', 119, Ë

	)

315 
	#FITHAW
 
	`_IOWR
('X', 120, Ë

	)

317 
	#FS_IOC_GETFLAGS
 
	`_IOR
('f', 1, )

	)

318 
	#FS_IOC_SETFLAGS
 
	`_IOW
('f', 2, )

	)

319 
	#FS_IOC_GETVERSION
 
	`_IOR
('v', 1, )

	)

320 
	#FS_IOC_SETVERSION
 
	`_IOW
('v', 2, )

	)

321 
	#FS_IOC_FIEMAP
 
	`_IOWR
('f', 11, 
fõm≠
)

	)

322 
	#FS_IOC32_GETFLAGS
 
	`_IOR
('f', 1, )

	)

323 
	#FS_IOC32_SETFLAGS
 
	`_IOW
('f', 2, )

	)

324 
	#FS_IOC32_GETVERSION
 
	`_IOR
('v', 1, )

	)

325 
	#FS_IOC32_SETVERSION
 
	`_IOW
('v', 2, )

	)

330 
	#FS_SECRM_FL
 0x00000001

	)

331 
	#FS_UNRM_FL
 0x00000002

	)

332 
	#FS_COMPR_FL
 0x00000004

	)

333 
	#FS_SYNC_FL
 0x00000008

	)

334 
	#FS_IMMUTABLE_FL
 0x00000010

	)

335 
	#FS_APPEND_FL
 0x00000020

	)

336 
	#FS_NODUMP_FL
 0x00000040

	)

337 
	#FS_NOATIME_FL
 0x00000080

	)

339 
	#FS_DIRTY_FL
 0x00000100

	)

340 
	#FS_COMPRBLK_FL
 0x00000200

	)

341 
	#FS_NOCOMP_FL
 0x00000400

	)

342 
	#FS_ECOMPR_FL
 0x00000800

	)

344 
	#FS_BTREE_FL
 0x00001000

	)

345 
	#FS_INDEX_FL
 0x00001000

	)

346 
	#FS_IMAGIC_FL
 0x00002000

	)

347 
	#FS_JOURNAL_DATA_FL
 0x00004000

	)

348 
	#FS_NOTAIL_FL
 0x00008000

	)

349 
	#FS_DIRSYNC_FL
 0x00010000

	)

350 
	#FS_TOPDIR_FL
 0x00020000

	)

351 
	#FS_EXTENT_FL
 0x00080000

	)

352 
	#FS_DIRECTIO_FL
 0x00100000

	)

353 
	#FS_RESERVED_FL
 0x80000000

	)

355 
	#FS_FL_USER_VISIBLE
 0x0003DFFF

	)

356 
	#FS_FL_USER_MODIFIABLE
 0x000380FF

	)

359 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

360 
	#SYNC_FILE_RANGE_WRITE
 2

	)

361 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

	@/usr/include/linux/if.h

19 #i‚de‡
_LINUX_IF_H


20 
	#_LINUX_IF_H


	)

22 
	~<löux/ty≥s.h
>

23 
	~<löux/sockë.h
>

26 
	#IFNAMSIZ
 16

	)

27 
	#IFALIASZ
 256

	)

28 
	~<löux/hdlc/io˘l.h
>

31 
	#IFF_UP
 0x1

	)

32 
	#IFF_BROADCAST
 0x2

	)

33 
	#IFF_DEBUG
 0x4

	)

34 
	#IFF_LOOPBACK
 0x8

	)

35 
	#IFF_POINTOPOINT
 0x10

	)

36 
	#IFF_NOTRAILERS
 0x20

	)

37 
	#IFF_RUNNING
 0x40

	)

38 
	#IFF_NOARP
 0x80

	)

39 
	#IFF_PROMISC
 0x100

	)

40 
	#IFF_ALLMULTI
 0x200

	)

42 
	#IFF_MASTER
 0x400

	)

43 
	#IFF_SLAVE
 0x800

	)

45 
	#IFF_MULTICAST
 0x1000

	)

47 
	#IFF_PORTSEL
 0x2000

	)

48 
	#IFF_AUTOMEDIA
 0x4000

	)

49 
	#IFF_DYNAMIC
 0x8000

	)

51 
	#IFF_LOWER_UP
 0x10000

	)

52 
	#IFF_DORMANT
 0x20000

	)

54 
	#IFF_ECHO
 0x40000

	)

56 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|
IFF_ECHO
|\

57 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

60 
	#IFF_802_1Q_VLAN
 0x1

	)

61 
	#IFF_EBRIDGE
 0x2

	)

62 
	#IFF_SLAVE_INACTIVE
 0x4

	)

63 
	#IFF_MASTER_8023AD
 0x8

	)

64 
	#IFF_MASTER_ALB
 0x10

	)

65 
	#IFF_BONDING
 0x20

	)

66 
	#IFF_SLAVE_NEEDARP
 0x40

	)

67 
	#IFF_ISATAP
 0x80

	)

68 
	#IFF_MASTER_ARPMON
 0x100

	)

69 
	#IFF_WAN_HDLC
 0x200

	)

70 
	#IFF_XMIT_DST_RELEASE
 0x400

	)

74 
	#IF_GET_IFACE
 0x0001

	)

75 
	#IF_GET_PROTO
 0x0002

	)

78 
	#IF_IFACE_V35
 0x1000

	)

79 
	#IF_IFACE_V24
 0x1001

	)

80 
	#IF_IFACE_X21
 0x1002

	)

81 
	#IF_IFACE_T1
 0x1003

	)

82 
	#IF_IFACE_E1
 0x1004

	)

83 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

84 
	#IF_IFACE_X21D
 0x1006

	)

87 
	#IF_PROTO_HDLC
 0x2000

	)

88 
	#IF_PROTO_PPP
 0x2001

	)

89 
	#IF_PROTO_CISCO
 0x2002

	)

90 
	#IF_PROTO_FR
 0x2003

	)

91 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

92 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

93 
	#IF_PROTO_X25
 0x2006

	)

94 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

95 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

96 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

97 
	#IF_PROTO_FR_PVC
 0x200A

	)

98 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

99 
	#IF_PROTO_RAW
 0x200C

	)

103 
	mIF_OPER_UNKNOWN
,

104 
	mIF_OPER_NOTPRESENT
,

105 
	mIF_OPER_DOWN
,

106 
	mIF_OPER_LOWERLAYERDOWN
,

107 
	mIF_OPER_TESTING
,

108 
	mIF_OPER_DORMANT
,

109 
	mIF_OPER_UP
,

114 
	mIF_LINK_MODE_DEFAULT
,

115 
	mIF_LINK_MODE_DORMANT
,

128 
	sifm≠


130 
	mmem_°¨t
;

131 
	mmem_íd
;

132 
	mba£_addr
;

133 
	múq
;

134 
	mdma
;

135 
	mp‹t
;

139 
	sif_£âögs


141 
	mty≥
;

142 
	msize
;

145 
øw_hdlc_¥Ÿo
 *
	møw_hdlc
;

146 
cisco_¥Ÿo
 *
	mcisco
;

147 
‰_¥Ÿo
 *
	m‰
;

148 
‰_¥Ÿo_pvc
 *
	m‰_pvc
;

149 
‰_¥Ÿo_pvc_öfo
 *
	m‰_pvc_öfo
;

152 
sync_£rül_£âögs
 *
	msync
;

153 
ã1_£âögs
 *
	mã1
;

154 } 
	mifs_ifsu
;

164 
	si‰eq


166 
	#IFHWADDRLEN
 6

	)

169 
	mi‰n_«me
[
IFNAMSIZ
];

170 } 
	mi‰_i‰n
;

173 
sockaddr
 
	mi‰u_addr
;

174 
sockaddr
 
	mi‰u_d°addr
;

175 
sockaddr
 
	mi‰u_brﬂdaddr
;

176 
sockaddr
 
	mi‰u_√tmask
;

177 
sockaddr
 
	mi‰u_hwaddr
;

178 
	mi‰u_Êags
;

179 
	mi‰u_ivÆue
;

180 
	mi‰u_mtu
;

181 
ifm≠
 
	mi‰u_m≠
;

182 
	mi‰u_¶ave
[
IFNAMSIZ
];

183 
	mi‰u_√w«me
[
IFNAMSIZ
];

184 * 
	mi‰u_d©a
;

185 
if_£âögs
 
	mi‰u_£âögs
;

186 } 
	mi‰_i‰u
;

189 
	#i‰_«me
 
i‰_i‰n
.
i‰n_«me


	)

190 
	#i‰_hwaddr
 
i‰_i‰u
.
i‰u_hwaddr


	)

191 
	#i‰_addr
 
i‰_i‰u
.
i‰u_addr


	)

192 
	#i‰_d°addr
 
i‰_i‰u
.
i‰u_d°addr


	)

193 
	#i‰_brﬂdaddr
 
i‰_i‰u
.
i‰u_brﬂdaddr


	)

194 
	#i‰_√tmask
 
i‰_i‰u
.
i‰u_√tmask


	)

195 
	#i‰_Êags
 
i‰_i‰u
.
i‰u_Êags


	)

196 
	#i‰_mëric
 
i‰_i‰u
.
i‰u_ivÆue


	)

197 
	#i‰_mtu
 
i‰_i‰u
.
i‰u_mtu


	)

198 
	#i‰_m≠
 
i‰_i‰u
.
i‰u_m≠


	)

199 
	#i‰_¶ave
 
i‰_i‰u
.
i‰u_¶ave


	)

200 
	#i‰_d©a
 
i‰_i‰u
.
i‰u_d©a


	)

201 
	#i‰_ifödex
 
i‰_i‰u
.
i‰u_ivÆue


	)

202 
	#i‰_b™dwidth
 
i‰_i‰u
.
i‰u_ivÆue


	)

203 
	#i‰_qÀn
 
i‰_i‰u
.
i‰u_ivÆue


	)

204 
	#i‰_√w«me
 
i‰_i‰u
.
i‰u_√w«me


	)

205 
	#i‰_£âögs
 
i‰_i‰u
.
i‰u_£âögs


	)

214 
	sifc⁄f


216 
	mifc_Àn
;

219 *
	mifcu_buf
;

220 
i‰eq
 *
	mifcu_ªq
;

221 } 
	mifc_ifcu
;

223 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

224 
	#ifc_ªq
 
ifc_ifcu
.
ifcu_ªq


	)

	@/usr/include/linux/ip.h

17 #i‚de‡
_LINUX_IP_H


18 
	#_LINUX_IP_H


	)

19 
	~<löux/ty≥s.h
>

20 
	~<asm/byã‹dî.h
>

22 
	#IPTOS_TOS_MASK
 0x1E

	)

23 
	#IPTOS_TOS
(
tos
Ë(—os)&
IPTOS_TOS_MASK
)

	)

24 
	#IPTOS_LOWDELAY
 0x10

	)

25 
	#IPTOS_THROUGHPUT
 0x08

	)

26 
	#IPTOS_RELIABILITY
 0x04

	)

27 
	#IPTOS_MINCOST
 0x02

	)

29 
	#IPTOS_PREC_MASK
 0xE0

	)

30 
	#IPTOS_PREC
(
tos
Ë(—os)&
IPTOS_PREC_MASK
)

	)

31 
	#IPTOS_PREC_NETCONTROL
 0xe0

	)

32 
	#IPTOS_PREC_INTERNETCONTROL
 0xc0

	)

33 
	#IPTOS_PREC_CRITIC_ECP
 0xa0

	)

34 
	#IPTOS_PREC_FLASHOVERRIDE
 0x80

	)

35 
	#IPTOS_PREC_FLASH
 0x60

	)

36 
	#IPTOS_PREC_IMMEDIATE
 0x40

	)

37 
	#IPTOS_PREC_PRIORITY
 0x20

	)

38 
	#IPTOS_PREC_ROUTINE
 0x00

	)

42 
	#IPOPT_COPY
 0x80

	)

43 
	#IPOPT_CLASS_MASK
 0x60

	)

44 
	#IPOPT_NUMBER_MASK
 0x1f

	)

46 
	#IPOPT_COPIED
(
o
Ë((o)&
IPOPT_COPY
)

	)

47 
	#IPOPT_CLASS
(
o
Ë((o)&
IPOPT_CLASS_MASK
)

	)

48 
	#IPOPT_NUMBER
(
o
Ë((o)&
IPOPT_NUMBER_MASK
)

	)

50 
	#IPOPT_CONTROL
 0x00

	)

51 
	#IPOPT_RESERVED1
 0x20

	)

52 
	#IPOPT_MEASUREMENT
 0x40

	)

53 
	#IPOPT_RESERVED2
 0x60

	)

55 
	#IPOPT_END
 (0 |
IPOPT_CONTROL
)

	)

56 
	#IPOPT_NOOP
 (1 |
IPOPT_CONTROL
)

	)

57 
	#IPOPT_SEC
 (2 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

58 
	#IPOPT_LSRR
 (3 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

59 
	#IPOPT_TIMESTAMP
 (4 |
IPOPT_MEASUREMENT
)

	)

60 
	#IPOPT_CIPSO
 (6 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

61 
	#IPOPT_RR
 (7 |
IPOPT_CONTROL
)

	)

62 
	#IPOPT_SID
 (8 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

63 
	#IPOPT_SSRR
 (9 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

64 
	#IPOPT_RA
 (20|
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

66 
	#IPVERSION
 4

	)

67 
	#MAXTTL
 255

	)

68 
	#IPDEFTTL
 64

	)

70 
	#IPOPT_OPTVAL
 0

	)

71 
	#IPOPT_OLEN
 1

	)

72 
	#IPOPT_OFFSET
 2

	)

73 
	#IPOPT_MINOFF
 4

	)

74 
	#MAX_IPOPTLEN
 40

	)

75 
	#IPOPT_NOP
 
IPOPT_NOOP


	)

76 
	#IPOPT_EOL
 
IPOPT_END


	)

77 
	#IPOPT_TS
 
IPOPT_TIMESTAMP


	)

79 
	#IPOPT_TS_TSONLY
 0

	)

80 
	#IPOPT_TS_TSANDADDR
 1

	)

81 
	#IPOPT_TS_PRESPEC
 3

	)

83 
	#IPV4_BEET_PHMAXLEN
 8

	)

85 
	sùhdr
 {

86 #i‡
deföed
(
__LITTLE_ENDIAN_BITFIELD
)

87 
__u8
 
	mihl
:4,

88 
	mvîsi⁄
:4;

89 #ñi‡
deföed
 (
__BIG_ENDIAN_BITFIELD
)

90 
__u8
 
	mvîsi⁄
:4,

91 
	mihl
:4;

95 
__u8
 
	mtos
;

96 
__be16
 
	mtŸ_Àn
;

97 
__be16
 
	mid
;

98 
__be16
 
	m‰ag_off
;

99 
__u8
 
	mâl
;

100 
__u8
 
	m¥Ÿocﬁ
;

101 
__sum16
 
	mcheck
;

102 
__be32
 
	mßddr
;

103 
__be32
 
	mdaddr
;

108 
	sù_auth_hdr
 {

109 
__u8
 
	m√xthdr
;

110 
__u8
 
	mhdæí
;

111 
__be16
 
	mª£rved
;

112 
__be32
 
	m•i
;

113 
__be32
 
	m£q_no
;

114 
__u8
 
	mauth_d©a
[0];

117 
	sù_e•_hdr
 {

118 
__be32
 
	m•i
;

119 
__be32
 
	m£q_no
;

120 
__u8
 
	míc_d©a
[0];

123 
	sù_comp_hdr
 {

124 
__u8
 
	m√xthdr
;

125 
__u8
 
	mÊags
;

126 
__be16
 
	m˝i
;

129 
	sù_bìt_phdr
 {

130 
__u8
 
	m√xthdr
;

131 
__u8
 
	mhdæí
;

132 
__u8
 
	m∑dÀn
;

133 
__u8
 
	mª£rved
;

	@/usr/include/linux/netdevice.h

25 #i‚de‡
_LINUX_NETDEVICE_H


26 
	#_LINUX_NETDEVICE_H


	)

28 
	~<löux/if.h
>

29 
	~<löux/if_ëhî.h
>

30 
	~<löux/if_∑ckë.h
>

33 
	#MAX_ADDR_LEN
 32

	)

41 
	s√t_devi˚_°©s


43 
	mrx_∑ckës
;

44 
	mtx_∑ckës
;

45 
	mrx_byãs
;

46 
	mtx_byãs
;

47 
	mrx_îr‹s
;

48 
	mtx_îr‹s
;

49 
	mrx_dr›≥d
;

50 
	mtx_dr›≥d
;

51 
	mmu…iˇ°
;

52 
	mcﬁlisi⁄s
;

55 
	mrx_Àngth_îr‹s
;

56 
	mrx_ovî_îr‹s
;

57 
	mrx_¸c_îr‹s
;

58 
	mrx_‰ame_îr‹s
;

59 
	mrx_fifo_îr‹s
;

60 
	mrx_mis£d_îr‹s
;

63 
	mtx_ab‹ãd_îr‹s
;

64 
	mtx_ˇºõr_îr‹s
;

65 
	mtx_fifo_îr‹s
;

66 
	mtx_hóπbót_îr‹s
;

67 
	mtx_wödow_îr‹s
;

70 
	mrx_com¥es£d
;

71 
	mtx_com¥es£d
;

77 
	mIF_PORT_UNKNOWN
 = 0,

78 
	mIF_PORT_10BASE2
,

79 
	mIF_PORT_10BASET
,

80 
	mIF_PORT_AUI
,

81 
	mIF_PORT_100BASET
,

82 
	mIF_PORT_100BASETX
,

83 
	mIF_PORT_100BASEFX


	@/usr/include/linux/netlink.h

1 #i‚de‡
__LINUX_NETLINK_H


2 
	#__LINUX_NETLINK_H


	)

4 
	~<löux/sockë.h
>

5 
	~<löux/ty≥s.h
>

7 
	#NETLINK_ROUTE
 0

	)

8 
	#NETLINK_UNUSED
 1

	)

9 
	#NETLINK_USERSOCK
 2

	)

10 
	#NETLINK_FIREWALL
 3

	)

11 
	#NETLINK_INET_DIAG
 4

	)

12 
	#NETLINK_NFLOG
 5

	)

13 
	#NETLINK_XFRM
 6

	)

14 
	#NETLINK_SELINUX
 7

	)

15 
	#NETLINK_ISCSI
 8

	)

16 
	#NETLINK_AUDIT
 9

	)

17 
	#NETLINK_FIB_LOOKUP
 10

	)

18 
	#NETLINK_CONNECTOR
 11

	)

19 
	#NETLINK_NETFILTER
 12

	)

20 
	#NETLINK_IP6_FW
 13

	)

21 
	#NETLINK_DNRTMSG
 14

	)

22 
	#NETLINK_KOBJECT_UEVENT
 15

	)

23 
	#NETLINK_GENERIC
 16

	)

25 
	#NETLINK_SCSITRANSPORT
 18

	)

26 
	#NETLINK_ECRYPTFS
 19

	)

28 
	#MAX_LINKS
 32

	)

30 
	g√t
;

32 
	ssockaddr_∆


34 
ß_Ámûy_t
 
	m∆_Ámûy
;

35 
	m∆_∑d
;

36 
__u32
 
	m∆_pid
;

37 
__u32
 
	m∆_groups
;

40 
	s∆msghdr


42 
__u32
 
	m∆msg_Àn
;

43 
__u16
 
	m∆msg_ty≥
;

44 
__u16
 
	m∆msg_Êags
;

45 
__u32
 
	m∆msg_£q
;

46 
__u32
 
	m∆msg_pid
;

51 
	#NLM_F_REQUEST
 1

	)

52 
	#NLM_F_MULTI
 2

	)

53 
	#NLM_F_ACK
 4

	)

54 
	#NLM_F_ECHO
 8

	)

57 
	#NLM_F_ROOT
 0x100

	)

58 
	#NLM_F_MATCH
 0x200

	)

59 
	#NLM_F_ATOMIC
 0x400

	)

60 
	#NLM_F_DUMP
 (
NLM_F_ROOT
|
NLM_F_MATCH
)

	)

63 
	#NLM_F_REPLACE
 0x100

	)

64 
	#NLM_F_EXCL
 0x200

	)

65 
	#NLM_F_CREATE
 0x400

	)

66 
	#NLM_F_APPEND
 0x800

	)

77 
	#NLMSG_ALIGNTO
 4

	)

78 
	#NLMSG_ALIGN
(
Àn
Ë–(÷í)+
NLMSG_ALIGNTO
-1Ë& ~(NLMSG_ALIGNTO-1Ë)

	)

79 
	#NLMSG_HDRLEN
 ((Ë
	`NLMSG_ALIGN
((
∆msghdr
)))

	)

80 
	#NLMSG_LENGTH
(
Àn
Ë(÷í)+
	`NLMSG_ALIGN
(
NLMSG_HDRLEN
))

	)

81 
	#NLMSG_SPACE
(
Àn
Ë
	`NLMSG_ALIGN
(
	`NLMSG_LENGTH
÷í))

	)

82 
	#NLMSG_DATA
(
∆h
Ë((*)(((*ÍlhË+ 
	`NLMSG_LENGTH
(0)))

	)

83 
	#NLMSG_NEXT
(
∆h
,
Àn
Ë(÷íË-
	`NLMSG_ALIGN
(“lh)->
∆msg_Àn
), \

84 (
∆msghdr
*)(((*)(
∆h
)Ë+ 
	`NLMSG_ALIGN
(“lh)->
∆msg_Àn
)))

	)

85 
	#NLMSG_OK
(
∆h
,
Àn
Ë(÷íË>()(
∆msghdr
) && \

86 (
∆h
)->
∆msg_Àn
 >(
∆msghdr
) && \

87 (
∆h
)->
∆msg_Àn
 <(
Àn
))

	)

88 
	#NLMSG_PAYLOAD
(
∆h
,
Àn
Ë(“lh)->
∆msg_Àn
 - 
	`NLMSG_SPACE
(÷í)))

	)

90 
	#NLMSG_NOOP
 0x1

	)

91 
	#NLMSG_ERROR
 0x2

	)

92 
	#NLMSG_DONE
 0x3

	)

93 
	#NLMSG_OVERRUN
 0x4

	)

95 
	#NLMSG_MIN_TYPE
 0x10

	)

97 
	s∆msgîr


99 
	mîr‹
;

100 
∆msghdr
 
	mmsg
;

103 
	#NETLINK_ADD_MEMBERSHIP
 1

	)

104 
	#NETLINK_DROP_MEMBERSHIP
 2

	)

105 
	#NETLINK_PKTINFO
 3

	)

106 
	#NETLINK_BROADCAST_ERROR
 4

	)

107 
	#NETLINK_NO_ENOBUFS
 5

	)

109 
	s∆_pktöfo


111 
__u32
 
	mgroup
;

114 
	#NET_MAJOR
 36

	)

117 
	mNETLINK_UNCONNECTED
 = 0,

118 
	mNETLINK_CONNECTED
,

130 
	s∆©å


132 
__u16
 
	m∆a_Àn
;

133 
__u16
 
	m∆a_ty≥
;

146 
	#NLA_F_NESTED
 (1 << 15)

	)

147 
	#NLA_F_NET_BYTEORDER
 (1 << 14)

	)

148 
	#NLA_TYPE_MASK
 ~(
NLA_F_NESTED
 | 
NLA_F_NET_BYTEORDER
)

	)

150 
	#NLA_ALIGNTO
 4

	)

151 
	#NLA_ALIGN
(
Àn
Ë((÷íË+ 
NLA_ALIGNTO
 - 1Ë& ~(NLA_ALIGNTO - 1))

	)

152 
	#NLA_HDRLEN
 ((Ë
	`NLA_ALIGN
((
∆©å
)))

	)

	@/usr/include/linux/nl80211.h

1 #i‚de‡
__LINUX_NL80211_H


2 
	#__LINUX_NL80211_H


	)

28 
	~<löux/ty≥s.h
>

271 
	e∆80211_comm™ds
 {

273 
	mNL80211_CMD_UNSPEC
,

275 
	mNL80211_CMD_GET_WIPHY
,

276 
	mNL80211_CMD_SET_WIPHY
,

277 
	mNL80211_CMD_NEW_WIPHY
,

278 
	mNL80211_CMD_DEL_WIPHY
,

280 
	mNL80211_CMD_GET_INTERFACE
,

281 
	mNL80211_CMD_SET_INTERFACE
,

282 
	mNL80211_CMD_NEW_INTERFACE
,

283 
	mNL80211_CMD_DEL_INTERFACE
,

285 
	mNL80211_CMD_GET_KEY
,

286 
	mNL80211_CMD_SET_KEY
,

287 
	mNL80211_CMD_NEW_KEY
,

288 
	mNL80211_CMD_DEL_KEY
,

290 
	mNL80211_CMD_GET_BEACON
,

291 
	mNL80211_CMD_SET_BEACON
,

292 
	mNL80211_CMD_NEW_BEACON
,

293 
	mNL80211_CMD_DEL_BEACON
,

295 
	mNL80211_CMD_GET_STATION
,

296 
	mNL80211_CMD_SET_STATION
,

297 
	mNL80211_CMD_NEW_STATION
,

298 
	mNL80211_CMD_DEL_STATION
,

300 
	mNL80211_CMD_GET_MPATH
,

301 
	mNL80211_CMD_SET_MPATH
,

302 
	mNL80211_CMD_NEW_MPATH
,

303 
	mNL80211_CMD_DEL_MPATH
,

305 
	mNL80211_CMD_SET_BSS
,

307 
	mNL80211_CMD_SET_REG
,

308 
	mNL80211_CMD_REQ_SET_REG
,

310 
	mNL80211_CMD_GET_MESH_PARAMS
,

311 
	mNL80211_CMD_SET_MESH_PARAMS
,

313 
	mNL80211_CMD_SET_MGMT_EXTRA_IE
 ,

315 
	mNL80211_CMD_GET_REG
,

317 
	mNL80211_CMD_GET_SCAN
,

318 
	mNL80211_CMD_TRIGGER_SCAN
,

319 
	mNL80211_CMD_NEW_SCAN_RESULTS
,

320 
	mNL80211_CMD_SCAN_ABORTED
,

322 
	mNL80211_CMD_REG_CHANGE
,

324 
	mNL80211_CMD_AUTHENTICATE
,

325 
	mNL80211_CMD_ASSOCIATE
,

326 
	mNL80211_CMD_DEAUTHENTICATE
,

327 
	mNL80211_CMD_DISASSOCIATE
,

329 
	mNL80211_CMD_MICHAEL_MIC_FAILURE
,

331 
	mNL80211_CMD_REG_BEACON_HINT
,

333 
	mNL80211_CMD_JOIN_IBSS
,

334 
	mNL80211_CMD_LEAVE_IBSS
,

336 
	mNL80211_CMD_TESTMODE
,

338 
	mNL80211_CMD_CONNECT
,

339 
	mNL80211_CMD_ROAM
,

340 
	mNL80211_CMD_DISCONNECT
,

342 
	mNL80211_CMD_SET_WIPHY_NETNS
,

347 
	m__NL80211_CMD_AFTER_LAST
,

348 
	mNL80211_CMD_MAX
 = 
__NL80211_CMD_AFTER_LAST
 - 1

355 
	#NL80211_CMD_SET_BSS
 
NL80211_CMD_SET_BSS


	)

356 
	#NL80211_CMD_SET_MGMT_EXTRA_IE
 
NL80211_CMD_SET_MGMT_EXTRA_IE


	)

357 
	#NL80211_CMD_REG_CHANGE
 
NL80211_CMD_REG_CHANGE


	)

358 
	#NL80211_CMD_AUTHENTICATE
 
NL80211_CMD_AUTHENTICATE


	)

359 
	#NL80211_CMD_ASSOCIATE
 
NL80211_CMD_ASSOCIATE


	)

360 
	#NL80211_CMD_DEAUTHENTICATE
 
NL80211_CMD_DEAUTHENTICATE


	)

361 
	#NL80211_CMD_DISASSOCIATE
 
NL80211_CMD_DISASSOCIATE


	)

362 
	#NL80211_CMD_REG_BEACON_HINT
 
NL80211_CMD_REG_BEACON_HINT


	)

590 
	e∆80211_©ås
 {

592 
	mNL80211_ATTR_UNSPEC
,

594 
	mNL80211_ATTR_WIPHY
,

595 
	mNL80211_ATTR_WIPHY_NAME
,

597 
	mNL80211_ATTR_IFINDEX
,

598 
	mNL80211_ATTR_IFNAME
,

599 
	mNL80211_ATTR_IFTYPE
,

601 
	mNL80211_ATTR_MAC
,

603 
	mNL80211_ATTR_KEY_DATA
,

604 
	mNL80211_ATTR_KEY_IDX
,

605 
	mNL80211_ATTR_KEY_CIPHER
,

606 
	mNL80211_ATTR_KEY_SEQ
,

607 
	mNL80211_ATTR_KEY_DEFAULT
,

609 
	mNL80211_ATTR_BEACON_INTERVAL
,

610 
	mNL80211_ATTR_DTIM_PERIOD
,

611 
	mNL80211_ATTR_BEACON_HEAD
,

612 
	mNL80211_ATTR_BEACON_TAIL
,

614 
	mNL80211_ATTR_STA_AID
,

615 
	mNL80211_ATTR_STA_FLAGS
,

616 
	mNL80211_ATTR_STA_LISTEN_INTERVAL
,

617 
	mNL80211_ATTR_STA_SUPPORTED_RATES
,

618 
	mNL80211_ATTR_STA_VLAN
,

619 
	mNL80211_ATTR_STA_INFO
,

621 
	mNL80211_ATTR_WIPHY_BANDS
,

623 
	mNL80211_ATTR_MNTR_FLAGS
,

625 
	mNL80211_ATTR_MESH_ID
,

626 
	mNL80211_ATTR_STA_PLINK_ACTION
,

627 
	mNL80211_ATTR_MPATH_NEXT_HOP
,

628 
	mNL80211_ATTR_MPATH_INFO
,

630 
	mNL80211_ATTR_BSS_CTS_PROT
,

631 
	mNL80211_ATTR_BSS_SHORT_PREAMBLE
,

632 
	mNL80211_ATTR_BSS_SHORT_SLOT_TIME
,

634 
	mNL80211_ATTR_HT_CAPABILITY
,

636 
	mNL80211_ATTR_SUPPORTED_IFTYPES
,

638 
	mNL80211_ATTR_REG_ALPHA2
,

639 
	mNL80211_ATTR_REG_RULES
,

641 
	mNL80211_ATTR_MESH_PARAMS
,

643 
	mNL80211_ATTR_BSS_BASIC_RATES
,

645 
	mNL80211_ATTR_WIPHY_TXQ_PARAMS
,

646 
	mNL80211_ATTR_WIPHY_FREQ
,

647 
	mNL80211_ATTR_WIPHY_CHANNEL_TYPE
,

649 
	mNL80211_ATTR_KEY_DEFAULT_MGMT
,

651 
	mNL80211_ATTR_MGMT_SUBTYPE
,

652 
	mNL80211_ATTR_IE
,

654 
	mNL80211_ATTR_MAX_NUM_SCAN_SSIDS
,

656 
	mNL80211_ATTR_SCAN_FREQUENCIES
,

657 
	mNL80211_ATTR_SCAN_SSIDS
,

658 
	mNL80211_ATTR_GENERATION
,

659 
	mNL80211_ATTR_BSS
,

661 
	mNL80211_ATTR_REG_INITIATOR
,

662 
	mNL80211_ATTR_REG_TYPE
,

664 
	mNL80211_ATTR_SUPPORTED_COMMANDS
,

666 
	mNL80211_ATTR_FRAME
,

667 
	mNL80211_ATTR_SSID
,

668 
	mNL80211_ATTR_AUTH_TYPE
,

669 
	mNL80211_ATTR_REASON_CODE
,

671 
	mNL80211_ATTR_KEY_TYPE
,

673 
	mNL80211_ATTR_MAX_SCAN_IE_LEN
,

674 
	mNL80211_ATTR_CIPHER_SUITES
,

676 
	mNL80211_ATTR_FREQ_BEFORE
,

677 
	mNL80211_ATTR_FREQ_AFTER
,

679 
	mNL80211_ATTR_FREQ_FIXED
,

682 
	mNL80211_ATTR_WIPHY_RETRY_SHORT
,

683 
	mNL80211_ATTR_WIPHY_RETRY_LONG
,

684 
	mNL80211_ATTR_WIPHY_FRAG_THRESHOLD
,

685 
	mNL80211_ATTR_WIPHY_RTS_THRESHOLD
,

687 
	mNL80211_ATTR_TIMED_OUT
,

689 
	mNL80211_ATTR_USE_MFP
,

691 
	mNL80211_ATTR_STA_FLAGS2
,

693 
	mNL80211_ATTR_CONTROL_PORT
,

695 
	mNL80211_ATTR_TESTDATA
,

697 
	mNL80211_ATTR_PRIVACY
,

699 
	mNL80211_ATTR_DISCONNECTED_BY_AP
,

700 
	mNL80211_ATTR_STATUS_CODE
,

702 
	mNL80211_ATTR_CIPHER_SUITES_PAIRWISE
,

703 
	mNL80211_ATTR_CIPHER_SUITE_GROUP
,

704 
	mNL80211_ATTR_WPA_VERSIONS
,

705 
	mNL80211_ATTR_AKM_SUITES
,

707 
	mNL80211_ATTR_REQ_IE
,

708 
	mNL80211_ATTR_RESP_IE
,

710 
	mNL80211_ATTR_PREV_BSSID
,

712 
	mNL80211_ATTR_KEY
,

713 
	mNL80211_ATTR_KEYS
,

715 
	mNL80211_ATTR_PID
,

719 
	m__NL80211_ATTR_AFTER_LAST
,

720 
	mNL80211_ATTR_MAX
 = 
__NL80211_ATTR_AFTER_LAST
 - 1

724 
	#NL80211_ATTR_SCAN_GENERATION
 
NL80211_ATTR_GENERATION


	)

730 
	#NL80211_CMD_CONNECT
 
NL80211_CMD_CONNECT


	)

731 
	#NL80211_ATTR_HT_CAPABILITY
 
NL80211_ATTR_HT_CAPABILITY


	)

732 
	#NL80211_ATTR_BSS_BASIC_RATES
 
NL80211_ATTR_BSS_BASIC_RATES


	)

733 
	#NL80211_ATTR_WIPHY_TXQ_PARAMS
 
NL80211_ATTR_WIPHY_TXQ_PARAMS


	)

734 
	#NL80211_ATTR_WIPHY_FREQ
 
NL80211_ATTR_WIPHY_FREQ


	)

735 
	#NL80211_ATTR_WIPHY_CHANNEL_TYPE
 
NL80211_ATTR_WIPHY_CHANNEL_TYPE


	)

736 
	#NL80211_ATTR_MGMT_SUBTYPE
 
NL80211_ATTR_MGMT_SUBTYPE


	)

737 
	#NL80211_ATTR_IE
 
NL80211_ATTR_IE


	)

738 
	#NL80211_ATTR_REG_INITIATOR
 
NL80211_ATTR_REG_INITIATOR


	)

739 
	#NL80211_ATTR_REG_TYPE
 
NL80211_ATTR_REG_TYPE


	)

740 
	#NL80211_ATTR_FRAME
 
NL80211_ATTR_FRAME


	)

741 
	#NL80211_ATTR_SSID
 
NL80211_ATTR_SSID


	)

742 
	#NL80211_ATTR_AUTH_TYPE
 
NL80211_ATTR_AUTH_TYPE


	)

743 
	#NL80211_ATTR_REASON_CODE
 
NL80211_ATTR_REASON_CODE


	)

744 
	#NL80211_ATTR_CIPHER_SUITES_PAIRWISE
 
NL80211_ATTR_CIPHER_SUITES_PAIRWISE


	)

745 
	#NL80211_ATTR_CIPHER_SUITE_GROUP
 
NL80211_ATTR_CIPHER_SUITE_GROUP


	)

746 
	#NL80211_ATTR_WPA_VERSIONS
 
NL80211_ATTR_WPA_VERSIONS


	)

747 
	#NL80211_ATTR_AKM_SUITES
 
NL80211_ATTR_AKM_SUITES


	)

748 
	#NL80211_ATTR_KEY
 
NL80211_ATTR_KEY


	)

749 
	#NL80211_ATTR_KEYS
 
NL80211_ATTR_KEYS


	)

751 
	#NL80211_MAX_SUPP_RATES
 32

	)

752 
	#NL80211_MAX_SUPP_REG_RULES
 32

	)

753 
	#NL80211_TKIP_DATA_OFFSET_ENCR_KEY
 0

	)

754 
	#NL80211_TKIP_DATA_OFFSET_TX_MIC_KEY
 16

	)

755 
	#NL80211_TKIP_DATA_OFFSET_RX_MIC_KEY
 24

	)

756 
	#NL80211_HT_CAPABILITY_LEN
 26

	)

758 
	#NL80211_MAX_NR_CIPHER_SUITES
 5

	)

759 
	#NL80211_MAX_NR_AKM_SUITES
 2

	)

779 
	e∆80211_i·y≥
 {

780 
	mNL80211_IFTYPE_UNSPECIFIED
,

781 
	mNL80211_IFTYPE_ADHOC
,

782 
	mNL80211_IFTYPE_STATION
,

783 
	mNL80211_IFTYPE_AP
,

784 
	mNL80211_IFTYPE_AP_VLAN
,

785 
	mNL80211_IFTYPE_WDS
,

786 
	mNL80211_IFTYPE_MONITOR
,

787 
	mNL80211_IFTYPE_MESH_POINT
,

790 
	m__NL80211_IFTYPE_AFTER_LAST
,

791 
	mNL80211_IFTYPE_MAX
 = 
__NL80211_IFTYPE_AFTER_LAST
 - 1

806 
	e∆80211_°a_Êags
 {

807 
	m__NL80211_STA_FLAG_INVALID
,

808 
	mNL80211_STA_FLAG_AUTHORIZED
,

809 
	mNL80211_STA_FLAG_SHORT_PREAMBLE
,

810 
	mNL80211_STA_FLAG_WME
,

811 
	mNL80211_STA_FLAG_MFP
,

814 
	m__NL80211_STA_FLAG_AFTER_LAST
,

815 
	mNL80211_STA_FLAG_MAX
 = 
__NL80211_STA_FLAG_AFTER_LAST
 - 1

825 
	s∆80211_°a_Êag_upd©e
 {

826 
__u32
 
	mmask
;

827 
__u32
 
	m£t
;

828 } 
__©åibuã__
((
∑cked
));

844 
	e∆80211_øã_öfo
 {

845 
	m__NL80211_RATE_INFO_INVALID
,

846 
	mNL80211_RATE_INFO_BITRATE
,

847 
	mNL80211_RATE_INFO_MCS
,

848 
	mNL80211_RATE_INFO_40_MHZ_WIDTH
,

849 
	mNL80211_RATE_INFO_SHORT_GI
,

852 
	m__NL80211_RATE_INFO_AFTER_LAST
,

853 
	mNL80211_RATE_INFO_MAX
 = 
__NL80211_RATE_INFO_AFTER_LAST
 - 1

875 
	e∆80211_°a_öfo
 {

876 
	m__NL80211_STA_INFO_INVALID
,

877 
	mNL80211_STA_INFO_INACTIVE_TIME
,

878 
	mNL80211_STA_INFO_RX_BYTES
,

879 
	mNL80211_STA_INFO_TX_BYTES
,

880 
	mNL80211_STA_INFO_LLID
,

881 
	mNL80211_STA_INFO_PLID
,

882 
	mNL80211_STA_INFO_PLINK_STATE
,

883 
	mNL80211_STA_INFO_SIGNAL
,

884 
	mNL80211_STA_INFO_TX_BITRATE
,

885 
	mNL80211_STA_INFO_RX_PACKETS
,

886 
	mNL80211_STA_INFO_TX_PACKETS
,

889 
	m__NL80211_STA_INFO_AFTER_LAST
,

890 
	mNL80211_STA_INFO_MAX
 = 
__NL80211_STA_INFO_AFTER_LAST
 - 1

902 
	e∆80211_m∑th_Êags
 {

903 
	mNL80211_MPATH_FLAG_ACTIVE
 = 1<<0,

904 
	mNL80211_MPATH_FLAG_RESOLVING
 = 1<<1,

905 
	mNL80211_MPATH_FLAG_DSN_VALID
 = 1<<2,

906 
	mNL80211_MPATH_FLAG_FIXED
 = 1<<3,

907 
	mNL80211_MPATH_FLAG_RESOLVED
 = 1<<4,

926 
	e∆80211_m∑th_öfo
 {

927 
	m__NL80211_MPATH_INFO_INVALID
,

928 
	mNL80211_MPATH_INFO_FRAME_QLEN
,

929 
	mNL80211_MPATH_INFO_DSN
,

930 
	mNL80211_MPATH_INFO_METRIC
,

931 
	mNL80211_MPATH_INFO_EXPTIME
,

932 
	mNL80211_MPATH_INFO_FLAGS
,

933 
	mNL80211_MPATH_INFO_DISCOVERY_TIMEOUT
,

934 
	mNL80211_MPATH_INFO_DISCOVERY_RETRIES
,

937 
	m__NL80211_MPATH_INFO_AFTER_LAST
,

938 
	mNL80211_MPATH_INFO_MAX
 = 
__NL80211_MPATH_INFO_AFTER_LAST
 - 1

954 
	e∆80211_b™d_©å
 {

955 
	m__NL80211_BAND_ATTR_INVALID
,

956 
	mNL80211_BAND_ATTR_FREQS
,

957 
	mNL80211_BAND_ATTR_RATES
,

959 
	mNL80211_BAND_ATTR_HT_MCS_SET
,

960 
	mNL80211_BAND_ATTR_HT_CAPA
,

961 
	mNL80211_BAND_ATTR_HT_AMPDU_FACTOR
,

962 
	mNL80211_BAND_ATTR_HT_AMPDU_DENSITY
,

965 
	m__NL80211_BAND_ATTR_AFTER_LAST
,

966 
	mNL80211_BAND_ATTR_MAX
 = 
__NL80211_BAND_ATTR_AFTER_LAST
 - 1

969 
	#NL80211_BAND_ATTR_HT_CAPA
 
NL80211_BAND_ATTR_HT_CAPA


	)

985 
	e∆80211_‰equícy_©å
 {

986 
	m__NL80211_FREQUENCY_ATTR_INVALID
,

987 
	mNL80211_FREQUENCY_ATTR_FREQ
,

988 
	mNL80211_FREQUENCY_ATTR_DISABLED
,

989 
	mNL80211_FREQUENCY_ATTR_PASSIVE_SCAN
,

990 
	mNL80211_FREQUENCY_ATTR_NO_IBSS
,

991 
	mNL80211_FREQUENCY_ATTR_RADAR
,

992 
	mNL80211_FREQUENCY_ATTR_MAX_TX_POWER
,

995 
	m__NL80211_FREQUENCY_ATTR_AFTER_LAST
,

996 
	mNL80211_FREQUENCY_ATTR_MAX
 = 
__NL80211_FREQUENCY_ATTR_AFTER_LAST
 - 1

999 
	#NL80211_FREQUENCY_ATTR_MAX_TX_POWER
 
NL80211_FREQUENCY_ATTR_MAX_TX_POWER


	)

1007 
	e∆80211_bôøã_©å
 {

1008 
	m__NL80211_BITRATE_ATTR_INVALID
,

1009 
	mNL80211_BITRATE_ATTR_RATE
,

1010 
	mNL80211_BITRATE_ATTR_2GHZ_SHORTPREAMBLE
,

1013 
	m__NL80211_BITRATE_ATTR_AFTER_LAST
,

1014 
	mNL80211_BITRATE_ATTR_MAX
 = 
__NL80211_BITRATE_ATTR_AFTER_LAST
 - 1

1029 
	e∆80211_ªg_öôüt‹
 {

1030 
	mNL80211_REGDOM_SET_BY_CORE
,

1031 
	mNL80211_REGDOM_SET_BY_USER
,

1032 
	mNL80211_REGDOM_SET_BY_DRIVER
,

1033 
	mNL80211_REGDOM_SET_BY_COUNTRY_IE
,

1052 
	e∆80211_ªg_ty≥
 {

1053 
	mNL80211_REGDOM_TYPE_COUNTRY
,

1054 
	mNL80211_REGDOM_TYPE_WORLD
,

1055 
	mNL80211_REGDOM_TYPE_CUSTOM_WORLD
,

1056 
	mNL80211_REGDOM_TYPE_INTERSECTION
,

1078 
	e∆80211_ªg_ruÀ_©å
 {

1079 
	m__NL80211_REG_RULE_ATTR_INVALID
,

1080 
	mNL80211_ATTR_REG_RULE_FLAGS
,

1082 
	mNL80211_ATTR_FREQ_RANGE_START
,

1083 
	mNL80211_ATTR_FREQ_RANGE_END
,

1084 
	mNL80211_ATTR_FREQ_RANGE_MAX_BW
,

1086 
	mNL80211_ATTR_POWER_RULE_MAX_ANT_GAIN
,

1087 
	mNL80211_ATTR_POWER_RULE_MAX_EIRP
,

1090 
	m__NL80211_REG_RULE_ATTR_AFTER_LAST
,

1091 
	mNL80211_REG_RULE_ATTR_MAX
 = 
__NL80211_REG_RULE_ATTR_AFTER_LAST
 - 1

1107 
	e∆80211_ªg_ruÀ_Êags
 {

1108 
	mNL80211_RRF_NO_OFDM
 = 1<<0,

1109 
	mNL80211_RRF_NO_CCK
 = 1<<1,

1110 
	mNL80211_RRF_NO_INDOOR
 = 1<<2,

1111 
	mNL80211_RRF_NO_OUTDOOR
 = 1<<3,

1112 
	mNL80211_RRF_DFS
 = 1<<4,

1113 
	mNL80211_RRF_PTP_ONLY
 = 1<<5,

1114 
	mNL80211_RRF_PTMP_ONLY
 = 1<<6,

1115 
	mNL80211_RRF_PASSIVE_SCAN
 = 1<<7,

1116 
	mNL80211_RRF_NO_IBSS
 = 1<<8,

1136 
	e∆80211_m¡r_Êags
 {

1137 
	m__NL80211_MNTR_FLAG_INVALID
,

1138 
	mNL80211_MNTR_FLAG_FCSFAIL
,

1139 
	mNL80211_MNTR_FLAG_PLCPFAIL
,

1140 
	mNL80211_MNTR_FLAG_CONTROL
,

1141 
	mNL80211_MNTR_FLAG_OTHER_BSS
,

1142 
	mNL80211_MNTR_FLAG_COOK_FRAMES
,

1145 
	m__NL80211_MNTR_FLAG_AFTER_LAST
,

1146 
	mNL80211_MNTR_FLAG_MAX
 = 
__NL80211_MNTR_FLAG_AFTER_LAST
 - 1

1203 
	e∆80211_meshc⁄f_∑øms
 {

1204 
	m__NL80211_MESHCONF_INVALID
,

1205 
	mNL80211_MESHCONF_RETRY_TIMEOUT
,

1206 
	mNL80211_MESHCONF_CONFIRM_TIMEOUT
,

1207 
	mNL80211_MESHCONF_HOLDING_TIMEOUT
,

1208 
	mNL80211_MESHCONF_MAX_PEER_LINKS
,

1209 
	mNL80211_MESHCONF_MAX_RETRIES
,

1210 
	mNL80211_MESHCONF_TTL
,

1211 
	mNL80211_MESHCONF_AUTO_OPEN_PLINKS
,

1212 
	mNL80211_MESHCONF_HWMP_MAX_PREQ_RETRIES
,

1213 
	mNL80211_MESHCONF_PATH_REFRESH_TIME
,

1214 
	mNL80211_MESHCONF_MIN_DISCOVERY_TIMEOUT
,

1215 
	mNL80211_MESHCONF_HWMP_ACTIVE_PATH_TIMEOUT
,

1216 
	mNL80211_MESHCONF_HWMP_PREQ_MIN_INTERVAL
,

1217 
	mNL80211_MESHCONF_HWMP_NET_DIAM_TRVS_TIME
,

1220 
	m__NL80211_MESHCONF_ATTR_AFTER_LAST
,

1221 
	mNL80211_MESHCONF_ATTR_MAX
 = 
__NL80211_MESHCONF_ATTR_AFTER_LAST
 - 1

1238 
	e∆80211_txq_©å
 {

1239 
	m__NL80211_TXQ_ATTR_INVALID
,

1240 
	mNL80211_TXQ_ATTR_QUEUE
,

1241 
	mNL80211_TXQ_ATTR_TXOP
,

1242 
	mNL80211_TXQ_ATTR_CWMIN
,

1243 
	mNL80211_TXQ_ATTR_CWMAX
,

1244 
	mNL80211_TXQ_ATTR_AIFS
,

1247 
	m__NL80211_TXQ_ATTR_AFTER_LAST
,

1248 
	mNL80211_TXQ_ATTR_MAX
 = 
__NL80211_TXQ_ATTR_AFTER_LAST
 - 1

1251 
	e∆80211_txq_q
 {

1252 
	mNL80211_TXQ_Q_VO
,

1253 
	mNL80211_TXQ_Q_VI
,

1254 
	mNL80211_TXQ_Q_BE
,

1255 
	mNL80211_TXQ_Q_BK


1258 
	e∆80211_ch™√l_ty≥
 {

1259 
	mNL80211_CHAN_NO_HT
,

1260 
	mNL80211_CHAN_HT20
,

1261 
	mNL80211_CHAN_HT40MINUS
,

1262 
	mNL80211_CHAN_HT40PLUS


1283 
	e∆80211_bss
 {

1284 
	m__NL80211_BSS_INVALID
,

1285 
	mNL80211_BSS_BSSID
,

1286 
	mNL80211_BSS_FREQUENCY
,

1287 
	mNL80211_BSS_TSF
,

1288 
	mNL80211_BSS_BEACON_INTERVAL
,

1289 
	mNL80211_BSS_CAPABILITY
,

1290 
	mNL80211_BSS_INFORMATION_ELEMENTS
,

1291 
	mNL80211_BSS_SIGNAL_MBM
,

1292 
	mNL80211_BSS_SIGNAL_UNSPEC
,

1293 
	mNL80211_BSS_STATUS
,

1296 
	m__NL80211_BSS_AFTER_LAST
,

1297 
	mNL80211_BSS_MAX
 = 
__NL80211_BSS_AFTER_LAST
 - 1

1303 
	e∆80211_bss_°©us
 {

1304 
	mNL80211_BSS_STATUS_AUTHENTICATED
,

1305 
	mNL80211_BSS_STATUS_ASSOCIATED
,

1306 
	mNL80211_BSS_STATUS_IBSS_JOINED
,

1322 
	e∆80211_auth_ty≥
 {

1323 
	mNL80211_AUTHTYPE_OPEN_SYSTEM
,

1324 
	mNL80211_AUTHTYPE_SHARED_KEY
,

1325 
	mNL80211_AUTHTYPE_FT
,

1326 
	mNL80211_AUTHTYPE_NETWORK_EAP
,

1329 
	m__NL80211_AUTHTYPE_NUM
,

1330 
	mNL80211_AUTHTYPE_MAX
 = 
__NL80211_AUTHTYPE_NUM
 - 1,

1331 
	mNL80211_AUTHTYPE_AUTOMATIC


1340 
	e∆80211_key_ty≥
 {

1341 
	mNL80211_KEYTYPE_GROUP
,

1342 
	mNL80211_KEYTYPE_PAIRWISE
,

1343 
	mNL80211_KEYTYPE_PEERKEY
,

1351 
	e∆80211_mÂ
 {

1352 
	mNL80211_MFP_NO
,

1353 
	mNL80211_MFP_REQUIRED
,

1356 
	e∆80211_w∑_vîsi⁄s
 {

1357 
	mNL80211_WPA_VERSION_1
 = 1 << 0,

1358 
	mNL80211_WPA_VERSION_2
 = 1 << 1,

1377 
	e∆80211_key_©åibuãs
 {

1378 
	m__NL80211_KEY_INVALID
,

1379 
	mNL80211_KEY_DATA
,

1380 
	mNL80211_KEY_IDX
,

1381 
	mNL80211_KEY_CIPHER
,

1382 
	mNL80211_KEY_SEQ
,

1383 
	mNL80211_KEY_DEFAULT
,

1384 
	mNL80211_KEY_DEFAULT_MGMT
,

1387 
	m__NL80211_KEY_AFTER_LAST
,

1388 
	mNL80211_KEY_MAX
 = 
__NL80211_KEY_AFTER_LAST
 - 1

	@/usr/include/linux/reboot.h

1 #i‚de‡
_LINUX_REBOOT_H


2 
	#_LINUX_REBOOT_H


	)

8 
	#LINUX_REBOOT_MAGIC1
 0x„e1dód

	)

9 
	#LINUX_REBOOT_MAGIC2
 672274793

	)

10 
	#LINUX_REBOOT_MAGIC2A
 85072278

	)

11 
	#LINUX_REBOOT_MAGIC2B
 369367448

	)

12 
	#LINUX_REBOOT_MAGIC2C
 537993216

	)

28 
	#LINUX_REBOOT_CMD_RESTART
 0x01234567

	)

29 
	#LINUX_REBOOT_CMD_HALT
 0xCDEF0123

	)

30 
	#LINUX_REBOOT_CMD_CAD_ON
 0x89ABCDEF

	)

31 
	#LINUX_REBOOT_CMD_CAD_OFF
 0x00000000

	)

32 
	#LINUX_REBOOT_CMD_POWER_OFF
 0x4321FEDC

	)

33 
	#LINUX_REBOOT_CMD_RESTART2
 0xA1B2C3D4

	)

34 
	#LINUX_REBOOT_CMD_SW_SUSPEND
 0xD000FCE2

	)

35 
	#LINUX_REBOOT_CMD_KEXEC
 0x45584543

	)

	@/usr/include/linux/rtnetlink.h

1 #i‚de‡
__LINUX_RTNETLINK_H


2 
	#__LINUX_RTNETLINK_H


	)

4 
	~<löux/ty≥s.h
>

5 
	~<löux/√éök.h
>

6 
	~<löux/if_lök.h
>

7 
	~<löux/if_addr.h
>

8 
	~<löux/√ighbour.h
>

17 
	mRTM_BASE
 = 16,

18 
	#RTM_BASE
 
RTM_BASE


	)

20 
	mRTM_NEWLINK
 = 16,

21 
	#RTM_NEWLINK
 
RTM_NEWLINK


	)

22 
	mRTM_DELLINK
,

23 
	#RTM_DELLINK
 
RTM_DELLINK


	)

24 
	mRTM_GETLINK
,

25 
	#RTM_GETLINK
 
RTM_GETLINK


	)

26 
	mRTM_SETLINK
,

27 
	#RTM_SETLINK
 
RTM_SETLINK


	)

29 
	mRTM_NEWADDR
 = 20,

30 
	#RTM_NEWADDR
 
RTM_NEWADDR


	)

31 
	mRTM_DELADDR
,

32 
	#RTM_DELADDR
 
RTM_DELADDR


	)

33 
	mRTM_GETADDR
,

34 
	#RTM_GETADDR
 
RTM_GETADDR


	)

36 
	mRTM_NEWROUTE
 = 24,

37 
	#RTM_NEWROUTE
 
RTM_NEWROUTE


	)

38 
	mRTM_DELROUTE
,

39 
	#RTM_DELROUTE
 
RTM_DELROUTE


	)

40 
	mRTM_GETROUTE
,

41 
	#RTM_GETROUTE
 
RTM_GETROUTE


	)

43 
	mRTM_NEWNEIGH
 = 28,

44 
	#RTM_NEWNEIGH
 
RTM_NEWNEIGH


	)

45 
	mRTM_DELNEIGH
,

46 
	#RTM_DELNEIGH
 
RTM_DELNEIGH


	)

47 
	mRTM_GETNEIGH
,

48 
	#RTM_GETNEIGH
 
RTM_GETNEIGH


	)

50 
	mRTM_NEWRULE
 = 32,

51 
	#RTM_NEWRULE
 
RTM_NEWRULE


	)

52 
	mRTM_DELRULE
,

53 
	#RTM_DELRULE
 
RTM_DELRULE


	)

54 
	mRTM_GETRULE
,

55 
	#RTM_GETRULE
 
RTM_GETRULE


	)

57 
	mRTM_NEWQDISC
 = 36,

58 
	#RTM_NEWQDISC
 
RTM_NEWQDISC


	)

59 
	mRTM_DELQDISC
,

60 
	#RTM_DELQDISC
 
RTM_DELQDISC


	)

61 
	mRTM_GETQDISC
,

62 
	#RTM_GETQDISC
 
RTM_GETQDISC


	)

64 
	mRTM_NEWTCLASS
 = 40,

65 
	#RTM_NEWTCLASS
 
RTM_NEWTCLASS


	)

66 
	mRTM_DELTCLASS
,

67 
	#RTM_DELTCLASS
 
RTM_DELTCLASS


	)

68 
	mRTM_GETTCLASS
,

69 
	#RTM_GETTCLASS
 
RTM_GETTCLASS


	)

71 
	mRTM_NEWTFILTER
 = 44,

72 
	#RTM_NEWTFILTER
 
RTM_NEWTFILTER


	)

73 
	mRTM_DELTFILTER
,

74 
	#RTM_DELTFILTER
 
RTM_DELTFILTER


	)

75 
	mRTM_GETTFILTER
,

76 
	#RTM_GETTFILTER
 
RTM_GETTFILTER


	)

78 
	mRTM_NEWACTION
 = 48,

79 
	#RTM_NEWACTION
 
RTM_NEWACTION


	)

80 
	mRTM_DELACTION
,

81 
	#RTM_DELACTION
 
RTM_DELACTION


	)

82 
	mRTM_GETACTION
,

83 
	#RTM_GETACTION
 
RTM_GETACTION


	)

85 
	mRTM_NEWPREFIX
 = 52,

86 
	#RTM_NEWPREFIX
 
RTM_NEWPREFIX


	)

88 
	mRTM_GETMULTICAST
 = 58,

89 
	#RTM_GETMULTICAST
 
RTM_GETMULTICAST


	)

91 
	mRTM_GETANYCAST
 = 62,

92 
	#RTM_GETANYCAST
 
RTM_GETANYCAST


	)

94 
	mRTM_NEWNEIGHTBL
 = 64,

95 
	#RTM_NEWNEIGHTBL
 
RTM_NEWNEIGHTBL


	)

96 
	mRTM_GETNEIGHTBL
 = 66,

97 
	#RTM_GETNEIGHTBL
 
RTM_GETNEIGHTBL


	)

98 
	mRTM_SETNEIGHTBL
,

99 
	#RTM_SETNEIGHTBL
 
RTM_SETNEIGHTBL


	)

101 
	mRTM_NEWNDUSEROPT
 = 68,

102 
	#RTM_NEWNDUSEROPT
 
RTM_NEWNDUSEROPT


	)

104 
	mRTM_NEWADDRLABEL
 = 72,

105 
	#RTM_NEWADDRLABEL
 
RTM_NEWADDRLABEL


	)

106 
	mRTM_DELADDRLABEL
,

107 
	#RTM_DELADDRLABEL
 
RTM_DELADDRLABEL


	)

108 
	mRTM_GETADDRLABEL
,

109 
	#RTM_GETADDRLABEL
 
RTM_GETADDRLABEL


	)

111 
	mRTM_GETDCB
 = 78,

112 
	#RTM_GETDCB
 
RTM_GETDCB


	)

113 
	mRTM_SETDCB
,

114 
	#RTM_SETDCB
 
RTM_SETDCB


	)

116 
	m__RTM_MAX
,

117 
	#RTM_MAX
 (((
__RTM_MAX
 + 3Ë& ~3Ë- 1)

	)

120 
	#RTM_NR_MSGTYPES
 (
RTM_MAX
 + 1 - 
RTM_BASE
)

	)

121 
	#RTM_NR_FAMILIES
 (
RTM_NR_MSGTYPES
 >> 2)

	)

122 
	#RTM_FAM
(
cmd
Ë(((cmdË- 
RTM_BASE
Ë>> 2)

	)

130 
	sπ©å


132 
	mπa_Àn
;

133 
	mπa_ty≥
;

138 
	#RTA_ALIGNTO
 4

	)

139 
	#RTA_ALIGN
(
Àn
Ë–(÷í)+
RTA_ALIGNTO
-1Ë& ~(RTA_ALIGNTO-1Ë)

	)

140 
	#RTA_OK
(
πa
,
Àn
Ë(÷íË>()(
π©å
) && \

141 (
πa
)->
πa_Àn
 >(
π©å
) && \

142 (
πa
)->
πa_Àn
 <(
Àn
))

	)

143 
	#RTA_NEXT
(
πa
,
©åÀn
Ë(◊âæíË-
	`RTA_ALIGN
(‘è)->
πa_Àn
), \

144 (
π©å
*)(((*)(
πa
)Ë+ 
	`RTA_ALIGN
(‘è)->
πa_Àn
)))

	)

145 
	#RTA_LENGTH
(
Àn
Ë(
	`RTA_ALIGN
((
π©å
)Ë+ (Àn))

	)

146 
	#RTA_SPACE
(
Àn
Ë
	`RTA_ALIGN
(
	`RTA_LENGTH
÷í))

	)

147 
	#RTA_DATA
(
πa
Ë((*)(((*)‘è)Ë+ 
	`RTA_LENGTH
(0)))

	)

148 
	#RTA_PAYLOAD
(
πa
Ë(()(‘è)->
πa_Àn
Ë- 
	`RTA_LENGTH
(0))

	)

157 
	sπmsg


159 
	mπm_Ámûy
;

160 
	mπm_d°_Àn
;

161 
	mπm_§c_Àn
;

162 
	mπm_tos
;

164 
	mπm_èbÀ
;

165 
	mπm_¥Ÿocﬁ
;

166 
	mπm_sc›e
;

167 
	mπm_ty≥
;

169 
	mπm_Êags
;

176 
	mRTN_UNSPEC
,

177 
	mRTN_UNICAST
,

178 
	mRTN_LOCAL
,

179 
	mRTN_BROADCAST
,

181 
	mRTN_ANYCAST
,

183 
	mRTN_MULTICAST
,

184 
	mRTN_BLACKHOLE
,

185 
	mRTN_UNREACHABLE
,

186 
	mRTN_PROHIBIT
,

187 
	mRTN_THROW
,

188 
	mRTN_NAT
,

189 
	mRTN_XRESOLVE
,

190 
	m__RTN_MAX


193 
	#RTN_MAX
 (
__RTN_MAX
 - 1)

	)

198 
	#RTPROT_UNSPEC
 0

	)

199 
	#RTPROT_REDIRECT
 1

	)

201 
	#RTPROT_KERNEL
 2

	)

202 
	#RTPROT_BOOT
 3

	)

203 
	#RTPROT_STATIC
 4

	)

212 
	#RTPROT_GATED
 8

	)

213 
	#RTPROT_RA
 9

	)

214 
	#RTPROT_MRT
 10

	)

215 
	#RTPROT_ZEBRA
 11

	)

216 
	#RTPROT_BIRD
 12

	)

217 
	#RTPROT_DNROUTED
 13

	)

218 
	#RTPROT_XORP
 14

	)

219 
	#RTPROT_NTK
 15

	)

220 
	#RTPROT_DHCP
 16

	)

233 
	eπ_sc›e_t


235 
	mRT_SCOPE_UNIVERSE
=0,

237 
	mRT_SCOPE_SITE
=200,

238 
	mRT_SCOPE_LINK
=253,

239 
	mRT_SCOPE_HOST
=254,

240 
	mRT_SCOPE_NOWHERE
=255

245 
	#RTM_F_NOTIFY
 0x100

	)

246 
	#RTM_F_CLONED
 0x200

	)

247 
	#RTM_F_EQUALIZE
 0x400

	)

248 
	#RTM_F_PREFIX
 0x800

	)

252 
	eπ_˛ass_t


254 
	mRT_TABLE_UNSPEC
=0,

256 
	mRT_TABLE_COMPAT
=252,

257 
	mRT_TABLE_DEFAULT
=253,

258 
	mRT_TABLE_MAIN
=254,

259 
	mRT_TABLE_LOCAL
=255,

260 
	mRT_TABLE_MAX
=0xFFFFFFFF

266 
	eπ©å_ty≥_t


268 
	mRTA_UNSPEC
,

269 
	mRTA_DST
,

270 
	mRTA_SRC
,

271 
	mRTA_IIF
,

272 
	mRTA_OIF
,

273 
	mRTA_GATEWAY
,

274 
	mRTA_PRIORITY
,

275 
	mRTA_PREFSRC
,

276 
	mRTA_METRICS
,

277 
	mRTA_MULTIPATH
,

278 
	mRTA_PROTOINFO
,

279 
	mRTA_FLOW
,

280 
	mRTA_CACHEINFO
,

281 
	mRTA_SESSION
,

282 
	mRTA_MP_ALGO
,

283 
	mRTA_TABLE
,

284 
	m__RTA_MAX


287 
	#RTA_MAX
 (
__RTA_MAX
 - 1)

	)

289 
	#RTM_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
πmsg
))))

	)

290 
	#RTM_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
πmsg
))

	)

301 
	sπ√xth›


303 
	mπnh_Àn
;

304 
	mπnh_Êags
;

305 
	mπnh_h›s
;

306 
	mπnh_ifödex
;

311 
	#RTNH_F_DEAD
 1

	)

312 
	#RTNH_F_PERVASIVE
 2

	)

313 
	#RTNH_F_ONLINK
 4

	)

317 
	#RTNH_ALIGNTO
 4

	)

318 
	#RTNH_ALIGN
(
Àn
Ë–(÷í)+
RTNH_ALIGNTO
-1Ë& ~(RTNH_ALIGNTO-1Ë)

	)

319 
	#RTNH_OK
(
πnh
,
Àn
Ë(‘äh)->
πnh_Àn
 >(
π√xth›
) && \

320 (()(
πnh
)->
πnh_Àn
Ë<(
Àn
))

	)

321 
	#RTNH_NEXT
(
πnh
Ë((
π√xth›
*)(((*)‘äh)Ë+ 
	`RTNH_ALIGN
(‘äh)->
πnh_Àn
)))

	)

322 
	#RTNH_LENGTH
(
Àn
Ë(
	`RTNH_ALIGN
((
π√xth›
)Ë+ (Àn))

	)

323 
	#RTNH_SPACE
(
Àn
Ë
	`RTNH_ALIGN
(
	`RTNH_LENGTH
÷í))

	)

324 
	#RTNH_DATA
(
πnh
Ë((
π©å
*)(((*)‘äh)Ë+ 
	`RTNH_LENGTH
(0)))

	)

328 
	sπa_ˇcheöfo


330 
__u32
 
	mπa_˛¡ªf
;

331 
__u32
 
	mπa_œ°u£
;

332 
__s32
 
	mπa_expúes
;

333 
__u32
 
	mπa_îr‹
;

334 
__u32
 
	mπa_u£d
;

336 
	#RTNETLINK_HAVE_PEERINFO
 1

	)

337 
__u32
 
	mπa_id
;

338 
__u32
 
	mπa_ts
;

339 
__u32
 
	mπa_tßge
;

346 
	mRTAX_UNSPEC
,

347 
	#RTAX_UNSPEC
 
RTAX_UNSPEC


	)

348 
	mRTAX_LOCK
,

349 
	#RTAX_LOCK
 
RTAX_LOCK


	)

350 
	mRTAX_MTU
,

351 
	#RTAX_MTU
 
RTAX_MTU


	)

352 
	mRTAX_WINDOW
,

353 
	#RTAX_WINDOW
 
RTAX_WINDOW


	)

354 
	mRTAX_RTT
,

355 
	#RTAX_RTT
 
RTAX_RTT


	)

356 
	mRTAX_RTTVAR
,

357 
	#RTAX_RTTVAR
 
RTAX_RTTVAR


	)

358 
	mRTAX_SSTHRESH
,

359 
	#RTAX_SSTHRESH
 
RTAX_SSTHRESH


	)

360 
	mRTAX_CWND
,

361 
	#RTAX_CWND
 
RTAX_CWND


	)

362 
	mRTAX_ADVMSS
,

363 
	#RTAX_ADVMSS
 
RTAX_ADVMSS


	)

364 
	mRTAX_REORDERING
,

365 
	#RTAX_REORDERING
 
RTAX_REORDERING


	)

366 
	mRTAX_HOPLIMIT
,

367 
	#RTAX_HOPLIMIT
 
RTAX_HOPLIMIT


	)

368 
	mRTAX_INITCWND
,

369 
	#RTAX_INITCWND
 
RTAX_INITCWND


	)

370 
	mRTAX_FEATURES
,

371 
	#RTAX_FEATURES
 
RTAX_FEATURES


	)

372 
	mRTAX_RTO_MIN
,

373 
	#RTAX_RTO_MIN
 
RTAX_RTO_MIN


	)

374 
	m__RTAX_MAX


377 
	#RTAX_MAX
 (
__RTAX_MAX
 - 1)

	)

379 
	#RTAX_FEATURE_ECN
 0x00000001

	)

380 
	#RTAX_FEATURE_SACK
 0x00000002

	)

381 
	#RTAX_FEATURE_TIMESTAMP
 0x00000004

	)

382 
	#RTAX_FEATURE_ALLFRAG
 0x00000008

	)

384 
	sπa_£ssi⁄


386 
__u8
 
	m¥Ÿo
;

387 
__u8
 
	m∑d1
;

388 
__u16
 
	m∑d2
;

392 
__u16
 
	m•‹t
;

393 
__u16
 
	mdp‹t
;

394 } 
	mp‹ts
;

397 
__u8
 
	mty≥
;

398 
__u8
 
	mcode
;

399 
__u16
 
	midít
;

400 } 
	micm±
;

402 
__u32
 
	m•i
;

403 } 
	mu
;

410 
	sπgímsg


412 
	mπgí_Ámûy
;

424 
	siföfomsg


426 
	mifi_Ámûy
;

427 
	m__ifi_∑d
;

428 
	mifi_ty≥
;

429 
	mifi_ödex
;

430 
	mifi_Êags
;

431 
	mifi_ch™ge
;

438 
	s¥efixmsg


440 
	m¥efix_Ámûy
;

441 
	m¥efix_∑d1
;

442 
	m¥efix_∑d2
;

443 
	m¥efix_ifödex
;

444 
	m¥efix_ty≥
;

445 
	m¥efix_Àn
;

446 
	m¥efix_Êags
;

447 
	m¥efix_∑d3
;

452 
	mPREFIX_UNSPEC
,

453 
	mPREFIX_ADDRESS
,

454 
	mPREFIX_CACHEINFO
,

455 
	m__PREFIX_MAX


458 
	#PREFIX_MAX
 (
__PREFIX_MAX
 - 1)

	)

460 
	s¥efix_ˇcheöfo


462 
__u32
 
	m¥e„ºed_time
;

463 
__u32
 
	mvÆid_time
;

471 
	stcmsg


473 
	mtcm_Ámûy
;

474 
	mtcm__∑d1
;

475 
	mtcm__∑d2
;

476 
	mtcm_ifödex
;

477 
__u32
 
	mtcm_h™dÀ
;

478 
__u32
 
	mtcm_∑ª¡
;

479 
__u32
 
	mtcm_öfo
;

484 
	mTCA_UNSPEC
,

485 
	mTCA_KIND
,

486 
	mTCA_OPTIONS
,

487 
	mTCA_STATS
,

488 
	mTCA_XSTATS
,

489 
	mTCA_RATE
,

490 
	mTCA_FCNT
,

491 
	mTCA_STATS2
,

492 
	mTCA_STAB
,

493 
	m__TCA_MAX


496 
	#TCA_MAX
 (
__TCA_MAX
 - 1)

	)

498 
	#TCA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
tcmsg
))))

	)

499 
	#TCA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
tcmsg
))

	)

505 
	sndu£r›tmsg


507 
	mndu£r›t_Ámûy
;

508 
	mndu£r›t_∑d1
;

509 
	mndu£r›t_›ts_Àn
;

510 
	mndu£r›t_ifödex
;

511 
__u8
 
	mndu£r›t_icmp_ty≥
;

512 
__u8
 
	mndu£r›t_icmp_code
;

513 
	mndu£r›t_∑d2
;

514 
	mndu£r›t_∑d3
;

520 
	mNDUSEROPT_UNSPEC
,

521 
	mNDUSEROPT_SRCADDR
,

522 
	m__NDUSEROPT_MAX


525 
	#NDUSEROPT_MAX
 (
__NDUSEROPT_MAX
 - 1)

	)

528 
	#RTMGRP_LINK
 1

	)

529 
	#RTMGRP_NOTIFY
 2

	)

530 
	#RTMGRP_NEIGH
 4

	)

531 
	#RTMGRP_TC
 8

	)

533 
	#RTMGRP_IPV4_IFADDR
 0x10

	)

534 
	#RTMGRP_IPV4_MROUTE
 0x20

	)

535 
	#RTMGRP_IPV4_ROUTE
 0x40

	)

536 
	#RTMGRP_IPV4_RULE
 0x80

	)

538 
	#RTMGRP_IPV6_IFADDR
 0x100

	)

539 
	#RTMGRP_IPV6_MROUTE
 0x200

	)

540 
	#RTMGRP_IPV6_ROUTE
 0x400

	)

541 
	#RTMGRP_IPV6_IFINFO
 0x800

	)

543 
	#RTMGRP_DEC√t_IFADDR
 0x1000

	)

544 
	#RTMGRP_DEC√t_ROUTE
 0x4000

	)

546 
	#RTMGRP_IPV6_PREFIX
 0x20000

	)

549 
	eπ√éök_groups
 {

550 
	mRTNLGRP_NONE
,

551 
	#RTNLGRP_NONE
 
RTNLGRP_NONE


	)

552 
	mRTNLGRP_LINK
,

553 
	#RTNLGRP_LINK
 
RTNLGRP_LINK


	)

554 
	mRTNLGRP_NOTIFY
,

555 
	#RTNLGRP_NOTIFY
 
RTNLGRP_NOTIFY


	)

556 
	mRTNLGRP_NEIGH
,

557 
	#RTNLGRP_NEIGH
 
RTNLGRP_NEIGH


	)

558 
	mRTNLGRP_TC
,

559 
	#RTNLGRP_TC
 
RTNLGRP_TC


	)

560 
	mRTNLGRP_IPV4_IFADDR
,

561 
	#RTNLGRP_IPV4_IFADDR
 
RTNLGRP_IPV4_IFADDR


	)

562 
	mRTNLGRP_IPV4_MROUTE
,

563 
	#RTNLGRP_IPV4_MROUTE
 
RTNLGRP_IPV4_MROUTE


	)

564 
	mRTNLGRP_IPV4_ROUTE
,

565 
	#RTNLGRP_IPV4_ROUTE
 
RTNLGRP_IPV4_ROUTE


	)

566 
	mRTNLGRP_IPV4_RULE
,

567 
	#RTNLGRP_IPV4_RULE
 
RTNLGRP_IPV4_RULE


	)

568 
	mRTNLGRP_IPV6_IFADDR
,

569 
	#RTNLGRP_IPV6_IFADDR
 
RTNLGRP_IPV6_IFADDR


	)

570 
	mRTNLGRP_IPV6_MROUTE
,

571 
	#RTNLGRP_IPV6_MROUTE
 
RTNLGRP_IPV6_MROUTE


	)

572 
	mRTNLGRP_IPV6_ROUTE
,

573 
	#RTNLGRP_IPV6_ROUTE
 
RTNLGRP_IPV6_ROUTE


	)

574 
	mRTNLGRP_IPV6_IFINFO
,

575 
	#RTNLGRP_IPV6_IFINFO
 
RTNLGRP_IPV6_IFINFO


	)

576 
	mRTNLGRP_DEC√t_IFADDR
,

577 
	#RTNLGRP_DEC√t_IFADDR
 
RTNLGRP_DEC√t_IFADDR


	)

578 
	mRTNLGRP_NOP2
,

579 
	mRTNLGRP_DEC√t_ROUTE
,

580 
	#RTNLGRP_DEC√t_ROUTE
 
RTNLGRP_DEC√t_ROUTE


	)

581 
	mRTNLGRP_DEC√t_RULE
,

582 
	#RTNLGRP_DEC√t_RULE
 
RTNLGRP_DEC√t_RULE


	)

583 
	mRTNLGRP_NOP4
,

584 
	mRTNLGRP_IPV6_PREFIX
,

585 
	#RTNLGRP_IPV6_PREFIX
 
RTNLGRP_IPV6_PREFIX


	)

586 
	mRTNLGRP_IPV6_RULE
,

587 
	#RTNLGRP_IPV6_RULE
 
RTNLGRP_IPV6_RULE


	)

588 
	mRTNLGRP_ND_USEROPT
,

589 
	#RTNLGRP_ND_USEROPT
 
RTNLGRP_ND_USEROPT


	)

590 
	mRTNLGRP_PHONET_IFADDR
,

591 
	#RTNLGRP_PHONET_IFADDR
 
RTNLGRP_PHONET_IFADDR


	)

592 
	mRTNLGRP_PHONET_ROUTE
,

593 
	#RTNLGRP_PHONET_ROUTE
 
RTNLGRP_PHONET_ROUTE


	)

594 
	m__RTNLGRP_MAX


596 
	#RTNLGRP_MAX
 (
__RTNLGRP_MAX
 - 1)

	)

599 
	stˇmsg


601 
	mtˇ_Ámûy
;

602 
	mtˇ__∑d1
;

603 
	mtˇ__∑d2
;

605 
	#TA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
tˇmsg
))))

	)

606 
	#TA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
tˇmsg
))

	)

607 
	#TCA_ACT_TAB
 1

	)

608 
	#TCAA_MAX
 1

	)

	@/usr/include/linux/sched.h

1 #i‚de‡
_LINUX_SCHED_H


2 
	#_LINUX_SCHED_H


	)

7 
	#CSIGNAL
 0x000000f‡

	)

8 
	#CLONE_VM
 0x00000100

	)

9 
	#CLONE_FS
 0x00000200

	)

10 
	#CLONE_FILES
 0x00000400

	)

11 
	#CLONE_SIGHAND
 0x00000800

	)

12 
	#CLONE_PTRACE
 0x00002000

	)

13 
	#CLONE_VFORK
 0x00004000

	)

14 
	#CLONE_PARENT
 0x00008000

	)

15 
	#CLONE_THREAD
 0x00010000

	)

16 
	#CLONE_NEWNS
 0x00020000

	)

17 
	#CLONE_SYSVSEM
 0x00040000

	)

18 
	#CLONE_SETTLS
 0x00080000

	)

19 
	#CLONE_PARENT_SETTID
 0x00100000

	)

20 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

21 
	#CLONE_DETACHED
 0x00400000

	)

22 
	#CLONE_UNTRACED
 0x00800000

	)

23 
	#CLONE_CHILD_SETTID
 0x01000000

	)

24 
	#CLONE_STOPPED
 0x02000000

	)

25 
	#CLONE_NEWUTS
 0x04000000

	)

26 
	#CLONE_NEWIPC
 0x08000000

	)

27 
	#CLONE_NEWUSER
 0x10000000

	)

28 
	#CLONE_NEWPID
 0x20000000

	)

29 
	#CLONE_NEWNET
 0x40000000

	)

30 
	#CLONE_IO
 0x80000000

	)

35 
	#SCHED_NORMAL
 0

	)

36 
	#SCHED_FIFO
 1

	)

37 
	#SCHED_RR
 2

	)

38 
	#SCHED_BATCH
 3

	)

40 
	#SCHED_IDLE
 5

	)

42 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

	@/usr/include/linux/socket.h

1 #i‚de‡
_LINUX_SOCKET_H


2 
	#_LINUX_SOCKET_H


	)

7 
	#_K_SS_MAXSIZE
 128

	)

8 
	#_K_SS_ALIGNSIZE
 (
	`__Æignof__
 (
sockaddr
 *))

	)

11 
	s__kî√l_sockaddr_°‹age
 {

12 
	mss_Ámûy
;

14 
	m__d©a
[
_K_SS_MAXSIZE
 - ()];

17 } 
__©åibuã__
 ((
Æig√d
(
_K_SS_ALIGNSIZE
)));

	@/usr/include/linux/time.h

1 #i‚de‡
_LINUX_TIME_H


2 
	#_LINUX_TIME_H


	)

4 
	~<löux/ty≥s.h
>

7 #i‚de‡
_STRUCT_TIMESPEC


8 
	#_STRUCT_TIMESPEC


	)

9 
	stime•ec
 {

10 
__kî√l_time_t
 
	mtv_£c
;

11 
	mtv_n£c
;

15 
	stimevÆ
 {

16 
__kî√l_time_t
 
	mtv_£c
;

17 
__kî√l_su£c⁄ds_t
 
	mtv_u£c
;

20 
	stimez⁄e
 {

21 
	mtz_möuãswe°
;

22 
	mtz_d°time
;

26 
	#NFDBITS
 
__NFDBITS


	)

28 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

29 
	#FD_SET
(
fd
,
fd£ç
Ë
	`__FD_SET
(fd,fd£ç)

	)

30 
	#FD_CLR
(
fd
,
fd£ç
Ë
	`__FD_CLR
(fd,fd£ç)

	)

31 
	#FD_ISSET
(
fd
,
fd£ç
Ë
	`__FD_ISSET
(fd,fd£ç)

	)

32 
	#FD_ZERO
(
fd£ç
Ë
	`__FD_ZERO
(fd£ç)

	)

38 
	#ITIMER_REAL
 0

	)

39 
	#ITIMER_VIRTUAL
 1

	)

40 
	#ITIMER_PROF
 2

	)

42 
	sôimî•ec
 {

43 
time•ec
 
	mô_öãrvÆ
;

44 
time•ec
 
	mô_vÆue
;

47 
	sôimîvÆ
 {

48 
timevÆ
 
	mô_öãrvÆ
;

49 
timevÆ
 
	mô_vÆue
;

55 
	#CLOCK_REALTIME
 0

	)

56 
	#CLOCK_MONOTONIC
 1

	)

57 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

58 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

59 
	#CLOCK_MONOTONIC_RAW
 4

	)

60 
	#CLOCK_REALTIME_COARSE
 5

	)

61 
	#CLOCK_MONOTONIC_COARSE
 6

	)

66 
	#CLOCK_SGI_CYCLE
 10

	)

67 
	#MAX_CLOCKS
 16

	)

68 
	#CLOCKS_MASK
 (
CLOCK_REALTIME
 | 
CLOCK_MONOTONIC
)

	)

69 
	#CLOCKS_MONO
 
CLOCK_MONOTONIC


	)

74 
	#TIMER_ABSTIME
 0x01

	)

	@/usr/include/linux/unistd.h

1 #i‚de‡
_LINUX_UNISTD_H_


2 
	#_LINUX_UNISTD_H_


	)

7 
	~<asm/uni°d.h
>

	@/usr/include/linux/version.h

1 
	#LINUX_VERSION_CODE
 132640

	)

2 
	#KERNEL_VERSION
(
a
,
b
,
c
Ë((◊Ë<< 16Ë+ ((bË<< 8Ë+ (c))

	)

	@/usr/include/linux/wireless.h

10 #i‚de‡
_LINUX_WIRELESS_H


11 
	#_LINUX_WIRELESS_H


	)

72 
	~<löux/ty≥s.h
>

73 
	~<löux/sockë.h
>

74 
	~<löux/if.h
>

83 
	#WIRELESS_EXT
 22

	)

230 
	#SIOCSIWCOMMIT
 0x8B00

	)

231 
	#SIOCGIWNAME
 0x8B01

	)

237 
	#SIOCSIWNWID
 0x8B02

	)

238 
	#SIOCGIWNWID
 0x8B03

	)

239 
	#SIOCSIWFREQ
 0x8B04

	)

240 
	#SIOCGIWFREQ
 0x8B05

	)

241 
	#SIOCSIWMODE
 0x8B06

	)

242 
	#SIOCGIWMODE
 0x8B07

	)

243 
	#SIOCSIWSENS
 0x8B08

	)

244 
	#SIOCGIWSENS
 0x8B09

	)

247 
	#SIOCSIWRANGE
 0x8B0A

	)

248 
	#SIOCGIWRANGE
 0x8B0B

	)

249 
	#SIOCSIWPRIV
 0x8B0C

	)

250 
	#SIOCGIWPRIV
 0x8B0D

	)

251 
	#SIOCSIWSTATS
 0x8B0E

	)

252 
	#SIOCGIWSTATS
 0x8B0F

	)

257 
	#SIOCSIWSPY
 0x8B10

	)

258 
	#SIOCGIWSPY
 0x8B11

	)

259 
	#SIOCSIWTHRSPY
 0x8B12

	)

260 
	#SIOCGIWTHRSPY
 0x8B13

	)

263 
	#SIOCSIWAP
 0x8B14

	)

264 
	#SIOCGIWAP
 0x8B15

	)

265 
	#SIOCGIWAPLIST
 0x8B17

	)

266 
	#SIOCSIWSCAN
 0x8B18

	)

267 
	#SIOCGIWSCAN
 0x8B19

	)

270 
	#SIOCSIWESSID
 0x8B1A

	)

271 
	#SIOCGIWESSID
 0x8B1B

	)

272 
	#SIOCSIWNICKN
 0x8B1C

	)

273 
	#SIOCGIWNICKN
 0x8B1D

	)

279 
	#SIOCSIWRATE
 0x8B20

	)

280 
	#SIOCGIWRATE
 0x8B21

	)

281 
	#SIOCSIWRTS
 0x8B22

	)

282 
	#SIOCGIWRTS
 0x8B23

	)

283 
	#SIOCSIWFRAG
 0x8B24

	)

284 
	#SIOCGIWFRAG
 0x8B25

	)

285 
	#SIOCSIWTXPOW
 0x8B26

	)

286 
	#SIOCGIWTXPOW
 0x8B27

	)

287 
	#SIOCSIWRETRY
 0x8B28

	)

288 
	#SIOCGIWRETRY
 0x8B29

	)

291 
	#SIOCSIWENCODE
 0x8B2A

	)

292 
	#SIOCGIWENCODE
 0x8B2B

	)

294 
	#SIOCSIWPOWER
 0x8B2C

	)

295 
	#SIOCGIWPOWER
 0x8B2D

	)

304 
	#SIOCSIWGENIE
 0x8B30

	)

305 
	#SIOCGIWGENIE
 0x8B31

	)

308 
	#SIOCSIWMLME
 0x8B16

	)

311 
	#SIOCSIWAUTH
 0x8B32

	)

312 
	#SIOCGIWAUTH
 0x8B33

	)

315 
	#SIOCSIWENCODEEXT
 0x8B34

	)

316 
	#SIOCGIWENCODEEXT
 0x8B35

	)

319 
	#SIOCSIWPMKSA
 0x8B36

	)

330 
	#SIOCIWFIRSTPRIV
 0x8BE0

	)

331 
	#SIOCIWLASTPRIV
 0x8BFF

	)

346 
	#SIOCIWFIRST
 0x8B00

	)

347 
	#SIOCIWLAST
 
SIOCIWLASTPRIV


	)

348 
	#IW_IOCTL_IDX
(
cmd
Ë((cmdË- 
SIOCIWFIRST
)

	)

351 
	#IW_IS_SET
(
cmd
Ë(!((cmdË& 0x1))

	)

352 
	#IW_IS_GET
(
cmd
Ë((cmdË& 0x1)

	)

358 
	#IWEVTXDROP
 0x8C00

	)

359 
	#IWEVQUAL
 0x8C01

	)

360 
	#IWEVCUSTOM
 0x8C02

	)

361 
	#IWEVREGISTERED
 0x8C03

	)

362 
	#IWEVEXPIRED
 0x8C04

	)

363 
	#IWEVGENIE
 0x8C05

	)

369 
	#IWEVMICHAELMICFAILURE
 0x8C06

	)

372 
	#IWEVASSOCREQIE
 0x8C07

	)

381 
	#IWEVASSOCRESPIE
 0x8C08

	)

388 
	#IWEVPMKIDCAND
 0x8C09

	)

392 
	#IWEVFIRST
 0x8C00

	)

393 
	#IW_EVENT_IDX
(
cmd
Ë((cmdË- 
IWEVFIRST
)

	)

402 
	#IW_PRIV_TYPE_MASK
 0x7000

	)

403 
	#IW_PRIV_TYPE_NONE
 0x0000

	)

404 
	#IW_PRIV_TYPE_BYTE
 0x1000

	)

405 
	#IW_PRIV_TYPE_CHAR
 0x2000

	)

406 
	#IW_PRIV_TYPE_INT
 0x4000

	)

407 
	#IW_PRIV_TYPE_FLOAT
 0x5000

	)

408 
	#IW_PRIV_TYPE_ADDR
 0x6000

	)

410 
	#IW_PRIV_SIZE_FIXED
 0x0800

	)

412 
	#IW_PRIV_SIZE_MASK
 0x07FF

	)

422 
	#IW_MAX_FREQUENCIES
 32

	)

428 
	#IW_MAX_BITRATES
 32

	)

431 
	#IW_MAX_TXPOWER
 8

	)

436 
	#IW_MAX_SPY
 8

	)

440 
	#IW_MAX_AP
 64

	)

443 
	#IW_ESSID_MAX_SIZE
 32

	)

446 
	#IW_MODE_AUTO
 0

	)

447 
	#IW_MODE_ADHOC
 1

	)

448 
	#IW_MODE_INFRA
 2

	)

449 
	#IW_MODE_MASTER
 3

	)

450 
	#IW_MODE_REPEAT
 4

	)

451 
	#IW_MODE_SECOND
 5

	)

452 
	#IW_MODE_MONITOR
 6

	)

453 
	#IW_MODE_MESH
 7

	)

456 
	#IW_QUAL_QUAL_UPDATED
 0x01

	)

457 
	#IW_QUAL_LEVEL_UPDATED
 0x02

	)

458 
	#IW_QUAL_NOISE_UPDATED
 0x04

	)

459 
	#IW_QUAL_ALL_UPDATED
 0x07

	)

460 
	#IW_QUAL_DBM
 0x08

	)

461 
	#IW_QUAL_QUAL_INVALID
 0x10

	)

462 
	#IW_QUAL_LEVEL_INVALID
 0x20

	)

463 
	#IW_QUAL_NOISE_INVALID
 0x40

	)

464 
	#IW_QUAL_RCPI
 0x80

	)

465 
	#IW_QUAL_ALL_INVALID
 0x70

	)

468 
	#IW_FREQ_AUTO
 0x00

	)

469 
	#IW_FREQ_FIXED
 0x01

	)

473 
	#IW_MAX_ENCODING_SIZES
 8

	)

476 
	#IW_ENCODING_TOKEN_MAX
 64

	)

479 
	#IW_ENCODE_INDEX
 0x00FF

	)

480 
	#IW_ENCODE_FLAGS
 0xFF00

	)

481 
	#IW_ENCODE_MODE
 0xF000

	)

482 
	#IW_ENCODE_DISABLED
 0x8000

	)

483 
	#IW_ENCODE_ENABLED
 0x0000

	)

484 
	#IW_ENCODE_RESTRICTED
 0x4000

	)

485 
	#IW_ENCODE_OPEN
 0x2000

	)

486 
	#IW_ENCODE_NOKEY
 0x0800

	)

487 
	#IW_ENCODE_TEMP
 0x0400

	)

490 
	#IW_POWER_ON
 0x0000

	)

491 
	#IW_POWER_TYPE
 0xF000

	)

492 
	#IW_POWER_PERIOD
 0x1000

	)

493 
	#IW_POWER_TIMEOUT
 0x2000

	)

494 
	#IW_POWER_MODE
 0x0F00

	)

495 
	#IW_POWER_UNICAST_R
 0x0100

	)

496 
	#IW_POWER_MULTICAST_R
 0x0200

	)

497 
	#IW_POWER_ALL_R
 0x0300

	)

498 
	#IW_POWER_FORCE_S
 0x0400

	)

499 
	#IW_POWER_REPEATER
 0x0800

	)

500 
	#IW_POWER_MODIFIER
 0x000F

	)

501 
	#IW_POWER_MIN
 0x0001

	)

502 
	#IW_POWER_MAX
 0x0002

	)

503 
	#IW_POWER_RELATIVE
 0x0004

	)

506 
	#IW_TXPOW_TYPE
 0x00FF

	)

507 
	#IW_TXPOW_DBM
 0x0000

	)

508 
	#IW_TXPOW_MWATT
 0x0001

	)

509 
	#IW_TXPOW_RELATIVE
 0x0002

	)

510 
	#IW_TXPOW_RANGE
 0x1000

	)

513 
	#IW_RETRY_ON
 0x0000

	)

514 
	#IW_RETRY_TYPE
 0xF000

	)

515 
	#IW_RETRY_LIMIT
 0x1000

	)

516 
	#IW_RETRY_LIFETIME
 0x2000

	)

517 
	#IW_RETRY_MODIFIER
 0x00FF

	)

518 
	#IW_RETRY_MIN
 0x0001

	)

519 
	#IW_RETRY_MAX
 0x0002

	)

520 
	#IW_RETRY_RELATIVE
 0x0004

	)

521 
	#IW_RETRY_SHORT
 0x0010

	)

522 
	#IW_RETRY_LONG
 0x0020

	)

525 
	#IW_SCAN_DEFAULT
 0x0000

	)

526 
	#IW_SCAN_ALL_ESSID
 0x0001

	)

527 
	#IW_SCAN_THIS_ESSID
 0x0002

	)

528 
	#IW_SCAN_ALL_FREQ
 0x0004

	)

529 
	#IW_SCAN_THIS_FREQ
 0x0008

	)

530 
	#IW_SCAN_ALL_MODE
 0x0010

	)

531 
	#IW_SCAN_THIS_MODE
 0x0020

	)

532 
	#IW_SCAN_ALL_RATE
 0x0040

	)

533 
	#IW_SCAN_THIS_RATE
 0x0080

	)

535 
	#IW_SCAN_TYPE_ACTIVE
 0

	)

536 
	#IW_SCAN_TYPE_PASSIVE
 1

	)

538 
	#IW_SCAN_MAX_DATA
 4096

	)

541 
	#IW_SCAN_CAPA_NONE
 0x00

	)

542 
	#IW_SCAN_CAPA_ESSID
 0x01

	)

543 
	#IW_SCAN_CAPA_BSSID
 0x02

	)

544 
	#IW_SCAN_CAPA_CHANNEL
 0x04

	)

545 
	#IW_SCAN_CAPA_MODE
 0x08

	)

546 
	#IW_SCAN_CAPA_RATE
 0x10

	)

547 
	#IW_SCAN_CAPA_TYPE
 0x20

	)

548 
	#IW_SCAN_CAPA_TIME
 0x40

	)

551 
	#IW_CUSTOM_MAX
 256

	)

554 
	#IW_GENERIC_IE_MAX
 1024

	)

557 
	#IW_MLME_DEAUTH
 0

	)

558 
	#IW_MLME_DISASSOC
 1

	)

559 
	#IW_MLME_AUTH
 2

	)

560 
	#IW_MLME_ASSOC
 3

	)

563 
	#IW_AUTH_INDEX
 0x0FFF

	)

564 
	#IW_AUTH_FLAGS
 0xF000

	)

569 
	#IW_AUTH_WPA_VERSION
 0

	)

570 
	#IW_AUTH_CIPHER_PAIRWISE
 1

	)

571 
	#IW_AUTH_CIPHER_GROUP
 2

	)

572 
	#IW_AUTH_KEY_MGMT
 3

	)

573 
	#IW_AUTH_TKIP_COUNTERMEASURES
 4

	)

574 
	#IW_AUTH_DROP_UNENCRYPTED
 5

	)

575 
	#IW_AUTH_80211_AUTH_ALG
 6

	)

576 
	#IW_AUTH_WPA_ENABLED
 7

	)

577 
	#IW_AUTH_RX_UNENCRYPTED_EAPOL
 8

	)

578 
	#IW_AUTH_ROAMING_CONTROL
 9

	)

579 
	#IW_AUTH_PRIVACY_INVOKED
 10

	)

580 
	#IW_AUTH_CIPHER_GROUP_MGMT
 11

	)

581 
	#IW_AUTH_MFP
 12

	)

584 
	#IW_AUTH_WPA_VERSION_DISABLED
 0x00000001

	)

585 
	#IW_AUTH_WPA_VERSION_WPA
 0x00000002

	)

586 
	#IW_AUTH_WPA_VERSION_WPA2
 0x00000004

	)

590 
	#IW_AUTH_CIPHER_NONE
 0x00000001

	)

591 
	#IW_AUTH_CIPHER_WEP40
 0x00000002

	)

592 
	#IW_AUTH_CIPHER_TKIP
 0x00000004

	)

593 
	#IW_AUTH_CIPHER_CCMP
 0x00000008

	)

594 
	#IW_AUTH_CIPHER_WEP104
 0x00000010

	)

595 
	#IW_AUTH_CIPHER_AES_CMAC
 0x00000020

	)

598 
	#IW_AUTH_KEY_MGMT_802_1X
 1

	)

599 
	#IW_AUTH_KEY_MGMT_PSK
 2

	)

602 
	#IW_AUTH_ALG_OPEN_SYSTEM
 0x00000001

	)

603 
	#IW_AUTH_ALG_SHARED_KEY
 0x00000002

	)

604 
	#IW_AUTH_ALG_LEAP
 0x00000004

	)

607 
	#IW_AUTH_ROAMING_ENABLE
 0

	)

608 
	#IW_AUTH_ROAMING_DISABLE
 1

	)

612 
	#IW_AUTH_MFP_DISABLED
 0

	)

613 
	#IW_AUTH_MFP_OPTIONAL
 1

	)

614 
	#IW_AUTH_MFP_REQUIRED
 2

	)

617 
	#IW_ENCODE_SEQ_MAX_SIZE
 8

	)

619 
	#IW_ENCODE_ALG_NONE
 0

	)

620 
	#IW_ENCODE_ALG_WEP
 1

	)

621 
	#IW_ENCODE_ALG_TKIP
 2

	)

622 
	#IW_ENCODE_ALG_CCMP
 3

	)

623 
	#IW_ENCODE_ALG_PMK
 4

	)

624 
	#IW_ENCODE_ALG_AES_CMAC
 5

	)

626 
	#IW_ENCODE_EXT_TX_SEQ_VALID
 0x00000001

	)

627 
	#IW_ENCODE_EXT_RX_SEQ_VALID
 0x00000002

	)

628 
	#IW_ENCODE_EXT_GROUP_KEY
 0x00000004

	)

629 
	#IW_ENCODE_EXT_SET_TX_KEY
 0x00000008

	)

632 
	#IW_MICFAILURE_KEY_ID
 0x00000003

	)

633 
	#IW_MICFAILURE_GROUP
 0x00000004

	)

634 
	#IW_MICFAILURE_PAIRWISE
 0x00000008

	)

635 
	#IW_MICFAILURE_STAKEY
 0x00000010

	)

636 
	#IW_MICFAILURE_COUNT
 0x00000060

	)

640 
	#IW_ENC_CAPA_WPA
 0x00000001

	)

641 
	#IW_ENC_CAPA_WPA2
 0x00000002

	)

642 
	#IW_ENC_CAPA_CIPHER_TKIP
 0x00000004

	)

643 
	#IW_ENC_CAPA_CIPHER_CCMP
 0x00000008

	)

644 
	#IW_ENC_CAPA_4WAY_HANDSHAKE
 0x00000010

	)

649 
	#IW_EVENT_CAPA_BASE
(
cmd
Ë((cmd >
SIOCIWFIRSTPRIV
) ? \

650 (
cmd
 - 
SIOCIWFIRSTPRIV
 + 0x60) : \

651 (
cmd
 - 
SIOCSIWCOMMIT
))

	)

652 
	#IW_EVENT_CAPA_INDEX
(
cmd
Ë(
	`IW_EVENT_CAPA_BASE
(cmdË>> 5)

	)

653 
	#IW_EVENT_CAPA_MASK
(
cmd
Ë(1 << (
	`IW_EVENT_CAPA_BASE
(cmdË& 0x1F))

	)

656 
	#IW_EVENT_CAPA_K_0
 (
	`IW_EVENT_CAPA_MASK
(0x8B04) | \

657 
	`IW_EVENT_CAPA_MASK
(0x8B06) | \

658 
	`IW_EVENT_CAPA_MASK
(0x8B1A))

	)

659 
	#IW_EVENT_CAPA_K_1
 (
	`IW_EVENT_CAPA_MASK
(0x8B2A))

	)

661 
	#IW_EVENT_CAPA_SET
(
evít_ˇ∑
, 
cmd
Ë”vít_ˇ∑[
	`IW_EVENT_CAPA_INDEX
(cmd)] |
	`IW_EVENT_CAPA_MASK
(cmd))

	)

662 
	#IW_EVENT_CAPA_SET_KERNEL
(
evít_ˇ∑
Ë{evít_ˇ∑[0] |
IW_EVENT_CAPA_K_0
;Évít_ˇ∑[1] |
IW_EVENT_CAPA_K_1
; }

	)

671 
	siw_∑øm


673 
__s32
 
	mvÆue
;

674 
__u8
 
	mfixed
;

675 
__u8
 
	mdißbÀd
;

676 
__u16
 
	mÊags
;

683 
	siw_poöt


685 *
	mpoöãr
;

686 
__u16
 
	mÀngth
;

687 
__u16
 
	mÊags
;

699 
	siw_‰eq


701 
__s32
 
	mm
;

702 
__s16
 
	me
;

703 
__u8
 
	mi
;

704 
__u8
 
	mÊags
;

710 
	siw_quÆôy


712 
__u8
 
	mquÆ
;

714 
__u8
 
	mÀvñ
;

715 
__u8
 
	mnoi£
;

716 
__u8
 
	mupd©ed
;

726 
	siw_disˇrded


728 
__u32
 
	mnwid
;

729 
__u32
 
	mcode
;

730 
__u32
 
	m‰agmít
;

731 
__u32
 
	mªåõs
;

732 
__u32
 
	mmisc
;

739 
	siw_mis£d


741 
__u32
 
	mbóc⁄
;

747 
	siw_thr•y


749 
sockaddr
 
	maddr
;

750 
iw_quÆôy
 
	mquÆ
;

751 
iw_quÆôy
 
	mlow
;

752 
iw_quÆôy
 
	mhigh
;

766 
	siw_sˇn_ªq


768 
__u8
 
	msˇn_ty≥
;

769 
__u8
 
	messid_Àn
;

770 
__u8
 
	mnum_ch™√ls
;

772 
__u8
 
	mÊags
;

775 
sockaddr
 
	mbssid
;

784 
__u8
 
	messid
[
IW_ESSID_MAX_SIZE
];

796 
__u32
 
	mmö_ch™√l_time
;

797 
__u32
 
	mmax_ch™√l_time
;

799 
iw_‰eq
 
	mch™√l_li°
[
IW_MAX_FREQUENCIES
];

828 
	siw_ícode_ext


830 
__u32
 
	mext_Êags
;

831 
__u8
 
	mtx_£q
[
IW_ENCODE_SEQ_MAX_SIZE
];

832 
__u8
 
	mrx_£q
[
IW_ENCODE_SEQ_MAX_SIZE
];

833 
sockaddr
 
	maddr
;

836 
__u16
 
	mÆg
;

837 
__u16
 
	mkey_Àn
;

838 
__u8
 
	mkey
[0];

842 
	siw_mlme


844 
__u16
 
	mcmd
;

845 
__u16
 
	mªas⁄_code
;

846 
sockaddr
 
	maddr
;

850 
	#IW_PMKSA_ADD
 1

	)

851 
	#IW_PMKSA_REMOVE
 2

	)

852 
	#IW_PMKSA_FLUSH
 3

	)

854 
	#IW_PMKID_LEN
 16

	)

856 
	siw_pmkß


858 
__u32
 
	mcmd
;

859 
sockaddr
 
	mbssid
;

860 
__u8
 
	mpmkid
[
IW_PMKID_LEN
];

864 
	siw_mich´lmicÁûuª


866 
__u32
 
	mÊags
;

867 
sockaddr
 
	m§c_addr
;

868 
__u8
 
	mtsc
[
IW_ENCODE_SEQ_MAX_SIZE
];

872 
	#IW_PMKID_CAND_PREAUTH
 0x00000001

	)

873 
	siw_pmkid_ˇnd


875 
__u32
 
	mÊags
;

876 
__u32
 
	mödex
;

878 
sockaddr
 
	mbssid
;

885 
	siw_°©i°ics


887 
__u16
 
	m°©us
;

890 
iw_quÆôy
 
	mquÆ
;

892 
iw_disˇrded
 
	mdisˇrd
;

893 
iw_mis£d
 
	mmiss
;

907 
	uiwªq_d©a


910 
	m«me
[
IFNAMSIZ
];

914 
iw_poöt
 
	messid
;

915 
iw_∑øm
 
	mnwid
;

916 
iw_‰eq
 
	m‰eq
;

920 
iw_∑øm
 
	m£ns
;

921 
iw_∑øm
 
	mbôøã
;

922 
iw_∑øm
 
	mtxpowî
;

923 
iw_∑øm
 
	mπs
;

924 
iw_∑øm
 
	m‰ag
;

925 
__u32
 
	mmode
;

926 
iw_∑øm
 
	mªåy
;

928 
iw_poöt
 
	mícodög
;

929 
iw_∑øm
 
	mpowî
;

930 
iw_quÆôy
 
	mquÆ
;

932 
sockaddr
 
	m≠_addr
;

933 
sockaddr
 
	maddr
;

935 
iw_∑øm
 
	m∑øm
;

936 
iw_poöt
 
	md©a
;

945 
	siwªq


949 
	mi‰n_«me
[
IFNAMSIZ
];

950 } 
	mi‰_i‰n
;

953 
iwªq_d©a
 
	mu
;

966 
	siw_ønge


969 
__u32
 
	mthroughput
;

978 
__u32
 
	mmö_nwid
;

979 
__u32
 
	mmax_nwid
;

982 
__u16
 
	mﬁd_num_ch™√ls
;

983 
__u8
 
	mﬁd_num_‰equícy
;

986 
__u8
 
	msˇn_ˇ∑
;

989 
__u32
 
	mevít_ˇ∑
[6];

992 
__s32
 
	m£nsôivôy
;

999 
iw_quÆôy
 
	mmax_quÆ
;

1009 
iw_quÆôy
 
	mavg_quÆ
;

1012 
__u8
 
	mnum_bôøãs
;

1013 
__s32
 
	mbôøã
[
IW_MAX_BITRATES
];

1016 
__s32
 
	mmö_πs
;

1017 
__s32
 
	mmax_πs
;

1020 
__s32
 
	mmö_‰ag
;

1021 
__s32
 
	mmax_‰ag
;

1024 
__s32
 
	mmö_pmp
;

1025 
__s32
 
	mmax_pmp
;

1026 
__s32
 
	mmö_pmt
;

1027 
__s32
 
	mmax_pmt
;

1028 
__u16
 
	mpmp_Êags
;

1029 
__u16
 
	mpmt_Êags
;

1030 
__u16
 
	mpm_ˇ∑
;

1033 
__u16
 
	mícodög_size
[
IW_MAX_ENCODING_SIZES
];

1034 
__u8
 
	mnum_ícodög_sizes
;

1035 
__u8
 
	mmax_ícodög_tokís
;

1037 
__u8
 
	mícodög_logö_ödex
;

1040 
__u16
 
	mtxpowî_ˇ∑
;

1041 
__u8
 
	mnum_txpowî
;

1042 
__s32
 
	mtxpowî
[
IW_MAX_TXPOWER
];

1045 
__u8
 
	mwe_vîsi⁄_compûed
;

1046 
__u8
 
	mwe_vîsi⁄_sour˚
;

1049 
__u16
 
	mªåy_ˇ∑
;

1050 
__u16
 
	mªåy_Êags
;

1051 
__u16
 
	mr_time_Êags
;

1052 
__s32
 
	mmö_ªåy
;

1053 
__s32
 
	mmax_ªåy
;

1054 
__s32
 
	mmö_r_time
;

1055 
__s32
 
	mmax_r_time
;

1058 
__u16
 
	mnum_ch™√ls
;

1059 
__u8
 
	mnum_‰equícy
;

1060 
iw_‰eq
 
	m‰eq
[
IW_MAX_FREQUENCIES
];

1064 
__u32
 
	míc_ˇ∑
;

1071 
	siw_¥iv_¨gs


1073 
__u32
 
	mcmd
;

1074 
__u16
 
	m£t_¨gs
;

1075 
__u16
 
	mgë_¨gs
;

1076 
	m«me
[
IFNAMSIZ
];

1089 
	siw_evít


1091 
__u16
 
	mÀn
;

1092 
__u16
 
	mcmd
;

1093 
iwªq_d©a
 
	mu
;

1097 
	#IW_EV_LCP_LEN
 ((
iw_evít
Ë- (
iwªq_d©a
))

	)

1099 
	#IW_EV_CHAR_LEN
 (
IW_EV_LCP_LEN
 + 
IFNAMSIZ
)

	)

1100 
	#IW_EV_UINT_LEN
 (
IW_EV_LCP_LEN
 + (
__u32
))

	)

1101 
	#IW_EV_FREQ_LEN
 (
IW_EV_LCP_LEN
 + (
iw_‰eq
))

	)

1102 
	#IW_EV_PARAM_LEN
 (
IW_EV_LCP_LEN
 + (
iw_∑øm
))

	)

1103 
	#IW_EV_ADDR_LEN
 (
IW_EV_LCP_LEN
 + (
sockaddr
))

	)

1104 
	#IW_EV_QUAL_LEN
 (
IW_EV_LCP_LEN
 + (
iw_quÆôy
))

	)

1109 
	#IW_EV_POINT_OFF
 (((*Ë&(((
iw_poöt
 *Ë
NULL
)->
Àngth
)) - \

1110 (*Ë
NULL
)

	)

1111 
	#IW_EV_POINT_LEN
 (
IW_EV_LCP_LEN
 + (
iw_poöt
) - \

1112 
IW_EV_POINT_OFF
)

	)

1116 
	#IW_EV_LCP_PK_LEN
 (4)

	)

1118 
	#IW_EV_CHAR_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + 
IFNAMSIZ
)

	)

1119 
	#IW_EV_UINT_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
__u32
))

	)

1120 
	#IW_EV_FREQ_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_‰eq
))

	)

1121 
	#IW_EV_PARAM_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_∑øm
))

	)

1122 
	#IW_EV_ADDR_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
sockaddr
))

	)

1123 
	#IW_EV_QUAL_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_quÆôy
))

	)

1124 
	#IW_EV_POINT_PK_LEN
 (
IW_EV_LCP_LEN
 + 4)

	)

	@/usr/include/asm/errno.h

1 
	~<asm-gíîic/î∫o.h
>

	@/usr/include/asm/unistd.h

1 #ifde‡
__i386__


2 
	~"uni°d_32.h
"

4 
	~"uni°d_64.h
"

	@/usr/include/linux/byteorder/little_endian.h

1 #i‚de‡
_LINUX_BYTEORDER_LITTLE_ENDIAN_H


2 
	#_LINUX_BYTEORDER_LITTLE_ENDIAN_H


	)

4 #i‚de‡
__LITTLE_ENDIAN


5 
	#__LITTLE_ENDIAN
 1234

	)

7 #i‚de‡
__LITTLE_ENDIAN_BITFIELD


8 
	#__LITTLE_ENDIAN_BITFIELD


	)

11 
	~<löux/ty≥s.h
>

12 
	~<löux/swab.h
>

14 
	#__c⁄°™t_ht⁄l
(
x
Ë((
__be32
)
	`___c⁄°™t_swab32
((x)))

	)

15 
	#__c⁄°™t_¡ohl
(
x
Ë
	`___c⁄°™t_swab32
((
__be32
)(x))

	)

16 
	#__c⁄°™t_ht⁄s
(
x
Ë((
__be16
)
	`___c⁄°™t_swab16
((x)))

	)

17 
	#__c⁄°™t_¡ohs
(
x
Ë
	`___c⁄°™t_swab16
((
__be16
)(x))

	)

18 
	#__c⁄°™t_˝u_to_À64
(
x
Ë((
__À64
)(
__u64
)(x))

	)

19 
	#__c⁄°™t_À64_to_˝u
(
x
Ë((
__u64
)(
__À64
)(x))

	)

20 
	#__c⁄°™t_˝u_to_À32
(
x
Ë((
__À32
)(
__u32
)(x))

	)

21 
	#__c⁄°™t_À32_to_˝u
(
x
Ë((
__u32
)(
__À32
)(x))

	)

22 
	#__c⁄°™t_˝u_to_À16
(
x
Ë((
__À16
)(
__u16
)(x))

	)

23 
	#__c⁄°™t_À16_to_˝u
(
x
Ë((
__u16
)(
__À16
)(x))

	)

24 
	#__c⁄°™t_˝u_to_be64
(
x
Ë((
__be64
)
	`___c⁄°™t_swab64
((x)))

	)

25 
	#__c⁄°™t_be64_to_˝u
(
x
Ë
	`___c⁄°™t_swab64
((
__u64
)(
__be64
)(x))

	)

26 
	#__c⁄°™t_˝u_to_be32
(
x
Ë((
__be32
)
	`___c⁄°™t_swab32
((x)))

	)

27 
	#__c⁄°™t_be32_to_˝u
(
x
Ë
	`___c⁄°™t_swab32
((
__u32
)(
__be32
)(x))

	)

28 
	#__c⁄°™t_˝u_to_be16
(
x
Ë((
__be16
)
	`___c⁄°™t_swab16
((x)))

	)

29 
	#__c⁄°™t_be16_to_˝u
(
x
Ë
	`___c⁄°™t_swab16
((
__u16
)(
__be16
)(x))

	)

30 
	#__˝u_to_À64
(
x
Ë((
__À64
)(
__u64
)(x))

	)

31 
	#__À64_to_˝u
(
x
Ë((
__u64
)(
__À64
)(x))

	)

32 
	#__˝u_to_À32
(
x
Ë((
__À32
)(
__u32
)(x))

	)

33 
	#__À32_to_˝u
(
x
Ë((
__u32
)(
__À32
)(x))

	)

34 
	#__˝u_to_À16
(
x
Ë((
__À16
)(
__u16
)(x))

	)

35 
	#__À16_to_˝u
(
x
Ë((
__u16
)(
__À16
)(x))

	)

36 
	#__˝u_to_be64
(
x
Ë((
__be64
)
	`__swab64
((x)))

	)

37 
	#__be64_to_˝u
(
x
Ë
	`__swab64
((
__u64
)(
__be64
)(x))

	)

38 
	#__˝u_to_be32
(
x
Ë((
__be32
)
	`__swab32
((x)))

	)

39 
	#__be32_to_˝u
(
x
Ë
	`__swab32
((
__u32
)(
__be32
)(x))

	)

40 
	#__˝u_to_be16
(
x
Ë((
__be16
)
	`__swab16
((x)))

	)

41 
	#__be16_to_˝u
(
x
Ë
	`__swab16
((
__u16
)(
__be16
)(x))

	)

43 
__ölöe__
 
__À64
 
	$__˝u_to_À64p
(c⁄° 
__u64
 *
p
)

45  (
__À64
)*
p
;

46 
	}
}

47 
__ölöe__
 
__u64
 
	$__À64_to_˝up
(c⁄° 
__À64
 *
p
)

49  (
__u64
)*
p
;

50 
	}
}

51 
__ölöe__
 
__À32
 
	$__˝u_to_À32p
(c⁄° 
__u32
 *
p
)

53  (
__À32
)*
p
;

54 
	}
}

55 
__ölöe__
 
__u32
 
	$__À32_to_˝up
(c⁄° 
__À32
 *
p
)

57  (
__u32
)*
p
;

58 
	}
}

59 
__ölöe__
 
__À16
 
	$__˝u_to_À16p
(c⁄° 
__u16
 *
p
)

61  (
__À16
)*
p
;

62 
	}
}

63 
__ölöe__
 
__u16
 
	$__À16_to_˝up
(c⁄° 
__À16
 *
p
)

65  (
__u16
)*
p
;

66 
	}
}

67 
__ölöe__
 
__be64
 
	$__˝u_to_be64p
(c⁄° 
__u64
 *
p
)

69  (
__be64
)
	`__swab64p
(
p
);

70 
	}
}

71 
__ölöe__
 
__u64
 
	$__be64_to_˝up
(c⁄° 
__be64
 *
p
)

73  
	`__swab64p
((
__u64
 *)
p
);

74 
	}
}

75 
__ölöe__
 
__be32
 
	$__˝u_to_be32p
(c⁄° 
__u32
 *
p
)

77  (
__be32
)
	`__swab32p
(
p
);

78 
	}
}

79 
__ölöe__
 
__u32
 
	$__be32_to_˝up
(c⁄° 
__be32
 *
p
)

81  
	`__swab32p
((
__u32
 *)
p
);

82 
	}
}

83 
__ölöe__
 
__be16
 
	$__˝u_to_be16p
(c⁄° 
__u16
 *
p
)

85  (
__be16
)
	`__swab16p
(
p
);

86 
	}
}

87 
__ölöe__
 
__u16
 
	$__be16_to_˝up
(c⁄° 
__be16
 *
p
)

89  
	`__swab16p
((
__u16
 *)
p
);

90 
	}
}

91 
	#__˝u_to_À64s
(
x
Ëdÿ{ ()(x); } 0)

	)

92 
	#__À64_to_˝us
(
x
Ëdÿ{ ()(x); } 0)

	)

93 
	#__˝u_to_À32s
(
x
Ëdÿ{ ()(x); } 0)

	)

94 
	#__À32_to_˝us
(
x
Ëdÿ{ ()(x); } 0)

	)

95 
	#__˝u_to_À16s
(
x
Ëdÿ{ ()(x); } 0)

	)

96 
	#__À16_to_˝us
(
x
Ëdÿ{ ()(x); } 0)

	)

97 
	#__˝u_to_be64s
(
x
Ë
	`__swab64s
((x))

	)

98 
	#__be64_to_˝us
(
x
Ë
	`__swab64s
((x))

	)

99 
	#__˝u_to_be32s
(
x
Ë
	`__swab32s
((x))

	)

100 
	#__be32_to_˝us
(
x
Ë
	`__swab32s
((x))

	)

101 
	#__˝u_to_be16s
(
x
Ë
	`__swab16s
((x))

	)

102 
	#__be16_to_˝us
(
x
Ë
	`__swab16s
((x))

	)

	@/usr/include/linux/hdlc/ioctl.h

1 #i‚de‡
__HDLC_IOCTL_H__


2 
	#__HDLC_IOCTL_H__


	)

5 
	#GENERIC_HDLC_VERSION
 4

	)

7 
	#CLOCK_DEFAULT
 0

	)

8 
	#CLOCK_EXT
 1

	)

9 
	#CLOCK_INT
 2

	)

10 
	#CLOCK_TXINT
 3

	)

11 
	#CLOCK_TXFROMRX
 4

	)

14 
	#ENCODING_DEFAULT
 0

	)

15 
	#ENCODING_NRZ
 1

	)

16 
	#ENCODING_NRZI
 2

	)

17 
	#ENCODING_FM_MARK
 3

	)

18 
	#ENCODING_FM_SPACE
 4

	)

19 
	#ENCODING_MANCHESTER
 5

	)

22 
	#PARITY_DEFAULT
 0

	)

23 
	#PARITY_NONE
 1

	)

24 
	#PARITY_CRC16_PR0
 2

	)

25 
	#PARITY_CRC16_PR1
 3

	)

26 
	#PARITY_CRC16_PR0_CCITT
 4

	)

27 
	#PARITY_CRC16_PR1_CCITT
 5

	)

28 
	#PARITY_CRC32_PR0_CCITT
 6

	)

29 
	#PARITY_CRC32_PR1_CCITT
 7

	)

31 
	#LMI_DEFAULT
 0

	)

32 
	#LMI_NONE
 1

	)

33 
	#LMI_ANSI
 2

	)

34 
	#LMI_CCITT
 3

	)

35 
	#LMI_CISCO
 4

	)

38 
	m˛ock_øã
;

39 
	m˛ock_ty≥
;

40 
	mlo›back
;

41 } 
	tsync_£rül_£âögs
;

44 
	m˛ock_øã
;

45 
	m˛ock_ty≥
;

46 
	mlo›back
;

47 
	m¶Ÿ_m≠
;

48 } 
	tã1_£âögs
;

51 
	mícodög
;

52 
	m∑rôy
;

53 } 
	tøw_hdlc_¥Ÿo
;

56 
	mt391
;

57 
	mt392
;

58 
	mn391
;

59 
	mn392
;

60 
	mn393
;

61 
	mlmi
;

62 
	md˚
;

63 } 
	t‰_¥Ÿo
;

66 
	mdlci
;

67 } 
	t‰_¥Ÿo_pvc
;

70 
	mdlci
;

71 
	mma°î
[
IFNAMSIZ
];

72 }
	t‰_¥Ÿo_pvc_öfo
;

75 
	möãrvÆ
;

76 
	mtimeout
;

77 } 
	tcisco_¥Ÿo
;

	@/usr/include/linux/if_addr.h

1 #i‚de‡
__LINUX_IF_ADDR_H


2 
	#__LINUX_IF_ADDR_H


	)

4 
	~<löux/ty≥s.h
>

5 
	~<löux/√éök.h
>

7 
	siÁddrmsg


9 
__u8
 
	miÁ_Ámûy
;

10 
__u8
 
	miÁ_¥efixÀn
;

11 
__u8
 
	miÁ_Êags
;

12 
__u8
 
	miÁ_sc›e
;

13 
__u32
 
	miÁ_ödex
;

25 
	mIFA_UNSPEC
,

26 
	mIFA_ADDRESS
,

27 
	mIFA_LOCAL
,

28 
	mIFA_LABEL
,

29 
	mIFA_BROADCAST
,

30 
	mIFA_ANYCAST
,

31 
	mIFA_CACHEINFO
,

32 
	mIFA_MULTICAST
,

33 
	m__IFA_MAX
,

36 
	#IFA_MAX
 (
__IFA_MAX
 - 1)

	)

39 
	#IFA_F_SECONDARY
 0x01

	)

40 
	#IFA_F_TEMPORARY
 
IFA_F_SECONDARY


	)

42 
	#IFA_F_NODAD
 0x02

	)

43 
	#IFA_F_OPTIMISTIC
 0x04

	)

44 
	#IFA_F_DADFAILED
 0x08

	)

45 
	#IFA_F_HOMEADDRESS
 0x10

	)

46 
	#IFA_F_DEPRECATED
 0x20

	)

47 
	#IFA_F_TENTATIVE
 0x40

	)

48 
	#IFA_F_PERMANENT
 0x80

	)

50 
	siÁ_ˇcheöfo


52 
__u32
 
	miÁ_¥e„ªd
;

53 
__u32
 
	miÁ_vÆid
;

54 
__u32
 
	mc°amp
;

55 
__u32
 
	mt°amp
;

59 
	#IFA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
iÁddrmsg
))))

	)

60 
	#IFA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
iÁddrmsg
))

	)

	@/usr/include/linux/if_ether.h

21 #i‚de‡
_LINUX_IF_ETHER_H


22 
	#_LINUX_IF_ETHER_H


	)

24 
	~<löux/ty≥s.h
>

31 
	#ETH_ALEN
 6

	)

32 
	#ETH_HLEN
 14

	)

33 
	#ETH_ZLEN
 60

	)

34 
	#ETH_DATA_LEN
 1500

	)

35 
	#ETH_FRAME_LEN
 1514

	)

36 
	#ETH_FCS_LEN
 4

	)

42 
	#ETH_P_LOOP
 0x0060

	)

43 
	#ETH_P_PUP
 0x0200

	)

44 
	#ETH_P_PUPAT
 0x0201

	)

45 
	#ETH_P_IP
 0x0800

	)

46 
	#ETH_P_X25
 0x0805

	)

47 
	#ETH_P_ARP
 0x0806

	)

48 
	#ETH_P_BPQ
 0x08FF

	)

49 
	#ETH_P_IEEEPUP
 0x0a00

	)

50 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

51 
	#ETH_P_DEC
 0x6000

	)

52 
	#ETH_P_DNA_DL
 0x6001

	)

53 
	#ETH_P_DNA_RC
 0x6002

	)

54 
	#ETH_P_DNA_RT
 0x6003

	)

55 
	#ETH_P_LAT
 0x6004

	)

56 
	#ETH_P_DIAG
 0x6005

	)

57 
	#ETH_P_CUST
 0x6006

	)

58 
	#ETH_P_SCA
 0x6007

	)

59 
	#ETH_P_TEB
 0x6558

	)

60 
	#ETH_P_RARP
 0x8035

	)

61 
	#ETH_P_ATALK
 0x809B

	)

62 
	#ETH_P_AARP
 0x80F3

	)

63 
	#ETH_P_8021Q
 0x8100

	)

64 
	#ETH_P_IPX
 0x8137

	)

65 
	#ETH_P_IPV6
 0x86DD

	)

66 
	#ETH_P_PAUSE
 0x8808

	)

67 
	#ETH_P_SLOW
 0x8809

	)

68 
	#ETH_P_WCCP
 0x883E

	)

70 
	#ETH_P_PPP_DISC
 0x8863

	)

71 
	#ETH_P_PPP_SES
 0x8864

	)

72 
	#ETH_P_MPLS_UC
 0x8847

	)

73 
	#ETH_P_MPLS_MC
 0x8848

	)

74 
	#ETH_P_ATMMPOA
 0x884¯

	)

75 
	#ETH_P_ATMFATE
 0x8884

	)

78 
	#ETH_P_PAE
 0x888E

	)

79 
	#ETH_P_AOE
 0x88A2

	)

80 
	#ETH_P_TIPC
 0x88CA

	)

81 
	#ETH_P_1588
 0x88F7

	)

82 
	#ETH_P_FCOE
 0x8906

	)

83 
	#ETH_P_FIP
 0x8914

	)

84 
	#ETH_P_EDSA
 0xDADA

	)

90 
	#ETH_P_802_3
 0x0001

	)

91 
	#ETH_P_AX25
 0x0002

	)

92 
	#ETH_P_ALL
 0x0003

	)

93 
	#ETH_P_802_2
 0x0004

	)

94 
	#ETH_P_SNAP
 0x0005

	)

95 
	#ETH_P_DDCMP
 0x0006

	)

96 
	#ETH_P_WAN_PPP
 0x0007

	)

97 
	#ETH_P_PPP_MP
 0x0008

	)

98 
	#ETH_P_LOCALTALK
 0x0009

	)

99 
	#ETH_P_CAN
 0x000C

	)

100 
	#ETH_P_PPPTALK
 0x0010

	)

101 
	#ETH_P_TR_802_2
 0x0011

	)

102 
	#ETH_P_MOBITEX
 0x0015

	)

103 
	#ETH_P_CONTROL
 0x0016

	)

104 
	#ETH_P_IRDA
 0x0017

	)

105 
	#ETH_P_ECONET
 0x0018

	)

106 
	#ETH_P_HDLC
 0x0019

	)

107 
	#ETH_P_ARCNET
 0x001A

	)

108 
	#ETH_P_DSA
 0x001B

	)

109 
	#ETH_P_TRAILER
 0x001C

	)

110 
	#ETH_P_PHONET
 0x00F5

	)

111 
	#ETH_P_IEEE802154
 0x00F6

	)

117 
	sëhhdr
 {

118 
	mh_de°
[
ETH_ALEN
];

119 
	mh_sour˚
[
ETH_ALEN
];

120 
__be16
 
	mh_¥Ÿo
;

121 } 
__©åibuã__
((
∑cked
));

	@/usr/include/linux/if_link.h

1 #i‚de‡
_LINUX_IF_LINK_H


2 
	#_LINUX_IF_LINK_H


	)

4 
	~<löux/ty≥s.h
>

5 
	~<löux/√éök.h
>

8 
	sπ∆_lök_°©s


10 
__u32
 
	mrx_∑ckës
;

11 
__u32
 
	mtx_∑ckës
;

12 
__u32
 
	mrx_byãs
;

13 
__u32
 
	mtx_byãs
;

14 
__u32
 
	mrx_îr‹s
;

15 
__u32
 
	mtx_îr‹s
;

16 
__u32
 
	mrx_dr›≥d
;

17 
__u32
 
	mtx_dr›≥d
;

18 
__u32
 
	mmu…iˇ°
;

19 
__u32
 
	mcﬁlisi⁄s
;

22 
__u32
 
	mrx_Àngth_îr‹s
;

23 
__u32
 
	mrx_ovî_îr‹s
;

24 
__u32
 
	mrx_¸c_îr‹s
;

25 
__u32
 
	mrx_‰ame_îr‹s
;

26 
__u32
 
	mrx_fifo_îr‹s
;

27 
__u32
 
	mrx_mis£d_îr‹s
;

30 
__u32
 
	mtx_ab‹ãd_îr‹s
;

31 
__u32
 
	mtx_ˇºõr_îr‹s
;

32 
__u32
 
	mtx_fifo_îr‹s
;

33 
__u32
 
	mtx_hóπbót_îr‹s
;

34 
__u32
 
	mtx_wödow_îr‹s
;

37 
__u32
 
	mrx_com¥es£d
;

38 
__u32
 
	mtx_com¥es£d
;

42 
	sπ∆_lök_ifm≠


44 
__u64
 
	mmem_°¨t
;

45 
__u64
 
	mmem_íd
;

46 
__u64
 
	mba£_addr
;

47 
__u16
 
	múq
;

48 
__u8
 
	mdma
;

49 
__u8
 
	mp‹t
;

54 
	mIFLA_UNSPEC
,

55 
	mIFLA_ADDRESS
,

56 
	mIFLA_BROADCAST
,

57 
	mIFLA_IFNAME
,

58 
	mIFLA_MTU
,

59 
	mIFLA_LINK
,

60 
	mIFLA_QDISC
,

61 
	mIFLA_STATS
,

62 
	mIFLA_COST
,

63 
	#IFLA_COST
 
IFLA_COST


	)

64 
	mIFLA_PRIORITY
,

65 
	#IFLA_PRIORITY
 
IFLA_PRIORITY


	)

66 
	mIFLA_MASTER
,

67 
	#IFLA_MASTER
 
IFLA_MASTER


	)

68 
	mIFLA_WIRELESS
,

69 
	#IFLA_WIRELESS
 
IFLA_WIRELESS


	)

70 
	mIFLA_PROTINFO
,

71 
	#IFLA_PROTINFO
 
IFLA_PROTINFO


	)

72 
	mIFLA_TXQLEN
,

73 
	#IFLA_TXQLEN
 
IFLA_TXQLEN


	)

74 
	mIFLA_MAP
,

75 
	#IFLA_MAP
 
IFLA_MAP


	)

76 
	mIFLA_WEIGHT
,

77 
	#IFLA_WEIGHT
 
IFLA_WEIGHT


	)

78 
	mIFLA_OPERSTATE
,

79 
	mIFLA_LINKMODE
,

80 
	mIFLA_LINKINFO
,

81 
	#IFLA_LINKINFO
 
IFLA_LINKINFO


	)

82 
	mIFLA_NET_NS_PID
,

83 
	mIFLA_IFALIAS
,

84 
	m__IFLA_MAX


88 
	#IFLA_MAX
 (
__IFLA_MAX
 - 1)

	)

91 
	#IFLA_RTA
(
r
Ë((
π©å
*)(((*)‘)Ë+ 
	`NLMSG_ALIGN
((
iföfomsg
))))

	)

92 
	#IFLA_PAYLOAD
(
n
Ë
	`NLMSG_PAYLOAD
“,(
iföfomsg
))

	)

126 
	mIFLA_INET6_UNSPEC
,

127 
	mIFLA_INET6_FLAGS
,

128 
	mIFLA_INET6_CONF
,

129 
	mIFLA_INET6_STATS
,

130 
	mIFLA_INET6_MCAST
,

131 
	mIFLA_INET6_CACHEINFO
,

132 
	mIFLA_INET6_ICMP6STATS
,

133 
	m__IFLA_INET6_MAX


136 
	#IFLA_INET6_MAX
 (
__IFLA_INET6_MAX
 - 1)

	)

138 
	siÊa_ˇcheöfo


140 
__u32
 
	mmax_ªasm_Àn
;

141 
__u32
 
	mt°amp
;

142 
__u32
 
	mªachabÀ_time
;

143 
__u32
 
	mªå™s_time
;

148 
	mIFLA_INFO_UNSPEC
,

149 
	mIFLA_INFO_KIND
,

150 
	mIFLA_INFO_DATA
,

151 
	mIFLA_INFO_XSTATS
,

152 
	m__IFLA_INFO_MAX
,

155 
	#IFLA_INFO_MAX
 (
__IFLA_INFO_MAX
 - 1)

	)

161 
	mIFLA_VLAN_UNSPEC
,

162 
	mIFLA_VLAN_ID
,

163 
	mIFLA_VLAN_FLAGS
,

164 
	mIFLA_VLAN_EGRESS_QOS
,

165 
	mIFLA_VLAN_INGRESS_QOS
,

166 
	m__IFLA_VLAN_MAX
,

169 
	#IFLA_VLAN_MAX
 (
__IFLA_VLAN_MAX
 - 1)

	)

171 
	siÊa_vœn_Êags
 {

172 
__u32
 
	mÊags
;

173 
__u32
 
	mmask
;

178 
	mIFLA_VLAN_QOS_UNSPEC
,

179 
	mIFLA_VLAN_QOS_MAPPING
,

180 
	m__IFLA_VLAN_QOS_MAX


183 
	#IFLA_VLAN_QOS_MAX
 (
__IFLA_VLAN_QOS_MAX
 - 1)

	)

185 
	siÊa_vœn_qos_m≠pög


187 
__u32
 
	m‰om
;

188 
__u32
 
	mto
;

	@/usr/include/linux/if_packet.h

1 #i‚de‡
__LINUX_IF_PACKET_H


2 
	#__LINUX_IF_PACKET_H


	)

4 
	~<löux/ty≥s.h
>

6 
	ssockaddr_pkt


8 
	m•kt_Ámûy
;

9 
	m•kt_devi˚
[14];

10 
__be16
 
	m•kt_¥Ÿocﬁ
;

13 
	ssockaddr_Œ


15 
	m¶l_Ámûy
;

16 
__be16
 
	m¶l_¥Ÿocﬁ
;

17 
	m¶l_ifödex
;

18 
	m¶l_h©y≥
;

19 
	m¶l_pkây≥
;

20 
	m¶l_hÆí
;

21 
	m¶l_addr
[8];

26 
	#PACKET_HOST
 0

	)

27 
	#PACKET_BROADCAST
 1

	)

28 
	#PACKET_MULTICAST
 2

	)

29 
	#PACKET_OTHERHOST
 3

	)

30 
	#PACKET_OUTGOING
 4

	)

32 
	#PACKET_LOOPBACK
 5

	)

33 
	#PACKET_FASTROUTE
 6

	)

37 
	#PACKET_ADD_MEMBERSHIP
 1

	)

38 
	#PACKET_DROP_MEMBERSHIP
 2

	)

39 
	#PACKET_RECV_OUTPUT
 3

	)

41 
	#PACKET_RX_RING
 5

	)

42 
	#PACKET_STATISTICS
 6

	)

43 
	#PACKET_COPY_THRESH
 7

	)

44 
	#PACKET_AUXDATA
 8

	)

45 
	#PACKET_ORIGDEV
 9

	)

46 
	#PACKET_VERSION
 10

	)

47 
	#PACKET_HDRLEN
 11

	)

48 
	#PACKET_RESERVE
 12

	)

49 
	#PACKET_TX_RING
 13

	)

50 
	#PACKET_LOSS
 14

	)

52 
	sçackë_°©s


54 
	mç_∑ckës
;

55 
	mç_dr›s
;

58 
	sçackë_auxd©a


60 
__u32
 
	mç_°©us
;

61 
__u32
 
	mç_Àn
;

62 
__u32
 
	mç_¢≠Àn
;

63 
__u16
 
	mç_mac
;

64 
__u16
 
	mç_√t
;

65 
__u16
 
	mç_vœn_tci
;

69 
	#TP_STATUS_KERNEL
 0x0

	)

70 
	#TP_STATUS_USER
 0x1

	)

71 
	#TP_STATUS_COPY
 0x2

	)

72 
	#TP_STATUS_LOSING
 0x4

	)

73 
	#TP_STATUS_CSUMNOTREADY
 0x8

	)

76 
	#TP_STATUS_AVAILABLE
 0x0

	)

77 
	#TP_STATUS_SEND_REQUEST
 0x1

	)

78 
	#TP_STATUS_SENDING
 0x2

	)

79 
	#TP_STATUS_WRONG_FORMAT
 0x4

	)

81 
	sçackë_hdr


83 
	mç_°©us
;

84 
	mç_Àn
;

85 
	mç_¢≠Àn
;

86 
	mç_mac
;

87 
	mç_√t
;

88 
	mç_£c
;

89 
	mç_u£c
;

92 
	#TPACKET_ALIGNMENT
 16

	)

93 
	#TPACKET_ALIGN
(
x
Ë(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

94 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë_hdr
)Ë+ (
sockaddr_Œ
))

	)

96 
	sçackë2_hdr


98 
__u32
 
	mç_°©us
;

99 
__u32
 
	mç_Àn
;

100 
__u32
 
	mç_¢≠Àn
;

101 
__u16
 
	mç_mac
;

102 
__u16
 
	mç_√t
;

103 
__u32
 
	mç_£c
;

104 
__u32
 
	mç_n£c
;

105 
__u16
 
	mç_vœn_tci
;

108 
	#TPACKET2_HDRLEN
 (
	`TPACKET_ALIGN
((
çackë2_hdr
)Ë+ (
sockaddr_Œ
))

	)

110 
	eçackë_vîsi⁄s


112 
	mTPACKET_V1
,

113 
	mTPACKET_V2
,

129 
	sçackë_ªq


131 
	mç_block_size
;

132 
	mç_block_ƒ
;

133 
	mç_‰ame_size
;

134 
	mç_‰ame_ƒ
;

137 
	s∑ckë_mªq


139 
	mmr_ifödex
;

140 
	mmr_ty≥
;

141 
	mmr_Æí
;

142 
	mmr_addªss
[8];

145 
	#PACKET_MR_MULTICAST
 0

	)

146 
	#PACKET_MR_PROMISC
 1

	)

147 
	#PACKET_MR_ALLMULTI
 2

	)

148 
	#PACKET_MR_UNICAST
 3

	)

	@/usr/include/linux/ioctl.h

1 #i‚de‡
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/io˘l.h
>

	@/usr/include/linux/limits.h

1 #i‚de‡
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/neighbour.h

1 #i‚de‡
__LINUX_NEIGHBOUR_H


2 
	#__LINUX_NEIGHBOUR_H


	)

4 
	~<löux/ty≥s.h
>

5 
	~<löux/√éök.h
>

7 
	sndmsg


9 
__u8
 
	mndm_Ámûy
;

10 
__u8
 
	mndm_∑d1
;

11 
__u16
 
	mndm_∑d2
;

12 
__s32
 
	mndm_ifödex
;

13 
__u16
 
	mndm_°©e
;

14 
__u8
 
	mndm_Êags
;

15 
__u8
 
	mndm_ty≥
;

20 
	mNDA_UNSPEC
,

21 
	mNDA_DST
,

22 
	mNDA_LLADDR
,

23 
	mNDA_CACHEINFO
,

24 
	mNDA_PROBES
,

25 
	m__NDA_MAX


28 
	#NDA_MAX
 (
__NDA_MAX
 - 1)

	)

34 
	#NTF_USE
 0x01

	)

35 
	#NTF_PROXY
 0x08

	)

36 
	#NTF_ROUTER
 0x80

	)

42 
	#NUD_INCOMPLETE
 0x01

	)

43 
	#NUD_REACHABLE
 0x02

	)

44 
	#NUD_STALE
 0x04

	)

45 
	#NUD_DELAY
 0x08

	)

46 
	#NUD_PROBE
 0x10

	)

47 
	#NUD_FAILED
 0x20

	)

50 
	#NUD_NOARP
 0x40

	)

51 
	#NUD_PERMANENT
 0x80

	)

52 
	#NUD_NONE
 0x00

	)

59 
	snda_ˇcheöfo


61 
__u32
 
	mndm_c⁄fúmed
;

62 
__u32
 
	mndm_u£d
;

63 
__u32
 
	mndm_upd©ed
;

64 
__u32
 
	mndm_ªf˙t
;

92 
	sndt_°©s


94 
__u64
 
	mndts_Ælocs
;

95 
__u64
 
	mndts_de°roys
;

96 
__u64
 
	mndts_hash_grows
;

97 
__u64
 
	mndts_ªs_Áûed
;

98 
__u64
 
	mndts_lookups
;

99 
__u64
 
	mndts_hôs
;

100 
__u64
 
	mndts_rcv_¥obes_mˇ°
;

101 
__u64
 
	mndts_rcv_¥obes_uˇ°
;

102 
__u64
 
	mndts_≥riodic_gc_runs
;

103 
__u64
 
	mndts_f‹˚d_gc_runs
;

107 
	mNDTPA_UNSPEC
,

108 
	mNDTPA_IFINDEX
,

109 
	mNDTPA_REFCNT
,

110 
	mNDTPA_REACHABLE_TIME
,

111 
	mNDTPA_BASE_REACHABLE_TIME
,

112 
	mNDTPA_RETRANS_TIME
,

113 
	mNDTPA_GC_STALETIME
,

114 
	mNDTPA_DELAY_PROBE_TIME
,

115 
	mNDTPA_QUEUE_LEN
,

116 
	mNDTPA_APP_PROBES
,

117 
	mNDTPA_UCAST_PROBES
,

118 
	mNDTPA_MCAST_PROBES
,

119 
	mNDTPA_ANYCAST_DELAY
,

120 
	mNDTPA_PROXY_DELAY
,

121 
	mNDTPA_PROXY_QLEN
,

122 
	mNDTPA_LOCKTIME
,

123 
	m__NDTPA_MAX


125 
	#NDTPA_MAX
 (
__NDTPA_MAX
 - 1)

	)

127 
	sndtmsg


129 
__u8
 
	mndtm_Ámûy
;

130 
__u8
 
	mndtm_∑d1
;

131 
__u16
 
	mndtm_∑d2
;

134 
	sndt_c⁄fig


136 
__u16
 
	mndtc_key_Àn
;

137 
__u16
 
	mndtc_íåy_size
;

138 
__u32
 
	mndtc_íåõs
;

139 
__u32
 
	mndtc_œ°_Êush
;

140 
__u32
 
	mndtc_œ°_ønd
;

141 
__u32
 
	mndtc_hash_∫d
;

142 
__u32
 
	mndtc_hash_mask
;

143 
__u32
 
	mndtc_hash_chaö_gc
;

144 
__u32
 
	mndtc_¥oxy_qÀn
;

148 
	mNDTA_UNSPEC
,

149 
	mNDTA_NAME
,

150 
	mNDTA_THRESH1
,

151 
	mNDTA_THRESH2
,

152 
	mNDTA_THRESH3
,

153 
	mNDTA_CONFIG
,

154 
	mNDTA_PARMS
,

155 
	mNDTA_STATS
,

156 
	mNDTA_GC_INTERVAL
,

157 
	m__NDTA_MAX


159 
	#NDTA_MAX
 (
__NDTA_MAX
 - 1)

	)

	@/usr/include/linux/types.h

1 #i‚de‡
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty≥s.h
>

6 #i‚de‡
__ASSEMBLY__


8 
	~<löux/posix_ty≥s.h
>

16 #ifde‡
__CHECKER__


17 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

19 
	#__bôwi£__


	)

21 #ifde‡
__CHECK_ENDIAN__


22 
	#__bôwi£
 
__bôwi£__


	)

24 
	#__bôwi£


	)

27 
__u16
 
	t__bôwi£
 
	t__À16
;

28 
__u16
 
	t__bôwi£
 
	t__be16
;

29 
__u32
 
	t__bôwi£
 
	t__À32
;

30 
__u32
 
	t__bôwi£
 
	t__be32
;

31 
__u64
 
	t__bôwi£
 
	t__À64
;

32 
__u64
 
	t__bôwi£
 
	t__be64
;

34 
__u16
 
	t__bôwi£
 
	t__sum16
;

35 
__u32
 
	t__bôwi£
 
	t__wsum
;

	@/usr/include/asm-generic/errno.h

1 #i‚de‡
_ASM_GENERIC_ERRNO_H


2 
	#_ASM_GENERIC_ERRNO_H


	)

4 
	~<asm-gíîic/î∫o-ba£.h
>

6 
	#EDEADLK
 35

	)

7 
	#ENAMETOOLONG
 36

	)

8 
	#ENOLCK
 37

	)

9 
	#ENOSYS
 38

	)

10 
	#ENOTEMPTY
 39

	)

11 
	#ELOOP
 40

	)

12 
	#EWOULDBLOCK
 
EAGAIN


	)

13 
	#ENOMSG
 42

	)

14 
	#EIDRM
 43

	)

15 
	#ECHRNG
 44

	)

16 
	#EL2NSYNC
 45

	)

17 
	#EL3HLT
 46

	)

18 
	#EL3RST
 47

	)

19 
	#ELNRNG
 48

	)

20 
	#EUNATCH
 49

	)

21 
	#ENOCSI
 50

	)

22 
	#EL2HLT
 51

	)

23 
	#EBADE
 52

	)

24 
	#EBADR
 53

	)

25 
	#EXFULL
 54

	)

26 
	#ENOANO
 55

	)

27 
	#EBADRQC
 56

	)

28 
	#EBADSLT
 57

	)

30 
	#EDEADLOCK
 
EDEADLK


	)

32 
	#EBFONT
 59

	)

33 
	#ENOSTR
 60

	)

34 
	#ENODATA
 61

	)

35 
	#ETIME
 62

	)

36 
	#ENOSR
 63

	)

37 
	#ENONET
 64

	)

38 
	#ENOPKG
 65

	)

39 
	#EREMOTE
 66

	)

40 
	#ENOLINK
 67

	)

41 
	#EADV
 68

	)

42 
	#ESRMNT
 69

	)

43 
	#ECOMM
 70

	)

44 
	#EPROTO
 71

	)

45 
	#EMULTIHOP
 72

	)

46 
	#EDOTDOT
 73

	)

47 
	#EBADMSG
 74

	)

48 
	#EOVERFLOW
 75

	)

49 
	#ENOTUNIQ
 76

	)

50 
	#EBADFD
 77

	)

51 
	#EREMCHG
 78

	)

52 
	#ELIBACC
 79

	)

53 
	#ELIBBAD
 80

	)

54 
	#ELIBSCN
 81

	)

55 
	#ELIBMAX
 82

	)

56 
	#ELIBEXEC
 83

	)

57 
	#EILSEQ
 84

	)

58 
	#ERESTART
 85

	)

59 
	#ESTRPIPE
 86

	)

60 
	#EUSERS
 87

	)

61 
	#ENOTSOCK
 88

	)

62 
	#EDESTADDRREQ
 89

	)

63 
	#EMSGSIZE
 90

	)

64 
	#EPROTOTYPE
 91

	)

65 
	#ENOPROTOOPT
 92

	)

66 
	#EPROTONOSUPPORT
 93

	)

67 
	#ESOCKTNOSUPPORT
 94

	)

68 
	#EOPNOTSUPP
 95

	)

69 
	#EPFNOSUPPORT
 96

	)

70 
	#EAFNOSUPPORT
 97

	)

71 
	#EADDRINUSE
 98

	)

72 
	#EADDRNOTAVAIL
 99

	)

73 
	#ENETDOWN
 100

	)

74 
	#ENETUNREACH
 101

	)

75 
	#ENETRESET
 102

	)

76 
	#ECONNABORTED
 103

	)

77 
	#ECONNRESET
 104

	)

78 
	#ENOBUFS
 105

	)

79 
	#EISCONN
 106

	)

80 
	#ENOTCONN
 107

	)

81 
	#ESHUTDOWN
 108

	)

82 
	#ETOOMANYREFS
 109

	)

83 
	#ETIMEDOUT
 110

	)

84 
	#ECONNREFUSED
 111

	)

85 
	#EHOSTDOWN
 112

	)

86 
	#EHOSTUNREACH
 113

	)

87 
	#EALREADY
 114

	)

88 
	#EINPROGRESS
 115

	)

89 
	#ESTALE
 116

	)

90 
	#EUCLEAN
 117

	)

91 
	#ENOTNAM
 118

	)

92 
	#ENAVAIL
 119

	)

93 
	#EISNAM
 120

	)

94 
	#EREMOTEIO
 121

	)

95 
	#EDQUOT
 122

	)

97 
	#ENOMEDIUM
 123

	)

98 
	#EMEDIUMTYPE
 124

	)

99 
	#ECANCELED
 125

	)

100 
	#ENOKEY
 126

	)

101 
	#EKEYEXPIRED
 127

	)

102 
	#EKEYREVOKED
 128

	)

103 
	#EKEYREJECTED
 129

	)

106 
	#EOWNERDEAD
 130

	)

107 
	#ENOTRECOVERABLE
 131

	)

109 
	#ERFKILL
 132

	)

	@/usr/include/asm/ioctl.h

1 
	~<asm-gíîic/io˘l.h
>

	@/usr/include/asm/types.h

1 #i‚de‡
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	#dma_addr_t
 
dma_addr_t


	)

6 
	~<asm-gíîic/ty≥s.h
>

	@/usr/include/linux/posix_types.h

1 #i‚de‡
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<löux/°ddef.h
>

21 #unde‡
__NFDBITS


22 
	#__NFDBITS
 (8 * ())

	)

24 #unde‡
__FD_SETSIZE


25 
	#__FD_SETSIZE
 1024

	)

27 #unde‡
__FDSET_LONGS


28 
	#__FDSET_LONGS
 (
__FD_SETSIZE
/
__NFDBITS
)

	)

30 #unde‡
__FDELT


31 
	#__FDELT
(
d
Ë((dË/ 
__NFDBITS
)

	)

33 #unde‡
__FDMASK


34 
	#__FDMASK
(
d
Ë(1UL << ((dË% 
__NFDBITS
))

	)

37 
	mfds_bôs
 [
__FDSET_LONGS
];

38 } 
	t__kî√l_fd_£t
;

41 (*
	t__kî√l_sigh™dÀr_t
)();

44 
	t__kî√l_key_t
;

45 
	t__kî√l_mqd_t
;

47 
	~<asm/posix_ty≥s.h
>

	@/usr/include/linux/swab.h

1 #i‚de‡
_LINUX_SWAB_H


2 
	#_LINUX_SWAB_H


	)

4 
	~<löux/ty≥s.h
>

6 
	~<asm/swab.h
>

12 
	#___c⁄°™t_swab16
(
x
Ë((
__u16
)( \

13 (((
__u16
)(
x
) & (__u16)0x00ffU) << 8) | \

14 (((
__u16
)(
x
Ë& (__u16)0xff00UË>> 8)))

	)

16 
	#___c⁄°™t_swab32
(
x
Ë((
__u32
)( \

17 (((
__u32
)(
x
) & (__u32)0x000000ffUL) << 24) | \

18 (((
__u32
)(
x
) & (__u32)0x0000ff00UL) << 8) | \

19 (((
__u32
)(
x
) & (__u32)0x00ff0000UL) >> 8) | \

20 (((
__u32
)(
x
Ë& (__u32)0xff000000ULË>> 24)))

	)

22 
	#___c⁄°™t_swab64
(
x
Ë((
__u64
)( \

23 (((
__u64
)(
x
) & (__u64)0x00000000000000ffULL) << 56) | \

24 (((
__u64
)(
x
) & (__u64)0x000000000000ff00ULL) << 40) | \

25 (((
__u64
)(
x
) & (__u64)0x0000000000ff0000ULL) << 24) | \

26 (((
__u64
)(
x
) & (__u64)0x00000000ff000000ULL) << 8) | \

27 (((
__u64
)(
x
) & (__u64)0x000000ff00000000ULL) >> 8) | \

28 (((
__u64
)(
x
) & (__u64)0x0000ff0000000000ULL) >> 24) | \

29 (((
__u64
)(
x
) & (__u64)0x00ff000000000000ULL) >> 40) | \

30 (((
__u64
)(
x
Ë& (__u64)0xff00000000000000ULLË>> 56)))

	)

32 
	#___c⁄°™t_swahw32
(
x
Ë((
__u32
)( \

33 (((
__u32
)(
x
) & (__u32)0x0000ffffUL) << 16) | \

34 (((
__u32
)(
x
Ë& (__u32)0xffff0000ULË>> 16)))

	)

36 
	#___c⁄°™t_swahb32
(
x
Ë((
__u32
)( \

37 (((
__u32
)(
x
) & (__u32)0x00ff00ffUL) << 8) | \

38 (((
__u32
)(
x
Ë& (__u32)0xff00ff00ULË>> 8)))

	)

46 
__ölöe__
 
__u16
 
	$__fswab16
(
__u16
 
vÆ
)

48 #ifde‡
__¨ch_swab16


49  
	`__¨ch_swab16
(
vÆ
);

51  
	`___c⁄°™t_swab16
(
vÆ
);

53 
	}
}

55 
__ölöe__
 
__u32
 
	$__fswab32
(
__u32
 
vÆ
)

57 #ifde‡
__¨ch_swab32


58  
	`__¨ch_swab32
(
vÆ
);

60  
	`___c⁄°™t_swab32
(
vÆ
);

62 
	}
}

64 
__ölöe__
 
__u64
 
	$__fswab64
(
__u64
 
vÆ
)

66 #ifde‡
__¨ch_swab64


67  
	`__¨ch_swab64
(
vÆ
);

68 #ñi‡
	`deföed
(
__SWAB_64_THRU_32__
)

69 
__u32
 
h
 = 
vÆ
 >> 32;

70 
__u32
 
l
 = 
vÆ
 & ((1ULL << 32) - 1);

71  (((
__u64
)
	`__fswab32
(
l
)Ë<< 32Ë| ((__u64)(__fswab32(
h
)));

73  
	`___c⁄°™t_swab64
(
vÆ
);

75 
	}
}

77 
__ölöe__
 
__u32
 
	$__fswahw32
(
__u32
 
vÆ
)

79 #ifde‡
__¨ch_swahw32


80  
	`__¨ch_swahw32
(
vÆ
);

82  
	`___c⁄°™t_swahw32
(
vÆ
);

84 
	}
}

86 
__ölöe__
 
__u32
 
	$__fswahb32
(
__u32
 
vÆ
)

88 #ifde‡
__¨ch_swahb32


89  
	`__¨ch_swahb32
(
vÆ
);

91  
	`___c⁄°™t_swahb32
(
vÆ
);

93 
	}
}

99 
	#__swab16
(
x
) \

100 (
	`__buûtö_c⁄°™t_p
((
__u16
)(
x
)) ? \

101 
	`___c⁄°™t_swab16
(
x
) : \

102 
	`__fswab16
(
x
))

	)

108 
	#__swab32
(
x
) \

109 (
	`__buûtö_c⁄°™t_p
((
__u32
)(
x
)) ? \

110 
	`___c⁄°™t_swab32
(
x
) : \

111 
	`__fswab32
(
x
))

	)

117 
	#__swab64
(
x
) \

118 (
	`__buûtö_c⁄°™t_p
((
__u64
)(
x
)) ? \

119 
	`___c⁄°™t_swab64
(
x
) : \

120 
	`__fswab64
(
x
))

	)

128 
	#__swahw32
(
x
) \

129 (
	`__buûtö_c⁄°™t_p
((
__u32
)(
x
)) ? \

130 
	`___c⁄°™t_swahw32
(
x
) : \

131 
	`__fswahw32
(
x
))

	)

139 
	#__swahb32
(
x
) \

140 (
	`__buûtö_c⁄°™t_p
((
__u32
)(
x
)) ? \

141 
	`___c⁄°™t_swahb32
(
x
) : \

142 
	`__fswahb32
(
x
))

	)

148 
__ölöe__
 
__u16
 
	$__swab16p
(c⁄° 
__u16
 *
p
)

150 #ifde‡
__¨ch_swab16p


151  
	`__¨ch_swab16p
(
p
);

153  
	`__swab16
(*
p
);

155 
	}
}

161 
__ölöe__
 
__u32
 
	$__swab32p
(c⁄° 
__u32
 *
p
)

163 #ifde‡
__¨ch_swab32p


164  
	`__¨ch_swab32p
(
p
);

166  
	`__swab32
(*
p
);

168 
	}
}

174 
__ölöe__
 
__u64
 
	$__swab64p
(c⁄° 
__u64
 *
p
)

176 #ifde‡
__¨ch_swab64p


177  
	`__¨ch_swab64p
(
p
);

179  
	`__swab64
(*
p
);

181 
	}
}

189 
__ölöe__
 
__u32
 
	$__swahw32p
(c⁄° 
__u32
 *
p
)

191 #ifde‡
__¨ch_swahw32p


192  
	`__¨ch_swahw32p
(
p
);

194  
	`__swahw32
(*
p
);

196 
	}
}

204 
__ölöe__
 
__u32
 
	$__swahb32p
(c⁄° 
__u32
 *
p
)

206 #ifde‡
__¨ch_swahb32p


207  
	`__¨ch_swahb32p
(
p
);

209  
	`__swahb32
(*
p
);

211 
	}
}

217 
__ölöe__
 
	$__swab16s
(
__u16
 *
p
)

219 #ifde‡
__¨ch_swab16s


220 
	`__¨ch_swab16s
(
p
);

222 *
p
 = 
	`__swab16p
(p);

224 
	}
}

229 
__ölöe__
 
	$__swab32s
(
__u32
 *
p
)

231 #ifde‡
__¨ch_swab32s


232 
	`__¨ch_swab32s
(
p
);

234 *
p
 = 
	`__swab32p
(p);

236 
	}
}

242 
__ölöe__
 
	$__swab64s
(
__u64
 *
p
)

244 #ifde‡
__¨ch_swab64s


245 
	`__¨ch_swab64s
(
p
);

247 *
p
 = 
	`__swab64p
(p);

249 
	}
}

257 
__ölöe__
 
	$__swahw32s
(
__u32
 *
p
)

259 #ifde‡
__¨ch_swahw32s


260 
	`__¨ch_swahw32s
(
p
);

262 *
p
 = 
	`__swahw32p
(p);

264 
	}
}

272 
__ölöe__
 
	$__swahb32s
(
__u32
 *
p
)

274 #ifde‡
__¨ch_swahb32s


275 
	`__¨ch_swahb32s
(
p
);

277 *
p
 = 
	`__swahb32p
(p);

279 
	}
}

	@/usr/include/asm-generic/errno-base.h

1 #i‚de‡
_ASM_GENERIC_ERRNO_BASE_H


2 
	#_ASM_GENERIC_ERRNO_BASE_H


	)

4 
	#EPERM
 1

	)

5 
	#ENOENT
 2

	)

6 
	#ESRCH
 3

	)

7 
	#EINTR
 4

	)

8 
	#EIO
 5

	)

9 
	#ENXIO
 6

	)

10 
	#E2BIG
 7

	)

11 
	#ENOEXEC
 8

	)

12 
	#EBADF
 9

	)

13 
	#ECHILD
 10

	)

14 
	#EAGAIN
 11

	)

15 
	#ENOMEM
 12

	)

16 
	#EACCES
 13

	)

17 
	#EFAULT
 14

	)

18 
	#ENOTBLK
 15

	)

19 
	#EBUSY
 16

	)

20 
	#EEXIST
 17

	)

21 
	#EXDEV
 18

	)

22 
	#ENODEV
 19

	)

23 
	#ENOTDIR
 20

	)

24 
	#EISDIR
 21

	)

25 
	#EINVAL
 22

	)

26 
	#ENFILE
 23

	)

27 
	#EMFILE
 24

	)

28 
	#ENOTTY
 25

	)

29 
	#ETXTBSY
 26

	)

30 
	#EFBIG
 27

	)

31 
	#ENOSPC
 28

	)

32 
	#ESPIPE
 29

	)

33 
	#EROFS
 30

	)

34 
	#EMLINK
 31

	)

35 
	#EPIPE
 32

	)

36 
	#EDOM
 33

	)

37 
	#ERANGE
 34

	)

	@/usr/include/asm-generic/ioctl.h

1 #i‚de‡
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

30 #i‚de‡
_IOC_SIZEBITS


31 
	#_IOC_SIZEBITS
 14

	)

34 #i‚de‡
_IOC_DIRBITS


35 
	#_IOC_DIRBITS
 2

	)

38 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

39 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

40 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

41 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

43 
	#_IOC_NRSHIFT
 0

	)

44 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

45 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

46 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

53 #i‚de‡
_IOC_NONE


54 
	#_IOC_NONE
 0U

	)

57 #i‚de‡
_IOC_WRITE


58 
	#_IOC_WRITE
 1U

	)

61 #i‚de‡
_IOC_READ


62 
	#_IOC_READ
 2U

	)

65 
	#_IOC
(
dú
,
ty≥
,
ƒ
,
size
) \

66 (((
dú
Ë<< 
_IOC_DIRSHIFT
) | \

67 ((
ty≥
Ë<< 
_IOC_TYPESHIFT
) | \

68 ((
ƒ
Ë<< 
_IOC_NRSHIFT
) | \

69 ((
size
Ë<< 
_IOC_SIZESHIFT
))

	)

71 
	#_IOC_TYPECHECK
(
t
Ë(—))

	)

74 
	#_IO
(
ty≥
,
ƒ
Ë
	`_IOC
(
_IOC_NONE
,—y≥),“r),0)

	)

75 
	#_IOR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

76 
	#_IOW
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

77 
	#_IOWR
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(
	`_IOC_TYPECHECK
(size)))

	)

78 
	#_IOR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
,—y≥),“r),(size))

	)

79 
	#_IOW_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_WRITE
,—y≥),“r),(size))

	)

80 
	#_IOWR_BAD
(
ty≥
,
ƒ
,
size
Ë
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,—y≥),“r),(size))

	)

83 
	#_IOC_DIR
(
ƒ
Ë((“rË>> 
_IOC_DIRSHIFT
Ë& 
_IOC_DIRMASK
)

	)

84 
	#_IOC_TYPE
(
ƒ
Ë((“rË>> 
_IOC_TYPESHIFT
Ë& 
_IOC_TYPEMASK
)

	)

85 
	#_IOC_NR
(
ƒ
Ë((“rË>> 
_IOC_NRSHIFT
Ë& 
_IOC_NRMASK
)

	)

86 
	#_IOC_SIZE
(
ƒ
Ë((“rË>> 
_IOC_SIZESHIFT
Ë& 
_IOC_SIZEMASK
)

	)

90 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

91 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

92 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
Ë<< 
_IOC_DIRSHIFT
)

	)

93 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

94 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm-generic/types.h

1 #i‚de‡
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

7 
	~<asm-gíîic/öt-Œ64.h
>

9 #i‚de‡
__ASSEMBLY__


11 
	tumode_t
;

	@/usr/include/asm/posix_types.h

1 #ifde‡
__i386__


2 
	~"posix_ty≥s_32.h
"

4 
	~"posix_ty≥s_64.h
"

	@/usr/include/asm/swab.h

1 #i‚de‡
_ASM_X86_SWAB_H


2 
	#_ASM_X86_SWAB_H


	)

4 
	~<löux/ty≥s.h
>

7 
__ölöe__
 
__u32
 
	$__¨ch_swab32
(
__u32
 
vÆ
)

9 #ifde‡
__i386__


10 #ifde‡
CONFIG_X86_BSWAP


11 
	`__asm__
("bsw≠ %0" : "Ù" (
vÆ
) : "0" (val));

13 
	`__asm__
("xchgb %b0,%h0\n\t"

16 : "=q" (
vÆ
)

17 : "0" (
vÆ
));

21 
	`__asm__
("bswapl %0"

22 : "Ù" (
vÆ
)

23 : "0" (
vÆ
));

25  
vÆ
;

26 
	}
}

27 
	#__¨ch_swab32
 
__¨ch_swab32


	)

29 
__ölöe__
 
__u64
 
	$__¨ch_swab64
(
__u64
 
vÆ
)

31 #ifde‡
__i386__


34 
__u32
 
a
;

35 
__u32
 
b
;

36 } 
s
;

37 
__u64
 
u
;

38 } 
v
;

39 
v
.
u
 = 
vÆ
;

40 #ifde‡
CONFIG_X86_BSWAP


41 
	`__asm__
("bswapl %0 ; bswapl %1 ; xchgl %0,%1"

42 : "Ù" (
v
.
s
.
a
), "Ù" (v.s.
b
)

43 : "0" (
v
.
s
.
a
), "1" (v.s.
b
));

45 
v
.
s
.
a
 = 
	`__¨ch_swab32
(v.s.a);

46 
v
.
s
.
b
 = 
	`__¨ch_swab32
(v.s.b);

47 
	`__asm__
("xchgl %0,%1"

48 : "Ù" (
v
.
s
.
a
), "Ù" (v.s.
b
)

49 : "0" (
v
.
s
.
a
), "1" (v.s.
b
));

51  
v
.
u
;

53 
	`__asm__
("bswapq %0"

54 : "Ù" (
vÆ
)

55 : "0" (
vÆ
));

56  
vÆ
;

58 
	}
}

59 
	#__¨ch_swab64
 
__¨ch_swab64


	)

	@/usr/include/linux/stddef.h

1 #i‚de‡
_LINUX_STDDEF_H


2 
	#_LINUX_STDDEF_H


	)

6 #unde‡
NULL


7 #i‡
deföed
(
__˝lu•lus
)

8 
	#NULL
 0

	)

10 
	#NULL
 ((*)0)

	)

	@/usr/include/asm-generic/int-ll64.h

8 #i‚de‡
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/bô•îl⁄g.h
>

13 #i‚de‡
__ASSEMBLY__


19 
__sig√d__
 
	t__s8
;

20 
	t__u8
;

22 
__sig√d__
 
	t__s16
;

23 
	t__u16
;

25 
__sig√d__
 
	t__s32
;

26 
	t__u32
;

28 #ifde‡
__GNUC__


29 
__exãnsi⁄__
 
__sig√d__
 
	t__s64
;

30 
__exãnsi⁄__
 
	t__u64
;

32 
__sig√d__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm/bitsperlong.h

1 #i‚de‡
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ifde‡
__x86_64__


5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-gíîic/bô•îl⁄g.h
>

	@/usr/include/asm-generic/bitsperlong.h

1 #i‚de‡
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #i‚de‡
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@
1
.
1
/usr/include
94
1709
ap.c
ap.h
ath6kl_sdio.mod.c
ath6kl_usb.mod.c
ath_netlink.c
ath_netlink.h
bmi.c
bmi.h
cfg80211.c
cfg80211.h
cfg80211_btcoex.c
cfg80211_btcoex.h
common.h
core.h
debug.c
debug.h
diag.c
diagnose.h
epping.h
hif-ops.h
hif.c
hif.h
htc-ops.h
htc.c
htc.h
htc_pipe.c
htcoex.c
htcoex.h
init.c
main.c
msm.c
p2p.c
p2p.h
pm.c
pm.h
reg.c
reg.h
regdb.c
rttapi.h
rttm.c
rttm.h
sdio.c
target.h
testmode.c
testmode.h
txrx.c
usb.c
wlan_location_defs.h
wmi.c
wmi.h
wmi_btcoex.c
wmi_btcoex.h
/usr/include/asm/byteorder.h
/usr/include/linux/errno.h
/usr/include/linux/fs.h
/usr/include/linux/if.h
/usr/include/linux/ip.h
/usr/include/linux/netdevice.h
/usr/include/linux/netlink.h
/usr/include/linux/nl80211.h
/usr/include/linux/reboot.h
/usr/include/linux/rtnetlink.h
/usr/include/linux/sched.h
/usr/include/linux/socket.h
/usr/include/linux/time.h
/usr/include/linux/unistd.h
/usr/include/linux/version.h
/usr/include/linux/wireless.h
/usr/include/asm/errno.h
/usr/include/asm/unistd.h
/usr/include/linux/byteorder/little_endian.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/linux/if_addr.h
/usr/include/linux/if_ether.h
/usr/include/linux/if_link.h
/usr/include/linux/if_packet.h
/usr/include/linux/ioctl.h
/usr/include/linux/limits.h
/usr/include/linux/neighbour.h
/usr/include/linux/types.h
/usr/include/asm-generic/errno.h
/usr/include/asm/ioctl.h
/usr/include/asm/types.h
/usr/include/linux/posix_types.h
/usr/include/linux/swab.h
/usr/include/asm-generic/errno-base.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm-generic/types.h
/usr/include/asm/posix_types.h
/usr/include/asm/swab.h
/usr/include/linux/stddef.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm/bitsperlong.h
/usr/include/asm-generic/bitsperlong.h
